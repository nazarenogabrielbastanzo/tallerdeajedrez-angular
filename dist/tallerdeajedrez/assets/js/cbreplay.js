var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,b,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[b]=d.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var b=0;return $jscomp.iteratorPrototype(function(){return b<c.length?{done:!1,value:c[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.findInternal=function(c,b,d){c instanceof String&&(c=String(c));for(var e=c.length,f=0;f<e;f++){var g=c[f];if(b.call(d,g,f,c))return{i:f,v:g}}return{i:-1,v:void 0}};
$jscomp.polyfill=function(c,b,d,e){if(b){d=$jscomp.global;c=c.split(".");for(e=0;e<c.length-1;e++){var f=c[e];f in d||(d[f]={});d=d[f]}c=c[c.length-1];e=d[c];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(d,c,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(b,d){return $jscomp.findInternal(this,b,d).v}},"es6-impl","es3");$jscomp.array=$jscomp.array||{};
$jscomp.iteratorFromArray=function(c,b){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var d=0,e={next:function(){if(d<c.length){var f=d++;return{value:b(f,c[f]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(b,d){return d})}},"es6","es3");$jscomp.checkStringArgs=function(c,b,d){if(null==c)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return c+""};
$jscomp.polyfill("String.prototype.startsWith",function(c){return c?c:function(b,d){var e=$jscomp.checkStringArgs(this,b,"startsWith");b+="";for(var f=e.length,c=b.length,h=Math.max(0,Math.min(d|0,e.length)),l=0;l<c&&h<f;)if(e[h++]!=b[l++])return!1;return l>=c}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.endsWith",function(c){return c?c:function(b,d){var e=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===d&&(d=e.length);for(var f=Math.max(0,Math.min(d|0,e.length)),c=b.length;0<c&&0<f;)if(e[--f]!=b[--c])return!1;return 0>=c}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.findIndex",function(c){return c?c:function(b,d){return $jscomp.findInternal(this,b,d).i}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(c){return c?c:function(b,d,e){var f=this.length||0;0>d&&(d=Math.max(0,f+d));if(null==e||e>f)e=f;e=Number(e);0>e&&(e=Math.max(0,f+e));for(d=Number(d||0);d<e;d++)this[d]=b;return this}},"es6-impl","es3");$jscomp.polyfill("Array.prototype.entries",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(b,d){return[b,d]})}},"es6-impl","es3");
(function(c,b,d){function e(e,d){var f=b(e);f.data("JSGrid",this);this._container=f;this.data=[];this.fields=[];this._sortField=this._editingRow=null;this._sortOrder="asc";this._firstDisplayingPage=1;this._init(d);this.render()}var f=function(e,d){return b.isFunction(e)?e.apply(d,b.makeArray(arguments).slice(2)):e},g=function(e){var d=b.Deferred();e&&e.then?e.then(function(){d.resolve.apply(d,arguments)},function(){d.reject.apply(d,arguments)}):d.resolve(e);return d.promise()},h={loadData:b.noop,
insertItem:b.noop,updateItem:b.noop,deleteItem:b.noop};e.prototype={width:"auto",height:"auto",updateOnResize:!0,rowClass:b.noop,rowRenderer:null,rowClick:function(e){this.editing&&this.editItem(b(e.event.target).closest("tr"))},rowDoubleClick:b.noop,noDataContent:"Not found",noDataRowClass:"jsgrid-nodata-row",heading:!0,headerRowRenderer:null,headerRowClass:"jsgrid-header-row",headerCellClass:"jsgrid-header-cell",filtering:!1,filterRowRenderer:null,filterRowClass:"jsgrid-filter-row",inserting:!1,
insertRowRenderer:null,insertRowClass:"jsgrid-insert-row",editing:!1,editRowRenderer:null,editRowClass:"jsgrid-edit-row",confirmDeleting:!0,deleteConfirm:"Are you sure?",selecting:!0,selectedRowClass:"jsgrid-selected-row",oddRowClass:"jsgrid-row",evenRowClass:"jsgrid-alt-row",cellClass:"jsgrid-cell",sorting:!1,sortableClass:"jsgrid-header-sortable",sortAscClass:"jsgrid-header-sort jsgrid-header-sort-asc",sortDescClass:"jsgrid-header-sort jsgrid-header-sort-desc",paging:!1,pagerContainer:null,pageIndex:1,
pageSize:20,pageButtonCount:15,pagerFormat:"Pages: {first} {prev} {pages} {next} {last} &nbsp;&nbsp; {pageIndex} of {pageCount}",pagePrevText:"Prev",pageNextText:"Next",pageFirstText:"First",pageLastText:"Last",pageNavigatorNextText:"...",pageNavigatorPrevText:"...",pagerContainerClass:"jsgrid-pager-container",pagerClass:"jsgrid-pager",pagerNavButtonClass:"jsgrid-pager-nav-button",pagerNavButtonInactiveClass:"jsgrid-pager-nav-inactive-button",pageClass:"jsgrid-pager-page",currentPageClass:"jsgrid-pager-current-page",
customLoading:!1,pageLoading:!1,autoload:!1,controller:h,loadIndication:!0,loadIndicationDelay:500,loadMessage:"Please, wait...",loadShading:!0,invalidMessage:"Invalid data entered!",invalidNotify:function(e){e=b.map(e.errors,function(b){return b.message||null});c.alert([this.invalidMessage].concat(e).join("\n"))},onInit:b.noop,onRefreshing:b.noop,onRefreshed:b.noop,onPageChanged:b.noop,onItemDeleting:b.noop,onItemDeleted:b.noop,onItemInserting:b.noop,onItemInserted:b.noop,onItemEditing:b.noop,onItemUpdating:b.noop,
onItemUpdated:b.noop,onItemInvalid:b.noop,onDataLoading:b.noop,onDataLoaded:b.noop,onOptionChanging:b.noop,onOptionChanged:b.noop,onError:b.noop,invalidClass:"jsgrid-invalid",containerClass:"jsgrid",tableClass:"jsgrid-table",gridHeaderClass:"jsgrid-grid-header",gridBodyClass:"jsgrid-grid-body",_init:function(e){b.extend(this,e);this._initLoadStrategy();this._initController();this._initFields();this._attachWindowLoadResize();this._attachWindowResizeCallback();this._callEventHandler(this.onInit)},loadStrategy:function(){return this.pageLoading?
new jsGrid.loadStrategies.PageLoadingStrategy(this):new jsGrid.loadStrategies.DirectLoadingStrategy(this)},_initLoadStrategy:function(){this._loadStrategy=f(this.loadStrategy,this)},_initController:function(){this._controller=b.extend({},h,f(this.controller,this))},renderTemplate:function(b,e,c){args=[];for(var g in c)args.push(c[g]);args.unshift(b,e);b=f.apply(null,args);return b===d||null===b?"":b},loadIndicator:function(b){return new jsGrid.LoadIndicator(b)},validation:function(b){return jsGrid.Validation&&
new jsGrid.Validation(b)},_initFields:function(){var e=this;e.fields=b.map(e.fields,function(d){b.isPlainObject(d)&&(d=new (d.type&&jsGrid.fields[d.type]||jsGrid.Field)(d));d._grid=e;return d})},_attachWindowLoadResize:function(){b(c).on("load",b.proxy(this._refreshSize,this))},_attachWindowResizeCallback:function(){if(this.updateOnResize)b(c).on("resize",b.proxy(this._refreshSize,this))},_detachWindowResizeCallback:function(){b(c).off("resize",this._refreshSize)},option:function(b,e){var d;if(1===
arguments.length)return this[b];d={option:b,oldValue:this[b],newValue:e};this._callEventHandler(this.onOptionChanging,d);this._handleOptionChange(d.option,d.newValue);this._callEventHandler(this.onOptionChanged,{option:d.option,value:d.newValue})},fieldOption:function(b,e,d){b=this._normalizeField(b);if(2===arguments.length)return b[e];b[e]=d;this._renderGrid()},_handleOptionChange:function(b,e){this[b]=e;switch(b){case "width":case "height":this._refreshSize();break;case "rowClass":case "rowRenderer":case "rowClick":case "rowDoubleClick":case "noDataRowClass":case "noDataContent":case "selecting":case "selectedRowClass":case "oddRowClass":case "evenRowClass":this._refreshContent();
break;case "pageButtonCount":case "pagerFormat":case "pagePrevText":case "pageNextText":case "pageFirstText":case "pageLastText":case "pageNavigatorNextText":case "pageNavigatorPrevText":case "pagerClass":case "pagerNavButtonClass":case "pageClass":case "currentPageClass":case "pagerRenderer":this._refreshPager();break;case "fields":this._initFields();this.render();break;case "data":case "editing":case "heading":case "filtering":case "inserting":case "paging":this.refresh();break;case "loadStrategy":case "pageLoading":this._initLoadStrategy();
this.search();break;case "pageIndex":this.openPage(e);break;case "pageSize":this.refresh();this.search();break;case "editRowRenderer":case "editRowClass":this.cancelEdit();break;case "updateOnResize":this._detachWindowResizeCallback();this._attachWindowResizeCallback();break;case "invalidNotify":case "invalidMessage":break;default:this.render()}},destroy:function(){this._detachWindowResizeCallback();this._clear();this._container.removeData("JSGrid")},render:function(){this._renderGrid();return this.autoload?
this.loadData():b.Deferred().resolve().promise()},_renderGrid:function(){this._clear();this._container.addClass(this.containerClass).css("position","relative").append(this._createHeader()).append(this._createBody());this._pagerContainer=this._createPagerContainer();this._loadIndicator=this._createLoadIndicator();this._validation=this._createValidation();this.refresh()},_createLoadIndicator:function(){return f(this.loadIndicator,this,{message:this.loadMessage,shading:this.loadShading,container:this._container})},
_createValidation:function(){return f(this.validation,this)},_clear:function(){this.cancelEdit();clearTimeout(this._loadingTimer);this._pagerContainer&&this._pagerContainer.empty();this._container.empty().css({position:"",width:"",height:""})},_createHeader:function(){var e=this._headerRow=this._createHeaderRow(),d=this._filterRow=this._createFilterRow(),f=this._insertRow=this._createInsertRow(),e=this._headerGrid=b("<table>").addClass(this.tableClass).append(e).append(d).append(f);return this._header=
b("<div>").addClass(this.gridHeaderClass).addClass(this._scrollBarWidth()?"jsgrid-header-scrollbar":"").append(e)},_createBody:function(){var e=this._content=b("<tbody>"),e=this._bodyGrid=b("<table>").addClass(this.tableClass).append(e);return this._body=b("<div>").addClass(this.gridBodyClass).append(e).on("scroll",b.proxy(function(b){this._header.scrollLeft(b.target.scrollLeft)},this))},_createPagerContainer:function(){var e=this.pagerContainer||b("<div>").appendTo(this._container);return b(e).addClass(this.pagerContainerClass)},
_eachField:function(e){var d=this;b.each(this.fields,function(b,f){f.visible&&e.call(d,f,b)})},_createHeaderRow:function(){if(b.isFunction(this.headerRowRenderer))return b(this.renderTemplate(this.headerRowRenderer,this));var e=b("<tr>").addClass(this.headerRowClass);this._eachField(function(d,f){var c=this._prepareCell("<th>",d,"headercss",this.headerCellClass).append(this.renderTemplate(d.headerTemplate,d)).appendTo(e);if(this.sorting&&d.sorting)c.addClass(this.sortableClass).on("click",b.proxy(function(){this.sort(f)},
this))});return e},_prepareCell:function(e,d,f,c){return b(e).css("width",d.width).addClass(c||this.cellClass).addClass(f&&d[f]||d.css).addClass(d.align?"jsgrid-align-"+d.align:"")},_createFilterRow:function(){if(b.isFunction(this.filterRowRenderer))return b(this.renderTemplate(this.filterRowRenderer,this));var e=b("<tr>").addClass(this.filterRowClass);this._eachField(function(b){this._prepareCell("<td>",b,"filtercss").append(this.renderTemplate(b.filterTemplate,b)).appendTo(e)});return e},_createInsertRow:function(){if(b.isFunction(this.insertRowRenderer))return b(this.renderTemplate(this.insertRowRenderer,
this));var e=b("<tr>").addClass(this.insertRowClass);this._eachField(function(b){this._prepareCell("<td>",b,"insertcss").append(this.renderTemplate(b.insertTemplate,b)).appendTo(e)});return e},_callEventHandler:function(e,d){e.call(this,b.extend(d,{grid:this}));return d},reset:function(){this._resetSorting();this._resetPager();return this._loadStrategy.reset()},_resetPager:function(){this._firstDisplayingPage=1;this._setPage(1)},_resetSorting:function(){this._sortField=null;this._sortOrder="asc";
this._clearSortingCss()},refresh:function(){this._callEventHandler(this.onRefreshing);this.cancelEdit();this._refreshHeading();this._refreshFiltering();this._refreshInserting();this._refreshContent();this._refreshPager();this._refreshSize();this._callEventHandler(this.onRefreshed)},_refreshHeading:function(){this._headerRow.toggle(this.heading)},_refreshFiltering:function(){this._filterRow.toggle(this.filtering)},_refreshInserting:function(){this._insertRow.toggle(this.inserting)},_refreshContent:function(){var b=
this._content;b.empty();if(!this.data.length)return b.append(this._createNoDataRow()),this;for(var e=this._loadStrategy.firstDisplayIndex(),d=this._loadStrategy.lastDisplayIndex();e<d;e++)b.append(this._createRow(this.data[e],e))},_createNoDataRow:function(){var e=0;this._eachField(function(){e++});return b("<tr>").addClass(this.noDataRowClass).append(b("<td>").addClass(this.cellClass).attr("colspan",e).append(this.renderTemplate(this.noDataContent,this)))},_createRow:function(e,d){var f;b.isFunction(this.rowRenderer)?
f=this.renderTemplate(this.rowRenderer,this,{item:e,itemIndex:d}):(f=b("<tr>"),this._renderCells(f,e));f.addClass(this._getRowClasses(e,d)).data("JSGridItem",e).on("click",b.proxy(function(b){this.rowClick({item:e,itemIndex:d,event:b})},this)).on("dblclick",b.proxy(function(b){this.rowDoubleClick({item:e,itemIndex:d,event:b})},this));this.selecting&&this._attachRowHover(f);return f},_getRowClasses:function(b,e){var d=[];d.push((e+1)%2?this.oddRowClass:this.evenRowClass);d.push(f(this.rowClass,this,
b,e));return d.join(" ")},_attachRowHover:function(e){var d=this.selectedRowClass;e.hover(function(){b(this).addClass(d)},function(){b(this).removeClass(d)})},_renderCells:function(b,e){this._eachField(function(d){b.append(this._createCell(e,d))});return this},_createCell:function(e,d){var f;f=this._getItemFieldValue(e,d);var c={value:f,item:e};f=b.isFunction(d.cellRenderer)?this.renderTemplate(d.cellRenderer,d,c):b("<td>").append(this.renderTemplate(d.itemTemplate||f,d,c));return this._prepareCell(f,
d)},_getItemFieldValue:function(b,e){for(var d=e.name.split("."),f=b[d.shift()];f&&d.length;)f=f[d.shift()];return f},_setItemFieldValue:function(b,e,d){e=e.name.split(".");for(var f=b,c=e[0];f&&e.length;)b=f,c=e.shift(),f=b[c];if(!f)for(;e.length;)b=b[c]={},c=e.shift();b[c]=d},sort:function(e,d){b.isPlainObject(e)&&(d=e.order,e=e.field);this._clearSortingCss();this._setSortingParams(e,d);this._setSortingCss();return this._loadStrategy.sort()},_clearSortingCss:function(){this._headerRow.find("th").removeClass(this.sortAscClass).removeClass(this.sortDescClass)},
_setSortingParams:function(b,e){b=this._normalizeField(b);e=e||(this._sortField===b?this._reversedSortOrder(this._sortOrder):"asc");this._sortField=b;this._sortOrder=e},_normalizeField:function(e){return b.isNumeric(e)?this.fields[e]:"string"===typeof e?b.grep(this.fields,function(b){return b.name===e})[0]:e},_reversedSortOrder:function(b){return"asc"===b?"desc":"asc"},_setSortingCss:function(){var b=this._visibleFieldIndex(this._sortField);this._headerRow.find("th").eq(b).addClass("asc"===this._sortOrder?
this.sortAscClass:this.sortDescClass)},_visibleFieldIndex:function(e){return b.inArray(e,b.grep(this.fields,function(b){return b.visible}))},_sortData:function(){var b=this._sortFactor(),e=this._sortField;e&&this.data.sort(function(d,f){return b*e.sortingFunc(d[e.name],f[e.name])})},_sortFactor:function(){return"asc"===this._sortOrder?1:-1},_itemsCount:function(){return this._loadStrategy.itemsCount()},_pagesCount:function(){var b=this._itemsCount(),e=this.pageSize;return Math.floor(b/e)+(b%e?1:0)},
_refreshPager:function(){var b=this._pagerContainer;b.empty();this.paging&&b.append(this._createPager());var e=this.paging&&1<this._pagesCount();b.toggle(e)},_createPager:function(){var e;e=b.isFunction(this.pagerRenderer)?b(this.pagerRenderer({pageIndex:this.pageIndex,pageCount:this._pagesCount()})):b("<div>").append(this._createPagerByFormat());e.addClass(this.pagerClass);return e},_createPagerByFormat:function(){var e=this.pageIndex,d=this._pagesCount(),f=this._itemsCount(),c=this.pagerFormat.split(" ");
return b.map(c,b.proxy(function(c){var g=c;"{pages}"===c?g=this._createPages():"{first}"===c?g=this._createPagerNavButton(this.pageFirstText,1,1<e):"{prev}"===c?g=this._createPagerNavButton(this.pagePrevText,e-1,1<e):"{next}"===c?g=this._createPagerNavButton(this.pageNextText,e+1,e<d):"{last}"===c?g=this._createPagerNavButton(this.pageLastText,d,e<d):"{pageIndex}"===c?g=e:"{pageCount}"===c?g=d:"{itemCount}"===c&&(g=f);return b.isArray(g)?g.concat([" "]):[g," "]},this))},_createPages:function(){var b=
this._pagesCount(),e=this.pageButtonCount,d=this._firstDisplayingPage,f=[];1<d&&f.push(this._createPagerPageNavButton(this.pageNavigatorPrevText,this.showPrevPages));for(var c=0,g=d;c<e&&g<=b;c++,g++)f.push(g===this.pageIndex?this._createPagerCurrentPage():this._createPagerPage(g));d+e-1<b&&f.push(this._createPagerPageNavButton(this.pageNavigatorNextText,this.showNextPages));return f},_createPagerNavButton:function(e,d,f){return this._createPagerButton(e,this.pagerNavButtonClass+(f?"":" "+this.pagerNavButtonInactiveClass),
f?function(){this.openPage(d)}:b.noop)},_createPagerPageNavButton:function(b,e){return this._createPagerButton(b,this.pagerNavButtonClass,e)},_createPagerPage:function(b){return this._createPagerButton(b,this.pageClass,function(){this.openPage(b)})},_createPagerButton:function(e,d,f){e=b("<a>").attr("href","javascript:void(0);").html(e).on("click",b.proxy(f,this));return b("<span>").addClass(d).append(e)},_createPagerCurrentPage:function(){return b("<span>").addClass(this.pageClass).addClass(this.currentPageClass).text(this.pageIndex)},
_refreshSize:function(){this._refreshHeight();this._refreshWidth()},_refreshWidth:function(){var b=this._headerGrid,e=this._bodyGrid,d=this.width;"auto"===d&&(b.width("auto"),d=b.outerWidth());b.width("");e.width("");this._container.width(d);d=b.outerWidth();e.width(d)},_scrollBarWidth:function(){var e;return function(){if(e===d){var f=b("<div style='width:50px;height:50px;overflow:hidden;position:absolute;top:-10000px;left:-10000px;'></div>"),c=b("<div style='height:100px;'></div>");f.append(c).appendTo("body");
var g=c.innerWidth();f.css("overflow-y","auto");c=c.innerWidth();f.remove();e=g-c}return e}}(),_refreshHeight:function(){var b=this._container,e=this._pagerContainer,d=this.height,f;b.height(d);"auto"!==d&&(d=b.height(),f=this._header.outerHeight(!0),e.parents(b).length&&(f+=e.outerHeight(!0)),this._body.outerHeight(d-f))},showPrevPages:function(){var b=this._firstDisplayingPage,e=this.pageButtonCount;this._firstDisplayingPage=b>e?b-e:1;this._refreshPager()},showNextPages:function(){var b=this._firstDisplayingPage,
e=this.pageButtonCount,d=this._pagesCount();this._firstDisplayingPage=b+2*e>d?d-e+1:b+e;this._refreshPager()},openPage:function(b){1>b||b>this._pagesCount()||(this._setPage(b),this._loadStrategy.openPage(b))},_setPage:function(b){var e=this._firstDisplayingPage,d=this.pageButtonCount;this.pageIndex=b;b<e&&(this._firstDisplayingPage=b);b>e+d-1&&(this._firstDisplayingPage=b-d+1);this._callEventHandler(this.onPageChanged,{pageIndex:b})},_controllerCall:function(e,d,f,c){if(f)return b.Deferred().reject().promise();
this._showLoading();f=this._controller;if(!f||!f[e])throw Error("controller has no method '"+e+"'");return g(f[e](d)).done(b.proxy(c,this)).fail(b.proxy(this._errorHandler,this)).always(b.proxy(this._hideLoading,this))},_errorHandler:function(){this._callEventHandler(this.onError,{args:b.makeArray(arguments)})},_showLoading:function(){this.loadIndication&&(clearTimeout(this._loadingTimer),this._loadingTimer=setTimeout(b.proxy(function(){this._loadIndicator.show()},this),this.loadIndicationDelay))},
_hideLoading:function(){this.loadIndication&&(clearTimeout(this._loadingTimer),this._loadIndicator.hide())},search:function(b){this._resetSorting();this._resetPager();return this.loadData(b)},loadData:function(e){e=e||(this.filtering?this.getFilter():{});b.extend(e,this._loadStrategy.loadParams(),this._sortingParams());var d=this._callEventHandler(this.onDataLoading,{filter:e});return this._controllerCall("loadData",e,d.cancel,function(b){b&&(this._loadStrategy.finishLoad(b),this._callEventHandler(this.onDataLoaded,
{data:b}))})},getFilter:function(){var b={};this._eachField(function(e){e.filtering&&this._setItemFieldValue(b,e,e.filterValue())});return b},_sortingParams:function(){return this.sorting&&this._sortField?{sortField:this._sortField.name,sortOrder:this._sortOrder}:{}},getSorting:function(){var b=this._sortingParams();return{field:b.sortField,order:b.sortOrder}},clearFilter:function(){var b=this._createFilterRow();this._filterRow.replaceWith(b);this._filterRow=b;return this.search()},insertItem:function(e){var d=
e||this._getValidatedInsertItem();if(!d)return b.Deferred().reject().promise();e=this._callEventHandler(this.onItemInserting,{item:d});return this._controllerCall("insertItem",d,e.cancel,function(b){b=b||d;this._loadStrategy.finishInsert(b);this._callEventHandler(this.onItemInserted,{item:b})})},_getValidatedInsertItem:function(){var b=this._getInsertItem();return this._validateItem(b,this._insertRow)?b:null},_getInsertItem:function(){var b={};this._eachField(function(e){e.inserting&&this._setItemFieldValue(b,
e,e.insertValue())});return b},_validateItem:function(e,f){var c=[],g={item:e,itemIndex:this._rowIndex(f),row:f};this._eachField(function(h){if(h.validate){var l=this._getItemFieldValue(e,h);l!==d&&(l=this._validation.validate(b.extend({value:l,rules:h.validate},g)),this._setCellValidity(f.children().eq(this._visibleFieldIndex(h)),l),l.length&&c.push.apply(c,b.map(l,function(b){return{field:h,message:b}})))}});if(!c.length)return!0;var h=b.extend({errors:c},g);this._callEventHandler(this.onItemInvalid,
h);this.invalidNotify(h);return!1},_setCellValidity:function(b,e){b.toggleClass(this.invalidClass,!!e.length).attr("title",e.join("\n"))},clearInsert:function(){var b=this._createInsertRow();this._insertRow.replaceWith(b);this._insertRow=b;this.refresh()},editItem:function(b){b=this.rowByItem(b);b.length&&this._editRow(b)},rowByItem:function(e){return e.jquery||e.nodeType?b(e):this._content.find("tr").filter(function(){return b.data(this,"JSGridItem")===e})},_editRow:function(b){if(this.editing){var e=
b.data("JSGridItem");this._callEventHandler(this.onItemEditing,{row:b,item:e,itemIndex:this._itemIndex(e)}).cancel||(this._editingRow&&this.cancelEdit(),e=this._createEditRow(e),this._editingRow=b,b.hide(),e.insertBefore(b),b.data("JSGridEditRow",e))}},_createEditRow:function(e){if(b.isFunction(this.editRowRenderer))return b(this.renderTemplate(field.editRowRenderer,field,{item:e,itemIndex:this._itemIndex(e)}));var d=b("<tr>").addClass(this.editRowClass);this._eachField(function(b){var f=this._getItemFieldValue(e,
b);this._prepareCell("<td>",b,"editcss").append(this.renderTemplate(b.editTemplate||"",b,{value:f,item:e})).appendTo(d)});return d},updateItem:function(b,e){1===arguments.length&&(e=b);var d=b?this.rowByItem(b):this._editingRow;if(e=e||this._getValidatedEditedItem())return this._updateRow(d,e)},_getValidatedEditedItem:function(){var b=this._getEditedItem();return this._validateItem(b,this._getEditRow())?b:null},_updateRow:function(e,d){var f=e.data("JSGridItem"),c=this._itemIndex(f),g=b.extend(!0,
{},f);b.extend(!0,f,d);var h=this._callEventHandler(this.onItemUpdating,{row:e,item:f,itemIndex:c,previousItem:g});return this._controllerCall("updateItem",f,h.cancel,function(b){b=b||f;var d=this._finishUpdate(e,b,c);this._callEventHandler(this.onItemUpdated,{row:d,item:b,itemIndex:c,previousItem:g})})},_rowIndex:function(e){return this._content.children().index(b(e))},_itemIndex:function(e){return b.inArray(e,this.data)},_finishUpdate:function(b,e,d){this.cancelEdit();this.data[d]=e;e=this._createRow(e,
d);b.replaceWith(e);return e},_getEditedItem:function(){var b={};this._eachField(function(e){e.editing&&this._setItemFieldValue(b,e,e.editValue())});return b},cancelEdit:function(){this._editingRow&&(this._getEditRow().remove(),this._editingRow.show(),this._editingRow=null)},_getEditRow:function(){return this._editingRow.data("JSGridEditRow")},deleteItem:function(b){b=this.rowByItem(b);if(b.length&&(!this.confirmDeleting||c.confirm(f(this.deleteConfirm,this,b.data("JSGridItem")))))return this._deleteRow(b)},
_deleteRow:function(b){var e=b.data("JSGridItem"),d=this._itemIndex(e),f=this._callEventHandler(this.onItemDeleting,{row:b,item:e,itemIndex:d});return this._controllerCall("deleteItem",e,f.cancel,function(){this._loadStrategy.finishDelete(e,d);this._callEventHandler(this.onItemDeleted,{row:b,item:e,itemIndex:d})})}};b.fn.jsGrid=function(f){var c=b.makeArray(arguments).slice(1),g=this;this.each(function(){var h=b(this),l=h.data("JSGrid");if(l)if("string"===typeof f){if(h=l[f].apply(l,c),h!==d&&h!==
l)return g=h,!1}else l._detachWindowResizeCallback(),l._init(f),l.render();else new e(h,f)});return g};var l={},q={},r=function(e,d){b.each(d,function(d,f){b.isPlainObject(f)?r(e[d]||e[d[0].toUpperCase()+d.slice(1)],f):e.hasOwnProperty(d)?e[d]=f:e.prototype[d]=f})};c.jsGrid={Grid:e,fields:l,setDefaults:function(d,f){var c;b.isPlainObject(d)?c=e.prototype:(c=l[d].prototype,d=f||{});b.extend(c,d)},locales:q,locale:function(e){var d=b.isPlainObject(e)?e:q[e];if(!d)throw Error("unknown locale "+e);r(jsGrid,
d)},version:"1.5.2"}})(window,jQuery);
(function(c,b,d){function e(b){this._init(b)}e.prototype={container:"body",message:"Loading...",shading:!0,zIndex:1E3,shaderClass:"jsgrid-load-shader",loadPanelClass:"jsgrid-load-panel",_init:function(e){b.extend(!0,this,e);this._initContainer();this._initShader();this._initLoadPanel()},_initContainer:function(){this._container=b(this.container)},_initShader:function(){this.shading&&(this._shader=b("<div>").addClass(this.shaderClass).hide().css({position:"absolute",top:0,right:0,bottom:0,left:0,zIndex:this.zIndex}).appendTo(this._container))},
_initLoadPanel:function(){this._loadPanel=b("<div>").addClass(this.loadPanelClass).text(this.message).hide().css({position:"absolute",top:"50%",left:"50%",zIndex:this.zIndex}).appendTo(this._container)},show:function(){var b=this._loadPanel.show(),e=b.outerWidth(),d=b.outerHeight();b.css({marginTop:-d/2,marginLeft:-e/2});this._shader.show()},hide:function(){this._loadPanel.hide();this._shader.hide()}};c.LoadIndicator=e})(jsGrid,jQuery);
(function(c,b,d){function e(b){this._grid=b}function f(b){this._grid=b;this._itemsCount=0}e.prototype={firstDisplayIndex:function(){var b=this._grid;return b.option("paging")?(b.option("pageIndex")-1)*b.option("pageSize"):0},lastDisplayIndex:function(){var b=this._grid,e=b.option("data").length;return b.option("paging")?Math.min(b.option("pageIndex")*b.option("pageSize"),e):e},itemsCount:function(){return this._grid.option("data").length},openPage:function(b){this._grid.refresh()},loadParams:function(){return{}},
sort:function(){this._grid._sortData();this._grid.refresh();return b.Deferred().resolve().promise()},reset:function(){this._grid.refresh();return b.Deferred().resolve().promise()},finishLoad:function(b){this._grid.option("data",b)},finishInsert:function(b){var e=this._grid;e.option("data").push(b);e.refresh()},finishDelete:function(b,e){var d=this._grid;d.option("data").splice(e,1);d.reset()}};f.prototype={firstDisplayIndex:function(){return 0},lastDisplayIndex:function(){return this._grid.option("data").length},
itemsCount:function(){return this._itemsCount},openPage:function(b){this._grid.loadData()},loadParams:function(){var b=this._grid;return{pageIndex:b.option("pageIndex"),pageSize:b.option("pageSize")}},reset:function(){return this._grid.loadData()},sort:function(){return this._grid.loadData()},finishLoad:function(b){this._itemsCount=b.itemsCount;this._grid.option("data",b.data)},finishInsert:function(b){this._grid.search()},finishDelete:function(b,e){this._grid.search()}};c.loadStrategies={DirectLoadingStrategy:e,
PageLoadingStrategy:f}})(jsGrid,jQuery);(function(c,b,d){var e=function(b){return"undefined"!==typeof b&&null!==b};c.sortStrategies={string:function(b,d){return e(b)||e(d)?e(b)?e(d)?(""+b).localeCompare(""+d):1:-1:0},number:function(b,e){return b-e},date:function(b,e){return b-e},numberAsString:function(b,e){return parseFloat(b)-parseFloat(e)}}})(jsGrid,jQuery);
(function(c,b,d){function e(b){this._init(b)}e.prototype={_init:function(e){b.extend(!0,this,e)},validate:function(e){var d=[];b.each(this._normalizeRules(e.rules),function(f,c){if(!c.validator(e.value,e.item,c.param)){var r=b.isFunction(c.message)?c.message(e.value,e.item):c.message;d.push(r)}});return d},_normalizeRules:function(e){b.isArray(e)||(e=[e]);return b.map(e,b.proxy(function(b){return this._normalizeRule(b)},this))},_normalizeRule:function(e){"string"===typeof e&&(e={validator:e});b.isFunction(e)&&
(e={validator:e});if(b.isPlainObject(e))e=b.extend({},e);else throw Error("wrong validation config specified");return b.isFunction(e.validator)?e:this._applyNamedValidator(e,e.validator)},_applyNamedValidator:function(e,d){delete e.validator;var c=f[d];if(!c)throw Error('unknown validator "'+d+'"');b.isFunction(c)&&(c={validator:c});return b.extend({},c,e)}};c.Validation=e;var f={required:{message:"Field is required",validator:function(b){return b!==d&&null!==b&&""!==b}},rangeLength:{message:"Field value length is out of the defined range",
validator:function(b,e,d){return b.length>=d[0]&&b.length<=d[1]}},minLength:{message:"Field value is too short",validator:function(b,e,d){return b.length>=d}},maxLength:{message:"Field value is too long",validator:function(b,e,d){return b.length<=d}},pattern:{message:"Field value is not matching the defined pattern",validator:function(b,e,d){"string"===typeof d&&(d=new RegExp("^(?:"+d+")$"));return d.test(b)}},range:{message:"Field value is out of the defined range",validator:function(b,e,d){return b>=
d[0]&&b<=d[1]}},min:{message:"Field value is too small",validator:function(b,e,d){return b>=d}},max:{message:"Field value is too large",validator:function(b,e,d){return b<=d}}};c.validators=f})(jsGrid,jQuery);
(function(c,b,d){function e(e){b.extend(!0,this,e);this.sortingFunc=this._getSortingFunc()}e.prototype={name:"",title:null,css:"",align:"",width:100,visible:!0,filtering:!0,inserting:!0,editing:!0,sorting:!0,sorter:"string",headerTemplate:function(){return this.title===d||null===this.title?this.name:this.title},itemTemplate:function(b,e){return b},filterTemplate:function(){return""},insertTemplate:function(){return""},editTemplate:function(b,e){this._value=b;return this.itemTemplate(b,e)},filterValue:function(){return""},
insertValue:function(){return""},editValue:function(){return this._value},_getSortingFunc:function(){var e=this.sorter;if(b.isFunction(e))return e;if("string"===typeof e)return c.sortStrategies[e];throw Error('wrong sorter for the field "'+this.name+'"!');}};c.Field=e})(jsGrid,jQuery);
(function(c,b,d){function e(b){f.call(this,b)}var f=c.Field;e.prototype=new f({autosearch:!0,readOnly:!1,filterTemplate:function(){if(!this.filtering)return"";var b=this._grid,e=this.filterControl=this._createTextBox();if(this.autosearch)e.on("keypress",function(e){13===e.which&&(b.search(),e.preventDefault())});return e},insertTemplate:function(){return this.inserting?this.insertControl=this._createTextBox():""},editTemplate:function(b){if(!this.editing)return this.itemTemplate(b);var e=this.editControl=
this._createTextBox();e.val(b);return e},filterValue:function(){return this.filterControl.val()},insertValue:function(){return this.insertControl.val()},editValue:function(){return this.editControl.val()},_createTextBox:function(){return b("<input>").attr("type","text").prop("readonly",!!this.readOnly)}});c.fields.text=c.TextField=e})(jsGrid,jQuery);
(function(c,b,d){function e(b){f.call(this,b)}var f=c.TextField;e.prototype=new f({sorter:"number",align:"right",readOnly:!1,filterValue:function(){return parseInt(this.filterControl.val()||0,10)},insertValue:function(){return parseInt(this.insertControl.val()||0,10)},editValue:function(){return parseInt(this.editControl.val()||0,10)},_createTextBox:function(){return b("<input>").attr("type","number").prop("readonly",!!this.readOnly)}});c.fields.number=c.NumberField=e})(jsGrid,jQuery);
(function(c,b,d){function e(b){f.call(this,b)}var f=c.TextField;e.prototype=new f({insertTemplate:function(){return this.inserting?this.insertControl=this._createTextArea():""},editTemplate:function(b){if(!this.editing)return this.itemTemplate(b);var e=this.editControl=this._createTextArea();e.val(b);return e},_createTextArea:function(){return b("<textarea>").prop("readonly",!!this.readOnly)}});c.fields.textarea=c.TextAreaField=e})(jsGrid,jQuery);
(function(c,b,d){function e(b){this.items=[];this.selectedIndex=-1;this.textField=this.valueField="";b.valueField&&b.items.length&&(this.valueType="number"===typeof b.items[0][b.valueField]?"number":"string");this.sorter=this.valueType;f.call(this,b)}var f=c.NumberField;e.prototype=new f({align:"center",valueType:"number",itemTemplate:function(e){var f=this.items,c=this.valueField,q=this.textField,f=c?b.grep(f,function(b,d){return b[c]===e})[0]||{}:f[e],q=q?f[q]:f;return q===d||null===q?"":q},filterTemplate:function(){if(!this.filtering)return"";
var b=this._grid,e=this.filterControl=this._createSelect();if(this.autosearch)e.on("change",function(e){b.search()});return e},insertTemplate:function(){return this.inserting?this.insertControl=this._createSelect():""},editTemplate:function(b){if(!this.editing)return this.itemTemplate(b);var e=this.editControl=this._createSelect();b!==d&&e.val(b);return e},filterValue:function(){var b=this.filterControl.val();return"number"===this.valueType?parseInt(b||0,10):b},insertValue:function(){var b=this.insertControl.val();
return"number"===this.valueType?parseInt(b||0,10):b},editValue:function(){var b=this.editControl.val();return"number"===this.valueType?parseInt(b||0,10):b},_createSelect:function(){var e=b("<select>"),d=this.valueField,f=this.textField,c=this.selectedIndex;b.each(this.items,function(r,t){var v=d?t[d]:r,y=f?t[f]:t;b("<option>").attr("value",v).text(y).appendTo(e).prop("selected",c===r)});e.prop("disabled",!!this.readOnly);return e}});c.fields.select=c.SelectField=e})(jsGrid,jQuery);
(function(c,b,d){function e(b){f.call(this,b)}var f=c.Field;e.prototype=new f({sorter:"number",align:"center",autosearch:!0,itemTemplate:function(b){return this._createCheckbox().prop({checked:b,disabled:!0})},filterTemplate:function(){if(!this.filtering)return"";var e=this._grid,d=this.filterControl=this._createCheckbox();d.prop({readOnly:!0,indeterminate:!0});d.on("click",function(){var e=b(this);e.prop("readOnly")?e.prop({checked:!1,readOnly:!1}):e.prop("checked")||e.prop({readOnly:!0,indeterminate:!0})});
if(this.autosearch)d.on("click",function(){e.search()});return d},insertTemplate:function(){return this.inserting?this.insertControl=this._createCheckbox():""},editTemplate:function(b){if(!this.editing)return this.itemTemplate(b);var e=this.editControl=this._createCheckbox();e.prop("checked",b);return e},filterValue:function(){return this.filterControl.get(0).indeterminate?d:this.filterControl.is(":checked")},insertValue:function(){return this.insertControl.is(":checked")},editValue:function(){return this.editControl.is(":checked")},
_createCheckbox:function(){return b("<input>").attr("type","checkbox")}});c.fields.checkbox=c.CheckboxField=e})(jsGrid,jQuery);
(function(c,b,d){function e(b){f.call(this,b);this._configInitialized=!1}var f=c.Field;e.prototype=new f({css:"jsgrid-control-field",align:"center",width:50,filtering:!1,inserting:!1,editing:!1,sorting:!1,buttonClass:"jsgrid-button",modeButtonClass:"jsgrid-mode-button",modeOnButtonClass:"jsgrid-mode-on-button",searchModeButtonClass:"jsgrid-search-mode-button",insertModeButtonClass:"jsgrid-insert-mode-button",editButtonClass:"jsgrid-edit-button",deleteButtonClass:"jsgrid-delete-button",searchButtonClass:"jsgrid-search-button",
clearFilterButtonClass:"jsgrid-clear-filter-button",insertButtonClass:"jsgrid-insert-button",updateButtonClass:"jsgrid-update-button",cancelEditButtonClass:"jsgrid-cancel-edit-button",searchModeButtonTooltip:"Switch to searching",insertModeButtonTooltip:"Switch to inserting",editButtonTooltip:"Edit",deleteButtonTooltip:"Delete",searchButtonTooltip:"Search",clearFilterButtonTooltip:"Clear filter",insertButtonTooltip:"Insert",updateButtonTooltip:"Update",cancelEditButtonTooltip:"Cancel edit",editButton:!0,
deleteButton:!0,clearFilterButton:!0,modeSwitchButton:!0,_initConfig:function(){this._hasFiltering=this._grid.filtering;(this._hasInserting=this._grid.inserting)&&this.modeSwitchButton&&(this._grid.inserting=!1);this._configInitialized=!0},headerTemplate:function(){this._configInitialized||this._initConfig();var b=this._hasFiltering,e=this._hasInserting;return this.modeSwitchButton&&(b||e)?b&&!e?this._createFilterSwitchButton():e&&!b?this._createInsertSwitchButton():this._createModeSwitchButton():
""},itemTemplate:function(e,d){var f=b([]);this.editButton&&(f=f.add(this._createEditButton(d)));this.deleteButton&&(f=f.add(this._createDeleteButton(d)));return f},filterTemplate:function(){var b=this._createSearchButton();return this.clearFilterButton?b.add(this._createClearFilterButton()):b},insertTemplate:function(){return this._createInsertButton()},editTemplate:function(){return this._createUpdateButton().add(this._createCancelEditButton())},_createFilterSwitchButton:function(){return this._createOnOffSwitchButton("filtering",
this.searchModeButtonClass,!0)},_createInsertSwitchButton:function(){return this._createOnOffSwitchButton("inserting",this.insertModeButtonClass,!1)},_createOnOffSwitchButton:function(e,d,f){var c=f,r=b.proxy(function(){t.toggleClass(this.modeOnButtonClass,c)},this),t=this._createGridButton(this.modeButtonClass+" "+d,"",function(b){c=!c;b.option(e,c);r()});r();return t},_createModeSwitchButton:function(){var e=!1,d=b.proxy(function(){f.attr("title",e?this.searchModeButtonTooltip:this.insertModeButtonTooltip).toggleClass(this.insertModeButtonClass,
!e).toggleClass(this.searchModeButtonClass,e)},this),f=this._createGridButton(this.modeButtonClass,"",function(b){e=!e;b.option("inserting",e);b.option("filtering",!e);d()});d();return f},_createEditButton:function(b){return this._createGridButton(this.editButtonClass,this.editButtonTooltip,function(e,d){e.editItem(b);d.stopPropagation()})},_createDeleteButton:function(b){return this._createGridButton(this.deleteButtonClass,this.deleteButtonTooltip,function(e,d){e.deleteItem(b);d.stopPropagation()})},
_createSearchButton:function(){return this._createGridButton(this.searchButtonClass,this.searchButtonTooltip,function(b){b.search()})},_createClearFilterButton:function(){return this._createGridButton(this.clearFilterButtonClass,this.clearFilterButtonTooltip,function(b){b.clearFilter()})},_createInsertButton:function(){return this._createGridButton(this.insertButtonClass,this.insertButtonTooltip,function(b){b.insertItem().done(function(){b.clearInsert()})})},_createUpdateButton:function(){return this._createGridButton(this.updateButtonClass,
this.updateButtonTooltip,function(b,e){b.updateItem();e.stopPropagation()})},_createCancelEditButton:function(){return this._createGridButton(this.cancelEditButtonClass,this.cancelEditButtonTooltip,function(b,e){b.cancelEdit();e.stopPropagation()})},_createGridButton:function(e,d,f){var c=this._grid;return b("<input>").addClass(this.buttonClass).addClass(e).attr({type:"button",title:d}).on("click",function(b){f(c,b)})},editValue:function(){return""}});c.fields.control=c.ControlField=e})(jsGrid,jQuery);
Array.prototype.filter||(Array.prototype.filter=function(c){for(var b=this.length,d=Array(b),e=0,f=0;f<b;++f){var g=this[f];c(g,f,this)&&(d[e++]=g)}d.length=e;return d});Array.prototype.some||(Array.prototype.some=function(c){for(var b=this.length,d=0;d<b;++d)if(c(this[d],d,this))return!0;return!1});Array.prototype.every||(Array.prototype.every=function(c){return!this.some(function(b,d,e){return!c(b,d,e)})});
Array.prototype.remove||(Array.prototype.remove=function(c,b){if(!b){if(!c)return[];b=this.length}return this.filter(function(d,e,f){return e<c||e>=b})});Array.prototype.forEach||(Array.prototype.forEach=function(c){for(var b=this.length,d=0;d<b;++d)c(this[d],d,this)});Array.prototype.indexOf||(Array.prototype.indexOf=function(c,b){for(var d=this.length,e=0;e<d;++e)if(this[e]===c)return e;return-1});Array.prototype.contains||(Array.prototype.contains=function(c,b){return 0<=this.indexOf(c)});
Array.prototype.map||(Array.prototype.map=function(c){for(var b=this.length,d=Array(b),e=0;e<b;++e)d[e]=c(this[e],e,this);return d});Array.prototype.reduce||(Array.prototype.reduce=function(c,b){for(var d=this.length,e=0;e<d;++e)b=c(b,this[e],e,this);return b});var oldBrowser=document.all&&!document.addEventListener;
oldBrowser||function(c,b){function d(b){var e=Ia[b]={};B.each(b.split(ja),function(b,d){e[d]=!0});return e}function e(e,d,f){if(f===b&&1===e.nodeType)if(f="data-"+d.replace(bb,"-$1").toLowerCase(),f=e.getAttribute(f),"string"===typeof f){try{f="true"===f?!0:"false"===f?!1:"null"===f?null:+f+""===f?+f:cb.test(f)?B.parseJSON(f):f}catch(c){}B.data(e,d,f)}else f=b;return f}function f(b){for(var e in b)if(("data"!==e||!B.isEmptyObject(b[e]))&&"toJSON"!==e)return!1;return!0}function g(){return!1}function h(){return!0}
function l(b){return!b||!b.parentNode||11===b.parentNode.nodeType}function q(b,e){do b=b[e];while(b&&1!==b.nodeType);return b}function r(b,e,d){e=e||0;if(B.isFunction(e))return B.grep(b,function(b,f){return!!e.call(b,f,b)===d});if(e.nodeType)return B.grep(b,function(b,f){return b===e===d});if("string"===typeof e){var f=B.grep(b,function(b){return 1===b.nodeType});if(db.test(e))return B.filter(e,f,!d);e=B.filter(e,f)}return B.grep(b,function(b,f){return 0<=B.inArray(b,e)===d})}function t(b){var e=
Ja.split("|");b=b.createDocumentFragment();if(b.createElement)for(;e.length;)b.createElement(e.pop());return b}function v(b,e){return b.getElementsByTagName(e)[0]||b.appendChild(b.ownerDocument.createElement(e))}function y(b,e){if(1===e.nodeType&&B.hasData(b)){var d,f,c;f=B._data(b);var g=B._data(e,f),h=f.events;if(h)for(d in delete g.handle,g.events={},h)for(f=0,c=h[d].length;f<c;f++)B.event.add(e,d,h[d][f]);g.data&&(g.data=B.extend({},g.data))}}function A(b,e){var d;1===e.nodeType&&(e.clearAttributes&&
e.clearAttributes(),e.mergeAttributes&&e.mergeAttributes(b),d=e.nodeName.toLowerCase(),"object"===d?(e.parentNode&&(e.outerHTML=b.outerHTML),B.support.html5Clone&&b.innerHTML&&!B.trim(e.innerHTML)&&(e.innerHTML=b.innerHTML)):"input"===d&&Ka.test(b.type)?(e.defaultChecked=e.checked=b.checked,e.value!==b.value&&(e.value=b.value)):"option"===d?e.selected=b.defaultSelected:"input"===d||"textarea"===d?e.defaultValue=b.defaultValue:"script"===d&&e.text!==b.text&&(e.text=b.text),e.removeAttribute(B.expando))}
function w(b){return"undefined"!==typeof b.getElementsByTagName?b.getElementsByTagName("*"):"undefined"!==typeof b.querySelectorAll?b.querySelectorAll("*"):[]}function z(b){Ka.test(b.type)&&(b.defaultChecked=b.checked)}function C(b,e){if(e in b)return e;for(var d=e.charAt(0).toUpperCase()+e.slice(1),f=e,c=La.length;c--;)if(e=La[c]+d,e in b)return e;return f}function D(b,e){b=e||b;return"none"===B.css(b,"display")||!B.contains(b.ownerDocument,b)}function E(b,e){for(var d,f,c=[],g=0,h=b.length;g<h;g++)d=
b[g],d.style&&(c[g]=B._data(d,"olddisplay"),e?(c[g]||"none"!==d.style.display||(d.style.display=""),""===d.style.display&&D(d)&&(c[g]=B._data(d,"olddisplay",M(d.nodeName)))):(f=ea(d,"display"),c[g]||"none"===f||B._data(d,"olddisplay",f)));for(g=0;g<h;g++)d=b[g],!d.style||e&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=e?c[g]||"":"none");return b}function F(b,e,d){return(b=eb.exec(e))?Math.max(0,b[1]-(d||0))+(b[2]||"px"):e}function G(b,e,d,f){e=d===(f?"border":"content")?4:"width"===
e?1:0;for(var c=0;4>e;e+=2)"margin"===d&&(c+=B.css(b,d+ma[e],!0)),f?("content"===d&&(c-=parseFloat(ea(b,"padding"+ma[e]))||0),"margin"!==d&&(c-=parseFloat(ea(b,"border"+ma[e]+"Width"))||0)):(c+=parseFloat(ea(b,"padding"+ma[e]))||0,"padding"!==d&&(c+=parseFloat(ea(b,"border"+ma[e]+"Width"))||0));return c}function I(b,e,d){var f="width"===e?b.offsetWidth:b.offsetHeight,c=!0,g=B.support.boxSizing&&"border-box"===B.css(b,"boxSizing");if(0>=f||null==f){f=ea(b,e);if(0>f||null==f)f=b.style[e];if(ua.test(f))return f;
c=g&&(B.support.boxSizingReliable||f===b.style[e]);f=parseFloat(f)||0}return f+G(b,e,d||(g?"border":"content"),c)+"px"}function M(b){if(za[b])return za[b];var e=B("<"+b+">").appendTo(J.body),d=e.css("display");e.remove();if("none"===d||""===d)oa=J.body.appendChild(oa||B.extend(J.createElement("iframe"),{frameBorder:0,width:0,height:0})),pa&&oa.createElement||(pa=(oa.contentWindow||oa.contentDocument).document,pa.write("<!doctype html><html><body>"),pa.close()),e=pa.body.appendChild(pa.createElement(b)),
d=ea(e,"display"),J.body.removeChild(oa);return za[b]=d}function O(b,e,d,f){var c;if(B.isArray(e))B.each(e,function(e,c){d||fb.test(b)?f(b,c):O(b+"["+("object"===typeof c?e:"")+"]",c,d,f)});else if(d||"object"!==B.type(e))f(b,e);else for(c in e)O(b+"["+c+"]",e[c],d,f)}function K(){setTimeout(function(){qa=b},0);return qa=B.now()}function Q(b,e){B.each(e,function(e,d){for(var f=(sa[e]||[]).concat(sa["*"]),c=0,g=f.length;c<g&&!f[c].call(b,e,d);c++);})}function U(b,e,d){var f=0,c=va.length,g=B.Deferred().always(function(){delete h.elem}),
h=function(){for(var e=qa||K(),e=Math.max(0,l.startTime+l.duration-e),d=1-(e/l.duration||0),f=0,c=l.tweens.length;f<c;f++)l.tweens[f].run(d);g.notifyWith(b,[l,d,e]);if(1>d&&c)return e;g.resolveWith(b,[l]);return!1},l=g.promise({elem:b,props:B.extend({},e),opts:B.extend(!0,{specialEasing:{}},d),originalProperties:e,originalOptions:d,startTime:qa||K(),duration:d.duration,tweens:[],createTween:function(e,d,f){e=B.Tween(b,l.opts,e,d,l.opts.specialEasing[e]||l.opts.easing);l.tweens.push(e);return e},stop:function(e){for(var d=
0,f=e?l.tweens.length:0;d<f;d++)l.tweens[d].run(1);e?g.resolveWith(b,[l,e]):g.rejectWith(b,[l,e]);return this}});d=l.props;for(X(d,l.opts.specialEasing);f<c;f++)if(e=va[f].call(l,b,d,l.opts))return e;Q(l,d);B.isFunction(l.opts.start)&&l.opts.start.call(b,l);B.fx.timer(B.extend(h,{anim:l,queue:l.opts.queue,elem:b}));return l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function X(b,e){var d,f,c,g,h;for(d in b)if(f=B.camelCase(d),c=e[f],g=b[d],
B.isArray(g)&&(c=g[1],g=b[d]=g[0]),d!==f&&(b[f]=g,delete b[d]),(h=B.cssHooks[f])&&"expand"in h)for(d in g=h.expand(g),delete b[f],g)d in b||(b[d]=g[d],e[d]=c);else e[f]=c}function N(b,e,d,f,c){return new N.prototype.init(b,e,d,f,c)}function V(b,e){var d,f={height:b},c=0;for(e=e?1:0;4>c;c+=2-e)d=ma[c],f["margin"+d]=f["padding"+d]=b;e&&(f.opacity=f.width=b);return f}function T(b){return B.isWindow(b)?b:9===b.nodeType?b.defaultView||b.parentWindow:!1}var R,H,J=c.document,P=c.navigator,L=c.JQXLite,Y=
c.$,aa=Array.prototype.push,ba=Array.prototype.slice,ca=Array.prototype.indexOf,ka=Object.prototype.toString,fa=Object.prototype.hasOwnProperty,ha=String.prototype.trim,B=function(b,e){return new B.fn.init(b,e,R)},da=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,S=/\S/,ja=/\s+/,W=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,Z=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,wa=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ta=/^[\],:{}\s]*$/,Aa=/(?:^|:|,)(?:\s*\[)+/g,Ba=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,la=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,
Ca=/^-ms-/,ra=/-([\da-z])/gi,Da=function(b,e){return(e+"").toUpperCase()},na=function(){J.addEventListener?(J.removeEventListener("DOMContentLoaded",na,!1),B.ready()):"complete"===J.readyState&&(J.detachEvent("onreadystatechange",na),B.ready())},xa={};B.fn=B.prototype={constructor:B,init:function(e,d,f){var c;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if("string"===typeof e){c="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&3<=e.length?[null,e,null]:Z.exec(e);
if(!c||!c[1]&&d)return!d||d.jqx?(d||f).find(e):this.constructor(d).find(e);if(c[1])return e=(d=d instanceof B?d[0]:d)&&d.nodeType?d.ownerDocument||d:J,e=B.parseHTML(c[1],e,!0),wa.test(c[1])&&B.isPlainObject(d)&&this.attr.call(e,d,!0),B.merge(this,e);if((d=J.getElementById(c[2]))&&d.parentNode){if(d.id!==c[2])return f.find(e);this.length=1;this[0]=d}this.context=J;this.selector=e;return this}if(B.isFunction(e))return f.ready(e);e.selector!==b&&(this.selector=e.selector,this.context=e.context);return B.makeArray(e,
this)},selector:"",jqx:"4.5.0",length:0,size:function(){return this.length},toArray:function(){return ba.call(this)},get:function(b){return null==b?this.toArray():0>b?this[this.length+b]:this[b]},pushStack:function(b,e,d){b=B.merge(this.constructor(),b);b.prevObject=this;b.context=this.context;"find"===e?b.selector=this.selector+(this.selector?" ":"")+d:e&&(b.selector=this.selector+"."+e+"("+d+")");return b},each:function(b,e){return B.each(this,b,e)},ready:function(b){B.ready.promise().done(b);return this},
eq:function(b){b=+b;return-1===b?this.slice(b):this.slice(b,b+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(ba.apply(this,arguments),"slice",ba.call(arguments).join(","))},map:function(b){return this.pushStack(B.map(this,function(e,d){return b.call(e,d,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:aa,sort:[].sort,splice:[].splice};B.fn.init.prototype=B.fn;B.extend=B.fn.extend=function(){var e,d,f,c,g,
h=arguments[0]||{},l=1,q=arguments.length,w=!1;"boolean"===typeof h&&(w=h,h=arguments[1]||{},l=2);"object"===typeof h||B.isFunction(h)||(h={});q===l&&(h=this,--l);for(;l<q;l++)if(null!=(e=arguments[l]))for(d in e)f=h[d],c=e[d],h!==c&&(w&&c&&(B.isPlainObject(c)||(g=B.isArray(c)))?(g?(g=!1,f=f&&B.isArray(f)?f:[]):f=f&&B.isPlainObject(f)?f:{},h[d]=B.extend(w,f,c)):c!==b&&(h[d]=c));return h};B.extend({noConflict:function(b){c.$===B&&(c.$=Y);b&&c.JQXLite===B&&(c.JQXLite=L);return B},isReady:!1,readyWait:1,
holdReady:function(b){b?B.readyWait++:B.ready(!0)},ready:function(b){if(!0===b?!--B.readyWait:!B.isReady){if(!J.body)return setTimeout(B.ready,1);B.isReady=!0;!0!==b&&0<--B.readyWait||(H.resolveWith(J,[B]),B.fn.trigger&&B(J).trigger("ready").off("ready"))}},isFunction:function(b){return"function"===B.type(b)},isArray:Array.isArray||function(b){return"array"===B.type(b)},isWindow:function(b){return null!=b&&b==b.window},isNumeric:function(b){return!isNaN(parseFloat(b))&&isFinite(b)},type:function(b){return null==
b?String(b):xa[ka.call(b)]||"object"},isPlainObject:function(e){if(!e||"object"!==B.type(e)||e.nodeType||B.isWindow(e))return!1;try{if(e.constructor&&!fa.call(e,"constructor")&&!fa.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(d){return!1}for(var f in e);return f===b||fa.call(e,f)},isEmptyObject:function(b){for(var e in b)return!1;return!0},error:function(b){throw Error(b);},parseHTML:function(b,e,d){var f;if(!b||"string"!==typeof b)return null;"boolean"===typeof e&&(d=e,e=0);e=e||
J;if(f=wa.exec(b))return[e.createElement(f[1])];f=B.buildFragment([b],e,d?null:[]);return B.merge([],(f.cacheable?B.clone(f.fragment):f.fragment).childNodes)},parseJSON:function(b){if(!b||"string"!==typeof b)return null;b=B.trim(b);if(c.JSON&&c.JSON.parse)return c.JSON.parse(b);if(ta.test(b.replace(Ba,"@").replace(la,"]").replace(Aa,"")))return(new Function("return "+b))();B.error("Invalid JSON: "+b)},parseXML:function(e){var d,f;if(!e||"string"!==typeof e)return null;try{c.DOMParser?(f=new DOMParser,
d=f.parseFromString(e,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(e))}catch(g){d=b}d&&d.documentElement&&!d.getElementsByTagName("parsererror").length||B.error("Invalid XML: "+e);return d},noop:function(){},globalEval:function(b){b&&S.test(b)&&(c.execScript||function(b){c.eval.call(c,b)})(b)},camelCase:function(b){return b.replace(Ca,"ms-").replace(ra,Da)},nodeName:function(b,e){return b.nodeName&&b.nodeName.toLowerCase()===e.toLowerCase()},each:function(e,d,f){var c,
g=0,h=e.length,l=h===b||B.isFunction(e);if(f)if(l)for(c in e){if(!1===d.apply(e[c],f))break}else for(;g<h&&!1!==d.apply(e[g++],f););else if(l)for(c in e){if(!1===d.call(e[c],c,e[c]))break}else for(;g<h&&!1!==d.call(e[g],g,e[g++]););return e},trim:ha&&!ha.call("\ufeff\u00a0")?function(b){return null==b?"":ha.call(b)}:function(b){return null==b?"":(b+"").replace(W,"")},makeArray:function(b,e){var d,f=e||[];null!=b&&(d=B.type(b),null==b.length||"string"===d||"function"===d||"regexp"===d||B.isWindow(b)?
aa.call(f,b):B.merge(f,b));return f},inArray:function(b,e,d){var f;if(e){if(ca)return ca.call(e,b,d);f=e.length;for(d=d?0>d?Math.max(0,f+d):d:0;d<f;d++)if(d in e&&e[d]===b)return d}return-1},merge:function(e,d){var f=d.length,c=e.length,g=0;if("number"===typeof f)for(;g<f;g++)e[c++]=d[g];else for(;d[g]!==b;)e[c++]=d[g++];e.length=c;return e},grep:function(b,e,d){var f,c=[],g=0,h=b.length;for(d=!!d;g<h;g++)f=!!e(b[g],g),d!==f&&c.push(b[g]);return c},map:function(e,d,f){var c,g,h=[],l=0,q=e.length;
if(e instanceof B||q!==b&&"number"===typeof q&&(0<q&&e[0]&&e[q-1]||0===q||B.isArray(e)))for(;l<q;l++)c=d(e[l],l,f),null!=c&&(h[h.length]=c);else for(g in e)c=d(e[g],g,f),null!=c&&(h[h.length]=c);return h.concat.apply([],h)},guid:1,proxy:function(e,d){var f,c;"string"===typeof d&&(f=e[d],d=e,e=f);if(!B.isFunction(e))return b;c=ba.call(arguments,2);f=function(){return e.apply(d,c.concat(ba.call(arguments)))};f.guid=e.guid=e.guid||B.guid++;return f},access:function(e,d,f,c,g,h,l){var q,w=null==f,z=0,
r=e.length;if(f&&"object"===typeof f){for(z in f)B.access(e,d,z,f[z],1,h,c);g=1}else if(c!==b){q=l===b&&B.isFunction(c);w&&(q?(q=d,d=function(b,e,d){return q.call(B(b),d)}):(d.call(e,c),d=null));if(d)for(;z<r;z++)d(e[z],f,q?c.call(e[z],z,d(e[z],f)):c,l);g=1}return g?e:w?d.call(e):r?d(e[0],f):h},now:function(){return(new Date).getTime()}});B.ready.promise=function(b){if(!H)if(H=B.Deferred(),"complete"===J.readyState)setTimeout(B.ready,1);else if(J.addEventListener)J.addEventListener("DOMContentLoaded",
na,!1),c.addEventListener("load",B.ready,!1);else{J.attachEvent("onreadystatechange",na);c.attachEvent("onload",B.ready);var e=!1;try{e=null==c.frameElement&&J.documentElement}catch(d){}e&&e.doScroll&&function ab(){if(!B.isReady){try{e.doScroll("left")}catch(b){return setTimeout(ab,50)}B.ready()}}()}return H.promise(b)};B.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(b,e){xa["[object "+e+"]"]=e.toLowerCase()});R=B(J);var Ia={};B.Callbacks=function(e){e="string"===
typeof e?Ia[e]||d(e):B.extend({},e);var f,c,g,h,l,q,w=[],z=!e.once&&[],r=function(b){f=e.memory&&b;c=!0;q=h||0;h=0;l=w.length;for(g=!0;w&&q<l;q++)if(!1===w[q].apply(b[0],b[1])&&e.stopOnFalse){f=!1;break}g=!1;w&&(z?z.length&&r(z.shift()):f?w=[]:t.disable())},t={add:function(){if(w){var b=w.length;(function gb(b){B.each(b,function(b,d){var f=B.type(d);"function"===f?e.unique&&t.has(d)||w.push(d):d&&d.length&&"string"!==f&&gb(d)})})(arguments);g?l=w.length:f&&(h=b,r(f))}return this},remove:function(){w&&
B.each(arguments,function(b,e){for(var d;-1<(d=B.inArray(e,w,d));)w.splice(d,1),g&&(d<=l&&l--,d<=q&&q--)});return this},has:function(b){return-1<B.inArray(b,w)},empty:function(){w=[];return this},disable:function(){w=z=f=b;return this},disabled:function(){return!w},lock:function(){z=b;f||t.disable();return this},locked:function(){return!z},fireWith:function(b,e){e=e||[];e=[b,e.slice?e.slice():e];!w||c&&!z||(g?z.push(e):r(e));return this},fire:function(){t.fireWith(this,arguments);return this},fired:function(){return!!c}};
return t};B.extend({Deferred:function(b){var e=[["resolve","done",B.Callbacks("once memory"),"resolved"],["reject","fail",B.Callbacks("once memory"),"rejected"],["notify","progress",B.Callbacks("memory")]],d="pending",f={state:function(){return d},always:function(){c.done(arguments).fail(arguments);return this},then:function(){var b=arguments;return B.Deferred(function(d){B.each(e,function(e,f){var g=f[0],h=b[e];c[f[1]](B.isFunction(h)?function(){var b=h.apply(this,arguments);if(b&&B.isFunction(b.promise))b.promise().done(d.resolve).fail(d.reject).progress(d.notify);
else d[g+"With"](this===c?d:this,[b])}:d[g])});b=null}).promise()},promise:function(b){return null!=b?B.extend(b,f):f}},c={};f.pipe=f.then;B.each(e,function(b,g){var h=g[2],l=g[3];f[g[1]]=h.add;l&&h.add(function(){d=l},e[b^1][2].disable,e[2][2].lock);c[g[0]]=h.fire;c[g[0]+"With"]=h.fireWith});f.promise(c);b&&b.call(c,c);return c},when:function(b){var e=0,d=ba.call(arguments),f=d.length,c=1!==f||b&&B.isFunction(b.promise)?f:0,g=1===c?b:B.Deferred(),h=function(b,e,d){return function(f){e[b]=this;d[b]=
1<arguments.length?ba.call(arguments):f;d===l?g.notifyWith(e,d):--c||g.resolveWith(e,d)}},l,q,w;if(1<f)for(l=Array(f),q=Array(f),w=Array(f);e<f;e++)d[e]&&B.isFunction(d[e].promise)?d[e].promise().done(h(e,w,d)).fail(g.reject).progress(h(e,q,l)):--c;c||g.resolveWith(w,d);return g.promise()}});B.support=function(){var b,e,d,f,g,h,l,q=J.createElement("div");q.setAttribute("className","t");q.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";e=q.getElementsByTagName("*");d=
q.getElementsByTagName("a")[0];if(!e||!d||!e.length)return{};f=J.createElement("select");g=f.appendChild(J.createElement("option"));e=q.getElementsByTagName("input")[0];d.style.cssText="top:1px;float:left;opacity:.5";b={leadingWhitespace:3===q.firstChild.nodeType,tbody:!q.getElementsByTagName("tbody").length,htmlSerialize:!!q.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:"/a"===d.getAttribute("href"),opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,
checkOn:"on"===e.value,optSelected:g.selected,getSetAttribute:"t"!==q.className,enctype:!!J.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==J.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===J.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1};e.checked=!0;b.noCloneChecked=e.cloneNode(!0).checked;f.disabled=!0;b.optDisabled=
!g.disabled;try{delete q.test}catch(w){b.deleteExpando=!1}!q.addEventListener&&q.attachEvent&&q.fireEvent&&(q.attachEvent("onclick",d=function(){b.noCloneEvent=!1}),q.cloneNode(!0).fireEvent("onclick"),q.detachEvent("onclick",d));e=J.createElement("input");e.value="t";e.setAttribute("type","radio");b.radioValue="t"===e.value;e.setAttribute("checked","checked");e.setAttribute("name","t");q.appendChild(e);d=J.createDocumentFragment();d.appendChild(q.lastChild);b.checkClone=d.cloneNode(!0).cloneNode(!0).lastChild.checked;
b.appendChecked=e.checked;d.removeChild(e);d.appendChild(q);if(q.attachEvent)for(h in{submit:!0,change:!0,focusin:!0})e="on"+h,l=e in q,l||(q.setAttribute(e,"return;"),l="function"===typeof q[e]),b[h+"Bubbles"]=l;B(function(){var e,d,f,g=J.getElementsByTagName("body")[0];g&&(e=J.createElement("div"),e.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",g.insertBefore(e,g.firstChild),d=J.createElement("div"),e.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",
f=d.getElementsByTagName("td"),f[0].style.cssText="padding:0;margin:0;border:0;display:none",l=0===f[0].offsetHeight,f[0].style.display="",f[1].style.display="none",b.reliableHiddenOffsets=l&&0===f[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",b.boxSizing=4===d.offsetWidth,b.doesNotIncludeMarginInBodyOffset=1!==g.offsetTop,c.getComputedStyle&&
(b.pixelPosition="1%"!==(c.getComputedStyle(d,null)||{}).top,b.boxSizingReliable="4px"===(c.getComputedStyle(d,null)||{width:"4px"}).width,f=J.createElement("div"),f.style.cssText=d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;",f.style.marginRight=f.style.width="0",d.style.width="1px",d.appendChild(f),b.reliableMarginRight=!parseFloat((c.getComputedStyle(f,null)||{}).marginRight)),"undefined"!==typeof d.style.zoom&&(d.innerHTML="",d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;width:1px;padding:1px;display:inline;zoom:1",
b.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",b.shrinkWrapBlocks=3!==d.offsetWidth,e.style.zoom=1),g.removeChild(e))});d.removeChild(q);e=d=f=g=e=d=q=null;return b}();var cb=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,bb=/([A-Z])/g;B.extend({cache:{},deletedIds:[],uuid:0,expando:"JQXLite"+(B.fn.jqx+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},
hasData:function(b){b=b.nodeType?B.cache[b[B.expando]]:b[B.expando];return!!b&&!f(b)},data:function(e,d,f,c){if(B.acceptData(e)){var g=B.expando,h="string"===typeof d,l=e.nodeType,q=l?B.cache:e,w=l?e[g]:e[g]&&g;if(w&&q[w]&&(c||q[w].data)||!h||f!==b){w||(l?e[g]=w=B.deletedIds.pop()||B.guid++:w=g);q[w]||(q[w]={},l||(q[w].toJSON=B.noop));if("object"===typeof d||"function"===typeof d)c?q[w]=B.extend(q[w],d):q[w].data=B.extend(q[w].data,d);e=q[w];c||(e.data||(e.data={}),e=e.data);f!==b&&(e[B.camelCase(d)]=
f);h?(f=e[d],null==f&&(f=e[B.camelCase(d)])):f=e;return f}}},removeData:function(b,e,d){if(B.acceptData(b)){var c,g,h,l=b.nodeType,q=l?B.cache:b,w=l?b[B.expando]:B.expando;if(q[w]){if(e&&(c=d?q[w]:q[w].data)){B.isArray(e)||(e in c?e=[e]:(e=B.camelCase(e),e=e in c?[e]:e.split(" ")));g=0;for(h=e.length;g<h;g++)delete c[e[g]];if(!(d?f:B.isEmptyObject)(c))return}if(!d&&(delete q[w].data,!f(q[w])))return;l?B.cleanData([b],!0):B.support.deleteExpando||q!=q.window?delete q[w]:q[w]=null}}},_data:function(b,
e,d){return B.data(b,e,d,!0)},acceptData:function(b){var e=b.nodeName&&B.noData[b.nodeName.toLowerCase()];return!e||!0!==e&&b.getAttribute("classid")===e}});B.fn.extend({data:function(d,f){var c,g,h,l,q,w=this[0],z=0,r=null;if(d===b){if(this.length&&(r=B.data(w),1===w.nodeType&&!B._data(w,"parsedAttrs"))){h=w.attributes;for(q=h.length;z<q;z++)l=h[z].name,l.indexOf("data-")||(l=B.camelCase(l.substring(5)),e(w,l,r[l]));B._data(w,"parsedAttrs",!0)}return r}if("object"===typeof d)return this.each(function(){B.data(this,
d)});c=d.split(".",2);c[1]=c[1]?"."+c[1]:"";g=c[1]+"!";return B.access(this,function(f){if(f===b)return r=this.triggerHandler("getData"+g,[c[0]]),r===b&&w&&(r=B.data(w,d),r=e(w,d,r)),r===b&&c[1]?this.data(c[0]):r;c[1]=f;this.each(function(){var b=B(this);b.triggerHandler("setData"+g,c);B.data(this,d,f);b.triggerHandler("changeData"+g,c)})},null,f,1<arguments.length,null,!1)},removeData:function(b){return this.each(function(){B.removeData(this,b)})}});B.extend({queue:function(b,e,d){var f;if(b)return e=
(e||"fx")+"queue",f=B._data(b,e),d&&(!f||B.isArray(d)?f=B._data(b,e,B.makeArray(d)):f.push(d)),f||[]},dequeue:function(b,e){e=e||"fx";var d=B.queue(b,e),f=d.length,c=d.shift(),g=B._queueHooks(b,e),h=function(){B.dequeue(b,e)};"inprogress"===c&&(c=d.shift(),f--);c&&("fx"===e&&d.unshift("inprogress"),delete g.stop,c.call(b,h,g));!f&&g&&g.empty.fire()},_queueHooks:function(b,e){var d=e+"queueHooks";return B._data(b,d)||B._data(b,d,{empty:B.Callbacks("once memory").add(function(){B.removeData(b,e+"queue",
!0);B.removeData(b,d,!0)})})}});B.fn.extend({queue:function(e,d){var f=2;"string"!==typeof e&&(d=e,e="fx",f--);return arguments.length<f?B.queue(this[0],e):d===b?this:this.each(function(){var b=B.queue(this,e,d);B._queueHooks(this,e);"fx"===e&&"inprogress"!==b[0]&&B.dequeue(this,e)})},dequeue:function(b){return this.each(function(){B.dequeue(this,b)})},delay:function(b,e){b=B.fx?B.fx.speeds[b]||b:b;return this.queue(e||"fx",function(e,d){var f=setTimeout(e,b);d.stop=function(){clearTimeout(f)}})},
clearQueue:function(b){return this.queue(b||"fx",[])},promise:function(e,d){var f,c=1,g=B.Deferred(),h=this,l=this.length,q=function(){--c||g.resolveWith(h,[h])};"string"!==typeof e&&(d=e,e=b);for(e=e||"fx";l--;)(f=B._data(h[l],e+"queueHooks"))&&f.empty&&(c++,f.empty.add(q));q();return g.promise(d)}});var Ma,Na=/[\t\r\n]/g,hb=/\r/g,ib=/^(?:button|input)$/i,jb=/^(?:button|input|object|select|textarea)$/i,kb=/^a(?:rea|)$/i,Oa=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,
lb=B.support.getSetAttribute;B.fn.extend({attr:function(b,e){return B.access(this,B.attr,b,e,1<arguments.length)},removeAttr:function(b){return this.each(function(){B.removeAttr(this,b)})},prop:function(b,e){return B.access(this,B.prop,b,e,1<arguments.length)},removeProp:function(e){e=B.propFix[e]||e;return this.each(function(){try{this[e]=b,delete this[e]}catch(d){}})},addClass:function(b){var e,d,f,c,g,h,l;if(B.isFunction(b))return this.each(function(e){B(this).addClass(b.call(this,e,this.className))});
if(b&&"string"===typeof b)for(e=b.split(ja),d=0,f=this.length;d<f;d++)if(c=this[d],1===c.nodeType)if(c.className||1!==e.length){g=" "+c.className+" ";h=0;for(l=e.length;h<l;h++)0>g.indexOf(" "+e[h]+" ")&&(g+=e[h]+" ");c.className=B.trim(g)}else c.className=b;return this},removeClass:function(e){var d,f,c,g,h,l,q;if(B.isFunction(e))return this.each(function(b){B(this).removeClass(e.call(this,b,this.className))});if(e&&"string"===typeof e||e===b)for(d=(e||"").split(ja),l=0,q=this.length;l<q;l++)if(c=
this[l],1===c.nodeType&&c.className){f=(" "+c.className+" ").replace(Na," ");g=0;for(h=d.length;g<h;g++)for(;0<=f.indexOf(" "+d[g]+" ");)f=f.replace(" "+d[g]+" "," ");c.className=e?B.trim(f):""}return this},toggleClass:function(b,e){var d=typeof b,f="boolean"===typeof e;return B.isFunction(b)?this.each(function(d){B(this).toggleClass(b.call(this,d,this.className,e),e)}):this.each(function(){if("string"===d)for(var c,g=0,h=B(this),l=e,q=b.split(ja);c=q[g++];)l=f?l:!h.hasClass(c),h[l?"addClass":"removeClass"](c);
else if("undefined"===d||"boolean"===d)this.className&&B._data(this,"__className__",this.className),this.className=this.className||!1===b?"":B._data(this,"__className__")||""})},hasClass:function(b){b=" "+b+" ";for(var e=0,d=this.length;e<d;e++)if(1===this[e].nodeType&&0<=(" "+this[e].className+" ").replace(Na," ").indexOf(b))return!0;return!1},val:function(e){var d,f,c,g=this[0];if(arguments.length)return c=B.isFunction(e),this.each(function(f){var g=B(this);1===this.nodeType&&(f=c?e.call(this,f,
g.val()):e,null==f?f="":"number"===typeof f?f+="":B.isArray(f)&&(f=B.map(f,function(b){return null==b?"":b+""})),d=B.valHooks[this.type]||B.valHooks[this.nodeName.toLowerCase()],d&&"set"in d&&d.set(this,f,"value")!==b||(this.value=f))});if(g){if((d=B.valHooks[g.type]||B.valHooks[g.nodeName.toLowerCase()])&&"get"in d&&(f=d.get(g,"value"))!==b)return f;f=g.value;return"string"===typeof f?f.replace(hb,""):null==f?"":f}}});B.extend({valHooks:{option:{get:function(b){var e=b.attributes.value;return!e||
e.specified?b.value:b.text}},select:{get:function(b){for(var e,d=b.options,f=b.selectedIndex,c=(b="select-one"===b.type||0>f)?null:[],g=b?f+1:d.length,h=0>f?g:b?f:0;h<g;h++)if(e=d[h],!(!e.selected&&h!==f||(B.support.optDisabled?e.disabled:null!==e.getAttribute("disabled"))||e.parentNode.disabled&&B.nodeName(e.parentNode,"optgroup"))){e=B(e).val();if(b)return e;c.push(e)}return c},set:function(b,e){var d=B.makeArray(e);B(b).find("option").each(function(){this.selected=0<=B.inArray(B(this).val(),d)});
d.length||(b.selectedIndex=-1);return d}}},attrFn:{},attr:function(e,d,f,c){var g,h,l=e.nodeType;if(e&&3!==l&&8!==l&&2!==l){if(c&&B.isFunction(B.fn[d]))return B(e)[d](f);if("undefined"===typeof e.getAttribute)return B.prop(e,d,f);if(c=1!==l||!B.isXMLDoc(e))d=d.toLowerCase(),h=B.attrHooks[d]||(Oa.test(d)?Ma:void 0);if(f!==b)if(null===f)B.removeAttr(e,d);else{if(h&&"set"in h&&c&&(g=h.set(e,f,d))!==b)return g;e.setAttribute(d,f+"");return f}else{if(h&&"get"in h&&c&&null!==(g=h.get(e,d)))return g;g=e.getAttribute(d);
return null===g?b:g}}},removeAttr:function(b,e){var d,f,c,g,h=0;if(e&&1===b.nodeType)for(f=e.split(ja);h<f.length;h++)if(c=f[h])d=B.propFix[c]||c,(g=Oa.test(c))||B.attr(b,c,""),b.removeAttribute(lb?c:d),g&&d in b&&(b[d]=!1)},attrHooks:{type:{set:function(b,e){if(ib.test(b.nodeName)&&b.parentNode)B.error("type property can't be changed");else if(!B.support.radioValue&&"radio"===e&&B.nodeName(b,"input")){var d=b.value;b.setAttribute("type",e);d&&(b.value=d);return e}}},value:{get:function(b,e){return e in
b?b.value:null},set:function(b,e,d){b.value=e}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,d,f){var c,g,h;h=e.nodeType;if(e&&3!==h&&8!==h&&2!==h){if(h=1!==h||!B.isXMLDoc(e))d=B.propFix[d]||d,g=B.propHooks[d];return f!==b?g&&"set"in g&&(c=g.set(e,f,d))!==b?
c:e[d]=f:g&&"get"in g&&null!==(c=g.get(e,d))?c:e[d]}},propHooks:{tabIndex:{get:function(e){var d=e.getAttributeNode("tabindex");return d&&d.specified?parseInt(d.value,10):jb.test(e.nodeName)||kb.test(e.nodeName)&&e.href?0:b}}}});Ma={get:function(e,d){var f,c=B.prop(e,d);return!0===c||"boolean"!==typeof c&&(f=e.getAttributeNode(d))&&!1!==f.nodeValue?d.toLowerCase():b},set:function(b,e,d){!1===e?B.removeAttr(b,d):(e=B.propFix[d]||d,e in b&&(b[e]=!0),b.setAttribute(d,d.toLowerCase()));return d}};B.support.enctype||
(B.propFix.enctype="encoding");var Pa=/^([^\.]*|)(?:\.(.+)|)$/,mb=/(?:^|\s)hover(\.\S+|)\b/,nb=/^key/,ob=/^(?:mouse|contextmenu)|click/,Qa=/^(?:focusinfocus|focusoutblur)$/,Ra=function(b){return B.event.special.hover?b:b.replace(mb,"mouseenter$1 mouseleave$1")};B.event={add:function(e,d,f,c,g){var h,l,q,w,z,r,t,C,D;if(3!==e.nodeType&&8!==e.nodeType&&d&&f&&(h=B._data(e))){f.handler&&(t=f,f=t.handler,g=t.selector);f.guid||(f.guid=B.guid++);q=h.events;q||(h.events=q={});l=h.handle;l||(h.handle=l=function(e){return"undefined"===
typeof B||e&&B.event.triggered===e.type?b:B.event.dispatch.apply(l.elem,arguments)},l.elem=e);d=B.trim(Ra(d)).split(" ");for(h=0;h<d.length;h++)w=Pa.exec(d[h])||[],z=w[1],r=(w[2]||"").split(".").sort(),D=B.event.special[z]||{},z=(g?D.delegateType:D.bindType)||z,D=B.event.special[z]||{},w=B.extend({type:z,origType:w[1],data:c,handler:f,guid:f.guid,selector:g,needsContext:g&&B.expr.match.needsContext.test(g),namespace:r.join(".")},t),C=q[z],C||(C=q[z]=[],C.delegateCount=0,D.setup&&!1!==D.setup.call(e,
c,r,l)||(e.addEventListener?e.addEventListener(z,l,!1):e.attachEvent&&e.attachEvent("on"+z,l))),D.add&&(D.add.call(e,w),w.handler.guid||(w.handler.guid=f.guid)),g?C.splice(C.delegateCount++,0,w):C.push(w),B.event.global[z]=!0;e=null}},global:{},remove:function(b,e,d,f,c){var g,h,l,q,w,z,r,t,C,D,v=B.hasData(b)&&B._data(b);if(v&&(r=v.events)){e=B.trim(Ra(e||"")).split(" ");for(g=0;g<e.length;g++)if(h=Pa.exec(e[g])||[],l=q=h[1],h=h[2],l){t=B.event.special[l]||{};l=(f?t.delegateType:t.bindType)||l;C=
r[l]||[];w=C.length;h=h?new RegExp("(^|\\.)"+h.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(z=0;z<C.length;z++)D=C[z],!c&&q!==D.origType||d&&d.guid!==D.guid||h&&!h.test(D.namespace)||f&&f!==D.selector&&("**"!==f||!D.selector)||(C.splice(z--,1),D.selector&&C.delegateCount--,t.remove&&t.remove.call(b,D));0===C.length&&w!==C.length&&(t.teardown&&!1!==t.teardown.call(b,h,v.handle)||B.removeEvent(b,l,v.handle),delete r[l])}else for(l in r)B.event.remove(b,l+e[g],d,f,!0);B.isEmptyObject(r)&&
(delete v.handle,B.removeData(b,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(e,d,f,g){if(!f||3!==f.nodeType&&8!==f.nodeType){var h,l,q,w,z,r,t=e.type||e;q=[];if(!Qa.test(t+B.event.triggered)&&(0<=t.indexOf("!")&&(t=t.slice(0,-1),h=!0),0<=t.indexOf(".")&&(q=t.split("."),t=q.shift(),q.sort()),f&&!B.event.customEvent[t]||B.event.global[t]))if(e="object"===typeof e?e[B.expando]?e:new B.Event(t,e):new B.Event(t),e.type=t,e.isTrigger=!0,e.exclusive=h,e.namespace=q.join("."),
e.namespace_re=e.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,q=0>t.indexOf(":")?"on"+t:"",f){if(e.result=b,e.target||(e.target=f),d=null!=d?B.makeArray(d):[],d.unshift(e),w=B.event.special[t]||{},!w.trigger||!1!==w.trigger.apply(f,d)){r=[[f,w.bindType||t]];if(!g&&!w.noBubble&&!B.isWindow(f)){z=w.delegateType||t;h=Qa.test(z+t)?f:f.parentNode;for(l=f;h;h=h.parentNode)r.push([h,z]),l=h;l===(f.ownerDocument||J)&&r.push([l.defaultView||l.parentWindow||c,z])}for(l=0;l<r.length&&
!e.isPropagationStopped();l++)h=r[l][0],e.type=r[l][1],(z=(B._data(h,"events")||{})[e.type]&&B._data(h,"handle"))&&z.apply(h,d),(z=q&&h[q])&&B.acceptData(h)&&z.apply&&!1===z.apply(h,d)&&e.preventDefault();e.type=t;g||e.isDefaultPrevented()||w._default&&!1!==w._default.apply(f.ownerDocument,d)||"click"===t&&B.nodeName(f,"a")||!B.acceptData(f)||!q||!f[t]||("focus"===t||"blur"===t)&&0===e.target.offsetWidth||B.isWindow(f)||((l=f[q])&&(f[q]=null),B.event.triggered=t,f[t](),B.event.triggered=b,l&&(f[q]=
l));return e.result}}else for(l in f=B.cache,f)f[l].events&&f[l].events[t]&&B.event.trigger(e,d,f[l].handle.elem,!0)}},dispatch:function(e){e=B.event.fix(e||c.event);var d,f,g,h,l,q,w=(B._data(this,"events")||{})[e.type]||[],z=w.delegateCount,r=ba.call(arguments),t=!e.exclusive&&!e.namespace,C=B.event.special[e.type]||{},D=[];r[0]=e;e.delegateTarget=this;if(!C.preDispatch||!1!==C.preDispatch.call(this,e)){if(z&&(!e.button||"click"!==e.type))for(f=e.target;f!=this;f=f.parentNode||this)if(!0!==f.disabled||
"click"!==e.type){h={};l=[];for(d=0;d<z;d++)g=w[d],q=g.selector,h[q]===b&&(h[q]=g.needsContext?0<=B(q,this).index(f):B.find(q,this,null,[f]).length),h[q]&&l.push(g);l.length&&D.push({elem:f,matches:l})}w.length>z&&D.push({elem:this,matches:w.slice(z)});for(d=0;d<D.length&&!e.isPropagationStopped();d++)for(h=D[d],e.currentTarget=h.elem,f=0;f<h.matches.length&&!e.isImmediatePropagationStopped();f++)if(g=h.matches[f],t||!e.namespace&&!g.namespace||e.namespace_re&&e.namespace_re.test(g.namespace))e.data=
g.data,e.handleObj=g,g=((B.event.special[g.origType]||{}).handle||g.handler).apply(h.elem,r),g!==b&&(e.result=g,!1===g&&(e.preventDefault(),e.stopPropagation()));C.postDispatch&&C.postDispatch.call(this,e);return e.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:["char","charCode","key","keyCode"],filter:function(b,e){null==b.which&&
(b.which=null!=e.charCode?e.charCode:e.keyCode);return b}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,d){var f,c,g=d.button,h=d.fromElement;null==e.pageX&&null!=d.clientX&&(f=e.target.ownerDocument||J,c=f.documentElement,f=f.body,e.pageX=d.clientX+(c&&c.scrollLeft||f&&f.scrollLeft||0)-(c&&c.clientLeft||f&&f.clientLeft||0),e.pageY=d.clientY+(c&&c.scrollTop||f&&f.scrollTop||0)-(c&&c.clientTop||f&&
f.clientTop||0));!e.relatedTarget&&h&&(e.relatedTarget=h===e.target?d.toElement:h);e.which||g===b||(e.which=g&1?1:g&2?3:g&4?2:0);return e}},fix:function(b){if(b[B.expando])return b;var e,d,f=b,c=B.event.fixHooks[b.type]||{},g=c.props?this.props.concat(c.props):this.props;b=B.Event(f);for(e=g.length;e;)d=g[--e],b[d]=f[d];b.target||(b.target=f.srcElement||J);3===b.target.nodeType&&(b.target=b.target.parentNode);b.metaKey=!!b.metaKey;return c.filter?c.filter(b,f):b},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},
blur:{delegateType:"focusout"},beforeunload:{setup:function(b,e,d){B.isWindow(this)&&(this.onbeforeunload=d)},teardown:function(b,e){this.onbeforeunload===e&&(this.onbeforeunload=null)}}},simulate:function(b,e,d,f){b=B.extend(new B.Event,d,{type:b,isSimulated:!0,originalEvent:{}});f?B.event.trigger(b,null,e):B.event.dispatch.call(e,b);b.isDefaultPrevented()&&d.preventDefault()}};B.event.handle=B.event.dispatch;B.removeEvent=J.removeEventListener?function(b,e,d){b.removeEventListener&&b.removeEventListener(e,
d,!1)}:function(b,e,d){e="on"+e;b.detachEvent&&("undefined"===typeof b[e]&&(b[e]=null),b.detachEvent(e,d))};B.Event=function(b,e){if(!(this instanceof B.Event))return new B.Event(b,e);b&&b.type?(this.originalEvent=b,this.type=b.type,this.isDefaultPrevented=b.defaultPrevented||!1===b.returnValue||b.getPreventDefault&&b.getPreventDefault()?h:g):this.type=b;e&&B.extend(this,e);this.timeStamp=b&&b.timeStamp||B.now();this[B.expando]=!0};B.Event.prototype={preventDefault:function(){this.isDefaultPrevented=
h;var b=this.originalEvent;b&&(b.preventDefault?b.preventDefault():b.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=h;var b=this.originalEvent;b&&(b.stopPropagation&&b.stopPropagation(),b.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=h;this.stopPropagation()},isDefaultPrevented:g,isPropagationStopped:g,isImmediatePropagationStopped:g};B.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(b,e){B.event.special[b]={delegateType:e,
bindType:e,handle:function(b){var d,f=b.relatedTarget,c=b.handleObj;if(!f||f!==this&&!B.contains(this,f))b.type=c.origType,d=c.handler.apply(this,arguments),b.type=e;return d}}});B.fn.extend({on:function(e,d,f,c,h){var l,q;if("object"===typeof e){"string"!==typeof d&&(f=f||d,d=b);for(q in e)this.on(q,d,f,e[q],h);return this}null==f&&null==c?(c=d,f=d=b):null==c&&("string"===typeof d?(c=f,f=b):(c=f,f=d,d=b));if(!1===c)c=g;else if(!c)return this;1===h&&(l=c,c=function(b){B().off(b);return l.apply(this,
arguments)},c.guid=l.guid||(l.guid=B.guid++));return this.each(function(){B.event.add(this,e,c,f,d)})},off:function(e,d,f){var c;if(e&&e.preventDefault&&e.handleObj)return c=e.handleObj,B(e.delegateTarget).off(c.namespace?c.origType+"."+c.namespace:c.origType,c.selector,c.handler),this;if("object"===typeof e){for(c in e)this.off(c,d,e[c]);return this}if(!1===d||"function"===typeof d)f=d,d=b;!1===f&&(f=g);return this.each(function(){B.event.remove(this,e,f,d)})},delegate:function(b,e,d,f){return this.on(e,
b,d,f)},undelegate:function(b,e,d){return 1===arguments.length?this.off(b,"**"):this.off(e,b||"**",d)},trigger:function(b,e){return this.each(function(){B.event.trigger(b,e,this)})},triggerHandler:function(b,e){if(this[0])return B.event.trigger(b,e,this[0],!0)},toggle:function(b){var e=arguments,d=b.guid||B.guid++,f=0,c=function(d){var c=(B._data(this,"lastToggle"+b.guid)||0)%f;B._data(this,"lastToggle"+b.guid,c+1);d.preventDefault();return e[c].apply(this,arguments)||!1};for(c.guid=d;f<e.length;)e[f++].guid=
d;return this.click(c)},hover:function(b,e){return this.mouseenter(b).mouseleave(e||b)}});B.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(b,e){B.fn[e]=function(b,d){null==d&&(d=b,b=null);return 0<arguments.length?this.on(e,null,b,d):this.trigger(e)};nb.test(e)&&(B.event.fixHooks[e]=B.event.keyHooks);ob.test(e)&&(B.event.fixHooks[e]=
B.event.mouseHooks)});(function(b,e){function d(b,e,f,c){f=f||[];e=e||H;var g,h,l,q,w=e.nodeType;if(!b||"string"!==typeof b)return f;if(1!==w&&9!==w)return[];l=F(e);if(!l&&!c&&(g=S.exec(b)))if(q=g[1])if(9===w)if((h=e.getElementById(q))&&h.parentNode){if(h.id===q)return f.push(h),f}else return f;else{if(e.ownerDocument&&(h=e.ownerDocument.getElementById(q))&&U(e,h)&&h.id===q)return f.push(h),f}else{if(g[2])return J.apply(f,T.call(e.getElementsByTagName(b),0)),f;if((q=g[3])&&na&&e.getElementsByClassName)return J.apply(f,
T.call(e.getElementsByClassName(q),0)),f}return D(b.replace(O,"$1"),e,f,c,l)}function f(b){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===b}}function c(b){return function(e){var d=e.nodeName.toLowerCase();return("input"===d||"button"===d)&&e.type===b}}function g(b){return M(function(e){e=+e;return M(function(d,f){for(var c,g=b([],d.length,e),h=g.length;h--;)d[c=g[h]]&&(d[c]=!(f[c]=d[c]))})})}function h(b,e,d){if(b===e)return d;for(b=b.nextSibling;b;){if(b===e)return-1;b=b.nextSibling}return 1}
function l(b,e){var f,c,g,h,q,w,z;if(q=ka[W][b+" "])return e?0:q.slice(0);q=b;w=[];for(z=E.preFilter;q;){if(!f||(c=Ba.exec(q)))c&&(q=q.slice(c[0].length)||q),w.push(g=[]);f=!1;if(c=fa.exec(q))g.push(f=new I(c.shift())),q=q.slice(f.length),f.type=c[0].replace(O," ");for(h in E.filter)!(c=ra[h].exec(q))||z[h]&&!(c=z[h](c))||(g.push(f=new I(c.shift())),q=q.slice(f.length),f.type=h,f.matches=c);if(!f)break}return e?q.length:q?d.error(b):ka(b,w).slice(0)}function q(b,e,d){var f=e.dir,c=d&&"parentNode"===
e.dir,g=R++;return e.first?function(e,d,g){for(;e=e[f];)if(c||1===e.nodeType)return b(e,d,g)}:function(e,d,h){if(!h)for(var l,q=ba+" "+g+" ",w=q+y;e=e[f];){if(c||1===e.nodeType){if((l=e[W])===w)return e.sizset;if("string"===typeof l&&0===l.indexOf(q)){if(e.sizset)return e}else{e[W]=w;if(b(e,d,h))return e.sizset=!0,e;e.sizset=!1}}}else for(;e=e[f];)if((c||1===e.nodeType)&&b(e,d,h))return e}}function w(b){return 1<b.length?function(e,d,f){for(var c=b.length;c--;)if(!b[c](e,d,f))return!1;return!0}:b[0]}
function z(b,e,d,f,c){for(var g,h=[],l=0,q=b.length,w=null!=e;l<q;l++)if(g=b[l])if(!d||d(g,f,c))h.push(g),w&&e.push(l);return h}function r(b,e,f,c,g,h){c&&!c[W]&&(c=r(c));g&&!g[W]&&(g=r(g,h));return M(function(h,l,q,w){var r,t,C=[],D=[],v=l.length,y;if(!(y=h)){y=e||"*";for(var A=q.nodeType?[q]:q,E=[],K=0,B=A.length;K<B;K++)d(y,A[K],E);y=E}y=!b||!h&&e?y:z(y,C,b,q,w);A=f?g||(h?b:v||c)?[]:l:y;f&&f(y,A,q,w);if(c)for(r=z(A,D),c(r,[],q,w),q=r.length;q--;)if(t=r[q])A[D[q]]=!(y[D[q]]=t);if(h){if(g||b){if(g){r=
[];for(q=A.length;q--;)(t=A[q])&&r.push(y[q]=t);g(null,A=[],r,w)}for(q=A.length;q--;)(t=A[q])&&-1<(r=g?P.call(h,t):C[q])&&(h[r]=!(l[r]=t))}}else A=z(A===l?A.splice(v,A.length):A),g?g(null,l,A,w):J.apply(l,A)})}function t(b){var e,d,f,c=b.length,g=E.relative[b[0].type];d=g||E.relative[" "];for(var h=g?1:0,l=q(function(b){return b===e},d,!0),z=q(function(b){return-1<P.call(e,b)},d,!0),C=[function(b,d,f){return!g&&(f||d!==G)||((e=d).nodeType?l(b,d,f):z(b,d,f))}];h<c;h++)if(d=E.relative[b[h].type])C=
[q(w(C),d)];else{d=E.filter[b[h].type].apply(null,b[h].matches);if(d[W]){for(f=++h;f<c&&!E.relative[b[f].type];f++);return r(1<h&&w(C),1<h&&b.slice(0,h-1).join("").replace(O,"$1"),d,h<f&&t(b.slice(h,f)),f<c&&t(b=b.slice(f)),f<c&&b.join(""))}C.push(d)}return w(C)}function C(b,e){var f=0<e.length,c=0<b.length,g=function(h,l,q,w,r){var t,C,D=[],v=0,A="0",K=h&&[],B=null!=r,F=G,U=h||c&&E.find.TAG("*",r&&l.parentNode||l),Q=ba+=null==F?1:Math.E;B&&(G=l!==H&&l,y=g.el);for(;null!=(r=U[A]);A++){if(c&&r){for(t=
0;C=b[t];t++)if(C(r,l,q)){w.push(r);break}B&&(ba=Q,y=++g.el)}f&&((r=!C&&r)&&v--,h&&K.push(r))}v+=A;if(f&&A!==v){for(t=0;C=e[t];t++)C(K,D,l,q);if(h){if(0<v)for(;A--;)K[A]||D[A]||(D[A]=wa.call(w));D=z(D)}J.apply(w,D);B&&!h&&0<D.length&&1<v+e.length&&d.uniqueSort(w)}B&&(ba=Q,G=F);return K};g.el=0;return f?M(g):g}function D(b,e,d,f,c){var g,h,q,w,z=l(b);if(!f&&1===z.length){h=z[0]=z[0].slice(0);if(2<h.length&&"ID"===(q=h[0]).type&&9===e.nodeType&&!c&&E.relative[h[1].type]){e=E.find.ID(q.matches[0].replace(la,
""),e,c)[0];if(!e)return d;b=b.slice(h.shift().length)}for(g=ra.POS.test(b)?-1:h.length-1;0<=g;g--){q=h[g];if(E.relative[w=q.type])break;if(w=E.find[w])if(f=w(q.matches[0].replace(la,""),ha.test(h[0].type)&&e.parentNode||e,c)){h.splice(g,1);b=f.length&&h.join("");if(!b)return J.apply(d,T.call(f,0)),d;break}}}Q(b,z)(f,e,c,d,ha.test(b));return d}function v(){}var y,A,E,K,F,U,Q,X,V,G,N=!0,W=("sizcache"+Math.random()).replace(".",""),I=String,H=b.document,Z=H.documentElement,ba=0,R=0,wa=[].pop,J=[].push,
T=[].slice,P=[].indexOf||function(b){for(var e=0,d=this.length;e<d;e++)if(this[e]===b)return e;return-1},M=function(b,e){b[W]=null==e||e;return b},ca=function(){var b={},e=[];return M(function(d,f){e.push(d)>E.cacheLength&&delete b[e.shift()];return b[d+" "]=f},b)},L=ca(),ka=ca(),Y=ca(),ca="\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)[\\x20\\t\\r\\n\\f]*(?:([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w#")+")|)|)[\\x20\\t\\r\\n\\f]*\\]",
ta=":((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+ca+")|[^:]|\\\\.)*|.*))\\)|)",O=RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),Ba=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,fa=/^[\x20\t\r\n\f]*([\x20\t\r\n\f>+~])[\x20\t\r\n\f]*/,Aa=new RegExp(ta),S=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,ha=/[\x20\t\r\n\f]*[+~]/,aa=/h\d/i,Ca=/input|select|textarea|button/i,la=/\\(?!\\)/g,ra={ID:/^#((?:\\.|[-\w]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[-\w]|[^\x00-\xa0])+)/,
NAME:/^\[name=['"]?((?:\\.|[-\w]|[^\x00-\xa0])+)['"]?\]/,TAG:new RegExp("^("+"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w*")+")"),ATTR:new RegExp("^"+ca),PSEUDO:new RegExp("^"+ta),POS:/:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i,CHILD:/^:(only|nth|first|last)-child(?:\([\x20\t\r\n\f]*(even|odd|(([+-]|)(\d*)n|)[\x20\t\r\n\f]*(?:([+-]|)[\x20\t\r\n\f]*(\d+)|))[\x20\t\r\n\f]*\)|)/i,needsContext:/^[\x20\t\r\n\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i},
da=function(b){var e=H.createElement("div");try{return b(e)}catch(d){return!1}finally{}},ca=da(function(b){b.appendChild(H.createComment(""));return!b.getElementsByTagName("*").length}),ja=da(function(b){b.innerHTML="<a href='#'></a>";return b.firstChild&&"undefined"!==typeof b.firstChild.getAttribute&&"#"===b.firstChild.getAttribute("href")}),Da=da(function(b){b.innerHTML="<select></select>";b=typeof b.lastChild.getAttribute("multiple");return"boolean"!==b&&"string"!==b}),na=da(function(b){b.innerHTML=
"<div class='hidden e'></div><div class='hidden'></div>";if(!b.getElementsByClassName||!b.getElementsByClassName("e").length)return!1;b.lastChild.className="e";return 2===b.getElementsByClassName("e").length}),xa=da(function(b){b.id=W+0;b.innerHTML="<a name='"+W+"'></a><div name='"+W+"'></div>";Z.insertBefore(b,Z.firstChild);var e=H.getElementsByName&&H.getElementsByName(W).length===2+H.getElementsByName(W+0).length;A=!H.getElementById(W);Z.removeChild(b);return e});try{T.call(Z.childNodes,0)[0].nodeType}catch(Lb){T=
function(b){for(var e,d=[];e=this[b];b++)d.push(e);return d}}d.matches=function(b,e){return d(b,null,null,e)};d.matchesSelector=function(b,e){return 0<d(e,null,null,[b]).length};K=d.getText=function(b){var e,d="",f=0;if(e=b.nodeType)if(1===e||9===e||11===e){if("string"===typeof b.textContent)return b.textContent;for(b=b.firstChild;b;b=b.nextSibling)d+=K(b)}else{if(3===e||4===e)return b.nodeValue}else for(;e=b[f];f++)d+=K(e);return d};F=d.isXML=function(b){return(b=b&&(b.ownerDocument||b).documentElement)?
"HTML"!==b.nodeName:!1};U=d.contains=Z.contains?function(b,e){var d=9===b.nodeType?b.documentElement:b,f=e&&e.parentNode;return b===f||!!(f&&1===f.nodeType&&d.contains&&d.contains(f))}:Z.compareDocumentPosition?function(b,e){return e&&!!(b.compareDocumentPosition(e)&16)}:function(b,e){for(;e=e.parentNode;)if(e===b)return!0;return!1};d.attr=function(b,e){var d,f=F(b);f||(e=e.toLowerCase());return(d=E.attrHandle[e])?d(b):f||Da?b.getAttribute(e):(d=b.getAttributeNode(e))?"boolean"===typeof b[e]?b[e]?
e:null:d.specified?d.value:null:null};E=d.selectors={cacheLength:50,createPseudo:M,match:ra,attrHandle:ja?{}:{href:function(b){return b.getAttribute("href",2)},type:function(b){return b.getAttribute("type")}},find:{ID:A?function(b,e,d){if("undefined"!==typeof e.getElementById&&!d)return(b=e.getElementById(b))&&b.parentNode?[b]:[]}:function(b,d,f){if("undefined"!==typeof d.getElementById&&!f)return(d=d.getElementById(b))?d.id===b||"undefined"!==typeof d.getAttributeNode&&d.getAttributeNode("id").value===
b?[d]:e:[]},TAG:ca?function(b,e){if("undefined"!==typeof e.getElementsByTagName)return e.getElementsByTagName(b)}:function(b,e){var d=e.getElementsByTagName(b);if("*"===b){for(var f,c=[],g=0;f=d[g];g++)1===f.nodeType&&c.push(f);return c}return d},NAME:xa&&function(b,e){if("undefined"!==typeof e.getElementsByName)return e.getElementsByName(name)},CLASS:na&&function(b,e,d){if("undefined"!==typeof e.getElementsByClassName&&!d)return e.getElementsByClassName(b)}},relative:{">":{dir:"parentNode",first:!0},
" ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(b){b[1]=b[1].replace(la,"");b[3]=(b[4]||b[5]||"").replace(la,"");"~="===b[2]&&(b[3]=" "+b[3]+" ");return b.slice(0,4)},CHILD:function(b){b[1]=b[1].toLowerCase();"nth"===b[1]?(b[2]||d.error(b[0]),b[3]=+(b[3]?b[4]+(b[5]||1):2*("even"===b[2]||"odd"===b[2])),b[4]=+(b[6]+b[7]||"odd"===b[2])):b[2]&&d.error(b[0]);return b},PSEUDO:function(b){var e,d;if(ra.CHILD.test(b[0]))return null;if(b[3])b[2]=
b[3];else if(e=b[4])Aa.test(e)&&(d=l(e,!0))&&(d=e.indexOf(")",e.length-d)-e.length)&&(e=e.slice(0,d),b[0]=b[0].slice(0,d)),b[2]=e;return b.slice(0,3)}},filter:{ID:A?function(b){b=b.replace(la,"");return function(e){return e.getAttribute("id")===b}}:function(b){b=b.replace(la,"");return function(e){return(e="undefined"!==typeof e.getAttributeNode&&e.getAttributeNode("id"))&&e.value===b}},TAG:function(b){if("*"===b)return function(){return!0};b=b.replace(la,"").toLowerCase();return function(e){return e.nodeName&&
e.nodeName.toLowerCase()===b}},CLASS:function(b){var e=L[W][b+" "];return e||(e=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+b+"([\\x20\\t\\r\\n\\f]|$)"),L(b,function(b){return e.test(b.className||"undefined"!==typeof b.getAttribute&&b.getAttribute("class")||"")}))},ATTR:function(b,e,f){return function(c,g){var h=d.attr(c,b);if(null==h)return"!="===e;if(!e)return!0;h+="";return"="===e?h===f:"!="===e?h!==f:"^="===e?f&&0===h.indexOf(f):"*="===e?f&&-1<h.indexOf(f):"$="===e?f&&h.substr(h.length-f.length)===f:
"~="===e?-1<(" "+h+" ").indexOf(f):"|="===e?h===f||h.substr(0,f.length+1)===f+"-":!1}},CHILD:function(b,e,d,f){return"nth"===b?function(b){var e,c;e=b.parentNode;if(1===d&&0===f)return!0;if(e)for(c=0,e=e.firstChild;e&&(1!==e.nodeType||(c++,b!==e));e=e.nextSibling);c-=f;return c===d||0===c%d&&0<=c/d}:function(e){var d=e;switch(b){case "only":case "first":for(;d=d.previousSibling;)if(1===d.nodeType)return!1;if("first"===b)return!0;d=e;case "last":for(;d=d.nextSibling;)if(1===d.nodeType)return!1;return!0}}},
PSEUDO:function(b,e){var f,c=E.pseudos[b]||E.setFilters[b.toLowerCase()]||d.error("unsupported pseudo: "+b);return c[W]?c(e):1<c.length?(f=[b,b,"",e],E.setFilters.hasOwnProperty(b.toLowerCase())?M(function(b,d){for(var f,g=c(b,e),h=g.length;h--;)f=P.call(b,g[h]),b[f]=!(d[f]=g[h])}):function(b){return c(b,0,f)}):c}},pseudos:{not:M(function(b){var e=[],d=[],f=Q(b.replace(O,"$1"));return f[W]?M(function(b,e,d,c){c=f(b,null,c,[]);for(var g=b.length;g--;)if(d=c[g])b[g]=!(e[g]=d)}):function(b,c,g){e[0]=
b;f(e,null,g,d);return!d.pop()}}),has:M(function(b){return function(e){return 0<d(b,e).length}}),contains:M(function(b){return function(e){return-1<(e.textContent||e.innerText||K(e)).indexOf(b)}}),enabled:function(b){return!1===b.disabled},disabled:function(b){return!0===b.disabled},checked:function(b){var e=b.nodeName.toLowerCase();return"input"===e&&!!b.checked||"option"===e&&!!b.selected},selected:function(b){b.parentNode&&b.parentNode.selectedIndex;return!0===b.selected},parent:function(b){return!E.pseudos.empty(b)},
empty:function(b){var e;for(b=b.firstChild;b;){if("@"<b.nodeName||3===(e=b.nodeType)||4===e)return!1;b=b.nextSibling}return!0},header:function(b){return aa.test(b.nodeName)},text:function(b){var e,d;return"input"===b.nodeName.toLowerCase()&&"text"===(e=b.type)&&(null==(d=b.getAttribute("type"))||d.toLowerCase()===e)},radio:f("radio"),checkbox:f("checkbox"),file:f("file"),password:f("password"),image:f("image"),submit:c("submit"),reset:c("reset"),button:function(b){var e=b.nodeName.toLowerCase();return"input"===
e&&"button"===b.type||"button"===e},input:function(b){return Ca.test(b.nodeName)},focus:function(b){var e=b.ownerDocument;return b===e.activeElement&&(!e.hasFocus||e.hasFocus())&&!!(b.type||b.href||~b.tabIndex)},active:function(b){return b===b.ownerDocument.activeElement},first:g(function(){return[0]}),last:g(function(b,e){return[e-1]}),eq:g(function(b,e,d){return[0>d?d+e:d]}),even:g(function(b,e){for(var d=0;d<e;d+=2)b.push(d);return b}),odd:g(function(b,e){for(var d=1;d<e;d+=2)b.push(d);return b}),
lt:g(function(b,e,d){for(e=0>d?d+e:d;0<=--e;)b.push(e);return b}),gt:g(function(b,e,d){for(d=0>d?d+e:d;++d<e;)b.push(d);return b})}};X=Z.compareDocumentPosition?function(b,e){return b===e?(V=!0,0):(b.compareDocumentPosition&&e.compareDocumentPosition?b.compareDocumentPosition(e)&4:b.compareDocumentPosition)?-1:1}:function(b,e){if(b===e)return V=!0,0;if(b.sourceIndex&&e.sourceIndex)return b.sourceIndex-e.sourceIndex;var d,f,c=[],g=[];d=b.parentNode;f=e.parentNode;var l=d;if(d===f)return h(b,e);if(!d)return-1;
if(!f)return 1;for(;l;)c.unshift(l),l=l.parentNode;for(l=f;l;)g.unshift(l),l=l.parentNode;d=c.length;f=g.length;for(l=0;l<d&&l<f;l++)if(c[l]!==g[l])return h(c[l],g[l]);return l===d?h(b,g[l],-1):h(c[l],e,1)};[0,0].sort(X);N=!V;d.uniqueSort=function(b){var e,d=[],f=1,c=0;V=N;b.sort(X);if(V){for(;e=b[f];f++)e===b[f-1]&&(c=d.push(f));for(;c--;)b.splice(d[c],1)}return b};d.error=function(b){throw Error("Syntax error, unrecognized expression: "+b);};Q=d.compile=function(b,e){var d,f=[],c=[],g=Y[W][b+" "];
if(!g){e||(e=l(b));for(d=e.length;d--;)g=t(e[d]),g[W]?f.push(g):c.push(g);g=Y(b,C(c,f))}return g};H.querySelectorAll&&function(){var b,e=D,f=/'|\\/g,c=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,g=[":focus"],h=[":active"],q=Z.matchesSelector||Z.mozMatchesSelector||Z.webkitMatchesSelector||Z.oMatchesSelector||Z.msMatchesSelector;da(function(b){b.innerHTML="<select><option selected=''></option></select>";b.querySelectorAll("[selected]").length||g.push("\\[[\\x20\\t\\r\\n\\f]*(?:checked|disabled|ismap|multiple|readonly|selected|value)");
b.querySelectorAll(":checked").length||g.push(":checked")});da(function(b){b.innerHTML="<p test=''></p>";b.querySelectorAll("[test^='']").length&&g.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:\"\"|'')");b.innerHTML="<input type='hidden'/>";b.querySelectorAll(":enabled").length||g.push(":enabled",":disabled")});g=new RegExp(g.join("|"));D=function(b,d,c,h,q){if(!h&&!q&&!g.test(b)){var w,z,r=!0,t=W;z=d;w=9===d.nodeType&&b;if(1===d.nodeType&&"object"!==d.nodeName.toLowerCase()){w=l(b);(r=d.getAttribute("id"))?
t=r.replace(f,"\\$&"):d.setAttribute("id",t);t="[id='"+t+"'] ";for(z=w.length;z--;)w[z]=t+w[z].join("");z=ha.test(b)&&d.parentNode||d;w=w.join(",")}if(w)try{return J.apply(c,T.call(z.querySelectorAll(w),0)),c}catch(C){}finally{r||d.removeAttribute("id")}}return e(b,d,c,h,q)};q&&(da(function(e){b=q.call(e,"div");try{q.call(e,"[test!='']:sizzle"),h.push("!=",ta)}catch(d){}}),h=new RegExp(h.join("|")),d.matchesSelector=function(e,f){f=f.replace(c,"='$1']");if(!F(e)&&!h.test(f)&&!g.test(f))try{var l=
q.call(e,f);if(l||b||e.document&&11!==e.document.nodeType)return l}catch(w){}return 0<d(f,null,null,[e]).length})}();E.pseudos.nth=E.pseudos.eq;E.filters=v.prototype=E.pseudos;E.setFilters=new v;d.attr=B.attr;B.find=d;B.expr=d.selectors;B.expr[":"]=B.expr.pseudos;B.unique=d.uniqueSort;B.text=d.getText;B.isXMLDoc=d.isXML;B.contains=d.contains})(c);var pb=/Until$/,qb=/^(?:parents|prev(?:Until|All))/,db=/^.[^:#\[\.,]*$/,Sa=B.expr.match.needsContext,rb={children:!0,contents:!0,next:!0,prev:!0};B.fn.extend({find:function(b){var e,
d,f,c,g,h,l=this;if("string"!==typeof b)return B(b).filter(function(){e=0;for(d=l.length;e<d;e++)if(B.contains(l[e],this))return!0});h=this.pushStack("","find",b);e=0;for(d=this.length;e<d;e++)if(f=h.length,B.find(b,this[e],h),0<e)for(c=f;c<h.length;c++)for(g=0;g<f;g++)if(h[g]===h[c]){h.splice(c--,1);break}return h},has:function(b){var e,d=B(b,this),f=d.length;return this.filter(function(){for(e=0;e<f;e++)if(B.contains(this,d[e]))return!0})},not:function(b){return this.pushStack(r(this,b,!1),"not",
b)},filter:function(b){return this.pushStack(r(this,b,!0),"filter",b)},is:function(b){return!!b&&("string"===typeof b?Sa.test(b)?0<=B(b,this.context).index(this[0]):0<B.filter(b,this).length:0<this.filter(b).length)},closest:function(b,e){for(var d,f=0,c=this.length,g=[],h=Sa.test(b)||"string"!==typeof b?B(b,e||this.context):0;f<c;f++)for(d=this[f];d&&d.ownerDocument&&d!==e&&11!==d.nodeType;){if(h?-1<h.index(d):B.find.matchesSelector(d,b)){g.push(d);break}d=d.parentNode}g=1<g.length?B.unique(g):g;
return this.pushStack(g,"closest",b)},index:function(b){return b?"string"===typeof b?B.inArray(this[0],B(b)):B.inArray(b.jqx?b[0]:b,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(b,e){var d="string"===typeof b?B(b,e):B.makeArray(b&&b.nodeType?[b]:b),f=B.merge(this.get(),d);return this.pushStack(l(d[0])||l(f[0])?f:B.unique(f))},addBack:function(b){return this.add(null==b?this.prevObject:this.prevObject.filter(b))}});B.fn.andSelf=B.fn.addBack;B.each({parent:function(b){return(b=
b.parentNode)&&11!==b.nodeType?b:null},parents:function(b){return B.dir(b,"parentNode")},parentsUntil:function(b,e,d){return B.dir(b,"parentNode",d)},next:function(b){return q(b,"nextSibling")},prev:function(b){return q(b,"previousSibling")},nextAll:function(b){return B.dir(b,"nextSibling")},prevAll:function(b){return B.dir(b,"previousSibling")},nextUntil:function(b,e,d){return B.dir(b,"nextSibling",d)},prevUntil:function(b,e,d){return B.dir(b,"previousSibling",d)},siblings:function(b){return B.sibling((b.parentNode||
{}).firstChild,b)},children:function(b){return B.sibling(b.firstChild)},contents:function(b){return B.nodeName(b,"iframe")?b.contentDocument||b.contentWindow.document:B.merge([],b.childNodes)}},function(b,e){B.fn[b]=function(d,f){var c=B.map(this,e,d);pb.test(b)||(f=d);f&&"string"===typeof f&&(c=B.filter(f,c));c=1<this.length&&!rb[b]?B.unique(c):c;1<this.length&&qb.test(b)&&(c=c.reverse());return this.pushStack(c,b,ba.call(arguments).join(","))}});B.extend({filter:function(b,e,d){d&&(b=":not("+b+
")");return 1===e.length?B.find.matchesSelector(e[0],b)?[e[0]]:[]:B.find.matches(b,e)},dir:function(e,d,f){var c=[];for(e=e[d];e&&9!==e.nodeType&&(f===b||1!==e.nodeType||!B(e).is(f));)1===e.nodeType&&c.push(e),e=e[d];return c},sibling:function(b,e){for(var d=[];b;b=b.nextSibling)1===b.nodeType&&b!==e&&d.push(b);return d}});var Ja="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",sb=/ JQXLite\d+="(?:null|\d+)"/g,
Ea=/^\s+/,Ta=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ua=/<([\w:]+)/,tb=/<tbody/i,ub=/<|&#?\w+;/,vb=/<(?:script|style|link)/i,wb=/<(?:script|object|embed|option|style)/i,Fa=new RegExp("<(?:"+Ja+")[\\s/>]","i"),Ka=/^(?:checkbox|radio)$/,Va=/checked\s*(?:[^=]|=\s*.checked.)/i,xb=/\/(java|ecma)script/i,yb=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,ia={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],
tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Wa=t(J),Ga=Wa.appendChild(J.createElement("div"));ia.optgroup=ia.option;ia.tbody=ia.tfoot=ia.colgroup=ia.caption=ia.thead;ia.th=ia.td;B.support.htmlSerialize||(ia._default=[1,"X<div>","</div>"]);B.fn.extend({text:function(e){return B.access(this,function(e){return e===b?B.text(this):this.empty().append((this[0]&&
this[0].ownerDocument||J).createTextNode(e))},null,e,arguments.length)},wrapAll:function(b){if(B.isFunction(b))return this.each(function(e){B(this).wrapAll(b.call(this,e))});if(this[0]){var e=B(b,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]);e.map(function(){for(var b=this;b.firstChild&&1===b.firstChild.nodeType;)b=b.firstChild;return b}).append(this)}return this},wrapInner:function(b){return B.isFunction(b)?this.each(function(e){B(this).wrapInner(b.call(this,
e))}):this.each(function(){var e=B(this),d=e.contents();d.length?d.wrapAll(b):e.append(b)})},wrap:function(b){var e=B.isFunction(b);return this.each(function(d){B(this).wrapAll(e?b.call(this,d):b)})},unwrap:function(){return this.parent().each(function(){B.nodeName(this,"body")||B(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(b){1!==this.nodeType&&11!==this.nodeType||this.appendChild(b)})},prepend:function(){return this.domManip(arguments,
!0,function(b){1!==this.nodeType&&11!==this.nodeType||this.insertBefore(b,this.firstChild)})},before:function(){if(!l(this[0]))return this.domManip(arguments,!1,function(b){this.parentNode.insertBefore(b,this)});if(arguments.length){var b=B.clean(arguments);return this.pushStack(B.merge(b,this),"before",this.selector)}},after:function(){if(!l(this[0]))return this.domManip(arguments,!1,function(b){this.parentNode.insertBefore(b,this.nextSibling)});if(arguments.length){var b=B.clean(arguments);return this.pushStack(B.merge(this,
b),"after",this.selector)}},remove:function(b,e){for(var d,f=0;null!=(d=this[f]);f++)if(!b||B.filter(b,[d]).length)e||1!==d.nodeType||(B.cleanData(d.getElementsByTagName("*")),B.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var b,e=0;null!=(b=this[e]);e++)for(1===b.nodeType&&B.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);return this},clone:function(b,e){b=null==b?!1:b;e=null==e?b:e;return this.map(function(){return B.clone(this,
b,e)})},html:function(e){return B.access(this,function(e){var d=this[0]||{},f=0,c=this.length;if(e===b)return 1===d.nodeType?d.innerHTML.replace(sb,""):b;if(!("string"!==typeof e||vb.test(e)||!B.support.htmlSerialize&&Fa.test(e)||!B.support.leadingWhitespace&&Ea.test(e)||ia[(Ua.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Ta,"<$1></$2>");try{for(;f<c;f++)d=this[f]||{},1===d.nodeType&&(B.cleanData(d.getElementsByTagName("*")),d.innerHTML=e);d=0}catch(g){}}d&&this.empty().append(e)},null,e,arguments.length)},
replaceWith:function(b){if(!l(this[0])){if(B.isFunction(b))return this.each(function(e){var d=B(this),f=d.html();d.replaceWith(b.call(this,e,f))});"string"!==typeof b&&(b=B(b).detach());return this.each(function(){var e=this.nextSibling,d=this.parentNode;B(this).remove();e?B(e).before(b):B(d).append(b)})}return this.length?this.pushStack(B(B.isFunction(b)?b():b),"replaceWith",b):this},detach:function(b){return this.remove(b,!0)},domManip:function(e,d,f){e=[].concat.apply([],e);var c,g,h,l=0,q=e[0],
w=[],z=this.length;if(!B.support.checkClone&&1<z&&"string"===typeof q&&Va.test(q))return this.each(function(){B(this).domManip(e,d,f)});if(B.isFunction(q))return this.each(function(c){var g=B(this);e[0]=q.call(this,c,d?g.html():b);g.domManip(e,d,f)});if(this[0]){c=B.buildFragment(e,this,w);h=c.fragment;g=h.firstChild;1===h.childNodes.length&&(h=g);if(g)for(d=d&&B.nodeName(g,"tr"),c=c.cacheable||z-1;l<z;l++)f.call(d&&B.nodeName(this[l],"table")?v(this[l],"tbody"):this[l],l===c?h:B.clone(h,!0,!0));
h=g=null;w.length&&B.each(w,function(b,e){e.src?B.ajax?B.ajax({url:e.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):B.error("no ajax"):B.globalEval((e.text||e.textContent||e.innerHTML||"").replace(yb,""));e.parentNode&&e.parentNode.removeChild(e)})}return this}});B.buildFragment=function(e,d,f){var c,g,h,l=e[0];d=d||J;d=!d.nodeType&&d[0]||d;d=d.ownerDocument||d;!(1===e.length&&"string"===typeof l&&512>l.length&&d===J&&"<"===l.charAt(0))||wb.test(l)||!B.support.checkClone&&Va.test(l)||
!B.support.html5Clone&&Fa.test(l)||(g=!0,c=B.fragments[l],h=c!==b);c||(c=d.createDocumentFragment(),B.clean(e,d,c,f),g&&(B.fragments[l]=h&&c));return{fragment:c,cacheable:g}};B.fragments={};B.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,e){B.fn[b]=function(d){var f,c=0,g=[];d=B(d);var h=d.length;f=1===this.length&&this[0].parentNode;if((null==f||f&&11===f.nodeType&&1===f.childNodes.length)&&1===h)return d[e](this[0]),this;
for(;c<h;c++)f=(0<c?this.clone(!0):this).get(),B(d[c])[e](f),g=g.concat(f);return this.pushStack(g,b,d.selector)}});B.extend({clone:function(b,e,d){var f,c,g,h;B.support.html5Clone||B.isXMLDoc(b)||!Fa.test("<"+b.nodeName+">")?h=b.cloneNode(!0):(Ga.innerHTML=b.outerHTML,Ga.removeChild(h=Ga.firstChild));if(!(B.support.noCloneEvent&&B.support.noCloneChecked||1!==b.nodeType&&11!==b.nodeType||B.isXMLDoc(b)))for(A(b,h),f=w(b),c=w(h),g=0;f[g];++g)c[g]&&A(f[g],c[g]);if(e&&(y(b,h),d))for(f=w(b),c=w(h),g=0;f[g];++g)y(f[g],
c[g]);return h},clean:function(b,e,d,f){var c,g,h,l,q,w,r=e===J&&Wa,C=[];e&&"undefined"!==typeof e.createDocumentFragment||(e=J);for(c=0;null!=(h=b[c]);c++)if("number"===typeof h&&(h+=""),h){if("string"===typeof h)if(ub.test(h)){r=r||t(e);w=e.createElement("div");r.appendChild(w);h=h.replace(Ta,"<$1></$2>");g=(Ua.exec(h)||["",""])[1].toLowerCase();l=ia[g]||ia._default;q=l[0];for(w.innerHTML=l[1]+h+l[2];q--;)w=w.lastChild;if(!B.support.tbody)for(q=tb.test(h),l="table"!==g||q?"<table>"!==l[1]||q?[]:
w.childNodes:w.firstChild&&w.firstChild.childNodes,g=l.length-1;0<=g;--g)B.nodeName(l[g],"tbody")&&!l[g].childNodes.length&&l[g].parentNode.removeChild(l[g]);!B.support.leadingWhitespace&&Ea.test(h)&&w.insertBefore(e.createTextNode(Ea.exec(h)[0]),w.firstChild);h=w.childNodes;w.parentNode.removeChild(w)}else h=e.createTextNode(h);h.nodeType?C.push(h):B.merge(C,h)}w&&(h=w=r=null);if(!B.support.appendChecked)for(c=0;null!=(h=C[c]);c++)B.nodeName(h,"input")?z(h):"undefined"!==typeof h.getElementsByTagName&&
B.grep(h.getElementsByTagName("input"),z);if(d)for(b=function(b){if(!b.type||xb.test(b.type))return f?f.push(b.parentNode?b.parentNode.removeChild(b):b):d.appendChild(b)},c=0;null!=(h=C[c]);c++)B.nodeName(h,"script")&&b(h)||(d.appendChild(h),"undefined"!==typeof h.getElementsByTagName&&(h=B.grep(B.merge([],h.getElementsByTagName("script")),b),C.splice.apply(C,[c+1,0].concat(h)),c+=h.length));return C},cleanData:function(b,e){for(var d,f,c,g,h=0,l=B.expando,q=B.cache,w=B.support.deleteExpando,z=B.event.special;null!=
(c=b[h]);h++)if(e||B.acceptData(c))if(d=(f=c[l])&&q[f]){if(d.events)for(g in d.events)z[g]?B.event.remove(c,g):B.removeEvent(c,g,d.handle);q[f]&&(delete q[f],w?delete c[l]:c.removeAttribute?c.removeAttribute(l):c[l]=null,B.deletedIds.push(f))}}});(function(){var b,e;B.uaMatch=function(b){b=b.toLowerCase();b=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||0>b.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||
[];return{browser:b[1]||"",version:b[2]||"0"}};b=B.uaMatch(P.userAgent);e={};b.browser&&(e[b.browser]=!0,e.version=b.version);e.chrome?e.webkit=!0:e.webkit&&(e.safari=!0);B.browser=e;B.sub=function(){function b(e,d){return new b.fn.init(e,d)}B.extend(!0,b,this);b.superclass=this;b.fn=b.prototype=this();b.fn.constructor=b;b.sub=this.sub;b.fn.init=function(d,f){f&&f instanceof B&&!(f instanceof b)&&(f=b(f));return B.fn.init.call(this,d,f,e)};b.fn.init.prototype=b.fn;var e=b(J);return b}})();var ea,
oa,pa,Ha=/alpha\([^)]*\)/i,zb=/opacity=([^)]*)/,Ab=/^(top|right|bottom|left)$/,Bb=/^(none|table(?!-c[ea]).+)/,Xa=/^margin/,eb=new RegExp("^("+da+")(.*)$","i"),ua=new RegExp("^("+da+")(?!px)[a-z%]+$","i"),Cb=new RegExp("^([-+])=("+da+")","i"),za={BODY:"block"},Db={position:"absolute",visibility:"hidden",display:"block"},Ya={letterSpacing:0,fontWeight:400},ma=["Top","Right","Bottom","Left"],La=["Webkit","O","Moz","ms"],Eb=B.fn.toggle;B.fn.extend({css:function(e,d){return B.access(this,function(e,d,
f){return f!==b?B.style(e,d,f):B.css(e,d)},e,d,1<arguments.length)},show:function(){return E(this,!0)},hide:function(){return E(this)},toggle:function(b,e){var d="boolean"===typeof b;return B.isFunction(b)&&B.isFunction(e)?Eb.apply(this,arguments):this.each(function(){(d?b:D(this))?B(this).show():B(this).hide()})}});B.extend({cssHooks:{opacity:{get:function(b,e){if(e){var d=ea(b,"opacity");return""===d?"1":d}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,
zIndex:!0,zoom:!0},cssProps:{"float":B.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,d,f,c){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var g,h,l,q=B.camelCase(d),w=e.style;d=B.cssProps[q]||(B.cssProps[q]=C(w,q));l=B.cssHooks[d]||B.cssHooks[q];if(f!==b){if(h=typeof f,"string"===h&&(g=Cb.exec(f))&&(f=(g[1]+1)*g[2]+parseFloat(B.css(e,d)),h="number"),!(null==f||"number"===h&&isNaN(f)||("number"!==h||B.cssNumber[q]||(f+="px"),l&&"set"in l&&(f=l.set(e,f,c))===b)))try{w[d]=f}catch(z){}}else return l&&
"get"in l&&(g=l.get(e,!1,c))!==b?g:w[d]}},css:function(e,d,f,c){var g,h;h=B.camelCase(d);d=B.cssProps[h]||(B.cssProps[h]=C(e.style,h));(h=B.cssHooks[d]||B.cssHooks[h])&&"get"in h&&(g=h.get(e,!0,c));g===b&&(g=ea(e,d));"normal"===g&&d in Ya&&(g=Ya[d]);return f||c!==b?(e=parseFloat(g),f||B.isNumeric(e)?e||0:g):g},swap:function(b,e,d){var f,c={};for(f in e)c[f]=b.style[f],b.style[f]=e[f];d=d.call(b);for(f in e)b.style[f]=c[f];return d}});c.getComputedStyle?ea=function(b,e){var d,f,g,h,l=c.getComputedStyle(b,
null),q=b.style;l&&(d=l.getPropertyValue(e)||l[e],""!==d||B.contains(b.ownerDocument,b)||(d=B.style(b,e)),ua.test(d)&&Xa.test(e)&&(f=q.width,g=q.minWidth,h=q.maxWidth,q.minWidth=q.maxWidth=q.width=d,d=l.width,q.width=f,q.minWidth=g,q.maxWidth=h));return d}:J.documentElement.currentStyle&&(ea=function(b,e){var d,f,c=b.currentStyle&&b.currentStyle[e],g=b.style;null==c&&g&&g[e]&&(c=g[e]);if(ua.test(c)&&!Ab.test(e)){d=g.left;if(f=b.runtimeStyle&&b.runtimeStyle.left)b.runtimeStyle.left=b.currentStyle.left;
g.left="fontSize"===e?"1em":c;c=g.pixelLeft+"px";g.left=d;f&&(b.runtimeStyle.left=f)}return""===c?"auto":c});B.each(["height","width"],function(b,e){B.cssHooks[e]={get:function(b,d,f){if(d)return 0===b.offsetWidth&&Bb.test(ea(b,"display"))?B.swap(b,Db,function(){return I(b,e,f)}):I(b,e,f)},set:function(b,d,f){return F(b,d,f?G(b,e,f,B.support.boxSizing&&"border-box"===B.css(b,"boxSizing")):0)}}});B.support.opacity||(B.cssHooks.opacity={get:function(b,e){return zb.test((e&&b.currentStyle?b.currentStyle.filter:
b.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":e?"1":""},set:function(b,e){var d=b.style,f=b.currentStyle,c=B.isNumeric(e)?"alpha(opacity="+100*e+")":"",g=f&&f.filter||d.filter||"";d.zoom=1;if(1<=e&&""===B.trim(g.replace(Ha,""))&&d.removeAttribute&&(d.removeAttribute("filter"),f&&!f.filter))return;d.filter=Ha.test(g)?g.replace(Ha,c):g+" "+c}});B(function(){B.support.reliableMarginRight||(B.cssHooks.marginRight={get:function(b,e){return B.swap(b,{display:"inline-block"},function(){if(e)return ea(b,
"marginRight")})}});!B.support.pixelPosition&&B.fn.position&&B.each(["top","left"],function(b,e){B.cssHooks[e]={get:function(b,d){if(d){var f=ea(b,e);return ua.test(f)?B(b).position()[e]+"px":f}}}})});B.expr&&B.expr.filters&&(B.expr.filters.hidden=function(b){return 0===b.offsetWidth&&0===b.offsetHeight||!B.support.reliableHiddenOffsets&&"none"===(b.style&&b.style.display||ea(b,"display"))},B.expr.filters.visible=function(b){return!B.expr.filters.hidden(b)});B.each({margin:"",padding:"",border:"Width"},
function(b,e){B.cssHooks[b+e]={expand:function(d){var f="string"===typeof d?d.split(" "):[d],c={};for(d=0;4>d;d++)c[b+ma[d]+e]=f[d]||f[d-2]||f[0];return c}};Xa.test(b)||(B.cssHooks[b+e].set=F)});var Fb=/%20/g,fb=/\[\]$/,Za=/\r?\n/g,Gb=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Hb=/^(?:select|textarea)/i;B.fn.extend({serialize:function(){return B.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?
B.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Hb.test(this.nodeName)||Gb.test(this.type))}).map(function(b,e){var d=B(this).val();return null==d?null:B.isArray(d)?B.map(d,function(b,d){return{name:e.name,value:b.replace(Za,"\r\n")}}):{name:e.name,value:d.replace(Za,"\r\n")}}).get()}});B.param=function(e,d){var f,c=[],g=function(b,e){e=B.isFunction(e)?e():null==e?"":e;c[c.length]=encodeURIComponent(b)+"="+encodeURIComponent(e)};d===b&&(d=B.ajaxSettings&&
B.ajaxSettings.traditional);if(B.isArray(e)||e.jqx&&!B.isPlainObject(e))B.each(e,function(){g(this.name,this.value)});else for(f in e)O(f,e[f],d,g);return c.join("&").replace(Fb,"+")};B.support.ajax&&B.ajaxTransport(function(e){if(!e.crossDomain||B.support.cors){var d;return{send:function(f,g){var h,l,q=e.xhr();e.username?q.open(e.type,e.url,e.async,e.username,e.password):q.open(e.type,e.url,e.async);if(e.xhrFields)for(l in e.xhrFields)q[l]=e.xhrFields[l];e.mimeType&&q.overrideMimeType&&q.overrideMimeType(e.mimeType);
e.crossDomain||f["X-Requested-With"]||(f["X-Requested-With"]="XMLHttpRequest");try{for(l in f)q.setRequestHeader(l,f[l])}catch(w){}q.send(e.hasContent&&e.data||null);d=function(f,c){var l,w,z,r,t;try{if(d&&(c||4===q.readyState))if(d=b,h&&(q.onreadystatechange=B.noop,xhrOnUnloadAbort&&delete xhrCallbacks[h]),c)4!==q.readyState&&q.abort();else{l=q.status;z=q.getAllResponseHeaders();r={};(t=q.responseXML)&&t.documentElement&&(r.xml=t);try{r.text=q.responseText}catch(C){}try{w=q.statusText}catch(C){w=
""}l||!e.isLocal||e.crossDomain?1223===l&&(l=204):l=r.text?200:404}}catch(C){c||g(-1,C)}r&&g(l,w,r,z)};e.async?4===q.readyState?setTimeout(d,0):(h=++xhrId,xhrOnUnloadAbort&&(xhrCallbacks||(xhrCallbacks={},B(c).unload(xhrOnUnloadAbort)),xhrCallbacks[h]=d),q.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var qa,ya,Ib=/^(?:toggle|show|hide)$/,Jb=new RegExp("^(?:([-+])=|)("+da+")([a-z%]*)$","i"),Kb=/queueHooks$/,va=[function(b,e,d){var f,c,g,h,l,q,w=this,z=b.style,r={},t=[],C=b.nodeType&&
D(b);d.queue||(l=B._queueHooks(b,"fx"),null==l.unqueued&&(l.unqueued=0,q=l.empty.fire,l.empty.fire=function(){l.unqueued||q()}),l.unqueued++,w.always(function(){w.always(function(){l.unqueued--;B.queue(b,"fx").length||l.empty.fire()})}));1===b.nodeType&&("height"in e||"width"in e)&&(d.overflow=[z.overflow,z.overflowX,z.overflowY],"inline"===B.css(b,"display")&&"none"===B.css(b,"float")&&(B.support.inlineBlockNeedsLayout&&"inline"!==M(b.nodeName)?z.zoom=1:z.display="inline-block"));d.overflow&&(z.overflow=
"hidden",B.support.shrinkWrapBlocks||w.done(function(){z.overflow=d.overflow[0];z.overflowX=d.overflow[1];z.overflowY=d.overflow[2]}));for(f in e)g=e[f],Ib.exec(g)&&(delete e[f],c=c||"toggle"===g,g!==(C?"hide":"show")&&t.push(f));if(e=t.length)for(g=B._data(b,"fxshow")||B._data(b,"fxshow",{}),("hidden"in g)&&(C=g.hidden),c&&(g.hidden=!C),C?B(b).show():w.done(function(){B(b).hide()}),w.done(function(){var e;B.removeData(b,"fxshow",!0);for(e in r)B.style(b,e,r[e])}),f=0;f<e;f++)c=t[f],h=w.createTween(c,
C?g[c]:0),r[c]=g[c]||B.style(b,c),c in g||(g[c]=h.start,C&&(h.end=h.start,h.start="width"===c||"height"===c?1:0))}],sa={"*":[function(b,e){var d,f,c=this.createTween(b,e),g=Jb.exec(e),h=c.cur(),l=+h||0,q=1,w=20;if(g){d=+g[2];f=g[3]||(B.cssNumber[b]?"":"px");if("px"!==f&&l){l=B.css(c.elem,b,!0)||d||1;do q=q||".5",l/=q,B.style(c.elem,b,l+f);while(q!==(q=c.cur()/h)&&1!==q&&--w)}c.unit=f;c.start=l;c.end=g[1]?l+(g[1]+1)*d:d}return c}]};B.Animation=B.extend(U,{tweener:function(b,e){B.isFunction(b)?(e=b,
b=["*"]):b=b.split(" ");for(var d,f=0,c=b.length;f<c;f++)d=b[f],sa[d]=sa[d]||[],sa[d].unshift(e)},prefilter:function(b,e){e?va.unshift(b):va.push(b)}});B.Tween=N;N.prototype={constructor:N,init:function(b,e,d,f,c,g){this.elem=b;this.prop=d;this.easing=c||"swing";this.options=e;this.start=this.now=this.cur();this.end=f;this.unit=g||(B.cssNumber[d]?"":"px")},cur:function(){var b=N.propHooks[this.prop];return b&&b.get?b.get(this):N.propHooks._default.get(this)},run:function(b){var e,d=N.propHooks[this.prop];
this.pos=this.options.duration?e=B.easing[this.easing](b,this.options.duration*b,0,1,this.options.duration):e=b;this.now=(this.end-this.start)*e+this.start;this.options.step&&this.options.step.call(this.elem,this.now,this);d&&d.set?d.set(this):N.propHooks._default.set(this);return this}};N.prototype.init.prototype=N.prototype;N.propHooks={_default:{get:function(b){return null==b.elem[b.prop]||b.elem.style&&null!=b.elem.style[b.prop]?(b=B.css(b.elem,b.prop,!1,""))&&"auto"!==b?b:0:b.elem[b.prop]},set:function(b){if(B.fx.step[b.prop])B.fx.step[b.prop](b);
else b.elem.style&&(null!=b.elem.style[B.cssProps[b.prop]]||B.cssHooks[b.prop])?B.style(b.elem,b.prop,b.now+b.unit):b.elem[b.prop]=b.now}}};N.propHooks.scrollTop=N.propHooks.scrollLeft={set:function(b){b.elem.nodeType&&b.elem.parentNode&&(b.elem[b.prop]=b.now)}};B.each(["toggle","show","hide"],function(b,e){var d=B.fn[e];B.fn[e]=function(f,c,g){return null==f||"boolean"===typeof f||!b&&B.isFunction(f)&&B.isFunction(c)?d.apply(this,arguments):this.animate(V(e,!0),f,c,g)}});B.fn.extend({fadeTo:function(b,
e,d,f){return this.filter(D).css("opacity",0).show().end().animate({opacity:e},b,d,f)},animate:function(b,e,d,f){var c=B.isEmptyObject(b),g=B.speed(e,d,f);e=function(){var e=U(this,B.extend({},b),g);c&&e.stop(!0)};return c||!1===g.queue?this.each(e):this.queue(g.queue,e)},stop:function(e,d,f){var c=function(b){var e=b.stop;delete b.stop;e(f)};"string"!==typeof e&&(f=d,d=e,e=b);d&&!1!==e&&this.queue(e||"fx",[]);return this.each(function(){var b=!0,d=null!=e&&e+"queueHooks",g=B.timers,h=B._data(this);
if(d)h[d]&&h[d].stop&&c(h[d]);else for(d in h)h[d]&&h[d].stop&&Kb.test(d)&&c(h[d]);for(d=g.length;d--;)g[d].elem!==this||null!=e&&g[d].queue!==e||(g[d].anim.stop(f),b=!1,g.splice(d,1));!b&&f||B.dequeue(this,e)})}});B.each({slideDown:V("show"),slideUp:V("hide"),slideToggle:V("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(b,e){B.fn[b]=function(b,d,f){return this.animate(e,b,d,f)}});B.speed=function(b,e,d){var f=b&&"object"===typeof b?B.extend({},b):
{complete:d||!d&&e||B.isFunction(b)&&b,duration:b,easing:d&&e||e&&!B.isFunction(e)&&e};f.duration=B.fx.off?0:"number"===typeof f.duration?f.duration:f.duration in B.fx.speeds?B.fx.speeds[f.duration]:B.fx.speeds._default;if(null==f.queue||!0===f.queue)f.queue="fx";f.old=f.complete;f.complete=function(){B.isFunction(f.old)&&f.old.call(this);f.queue&&B.dequeue(this,f.queue)};return f};B.easing={linear:function(b){return b},swing:function(b){return.5-Math.cos(b*Math.PI)/2}};B.timers=[];B.fx=N.prototype.init;
B.fx.tick=function(){var e,d=B.timers,f=0;for(qa=B.now();f<d.length;f++)e=d[f],e()||d[f]!==e||d.splice(f--,1);d.length||B.fx.stop();qa=b};B.fx.timer=function(b){b()&&B.timers.push(b)&&!ya&&(ya=setInterval(B.fx.tick,B.fx.interval))};B.fx.interval=13;B.fx.stop=function(){clearInterval(ya);ya=null};B.fx.speeds={slow:600,fast:200,_default:400};B.fx.step={};B.expr&&B.expr.filters&&(B.expr.filters.animated=function(b){return B.grep(B.timers,function(e){return b===e.elem}).length});var $a=/^(?:body|html)$/i;
B.fn.offset=function(e){if(arguments.length)return e===b?this:this.each(function(b){B.offset.setOffset(this,e,b)});var d,f,c,g,h,l={top:0,left:0};if(c=(g=this[0])&&g.ownerDocument){if((f=c.body)===g)return B.offset.bodyOffset(g);d=c.documentElement;if(!B.contains(d,g))return l;"undefined"!==typeof g.getBoundingClientRect&&(l=g.getBoundingClientRect());c=T(c);g=d.clientTop||f.clientTop||0;f=d.clientLeft||f.clientLeft||0;h=c.pageYOffset||d.scrollTop;d=c.pageXOffset||d.scrollLeft;return{top:l.top+h-
g,left:l.left+d-f}}};B.offset={bodyOffset:function(b){var e=b.offsetTop,d=b.offsetLeft;B.support.doesNotIncludeMarginInBodyOffset&&(e+=parseFloat(B.css(b,"marginTop"))||0,d+=parseFloat(B.css(b,"marginLeft"))||0);return{top:e,left:d}},setOffset:function(b,e,d){var f=B.css(b,"position");"static"===f&&(b.style.position="relative");var c=B(b),g=c.offset(),h=B.css(b,"top"),l=B.css(b,"left"),q={};("absolute"===f||"fixed"===f)&&-1<B.inArray("auto",[h,l])?(l=c.position(),f=l.top,l=l.left):(f=parseFloat(h)||
0,l=parseFloat(l)||0);B.isFunction(e)&&(e=e.call(b,d,g));null!=e.top&&(q.top=e.top-g.top+f);null!=e.left&&(q.left=e.left-g.left+l);"using"in e?e.using.call(b,q):c.css(q)}};B.fn.extend({isRendered:function(){var b=this[0];return null==b.parentNode||0===b.offsetWidth||0===b.offsetHeight?!1:!0},getSizeFromStyle:function(){var b=null,e=null,d=this[0];d.style.width&&(b=d.style.width);d.style.height&&(e=d.style.height);if(d=c.getComputedStyle?getComputedStyle(d,null):d.currentStyle)d.width&&(b=d.width),
d.height&&(e=d.height);"0px"===b&&(b=0);"0px"===e&&(e=0);null===b&&(b=0);null===e&&(e=0);return{width:b,height:e}},initAnimate:function(){},sizeStyleChanged:function(b){var e=this,d,f=function(b){var f=d;b&&b[0]&&"style"===b[0].attributeName&&"attributes"===b[0].type&&(f.element.offsetWidth!==f.offsetWidth||f.element.offsetHeight!==f.offsetHeight)&&(f.offsetWidth=f.element.offsetWidth,f.offsetHeight=f.element.offsetHeight,e.isRendered()&&f.callback())};d={element:e[0],offsetWidth:e[0].offsetWidth,
offsetHeight:e[0].offsetHeight,callback:b};try{e.elementStyleObserver||(e.elementStyleObserver=new MutationObserver(f),e.elementStyleObserver.observe(e[0],{attributes:!0,childList:!1,characterData:!1}))}catch(c){}},position:function(){if(this[0]){var b=this[0],e=this.offsetParent(),d=this.offset(),f=$a.test(e[0].nodeName)?{top:0,left:0}:e.offset();d.top-=parseFloat(B.css(b,"marginTop"))||0;d.left-=parseFloat(B.css(b,"marginLeft"))||0;f.top+=parseFloat(B.css(e[0],"borderTopWidth"))||0;f.left+=parseFloat(B.css(e[0],
"borderLeftWidth"))||0;return{top:d.top-f.top,left:d.left-f.left}}},offsetParent:function(){return this.map(function(){for(var b=this.offsetParent||J.body;b&&!$a.test(b.nodeName)&&"static"===B.css(b,"position");)b=b.offsetParent;return b||J.body})}});B.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,d){var f=/Y/.test(d);B.fn[e]=function(c){return B.access(this,function(e,c,g){var h=T(e);if(g===b)return h?d in h?h[d]:h.document.documentElement[c]:e[c];h?h.scrollTo(f?B(h).scrollLeft():
g,f?g:B(h).scrollTop()):e[c]=g},e,c,arguments.length,null)}});B.each({Height:"height",Width:"width"},function(e,d){B.each({padding:"inner"+e,content:d,"":"outer"+e},function(f,c){B.fn[c]=function(c,g){var h=arguments.length&&(f||"boolean"!==typeof c),l=f||(!0===c||!0===g?"margin":"border");return B.access(this,function(d,f,c){return B.isWindow(d)?d.document.documentElement["client"+e]:9===d.nodeType?(f=d.documentElement,Math.max(d.body["scroll"+e],f["scroll"+e],d.body["offset"+e],f["offset"+e],f["client"+
e])):c===b?B.css(d,f,c,l):B.style(d,f,c,l)},d,h?c:b,h,null)}})});c.JQXLite=c.jqxHelper=B;"function"===typeof define&&define.amd&&define.amd.JQXLite&&define("jqx",[],function(){return B})}(window);(function(c){c.jQuery?c.minQuery=c.JQXLite=c.jQuery:c.$?c.minQuery=c.JQXLite=c.$:c.$=c.minQuery=c.JQXLite})(window);JQXLite.generateID=function(){var c=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},b="";do b="jqx"+c()+c()+c();while(0<$("#"+b).length);return b};
var jqxBaseFramework=window.jqxBaseFramework=window.minQuery||window.jQuery;
(function(c){c.jqx=c.jqx||{};window.jqx=c.jqx;var b={createInstance:function(b,e,f){if("jqxDataAdapter"==e)return new c.jqx.dataAdapter(f[0],f[1]||{});c(b)[e](f||{});return c(b)[e]("getInstance")}};window.jqwidgets=b;c.jqx.define=function(b,e,f){b[e]=function(){this.baseType&&(this.base=new b[this.baseType],this.base.defineInstance());this.defineInstance();this.metaInfo()};b[e].prototype.defineInstance=function(){};b[e].prototype.metaInfo=function(){};b[e].prototype.base=null;b[e].prototype.baseType=
void 0;f&&b[f]&&(b[e].prototype.baseType=f)};c.jqx.invoke=function(b,e){if(0!=e.length){for(var f=typeof e==Array||0<e.length?e[0]:e,g=typeof e==Array||1<e.length?Array.prototype.slice.call(e,1):c({}).toArray();void 0==b[f]&&null!=b.base;){if(void 0!=b[f]&&c.isFunction(b[f]))return b[f].apply(b,g);if("string"==typeof f){var h=f.toLowerCase();if(void 0!=b[h]&&c.isFunction(b[h]))return b[h].apply(b,g)}b=b.base}if(void 0!=b[f]&&c.isFunction(b[f]))return b[f].apply(b,g);if("string"==typeof f&&(h=f.toLowerCase(),
void 0!=b[h]&&c.isFunction(b[h])))return b[h].apply(b,g)}};c.jqx.getByPriority=function(b){for(var e=void 0,f=0;f<b.length&&void 0==e;f++)void 0==e&&void 0!=b[f]&&(e=b[f]);return e};c.jqx.hasProperty=function(b,e){if("object"==typeof e)for(var f in e){for(var c=b;c;){if(c.hasOwnProperty(f)||c.hasOwnProperty(f.toLowerCase()))return!0;c=c.base}break}else for(;b;){if(b.hasOwnProperty(e)||b.hasOwnProperty(e.toLowerCase()))return!0;b=b.base}return!1};c.jqx.hasFunction=function(b,e){if(0==e.length||void 0==
b)return!1;var f=typeof e==Array||0<e.length?e[0]:e;for((typeof e==Array||1<e.length)&&Array.prototype.slice.call(e,1);void 0==b[f]&&null!=b.base;){if(b[f]&&c.isFunction(b[f]))return!0;if("string"==typeof f){var g=f.toLowerCase();if(b[g]&&c.isFunction(b[g]))return!0}b=b.base}return b[f]&&c.isFunction(b[f])||"string"==typeof f&&(g=f.toLowerCase(),b[g]&&c.isFunction(b[g]))?!0:!1};c.jqx.isPropertySetter=function(b,e){return 1==e.length&&"object"==typeof e[0]||2==e.length&&"string"==typeof e[0]&&!c.jqx.hasFunction(b,
e)?!0:!1};c.jqx.validatePropertySetter=function(b,e,f){if(!c.jqx.propertySetterValidation)return!0;if(1==e.length&&"object"==typeof e[0]){for(var g in e[0]){for(e=b;!e.hasOwnProperty(g)&&e.base;)e=e.base;if(!e||!e.hasOwnProperty(g)){if(!f)if(e.hasOwnProperty(g.toString().toLowerCase()))break;else throw"Invalid property: "+g;return!1}}return!0}if(2!=e.length){if(!f)throw 0<="Invalid property: "+e.length?e[0]:"";return!1}for(;!b.hasOwnProperty(e[0])&&b.base;)b=b.base;if(!b||!b.hasOwnProperty(e[0])){if(!f)throw"Invalid property: "+
e[0];return!1}return!0};Object.keys||(Object.keys=function(){var b=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),f="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),c=f.length;return function(h){if("object"!==typeof h&&("function"!==typeof h||null===h))throw new TypeError("Object.keys called on non-object");var l=[],q;for(q in h)b.call(h,q)&&l.push(q);if(e)for(q=0;q<c;q++)b.call(h,f[q])&&l.push(f[q]);return l}}());
c.jqx.set=function(b,e){var f=0;if(1==e.length&&"object"==typeof e[0]){if(b.isInitialized&&Object.keys&&1<Object.keys(e[0]).length){var g=c.data(b.base?b.base.element:b.element,b.widgetName).initArgs;if(g&&JSON&&JSON.stringify&&e[0]&&g[0])try{if(JSON.stringify(e[0])==JSON.stringify(g[0])){var h=!0;c.each(e[0],function(e,f){if(b[e]!=f)return h=!1});if(h)return}}catch(r){}b.batchUpdate=e[0];var l={},q={};c.each(e[0],function(e,c){for(var g=b;!g.hasOwnProperty(e)&&null!=g.base;)g=g.base;g.hasOwnProperty(e)?
b[e]!=c&&(l[e]=b[e],q[e]=c,f++):g.hasOwnProperty(e.toLowerCase())&&b[e.toLowerCase()]!=c&&(l[e.toLowerCase()]=b[e.toLowerCase()],q[e.toLowerCase()]=c,f++)});2>f&&(b.batchUpdate=null)}c.each(e[0],function(e,f){for(var g=b;!g.hasOwnProperty(e)&&null!=g.base;)g=g.base;if(g.hasOwnProperty(e))c.jqx.setvalueraiseevent(g,e,f);else if(g.hasOwnProperty(e.toLowerCase()))c.jqx.setvalueraiseevent(g,e.toLowerCase(),f);else if(c.jqx.propertySetterValidation)throw"jqxCore: invalid property '"+e+"'";});null!=b.batchUpdate&&
(b.batchUpdate=null,b.propertiesChangedHandler&&1<f&&b.propertiesChangedHandler(b,l,q))}else if(2==e.length){for(;!b.hasOwnProperty(e[0])&&b.base;)b=b.base;if(b.hasOwnProperty(e[0]))c.jqx.setvalueraiseevent(b,e[0],e[1]);else if(b.hasOwnProperty(e[0].toLowerCase()))c.jqx.setvalueraiseevent(b,e[0].toLowerCase(),e[1]);else if(c.jqx.propertySetterValidation)throw"jqxCore: invalid property '"+e[0]+"'";}};c.jqx.setvalueraiseevent=function(b,e,f){var c=b[e];b[e]=f;if(b.isInitialized&&(void 0!=b.propertyChangedHandler&&
b.propertyChangedHandler(b,e,c,f),void 0!=b.propertyChangeMap&&void 0!=b.propertyChangeMap[e]))b.propertyChangeMap[e](b,e,c,f)};c.jqx.get=function(b,e){if(void 0!=e&&null!=e){if(b.propertyMap){var f=b.propertyMap(e);if(null!=f)return f}if(b.hasOwnProperty(e))return b[e];if(b.hasOwnProperty(e.toLowerCase()))return b[e.toLowerCase()];f=void 0;if(typeof e==Array){if(1!=e.length)return;f=e[0]}else"string"==typeof e&&(f=e);for(;!b.hasOwnProperty(f)&&b.base;)b=b.base;if(b)return b[f]}};c.jqx.serialize=
function(b){var e;if(c.isArray(b)){e="[";for(var f=0;f<b.length;f++)0<f&&(e+=", "),e+=c.jqx.serialize(b[f]);e+="]"}else if("object"==typeof b){e="{";var g=0;for(f in b)0<g++&&(e+=", "),e+=f+": "+c.jqx.serialize(b[f]);e+="}"}else e=b.toString();return e};c.jqx.propertySetterValidation=!0;c.jqx.jqxWidgetProxy=function(b,e,f){c(e);b=c.data(e,b);if(void 0!=b){b=b.instance;if(c.jqx.hasFunction(b,f))return c.jqx.invoke(b,f);if(c.jqx.isPropertySetter(b,f)){if(c.jqx.validatePropertySetter(b,f)){c.jqx.set(b,
f);return}}else{if("object"==typeof f&&0==f.length)return;if("object"==typeof f&&1==f.length&&c.jqx.hasProperty(b,f[0]))return c.jqx.get(b,f[0]);if("string"==typeof f&&c.jqx.hasProperty(b,f[0]))return c.jqx.get(b,f)}throw"jqxCore: Invalid parameter '"+c.jqx.serialize(f)+"' does not exist.";}};c.jqx.applyWidget=function(b,e,f,g){var h=!1;try{h=void 0!=window.MSApp}catch(v){}var l=c(b);g?(g.host=l,g.element=b):g=new c.jqx["_"+e];""==b.id&&(b.id=c.jqx.utilities.createId());var q={host:l,element:b,instance:g,
initArgs:f};g.widgetName=e;c.data(b,e,q);c.data(b,"jqxWidget",q.instance);var r=[];for(g=q.instance;g;)g.isInitialized=!1,r.push(g),g=g.base;r.reverse();r[0].theme=c.jqx.theme||"";c.jqx.jqxWidgetProxy(e,b,f);for(var t in r)g=r[t],0==t&&(g.host=l,g.element=b,g.WinJS=h),void 0!=g&&(g.definedInstance&&g.definedInstance(),null!=g.createInstance&&(h?MSApp.execUnsafeLocalFunction(function(){g.createInstance(f)}):g.createInstance(f)));for(t in r)void 0!=r[t]&&(r[t].isInitialized=!0);h?MSApp.execUnsafeLocalFunction(function(){q.instance.refresh(!0)}):
q.instance.refresh(!0)};c.jqx.jqxWidget=function(d,e,f){try{jqxArgs=Array.prototype.slice.call(f,0)}catch(q){jqxArgs=""}var g="";e&&(g="_"+e);c.jqx.define(c.jqx,"_"+d,g);var h=[];if(!window[d]){var l=function(b){if(null==b)return"";switch(c.type(b)){case "string":case "number":case "date":case "boolean":case "bool":return null===b?"":b.toString()}var e="";c.each(b,function(b,d){0<b&&(e+=", ");e+="[";var f=0;if("object"==c.type(d))for(var g in d)0<f&&(e+=", "),e+="{"+g+":"+d[g]+"}",f++;else 0<f&&(e+=
", "),e+="{"+b+":"+d+"}";e+="]"});return e};b[d]=window[d]=function(b,e){var f=[];e||(e={});f.push(e);var g=b;"object"===c.type(g)&&b[0]?(g=b[0].id,""===g&&(g=b[0].id=c.jqx.utilities.createId())):"object"===c.type(b)&&b&&b.nodeName&&(g=b.id,""===g&&(g=b.id=c.jqx.utilities.createId()));if(window.jqxWidgets&&window.jqxWidgets[g]){e&&c.each(window.jqxWidgets[g],function(b){if((b=c(this.element).data())&&b.jqxWidget)c(this.element)[d](e)});if(1==window.jqxWidgets[g].length){var y=c(window.jqxWidgets[g][0].widgetInstance.element).data();
if(y&&y.jqxWidget)return window.jqxWidgets[g][0]}if((y=c(window.jqxWidgets[g][0].widgetInstance.element).data())&&y.jqxWidget)return window.jqxWidgets[g]}var A=c(b);if(0===A.length){A=c("<div></div>");if("jqxInput"===d||"jqxPasswordInput"===d||"jqxMaskedInput"===d)A=c("<input/>");"jqxTextArea"===d&&(A=c("<textarea></textarea>"));if("jqxButton"===d||"jqxRepeatButton"===d||"jqxToggleButton"===d)A=c("<button/>");"jqxSplitter"===d&&(A=c("<div><div>Panel 1</div><div>Panel 2</div></div>"));"jqxTabs"===
d&&(A=c("<div><ul><li>Tab 1</li><li>Tab 2</li></ul><div>Content 1</div><div>Content 2</div></div>"));"jqxRibbon"===d&&(A=c("<div><ul><li>Tab 1</li><li>Tab 2</li></ul><div><div>Content 1</div><div>Content 2</div></div></div>"));"jqxDocking"===d&&(A=c("<div><div><div><div>Title 1</div><div>Content 1</div></div></div></div>"));"jqxWindow"===d&&(A=c("<div><div>Title 1</div><div>Content 1</div></div>"))}var w=[];c.each(A,function(b){b=A[b];c.jqx.applyWidget(b,d,f,void 0);if(!h[d]){var e=c.data(b,"jqxWidget"),
e=c.jqx["_"+d].prototype.defineInstance();c.jqx["_"+d].prototype.metaInfo&&c.jqx["_"+d].prototype.metaInfo();"jqxDockingLayout"==d&&(e=c.extend(e,c.jqx._jqxLayout.prototype.defineInstance()));if("jqxToggleButton"==d||"jqxRepeatButton"==d)e=c.extend(e,c.jqx._jqxButton.prototype.defineInstance());"jqxTreeGrid"==d&&(e=c.extend(e,c.jqx._jqxDataTable.prototype.defineInstance()));var q=function(b){this.widgetInstance=b=c.data(b,"jqxWidget");var e=c.extend(this,b);e.on=e.addEventListener=function(b,d){e.addHandler(e.base?
e.base.host:e.host,b,d)};e.off=e.removeEventListener=function(b){e.removeHandler(e.base?e.base.host:e.host,b)};for(var d in b)"function"==c.type(b[d])&&(e[d]=c.proxy(b[d],b));return e};h[d]=q;c.each(e,function(b,e){Object.defineProperty(q.prototype,b,{get:function(){return this.widgetInstance?this.widgetInstance[b]:e},set:function(e){if(this.widgetInstance&&(this.widgetInstance[b]!=e||"width"===b||"height"===b)){var f=this.widgetInstance[b],g=c.type(f),h=c.type(e),q=!1;if(g!=h||"source"===b||"width"===
b||"height"===b)q=!0;if(q||l(f)!=l(e)){g={};g[b]=e;if(this.widgetInstance.host)this.widgetInstance.host[d](g);else this.widgetInstance.base.host[d](g);this.widgetInstance[b]=e;this.widgetInstance.propertyUpdated&&this.widgetInstance.propertyUpdated(b,f,e)}}}})})}e=new h[d](b);w.push(e);window.jqxWidgets||(window.jqxWidgets=[]);window.jqxWidgets[g]||(window.jqxWidgets[g]=[]);window.jqxWidgets[g].push(e)});return 1===w.length?w[0]:w}}c.fn[d]=function(){var b=Array.prototype.slice.call(arguments,0);
if(0==b.length||1==b.length&&"object"==typeof b[0]){if(0==this.length){if(this.selector)throw Error("Invalid Selector - "+this.selector+"! Please, check whether the used ID or CSS Class name is correct.");throw Error("Invalid Selector! Please, check whether the used ID or CSS Class name is correct.");}return this.each(function(){c(this);null==c.data(this,d)?c.jqx.applyWidget(this,d,b,void 0):c.jqx.jqxWidgetProxy(d,this,b)})}if(0==this.length){if(this.selector)throw Error("Invalid Selector - "+this.selector+
"! Please, check whether the used ID or CSS Class name is correct.");throw Error("Invalid Selector! Please, check whether the used ID or CSS Class name is correct.");}var e=null,f=0;this.each(function(){var g=c.jqx.jqxWidgetProxy(d,this,b);if(0==f)e=g,f++;else{if(1==f){var h=[];h.push(e);e=h}e.push(g)}});return e};try{c.extend(c.jqx["_"+d].prototype,Array.prototype.slice.call(f,0)[0])}catch(q){}c.extend(c.jqx["_"+d].prototype,{toThemeProperty:function(b,e){return c.jqx.toThemeProperty(this,b,e)},
isMaterialized:function(){if(!this.theme)return!1;if(0<=this.theme.indexOf("material"))return!0},isModern:function(){if(!this.theme)return!1;if(0<=this.theme.indexOf("light")||"dark"===this.theme)return!0},_addBarAndLabel:function(b){var e=c("<label></label");e[0].innerHTML=this.placeHolder;e.addClass(this.toThemeProperty("jqx-input-label"));b.after(e);this.label=e;e=c("<span></span>");b.after(e);e.addClass(this.toThemeProperty("jqx-input-bar"));this.bar=e;this.bar.css("top",this.host.height())}});
c.jqx["_"+d].prototype.refresh=function(){this.base&&this.base.refresh(!0)};c.jqx["_"+d].prototype.createInstance=function(){};c.jqx["_"+d].prototype.addEventHandler=function(b,e){if(this.base)this.base.host.on(b,e);else this.host.on(b,e)};c.jqx["_"+d].prototype.removeEventHandler=function(b,e){this.base?this.base.host.off(b):this.host.off(b)};c.jqx["_"+d].prototype.applyTo=function(b,e){if(!(e instanceof Array)){var f=[];f.push(e);e=f}c.jqx.applyWidget(b,d,e,this)};c.jqx["_"+d].prototype.getInstance=
function(){return this};c.jqx["_"+d].prototype.propertyChangeMap={};c.jqx["_"+d].prototype.addHandler=function(b,e,d,f){c.jqx.addHandler(c(b),e,d,f)};c.jqx["_"+d].prototype.removeHandler=function(b,e,d){c.jqx.removeHandler(c(b),e,d)};c.jqx["_"+d].prototype.setOptions=function(){if(this.host&&this.host.length&&1==this.host.length)return c.jqx.jqxWidgetProxy(d,this.host[0],arguments)}};c.jqx.toThemeProperty=function(b,e,f){if(""==b.theme)return e;e=e.split(" ");for(var c="",h=0;h<e.length;h++){0<h&&
(c+=" ");var l=e[h],c=null!=f&&f?c+(l+"-"+b.theme):c+(l+" "+l+"-"+b.theme)}return c};c.jqx.addHandler=function(b,e,f,g){e=e.split(" ");for(var h=0;h<e.length;h++){var l=e[h];if(window.addEventListener)switch(l){case "mousewheel":c.jqx.browser.mozilla?b[0].addEventListener("DOMMouseScroll",f,!1):b[0].addEventListener("mousewheel",f,!1);continue;case "mousemove":if(!g){b[0].addEventListener("mousemove",f,!1);continue}}if(void 0==g||null==g)if(b.on)b.on(l,f);else b.bind(l,f);else if(b.on)b.on(l,g,f);
else b.bind(l,g,f)}};c.jqx.removeHandler=function(b,e,f){if(e){e=e.split(" ");for(var g=0;g<e.length;g++){var h=e[g];if(window.removeEventListener)switch(h){case "mousewheel":c.jqx.browser.mozilla?b[0].removeEventListener("DOMMouseScroll",f,!1):b[0].removeEventListener("mousewheel",f,!1);continue;case "mousemove":if(f){b[0].removeEventListener("mousemove",f,!1);continue}}void 0==h?b.off?b.off():b.unbind():void 0==f?b.off?b.off(h):b.unbind(h):b.off?b.off(h,f):b.unbind(h,f)}}else b.off?b.off():b.unbind()};
c.jqx.credits=c.jqx.credits||"";c.jqx.theme=c.jqx.theme||"";c.jqx.scrollAnimation=c.jqx.scrollAnimation||!1;c.jqx.resizeDelay=c.jqx.resizeDelay||10;c.jqx.ready=function(){c(window).trigger("jqxReady")};c.jqx.init=function(b){c.each(b,function(b,d){"theme"==b&&(c.jqx.theme=d);"scrollBarSize"==b&&(c.jqx.utilities.scrollBarSize=d);"touchScrollBarSize"==b&&(c.jqx.utilities.touchScrollBarSize=d);"scrollBarButtonsVisibility"==b&&(c.jqx.utilities.scrollBarButtonsVisibility=d)})};c.jqx.utilities=c.jqx.utilities||
{};c.extend(c.jqx.utilities,{scrollBarSize:13,touchScrollBarSize:8,scrollBarButtonsVisibility:"visible",createId:function(){var b=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return"jqxWidget"+b()+b()+b()},setTheme:function(b,e,f){if("undefined"!==typeof f&&f[0].className.split){void 0===b&&(b="");void 0===e&&(e="");for(var g=f[0].className.split(" "),h=[],l=[],q=f.children(),r=0;r<g.length;r+=1)0<=g[r].indexOf(b)&&(0<b.length?(h.push(g[r]),l.push(g[r].replace(b,e))):l.push(g[r].replace("-"+
e,"")+"-"+e));this._removeOldClasses(h,f);this._addNewClasses(l,f);for(r=0;r<q.length;r+=1)this.setTheme(b,e,c(q[r]))}},_removeOldClasses:function(b,e){for(var f=0;f<b.length;f+=1)e.removeClass(b[f])},_addNewClasses:function(b,e){for(var f=0;f<b.length;f+=1)e.addClass(b[f])},getOffset:function(b){var e=c.jqx.mobile.getLeftPos(b[0]);return{top:c.jqx.mobile.getTopPos(b[0]),left:e}},resize:function(b,e,f,g){void 0===g&&(g=!0);var h=-1,l=this,q=function(b){if(!l.hiddenWidgets)return-1;for(var e=-1,d=
0;d<l.hiddenWidgets.length;d++)if(b.id){if(l.hiddenWidgets[d].id==b.id){e=d;break}}else if(l.hiddenWidgets[d].id==b[0].id){e=d;break}return e};if(this.resizeHandlers){for(var r=0;r<this.resizeHandlers.length;r++)if(b.id){if(this.resizeHandlers[r].id==b.id){h=r;break}}else if(this.resizeHandlers[r].id==b[0].id){h=r;break}if(!0===f){-1!=h&&(this.resizeHandlers.splice(h,1),this.watchedElementData&&0<this.watchedElementData.length&&this.watchedElementData.splice(h,1));0==this.resizeHandlers.length&&(f=
c(window),f.off?(f.off("resize.jqx"),f.off("orientationchange.jqx"),f.off("orientationchanged.jqx")):(f.unbind("resize.jqx"),f.unbind("orientationchange.jqx"),f.unbind("orientationchanged.jqx")),this.resizeHandlers=null);b=q(b);-1!=b&&this.hiddenWidgets&&this.hiddenWidgets.splice(b,1);return}}else if(!0===f){b=q(b);-1!=b&&this.hiddenWidgets&&this.hiddenWidgets.splice(b,1);return}var l=this,t=function(b,e){if(l.resizeHandlers){var d=function(b){var e=-1;for(b=b.parentNode;b;)e++,b=b.parentNode;return e},
f=function(b,e){if(!b.widget||!e.widget)return 0;var f=d(b.widget[0]),c=d(e.widget[0]);return f<c?-1:f>c?1:0},g=function(b){if(0<l.hiddenWidgets.length){l.hiddenWidgets.sort(f);var d=function(){for(var b=!1,d=[],f=0;f<l.hiddenWidgets.length;f++){var g=l.hiddenWidgets[f];c.jqx.isHidden(g.widget)?(b=!0,d.push(g)):g.callback&&g.callback(e)}l.hiddenWidgets=d;b||clearInterval(l.__resizeInterval)};0==b?(d(),l.__resizeInterval&&clearInterval(l.__resizeInterval)):(l.__resizeInterval&&clearInterval(l.__resizeInterval),
l.__resizeInterval=setInterval(function(){d()},100))}};l.hiddenWidgets&&0<l.hiddenWidgets.length&&g(!1);l.hiddenWidgets=[];l.resizeHandlers.sort(f);for(var h=0;h<l.resizeHandlers.length;h++){var r=l.resizeHandlers[h],t=r.widget,y=r.data;if(y&&y.jqxWidget){var v=y.jqxWidget.width,O=y.jqxWidget.height;y.jqxWidget.base&&(void 0==v&&(v=y.jqxWidget.base.width),void 0==O&&(O=y.jqxWidget.base.height));void 0===v&&void 0===O&&(v=y.jqxWidget.element.style.width,O=y.jqxWidget.element.style.height);var K=!1;
null!=v&&-1!=v.toString().indexOf("%")&&(K=!0);null!=O&&-1!=O.toString().indexOf("%")&&(K=!0);if(c.jqx.isHidden(t))-1===q(t)&&(K||!0===b)&&!0!==r.data.nestedWidget&&l.hiddenWidgets.push(r);else if(void 0===b||!0!==b){if(K){r.callback(e);if(l.watchedElementData)for(t=0;t<l.watchedElementData.length;t++)if(l.watchedElementData[t].element==y.jqxWidget.element){l.watchedElementData[t].offsetWidth=y.jqxWidget.element.offsetWidth;l.watchedElementData[t].offsetHeight=y.jqxWidget.element.offsetHeight;break}0<=
l.hiddenWidgets.indexOf(r)&&l.hiddenWidgets.splice(l.hiddenWidgets.indexOf(r),1)}y.jqxWidget.element&&(r=y.jqxWidget.element.className,!(0<=r.indexOf("dropdownlist")||0<=r.indexOf("datetimeinput")||0<=r.indexOf("combobox")||0<=r.indexOf("menu"))||!y.jqxWidget.isOpened||!y.jqxWidget.isOpened()||e&&"resize"==e&&c.jqx.mobile.isTouchDevice()||y.jqxWidget.close())}}}g()}};this.resizeHandlers||(this.resizeHandlers=[],f=c(window),f.on?(this._initResize=this._resizeTimer=null,f.on("resize.jqx",function(b){void 0!=
l._resizeTimer&&clearTimeout(l._resizeTimer);l._initResize?l._resizeTimer=setTimeout(function(){t(null,"resize")},c.jqx.resizeDelay):(l._initResize=!0,t(null,"resize"))}),f.on("orientationchange.jqx",function(b){t(null,"orientationchange")}),f.on("orientationchanged.jqx",function(b){t(null,"orientationchange")})):(f.bind("resize.jqx",function(b){t(null,"orientationchange")}),f.bind("orientationchange.jqx",function(b){t(null,"orientationchange")}),f.bind("orientationchanged.jqx",function(b){t(null,
"orientationchange")})));f=b.data();g&&-1===h&&this.resizeHandlers.push({id:b[0].id,widget:b,callback:e,data:f});try{var v=f.jqxWidget.width,y=f.jqxWidget.height;f.jqxWidget.base&&(void 0==v&&(v=f.jqxWidget.base.width),void 0==y&&(y=f.jqxWidget.base.height));void 0===v&&void 0===y&&(v=f.jqxWidget.element.style.width,y=f.jqxWidget.element.style.height);h=!1;null!=v&&-1!=v.toString().indexOf("%")&&(h=!0);null!=y&&-1!=y.toString().indexOf("%")&&(h=!0);h&&(this.watchedElementData||(this.watchedElementData=
[]),l=this,v=function(b){l.watchedElementData.forEach&&l.watchedElementData.forEach(function(b){if(b.element.offsetWidth!==b.offsetWidth||b.element.offsetHeight!==b.offsetHeight)b.offsetWidth=b.element.offsetWidth,b.offsetHeight=b.element.offsetHeight,b.timer&&clearTimeout(b.timer),b.timer=setTimeout(function(){c.jqx.isHidden(c(b.element))?b.timer=setInterval(function(){c.jqx.isHidden(c(b.element))||(clearInterval(b.timer),b.callback())},100):b.callback()})})},l.watchedElementData.push({element:b[0],
offsetWidth:b[0].offsetWidth,offsetHeight:b[0].offsetHeight,callback:e}),l.observer||(l.observer=new MutationObserver(v),l.observer.observe(document.body,{attributes:!0,childList:!0,characterData:!0})))}catch(A){}c.jqx.isHidden(b)&&!0===g&&t(!0);c.jqx.resize=function(){t(null,"resize")}},parseJSON:function(b){if(!b||"string"!==typeof b)return null;b=c.trim(b);if(window.JSON&&window.JSON.parse)return window.JSON.parse(b);if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return(new Function("return "+b))();throw Error("Invalid JSON: "+b);},html:function(b,e){if(!c(b).on)return c(b).html(e);try{return c.access(b,function(e){var g=b[0]||{},h=0,l=b.length;if(void 0===e)return 1===g.nodeType?g.innerHTML.replace(rinlinejQuery,""):void 0;var q=/<(?:script|style|link)/i,r=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,t=/<([\w:]+)/,v=/<(?:abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video)[\s/>]/i,
y=/^\s+/,A={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};if(!("string"!==typeof e||q.test(e)||!c.support.htmlSerialize&&v.test(e)||!c.support.leadingWhitespace&&y.test(e)||A[(t.exec(e)||["",""])[1].toLowerCase()])){e=
e.replace(r,"<$1></$2>");try{for(;h<l;h++)g=this[h]||{},1===g.nodeType&&(c.cleanData(g.getElementsByTagName("*")),g.innerHTML=e);g=0}catch(w){}}g&&b.empty().append(e)},null,e,arguments.length)}catch(f){return c(b).html(e)}},hasTransform:function(b){var e;e=b.css("transform");if(""==e||"none"==e)if(e=b.parents().css("transform"),""==e||"none"==e){var f=c.jqx.utilities.getBrowser();if("msie"==f.browser){if(e=b.css("-ms-transform"),""==e||"none"==e)e=b.parents().css("-ms-transform")}else if("chrome"==
f.browser){if(e=b.css("-webkit-transform"),""==e||"none"==e)e=b.parents().css("-webkit-transform")}else if("opera"==f.browser){if(e=b.css("-o-transform"),""==e||"none"==e)e=b.parents().css("-o-transform")}else"mozilla"==f.browser&&(e=b.css("-moz-transform"),""==e||"none"==e)&&(e=b.parents().css("-moz-transform"))}else return""!=e&&"none"!=e;if(""==e||"none"==e)e=c(document.body).css("transform");return""!=e&&"none"!=e&&null!=e},getBrowser:function(){var b=navigator.userAgent.toLowerCase(),e=/(chrome)[ \/]([\w.]+)/.exec(b)||
/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||0>b.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[],f={browser:e[1]||"",version:e[2]||"0"};0<=b.indexOf("rv:11.0")&&0<=b.indexOf(".net4.0c")&&(f.browser="msie",f.version="11",e[1]="msie");0<=b.indexOf("edge")&&(f.browser="msie",f.version="12",e[1]="msie");f[e[1]]=e[1];return f}});c.jqx.browser=c.jqx.utilities.getBrowser();c.jqx.isHidden=function(b){if(!b||!b[0])return!1;var e=
b[0].offsetHeight;return 0===b[0].offsetWidth||0===e?!0:!1};c.jqx.ariaEnabled=!0;c.jqx.aria=function(b,e,f){if(c.jqx.ariaEnabled)if(void 0==e)c.each(b.aria,function(e,f){var l=b.base?b.base.host.attr(e):b.host.attr(e);if(void 0==l||c.isFunction(l)){l=b[f.name];c.isFunction(l)&&(l=b[f.name]());void 0==l&&(l="");try{b.base?b.base.host.attr(e,l.toString()):b.host.attr(e,l.toString())}catch(r){}}else{var q=l;switch(f.type){case "number":q=new Number(l);isNaN(q)&&(q=l);break;case "boolean":q="true"==l?
!0:!1;break;case "date":if(q=new Date(l),"Invalid Date"==q||isNaN(q))q=l}b[f.name]=q}});else try{b.host?b.base?b.base.host?b.base.host.attr(e,f.toString()):b.attr(e,f.toString()):b.host?b.element.setAttribute?b.element.setAttribute(e,f.toString()):b.host.attr(e,f.toString()):b.attr(e,f.toString()):b.setAttribute&&b.setAttribute(e,f.toString())}catch(g){}};Array.prototype.indexOf||(Array.prototype.indexOf=function(b,e){var f=this.length,c=Number(e)||0,c=0>c?Math.ceil(c):Math.floor(c);for(0>c&&(c+=
f);c<f;c++)if(c in this&&this[c]===b)return c;return-1});c.jqx.mobile=c.jqx.mobile||{};c.jqx.position=function(b){var e=parseInt(b.pageX),f=parseInt(b.pageY);c.jqx.mobile.isTouchDevice()&&(b=c.jqx.mobile.getTouches(b)[0],e=parseInt(b.pageX),f=parseInt(b.pageY));return{left:e,top:f}};c.extend(c.jqx.mobile,{_touchListener:function(b,e){var f={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},c=f[b.type],h=document.createEvent("MouseEvents");h.initMouseEvent(c,b.bubbles,b.cancelable,b.view,
b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button,b.relatedTarget);h._pageX=b.pageX;h._pageY=b.pageY;b.target.dispatchEvent(h);f=b.target["on"+f[b.type]];"function"===typeof f&&f(b)},setMobileSimulator:function(b,e){if(!this.isTouchDevice()){this.simulatetouches=!0;0==e&&(this.simulatetouches=!1);var f={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};if(window.addEventListener)for(var c in f)b.addEventListener&&(b.removeEventListener(c,
this._touchListener),b.addEventListener(c,this._touchListener,!1))}},isTouchDevice:function(){if(void 0!=this.touchDevice)return this.touchDevice;var b="Browser CodeName: "+navigator.appCodeName+"",b=b+("Browser Name: "+navigator.appName+""),b=b+("Browser Version: "+navigator.appVersion+""),b=b+("Platform: "+navigator.platform+""),b=b+("User-agent header: "+navigator.userAgent+"");if(-1!=b.indexOf("Android")||-1!=b.indexOf("IEMobile")||-1!=b.indexOf("Windows Phone")||-1!=b.indexOf("WPDesktop")||-1!=
b.indexOf("ZuneWP7")||-1!=b.indexOf("BlackBerry")&&-1!=b.indexOf("Mobile Safari")||-1!=b.indexOf("ipod")||-1!=b.indexOf("nokia")||-1!=b.indexOf("Nokia"))return!0;if(-1!=b.indexOf("Chrome/17")||-1!=b.indexOf("CrOS")||-1!=b.indexOf("Opera")&&-1==b.indexOf("Mobi")&&-1==b.indexOf("Mini")&&-1!=b.indexOf("Platform: Win"))return!1;if(-1!=b.indexOf("HybridDeviceTouch"))return!0;if(-1!=b.indexOf("HybridDeviceMouse"))return!1;if(-1!=b.indexOf("Opera")&&-1!=b.indexOf("Mobi")&&-1!=b.indexOf("Opera Mobi"))return!0;
if(-1!=b.indexOf("Mozilla/5.0 (X11; Linux x86_64)"))return!1;var e={ios:"i(?:Pad|Phone|Pod)(?:.*)CPU(?: iPhone)? OS ",android:"(Android |HTC_|Silk/)",blackberry:"BlackBerry(?:.*)Version/",rimTablet:"RIM Tablet OS ",webos:"(?:webOS|hpwOS)/",bada:"Bada/"};try{if(void 0!=this.touchDevice)return this.touchDevice;this.touchDevice=!1;for(i in e)if(e.hasOwnProperty(i)&&(prefix=e[i],match=b.match(new RegExp("(?:"+prefix+")([^\\s;]+)"))))return"blackberry"==i.toString()?this.touchDevice=!1:this.touchDevice=
!0;var f=navigator.userAgent;if(-1!=navigator.platform.toLowerCase().indexOf("win")){if(0<=f.indexOf("Windows Phone")||0<=f.indexOf("WPDesktop")||0<=f.indexOf("IEMobile")||0<=f.indexOf("ZuneWP7"))return this.touchDevice=!0;if(0<=f.indexOf("Touch"))return"MSPointerDown"in window||"pointerdown"in window||0<=f.indexOf("ARM")?this.touchDevice=!0:this.touchDevice=!1}if(-1!=navigator.platform.toLowerCase().indexOf("win"))return this.touchDevice=!1;if("ontouchstart"in window||window.DocumentTouch&&document instanceof
DocumentTouch)this.touchDevice=!0;return this.touchDevice}catch(c){return this.touchDevice=!1}},getLeftPos:function(b){for(var e=b.offsetLeft;null!=(b=b.offsetParent);)"HTML"!=b.tagName&&(e+=b.offsetLeft,document.all&&(e+=b.clientLeft));return e},getTopPos:function(b){for(var e=b.offsetTop,f=c(b).coord();null!=(b=b.offsetParent);)"HTML"!=b.tagName&&(e+=b.offsetTop-b.scrollTop,document.all&&(e+=b.clientTop));b=navigator.userAgent.toLowerCase();if((-1!=b.indexOf("windows phone")||-1!=b.indexOf("WPDesktop")||
-1!=b.indexOf("ZuneWP7")||-1!=b.indexOf("msie 9")||-1!=b.indexOf("msie 11")||-1!=b.indexOf("msie 10"))&&-1!=b.indexOf("touch"))return f.top;if(this.isSafariMobileBrowser()){if(this.isSafari4MobileBrowser()&&this.isIPadSafariMobileBrowser())return e;if(-1!=b.indexOf("version/7"))return f.top;if(-1!=b.indexOf("version/6")||-1!=b.indexOf("version/5"))e+=c(window).scrollTop();return/(Android.*Chrome\/[.0-9]* (!?Mobile))/.exec(navigator.userAgent)||/(Android.*Chrome\/[.0-9]* Mobile)/.exec(navigator.userAgent)?
e+c(window).scrollTop():f.top}return e},isChromeMobileBrowser:function(){return-1!=navigator.userAgent.toLowerCase().indexOf("android")},isOperaMiniMobileBrowser:function(){var b=navigator.userAgent.toLowerCase();return-1!=b.indexOf("opera mini")||-1!=b.indexOf("opera mobi")},isOperaMiniBrowser:function(){return-1!=navigator.userAgent.toLowerCase().indexOf("opera mini")},isNewSafariMobileBrowser:function(){var b=navigator.userAgent.toLowerCase(),e=-1!=b.indexOf("ipad")||-1!=b.indexOf("iphone")||-1!=
b.indexOf("ipod");return e=e&&-1!=b.indexOf("version/5")},isSafari4MobileBrowser:function(){var b=navigator.userAgent.toLowerCase(),e=-1!=b.indexOf("ipad")||-1!=b.indexOf("iphone")||-1!=b.indexOf("ipod");return e=e&&-1!=b.indexOf("version/4")},isWindowsPhone:function(){var b=navigator.userAgent.toLowerCase();return-1!=b.indexOf("windows phone")||-1!=b.indexOf("WPDesktop")||-1!=b.indexOf("ZuneWP7")||-1!=b.indexOf("msie 9")||-1!=b.indexOf("msie 11")||-1!=b.indexOf("msie 10")&&-1!=b.indexOf("touch")},
isSafariMobileBrowser:function(){var b=navigator.userAgent.toLowerCase();return/(Android.*Chrome\/[.0-9]* (!?Mobile))/.exec(navigator.userAgent)||/(Android.*Chrome\/[.0-9]* Mobile)/.exec(navigator.userAgent)?!0:-1!=b.indexOf("ipad")||-1!=b.indexOf("iphone")||-1!=b.indexOf("ipod")||-1!=b.indexOf("mobile safari")},isIPadSafariMobileBrowser:function(){return-1!=navigator.userAgent.toLowerCase().indexOf("ipad")},isMobileBrowser:function(){var b=navigator.userAgent.toLowerCase();return-1!=b.indexOf("ipad")||
-1!=b.indexOf("iphone")||-1!=b.indexOf("android")},getTouches:function(b){if(b.originalEvent){if(b.originalEvent.touches&&b.originalEvent.touches.length)return b.originalEvent.touches;if(b.originalEvent.changedTouches&&b.originalEvent.changedTouches.length)return b.originalEvent.changedTouches}b.touches||(b.touches=[],b.touches[0]=void 0!=b.originalEvent?b.originalEvent:b,void 0!=b.originalEvent&&b.pageX&&(b.touches[0]=b),"mousemove"==b.type&&(b.touches[0]=b));return b.touches},getTouchEventName:function(b){if(this.isWindowsPhone()){if(-1!=
navigator.userAgent.toLowerCase().indexOf("windows phone 7")){if(-1!=b.toLowerCase().indexOf("start"))return"MSPointerDown";if(-1!=b.toLowerCase().indexOf("move"))return"MSPointerMove";if(-1!=b.toLowerCase().indexOf("end"))return"MSPointerUp"}if(-1!=b.toLowerCase().indexOf("start"))return"pointerdown";if(-1!=b.toLowerCase().indexOf("move"))return"pointermove";if(-1!=b.toLowerCase().indexOf("end"))return"pointerup"}else return b},dispatchMouseEvent:function(b,e,f){if(!this.simulatetouches){var c=document.createEvent("MouseEvent");
c.initMouseEvent(b,!0,!0,e.view,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null);null!=f&&f.dispatchEvent(c)}},getRootNode:function(b){for(;1!==b.nodeType;)b=b.parentNode;return b},setTouchScroll:function(b,e){this.enableScrolling||(this.enableScrolling=[]);this.enableScrolling[e]=b},touchScroll:function(b,e,f,g,h,l){function q(b){return b.targetTouches&&1<=b.targetTouches.length?b.targetTouches[0].clientY:b.originalEvent&&void 0!==b.originalEvent.clientY?b.originalEvent.clientY:y.getTouches(b)[0].clientY}
function r(b){return b.targetTouches&&1<=b.targetTouches.length?b.targetTouches[0].clientX:b.originalEvent&&void 0!==b.originalEvent.clientX?b.originalEvent.clientX:y.getTouches(b)[0].clientX}function t(){var b;N&&(b=Date.now()-U,b=-N*Math.exp(-b/H),.5<b||-.5>b?(L(V+b),requestAnimationFrame(t)):L(V))}function v(){var b;N&&(b=Date.now()-U,b=-N*Math.exp(-b/H),.5<b||-.5>b?(Y(T+b),requestAnimationFrame(v)):Y(T))}if(null!=b){var y=this;this.scrolling||(this.scrolling=[]);var A=this.scrolling[g]=!1;b=c(b);
var w=["select","input","textarea"],z=0;this.enableScrolling||(this.enableScrolling=[]);this.enableScrolling[g]=!0;var C=this.getTouchEventName("touchstart")+".touchScroll",D=this.getTouchEventName("touchend")+".touchScroll",E=this.getTouchEventName("touchmove")+".touchScroll",F,G,I,M,O,K,Q,U,X,N,V,T,R,H;G=e;initialXOffset=initialOffset=xoffset=I=0;F=h.jqxScrollBar("max");H=325;var J=function(){var b,e;b=Date.now();e=b-U;U=b;b=I-Q;xdelta=xoffset-xframe;Q=I;xframe=xoffset;O=!0;xv=1E3*xdelta/(1+e);
K=1E3*b/(1+e)*.8+.2*K;xjqxAnimations=.8*xv+.2*xjqxAnimations},P=!1,z=function(b){if(!y.enableScrolling[g])return!0;if(-1===c.inArray(b.target.tagName.toLowerCase(),w)){I=l.jqxScrollBar("value");xoffset=h.jqxScrollBar("value");var e=y.getTouches(b),d=e[0];1==e.length&&y.dispatchMouseEvent("mousedown",d,y.getRootNode(d.target));F=h.jqxScrollBar("max");G=l.jqxScrollBar("max");P=!1;O=!0;M=q(b);R=r(b);K=N=xjqxAnimations=0;Q=I;xframe=xoffset;U=Date.now();clearInterval(X);X=setInterval(J,100);initialOffset=
I;initialXOffset=xoffset;A=!1;return y.scrolling[g]=!0}};if(b.on)b.on(C,z);else b.bind(C,z);var L=function(b,e){I=b>G?G:0>b?0:b;f(null,b,0,0,e);return b>G?"max":0>b?"min":"value"},Y=function(b,e){xoffset=b>F?F:0>b?0:b;f(b,null,0,0,e);return b>F?"max":0>b?"min":"value"};e=function(b){function e(b){var d,f,g;if(O){d=q(b);g=r(b);f=M-d;xdelta=R-g;if(2<f||-2>f){M=d;d=L(I+f,b);J();if("min"==d&&0===initialOffset||"max"==d&&initialOffset===G||!w)return!0;b.preventDefault();b.stopPropagation();P=!0;return!1}if(2<
xdelta||-2>xdelta){R=g;d=Y(xoffset+xdelta,b);J();if("min"==d&&0===initialXOffset||"max"==d&&initialXOffset===F||!c)return!0;P=!0;b.preventDefault();b.stopPropagation();return!1}b.preventDefault()}}if(!y.enableScrolling[g]||!y.scrolling[g])return!0;P&&(b.preventDefault(),b.stopPropagation());var d=y.getTouches(b);if(1<d.length)return!0;var f=d[0].pageX;y.simulatetouches&&void 0!=d[0]._pageY&&(f=d[0]._pageX);touchHorizontalEnd=f;A=!0;var c=null!=h?"hidden"!=h[0].style.visibility:!0,w=null!=l?"hidden"!=
l[0].style.visibility:!0;(c||w)&&(c||w)&&e(b)};if(b.on)b.on(E,e);else b.bind(E,e);var aa=function(b){if(!y.enableScrolling[g])return!0;var e=y.getTouches(b)[0];if(!y.scrolling[g])return!0;O=!1;clearInterval(X);if(10<K||-10>K)N=.8*K,V=Math.round(I+N),U=Date.now(),requestAnimationFrame(t);else if(10<xjqxAnimations||-10>xjqxAnimations)N=.8*xjqxAnimations,T=Math.round(xoffset+N),U=Date.now(),requestAnimationFrame(v);y.scrolling[g]=!1;if(A)y.dispatchMouseEvent("mouseup",e,b.target);else return e=y.getTouches(b)[0],
b=y.getRootNode(e.target),y.dispatchMouseEvent("mouseup",e,b),y.dispatchMouseEvent("click",e,b),!0};this.simulatetouches&&(void 0!=c(window).on||c(window),e=function(b){try{aa(b)}catch(e){}y.scrolling[g]=!1},void 0!=c(window).on?c(document).on("mouseup.touchScroll",e):c(document).bind("mouseup.touchScroll",e),window.frameElement&&null!=window.top&&(e=function(b){try{aa(b)}catch(e){}y.scrolling[g]=!1},window.top.document&&(c(window.top.document).on?c(window.top.document).on("mouseup",e):c(window.top.document).bind("mouseup",
e))),void 0!=c(document).on||c(document),e=function(b){if(!y.scrolling[g])return!0;y.scrolling[g]=!1;b=y.getTouches(b)[0];var e=y.getRootNode(b.target);y.dispatchMouseEvent("mouseup",b,e);y.dispatchMouseEvent("click",b,e)},void 0!=c(document).on?c(document).on("touchend",e):c(document).bind("touchend",e));b.on&&(b.on("dragstart",function(b){b.preventDefault()}),b.on("selectstart",function(b){b.preventDefault()}));b.on?b.on(D+" touchcancel.touchScroll",aa):b.bind(D+" touchcancel.touchScroll",aa)}}});
c.jqx.cookie=c.jqx.cookie||{};c.extend(c.jqx.cookie,{cookie:function(b,e,f){if(1<arguments.length&&"[object Object]"!==String(e)){f=c.extend({},f);if(null===e||void 0===e)f.expires=-1;if("number"===typeof f.expires){var g=f.expires,h=f.expires=new Date;h.setDate(h.getDate()+g)}e=String(e);return document.cookie=[encodeURIComponent(b),"=",f.raw?e:encodeURIComponent(e),f.expires?"; expires="+f.expires.toUTCString():"",f.path?"; path="+f.path:"",f.domain?"; domain="+f.domain:"",f.secure?"; secure":""].join("")}f=
e||{};h=f.raw?function(b){return b}:decodeURIComponent;return(g=(new RegExp("(?:^|; )"+encodeURIComponent(b)+"=([^;]*)")).exec(document.cookie))?h(g[1]):null}});c.jqx.string=c.jqx.string||{};c.extend(c.jqx.string,{replace:function(b,e,f){if(e===f)return this;for(var c=b.indexOf(e);-1!=c;)b=b.replace(e,f),c=b.indexOf(e);return b},contains:function(b,e){return null==b||null==e?!1:-1!=b.indexOf(e)},containsIgnoreCase:function(b,e){return null==b||null==e?!1:-1!=b.toString().toUpperCase().indexOf(e.toString().toUpperCase())},
equals:function(b,e){if(null==b||null==e)return!1;b=this.normalize(b);return e.length==b.length?b.slice(0,e.length)==e:!1},equalsIgnoreCase:function(b,e){if(null==b||null==e)return!1;b=this.normalize(b);return e.length==b.length?b.toUpperCase().slice(0,e.length)==e.toUpperCase():!1},startsWith:function(b,e){return null==b||null==e?!1:b.slice(0,e.length)==e},startsWithIgnoreCase:function(b,e){return null==b||null==e?!1:b.toUpperCase().slice(0,e.length)==e.toUpperCase()},normalize:function(b){65279==
b.charCodeAt(b.length-1)&&(b=b.substring(0,b.length-1));return b},endsWith:function(b,e){if(null==b||null==e)return!1;b=this.normalize(b);return b.slice(-e.length)==e},endsWithIgnoreCase:function(b,e){if(null==b||null==e)return!1;b=this.normalize(b);return b.toUpperCase().slice(-e.length)==e.toUpperCase()}});c.extend(c.easing,{easeOutBack:function(b,e,f,c,h,l){void 0==l&&(l=1.70158);return c*((e=e/h-1)*e*((l+1)*e+l)+1)+f},easeInQuad:function(b,e,f,c,h){return c*(e/=h)*e+f},easeInOutCirc:function(b,
e,f,c,h){return 1>(e/=h/2)?-c/2*(Math.sqrt(1-e*e)-1)+f:c/2*(Math.sqrt(1-(e-=2)*e)+1)+f},easeInOutSine:function(b,e,f,c,h){return-c/2*(Math.cos(Math.PI*e/h)-1)+f},easeInCubic:function(b,e,f,c,h){return c*(e/=h)*e*e+f},easeOutCubic:function(b,e,f,c,h){return c*((e=e/h-1)*e*e+1)+f},easeInOutCubic:function(b,e,f,c,h){return 1>(e/=h/2)?c/2*e*e*e+f:c/2*((e-=2)*e*e+2)+f},easeInSine:function(b,e,f,c,h){return-c*Math.cos(e/h*(Math.PI/2))+c+f},easeOutSine:function(b,e,f,c,h){return c*Math.sin(e/h*(Math.PI/
2))+f},easeInOutSine:function(b,e,f,c,h){return-c/2*(Math.cos(Math.PI*e/h)-1)+f}})})(jqxBaseFramework);
(function(c){c.event&&c.event.special&&c.extend(c.event.special,{close:{noBubble:!0},open:{noBubble:!0},cellclick:{noBubble:!0},rowclick:{noBubble:!0},tabclick:{noBubble:!0},selected:{noBubble:!0},expanded:{noBubble:!0},collapsed:{noBubble:!0},valuechanged:{noBubble:!0},expandedItem:{noBubble:!0},collapsedItem:{noBubble:!0},expandingItem:{noBubble:!0},collapsingItem:{noBubble:!0}});c.fn.extend&&c.fn.extend({ischildof:function(b){if(!c(this).parents)return b.element.contains(this.element);for(var e=
c(this).parents().get(),f=0;f<e.length;f++)if("string"!=typeof b){var g=e[f];if(void 0!==b&&g==b[0])return!0}else if(void 0!==b&&c(e[f]).is(b))return!0;return!1}});c.fn.jqxProxy=function(){var b=c(this).data().jqxWidget,e=Array.prototype.slice.call(arguments,0),f=b.element;f||(f=b.base.element);return c.jqx.jqxWidgetProxy(b.widgetName,f,e)};var b=this.originalVal=c.fn.val;c.fn.val=function(d){if("undefined"==typeof d){if(c(this).hasClass("jqx-widget")){var e=c(this).data().jqxWidget;if(e&&e.val)return e.val()}return this[0]&&
0<=this[0].tagName.toLowerCase().indexOf("angular")&&(e=c(this).find(".jqx-widget").data().jqxWidget)&&e.val?e.val():b.call(this)}return c(this).hasClass("jqx-widget")&&(e=c(this).data().jqxWidget)&&e.val||this[0]&&0<=this[0].tagName.toLowerCase().indexOf("angular")&&(e=c(this).find(".jqx-widget").data().jqxWidget)&&e.val?2!=arguments.length?e.val(d):e.val(d,arguments[1]):b.call(this,d)};c.fn.modal&&c.fn.modal.Constructor&&(c.fn.modal.Constructor.prototype.enforceFocus=function(){c(document).off("focusin.bs.modal").on("focusin.bs.modal",
c.proxy(function(b){if(this.$element[0]!==b.target&&!this.$element.has(b.target).length){if(c(b.target).parents().hasClass("jqx-popup"))return!0;this.$element.trigger("focus")}},this))});c.fn.coord=function(b){var e,f,g={top:0,left:0},h=(f=this[0])&&f.ownerDocument;if(h){e=h.documentElement;if(!c.contains(e,f))return g;g=f.getBoundingClientRect();f=c.isWindow(h)?h:9===h.nodeType?h.defaultView||h.parentWindow:!1;var l=h=0,q=navigator.userAgent.toLowerCase();if(-1!=q.indexOf("ipad")||-1!=q.indexOf("iphone"))h=
2;1==b&&"static"!=document.body.style.position&&""!=document.body.style.position&&(b=c(document.body).coord(),h=-b.left,l=-b.top);return{top:l+g.top+(f.pageYOffset||e.scrollTop)-(e.clientTop||0),left:h+g.left+(f.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}}};c.jqx.ripplers=[];c.jqx.ripple=function(b,e,f){e||(e=b);var g=c(b);g.append("<span class='ink'></span>");for(var h=g.find(".ink"),l=!1,q=0;q<c.jqx.ripplers.length;q++)if(c.jqx.ripplers[q].element[0]===b[0]){l=!0;break}l||c.jqx.ripplers.push({ink:h,
element:b,hostElement:e,hostElementType:f});if("checkbox"===f||"radiobutton"===f)l=Math.max(g.outerWidth(),g.outerHeight()),h.css({height:l,width:l}),l=g.width()/2-h.width()/2,g=g.height()/2-h.height()/2,h.css({top:g+"px",left:l+"px"});if(1===c.jqx.ripplers.length)c(document).on("mouseup",function(b){c.jqx.ripple.mouseCaptured=!1;for(b=0;b<c.jqx.ripplers.length;b++){var e=c.jqx.ripplers[b];e.ink.removeClass("active");e.element.removeClass("active");"checkbox"!==f&&"radiobutton"!==f&&e.ink.hasClass("animate")&&
e.ink.removeClass("animate")}});e.off("mousedown.ripple");e.on("mousedown.ripple",function(g){var h=c(b);c.jqx.ripple.mouseCaptured=!0;setTimeout(function(){0==h.find(".ink").length&&h.append("<span class='ink'></span>");var l=h.find(".ink");l.removeClass("animate");if(!l.height()&&!l.width()){var q=Math.max(h.outerWidth(),h.outerHeight());l.css({height:q,width:q})}if("checkbox"===f||"radiobutton"===f){if(!("checkbox"===f&&e.jqxCheckBox("disabled")||"radiobutton"===f&&e.jqxRadioButton("disabled"))){var q=
h.width()/2-l.width()/2,A=h.height()/2-l.height()/2;l.css({top:A+"px",left:q+"px"}).addClass("animate");l.on("animationend",function(){c.jqx.ripple.mouseCaptured&&(l.removeClass("animate"),l.addClass("active"),b.addClass("active"))})}}else q=g.pageX-h.offset().left-l.width()/2,A=g.pageY-h.offset().top-l.height()/2,l.css({top:A+"px",left:q+"px"}).addClass("animate")})})}})(jqxBaseFramework);
(function(c){function b(b){return function(e,d){"string"!==typeof e&&(d=e,e="*");var f,g,h=e.toLowerCase().split(w),l=0,q=h.length;if(c.isFunction(d))for(;l<q;l++)f=h[l],(g=/^\+/.test(f))&&(f=f.substr(1)||"*"),f=b[f]=b[f]||[],f[g?"unshift":"push"](d)}}function d(b,e,f,c,g,h){g=g||e.dataTypes[0];h=h||{};h[g]=!0;var l;g=b[g];for(var q=0,w=g?g.length:0,r=b===z;q<w&&(r||!l);q++)l=g[q](e,f,c),"string"===typeof l&&(!r||h[l]?l=void 0:(e.dataTypes.unshift(l),l=d(b,e,f,c,l,h)));!r&&l||h["*"]||(l=d(b,e,f,c,
"*",h));return l}function e(b,e){var d,f,g=c.jqx.data.ajaxSettings.flatOptions||{};for(d in e)void 0!==e[d]&&((g[d]?b:f||(f={}))[d]=e[d]);f&&c.extend(!0,b,f)}function f(){try{return new window.XMLHttpRequest}catch(b){}}c.jqx.observableArray=function(b,e){"string"==typeof b&&(b=c.parseJSON(b));var d;if(!(d=!Object.defineProperty)){var f;try{Object.defineProperty({},"x",{}),f=!0}catch(g){f=!1}d=!f}if(d){var h=Object.defineProperty;Object.defineProperty=function(b,e,d){if(h)try{return h(b,e,d)}catch(f){}if(b!==
Object(b))throw TypeError("Object.defineProperty called on non-object");Object.prototype.__defineGetter__&&"get"in d&&Object.prototype.__defineGetter__.call(b,e,d.get);Object.prototype.__defineSetter__&&"set"in d&&Object.prototype.__defineSetter__.call(b,e,d.set);"value"in d?b[e]=d.value:b[e]||(b[e]=d);return b}}Array.prototype.forEach||(Array.prototype.forEach=function(b,e){if(void 0===this||null===this)throw TypeError();var d=Object(this),f=d.length>>>0;if("function"!==typeof b)throw TypeError();
var c;for(c=0;c<f;c++)c in d&&b.call(e,d[c],c,d)});"function"!==typeof Object.getOwnPropertyNames&&(Object.getOwnPropertyNames=function(b){if(b!==Object(b))throw TypeError("Object.getOwnPropertyNames called on non-object");var e=[],d;for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&e.push(d);return e});var l=this,q,w=[];l.notifier=null;l.name="observableArray";l.observing=!0;l.changes=[];l.observe=function(){l.observing=!0;1==arguments.length&&(e=arguments[0])};l.unobserve=function(){l.observing=
!1};l.toArray=function(){return w.slice(0)};l.toJSON=function(b,e){function d(b){return'"'+b.replace(l,function(b){var e=q[b];return"string"===typeof e?e:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"'}function f(b){return 10>b?"0"+b:b}function c(b,e){switch(e){case "string":return d(b);case "number":case "float":case "integer":case "int":return isFinite(b)?b:"null";case "boolean":return b}return"null"}function g(e,h){var l=h[e],q=typeof l;l&&"object"===typeof l&&"function"===typeof l.toJSON&&
(l=l.toJSON(e),q=typeof l);if(/(number|float|int|integer|string|boolean)/.test(q)||!l&&"object"===q)return c(l,q);a:{switch(Object.prototype.toString.call(l)){case "[object Date]":l=isFinite(l.valueOf())?l.getUTCFullYear()+"-"+f(l.getUTCMonth()+1)+"-"+f(l.getUTCDate())+"T"+f(l.getUTCHours())+":"+f(l.getUTCMinutes())+":"+f(l.getUTCSeconds())+'Z"':"null";break a;case "[object Array]":var w=l.length,q=[],z;for(z=0;z<w;z++)q.push(g(z,l)||"null");l="["+q.join(",")+"]";break a}q=[];for(w in l)!Object.prototype.hasOwnProperty.call(l,
w)||""!=w&&b&&-1===b.indexOf(w)||(z=g(w,l))&&q.push(d(w)+":"+z);l="{"+q.join(",")+"}"}return l}var h=w;e&&(h=e);var l=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,q={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return!b&&window.JSON&&"function"===typeof window.JSON.stringify?window.JSON.stringify(h):g("",{"":h})};l.defineIndexProperty=function(b){if(!(b in l)){var e=function(b,e,d,f){var g=
b[e],h=g;d=function(){return h};var z=function(b){g=b;if(h!==g&&(b=h,h=g,"function"===typeof q)){var d=w.indexOf(f),z="",r=function(b,d){Object.getOwnPropertyNames(b).forEach(function(f){var g=c.type(b[f]);"array"==g||"object"==g?r(b[f],d+"."+f):e===f&&(z=d+"."+f)})};r(f,d);q({object:l,type:"update",path:z,index:d,name:e,newValue:g,oldValue:b})}return h=g};void 0!=b[e]&&"length"!=e&&(Object.defineProperty?Object.defineProperty(b,e,{get:d,set:z}):Object.prototype.__defineGetter__&&Object.prototype.__defineSetter__&&
(Object.prototype.__defineGetter__.call(b,e,d),Object.prototype.__defineSetter__.call(b,e,z)))},d=function(b,f,g){var h=c.type(b);/(number|float|int|integer|string|boolean)/.test(h)||void 0!==b&&Object.getOwnPropertyNames(b).forEach(function(h){var l=c.type(b[h]);"array"==l||"object"==l?(e(b,h,f+"."+h,g),d(b[h],f+"."+h,g)):e(b,h,f+"."+h,g)})};Object.defineProperty(l,b,{configurable:!0,enumerable:!0,get:function(){return w[b]},set:function(e){var f=w[b];l.toJSON(null,f)!=l.toJSON(null,e)&&(w[b]=e,
"function"===typeof q&&q({object:l,type:"update",path:b.toString(),index:b,name:"index",newValue:e,oldValue:f}),d(e,b,e))}});d(l[b],b,l[b])}};l.push=function(){for(var b,e=0,d=arguments.length;e<d;e++)b=w.length,w.push(arguments[e]),l.defineIndexProperty(b),"function"===typeof q&&q({object:l,type:"add",name:"length",index:b,newValue:w.length,oldValue:b});return w.length};l.pop=function(){if(~w.length){var b=w.length-1,e=w.pop();delete l[b];"function"===typeof q&&q({object:l,type:"delete",name:"length",
index:b,newValue:w.length,oldValue:b});return e}};l.unshift=function(){for(var b=w.length,e=0,d=arguments.length;e<d;e++)w.splice(e,0,arguments[e]),l.defineIndexProperty(w.length-1);"function"===typeof q&&q({object:l,type:"add",index:0,name:"length",newValue:w.length,oldValue:b});return w.length};l.shift=function(){var b=w.length;if(~w.length){var e=w.shift();0===w.length&&delete l[b];"function"===typeof q&&q({object:l,type:"delete",index:b,name:"length",newValue:w.length,oldValue:b});return e}};
l.slice=function(b,e,d){b=w.slice(b,e);return new c.jqx.observableArray(b,d)};l.splice=function(b,e,d){var f=[],g;b=~b?b:w.length-b;for(e=(null==e?w.length-b:e)||0;e--;)g=w.splice(b,1)[0],f.push(g),delete l[w.length],"function"===typeof q&&q({object:l,type:"delete",index:b,name:"length",newValue:-1,oldValue:b});g=2;for(var h=arguments.length;g<h;g++)w.splice(b,0,arguments[g]),defineIndexProperty(w.length-1),"function"===typeof q&&q({object:l,type:"add",index:b,name:"length",newValue:w.length-1,oldValue:b}),
b++;return new c.jqx.observableArray(f,d)};Object.defineProperty(l,"length",{configurable:!1,enumerable:!0,get:function(){return w.length},set:function(b){var e=Number(b);if(0===e%1&&0<=e)e<w.length?l.splice(e):e>w.length&&l.push.apply(l,Array(e-w.length));else throw new RangeError("Invalid array length");return b}});c.jqx.observableArray.prototype.fromArray=function(b,e){return new c.jqx.observableArray(b,e)};c.jqx.observableArray.prototype.clone=function(){var b=new c.jqx.observableArray(w,e);b.observing=
l.observing;b.changes=l.changes;b.notifier=l.notifier;return b};l.remove=function(b){if(0>b||b>=l.length)throw Error("Invalid index : "+b);if(l.hasOwnProperty(b)){var e=l[b];l[b]=void 0;w[b]=void 0;"function"===typeof q&&q({object:l,type:"delete",index:b,name:"index",newValue:void 0,oldValue:e});return!0}return!1};l.concat=function(b,e){var d=w.concat(b);return new c.jqx.observableArray(d,e)};Object.getOwnPropertyNames(Array.prototype).forEach(function(b){b in l||Object.defineProperty(l,b,{configurable:!1,
enumerable:!0,writeable:!1,value:function(){var e=l.observing;l.observing=!1;var d=w[b].apply(w,arguments);l.observing=e;return d}})});l.set=function(b,e){if("string"==c.type(b)&&1<b.split(".").length){for(var d=b.split("."),f=l,g=0;g<d.length;g++){if(0===g&&d[g]>=l.length)throw Error("Invalid Index: "+b);g<d.length-1?f=f[d[g]]:f[d[g]]=e}return!0}b>=l.length?l.push(e):l[b]=e;return!0};l.get=function(b){return l[b]};b instanceof Array&&l.push.apply(l,b);q=function(){l.observing&&(arguments&&arguments[0]&&
l.changes.push(arguments[0]),e&&e.apply(l,arguments),l.notifier&&l.notifier.apply(l,arguments))};return l};c.jqx.formatDate=function(b,e,d){return c.jqx.dataFormat.formatdate(b,e,d)};c.jqx.formatNumber=function(b,e,d){return c.jqx.dataFormat.formatnumber(b,e,d)};c.jqx.dataAdapter=function(b,e){void 0!=b&&(void 0!==b.dataFields&&(b.datafields=b.dataFields),void 0!==b.dataType&&(b.datatype=b.dataType),void 0!==b.localData&&(b.localdata=b.localData),void 0!==b.sortColumn&&(b.sortcolumn=b.sortColumn),
void 0!==b.sortDirection&&(b.sortdirection=b.sortDirection),void 0!==b.sortColumns&&(b.sortcolumns=b.sortColumns),void 0!==b.sortDirections&&(b.sortdirections=b.sortDirections),void 0!==b.sortOrder&&(b.sortdirection=b.sortOrder),void 0!==b.formatData&&(b.formatdata=b.formatData),void 0!==b.processData&&(b.processdata=b.processData),void 0!==b.pageSize&&(b.pagesize=b.pageSize),void 0!==b.pageNum&&(b.pagenum=b.pageNum),void 0!==b.updateRow&&(b.updaterow=b.updateRow),void 0!==b.addRow&&(b.addrow=b.addRow),
void 0!==b.deleteRow&&(b.deleterow=b.deleteRow),void 0!==b.contentType&&(b.contenttype=b.contentType),void 0!=b.totalRecords&&(b.totalrecords=b.totalRecords),void 0!=b.loadError&&(b.loadError=b.loadError),void 0!=b.sortComparer&&(b.sortcomparer=b.sortComparer));this._source=b;this._options=e||{};void 0!=b.beforeLoadComplete&&(this._options.beforeLoadComplete=this._source.beforeLoadComplete);void 0!=b.downloadComplete&&(this._options.downloadComplete=this._source.downloadComplete);void 0!=b.loadComplete&&
(this._options.loadComplete=this._source.loadComplete);void 0!=b.autoBind&&(this._options.downloadComplete=this._source.autoBind);void 0!=b.formatData&&(this._options.formatData=this._source.formatData);void 0!=b.loadError&&(this._options.loadError=this._source.loadError);void 0!=b.beforeSend&&(this._options.beforeSend=this._source.beforeSend);void 0!=b.contentType&&(this._options.contentType=this._source.contentType);void 0!=b.async&&(this._options.async=this._source.async);void 0!=b.loadServerData&&
(this._options.loadServerData=this._source.loadServerData);void 0!=b.uniqueDataFields&&(this._options.uniqueDataFields=this._source.uniqueDataFields);this.records=[];this._downloadComplete=[];this._bindingUpdate=[];if(void 0!=b&&null!=b.localdata&&"function"==typeof b.localdata){var d=b.localdata();if(null!=d){b._localdata=b.localdata;var f=this;b._localdata.subscribe&&(f._oldlocaldata=[],b._localdata.subscribe(function(b){var e=function(b){return c.isArray(b)?c.makeArray(e(c(b))):c.extend(!0,{},
b)};if(0==f.suspendKO||void 0==f.suspendKO||0==f._oldlocaldata.length)f._oldlocaldata=e(b)},b._localdata,"beforeChange"),b._localdata.subscribe(function(e){if(0==f.suspendKO||void 0==f.suspendKO){var d="";f._oldrecords=f.records;0==f._oldlocaldata.length&&(b.localdata=b._localdata());0==f._oldlocaldata.length?d="change":e&&(f._oldlocaldata.length==e.length&&(d="update"),f._oldlocaldata.length>e.length&&(d="remove"),f._oldlocaldata.length<e.length&&(d="add"));f.dataBind(null,d)}},b._localdata,"change"),
f._knockoutdatasource=!0);b.localdata=d}}1==this._options.autoBind&&this.dataBind()};c.jqx.dataAdapter.prototype={getrecords:function(){return this.records},beginUpdate:function(){this.isUpdating=!0},endUpdate:function(b){this.isUpdating=!1;0!=b&&(this._changedrecords&&0<this._changedrecords.length?(this.callBindingUpdate("update"),this._changedrecords=[]):this.dataBind(null,""))},formatDate:function(b,e,d){return c.jqx.dataFormat.formatdate(b,e,d)},formatNumber:function(b,e,d){return c.jqx.dataFormat.formatnumber(b,
e,d)},dataBind:function(b,e){if(1!=this.isUpdating){var d=this._source;if(d){d.generatedfields&&(d.datafields=null,d.generatedfields=null);c.jqx.dataFormat.datescache=[];null!=d.dataFields&&(d.datafields=d.dataFields);void 0==d.recordstartindex&&(d.recordstartindex=0);void 0==d.recordendindex&&(d.recordendindex=0);void 0==d.loadallrecords&&(d.loadallrecords=!0);void 0==d.root&&(d.root="");void 0==d.record&&(d.record="");void 0!=d.sort&&(this.sort=d.sort);this.filter=void 0!=d.filter?d.filter:null;
void 0!=d.sortcolumn&&(this.sortcolumn=d.sortcolumn);void 0!=d.sortdirection&&(this.sortdirection=d.sortdirection);void 0!=d.sortcolumns&&(this.sortcolumns=d.sortcolumns);void 0!=d.sortdirections&&(this.sortdirections=d.sortdirections);void 0!=d.sortcomparer&&(this.sortcomparer=d.sortcomparer);this.records=[];var f=this._options||{};this.virtualmode=void 0!=f.virtualmode?f.virtualmode:!1;this.totalrecords=void 0!=f.totalrecords?f.totalrecords:0;this.pageable=void 0!=f.pageable?f.pageable:!1;this.pagesize=
void 0!=f.pagesize?f.pagesize:0;this.pagenum=void 0!=f.pagenum?f.pagenum:0;this.cachedrecords=void 0!=f.cachedrecords?f.cachedrecords:[];this.originaldata=[];this.recordids=[];this.updaterow=void 0!=f.updaterow?f.updaterow:null;this.addrow=void 0!=f.addrow?f.addrow:null;this.deleterow=void 0!=f.deleterow?f.deleterow:null;this.cache=void 0!=f.cache?f.cache:!1;this.unboundmode=!1;void 0!=d.formatdata&&(f.formatData=d.formatdata);void 0!=d.data&&(void 0==f.data&&(f.data={}),c.extend(f.data,d.data));
void 0!=d.mapChar&&(d.mapchar=d.mapChar);this.mapChar=void 0!=d.mapchar?d.mapchar?d.mapchar:">":f.mapChar?f.mapChar:">";if(f.unboundmode||d.unboundmode)this.unboundmode=f.unboundmode||d.unboundmode;void 0!=d.cache&&(this.cache=d.cache);if(this.koSubscriptions)for(var g=0;g<this.koSubscriptions.length;g++)this.koSubscriptions[g].dispose();this.koSubscriptions=[];0>this.pagenum&&(this.pagenum=0);var h=this,l=d.datatype;if("csv"===d.datatype||"tab"===d.datatype||"tsv"===d.datatype||"text"==d.datatype)l=
"text";g=void 0!=f.async?f.async:!0;void 0!=d.async&&(g=d.async);switch(l){default:if(void 0==d.localdata&&d.length){d.localdata=[];for(var q=0;q<d.length;q++)d.localdata[d.localdata.length]=d[q],d[q].uid=q}d.beforeprocessing&&c.isFunction(d.beforeprocessing)&&d.beforeprocessing(d.localdata);g=d.localdata.length;this.totalrecords=this.virtualmode?d.totalrecords||g:g;if(this.unboundmode){this.totalrecords=this.unboundmode?d.totalrecords||g:g;var w=d.datafields?d.datafields.length:0;if(0<w)for(q=0;q<
this.totalrecords;q++){for(var z={},g=0;g<w;g++)z[d.datafields[g].name]="";z.uid=q;d.localdata[d.localdata.length]=z}}void 0==this.totalrecords&&(this.totalrecords=0);var w=d.datafields?d.datafields.length:0,r=function(b,e){for(var f={},g=0;g<e;g++){var l=d.datafields?d.datafields[g]:{},q="";if(void 0!=l&&null!=l){if(l.map){if(c.isFunction(l.map))q=l.map(b);else if(q=l.map.split(h.mapChar),0<q.length){for(var w=b,z=0;z<q.length;z++)w&&(w=w[q[z]]);q=w}else q=b[l.map];void 0!=q&&null!=q?q=q.toString():
void 0==q&&null!=q&&(q="")}w=!1;""==q&&(w=!0,q=b[l.name],void 0!=q&&null!=q&&(d._localdata&&q.subscribe?q=q():"array"!=l.type&&"date"!==l.type&&(q=q.toString())));"[object Object]"==q&&l.map&&w&&(q="");q=h.getvaluebytype(q,l);void 0!=l.displayname?f[l.displayname]=q:f[l.name]=q}}return f};if(d._localdata)if(this._changedrecords=[],this.records=[],q=d._localdata(),c.each(q,function(b,f){if("string"===typeof f)h.records.push(f);else{var g={},l=0,q=this;c.each(this,function(e,f){var z=null,r="string",
t=e;if(0<w){for(var C=!1,D=!1,y=0;y<w;y++){var A=d.datafields[y];if(void 0!=A&&A.name==e){C=!0;z=A.map;r=A.type;t=A.name;break}else if(void 0!=A&&A.map&&0<=A.map.indexOf(e)){C=!0;z=A.map;r=A.type;t=A.name;D=!0;A=q[e];if(null!=z)if(A=z.split(h.mapChar),0<A.length){for(var v=q,E=0;E<A.length;E++)v=v[A[E]];A=v}else A=q[z];"string"!=r&&(A=h.getvaluebytype(A,{type:r}));g[t]=A;void 0!=g[t]&&(l+=g[t].toString().length+g[t].toString().substr(0,1))}}if(!C||D)return!0}if(c.isFunction(q[e]))A=q[e](),"string"!=
r&&(A=h.getvaluebytype(A,{type:r})),g[e]=A,q[e].subscribe&&(h.koSubscriptions[h.koSubscriptions.length]=q[e].subscribe(function(d){g[e]=d;h._changedrecords.push({index:b,oldrecord:g,record:g});if(!h.isUpdating)return h.callBindingUpdate("update"),h._changedrecords=[],!1}));else{A=q[e];if(null!=z)if(A=z.split(h.mapChar),0<A.length){v=q;for(E=0;E<A.length;E++)v=v[A[E]];A=v}else A=q[z];"string"!=r&&(A=h.getvaluebytype(A,{type:r}));g[t]=A;void 0!=g[t]&&(l+=g[t].toString().length+g[t].toString().substr(0,
1))}});var z=h.getid(d.id,q,b);g.uid=z;h.records.push(g);g._koindex=l;h._oldrecords&&(z=h.records.length-1,"update"==e&&h._oldrecords[z]._koindex!=l&&h._changedrecords.push({index:z,oldrecord:h._oldrecords[z],record:g}))}}),"add"==e)for(g=h.records.length,q=0;q<g;q++){for(var z=h.records[q],t=!1,C=0;C<h._oldrecords.length;C++)if(h._oldrecords[C]._koindex===z._koindex){t=!0;break}t||h._changedrecords.push({index:q,oldrecord:null,record:z,position:0!=q?"last":"first"})}else{if("remove"==e)for(g=h._oldrecords.length,
q=0;q<g;q++)z=h._oldrecords[q],h.records[q]?h.records[q]._koindex!=z._koindex&&h._changedrecords.push({index:q,oldrecord:z,record:null}):h._changedrecords.push({index:q,oldrecord:z,record:null})}else if(c.isArray(d.localdata))0==w?(D=0,y=[],c.each(d.localdata,function(b,e){var f=Object(this);if("string"===typeof e)return h.records=d.localdata,!1;var g=h.getid(d.id,f,b);"object"===typeof g&&(g=b);f.uid=g;if(0==b){for(var l in this){D++;var q=c.type(this[l]);y.push({name:l,type:q})}w=D;d.datafields=
y;d.generatedfields=y}0<w&&(f=r(f,w),f.uid=g);h.records[h.records.length]=f})):c.each(d.localdata,function(b){var e=r(this,w),f=h.getid(d.id,e,b);"object"===typeof f&&(f=b);b=Object(e);b.uid=f;h.records[h.records.length]=b});else{this.records=[];var D=0,y=[];c.each(d.localdata,function(b){b=h.getid(d.id,this,b);if(0==w&&!("string"===typeof this||this instanceof String)){for(var e in this){D++;var f=c.type(this[e]);y.push({name:e,type:f})}w=D;d.datafields=y;d.generatedfields=y}0<w?(e=r(this,w),e.uid=
b,h.records[h.records.length]=e):(this.uid=b,h.records[h.records.length]=this)})}this.originaldata=d.localdata;this.cachedrecords=this.records;this.addForeignValues(d);f.uniqueDataFields&&(this.cachedrecords=this.records=q=this.getUniqueRecords(this.records,f.uniqueDataFields));f.beforeLoadComplete&&(q=f.beforeLoadComplete(h.records,this.originaldata),void 0!=q&&(h.records=q,h.cachedrecords=q));f.autoSort&&f.autoSortField&&(q=Object.prototype.toString,Object.prototype.toString="function"==typeof field?
field:function(){return this[f.autoSortField]},h.records.sort(function(b,e){void 0===b&&(b=null);void 0===e&&(e=null);if(null===b&&null===e)return 0;if(null===b&&null!==e)return 1;if(null!==b&&null===e)return-1;b=b.toString();e=e.toString();if(null===b&&null===e)return 0;if(null===b&&null!==e)return 1;if(null!==b&&null===e)return-1;if(c.jqx.dataFormat.isNumber(b)&&c.jqx.dataFormat.isNumber(e)||c.jqx.dataFormat.isDate(b)&&c.jqx.dataFormat.isDate(e))return b<e?-1:b>e?1:0;c.jqx.dataFormat.isNumber(b)||
c.jqx.dataFormat.isNumber(e)||(b=String(b).toLowerCase(),e=String(e).toLowerCase());return b<e?-1:b>e?1:0}),Object.prototype.toString=q);h.loadedData=d.localdata;h.buildHierarchy();c.isFunction(f.loadComplete)&&f.loadComplete(d.localdata,h.records);break;case "json":case "jsonp":case "xml":case "xhtml":case "script":case "text":case "ics":if(null!=d.localdata&&!d.url){c.isFunction(d.beforeprocessing)&&d.beforeprocessing(d.localdata);"xml"===d.datatype?h.loadxml(d.localdata,d.localdata,d):"text"===
l?h.loadtext(d.localdata,d):"ics"===l?h.loadics(d.localdata,d):h.loadjson(d.localdata,d.localdata,d);h.addForeignValues(d);f.uniqueDataFields&&(q=h.getUniqueRecords(h.records,f.uniqueDataFields),h.records=q,h.cachedrecords=q);f.beforeLoadComplete&&(q=f.beforeLoadComplete(h.records,this.originaldata),void 0!=q&&(h.records=q,h.cachedrecords=q));h.loadedData=d.localdata;h.buildHierarchy.call(h);c.isFunction(f.loadComplete)&&f.loadComplete(d.localdata,h.records);h.callBindingUpdate(e);return}z=void 0!=
f.data?f.data:{};d.processdata&&d.processdata(z);c.isFunction(f.processData)&&f.processData(z);c.isFunction(f.formatData)&&(t=f.formatData(z),void 0!=t&&(z=t));t="application/x-www-form-urlencoded";f.contentType&&(t=f.contentType);C="GET";d.type&&(C=d.type);f.type&&(C=f.type);var A=l;"ics"==l&&(A="text");d.url&&0<d.url.length?c.isFunction(f.loadServerData)?h._requestData(z,d,f):this.xhr=c.jqx.data.ajax({dataType:A,cache:this.cache,type:C,url:d.url,async:g,timeout:d.timeout,contentType:t,data:z,success:function(b,
e,g){if(c.isFunction(d.beforeprocessing)){var q=d.beforeprocessing(b,e,g);void 0!=q&&(b=q)}c.isFunction(f.downloadComplete)&&(q=f.downloadComplete(b,e,g),void 0!=q&&(b=q));null==b?(h.records=[],h.cachedrecords=[],h.originaldata=[],h.callDownloadComplete(),c.isFunction(f.loadComplete)&&f.loadComplete([])):(q=b,b.records&&(q=b.records),void 0!=b.totalrecords?d.totalrecords=b.totalrecords:void 0!=b.totalRecords&&(d.totalrecords=b.totalRecords),"xml"===d.datatype?h.loadxml(null,q,d):"text"===l?h.loadtext(q,
d):"ics"===l?h.loadics(q,d):h.loadjson(null,q,d),h.addForeignValues(d),f.uniqueDataFields&&(q=h.getUniqueRecords(h.records,f.uniqueDataFields),h.records=q,h.cachedrecords=q),f.beforeLoadComplete&&(q=f.beforeLoadComplete(h.records,b),void 0!=q&&(h.records=q,h.cachedrecords=q)),h.loadedData=b,h.buildHierarchy.call(h),h.callDownloadComplete(),c.isFunction(f.loadComplete)&&f.loadComplete(b,e,g,h.records))},error:function(b,e,g){c.isFunction(d.loaderror)&&d.loaderror(b,e,g);c.isFunction(f.loadError)&&
f.loadError(b,e,g);h.callDownloadComplete()},beforeSend:function(b,e){c.isFunction(f.beforeSend)&&f.beforeSend(b,e);c.isFunction(d.beforesend)&&d.beforesend(b,e)}}):(h.buildHierarchy([]),h.callDownloadComplete(),c.isFunction(f.loadComplete)&&(q||(q={}),f.loadComplete(q)))}this.callBindingUpdate(e)}}},buildHierarchy:function(b){var e=this._source,d=[];if(e.datafields){if(e.hierarchy&&!e.hierarchy.reservedNames)e.hierarchy.reservedNames={leaf:"leaf",parent:"parent",expanded:"expanded",checked:"checked",
selected:"selected",level:"level",icon:"icon",data:"data"};else if(e.hierarchy){var f=e.hierarchy.reservedNames;f.leaf||(f.leaf="leaf");f.parent||(f.parent="parent");f.expanded||(f.expanded="expanded");f.checked||(f.checked="checked");f.selected||(f.selected="selected");f.level||(f.level="level");f.data||(f.data="data")}if(e.hierarchy){var c=this,f=e.hierarchy.reservedNames;if(e.hierarchy.root){if("xml"==e.dataType)return this.hierarchy=d=this.getRecordsHierarchy("uid","parentuid","records",null,
b);this.hierarchy=this.records;for(var g=e.hierarchy.root,d=0;d<this.records.length;d++)if(b=this.records[d]){var h=function(b){if(e.hierarchy.record)b.records=b[g][e.hierarchy.record];else{var d=g.split(c.mapChar);if(1<d.length){for(var h=b,l=0;l<d.length;l++)void 0!=h&&(h=h[d[l]]);d=h}else d=b[g];b.records=d}if(null==b.records||b.records&&0==b.records.length)b[f.leaf]=!0};h(b);b[f.level]=0;var l=this.getid(e.id,b,d);b.uid=l;b[f.parent]=null;b[f.data]=b;void 0===b[f.expanded]&&(b[f.expanded]=!1);
var q=function(b,d){if(d)for(var g=0;g<d.length;g++){var l=d[g];if(l){h(l);l[f.level]=b[f.level]+1;l[f.parent]=b;l[f.data]=l;var w=c.getid(e.id,l,g);l.uid=w==g&&null==e.id?b.uid+"_"+w:w;void 0===l[f.expanded]&&(l[f.expanded]=!1);q(l,l.records)}}else b.records=[]};q(b,b.records)}return this.hierarchy}if(e.hierarchy.keyDataField&&e.hierarchy.parentDataField)return this.hierarchy=d=this.getRecordsHierarchy(e.hierarchy.keyDataField.name,e.hierarchy.parentDataField.name,"records",null,b);if(e.hierarchy.groupingDataFields){l=
[];for(d=0;d<e.hierarchy.groupingDataFields.length;d++)l.push(e.hierarchy.groupingDataFields[d].name);return this.hierarchy=d=this.getGroupedRecords(l,"records","label",null,"data",null,"parent",b)}}}},addRecord:function(b,e,d,f){var c=this,g=function(){return{leaf:"leaf",parent:"parent",expanded:"expanded",checked:"checked",selected:"selected",level:"level",icon:"icon",data:"data"}};if(void 0!=b)if(void 0!=d){if(0<this.hierarchy.length){var h=function(f){if(f)for(var l=0;l<f.length;l++){var q=f[l];
if(q.uid==d)return f=c._source&&c._source.hierarchy?c._source.hierarchy.reservedNames:null,null==f&&(f=g()),b[f.parent]=q,b[f.level]=q[f.level]+1,q.records||(q.records=[]),q[f.leaf]=!1,"last"==e?q.records.push(b):"number"===typeof e&&isFinite(e)?q.records.splice(e,0,b):q.records.splice(0,0,b),!0;q.records&&h(q.records)}};h(this.hierarchy)}}else return this.hierarchy&&0<=this.hierarchy.length&&(this._source.hierarchy||f)?(f=c._source&&c._source.hierarchy?c._source.hierarchy.reservedNames:null,null==
f&&(f=g()),b[f.level]=0,"last"==e?this.hierarchy.push(b):"number"===typeof e&&isFinite(e)?this.hierarchy.splice(e,0,b):this.hierarchy.splice(0,0,b)):"last"==e?this.records.push(b):"number"===typeof e&&isFinite(e)?this.records.splice(e,0,b):this.records.splice(0,0,b),!0;return!1},deleteRecord:function(b){var e=this;if(0<this.hierarchy.length){var d=function(f){if(f)for(var c=0;c<f.length;c++){var g=f[c];if(g.uid==b){f.splice(c,1);e.recordids[b]&&delete e.recordids[b];var h=function(b){for(var d=0;d<
b.length;d++){for(var f=b[d].uid,c=0;c<e.records.length;c++)if(e.records[c].uid==f){e.records.splice(c,1);break}b[d].records&&h(b[d].records)}};g.records&&h(g.records);for(f=0;f<e.records.length;f++)if(g=e.records[f],g.uid==b){e.records.splice(f,1);break}return!0}g.records&&d(g.records)}};d(this.hierarchy)}else for(var f=0;f<this.records.length;f++)if(this.records[f].uid==b)return this.records.splice(f,1),!0;return!1},addForeignValues:function(b){for(var e=b.datafields?b.datafields.length:0,d=0;d<
e;d++){var f=b.datafields[d];if(void 0!=f)if(void 0!=f.values){void 0==f.value&&(f.value=f.name);void 0==f.values.value&&(f.values.value=f.value);var c=[],g,h;this.pageable&&this.virtualmode?(g=this.pagenum*this.pagesize,h=g+this.pagesize,h>this.totalrecords&&(h=this.totalrecords)):this.virtualmode?(g=b.recordstartindex,h=b.recordendindex,h>this.totalrecords&&(h=this.totalrecords)):(g=0,h=this.records.length);for(;g<h;g++){var l=this.records[g],q=f.name,w=l[f.value];if(void 0!=c[w])l[q]=c[w];else for(var z=
0;z<f.values.source.length;z++){var r=f.values.source[z],t=r[f.values.value];void 0==t&&(t=r.uid);if(t==w){z=r[f.values.name];l[q]=z;c[w]=z;break}}}}else if(void 0!=f.value)for(g=0;g<this.records.length;g++)l=this.records[g],l[f.name]=l[f.value]}},abort:function(){this.xhr&&4!=this.xhr.readyState&&(this.xhr.abort(),me.callDownloadComplete())},_requestData:function(b,e,d){var f=this;d.loadServerData(b,e,function(b){b.totalrecords&&(e.totalrecords=b.totalrecords,f.totalrecords=b.totalrecords);b.records&&
(f.records=b.records,f.cachedrecords=b.records);f.addForeignValues(e);if(d.uniqueDataFields){var g=f.getUniqueRecords(f.records,d.uniqueDataFields);f.records=g;f.cachedrecords=g}d.beforeLoadComplete&&(g=d.beforeLoadComplete(f.records,b),void 0!=g&&(f.records=g,f.cachedrecords=g));for(g=0;g<f.records.length;g++){var h=f.records[g];void 0!=h&&void 0==h.uid&&(h.uid=f.getid(e.id,h,g))}f.buildHierarchy.call(f);c.isFunction(d.loadComplete)&&d.loadComplete(b);f.callDownloadComplete()})},getUniqueRecords:function(b,
e){if(b&&e)for(var d=b.length,f=e.length,c=[],g=[],h=0;h<d;h++){var l=b[h],q="";if(void 0!=l){for(var w=0;w<f;w++)q+=l[e[w]]+"_";g[q]||(c[c.length]=l);g[q]=!0}}return c},getAggregatedData:function(b,e,d,f){var g=d;g||(g=this.records);var h={};d=[];var l=g.length;if(0!=l&&void 0!=l){for(var q=0;q<l;q++)for(var w=g[q],z=0;z<b.length;z++){var r=b[z],t=w[r.name];if(r.aggregates){h[r.name]=h[r.name]||{};d[r.name]=d[r.name]||0;d[r.name]++;var C=function(b){for(obj in b){var e=h[r.name][obj];null==e&&(e=
h[r.name][obj]=0);c.isFunction(b[obj])&&(e=b[obj](e,t,r.name,w,f));h[r.name][obj]=e}},D=parseFloat(t);(D=isNaN(D)?!1:!0)&&(t=parseFloat(t));"number"===typeof t&&isFinite(t)?c.each(r.aggregates,function(){var b=h[r.name][this];null==b&&(b=0,"min"==this&&(b=9999999999999),"max"==this&&(b=-9999999999999));if("sum"==this||"avg"==this||"stdev"==this||"stdevp"==this||"var"==this||"varp"==this)b+=parseFloat(t);else if("product"==this)b=0==q?parseFloat(t):b*parseFloat(t);else if("min"==this)b=Math.min(b,
parseFloat(t));else if("max"==this)b=Math.max(b,parseFloat(t));else if("count"==this)b++;else if("object"==typeof this){C(this);return}h[r.name][this]=b}):c.each(r.aggregates,function(){if("min"==this||"max"==this||"count"==this||"product"==this||"sum"==this||"avg"==this||"stdev"==this||"stdevp"==this||"var"==this||"varp"==this){if(null===t)return!0;var b=h[r.name][this];null==b&&(b=0);h[r.name][this]=b;return!0}"object"==typeof this&&C(this)})}}for(z=0;z<b.length;z++)r=b[z],h[r.name]||(h[r.name]=
{},c.each(r.aggregates,function(b){h[r.name][this]=0})),void 0!=h[r.name].avg?(t=h[r.name].avg,D=d[r.name],h[r.name].avg=0===D||void 0==D?0:t/D):void 0!=h[r.name].count&&(h[r.name].count=l),(h[r.name].stdev||h[r.name].stdevp||h[r.name]["var"]||h[r.name].varp)&&c.each(r.aggregates,function(b){if("stdev"==this||"var"==this||"varp"==this||"stdevp"==this){for(var e=h[r.name][this]/l,d=b=0;d<l;d++){var f=g[d][r.name];b+=(f-e)*(f-e)}e="stdevp"==this||"varp"==this?l:l-1;0==e&&(e=1);if("var"==this||"varp"==
this)h[r.name][this]=b/e;else if("stdevp"==this||"stdev"==this)h[r.name][this]=Math.sqrt(b/e)}}),r.formatStrings&&c.each(r.aggregates,function(b){if(b=r.formatStrings[b])if("min"==this||"max"==this||"count"==this||"product"==this||"sum"==this||"avg"==this||"stdev"==this||"stdevp"==this||"var"==this||"varp"==this){var d=h[r.name][this];h[r.name][this]=c.jqx.dataFormat.formatnumber(d,b,e)}else if("object"==typeof this)for(obj in this)d=h[r.name][obj],h[r.name][obj]=c.jqx.dataFormat.formatnumber(d,b,
e)});return h}},bindDownloadComplete:function(b,e){this._downloadComplete[this._downloadComplete.length]={id:b,func:e}},unbindDownloadComplete:function(b){for(var e=0;e<this._downloadComplete.length;e++)if(this._downloadComplete[e].id==b){this._downloadComplete[e].func=null;this._downloadComplete.splice(e,1);break}},callDownloadComplete:function(){for(var b=0;b<this._downloadComplete.length;b++){var e=this._downloadComplete[b];null!=e.func&&e.func()}},setSource:function(b){this._source=b},generatekey:function(){var b=
function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()},getGroupedRecords:function(b,e,d,f,g,h,l,q,w){w||(w=0);for(var z=[],r=0;r<b.length;r++)z[r]=this.generatekey();e||(e="items");d||(d="group");g||(g="record");l||(l="parentItem");void 0===h&&(h="value");var t=[],C=0,D=[],A=b.length;q||(q=this.records);for(var y=q.length,v=function(b){f&&c.each(f,function(){this.name&&this.map&&(b[this.map]=b[this.name])});return b},E=0;E<y;E++){var F=
v(q[E]);id=F[this.uniqueId];for(var B=[],G=0,r=0;r<A;r++){var I=F[b[r]];null!=I&&(B[G++]={value:I,hash:z[r]})}if(B.length!=A)break;for(var r=null,G="",I=-1,M=0;M<B.length;M++){I++;var W=B[M].value,G=G+"_"+B[M].hash+"_"+W;if(void 0!=D[G]&&null!=D[G])r=D[G];else{if(null==r){r={level:0};r[l]=null;r[d]=W;r[g]=F;r.expanded=void 0!==F.expanded?F.expanded:!1;h&&(r[h]=F[h]);r[e]=[];W=t.length+w;if(!this._source.id||"number"===typeof F.uid||isFinite(F.uid))W="Row"+W;r.uid=W;t[C++]=r}else{var Z={level:r.level+
1};Z[l]=r;Z[d]=W;Z[e]=[];Z[g]=F;Z.expanded=void 0!==F.expanded?F.expanded:!1;h&&(Z[h]=F[h]);Z.uid=r.uid+"_"+r[e].length;r=r[e][r[e].length]=Z}D[G]=r}}F&&(F.leaf=!0);null!=r?(null==this._source.id&&(void 0==F.uid?F.uid=r.uid+"_"+r[e].length:-1==F.uid.toString().indexOf(r.uid)&&(F.uid=r.uid+"_"+F.uid)),F[l]=r,F.level=r.level+1,r[e][r[e].length]=F):void 0==F.uid&&(F.uid=this.generatekey())}return t},getRecordsHierarchy:function(b,e,d,f,g){var h=[],l=this.records;g&&(l=g);if(0==this.records.length)return null;
var q=null!=d?d:"items";d=[];g=l.length;for(var w=this._source&&this._source.hierarchy?this._source.hierarchy.reservedNames:null,z=function(b){f&&c.each(f,function(){this.name&&this.map&&(b[this.map]=b[this.name])});return b},r=0;r<g;r++){var t=c.extend({},l[r]),C=t[e],D=t[b];d[D]={parentid:C,item:t}}for(r=0;r<g;r++)if(t=c.extend({},l[r]),C=t[e],D=t[b],void 0!=d[C]){var t={parentid:C,item:d[D].item},A=d[C].item;A[q]||(A[q]=[]);var y=A[q].length,v=t.item;w?void 0==v[w.parent]&&(v[w.parent]=A):void 0==
v.parent&&(v.parent=A);v=z(v);A[q][y]=v;d[C].item=A;d[D]=t}else v=d[D].item,w?void 0==v[w.parent]&&(v[w.parent]=null):void 0==v.parent&&(v.parent=null),v=z(v),w?v[w.level]=0:v.level=0,h[h.length]=v;if(0!=h.length){var E=function(b,e){for(var d=0;d<e.length;d++){w?e[d][w.level]=b:e[d].level=b;var f=e[d][q];f?0<f.length?E(b+1,f):w?e[d][w.leaf]=!0:e[d].leaf=!0:w?e[d][w.leaf]=!0:e[d].leaf=!0}};E(0,h)}return h},bindBindingUpdate:function(b,e){this._bindingUpdate[this._bindingUpdate.length]={id:b,func:e}},
unbindBindingUpdate:function(b){for(var e=0;e<this._bindingUpdate.length;e++)if(this._bindingUpdate[e].id==b){this._bindingUpdate[e].func=null;this._bindingUpdate.splice(e,1);break}},callBindingUpdate:function(b){for(var e=0;e<this._bindingUpdate.length;e++){var d=this._bindingUpdate[e];null!=d.func&&d.func(b)}},getid:function(b,e,d){if(null!=b&&void 0!=b.name&&b.name){var f=c(e).attr(b.name);if(null!=f&&0<f.toString().length)return f;if(b.map)try{f=c(e).attr(b.map);if(null!=f&&0<f.toString().length)return f;
if(0<c(b.map,e).length)return c(b.map,e).text();if(0<c(b.name,e).length)return c(b.name,e).text()}catch(g){return d}}else{if(0<c(b,e).length)return c(b,e).text();if(b&&0<b.toString().length){f=c(e).attr(b);if(null!=f&&0<f.toString().length)return c.trim(f).split(" ").join("").replace(/([ #;?%&,.+*~\':"!^$[\]()=>|\/\\@])/g,"");f=b.split(this.mapChar);if(1<f.length){b=e;for(e=0;e<f.length;e++)void 0!=b&&(b=b[f[e]]);if(void 0!=b)return b}else if(void 0!=e[b])return e[b]}return d}},loadjson:function(b,
e,d){"string"==typeof b&&(b=c.parseJSON(b));void 0==d.root&&(d.root="");void 0==d.record&&(d.record="");(b=b||e)||(b=[]);var f=this;if(""!=d.root){var g=d.root.split(f.mapChar);if(1<g.length){e=b;for(var h=0;h<g.length;h++)void 0!=e&&(e=e[g[h]]);b=e}else if(void 0!==b[d.root]?b=b[d.root]:b[0]&&void 0!==b[0][d.root]?b=b[0][d.root]:c.each(b,function(e){if(this==d.root)return b=this,!1;void 0!=this[d.root]&&(b=this[d.root])}),!b&&(g=d.root.split(f.mapChar),0<g.length)){e=b;for(h=0;h<g.length;h++)void 0!=
e&&(e=e[g[h]]);b=e}}else if(!b.length)for(obj in b)if(c.isArray(b[obj])){b=b[obj];break}null!=b&&void 0==b.length&&(b=c.makeArray(b));if(null==b||void 0==b||"undefined"==b||void 0==b.length)throw Error("jqxDataAdapter: JSON Parse error! Invalid JSON. Please, check your JSON or your jqxDataAdapter initialization!");if(0==b.length)this.totalrecords=0;else{e=b.length;this.totalrecords=this.virtualmode?d.totalrecords||e:e;this.records=[];this.originaldata=[];var l=this.records,q=this.pageable?this.pagesize*
this.pagenum:d.recordstartindex;this.recordids=[];d.loadallrecords&&(q=0,e=this.totalrecords);var w=0;this.virtualmode&&(w=q=this.pageable?this.pagesize*this.pagenum:d.recordstartindex,q=0,e=this.totalrecords);var z=d.datafields?d.datafields.length:0;if(0==z){var r=b[0],t=[];for(obj in r)t[t.length]={name:obj};d.datafields=t;d.generatedfields=d.datafields;z=t.length}for(t=r=q;t<e;t++){var C=b[t];if(void 0==C)break;if(d.record&&""!=d.record&&(C=C[d.record],void 0==C))continue;var D=this.getid(d.id,
C,t);"object"===typeof D&&(D=t);if(!this.recordids[D]){this.recordids[D]=C;for(var A={},y=0;y<z;y++){var v=d.datafields[y],g="";if(void 0!=v&&null!=v){if(v.map){if(c.isFunction(v.map))g=v.map(C);else if(g=v.map.split(f.mapChar),0<g.length){for(var E=C,h=0;h<g.length;h++)void 0!=E&&(E=E[g[h]]);g=E}else g=C[v.map];void 0!=g&&null!=g?g=this.getvaluebytype(g,v):void 0==g&&null!=g&&(g="")}""!=g||v.map||(g=C[v.name],void 0==g&&null!=g&&(g=""),void 0!=v.value&&void 0!=g&&(h=g[v.value],void 0!=h&&(g=h)));
g=this.getvaluebytype(g,v);void 0!=v.displayname?A[v.displayname]=g:A[v.name]=g;if("array"===v.type){var F=function(b){if(b)for(var e=0;e<b.length;e++){var g=b[e];if(g)for(var h=0;h<z;h++){var l=d.datafields[h],q="";if(void 0!=l&&null!=l){if(l.map){if(c.isFunction(l.map))q=l.map(g);else if(q=l.map.split(f.mapChar),0<q.length){for(var w=g,r=0;r<q.length;r++)void 0!=w&&(w=w[q[r]]);q=w}else q=g[l.map];void 0!=q&&null!=q?q=this.getvaluebytype(q,l):void 0==q&&null!=q&&(q="")}""!=q||l.map||(q=g[l.name],
void 0==q&&null!=q&&(q=""),void 0!=l.value&&void 0!=q&&(w=q[l.value],void 0!=w&&(q=w)));q=this.getvaluebytype(q,l);void 0!=l.displayname?g[l.displayname]=q:g[l.name]=q;"array"===l.type&&F.call(this,q)}}}};F.call(this,g)}}}if(0>=d.recordendindex||q<d.recordendindex)l[w+r]=Object(A),l[w+r].uid=D,this.originaldata[w+r]=Object(l[t]),r++}}this.cachedrecords=this.records=l}},loadxml:function(b,e,d){"string"==typeof b&&(e=c(c.parseXML(b)),b=null);void 0==d.root&&(d.root="");void 0==d.record&&(d.record="");
(b=c.jqx.browser.msie&&e?void 0!=e.xml?c(d.root+" "+d.record,c.parseXML(e.xml)):b||c(d.root+" "+d.record,e):b||c(d.root+" "+d.record,e))||(b=[]);e=b.length;if(0!=b.length){this.totalrecords=this.virtualmode?d.totalrecords||e:e;this.records=[];this.originaldata=[];var f=this.records,g=this.pageable?this.pagesize*this.pagenum:d.recordstartindex;this.recordids=[];d.loadallrecords&&(g=0,e=this.totalrecords);var h=0;this.virtualmode&&(h=g=this.pageable?this.pagesize*this.pagenum:d.recordstartindex,g=0,
e=this.totalrecords);var l=d.datafields?d.datafields.length:0;if(0==l){var q=b[0],w=[];for(obj in q)w[w.length]={name:obj};d.datafields=w;d.generatedfields=d.datafields;l=w.length}for(var z=g,q=g;q<e;q++){w=b[q];if(void 0==w)break;var r=this.getid(d.id,w,q);if(!this.recordids[r]){this.recordids[r]=w;var t={},C=!1;d.hierarchy&&d.hierarchy.root&&(C=!0);for(var D=0;D<l;D++){var A=d.datafields[D],y="";if(void 0!=A&&null!=A){if(A.map)if(c.isFunction(A.map))y=A.map(w);else{var v=A.map.indexOf("[");if(0>
v)if(y=c(A.map,w),1==y.length)y=y.text();else{for(var v=[],E=0;E<y.length;E++)v.push(c(y[E]).text());y=v;C&&0<v.length&&(y=v[0])}else y=A.map.substring(0,v-1),E=A.map.indexOf("]"),v=A.map.substring(v+1,E),y=c(y,w).attr(v),void 0==y&&(y=c(w).attr(v)),void 0==y&&(y="");""==y&&(y=c(w).attr(A.map),void 0==y&&(y=""))}if(""==y){y=c(A.name,w);if(1==y.length)y=y.text();else{v=[];for(E=0;E<y.length;E++)v.push(c(y[E]).text());y=v;C&&0<v.length&&(y=v[0])}""==y&&(y=c(w).attr(A.name),void 0==y&&(y=""));""==y&&
w.nodeName&&w.nodeName==A.name&&w.firstChild&&(y=c(w.firstChild).text())}y=this.getvaluebytype(y,A);void 0!=A.displayname?t[A.displayname]=y:t[A.name]=y}}if(0>=d.recordendindex||g<d.recordendindex)f[h+z]=c.extend({},t),f[h+z].uid=r,this.originaldata[h+z]=c.extend({},f[q]),z++}}if(d.hierarchy&&d.hierarchy.root)for(q=g;q<e;q++)w=b[q],g=f[q],0<c(w).parent().length?(r=this.getid(d.id,c(w).parents(d.hierarchy.record+":first")),g.parentuid=r):g.parentuid=null;this.cachedrecords=this.records=f}},loadics:function(b,
e){if(null!=b){var d=b.split(e.rowDelimiter||this.rowDelimiter||"\n"),f=d.length,c=b.split("\r");1==f&&1<c.length&&(d=c,f=d.length);this.records=[];this.originaldata=[];c=this.records;this.recordids=[];for(var g=function(b){var e=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z)?$/.exec(b);if(!e)throw Error("Invalid UNTIL value: "+b);return new Date(Date.UTC(e[1],e[2]-1,e[3],e[5]||0,e[6]||0,e[7]||0))},h=0;h<f;h++){var l=d[h];if("BEGIN:VEVENT"==l)var q={};else 0<=l.indexOf("SUMMARY")?q.SUMMARY=l.substring(l.indexOf("SUMMARY")+
8):0<=l.indexOf("LOCATION")?q.LOCATION=l.substring(l.indexOf("LOCATION")+9):0<=l.indexOf("DESCRIPTION")?q.DESCRIPTION=l.substring(l.indexOf("DESCRIPTION")+12):0<=l.indexOf("RRULE")?q.RRULE=l.substring(l.indexOf("RRULE")+6):0<=l.indexOf("EXDATE")?(l=l.substring(l.indexOf("EXDATE")+7),q.EXDATE=l):0<=l.indexOf("DTEND")?q.DTEND=g(l.substring(l.indexOf("DTEND")+6)):0<=l.indexOf("DTSTART")?q.DTSTART=g(l.substring(l.indexOf("DTSTART")+8)):0<=l.indexOf("UID")?q.uid=q.UID=l.substring(l.indexOf("UID")+4):0<=
l.indexOf("STATUS")?q.STATUS=l.substring(l.indexOf("STATUS")+7):"END:VEVENT"==l&&c.push(q)}this.cachedrecords=this.records=c}},loadtext:function(b,e){if(null!=b){var d=b.split(e.rowDelimiter||this.rowDelimiter||"\n"),f=d.length,g=b.split("\r");1==f&&1<g.length&&(d=g,f=d.length);this.totalrecords=this.virtualmode?e.totalrecords||f:f;this.records=[];this.originaldata=[];var g=this.records,h=this.pageable?this.pagesize*this.pagenum:e.recordstartindex;this.recordids=[];e.loadallrecords&&(h=0,f=this.totalrecords);
var l=0;this.virtualmode&&(l=h=this.pageable?this.pagesize*this.pagenum:e.recordstartindex,h=0,f=this.totalrecords);var q=e.datafields.length,w=e.columnDelimiter||this.columnDelimiter;for(w||(w="tab"===e.datatype||"tsv"===e.datatype?"\t":",");h<f;h++){var z=d[h],r=null;if(!this.recordids[r]){null==e.id&&(r=h,this.recordids[r]=z);for(var t={},C=d[h].split(w),D=0;D<q;D++)if(!(D>=C.length)){var y=e.datafields[D],A=C[D];y.map&&c.isFunction(y.map)&&(A=y.map(z));y.type&&(A=this.getvaluebytype(A,y));t[y.map||
y.name||D.toString()]=A;null!=e.id&&e.id===y.name&&(r=A,this.recordids[r]=z)}null==r&&(r=h);g[l+h]=c.extend({},t);g[l+h].uid=r;this.originaldata[l+h]=c.extend({},g[h])}}this.cachedrecords=this.records=g}},getvaluebytype:function(b,e){var d=b;if(null==b)return b;if(c.isArray(b)&&"array"!=e.type){for(d=0;d<b.length;d++)b[d]=this.getvaluebytype(b[d],e);return b}if("date"==e.type)if("NaN"==b)b="";else{if(b&&b instanceof Date)return b;var f=new Date(b);if("string"==typeof b&&e.format){var g=c.jqx.dataFormat.parsedate(b,
e.format);null!=g&&(f=g)}b="NaN"==f.toString()||"Invalid Date"==f.toString()?c.jqx.dataFormat?c.jqx.dataFormat.tryparsedate(b):f:f;null==b&&(b=d)}else if("float"==e.type||"number"==e.type||"decimal"==e.type)"NaN"==b?b="":(b=parseFloat(b),isNaN(b)&&(b=d));else if("int"==e.type||"integer"==e.type)b=parseInt(b),isNaN(b)&&(b=d);else if("bool"==e.type||"boolean"==e.type)null!=b&&void 0!=b.toLowerCase&&("false"==b.toLowerCase()?b=!1:"true"==b.toLowerCase()&&(b=!0)),b=1==b?!0:0==b&&""!==b?!1:"";return b}};
c.jqx.dataFormat={};c.extend(c.jqx.dataFormat,{regexTrim:/^\s+|\s+$/g,regexInfinity:/^[+-]?infinity$/i,regexHex:/^0x[a-f0-9]+$/i,regexParseFloat:/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/,toString:Object.prototype.toString,isBoolean:function(b){return"boolean"===typeof b},isObject:function(b){return b&&("object"===typeof b||c.isFunction(b))||!1},isDate:function(b){return b instanceof Date},arrayIndexOf:function(b,e){if(b.indexOf)return b.indexOf(e);for(var d=0,f=b.length;d<f;d++)if(b[d]===e)return d;return-1},
isString:function(b){return"string"===typeof b},isNumber:function(b){return"number"===typeof b&&isFinite(b)},isNull:function(b){return null===b},isUndefined:function(b){return"undefined"===typeof b},isValue:function(b){return this.isObject(b)||this.isString(b)||this.isNumber(b)||this.isBoolean(b)},isEmpty:function(b){if(!this.isString(b)&&this.isValue(b))return!1;if(!this.isValue(b))return!0;b=c.trim(b).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,"");return""===b},startsWith:function(b,e){return 0===
b.indexOf(e)},endsWith:function(b,e){return b.substr(b.length-e.length)===e},trim:function(b){return(b+"").replace(this.regexTrim,"")},isArray:function(b){return"[object Array]"===this.toString.call(b)},defaultcalendar:function(){return{"/":"/",":":":",firstDay:0,days:{names:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),namesAbbr:"Sun Mon Tue Wed Thu Fri Sat".split(" "),namesShort:"Su Mo Tu We Th Fr Sa".split(" ")},months:{names:"January February March April May June July August September October November December ".split(" "),
namesAbbr:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec ".split(" ")},AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss",ISO:"yyyy-MM-dd hh:mm:ss",ISO2:"yyyy-MM-dd HH:mm:ss",d1:"dd.MM.yyyy",d2:"dd-MM-yyyy",d3:"MM-dd-yyyy",zone1:"yyyy-MM-ddTHH:mm:ss-HH:mm",
zone2:"yyyy-MM-ddTHH:mm:ss+HH:mm",custom:"yyyy-MM-ddTHH:mm:ss.fff",custom2:"yyyy-MM-dd HH:mm:ss.fff"},percentsymbol:"%",currencysymbol:"$",currencysymbolposition:"before",decimalseparator:".",thousandsseparator:","}},expandFormat:function(b,e){e=e||"F";var d;d=b.patterns;var f=e.length;if(1===f){d=d[e];if(!d)throw"Invalid date format string '"+e+"'.";e=d}else 2===f&&"%"===e.charAt(0)&&(e=e.charAt(1));return e},getEra:function(b,e){if(!e||"string"===typeof b)return 0;for(var d,f=b.getTime(),c=0,g=
e.length;c<g;c++)if(d=e[c].start,null===d||f>=d)return c;return 0},toUpper:function(b){return b.split("\u00a0").join(" ").toUpperCase()},toUpperArray:function(b){for(var e=[],d=0,f=b.length;d<f;d++)e[d]=this.toUpper(b[d]);return e},getEraYear:function(b,e,d,f){b=b.getFullYear();!f&&e.eras&&(b-=e.eras[d].offset);return b},toUpper:function(b){return b?b.toUpperCase():""},getDayIndex:function(b,e,d){var f=b.days,c=b._upperDays;c||(b._upperDays=c=[this.toUpperArray(f.names),this.toUpperArray(f.namesAbbr),
this.toUpperArray(f.namesShort)]);e=e.toUpperCase();d?(b=this.arrayIndexOf(c[1],e),-1===b&&(b=this.arrayIndexOf(c[2],e))):b=this.arrayIndexOf(c[0],e);return b},getMonthIndex:function(b,e,d){var f=b.months,c=b.monthsGenitive||b.months,g=b._upperMonths,h=b._upperMonthsGen;g||(b._upperMonths=g=[this.toUpperArray(f.names),this.toUpperArray(f.namesAbbr)],b._upperMonthsGen=h=[this.toUpperArray(c.names),this.toUpperArray(c.namesAbbr)]);e=this.toUpper(e);b=this.arrayIndexOf(d?g[1]:g[0],e);0>b&&(b=this.arrayIndexOf(d?
h[1]:h[0],e));return b},appendPreOrPostMatch:function(b,e){for(var d=0,f=!1,c=0,g=b.length;c<g;c++){var h=b.charAt(c);switch(h){case "'":f?e.push("'"):d++;f=!1;break;case "\\":f&&e.push("\\");f=!f;break;default:e.push(h),f=!1}}return d},getTokenRegExp:function(){return/\/|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z|gg|g/g},formatlink:function(b,e){var d="";e&&e.target&&(d="target="+e.target);return""!=d?"<a "+d+' href="'+b+'">'+b+"</a>":'<a href="'+b+'">'+b+"</a>"},
formatemail:function(b){return'<a href="mailto:'+b+'">'+b+"</a>"},formatNumber:function(b,e,d){return this.formatnumber(b,e,d)},formatnumber:function(b,e,d){if(void 0==d||null==d||""==d)d=this.defaultcalendar();if(""===e||null===e)return b;this.isNumber(b)||(b*=1);var f;1<e.length&&(f=parseInt(e.slice(1),10));var c,g,h,l=e.charAt(0).toUpperCase();e=d.thousandsseparator;c=d.decimalseparator;switch(l){case "D":case "d":case "F":case "f":break;case "N":case "n":f=0;break;case "C":case "c":"before"==
d.currencysymbolposition?g=d.currencysymbol:h=d.currencysymbol;break;case "P":case "p":h=d.percentsymbol;break;default:throw"Bad number format specifier: "+l;}if(this.isNumber(b)){d=0>b;c=c?c:".";if(this.isNumber(f)){var q=f;f=Math.pow(10,q);b=(b*f).toFixed(0)/f+"";f=b.lastIndexOf(".");if(0<q)for(0>f?(b+=c,f=b.length-1):"."!==c&&(b=b.replace(".",c));b.length-1-f<q;)b+="0"}else b+="",f=b.lastIndexOf("."),0<f&&void 0==q&&"."!==c&&(b=b.replace(".",c));if(e){f=b.lastIndexOf(c);f=-1<f?f:b.length;q=b.substring(f);
c=-1;for(l=f;0<l;l--)c++,0===c%3&&l!==f&&(!d||1<l)&&(q=e+q),q=b.charAt(l-1)+q;b=q}b=g?g+b:b;return h?b+h:b}return b},tryparsedate:function(b,e){if(void 0==e||null==e)e=this.defaultcalendar();if(""==b)return null;null==b||b.substring||(b=b.toString());if(null!=b&&"/Date("==b.substring(0,6)){var d=/^\/Date\((-?\d+)(\+|-)?(\d+)?\)\/$/,f=new Date(+b.replace(/\/Date\((\d+)\)\//,"$1"));if("Invalid Date"==f){var g=b.match(/^\/Date\((\d+)([-+]\d\d)(\d\d)\)\/$/),f=null;g&&(f=new Date(1*g[1]+36E5*g[2]+6E4*
g[3]))}if(null==f||"Invalid Date"==f||isNaN(f)){var h=d.exec(b);if(h){var l=new Date(parseInt(h[1]));h[2]&&(d=parseInt(h[3]),"-"===h[2]&&(d=-d),h=l.getUTCMinutes(),l.setUTCMinutes(h-d));if(!isNaN(l.valueOf()))return l}}return f}patterns=e.patterns;for(prop in patterns)if(f=this.parsedate(b,patterns[prop],e))return"ISO"==prop&&(d=this.parsedate(b,patterns.ISO2,e))?d:f;if(null!=b){for(var l=[":","/","-"],f=!0,q=0;q<l.length;q++)-1!=b.indexOf(l[q])&&(f=!1);if(f&&(f=new Number(b),!isNaN(f)))return new Date(f)}if("string"===
c.type(b)){b=this.trim(b);var w=[":","/","-"," ",","];b=b.replace(RegExp(", ","g"),",");var h="",z=b;0<=b.indexOf(":")?(h=b.substring(b.indexOf(":")-2),h=this.trim(h),z=b.substring(0,b.indexOf(":")-2)):0<=b.toUpperCase().indexOf("AM")?(h=b.substring(b.toUpperCase().indexOf("AM")-2),h=this.trim(h),z=b.substring(0,b.toUpperCase().indexOf("AM")-2)):0<=b.toUpperCase().indexOf("PM")&&(h=b.substring(b.toUpperCase().indexOf("PM")-2),h=this.trim(h),z=b.substring(0,b.toUpperCase().indexOf("PM")-2));f=new Date;
d=!1;if(z){for(g=0;g<w.length;g++)if(0<=z.indexOf(w[g])){l=z.split(w[g]);break}for(var w=[],z=[],r=[],t=null,C=null,g=0;g<l.length;g++){var q=l[g],D=this.parsedate(q,"d",e)||this.parsedate(q,"dd",e)||this.parsedate(q,"ddd",e)||this.parsedate(q,"dddd",e);if(D&&2>=q.length){t=g;w.push(D.getDate());break}}for(g=0;g<l.length;g++)if(q=l[g],(D=this.parsedate(q,"M",e)||this.parsedate(q,"MM",e)||this.parsedate(q,"MMM",e)||this.parsedate(q,"MMMM",e))&&(void 0==t||t!=g)&&(z.push(D.getMonth()),2<q.length)){C=
g;break}for(g=0;g<l.length;g++)q=l[g],q=this.parsedate(q,"yyyy",e),!q||void 0!=t&&t==g||void 0!=C&&C==g||r.push(q.getFullYear());q=[];for(t=0;t<w.length;t++)for(g=0;g<z.length;g++)for(C=0;C<r.length;C++)l=new Date(r[C],z[g],w[t]),1970>r[C]&&l.setFullYear(r[C]),NaN!=l.getTime()&&q.push(l);0<q.length&&(f=q[0],d=!0)}h&&(l=0<=h.indexOf(":")?h.split(":"):h,h=this.parsedate(h,"h:mm tt",e)||this.parsedate(h,"h:mm:ss tt",e)||this.parsedate(h,"HH:mm:ss.fff",e)||this.parsedate(h,"HH:mm:ss.ff",e)||this.parsedate(h,
"HH:mm:ss.tttt",e)||this.parsedate(h,"HH:mm:ss",e)||this.parsedate(h,"HH:mm",e)||this.parsedate(h,"HH",e),g=r=z=w=0,h&&NaN!=h.getTime()?(w=h.getHours(),z=h.getMinutes(),r=h.getSeconds(),g=h.getMilliseconds()):(1==l.length&&(w=parseInt(l[0])),2==l.length&&(w=parseInt(l[0]),z=parseInt(l[1])),3==l.length&&(w=parseInt(l[0]),z=parseInt(l[1]),0<=l[2].indexOf(".")?(r=parseInt(l[2].toString().split(".")[0]),g=parseInt(l[2].toString().split(".")[1])):r=parseInt(l[2])),4==l.length&&(w=parseInt(l[0]),z=parseInt(l[1]),
r=parseInt(l[2]),g=parseInt(l[3]))),!f||isNaN(w)||isNaN(z)||isNaN(r)||isNaN(g)||(f.setHours(w,z,r,g),d=!0));if(d)return f}return null},getparseregexp:function(b,e){var d=b._parseRegExp;if(d){var f=d[e];if(f)return f}else b._parseRegExp=d={};for(var f=this.expandFormat(b,e).replace(/([\^\$\.\*\+\?\|\[\]\(\)\{\}])/g,"\\\\$1"),c=["^"],g=[],h=0,l=0,q=this.getTokenRegExp(),w;null!==(w=q.exec(f));){var z=f.slice(h,w.index),h=q.lastIndex,l=l+this.appendPreOrPostMatch(z,c);if(l%2)c.push(w[0]);else{var z=
w[0],r=z.length;switch(z){case "dddd":case "ddd":case "MMMM":case "MMM":case "gg":case "g":z="(\\D+)";break;case "tt":case "t":z="(\\D*)";break;case "yyyy":case "fff":case "ff":case "f":z="(\\d{"+r+"})";break;case "dd":case "d":case "MM":case "M":case "yy":case "y":case "HH":case "H":case "hh":case "h":case "mm":case "m":case "ss":case "s":z="(\\d\\d?)";break;case "zzz":z="([+-]?\\d\\d?:\\d{2})";break;case "zz":case "z":z="([+-]?\\d\\d?)";break;case "/":z="(\\"+b["/"]+")";break;default:throw"Invalid date format pattern '"+
z+"'.";}z&&c.push(z);g.push(w[0])}}this.appendPreOrPostMatch(f.slice(h),c);c.push("$");f={regExp:c.join("").replace(/\s+/g,"\\s+"),groups:g};return d[e]=f},outOfRange:function(b,e,d){return b<e||b>d},expandYear:function(b,e){var d=new Date,f=this.getEra(d);if(100>e){var c=b.twoDigitYearMax,c="string"===typeof c?(new Date).getFullYear()%100+parseInt(c,10):c,d=this.getEraYear(d,b,f);e+=d-d%100;e>c&&(e-=100)}return e},parsedate:function(b,e,d){if(void 0==d||null==d)d=this.defaultcalendar();b=this.trim(b);
e=this.getparseregexp(d,e);var f=(new RegExp(e.regExp)).exec(b);if(null===f)return null;var c=e.groups,g=e=b=null,h=null,l=null,q=0,w,z=0,r=0,t=0;w=null;for(var C=!1,D=0,y=c.length;D<y;D++){var A=f[D+1];if(A){var v=c[D],E=v.length,B=parseInt(A,10);switch(v){case "dd":case "d":h=B;if(this.outOfRange(h,1,31))return null;break;case "MMM":case "MMMM":g=this.getMonthIndex(d,A,3===E);if(this.outOfRange(g,0,11))return null;break;case "M":case "MM":g=B-1;if(this.outOfRange(g,0,11))return null;break;case "y":case "yy":case "yyyy":e=
4>E?this.expandYear(d,B):B;if(this.outOfRange(e,0,9999))return null;break;case "h":case "hh":q=B;12===q&&(q=0);if(this.outOfRange(q,0,11))return null;break;case "H":case "HH":q=B;if(this.outOfRange(q,0,23))return null;break;case "m":case "mm":z=B;if(this.outOfRange(z,0,59))return null;break;case "s":case "ss":r=B;if(this.outOfRange(r,0,59))return null;break;case "tt":case "t":C=d.PM&&(A===d.PM[0]||A===d.PM[1]||A===d.PM[2]);if(!C&&(!d.AM||A!==d.AM[0]&&A!==d.AM[1]&&A!==d.AM[2]))return null;break;case "f":case "ff":case "fff":t=
B*Math.pow(10,3-E);if(this.outOfRange(t,0,999))return null;break;case "ddd":case "dddd":l=this.getDayIndex(d,A,3===E);if(this.outOfRange(l,0,6))return null;break;case "zzz":v=A.split(/:/);if(2!==v.length)return null;w=parseInt(v[0],10);if(this.outOfRange(w,-12,13))return null;v=parseInt(v[1],10);if(this.outOfRange(v,0,59))return null;w=60*w+(this.startsWith(A,"-")?-v:v);break;case "z":case "zz":w=B;if(this.outOfRange(w,-12,13))return null;w*=60;break;case "g":case "gg":if(!A||!d.eras)return null;
A=trim(A.toLowerCase());v=0;for(E=d.eras.length;v<E;v++)if(A===d.eras[v].name.toLowerCase()){b=v;break}if(null===b)return null}}}f=new Date;D=d.convert;c=f.getFullYear();null===e?e=c:d.eras&&(e+=d.eras[b||0].offset);null===g&&(g=0);null===h&&(h=1);if(D){if(f=D.toGregorian(e,g,h),null===f)return null}else if(f.setFullYear(e,g,h),f.getDate()!==h||null!==l&&f.getDay()!==l)return null;C&&12>q&&(q+=12);f.setHours(q,z,r,t);null!==w&&(d=f.getMinutes()-(w+f.getTimezoneOffset()),f.setHours(f.getHours()+parseInt(d/
60,10),d%60));return f},cleardatescache:function(){this.datescache=[]},formatDate:function(b,e,d){return this.formatdate(b,e,d)},formatdate:function(b,e,d){function f(b,e){var d;d=b+"";return 1<e&&d.length<e?(d=z[e-2]+d,d.substr(d.length-e,e)):d}function c(b,e){if(C)return C[e];if(void 0!=b.getMonth)switch(e){case 0:return b.getFullYear();case 1:return b.getMonth();case 2:return b.getDate()}}if(void 0==d||null==d)d=this.defaultcalendar();if("string"===typeof b)return b;var g=b.toString()+"_"+e;if(this.datescache&&
this.datescache[g]&&-1==e.indexOf("f"))return this.datescache[g];if(!e||!e.length||"i"===e){var h;return h=this.formatDate(b,d.patterns.F,d)}var l=d.eras,q="s"===e;e=this.expandFormat(d,e);h=[];for(var w,z=["0","00","000"],r=0,t=this.getTokenRegExp(),C;;){w=t.lastIndex;var D=t.exec(e);w=e.slice(w,D?D.index:e.length);r+=this.appendPreOrPostMatch(w,h);if(!D)break;if(r%2)h.push(D[0]);else switch(w=D[0],D=w.length,w){case "ddd":case "dddd":h.push((3===D?d.days.namesAbbr:d.days.names)[b.getDay()]);break;
case "d":case "dd":h.push(f(c(b,2),D));break;case "MMM":case "MMMM":w=c(b,1);h.push(d.months[3===D?"namesAbbr":"names"][w]);break;case "M":case "MM":h.push(f(c(b,1)+1,D));break;case "y":case "yy":case "yyyy":w=this.getEraYear(b,d,this.getEra(b,l),q);4>D&&(w%=100);h.push(f(w,D));break;case "h":case "hh":w=b.getHours()%12;0===w&&(w=12);h.push(f(w,D));break;case "H":case "HH":h.push(f(b.getHours(),D));break;case "m":case "mm":h.push(f(b.getMinutes(),D));break;case "s":case "ss":h.push(f(b.getSeconds(),
D));break;case "t":case "tt":w=12>b.getHours()?d.AM?d.AM[0]:" ":d.PM?d.PM[0]:" ";h.push(1===D?w.charAt(0):w);break;case "f":case "ff":case "fff":h.push(f(b.getMilliseconds(),3).substr(0,D));break;case "z":case "zz":w=b.getTimezoneOffset()/60;h.push((0>=w?"+":"-")+f(Math.floor(Math.abs(w)),D));break;case "zzz":w=b.getTimezoneOffset()/60;h.push((0>=w?"+":"-")+f(Math.floor(Math.abs(w)),2)+":"+f(Math.abs(b.getTimezoneOffset()%60),2));break;case "g":case "gg":d.eras&&h.push(d.eras[this.getEra(b,l)].name);
break;case "/":h.push(d["/"]);break;default:throw"Invalid date format pattern '"+w+"'.";}}b=h.join("");this.datescache||(this.datescache=[]);return this.datescache[g]=b}});c.jqx.data={};var g,h,l=/#.*$/,q=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,r=/^(?:GET|HEAD)$/,t=/^\/\//,v=/\?/,y=/([?&])_=[^&]*/,A=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,w=/\s+/,z={},C={};try{h=location.href}catch(K){h=document.createElement("a"),h.href="",h=h.href}g=A.exec(h.toLowerCase())||[];c.extend(c.jqx.data,{ajaxSetup:function(b,
d){d?e(b,c.jqx.data.ajaxSettings):(d=b,b=c.jqx.data.ajaxSettings);e(b,d);return b},ajaxSettings:{url:h,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(g[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},
converters:{"* text":window.String,"text html":!0,"text json":c.parseJSON,"text xml":c.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:b(z),ajaxTransport:b(C),ajax:function(b,e){function f(b,e,d,g){var l,q,w,z,r=e;if(2!==B){B=2;G&&clearTimeout(G);F=void 0;D=g||"";S.readyState=0<b?4:0;if(d){z=L;g=S;var t,C,A,y,v=z.contents,E=z.dataTypes,I=z.responseFields;for(C in I)C in d&&(g[I[C]]=d[C]);for(;"*"===E[0];)E.shift(),void 0===t&&(t=z.mimeType||g.getResponseHeader("content-type"));if(t)for(C in v)if(v[C]&&
v[C].test(t)){E.unshift(C);break}if(E[0]in d)A=E[0];else{for(C in d){if(!E[0]||z.converters[C+" "+E[0]]){A=C;break}y||(y=C)}A=A||y}A?(A!==E[0]&&E.unshift(A),z=d[A]):z=void 0}if(200<=b&&300>b||304===b)if(L.ifModified&&((d=S.getResponseHeader("Last-Modified"))&&(c.lastModified[h]=d),(d=S.getResponseHeader("Etag"))&&(c.etag[h]=d)),304===b)r="notmodified",l=!0;else{a:{q=L;w=z;var K,Q,r=q.dataTypes.slice();t=r[0];C={};A=0;q.dataFilter&&(w=q.dataFilter(w,q.dataType));if(r[1])for(K in q.converters)C[K.toLowerCase()]=
q.converters[K];for(;d=r[++A];)if("*"!==d){if("*"!==t&&t!==d){K=C[t+" "+d]||C["* "+d];if(!K)for(Q in C)if(l=Q.split(" "),l[1]===d&&(K=C[t+" "+l[0]]||C["* "+l[0]])){!0===K?K=C[Q]:!0!==C[Q]&&(d=l[0],r.splice(A--,0,d));break}if(!0!==K)if(K&&q["throws"])w=K(w);else try{w=K(w)}catch(O){l={state:"parsererror",error:K?O:"No conversion from "+t+" to "+d};break a}}t=d}l={state:"success",data:w}}r=l.state;q=l.data;w=l.error;l=!w}else if(w=r,!r||b)r="error",0>b&&(b=0);S.status=b;S.statusText=(e||r)+"";l?ba.resolveWith(Y,
[q,r,S]):ba.rejectWith(Y,[S,r,w]);S.statusCode(ka);ka=void 0;M&&aa.trigger("ajax"+(l?"Success":"Error"),[S,L,l?q:w]);ca.fireWith(Y,[S,r]);M&&(aa.trigger("ajaxComplete",[S,L]),--c.active||c.event.trigger("ajaxStop"))}}"object"===typeof b&&(e=b,b=void 0);e=e||{};var h,D,E,F,G,I,M,O,L=c.jqx.data.ajaxSetup({},e),Y=L.context||L,aa=Y!==L&&(Y.nodeType||Y instanceof c)?c(Y):c.event,ba=c.Deferred(),ca=c.Callbacks("once memory"),ka=L.statusCode||{},fa={},ha={},B=0,da="canceled",S={readyState:0,setRequestHeader:function(b,
e){if(!B){var d=b.toLowerCase();b=ha[d]=ha[d]||b;fa[b]=e}return this},getAllResponseHeaders:function(){return 2===B?D:null},getResponseHeader:function(b){var e;if(2===B){if(!E)for(E={};e=q.exec(D);)E[e[1].toLowerCase()]=e[2];e=E[b.toLowerCase()]}return void 0===e?null:e},overrideMimeType:function(b){B||(L.mimeType=b);return this},abort:function(b){b=b||da;F&&F.abort(b);f(0,b);return this}};ba.promise(S);S.success=S.done;S.error=S.fail;S.complete=ca.add;S.statusCode=function(b){if(b){var e;if(2>B)for(e in b)ka[e]=
[ka[e],b[e]];else e=b[S.status],S.always(e)}return this};L.url=((b||L.url)+"").replace(l,"").replace(t,g[1]+"//");L.dataTypes=c.trim(L.dataType||"*").toLowerCase().split(w);null==L.crossDomain&&(I=A.exec(L.url.toLowerCase()),L.crossDomain=!(!I||I[1]===g[1]&&I[2]===g[2]&&(I[3]||("http:"===I[1]?80:443))==(g[3]||("http:"===g[1]?80:443))));L.data&&L.processData&&"string"!==typeof L.data&&(L.data=c.param(L.data,L.traditional));d(z,L,e,S);if(2===B)return S;M=L.global;L.type=L.type.toUpperCase();L.hasContent=
!r.test(L.type);M&&0===c.active++&&c.event.trigger("ajaxStart");if(!L.hasContent&&(L.data&&(L.url+=(v.test(L.url)?"&":"?")+L.data,delete L.data),h=L.url,!1===L.cache)){I=(new Date).getTime();var ja=L.url.replace(y,"$1_="+I);L.url=ja+(ja===L.url?(v.test(L.url)?"&":"?")+"_="+I:"")}(L.data&&L.hasContent&&!1!==L.contentType||e.contentType)&&S.setRequestHeader("Content-Type",L.contentType);L.ifModified&&(h=h||L.url,c.lastModified[h]&&S.setRequestHeader("If-Modified-Since",c.lastModified[h]),c.etag[h]&&
S.setRequestHeader("If-None-Match",c.etag[h]));S.setRequestHeader("Accept",L.dataTypes[0]&&L.accepts[L.dataTypes[0]]?L.accepts[L.dataTypes[0]]+("*"!==L.dataTypes[0]?", */*; q=0.01":""):L.accepts["*"]);for(O in L.headers)S.setRequestHeader(O,L.headers[O]);if(L.beforeSend&&(!1===L.beforeSend.call(Y,S,L)||2===B))return S.abort();da="abort";for(O in{success:1,error:1,complete:1})S[O](L[O]);if(F=d(C,L,e,S)){S.readyState=1;M&&aa.trigger("ajaxSend",[S,L]);L.async&&0<L.timeout&&(G=setTimeout(function(){S.abort("timeout")},
L.timeout));try{B=1,F.send(fa,f)}catch(W){if(2>B)f(-1,W);else throw W;}}else f(-1,"No Transport");return S},active:0,lastModified:{},etag:{}});var D=[],E=/\?/,F=/(=)\?(?=&|$)|\?\?/,G=(new Date).getTime();c.jqx.data.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var b=D.pop()||c.expando+"_"+G++;this[b]=!0;return b}});c.jqx.data.ajaxPrefilter("json jsonp",function(b,e,d){var f,g,h,l=b.data,q=b.url,w=!1!==b.jsonp,z=w&&F.test(q),r=w&&!z&&"string"===typeof l&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&
F.test(l);if("jsonp"===b.dataTypes[0]||z||r)return f=b.jsonpCallback=c.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,g=window[f],z?b.url=q.replace(F,"$1"+f):r?b.data=l.replace(F,"$1"+f):w&&(b.url+=(E.test(q)?"&":"?")+b.jsonp+"="+f),b.converters["script json"]=function(){h||c.error(f+" was not called");return h[0]},b.dataTypes[0]="json",window[f]=function(){h=arguments},d.always(function(){window[f]=g;b[f]&&(b.jsonpCallback=e.jsonpCallback,D.push(f));h&&c.isFunction(g)&&g(h[0]);h=g=
void 0}),"script"});c.jqx.data.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(b){c.globalEval(b);return b}}});c.jqx.data.ajaxPrefilter("script",function(b){void 0===b.cache&&(b.cache=!1);b.crossDomain&&(b.type="GET",b.global=!1)});c.jqx.data.ajaxTransport("script",function(b){if(b.crossDomain){var e,d=document.head||document.getElementsByTagName("head")[0]||
document.documentElement;return{send:function(f,c){e=document.createElement("script");e.async="async";b.scriptCharset&&(e.charset=b.scriptCharset);e.src=b.url;e.onload=e.onreadystatechange=function(b,f){if(f||!e.readyState||/loaded|complete/.test(e.readyState))e.onload=e.onreadystatechange=null,d&&e.parentNode&&d.removeChild(e),e=void 0,f||c(200,"success")};d.insertBefore(e,d.firstChild)},abort:function(){if(e)e.onload(0,1)}}}});var I,M=window.ActiveXObject?function(){for(var b in I)I[b](0,1)}:!1,
O=0;c.jqx.data.ajaxSettings.xhr=window.ActiveXObject?function(){var b;if(!(b=!this.isLocal&&f()))a:{try{b=new window.ActiveXObject("Microsoft.XMLHTTP");break a}catch(e){}b=void 0}return b}:f;(function(b){c.extend(c.support,{ajax:!!b,cors:!!b&&"withCredentials"in b})})(c.jqx.data.ajaxSettings.xhr());c.support||(c.support={ajax:!0});c.support.ajax&&c.jqx.data.ajaxTransport(function(b){if(!b.crossDomain||c.support.cors){var e;return{send:function(d,f){var g,h,l=b.xhr();b.username?l.open(b.type,b.url,
b.async,b.username,b.password):l.open(b.type,b.url,b.async);if(b.xhrFields)for(h in b.xhrFields)l[h]=b.xhrFields[h];b.mimeType&&l.overrideMimeType&&l.overrideMimeType(b.mimeType);b.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");try{for(h in d)l.setRequestHeader(h,d[h])}catch(q){}l.send(b.hasContent&&b.data||null);e=function(d,c){var h,q,w,z,r;try{if(e&&(c||4===l.readyState))if(e=void 0,g&&(l.onreadystatechange=function(){},M&&delete I[g]),c)4!==l.readyState&&l.abort();
else{h=l.status;w=l.getAllResponseHeaders();z={};(r=l.responseXML)&&r.documentElement&&(z.xml=r);try{z.text=l.responseText}catch(t){}try{q=l.statusText}catch(t){q=""}h||!b.isLocal||b.crossDomain?1223===h&&(h=204):h=z.text?200:404}}catch(t){c||f(-1,t)}z&&f(h,q,z,w)};b.async?4===l.readyState?setTimeout(e,0):(g=++O,M&&(I||(I={},c(window).unload(M)),I[g]=e),l.onreadystatechange=e):e()},abort:function(){e&&e(0,1)}}}});c.jqx.filter=function(){this.operator="and";var b="EMPTY NOT_EMPTY CONTAINS CONTAINS_CASE_SENSITIVE DOES_NOT_CONTAIN DOES_NOT_CONTAIN_CASE_SENSITIVE STARTS_WITH STARTS_WITH_CASE_SENSITIVE ENDS_WITH ENDS_WITH_CASE_SENSITIVE EQUAL EQUAL_CASE_SENSITIVE NULL NOT_NULL".split(" "),
e="EQUAL NOT_EQUAL LESS_THAN LESS_THAN_OR_EQUAL GREATER_THAN GREATER_THAN_OR_EQUAL NULL NOT_NULL".split(" "),d="EQUAL NOT_EQUAL LESS_THAN LESS_THAN_OR_EQUAL GREATER_THAN GREATER_THAN_OR_EQUAL NULL NOT_NULL".split(" "),f=["EQUAL","NOT_EQUAL"],g=[],h=[];this.evaluate=function(b){for(var e=!0,d=0;d<g.length;d++)var f=g[d].evaluate(b),e=0==d?f:1==h[d]||"or"==h[d]?e||f:e&&f;return e};this.getfilterscount=function(){return g.length};this.setoperatorsbyfiltertype=function(c,g){switch(c){case "numericfilter":e=
g;break;case "stringfilter":b=g;break;case "datefilter":d=g;break;case "booleanfilter":f=g}};this.getoperatorsbyfiltertype=function(c){var g=[];switch(c){case "numericfilter":g=e.slice(0);break;case "stringfilter":g=b.slice(0);break;case "datefilter":g=d.slice(0);break;case "booleanfilter":g=f.slice(0)}return g};var l=function(){var b=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return b()+"-"+b()+"-"+b()};this.createfilter=function(b,e,d,f,c,g){if(null==b||void 0==b)return null;
switch(b){case "numericfilter":return new z(e,d.toUpperCase());case "stringfilter":return new q(e,d.toUpperCase());case "datefilter":return new r(e,d.toUpperCase(),c,g);case "booleanfilter":return new w(e,d.toUpperCase());case "custom":return new t(e,d.toUpperCase(),f)}throw Error("jqxGrid: There is no such filter type. The available filter types are: 'numericfilter', 'stringfilter', 'datefilter' and 'booleanfilter'");};this.getfilters=function(){for(var b=[],e=0;e<g.length;e++){var d={value:g[e].filtervalue,
condition:g[e].comparisonoperator,operator:h[e],type:g[e].type};g[e].data&&(d.id=g[e].data);b[e]=d}return b};this.addfilter=function(b,e){g[g.length]=e;e.key=l();h[h.length]=b};this.removefilter=function(b){for(var e=0;e<g.length;e++)if(g[e].key==b.key){g.splice(e,1);h.splice(e,1);break}};this.getoperatorat=function(b){return void 0==b||null==b||0>b||b>g.length?null:h[b]};this.setoperatorat=function(b,e){if(void 0==b||null==b||0>b||b>g.length)return null;h[e]=e};this.getfilterat=function(b){return void 0==
b||null==b||0>b||b>g.length?null:g[b]};this.setfilterat=function(b,e){if(void 0==b||null==b||0>b||b>g.length)return null;e.key=l();g[b]=e};this.clear=function(){g=[];h=[]};var q=function(b,e){this.filtervalue=b;this.comparisonoperator=e;this.type="stringfilter";this.evaluate=function(b){var e=this.filtervalue,d=this.comparisonoperator;if(null==b||void 0==b||""==b){if("NULL"==d||"EQUAL"==d&&b==e||"NOT_EQUAL"==d&&b!=e)return!0;if("EMPTY"!=d)return!1;if(""==b)return!0}var f="";try{f=b.toString()}catch(g){return!0}var h=
function(b,e){switch(d){case "EQUAL":return c.jqx.string.equalsIgnoreCase(b,e);case "EQUAL_CASE_SENSITIVE":return c.jqx.string.equals(b,e);case "NOT_EQUAL":return!c.jqx.string.equalsIgnoreCase(b,e);case "NOT_EQUAL_CASE_SENSITIVE":return!c.jqx.string.equals(b,e);case "CONTAINS":return c.jqx.string.containsIgnoreCase(b,e);case "CONTAINS_CASE_SENSITIVE":return c.jqx.string.contains(b,e);case "DOES_NOT_CONTAIN":return!c.jqx.string.containsIgnoreCase(b,e);case "DOES_NOT_CONTAIN_CASE_SENSITIVE":return!c.jqx.string.contains(b,
e);case "EMPTY":return""==b;case "NOT_EMPTY":return""!=b;case "NOT_NULL":return null!=b;case "STARTS_WITH":return c.jqx.string.startsWithIgnoreCase(b,e);case "ENDS_WITH":return c.jqx.string.endsWithIgnoreCase(b,e);case "ENDS_WITH_CASE_SENSITIVE":return c.jqx.string.endsWith(b,e);case "STARTS_WITH_CASE_SENSITIVE":return c.jqx.string.startsWith(b,e);default:return!1}},l=[];if(e&&e.indexOf&&(0<=e.indexOf("|")||0<=e.indexOf(" AND ")||0<=e.indexOf(" OR ")||0<=e.indexOf(" and ")||0<=e.indexOf(" or "))){if(b=
h(f,e))return b;var q=0<=e.indexOf(" AND ")?e.split(" AND "):[];b=0<=e.indexOf(" OR ")?e.split(" OR "):[];var w=0<=e.indexOf(" and ")?e.split(" and "):[],z=0<=e.indexOf(" or ")?e.split(" or "):[],r=0<=e.indexOf("|")?e.split("|"):[];if(0<r.length)for(var t=0;t<r.length;t++)r[t]=c.trim(r[t]);e=0<=e.indexOf(" ")?e.split(" "):[];if(0<e.length)for(t=0;t<e.length;t++)e[t]=c.trim(e[t]);q=q.concat(e);q=q.concat(w);b=b.concat(r);b=b.concat(z);if(0<q.length)for(t=0;t<q.length;t++)0<=!q[t].indexOf(" OR ")&&
l.push(q[t]);if(0<b.length)for(t=0;t<b.length;t++)0<=!b[t].indexOf(" AND ")&&l.push(b[t]);e=void 0;for(w=0;w<l.length;w++)b=l[w],b=h(f,b),z=w<q.length?"and":"or",e=void 0==e?b:"or"==z?e||b:e&&b;return e}return h(f,e)}},w=function(b,e){this.filtervalue=b;this.comparisonoperator=e;this.type="booleanfilter";this.evaluate=function(b){var e=this.filtervalue,d=this.comparisonoperator;if(null==b||void 0==b)return"NULL"==d?!0:!1;switch(d){case "EQUAL":return b==e||b.toString()==e.toString();case "NOT_EQUAL":return b!=
e&&b.toString()!=e.toString();default:return!1}}},z=function(b,e){this.filtervalue=b;this.comparisonoperator=e;this.type="numericfilter";this.evaluate=function(b){var e=this.filtervalue,d=this.comparisonoperator;if(null===b||void 0===b||""===b){if("NOT_NULL"==d)return!1;if("NULL"==d)return!0;switch(d){case "EQUAL":return b==e;case "NOT_EQUAL":return b!=e}return!1}if("NULL"==d)return!1;if("NOT_NULL"==d)return!0;var f=b;try{f=parseFloat(f)}catch(g){if(""!=b.toString())return!1}var h=function(b,e){switch(d){case "EQUAL":return b==
e;case "NOT_EQUAL":return b!=e;case "GREATER_THAN":return b>e;case "GREATER_THAN_OR_EQUAL":return b>=e;case "LESS_THAN":return b<e;case "LESS_THAN_OR_EQUAL":return b<=e;case "STARTS_WITH":return c.jqx.string.startsWithIgnoreCase(b.toString(),e.toString());case "ENDS_WITH":return c.jqx.string.endsWithIgnoreCase(b.toString(),e.toString());case "ENDS_WITH_CASE_SENSITIVE":return c.jqx.string.endsWith(b.toString(),e.toString());case "STARTS_WITH_CASE_SENSITIVE":return c.jqx.string.startsWith(b.toString(),
e.toString());case "CONTAINS":return c.jqx.string.containsIgnoreCase(b.toString(),e.toString());case "CONTAINS_CASE_SENSITIVE":return c.jqx.string.contains(b.toString(),e.toString());case "DOES_NOT_CONTAIN":return!c.jqx.string.containsIgnoreCase(b.toString(),e.toString());case "DOES_NOT_CONTAIN_CASE_SENSITIVE":return!c.jqx.string.contains(b.toString(),e.toString());default:return!0}},l=[];if(e&&e.indexOf&&(0<=e.indexOf("|")||0<=e.indexOf(" AND ")||0<=e.indexOf(" OR ")||0<=e.indexOf(" and ")||0<=e.indexOf(" or "))){var q=
h(f,e);if(q)return q;var e=e.toString(),w=0<=e.indexOf(" AND ")?e.split(" AND "):[],z=0<=e.indexOf(" OR ")?e.split(" OR "):[];b=0<=e.indexOf(" and ")?e.split(" and "):[];var r=0<=e.indexOf(" or ")?e.split(" or "):[],w=w.concat(b),z=z.concat(r),e=0<=e.indexOf("|")?e.split("|"):[];if(0<e.length)for(b=0;b<e.length;b++)e[b]=c.trim(e[b]);z=z.concat(e);if(0<w.length)for(b=0;b<w.length;b++)0<=!w[b].indexOf(" OR ")&&l.push(w[b]);if(0<z.length)for(b=0;b<z.length;b++)0<=!z[b].indexOf(" AND ")&&l.push(z[b]);
z=void 0;for(e=0;e<l.length;e++)(b=l[e])&&b.indexOf&&0<=b.indexOf("..")?(b=b.toString().split(".."),2==b.length&&(q=f>=b[0]&&f<=b[1])):q=h(f,b),b=e<w.length?"and":"or",z=void 0==z?q:"or"==b?z||q:z&&q;return z}return e&&e.indexOf&&0<=e.indexOf("..")&&(l=e.toString().split(".."),2==l.length)?f>=l[0]&&f<=l[1]:h(f,e)}},r=function(b,e,d,f){this.filtervalue=b;this.type="datefilter";var g=this;if(void 0!=d&&void 0!=f){var h=c.jqx.dataFormat.parsedate(b,d,f);null!=h?this.filterdate=h:(h=c.jqx.dataFormat.tryparsedate(b,
f),null!=h&&(this.filterdate=h))}else h=new Date(b),this.filterdate="NaN"==h.toString()||"Invalid Date"==h.toString()?c.jqx.dataFormat.tryparsedate(b):h;this.filterdate||(h=new Date(b),this.filterdate="NaN"==h.toString()||"Invalid Date"==h.toString()?c.jqx.dataFormat.tryparsedate(b):h);this.comparisonoperator=e;this.evaluate=function(b){var e=this.filtervalue,h=this.comparisonoperator;if(null==b||void 0==b||""==b){if("NOT_NULL"==h)return!1;if("NULL"==h)return!0;switch(h){case "EQUAL":return b==e;
case "NOT_EQUAL":return b!=e}return!1}if("NULL"==h)return!1;if("NOT_NULL"==h)return!0;var l=new Date;l.setFullYear(1900,0,1);l.setHours(12,0,0,0);try{var q=new Date(b),l=b="NaN"==q.toString()||"Invalid Date"==q.toString()?c.jqx.dataFormat.tryparsedate(b):q,w=!1;if(void 0!=d&&void 0!=f&&(0<=d.indexOf("t")||0<=d.indexOf("T")||0<=d.indexOf(":")||0<=d.indexOf("f"))&&(w=!0,e&&-1==e.toString().indexOf(":"))){var z=c.jqx.dataFormat.tryparsedate(e.toString()+":00",f);null!=z&&(g.filterdate=z)}void 0!=d&&
(0<=d.indexOf("hh")||0<=d.indexOf("t"))&&(w=!0);w||(l.setHours(0),l.setMinutes(0),l.setSeconds(0))}catch(r){if(""!=b.toString())return!1}if(null!=g.filterdate)e=g.filterdate;else if(e&&e.indexOf&&(-1!=e.indexOf(":")||!isNaN(parseInt(e)))){z=new Date(l);z.setHours(12,0,0,0);q=e.split(":");for(e=0;e<q.length;e++)0==e&&z.setHours(q[e]),1==e&&z.setMinutes(q[e]),2==e&&z.setSeconds(q[e]);e=z}w&&e&&e.setFullYear&&l&&l.getFullYear&&-1==d.indexOf("d")&&-1==d.indexOf("M")&&-1==d.indexOf("y")&&e.setFullYear(l.getFullYear(),
l.getMonth(),l.getDate());w=function(b,e){null==b&&(b="");switch(h){case "EQUAL":return b.toString()==e.toString();case "NOT_EQUAL":return b.toString()!=e.toString();case "GREATER_THAN":return b>e;case "GREATER_THAN_OR_EQUAL":return b>=e;case "LESS_THAN":return b<e;case "LESS_THAN_OR_EQUAL":return b<=e;case "STARTS_WITH":return c.jqx.string.startsWithIgnoreCase(b.toString(),e.toString());case "ENDS_WITH":return c.jqx.string.endsWithIgnoreCase(b.toString(),e.toString());case "ENDS_WITH_CASE_SENSITIVE":return c.jqx.string.endsWith(b.toString(),
e.toString());case "STARTS_WITH_CASE_SENSITIVE":return c.jqx.string.startsWith(b.toString(),e.toString());case "CONTAINS":return c.jqx.string.containsIgnoreCase(b.toString(),e.toString());case "CONTAINS_CASE_SENSITIVE":return c.jqx.string.contains(b.toString(),e.toString());case "DOES_NOT_CONTAIN":return!c.jqx.string.containsIgnoreCase(b.toString(),e.toString());case "DOES_NOT_CONTAIN_CASE_SENSITIVE":return!c.jqx.string.contains(b.toString(),e.toString());default:return!0}};q=[];if(e&&e.indexOf&&
(0<=e.indexOf("|")||0<=e.indexOf(" AND ")||0<=e.indexOf(" OR ")||0<=e.indexOf(" and ")||0<=e.indexOf(" or "))){if(z=w(l,e))return z;var t=0<=e.indexOf(" AND ")?e.split(" AND "):[];b=0<=e.indexOf(" OR ")?e.split(" OR "):[];var C=0<=e.indexOf(" and ")?e.split(" and "):[],D=0<=e.indexOf(" or ")?e.split(" or "):[],t=t.concat(C);b=b.concat(D);C=0<=e.indexOf("|")?e.split("|"):[];if(0<C.length)for(e=0;e<C.length;e++)C[e]=c.trim(C[e]);b=b.concat(C);if(0<t.length)for(e=0;e<t.length;e++)0<=!t[e].indexOf(" OR ")&&
q.push(t[e]);if(0<b.length)for(e=0;e<b.length;e++)0<=!b[e].indexOf(" AND ")&&q.push(b[e]);e=void 0;for(C=0;C<q.length;C++)(b=q[C])&&b.indexOf&&0<=b.indexOf("..")?(b=b.toString().split(".."),2==b.length&&(z=l>=b[0]&&l<=b[1])):z=w(l,b),b=C<t.length?"and":"or",e=void 0==e?z:"or"==b?e||z:e&&z;return e}return e&&e.indexOf&&0<=e.indexOf("..")&&(q=e.toString().split(".."),2==q.length)?l>=q[0]&&l<=q[1]:w(l,e)}},t=function(b,e,d){this.filtervalue=b;this.comparisonoperator=e;this.evaluate=function(b,e){return d(this.filtervalue,
b,this.comparisonoperator)}}}})(jqxBaseFramework);
(function(c){c.jqx.cssroundedcorners=function(b){var d={all:"jqx-rc-all",top:"jqx-rc-t",bottom:"jqx-rc-b",left:"jqx-rc-l",right:"jqx-rc-r","top-right":"jqx-rc-tr","top-left":"jqx-rc-tl","bottom-right":"jqx-rc-br","bottom-left":"jqx-rc-bl"};for(prop in d)if(d.hasOwnProperty(prop)&&b==prop)return d[prop]};c.jqx.jqxWidget("jqxButton","",{});c.extend(c.jqx._jqxButton.prototype,{defineInstance:function(){var b={type:"",cursor:"arrow",roundedCorners:"all",disabled:!1,height:null,width:null,overrideTheme:!1,
enableHover:!0,enableDefault:!0,enablePressed:!0,imgPosition:"center",imgSrc:"",imgWidth:16,imgHeight:16,value:null,textPosition:"",textImageRelation:"overlay",rtl:!1,_ariaDisabled:!1,_scrollAreaButton:!1,template:"default",aria:{"aria-disabled":{name:"disabled",type:"boolean"}}};if(this===c.jqx._jqxButton.prototype)return b;c.extend(!0,this,b);return b},_addImage:function(b){if("input"==this.element.nodeName.toLowerCase()||"button"==this.element.nodeName.toLowerCase()||"div"==this.element.nodeName.toLowerCase()){if(this._img)this._img.setAttribute("src",
this.imgSrc),this._img.setAttribute("width",this.imgWidth),this._img.setAttribute("height",this.imgHeight),this._text.innerHTML=this.value;else{this.field=this.element;this.field.className&&(this._className=this.field.className);var d=this.field.title,e=null;this.field.getAttribute("value")?e=this.field.getAttribute("value"):"input"!=this.element.nodeName.toLowerCase()&&(e=this.element.innerHTML);this.value&&(e=this.value);b=this.field.id.length?this.field.id.replace(/[^\w]/g,"_")+"_"+b:c.jqx.utilities.createId()+
"_"+b;var f=document.createElement("div");f.id=b;f.title=d;f.style.cssText=this.field.style.cssText;f.style.boxSizing="border-box";d=document.createElement("img");d.setAttribute("src",this.imgSrc);d.setAttribute("width",this.imgWidth);d.setAttribute("height",this.imgHeight);f.appendChild(d);this._img=d;d=document.createElement("span");e&&(this.value=d.innerHTML=e);f.appendChild(d);this._text=d;this.field.style.display="none";this.field.parentNode&&this.field.parentNode.insertBefore(f,this.field.nextSibling);
e=this.host.data();this.host=c(f);this.host.data(e);this.element=f;this.element.id=this.field.id;this.field.id=b;b=new c(this.element);e=new c(this.field);this._className&&(b.addClass(this._className),e.removeClass(this._className));this.field.tabIndex&&(b=this.field.tabIndex,this.field.tabIndex=-1,this.element.tabIndex=b)}this._img.style.display=this.imgSrc?"inline":"none";this._text.style.display=this.value?"inline":"none";this._positionTextAndImage()}},_positionTextAndImage:function(){var b=this.element.offsetWidth,
d=this.element.offsetHeight,e=this.imgWidth,f=this.imgHeight;""==this.imgSrc&&(f=e=0);var c=this._text.offsetWidth,h=this._text.offsetHeight,l=0,q=0;switch(this.textImageRelation){case "imageBeforeText":case "textBeforeImage":l=e+c+8+4+8;q=Math.max(f,h)+8+4+8;break;case "imageAboveText":case "textAboveImage":l=Math.max(e,c)+8;q=f+h+4+8+8;break;case "overlay":l=Math.max(e,c)+8,q=Math.max(f,h)+8}this.width||(this.element.style.width=l+"px",b=l);this.height||(this.element.style.height=q+"px",d=q);this._img.style.position=
"absolute";this._text.style.position="absolute";this.element.style.position="relative";this.element.style.overflow="hidden";var l={},q={},r=function(b,e,d,f,c){e.width<f&&(e.width=f);e.height<c&&(e.height=c);switch(d){case "left":b.style.left=e.left+"px";b.style.top=e.top+e.height/2-c/2+"px";break;case "topLeft":b.style.left=e.left+"px";b.style.top=e.top+"px";break;case "bottomLeft":b.style.left=e.left+"px";b.style.top=e.top+e.height-c+"px";break;default:case "center":b.style.left=e.left+e.width/
2-f/2+"px";b.style.top=e.top+e.height/2-c/2+"px";break;case "top":b.style.left=e.left+e.width/2-f/2+"px";b.style.top=e.top+"px";break;case "bottom":b.style.left=e.left+e.width/2-f/2+"px";b.style.top=e.top+e.height-c+"px";break;case "right":b.style.left=e.left+e.width-f+"px";b.style.top=e.top+e.height/2-c/2+"px";break;case "topRight":b.style.left=e.left+e.width-f+"px";b.style.top=e.top+"px";break;case "bottomRight":b.style.left=e.left+e.width-f+"px",b.style.top=e.top+e.height-c+"px"}},t=0,v=0,y=(b-
t)/2,A=(d-v)/2,w=this._img,z=this._text,C=d-v,D=b-t,t=t+4,v=v+4,b=b-4-2,D=D-8-2,C=C-8-2;switch(this.textImageRelation){case "imageBeforeText":switch(this.imgPosition){case "left":case "topLeft":case "bottomLeft":q={left:t,top:v,width:t+e,height:C};l={left:t+e+4,top:v,width:D-e-4,height:C};break;case "center":case "top":case "bottom":q={left:y-c/2-e/2-2,top:v,width:e,height:C};l={left:q.left+e+4,top:v,width:b-q.left-e-4,height:C};break;case "right":case "topRight":case "bottomRight":q={left:b-c-e-
4,top:v,width:e,height:C},l={left:q.left+e+4,top:v,width:b-q.left-e-4,height:C}}r(w,q,this.imgPosition,e,f);r(z,l,this.textPosition,c,h);break;case "textBeforeImage":switch(this.textPosition){case "left":case "topLeft":case "bottomLeft":l={left:t,top:v,width:t+c,height:C};q={left:t+c+4,top:v,width:D-c-4,height:C};break;case "center":case "top":case "bottom":l={left:y-c/2-e/2-2,top:v,width:c,height:C};q={left:l.left+c+4,top:v,width:b-l.left-c-4,height:C};break;case "right":case "topRight":case "bottomRight":l=
{left:b-c-e-4,top:v,width:c,height:C},q={left:l.left+c+4,top:v,width:b-l.left-c-4,height:C}}r(w,q,this.imgPosition,e,f);r(z,l,this.textPosition,c,h);break;case "imageAboveText":switch(this.imgPosition){case "topRight":case "top":case "topLeft":q={left:t,top:v,width:D,height:f};l={left:t,top:v+f+4,width:D,height:C-f-4};break;case "left":case "center":case "right":q={left:t,top:A-f/2-h/2-2,width:D,height:f};l={left:t,top:q.top+4+f,width:D,height:C-q.top-4-f};break;case "bottomLeft":case "bottom":case "bottomRight":q=
{left:t,top:d-f-h-4,width:D,height:f},l={left:t,top:q.top+4+f,width:D,height:h}}r(w,q,this.imgPosition,e,f);r(z,l,this.textPosition,c,h);break;case "textAboveImage":switch(this.textPosition){case "topRight":case "top":case "topLeft":l={left:t,top:v,width:D,height:h};q={left:t,top:v+h+4,width:D,height:C-h-4};break;case "left":case "center":case "right":l={left:t,top:A-f/2-h/2-2,width:D,height:h};q={left:t,top:l.top+4+h,width:D,height:C-l.top-4-h};break;case "bottomLeft":case "bottom":case "bottomRight":l=
{left:t,top:d-f-h-4,width:D,height:h},q={left:t,top:l.top+4+h,width:D,height:f}}r(w,q,this.imgPosition,e,f);r(z,l,this.textPosition,c,h);break;default:l={left:t,top:v,width:D,height:C},q={left:t,top:v,width:D,height:C},r(w,q,this.imgPosition,e,f),r(z,l,this.textPosition,c,h)}},createInstance:function(b){var d=this;d._setSize();d.isMaterialized();d.buttonObj=new c(d.element);if(""!=d.imgSrc||""!=d.textPosition||d.element.value&&0<=d.element.value.indexOf("<")||null!=d.value)d.refresh(),d._addImage("jqxButton"),
d.buttonObj=new c(d.element);d._ariaDisabled||d.element.setAttribute("role","button");""!==d.type&&d.element.setAttribute("type",d.type);d.overrideTheme||(d.buttonObj.addClass(d.toThemeProperty(c.jqx.cssroundedcorners(d.roundedCorners))),d.enableDefault&&d.buttonObj.addClass(d.toThemeProperty("jqx-button")),d.buttonObj.addClass(d.toThemeProperty("jqx-widget")));d.isTouchDevice=c.jqx.mobile.isTouchDevice();d._ariaDisabled||c.jqx.aria(this);"arrow"!=d.cursor&&(d.element.style.cursor=d.disabled?"arrow":
d.cursor);b="mouseenter mouseleave mousedown focus blur";d._scrollAreaButton&&(b="mousedown");d.isTouchDevice&&(d.addHandler(d.host,c.jqx.mobile.getTouchEventName("touchstart"),function(b){d.isPressed=!0;d.refresh()}),d.addHandler(c(document),c.jqx.mobile.getTouchEventName("touchend")+"."+d.element.id,function(b){d.isPressed=!1;d.refresh()}));d.addHandler(d.host,b,function(b){switch(b.type){case "mouseenter":d.isTouchDevice||d.disabled||!d.enableHover||(d.isMouseOver=!0,d.refresh());break;case "mouseleave":d.isTouchDevice||
d.disabled||!d.enableHover||(d.isMouseOver=!1,d.refresh());break;case "mousedown":d.disabled||(d.isPressed=!0,d.refresh());break;case "focus":d.disabled||(d.isFocused=!0,d.refresh());break;case "blur":d.disabled||(d.isFocused=!1,d.refresh())}});d.mouseupfunc=function(b){d.disabled||!d.isPressed&&!d.isMouseOver||(d.isPressed=!1,d.refresh())};d.addHandler(document,"mouseup.button"+d.element.id,d.mouseupfunc);try{""==document.referrer&&!window.frameElement||null==window.top||window.top==window.that||
(b="",window.parent&&document.referrer&&(b=document.referrer),-1!=b.indexOf(document.location.host)&&(b=function(b){d.isPressed=!1;d.refresh()},window.top.document&&d.addHandler(c(window.top.document),"mouseup",b)))}catch(e){}d.propertyChangeMap.roundedCorners=function(b,d,g,h){b.buttonObj.removeClass(b.toThemeProperty(c.jqx.cssroundedcorners(g)));b.buttonObj.addClass(b.toThemeProperty(c.jqx.cssroundedcorners(h)))};d.propertyChangeMap.disabled=function(b,d,g,h){g!=h&&(b.refresh(),b.element.setAttribute("disabled",
h),b.element.disabled=h,b.element.style.cursor=h?"default":b.cursor,c.jqx.aria(b,"aria-disabled",b.disabled))};d.propertyChangeMap.rtl=function(b,d,c,h){c!=h&&b.refresh()};d.propertyChangeMap.template=function(b,d,c,h){c!=h&&(b.buttonObj.removeClass(b.toThemeProperty("jqx-"+c)),b.refresh())};d.propertyChangeMap.theme=function(b,d,g,h){b.buttonObj.removeClass(b.element);b.enableDefault&&b.buttonObj.addClass(b.toThemeProperty("jqx-button"));b.buttonObj.addClass(b.toThemeProperty("jqx-widget"));b.overrideTheme||
b.buttonObj.addClass(b.toThemeProperty(c.jqx.cssroundedcorners(b.roundedCorners)));b._oldCSSCurrent=null;b.refresh()};d.disabled&&(d.element.disabled=!0,d.element.setAttribute("disabled","true"))},resize:function(b,d){this.width=b;this.height=d;this._setSize()},val:function(b){var d=this.host.find("input");if(0<d.length){if(0==arguments.length||"object"==typeof b)return d.val();d.val(b);this.refresh();return d.val()}if(0==arguments.length||"object"==typeof b)return"button"==this.element.nodeName.toLowerCase()?
c(this.element).text():this.element.value;0<arguments.length&&this._text?this._text.innerHTML=arguments[0]:(0<arguments.length&&"DIV"===this.element.nodeName&&(this.element.innerHTML=arguments[0],this.refresh()),this.element.value=arguments[0],"button"==this.element.nodeName.toLowerCase()&&c(this.element).html(arguments[0]));this.refresh()},_setSize:function(){var b=this.height,d=this.width;b&&(isNaN(b)||(b+="px"),this.element.style.height=b);d&&(isNaN(d)||(d+="px"),this.element.style.width=d)},_removeHandlers:function(){this.removeHandler(this.host,
"selectstart");this.removeHandler(this.host,"click");this.removeHandler(this.host,"focus");this.removeHandler(this.host,"blur");this.removeHandler(this.host,"mouseenter");this.removeHandler(this.host,"mouseleave");this.removeHandler(this.host,"mousedown");this.removeHandler(c(document),"mouseup.button"+this.element.id,this.mouseupfunc);this.isTouchDevice&&(this.removeHandler(this.host,c.jqx.mobile.getTouchEventName("touchstart")),this.removeHandler(c(document),c.jqx.mobile.getTouchEventName("touchend")+
"."+this.element.id));this.mouseupfunc=null;delete this.mouseupfunc},focus:function(){this.host.focus()},destroy:function(){this._removeHandlers();var b=c.data(this.element,"jqxButton");b&&delete b.instance;this.host.removeClass();this.host.removeData();this.host.remove();delete this.set;delete this.get;delete this.call;delete this.element;delete this.host},render:function(){this.refresh()},propertiesChangedHandler:function(b,d,e){e&&e.width&&e.height&&2==Object.keys(e).length&&(b._setSize(),b.refresh())},
propertyChangedHandler:function(b,d,e,f){if(void 0!=this.isInitialized&&0!=this.isInitialized&&f!=e&&!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length)){"type"===d&&b.element.setAttribute("type",f);if("textImageRelation"==d||"textPosition"==d||"imgPosition"==d)b._img?b._positionTextAndImage():b._addImage("jqxButton");"imgSrc"!=d&&"imgWidth"!=d&&"imgHeight"!=d||b._addImage("jqxButton");"value"===d&&b.val(f);if("width"==d||"height"==d)b._setSize(),b.refresh()}},
refresh:function(){if(!this.overrideTheme){var b=this.toThemeProperty("jqx-fill-state-focus"),d=this.toThemeProperty("jqx-fill-state-disabled"),e=this.toThemeProperty("jqx-fill-state-normal");this.enableDefault||(e="");var f=this.toThemeProperty("jqx-fill-state-hover"),c=this.toThemeProperty("jqx-fill-state-pressed"),h=this.toThemeProperty("jqx-fill-state-pressed");this.enablePressed||(c="");this.host&&((this.element.disabled=this.disabled)?(this._oldCSSCurrent&&this.buttonObj.removeClass(this._oldCSSCurrent),
d=e+" "+d,"default"!==this.template&&""!==this.template&&(d+=" jqx-"+this.template,""!=this.theme&&(d+=" jqx-"+this.template+"-"+this.theme)),this.buttonObj.addClass(d),this._oldCSSCurrent=d):(d=this.isMouseOver&&!this.isTouchDevice?this.isPressed?h:f:this.isPressed?c:e,this.isFocused&&(d+=" "+b),"default"!==this.template&&""!==this.template&&(d+=" jqx-"+this.template,""!=this.theme&&(d+=" jqx-"+this.template+"-"+this.theme)),d!=this._oldCSSCurrent&&(this._oldCSSCurrent&&this.buttonObj.removeClass(this._oldCSSCurrent),
this.buttonObj.addClass(d),this._oldCSSCurrent=d),this.rtl&&(this.buttonObj.addClass(this.toThemeProperty("jqx-rtl")),this.element.style.direction="rtl"),this.isMaterialized()&&this.host.addClass("buttonRipple")))}}});c.jqx.jqxWidget("jqxLinkButton","",{});c.extend(c.jqx._jqxLinkButton.prototype,{defineInstance:function(){this.disabled=!1;this.width=this.height=null;this.rtl=!1;this.href=null},createInstance:function(b){var d=this;this.host.onselectstart=function(){return!1};this.host.attr("role",
"button");var e=this.height||this.element.offsetHeight,f=this.width||this.element.offsetWidth;this.href=this.element.getAttribute("href");this.target=this.element.getAttribute("target");this.content=this.host.text();this.element.innerHTML="";var g=document.createElement("input");g.type="button";g.className="jqx-wrapper "+this.toThemeProperty("jqx-reset");this._setSize(g,f,e);g.value=this.content;(new c(this.element)).addClass(this.toThemeProperty("jqx-link"));this.element.style.color="inherit";this.element.appendChild(g);
this._setSize(g,f,e);b=void 0==b?{}:b[0]||{};c(g).jqxButton(b);this.wrapElement=g;this.disabled&&(this.element.disabled=!0);this.propertyChangeMap.disabled=function(b,e,d,f){b.element.disabled=f;b.wrapElement.jqxButton({disabled:f})};this.addHandler(c(g),"click",function(b){if(!this.disabled)d.onclick(b);return!1})},_setSize:function(b,d,e){e&&(isNaN(e)||(e+="px"),b.style.height=e);d&&(isNaN(d)||(d+="px"),b.style.width=d)},onclick:function(b){null!=this.target?window.open(this.href,this.target):window.location=
this.href}});c.jqx.jqxWidget("jqxRepeatButton","jqxButton",{});c.extend(c.jqx._jqxRepeatButton.prototype,{defineInstance:function(){this.delay=50},createInstance:function(b){var d=this,e=c.jqx.mobile.isTouchDevice();b=e?"touchend."+this.base.element.id:"mouseup."+this.base.element.id;var f=e?"touchstart."+this.base.element.id:"mousedown."+this.base.element.id;this.addHandler(c(document),b,function(b){null!=d.timeout&&(clearTimeout(d.timeout),d.timeout=null,d.refresh());void 0!=d.timer&&(clearInterval(d.timer),
d.timer=null,d.refresh())});this.addHandler(this.base.host,f,function(b){null!=d.timer&&clearInterval(d.timer);d.timeout=setTimeout(function(){clearInterval(d.timer);d.timer=setInterval(function(b){d.ontimer(b)},d.delay)},150)});this.mousemovefunc=function(b){e||0!=b.which||null==d.timer||(clearInterval(d.timer),d.timer=null)};this.addHandler(this.base.host,"mousemove",this.mousemovefunc)},destroy:function(){var b=c.jqx.mobile.isTouchDevice(),d=b?"touchend."+this.base.element.id:"mouseup."+this.base.element.id,
b=b?"touchstart."+this.base.element.id:"mousedown."+this.base.element.id;this.removeHandler(this.base.host,"mousemove",this.mousemovefunc);this.removeHandler(this.base.host,b);this.removeHandler(c(document),d);this.timer=null;delete this.mousemovefunc;delete this.timer;(d=c.data(this.base.element,"jqxRepeatButton"))&&delete d.instance;c(this.base.element).removeData();this.base.destroy();delete this.base},stop:function(){clearInterval(this.timer);this.timer=null},ontimer:function(b){b=new c.Event("click");
null!=this.base&&null!=this.base.host&&this.base.host.trigger(b)}});c.jqx.jqxWidget("jqxToggleButton","jqxButton",{});c.extend(c.jqx._jqxToggleButton.prototype,{defineInstance:function(){this.toggled=!1;this.uiToggle=!0;this.aria={"aria-checked":{name:"toggled",type:"boolean"},"aria-disabled":{name:"disabled",type:"boolean"}}},createInstance:function(b){var d=this;d.base.overrideTheme=!0;d.isTouchDevice=c.jqx.mobile.isTouchDevice();c.jqx.aria(this);d.propertyChangeMap.roundedCorners=function(b,d,
g,h){b.base.buttonObj.removeClass(b.toThemeProperty(c.jqx.cssroundedcorners(g)));b.base.buttonObj.addClass(b.toThemeProperty(c.jqx.cssroundedcorners(h)))};d.propertyChangeMap.toggled=function(b,d,c,h){b.refresh()};d.propertyChangeMap.disabled=function(b,d,c,h){b.base.disabled=h;b.refresh()};d.addHandler(d.base.host,"click",function(b){!d.base.disabled&&d.uiToggle&&d.toggle()});d.isTouchDevice||(d.addHandler(d.base.host,"mouseenter",function(b){d.base.disabled||d.refresh()}),d.addHandler(d.base.host,
"mouseleave",function(b){d.base.disabled||d.refresh()}));d.addHandler(d.base.host,"mousedown",function(b){d.base.disabled||d.refresh()});d.addHandler(c(document),"mouseup.togglebutton"+d.base.element.id,function(b){d.base.disabled||d.refresh()})},destroy:function(){this._removeHandlers();this.base.destroy()},_removeHandlers:function(){this.removeHandler(this.base.host,"click");this.removeHandler(this.base.host,"mouseenter");this.removeHandler(this.base.host,"mouseleave");this.removeHandler(this.base.host,
"mousedown");this.removeHandler(c(document),"mouseup.togglebutton"+this.base.element.id)},toggle:function(){this.toggled=!this.toggled;this.refresh();c.jqx.aria(this,"aria-checked",this.toggled)},unCheck:function(){this.toggled=!1;this.refresh()},check:function(){this.toggled=!0;this.refresh()},refresh:function(){var b=this.base.toThemeProperty("jqx-fill-state-disabled"),d=this.base.toThemeProperty("jqx-fill-state-normal");this.base.enableDefault||(d="");var e=this.base.toThemeProperty("jqx-fill-state-hover"),
f=this.base.toThemeProperty("jqx-fill-state-pressed"),c=this.base.toThemeProperty("jqx-fill-state-pressed"),h;(this.base.element.disabled=this.base.disabled)?this.base.buttonObj.addClass(d+" "+b):(h=this.base.isMouseOver&&!this.isTouchDevice?this.base.isPressed||this.toggled?c:e:this.base.isPressed||this.toggled?f:d,"default"!==this.base.template&&""!==this.base.template&&(h+=" jqx-"+this.base.template,""!=this.base.theme&&(h+=" jqx-"+this.template+"-"+this.base.theme)),this.base.buttonObj.hasClass(b)&&
b!=h&&this.base.buttonObj.removeClass(b),this.base.buttonObj.hasClass(d)&&d!=h&&this.base.buttonObj.removeClass(d),this.base.buttonObj.hasClass(e)&&e!=h&&this.base.buttonObj.removeClass(e),this.base.buttonObj.hasClass(f)&&f!=h&&this.base.buttonObj.removeClass(f),this.base.buttonObj.hasClass(c)&&c!=h&&this.base.buttonObj.removeClass(c),this.base.buttonObj.hasClass(h)||this.base.buttonObj.addClass(h))}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxScrollBar","",{});c.extend(c.jqx._jqxScrollBar.prototype,{defineInstance:function(){var b={height:null,width:null,vertical:!1,min:0,max:1E3,value:0,step:10,largestep:50,thumbMinSize:10,thumbSize:0,thumbStep:"auto",roundedCorners:"all",showButtons:!0,disabled:!1,touchMode:"auto",touchModeStyle:"auto",thumbTouchSize:0,_triggervaluechanged:!0,rtl:!1,areaDownCapture:!1,areaUpCapture:!1,_initialLayout:!1,offset:0,reference:0,velocity:0,frame:0,timestamp:0,ticker:null,amplitude:0,
target:0};if(this===c.jqx._jqxScrollBar.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(b){this.render()},render:function(){this._mouseup=new Date;var b=this;c.jqx.utilities&&"hidden"==c.jqx.utilities.scrollBarButtonsVisibility&&(this.showButtons=!1);b.WinJS?MSApp.execUnsafeLocalFunction(function(){b.host.html("<div id='jqxScrollOuterWrap' style='box-sizing: content-box; width:100%; height: 100%; align:left; border: 0px; valign:top; position: relative;'><div id='jqxScrollWrap' style='box-sizing: content-box; width:100%; height: 100%; left: 0px; top: 0px; align:left; valign:top; position: absolute;'><div id='jqxScrollBtnUp' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'><div></div></div><div id='jqxScrollAreaUp' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollThumb' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollAreaDown' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollBtnDown' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'><div></div></div></div></div>")}):
this.element.innerHTML="<div id='jqxScrollOuterWrap' style='box-sizing: content-box; width:100%; height: 100%; align:left; border: 0px; valign:top; position: relative;'><div id='jqxScrollWrap' style='box-sizing: content-box; width:100%; height: 100%; left: 0px; top: 0px; align:left; valign:top; position: absolute;'><div id='jqxScrollBtnUp' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'><div></div></div><div id='jqxScrollAreaUp' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollThumb' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollAreaDown' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'></div><div id='jqxScrollBtnDown' style='box-sizing: content-box; align:left; valign:top; left: 0px; top: 0px; position: absolute;'><div></div></div></div></div>";
void 0!=this.width&&0<parseInt(this.width)&&this.host.width(parseInt(this.width));void 0!=this.height&&0<parseInt(this.height)&&this.host.height(parseInt(this.height));this.isPercentage=!1;null!=this.width&&-1!=this.width.toString().indexOf("%")&&(this.host.width(this.width),this.isPercentage=!0);null!=this.height&&-1!=this.height.toString().indexOf("%")&&(this.host.height(this.height),this.isPercentage=!0);if(this.isPercentage){var d=this;c.jqx.utilities.resize(this.host,function(){d._arrange()},
!1)}this.thumbCapture=!1;this.scrollOuterWrap=c(this.element.firstChild);this.scrollWrap=c(this.scrollOuterWrap[0].firstChild);this.btnUp=c(this.scrollWrap[0].firstChild);this.areaUp=c(this.btnUp[0].nextSibling);this.btnThumb=c(this.areaUp[0].nextSibling);this.arrowUp=c(this.btnUp[0].firstChild);this.areaDown=c(this.btnThumb[0].nextSibling);this.btnDown=c(this.areaDown[0].nextSibling);this.arrowDown=c(this.btnDown[0].firstChild);var e=this.element.id;this.btnUp[0].id="jqxScrollBtnUp"+e;this.btnDown[0].id=
"jqxScrollBtnDown"+e;this.btnThumb[0].id="jqxScrollThumb"+e;this.areaUp[0].id="jqxScrollAreaUp"+e;this.areaDown[0].id="jqxScrollAreaDown"+e;this.scrollWrap[0].id="jqxScrollWrap"+e;this.scrollOuterWrap[0].id="jqxScrollOuterWrap"+e;if(!this.host.jqxRepeatButton)throw Error("jqxScrollBar: Missing reference to jqxbuttons.js.");this.btnUp.jqxRepeatButton({_ariaDisabled:!0,overrideTheme:!0,disabled:this.disabled});this.btnDown.jqxRepeatButton({_ariaDisabled:!0,overrideTheme:!0,disabled:this.disabled});
this.btnDownInstance=c.data(this.btnDown[0],"jqxRepeatButton").instance;this.btnUpInstance=c.data(this.btnUp[0],"jqxRepeatButton").instance;this.areaUp.jqxRepeatButton({_scrollAreaButton:!0,_ariaDisabled:!0,overrideTheme:!0});this.areaDown.jqxRepeatButton({_scrollAreaButton:!0,_ariaDisabled:!0,overrideTheme:!0});this.btnThumb.jqxButton({_ariaDisabled:!0,overrideTheme:!0,disabled:this.disabled});this.propertyChangeMap.value=function(b,e,d,c){isNaN(c)||d!=c&&b.setPosition(parseFloat(c),!0)};this.propertyChangeMap.width=
function(b,e,d,c){void 0!=b.width&&0<parseInt(b.width)&&(b.host.width(parseInt(b.width)),b._arrange())};this.propertyChangeMap.height=function(b,e,d,c){void 0!=b.height&&0<parseInt(b.height)&&(b.host.height(parseInt(b.height)),b._arrange())};this.propertyChangeMap.theme=function(b,e,d,c){b.setTheme()};this.propertyChangeMap.max=function(b,e,d,c){isNaN(c)||d==c||(b.max=parseInt(c),b.min>b.max&&(b.max=b.min+1),b._arrange(),b.setPosition(b.value))};this.propertyChangeMap.min=function(b,e,d,c){isNaN(c)||
d==c||(b.min=parseInt(c),b.min>b.max&&(b.max=b.min+1),b._arrange(),b.setPosition(b.value))};this.propertyChangeMap.disabled=function(b,e,d,c){d!=c&&(c?b.host.addClass(b.toThemeProperty("jqx-fill-state-disabled")):b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")),b.btnUp.jqxRepeatButton("disabled",b.disabled),b.btnDown.jqxRepeatButton("disabled",b.disabled),b.btnThumb.jqxButton("disabled",b.disabled))};this.propertyChangeMap.touchMode=function(b,e,d,c){d!=c&&(b._updateTouchBehavior(),
!0===c?(b.showButtons=!1,b.refresh()):!1===c&&(b.showButtons=!0,b.refresh()))};this.propertyChangeMap.rtl=function(b,e,d,c){d!=c&&b.refresh()};this.buttonDownCapture=this.buttonUpCapture=!1;this._updateTouchBehavior();this.setPosition(this.value);this._addHandlers();this.setTheme()},resize:function(b,d){this.width=b;this.height=d;this._arrange()},_updateTouchBehavior:function(){this.isTouchDevice=c.jqx.mobile.isTouchDevice();1==this.touchMode?(c.jqx.browser.msie&&9>c.jqx.browser.version||(this.isTouchDevice=
!0,c.jqx.mobile.setMobileSimulator(this.btnThumb[0]),this._removeHandlers(),this._addHandlers()),this.setTheme()):0==this.touchMode&&(this.isTouchDevice=!1)},_addHandlers:function(){var b=this,d=!1;try{if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)this._touchSupport=d=!0}catch(f){}if(b.isTouchDevice||d)this.addHandler(this.btnThumb,c.jqx.mobile.getTouchEventName("touchend"),function(e){var d=b.vertical?b.toThemeProperty("jqx-scrollbar-thumb-state-pressed"):b.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal"),
c=b.toThemeProperty("jqx-fill-state-pressed");b.btnThumb.removeClass(d);b.btnThumb.removeClass(c);b.disabled||b.handlemouseup(b,e);return!1}),this.addHandler(this.btnThumb,c.jqx.mobile.getTouchEventName("touchstart"),function(e){b.disabled||(1==b.touchMode?(e.clientX=e.originalEvent.clientX,e.clientY=e.originalEvent.clientY):e.originalEvent.touches&&e.originalEvent.touches.length?(e.clientX=e.originalEvent.touches[0].clientX,e.clientY=e.originalEvent.touches[0].clientY):(e.clientX=e.originalEvent.clientX,
e.clientY=e.originalEvent.clientY),b.handlemousedown(e),e.preventDefault&&e.preventDefault())}),c.jqx.mobile.touchScroll(this.element,b.max,function(e,d,c,l,q){"visible"==b.host.css("visibility")&&(1==b.touchMode?(q.clientX=q.originalEvent.clientX,q.clientY=q.originalEvent.clientY):q.originalEvent.touches&&q.originalEvent.touches.length?(q.clientX=q.originalEvent.touches[0].clientX,q.clientY=q.originalEvent.touches[0].clientY):(q.clientX=q.originalEvent.clientX,q.clientY=q.originalEvent.clientY),
e=b.vertical?b.toThemeProperty("jqx-scrollbar-thumb-state-pressed"):b.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal"),b.btnThumb.addClass(e),b.btnThumb.addClass(b.toThemeProperty("jqx-fill-state-pressed")),b.thumbCapture=!0,b.handlemousemove(q))},b.element.id,b.host,b.host);if(!this.isTouchDevice){try{""==document.referrer&&!window.frameElement||null==window.top||window.top==window.self||(d=null,window.parent&&document.referrer&&(d=document.referrer),d&&-1!=d.indexOf(document.location.host)&&
(d=function(e){b.disabled||b.handlemouseup(b,e)},window.top.document.addEventListener?window.top.document.addEventListener("mouseup",d,!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",d)))}catch(f){}this.addHandler(this.btnDown,"click mouseup mousedown",function(e){var d=b.step;Math.abs(b.max-b.min)<=d&&(d=1);b.rtl&&!b.vertical&&(d=-b.step);switch(e.type){case "click":b.buttonDownCapture&&!b.isTouchDevice?b.disabled||b.setPosition(b.value+d):!b.disabled&&b.isTouchDevice&&
b.setPosition(b.value+d);break;case "mouseup":if(!b.btnDownInstance.base.disabled&&b.buttonDownCapture)return b.buttonDownCapture=!1,b.btnDown.removeClass(b.toThemeProperty("jqx-scrollbar-button-state-pressed")),b.btnDown.removeClass(b.toThemeProperty("jqx-fill-state-pressed")),b._removeArrowClasses("pressed","down"),b.handlemouseup(b,e),b.setPosition(b.value+d),!1;break;case "mousedown":if(!b.btnDownInstance.base.disabled)return b.buttonDownCapture=!0,b.btnDown.addClass(b.toThemeProperty("jqx-fill-state-pressed")),
b.btnDown.addClass(b.toThemeProperty("jqx-scrollbar-button-state-pressed")),b._addArrowClasses("pressed","down"),!1}});this.addHandler(this.btnUp,"click mouseup mousedown",function(e){var d=b.step;Math.abs(b.max-b.min)<=d&&(d=1);b.rtl&&!b.vertical&&(d=-b.step);switch(e.type){case "click":b.buttonUpCapture&&!b.isTouchDevice?b.disabled||b.setPosition(b.value-d):!b.disabled&&b.isTouchDevice&&b.setPosition(b.value-d);break;case "mouseup":if(!b.btnUpInstance.base.disabled&&b.buttonUpCapture)return b.buttonUpCapture=
!1,b.btnUp.removeClass(b.toThemeProperty("jqx-scrollbar-button-state-pressed")),b.btnUp.removeClass(b.toThemeProperty("jqx-fill-state-pressed")),b._removeArrowClasses("pressed","up"),b.handlemouseup(b,e),b.setPosition(b.value-d),!1;break;case "mousedown":if(!b.btnUpInstance.base.disabled)return b.buttonUpCapture=!0,b.btnUp.addClass(b.toThemeProperty("jqx-fill-state-pressed")),b.btnUp.addClass(b.toThemeProperty("jqx-scrollbar-button-state-pressed")),b._addArrowClasses("pressed","up"),!1}})}d="click";
this.isTouchDevice&&(d=c.jqx.mobile.getTouchEventName("touchend"));this.addHandler(this.areaUp,d,function(e){if(!b.disabled)return e=b.largestep,b.rtl&&!b.vertical&&(e=-b.largestep),b.setPosition(b.value-e),!1});this.addHandler(this.areaDown,d,function(e){if(!b.disabled)return e=b.largestep,b.rtl&&!b.vertical&&(e=-b.largestep),b.setPosition(b.value+e),!1});this.addHandler(this.areaUp,"mousedown",function(e){if(!b.disabled)return b.areaUpCapture=!0,!1});this.addHandler(this.areaDown,"mousedown",function(e){if(!b.disabled)return b.areaDownCapture=
!0,!1});this.addHandler(this.btnThumb,"mousedown dragstart",function(e){if("dragstart"===e.type)return!1;b.disabled||b.handlemousedown(e);e.preventDefault&&e.preventDefault()});this.addHandler(c(document),"mouseup."+this.element.id,function(e){b.disabled||b.handlemouseup(b,e)});if(!this.isTouchDevice&&(this.mousemoveFunc=function(e){b.disabled||b.handlemousemove(e)},this.addHandler(c(document),"mousemove."+this.element.id,this.mousemoveFunc),this.addHandler(c(document),"mouseleave."+this.element.id,
function(e){b.disabled||b.handlemouseleave(e)}),this.addHandler(c(document),"mouseenter."+this.element.id,function(e){b.disabled||b.handlemouseenter(e)}),!b.disabled)){this.addHandler(this.btnUp,"mouseenter mouseleave",function(e){"mouseenter"===e.type?b.disabled||b.btnUpInstance.base.disabled||1==b.touchMode||(b.btnUp.addClass(b.toThemeProperty("jqx-scrollbar-button-state-hover")),b.btnUp.addClass(b.toThemeProperty("jqx-fill-state-hover")),b._addArrowClasses("hover","up")):b.disabled||b.btnUpInstance.base.disabled||
1==b.touchMode||(b.btnUp.removeClass(b.toThemeProperty("jqx-scrollbar-button-state-hover")),b.btnUp.removeClass(b.toThemeProperty("jqx-fill-state-hover")),b._removeArrowClasses("hover","up"))});var e=b.toThemeProperty("jqx-scrollbar-thumb-state-hover");b.vertical||(e=b.toThemeProperty("jqx-scrollbar-thumb-state-hover-horizontal"));this.addHandler(this.btnThumb,"mouseenter mouseleave",function(d){"mouseenter"===d.type?b.disabled||1==b.touchMode||(b.btnThumb.addClass(e),b.btnThumb.addClass(b.toThemeProperty("jqx-fill-state-hover"))):
b.disabled||1==b.touchMode||(b.btnThumb.removeClass(e),b.btnThumb.removeClass(b.toThemeProperty("jqx-fill-state-hover")))});this.addHandler(this.btnDown,"mouseenter mouseleave",function(e){"mouseenter"===e.type?b.disabled||b.btnDownInstance.base.disabled||1==b.touchMode||(b.btnDown.addClass(b.toThemeProperty("jqx-scrollbar-button-state-hover")),b.btnDown.addClass(b.toThemeProperty("jqx-fill-state-hover")),b._addArrowClasses("hover","down")):b.disabled||b.btnDownInstance.base.disabled||1==b.touchMode||
(b.btnDown.removeClass(b.toThemeProperty("jqx-scrollbar-button-state-hover")),b.btnDown.removeClass(b.toThemeProperty("jqx-fill-state-hover")),b._removeArrowClasses("hover","down"))})}},destroy:function(){var b=this.btnUp,d=this.btnDown,e=this.btnThumb,f=this.areaUp,g=this.areaDown;this.arrowUp.remove();delete this.arrowUp;this.arrowDown.remove();delete this.arrowDown;g.removeClass();f.removeClass();d.removeClass();b.removeClass();e.removeClass();b.jqxRepeatButton("destroy");d.jqxRepeatButton("destroy");
f.jqxRepeatButton("destroy");g.jqxRepeatButton("destroy");e.jqxButton("destroy");b=c.data(this.element,"jqxScrollBar");this._removeHandlers();this.scrollOuterWrap=this.areaDown=this.areaUp=this.scrollWrap=this.btnDown=this.btnUp=null;delete this.mousemoveFunc;delete this.btnDownInstance;delete this.btnUpInstance;delete this.scrollOuterWrap;delete this.scrollWrap;delete this.btnDown;delete this.areaDown;delete this.areaUp;delete this.btnDown;delete this.btnUp;delete this.btnThumb;delete this.propertyChangeMap.value;
delete this.propertyChangeMap.min;delete this.propertyChangeMap.max;delete this.propertyChangeMap.touchMode;delete this.propertyChangeMap.disabled;delete this.propertyChangeMap.theme;delete this.propertyChangeMap;b&&delete b.instance;this.host.removeData();this.host.remove();delete this.host;delete this.set;delete this.get;delete this.call;delete this.element},_removeHandlers:function(){this.removeHandler(this.btnUp,"mouseenter");this.removeHandler(this.btnDown,"mouseenter");this.removeHandler(this.btnThumb,
"mouseenter");this.removeHandler(this.btnUp,"mouseleave");this.removeHandler(this.btnDown,"mouseleave");this.removeHandler(this.btnThumb,"mouseleave");this.removeHandler(this.btnUp,"click");this.removeHandler(this.btnDown,"click");this.removeHandler(this.btnDown,"mouseup");this.removeHandler(this.btnUp,"mouseup");this.removeHandler(this.btnDown,"mousedown");this.removeHandler(this.btnUp,"mousedown");this.removeHandler(this.areaUp,"mousedown");this.removeHandler(this.areaDown,"mousedown");this.removeHandler(this.areaUp,
"click");this.removeHandler(this.areaDown,"click");this.removeHandler(this.btnThumb,"mousedown");this.removeHandler(this.btnThumb,"dragstart");this.removeHandler(c(document),"mouseup."+this.element.id);this.mousemoveFunc?this.removeHandler(c(document),"mousemove."+this.element.id,this.mousemoveFunc):this.removeHandler(c(document),"mousemove."+this.element.id);this.removeHandler(c(document),"mouseleave."+this.element.id);this.removeHandler(c(document),"mouseenter."+this.element.id)},_addArrowClasses:function(b,
d){"pressed"==b&&(b="selected");""!=b&&(b="-"+b);this.vertical?("up"!=d&&void 0!=d||this.arrowUp.addClass(this.toThemeProperty("jqx-icon-arrow-up"+b)),"down"!=d&&void 0!=d||this.arrowDown.addClass(this.toThemeProperty("jqx-icon-arrow-down"+b))):("up"!=d&&void 0!=d||this.arrowUp.addClass(this.toThemeProperty("jqx-icon-arrow-left"+b)),"down"!=d&&void 0!=d||this.arrowDown.addClass(this.toThemeProperty("jqx-icon-arrow-right"+b)))},_removeArrowClasses:function(b,d){"pressed"==b&&(b="selected");""!=b&&
(b="-"+b);this.vertical?("up"!=d&&void 0!=d||this.arrowUp.removeClass(this.toThemeProperty("jqx-icon-arrow-up"+b)),"down"!=d&&void 0!=d||this.arrowDown.removeClass(this.toThemeProperty("jqx-icon-arrow-down"+b))):("up"!=d&&void 0!=d||this.arrowUp.removeClass(this.toThemeProperty("jqx-icon-arrow-left"+b)),"down"!=d&&void 0!=d||this.arrowDown.removeClass(this.toThemeProperty("jqx-icon-arrow-right"+b)))},setTheme:function(){var b=this.btnUp,d=this.btnDown,e=this.btnThumb,f=this.scrollWrap,g=this.arrowUp,
h=this.arrowDown;this.scrollWrap[0].className=this.toThemeProperty("jqx-reset");this.scrollOuterWrap[0].className=this.toThemeProperty("jqx-reset");var l=this.toThemeProperty("jqx-reset");this.areaDown[0].className=l;this.areaUp[0].className=l;var q=this.toThemeProperty("jqx-scrollbar")+" "+this.toThemeProperty("jqx-widget")+" "+this.toThemeProperty("jqx-widget-content");this.host.addClass(q);this.isTouchDevice&&this.host.addClass(this.toThemeProperty("jqx-scrollbar-mobile"));d[0].className=this.toThemeProperty("jqx-scrollbar-button-state-normal");
b[0].className=this.toThemeProperty("jqx-scrollbar-button-state-normal");this.vertical?(g[0].className=l+" "+this.toThemeProperty("jqx-icon-arrow-up"),h[0].className=l+" "+this.toThemeProperty("jqx-icon-arrow-down"),g=this.toThemeProperty("jqx-scrollbar-thumb-state-normal")):(g[0].className=l+" "+this.toThemeProperty("jqx-icon-arrow-left"),h[0].className=l+" "+this.toThemeProperty("jqx-icon-arrow-right"),g=this.toThemeProperty("jqx-scrollbar-thumb-state-normal-horizontal"));g+=" "+this.toThemeProperty("jqx-fill-state-normal");
e[0].className=g;this.disabled?(f.addClass(this.toThemeProperty("jqx-fill-state-disabled")),f.removeClass(this.toThemeProperty("jqx-scrollbar-state-normal"))):(f.addClass(this.toThemeProperty("jqx-scrollbar-state-normal")),f.removeClass(this.toThemeProperty("jqx-fill-state-disabled")));"all"==this.roundedCorners?(this.host.addClass(this.toThemeProperty("jqx-rc-all")),this.vertical?(f=c.jqx.cssroundedcorners("top"),f=this.toThemeProperty(f),b.addClass(f),f=c.jqx.cssroundedcorners("bottom")):(f=c.jqx.cssroundedcorners("left"),
f=this.toThemeProperty(f),b.addClass(f),f=c.jqx.cssroundedcorners("right")),f=this.toThemeProperty(f),d.addClass(f)):(d=c.jqx.cssroundedcorners(this.roundedCorners),d=this.toThemeProperty(d),elBtnUp.addClass(d),elBtnDown.addClass(d));d=c.jqx.cssroundedcorners(this.roundedCorners);d=this.toThemeProperty(d);e.hasClass(d)||e.addClass(d);"none"===b.css("display")&&(this.showButtons=!1,this.touchModeStyle=!0,e.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-normal-touch")));this.isTouchDevice&&
0!=this.touchModeStyle&&(this.showButtons=!1,e.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-normal-touch")))},isScrolling:function(){return void 0==this.thumbCapture||void 0==this.buttonDownCapture||void 0==this.buttonUpCapture||void 0==this.areaDownCapture||void 0==this.areaUpCapture?!1:this.thumbCapture||this.buttonDownCapture||this.buttonUpCapture||this.areaDownCapture||this.areaUpCapture},track:function(){var b,d;b=Date.now();d=b-this.timestamp;this.timestamp=b;b=this.offset-this.frame;
this.frame=this.offset;this.velocity=1E3*b/(1+d)*.2+.2*this.velocity},handlemousedown:function(b){function d(b){f.reference=parseInt(f.btnThumb[0].style.top);f.offset=parseInt(f.btnThumb[0].style.top);f.vertical||(f.reference=parseInt(f.btnThumb[0].style.left),f.offset=parseInt(f.btnThumb[0].style.left));f.velocity=f.amplitude=0;f.frame=f.offset;f.timestamp=Date.now();clearInterval(f.ticker);f.ticker=setInterval(function(){f.track()},100)}if(void 0==this.thumbCapture||0==this.thumbCapture){this.thumbCapture=
!0;var e=this.btnThumb;null!=e&&(e.addClass(this.toThemeProperty("jqx-fill-state-pressed")),this.vertical?e.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-pressed")):e.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal")))}var f=this;this.thumbCapture&&c.jqx.scrollAnimation&&d(b);this.dragStartX=b.clientX;this.dragStartY=b.clientY;this.dragStartValue=this.value},toggleHover:function(b,d){},refresh:function(){this._arrange()},_setElementPosition:function(b,d,e){isNaN(d)||
parseInt(b[0].style.left)==parseInt(d)||(b[0].style.left=d+"px");isNaN(e)||parseInt(b[0].style.top)==parseInt(e)||(b[0].style.top=e+"px")},_setElementTopPosition:function(b,d){isNaN(d)||(b[0].style.top=d+"px")},_setElementLeftPosition:function(b,d){isNaN(d)||(b[0].style.left=d+"px")},handlemouseleave:function(b){b=this.btnUp;var d=this.btnDown;if(this.buttonDownCapture||this.buttonUpCapture)b.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),d.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),
this._removeArrowClasses("pressed");1==this.thumbCapture&&(b=this.btnThumb,d=this.vertical?this.toThemeProperty("jqx-scrollbar-thumb-state-pressed"):this.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal"),b.removeClass(d),b.removeClass(this.toThemeProperty("jqx-fill-state-pressed")))},handlemouseenter:function(b){b=this.btnUp;var d=this.btnDown;this.buttonUpCapture&&(b.addClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),b.addClass(this.toThemeProperty("jqx-fill-state-pressed")),
this._addArrowClasses("pressed","up"));this.buttonDownCapture&&(d.addClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),d.addClass(this.toThemeProperty("jqx-fill-state-pressed")),this._addArrowClasses("pressed","down"));1==this.thumbCapture&&(b=this.btnThumb,this.vertical?b.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-pressed")):b.addClass(this.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal")),b.addClass(this.toThemeProperty("jqx-fill-state-pressed")))},handlemousemove:function(b){var d=
this.btnUp,e=this.btnDown;if(null!=e&&null!=d){null!=d&&null!=e&&void 0!=this.buttonDownCapture&&void 0!=this.buttonUpCapture&&(this.buttonDownCapture&&0==b.which?(e.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),e.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),this._removeArrowClasses("pressed","down"),this.buttonDownCapture=!1):this.buttonUpCapture&&0==b.which&&(d.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),d.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),
this._removeArrowClasses("pressed","up"),this.buttonUpCapture=!1));if(1!=this.thumbCapture)return!1;var f=this.btnThumb;if(0==b.which&&!this.isTouchDevice&&!this._touchSupport)return this.thumbCapture=!1,this._arrange(),b=this.vertical?this.toThemeProperty("jqx-scrollbar-thumb-state-pressed"):this.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal"),f.removeClass(b),f.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),!0;void 0!=b.preventDefault&&b.preventDefault();null!=b.originalEvent&&
(b.originalEvent.mouseHandled=!0);void 0!=b.stopPropagation&&b.stopPropagation();var c=0;try{var c=this.vertical?b.clientY-this.dragStartY:b.clientX-this.dragStartX,h=this._btnAndThumbSize;this._btnAndThumbSize||(h=this.vertical?d.height()+e.height()+f.height():d.width()+e.width()+f.width());var l=(this.max-this.min)/(this.scrollBarSize-h);if("auto"==this.thumbStep)c*=l;else{c*=l;if(Math.abs(this.dragStartValue+c-this.value)>=parseInt(this.thumbStep)){var q=Math.round(parseInt(c)/this.thumbStep)*
this.thumbStep;this.rtl&&!this.vertical?this.setPosition(this.dragStartValue-q):this.setPosition(this.dragStartValue+q)}return!1}q=c;this.rtl&&!this.vertical&&(q=-c);this.setPosition(this.dragStartValue+q);this.offset=parseInt(f[0].style.left);this.vertical&&(this.offset=parseInt(f[0].style.top))}catch(r){alert(r)}return!1}},handlemouseup:function(b,d){var e=!1;if(this.thumbCapture){this.thumbCapture=!1;var e=this.btnThumb,f=this.vertical?this.toThemeProperty("jqx-scrollbar-thumb-state-pressed"):
this.toThemeProperty("jqx-scrollbar-thumb-state-pressed-horizontal");e.removeClass(f);e.removeClass(this.toThemeProperty("jqx-fill-state-pressed"));e=!0;this._mouseup=new Date;if(c.jqx.scrollAnimation){var g=function(){var b;if(h.amplitude)if(b=Date.now()-h.timestamp,b=-h.amplitude*Math.exp(-b/325),.5<b||-.5>b){var e=(h.max-h.min)/(h.scrollBarSize-h._btnAndThumbSize),e=b=e*(h.target+b);h.rtl&&!h.vertical&&(e=-b);h.setPosition(h.dragStartValue+e);requestAnimationFrame(g)}else e=(h.max-h.min)/(h.scrollBarSize-
h._btnAndThumbSize),e=b=e*(h.target+b),h.rtl&&!h.vertical&&(e=-b),h.setPosition(h.dragStartValue+e)},h=this;clearInterval(this.ticker);if(25<this.velocity||-25>this.velocity)this.amplitude=.8*this.velocity,this.target=Math.round(this.offset+this.amplitude),this.target-=this.reference,this.timestamp=Date.now(),requestAnimationFrame(g)}}this.areaDownCapture=this.areaUpCapture=!1;if(this.buttonUpCapture||this.buttonDownCapture)e=this.btnUp,f=this.btnDown,this.buttonDownCapture=this.buttonUpCapture=!1,
e.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),f.removeClass(this.toThemeProperty("jqx-scrollbar-button-state-pressed")),e.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),f.removeClass(this.toThemeProperty("jqx-fill-state-pressed")),this._removeArrowClasses("pressed"),e=!0,this._mouseup=new Date;e&&(void 0!=d.preventDefault&&d.preventDefault(),null!=d.originalEvent&&(d.originalEvent.mouseHandled=!0),void 0!=d.stopPropagation&&d.stopPropagation())},setPosition:function(b,
d){if(void 0==b||NaN==b)b=this.min;b>=this.max&&(b=this.max);b<this.min&&(b=this.min);if(this.value!==b||1==d){if(b==this.max){var e=new c.Event("complete");this.host.trigger(e)}e=this.value;if(this._triggervaluechanged){var f=new c.Event("valueChanged");f.previousValue=this.value;f.currentValue=b}this.value=b;this._positionelements();this._triggervaluechanged&&this.host.trigger(f);this.valueChanged&&this.valueChanged({currentValue:this.value,previousvalue:e})}return b},val:function(b){var d;a:{for(d in b)if(b.hasOwnProperty(d)){d=
!1;break a}d="number"==typeof b||"date"==typeof b||"boolean"==typeof b||"string"==typeof b?!1:!0}if(d||0==arguments.length)return this.value;this.setPosition(b);return b},_getThumbSize:function(b){var d=this.max-this.min,e=0;1<d?e=b/(d+b)*b:1==d?e=b-1:0==d&&(e=b);0<this.thumbSize&&(e=this.thumbSize);e<this.thumbMinSize&&(e=this.thumbMinSize);return Math.min(e,b)},_positionelements:function(){var b=this.areaUp,d=this.areaDown,e=this.btnThumb,f=this._height?this._height:this.host.height(),c=this._width?
this._width:this.host.width(),h=this.vertical?c:f;this.showButtons||(h=0);var l=this.vertical?f:c;this.scrollBarSize=l;f=this._getThumbSize(l-2*h);f=Math.floor(f);f<this.thumbMinSize&&(f=this.thumbMinSize);this.btnSize=h+=2;var q=this._btnAndThumbSize;this._btnAndThumbSize||(q=this.vertical?2*this.btnSize+e.outerHeight():2*this.btnSize+e.outerWidth(),q=Math.round(q));c=(l-q)/(this.max-this.min)*(this.value-this.min);this.rtl&&!this.vertical&&(c=(l-q)/(this.max-this.min)*(this.max-this.value-this.min));
c=Math.round(c);0>c&&(c=0);this.vertical?(l=l-c-q,0>l&&(l=0),d[0].style.height=l+"px",b[0].style.height=c+"px",this._setElementTopPosition(b,h),this._setElementTopPosition(e,h+c),this._setElementTopPosition(d,h+c+f)):(b[0].style.width=c+"px",d[0].style.width=0<=l-c-q?l-c-q+"px":"0px",this._setElementLeftPosition(b,h),this._setElementLeftPosition(e,h+c),this._setElementLeftPosition(d,2+h+c+f))},_arrange:function(){if(this._initialLayout)this._initialLayout=!1;else{if(this.min>this.max){var b=this.min;
this.min=this.max;this.max=b}0>this.min&&(b=this.max-this.min,this.min=0,this.max=b);var b=this.areaUp,d=this.areaDown,e=this.btnUp,f=this.btnDown,c=this.btnThumb,h=this.scrollWrap,l=parseInt(this.element.style.height),q=parseInt(this.element.style.width);this.isPercentage&&(l=this.host.height(),q=this.host.width());isNaN(l)&&(l=0);isNaN(q)&&(q=0);this._width=q;this._height=l;var r=this.vertical?q:l;this.showButtons||(r=0);e[0].style.width=r+"px";e[0].style.height=r+"px";f[0].style.width=r+"px";f[0].style.height=
r+"px";this.vertical?h[0].style.width=q+2+"px":h[0].style.height=l+2+"px";this._setElementPosition(e,0,0);e=r+2;this.vertical?this._setElementPosition(f,0,l-e):this._setElementPosition(f,q-e,0);var t=this.vertical?l:q;this.scrollBarSize=t;f=this._getThumbSize(t-2*e);f=Math.floor(f-2);f<this.thumbMinSize&&(f=this.thumbMinSize);h=!1;this.isTouchDevice&&0!=this.touchModeStyle&&(h=!0);this.vertical?(c[0].style.width=q+"px",c[0].style.height=f+"px",h&&0!==this.thumbTouchSize&&(c.css({width:this.thumbTouchSize+
"px"}),c.css("margin-left",(this.host.width()-this.thumbTouchSize)/2))):(c[0].style.width=f+"px",c[0].style.height=l+"px",h&&0!==this.thumbTouchSize&&(c.css({height:this.thumbTouchSize+"px"}),c.css("margin-top",(this.host.height()-this.thumbTouchSize)/2)));if(NaN==l||10>l)l=10;if(NaN==q||10>q)q=10;this.btnSize=r;h=this.vertical?2*e+(2+parseInt(c[0].style.height)):2*e+(2+parseInt(c[0].style.width));this._btnAndThumbSize=h=Math.round(h);var v=(t-h)/(this.max-this.min)*(this.value-this.min);this.rtl&&
!this.vertical&&(v=(t-h)/(this.max-this.min)*(this.max-this.value-this.min));v=Math.round(v);if(isNaN(v)||0>v||-Infinity===v||Infinity===v)v=0;if(this.vertical){l=t-v-h;0>l&&(l=0);d[0].style.height=l+"px";d[0].style.width=q+"px";b[0].style.height=v+"px";b[0].style.width=q+"px";l=parseInt(this.element.style.height);this.isPercentage&&(l=this.host.height());c[0].style.visibility="inherit";if(0>l-3*parseInt(r)||l<h)c[0].style.visibility="hidden";this._setElementPosition(b,0,e);this._setElementPosition(c,
0,e+v);this._setElementPosition(d,0,e+v+f)}else{0<v&&(b[0].style.width=v+"px");0<l&&(b[0].style.height=l+"px");q=t-v-h;0>q&&(q=0);d[0].style.width=q+"px";d[0].style.height=l+"px";l=parseInt(this.element.style.width);this.isPercentage&&(l=this.host.width());c[0].style.visibility="inherit";if(0>l-3*parseInt(r)||l<h)c[0].style.visibility="hidden";this._setElementPosition(b,e,0);this._setElementPosition(c,e+v,0);this._setElementPosition(d,e+v+f,0)}}}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxMenu","",{});c.extend(c.jqx._jqxMenu.prototype,{defineInstance:function(){var b={items:[],mode:"horizontal",width:null,height:null,minimizeWidth:"auto",easing:"easeInOutSine",animationShowDuration:200,animationHideDuration:200,autoCloseInterval:0,animationHideDelay:100,animationShowDelay:10,menuElements:[],autoSizeMainItems:!1,autoCloseOnClick:!0,autoCloseOnMouseLeave:!0,enableRoundedCorners:!0,disabled:!1,autoOpenPopup:!0,enableHover:!0,autoOpen:!0,autoGenerate:!0,
clickToOpen:!1,showTopLevelArrows:!1,touchMode:"auto",source:null,popupZIndex:1E3,rtl:!1,keyboardNavigation:!1,lockFocus:!1,title:"",events:"shown closed itemclick initialized open close".split(" ")};if(this===c.jqx._jqxMenu.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(b){var d=this;this.host.attr("role","menubar");c.jqx.utilities.resize(this.host,function(){d.refresh()},!1,"popup"!=this.mode);"auto"!=this.minimizeWidth&&null!=this.minimizeWidth&&this.width&&-1==this.width.toString().indexOf("%")&&
c(window).resize(function(){d.refresh()});this.host.css("outline","none");this.source&&null!=this.source&&(b=this.loadItems(this.source),this.element.innerHTML=b);this._tmpHTML=this.element.innerHTML;this.element.innerHTML.indexOf("UL")&&(b=this.host.find("ul:first"),0<b.length&&this._createMenu(b[0]));this.host.data("autoclose",{});this._render();this._setSize();c.jqx.browser.msie&&8>c.jqx.browser.version&&this.host.attr("hideFocus",!0)},focus:function(){try{if("popup"===this.mode&&this.keyboardNavigation&&
this.host.closest("div.jqx-menu-wrapper").focus(),this.keyboardNavigation){this.host.focus();var b=this,d=function(){if(c.jqx.isHidden(c(b.items[0].element))){var e=b._nextVisibleItem(b.items[0],0);e&&(c(e.element).addClass(b.toThemeProperty("jqx-fill-state-focus")),b.activeItem=e)}else c(b.items[0].element).addClass(b.toThemeProperty("jqx-fill-state-focus")),b.activeItem=b.items[0]};this.activeItem?c.jqx.isHidden(c(this.activeItem.element))?(c(this.activeItem.element).removeClass(this.toThemeProperty("jqx-fill-state-focus")),
d()):c(this.activeItem.element).addClass(this.toThemeProperty("jqx-fill-state-focus")):d()}}catch(e){}},loadItems:function(b,d){if(null!=b){if(0==b.length)return"";var e=this;this.items=[];var f='<ul class="jqx-menu-ul">';d&&(f='<ul class="jqx-menu-ul" style="width:'+d+';">');c.map(b,function(b){if(void 0==b)return null;f+=e._parseItem(b)});return f+="</ul>"}},_parseItem:function(b){var d;if(void 0==b)return null;var e=b.label;!b.label&&b.html&&(e=b.html);e||(e="Item");"string"===typeof b&&(e=b);
var f=!1;void 0!=b.disabled&&b.disabled&&(f=!0);d="<li";f&&(d+=' item-disabled="true" ');b.label&&!b.html&&(d+=' item-label="'+e+'" ');null!=b.value&&(d+=' item-value="'+b.value+'" ');void 0!=b.id&&(d+=' id="'+b.id+'" ');d+=">"+e;b.items&&(d=b.subMenuWidth?d+this.loadItems(b.items,b.subMenuWidth):d+this.loadItems(b.items));return d+"</li>"},_setSize:function(){null!=this.width&&-1!=this.width.toString().indexOf("%")?this.host.width(this.width):null!=this.width&&-1!=this.width.toString().indexOf("px")?
this.host.width(this.width):void 0==this.width||isNaN(this.width)||this.host.width(this.width);null!=this.height&&-1!=this.height.toString().indexOf("%")?this.host.height(this.height):null!=this.height&&-1!=this.height.toString().indexOf("px")?this.host.height(this.height):void 0==this.height||isNaN(this.height)||this.host.height(this.height);null===this.height&&this.host.height("auto");if(null!=this.minimizeWidth&&"popup"!=this.mode){var b=c(window).width();if(!c.jqx.response){var d=!1;navigator.userAgent.match(/Windows|Linux|MacOS/)&&
(0<=navigator.userAgent.indexOf("Windows Phone")||0<=navigator.userAgent.indexOf("WPDesktop")||0<=navigator.userAgent.indexOf("IEMobile")||0<=navigator.userAgent.indexOf("ZuneWP7")||(d=!0));var e=this.minimizeWidth;if(d&&"auto"==this.minimizeWidth)return}if("auto"==this.minimizeWidth&&c.jqx.response){if(b=new c.jqx.response,"Phone"==b.device.type||"Tablet"==b.device.type)this.minimized||this.minimize()}else b<e&&!this.minimized?this.minimize():this.minimized&&b>=e&&this.restore()}},minimize:function(){if(!this.minimized){var b=
this;this.host.addClass(this.toThemeProperty("jqx-menu-minimized"));this.minimized=!0;this._tmpMode=this.mode;this.mode="simple";var d=this.host.closest("div.jqx-menu-wrapper");d.remove();c("#menuWrapper"+this.element.id).remove();c.each(this.items,function(){c(this.element);c(this.subMenuElement).closest("div.jqx-menu-popup").remove()});if(this.source){var e=this.loadItems(this.source);this.element.innerHTML=e;this._tmpHTML=this.element.innerHTML}this.element.innerHTML=this._tmpHTML;this.element.innerHTML.indexOf("UL")&&
(e=this.host.find("ul:first"),0<e.length&&this._createMenu(e[0]));this._render();e=this.host.find("ul:first");e.wrap('<div class="jqx-menu-wrapper" style="z-index:'+this.popupZIndex+'; padding: 0px; display: none; margin: 0px; height: auto; width: auto; position: absolute; top: 0; left: 0; display: block; visibility: visible;"></div>');d=e.closest("div.jqx-menu-wrapper");d[0].id="menuWrapper"+this.element.id;d.detach();d.appendTo(c(document.body));d.addClass(this.toThemeProperty("jqx-widget"));d.addClass(this.toThemeProperty("jqx-menu"));
d.addClass(this.toThemeProperty("jqx-menu-minimized"));d.addClass(this.toThemeProperty("jqx-widget-header"));e.children().hide();d.hide();d.find("ul").addClass(this.toThemeProperty("jqx-menu-ul-minimized"));this.minimizedItem=c("<div></div>");this.minimizedItem.addClass(this.toThemeProperty("jqx-item"));this.minimizedItem.addClass(this.toThemeProperty("jqx-menu-item-top"));this.addHandler(d,"keydown",function(e){return b.handleKeyDown(e)});this.minimizedItem.addClass(this.toThemeProperty("jqx-menu-minimized-button"));
this.minimizedItem.prependTo(this.host);this.titleElement=c("<div>"+this.title+"</div>");this.titleElement.addClass(this.toThemeProperty("jqx-item"));this.titleElement.addClass(this.toThemeProperty("jqx-menu-title"));this.titleElement.prependTo(this.host);c("<div style='clear:both;'></div>").insertAfter(this.minimizedItem);b.minimizedHidden=!0;var f=function(e){b.minimizedHidden=!0;b.minimizedItem.show();e=!1;"right"==b.minimizedItem.css("float")&&(e=!0);d.animate({left:e?b.host.coord().left+b.host.width()+
d.width():-d.outerWidth(),opacity:0},b.animationHideDuration,function(){d.find("ul:first").children().hide();d.hide()})},g=function(e){if(b.minimizedHidden){d.find("ul:first").children().show();b.minimizedHidden=!1;d.show();d.css("opacity",0);d.css("left",-d.outerWidth());var c=!1,g=d.width();"right"==b.minimizedItem.css("float")&&(d.css("left",b.host.coord().left+b.host.width()+g),c=!0);d.css("top",b.host.coord().top+b.host.height());d.animate({left:c?b.host.coord().left+b.host.width()-g:b.host.coord().left,
opacity:.95},b.animationShowDuration,function(){})}else f(e);b._raiseEvent("2",{type:"mouse",item:b.minimizedItem[0],event:e});b._setSize()};this.addHandler(c(window),"orientationchange.jqxmenu"+this.element.id,function(e){setTimeout(function(){if(!b.minimizedHidden){var e;d.width();var f=!1;e=d.width();"right"==b.minimizedItem.css("float")&&(f=!0);d.css("top",b.host.coord().top+b.host.height());d.css({left:f?b.host.coord().left+b.host.width()-e:b.host.coord().left})}},25)});this.addHandler(this.minimizedItem,
"click",function(b){g(b)})}},restore:function(){if(this.minimized){this.host.find("ul").removeClass(this.toThemeProperty("jqx-menu-ul-minimized"));this.host.removeClass(this.toThemeProperty("jqx-menu-minimized"));this.minimized=!1;this.mode=this._tmpMode;this.minimizedItem&&this.minimizedItem.remove();c("#menuWrapper"+this.element.id).remove();if(this.source){var b=this.loadItems(this.source);this._tmpHTML=this.element.innerHTML=b}this.element.innerHTML=this._tmpHTML;this.element.innerHTML.indexOf("UL")&&
(b=this.host.find("ul:first"),0<b.length&&this._createMenu(b[0]));this._setSize();this._render()}},isTouchDevice:function(){if(void 0!=this._isTouchDevice)return this._isTouchDevice;var b=c.jqx.mobile.isTouchDevice();1==this.touchMode?b=!0:0==this.touchMode&&(b=!1);b&&(this.host.addClass(this.toThemeProperty("jqx-touch")),c(".jqx-menu-item").addClass(this.toThemeProperty("jqx-touch")));return this._isTouchDevice=b},refresh:function(b){b||this._setSize()},resize:function(b,d){this.width=b;this.height=
d;this.refresh()},_closeAll:function(b){var d=null!=b?b.data:this;c.each(d.items,function(){1==this.hasItems&&this.isOpen&&d._closeItem(d,this)});"popup"==d.mode&&null!=b&&(d._isRightClick(b)||d.close())},closeItem:function(b){if(null==b)return!1;var d=document.getElementById(b),e=this;c.each(e.items,function(){1==this.isOpen&&this.element==d&&e._closeItem(e,this)});return!0},openItem:function(b){if(null==b)return!1;var d=document.getElementById(b),e=this;c.each(e.items,function(){0==this.isOpen&&
this.element==d&&(e._openItem(e,this),this.parentId&&e.openItem(this.parentId))});return!0},_getClosedSubMenuOffset:function(b){var d=c(b.subMenuElement),e=-d.outerHeight(),f=-d.outerWidth(),g=0==b.level&&"horizontal"==this.mode;g?f=0:e=0;switch(b.openVerticalDirection){case "up":case "center":e=d.outerHeight()}switch(b.openHorizontalDirection){case this._getDir("left"):f=g?0:d.outerWidth();break;case "center":f=g?0:d.outerWidth()}return{left:f,top:e}},_closeItem:function(b,d,e,f){if(null==b||null==
d)return!1;var g=c(d.subMenuElement),h=0==d.level&&"horizontal"==this.mode,l=this._getClosedSubMenuOffset(d),q=l.top,r=l.left;c(d.element);var t=g.closest("div.jqx-menu-popup");if(null!=t){l=b.animationHideDelay;1==f&&(l=0);g.data("timer")&&null!=g.data("timer").show&&(clearTimeout(g.data("timer").show),g.data("timer").show=null);var v=function(){d.isOpen=!1;h?g.stop().animate({top:q},b.animationHideDuration,function(){c(d.element).removeClass(b.toThemeProperty("jqx-fill-state-pressed"));c(d.element).removeClass(b.toThemeProperty("jqx-menu-item-top-selected"));
c(d.element).removeClass(b.toThemeProperty("jqx-rc-b-expanded"));t.removeClass(b.toThemeProperty("jqx-rc-t-expanded"));var e=c(d.arrow);0<e.length&&b.showTopLevelArrows&&(e.removeClass(),"down"==d.openVerticalDirection?(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-down")),e.addClass(b.toThemeProperty("jqx-icon-arrow-down"))):(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-up")),e.addClass(b.toThemeProperty("jqx-icon-arrow-up"))));c.jqx.aria(c(d.element),"aria-expanded",!1);t.css({display:"none"});
0==b.animationHideDuration&&g.css({top:q});b._raiseEvent("1",d)}):g.stop().animate({left:r},b.animationHideDuration,function(){0==b.animationHideDuration&&g.css({left:r});if(0<d.level){c(d.element).removeClass(b.toThemeProperty("jqx-fill-state-pressed"));c(d.element).removeClass(b.toThemeProperty("jqx-menu-item-selected"));var e=c(d.arrow);0<e.length&&(e.removeClass(),"left"!=d.openHorizontalDirection?(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-"+b._getDir("right"))),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+
b._getDir("right")))):(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-"+b._getDir("left"))),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+b._getDir("left")))))}else c(d.element).removeClass(b.toThemeProperty("jqx-fill-state-pressed")),c(d.element).removeClass(b.toThemeProperty("jqx-menu-item-top-selected")),e=c(d.arrow),0<e.length&&(e.removeClass(),"left"!=d.openHorizontalDirection?(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-top-"+b._getDir("right"))),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+
b._getDir("right")))):(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-top-"+b._getDir("left"))),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+b._getDir("left")))));c.jqx.aria(c(d.element),"aria-expanded",!1);t.css({display:"none"});b._raiseEvent("1",d)})};0<l?g.data("timer")&&(g.data("timer").hide=setTimeout(function(){v()},l)):v();void 0!=e&&e&&(e=g.children(),c.each(e,function(){b.menuElements[this.id]&&b.menuElements[this.id].isOpen&&(c(b.menuElements[this.id].subMenuElement),b._closeItem(b,
b.menuElements[this.id],!0,!0))}))}},getSubItems:function(b,d){if(null==b)return!1;var e=this,f=[];null!=d&&c.extend(f,d);var g=c(this.menuElements[b].subMenuElement).find(".jqx-menu-item");c.each(g,function(){f[this.id]=e.menuElements[this.id];var b=e.getSubItems(this.id,f);c.extend(f,b)});return f},disable:function(b,d){if(null!=b&&this.menuElements[b]){var e=this.menuElements[b];e.disabled=d;var f=c(e.element);e.element.disabled=d;c.each(f.children(),function(){this.disabled=d});d?(f.addClass(this.toThemeProperty("jqx-menu-item-disabled")),
f.addClass(this.toThemeProperty("jqx-fill-state-disabled"))):(f.removeClass(this.toThemeProperty("jqx-menu-item-disabled")),f.removeClass(this.toThemeProperty("jqx-fill-state-disabled")))}},getItem:function(b){return this.menuElements[b]?this.menuElements[b]:null},disableItem:function(b){this.disable(b,!0)},hideItem:function(b){this.menuElements[b]&&c(this.menuElements[b].element).hide()},showItem:function(b){this.menuElements[b]&&c(this.menuElements[b].element).show()},enableItem:function(b){this.disable(b,
!1)},_setItemProperty:function(b,d,e){null!=b&&this.menuElements[b]&&(b=this.menuElements[b],b[d]&&(b[d]=e))},setItemOpenDirection:function(b,d,e){if(null!=b){var f=c.jqx.browser.msie&&8>c.jqx.browser.version;if(this.menuElements[b]){b=this.menuElements[b];if(null!=d&&(b.openHorizontalDirection=d,b.hasItems&&0<b.level&&(d=c(b.element),void 0!=d))){var g=c(b.arrow);null==b.arrow&&(g=c('<span id="arrow'+d[0].id+'"></span>'),f?g.appendTo(d):g.prependTo(d),b.arrow=g[0]);g.removeClass();"left"==b.openHorizontalDirection?
(g.addClass(this.toThemeProperty("jqx-menu-item-arrow-"+this._getDir("left"))),g.addClass(this.toThemeProperty("jqx-icon-arrow-"+this._getDir("left")))):(g.addClass(this.toThemeProperty("jqx-menu-item-arrow-"+this._getDir("right"))),g.addClass(this.toThemeProperty("jqx-icon-arrow-"+this._getDir("right"))));g.css("visibility","inherit");f?(g.css("display","inline-block"),g.css("float","none")):(g.css("display","block"),g.css("float","right"))}null!=e&&(b.openVerticalDirection=e,g=c(b.arrow),d=c(b.element),
this.showTopLevelArrows&&void 0!=d&&(null==b.arrow&&(g=c('<span id="arrow'+d[0].id+'"></span>'),f?g.appendTo(d):g.prependTo(d),b.arrow=g[0]),g.removeClass(),"down"==b.openVerticalDirection?(g.addClass(this.toThemeProperty("jqx-menu-item-arrow-down")),g.addClass(this.toThemeProperty("jqx-icon-arrow-down"))):(g.addClass(this.toThemeProperty("jqx-menu-item-arrow-up")),g.addClass(this.toThemeProperty("jqx-icon-arrow-up"))),g.css("visibility","inherit"),f?(g.css("display","inline-block"),g.css("float",
"none")):(g.css("display","block"),g.css("float","right"))))}}},_getSiblings:function(b){for(var d=[],e=0,f=0;f<this.items.length;f++)this.items[f]!=b&&this.items[f].parentId==b.parentId&&this.items[f].hasItems&&(d[e++]=this.items[f]);return d},_openItem:function(b,d,e){if(null==b||null==d||d.isOpen||d.disabled||b.disabled)return!1;var f=b.popupZIndex;void 0!=e&&(f=e);e=b.animationHideDuration;b.animationHideDuration=0;b._closeItem(b,d,!0,!0);b.animationHideDuration=e;c(d.element).focus();e=[5,5];
var g=c(d.subMenuElement);null!=g&&g.stop();g.data("timer")&&null!=g.data("timer").hide&&clearTimeout(g.data("timer").hide);var h=g.closest("div.jqx-menu-popup"),l=c(d.element),q=0==d.level?this._getOffset(d.element):l.position();if(0<d.level&&this.hasTransform){var r=parseInt(l.coord().top)-parseInt(this._getOffset(d.element).top);q.top+=r}0==d.level&&"popup"==this.mode&&(q=l.coord());var t=0==d.level&&"horizontal"==this.mode,r=t?q.left:null!=this.menuElements[d.parentId]&&null!=this.menuElements[d.parentId].subMenuElement?
parseInt(c(c(this.menuElements[d.parentId].subMenuElement).closest("div.jqx-menu-popup")).outerWidth())-e[0]:parseInt(g.outerWidth());h.css({visibility:"visible",display:"block",left:r,top:t?q.top+l.outerHeight():q.top,zIndex:f});g.css("display","block");"horizontal"!=this.mode&&0==d.level?(r=this._getOffset(this.element),h.css("left",-1+r.left+this.host.outerWidth()),g.css("left",-g.outerWidth())):(r=this._getClosedSubMenuOffset(d),g.css("left",r.left),g.css("top",r.top));h.css({height:parseInt(g.outerHeight())+
parseInt(e[1])+"px"});var v=0,y=0;switch(d.openVerticalDirection){case "up":t?(g.css("top",g.outerHeight()),v=e[1],r=parseInt(g.parent().css("padding-bottom")),isNaN(r)&&(r=0),0<r&&h.addClass(this.toThemeProperty("jqx-menu-popup-clear")),g.css("top",g.outerHeight()-r),h.css({display:"block",top:q.top-h.outerHeight(),zIndex:f})):(v=e[1],g.css("top",g.outerHeight()),h.css({display:"block",top:q.top-h.outerHeight()+e[1]+l.outerHeight(),zIndex:f}));break;case "center":t?(g.css("top",0),h.css({display:"block",
top:q.top-h.outerHeight()/2+e[1],zIndex:f})):(g.css("top",0),h.css({display:"block",top:q.top+l.outerHeight()/2-h.outerHeight()/2+e[1],zIndex:f}))}switch(d.openHorizontalDirection){case this._getDir("left"):t?h.css({left:q.left-(h.outerWidth()-l.outerWidth()-e[0])}):(y=0,g.css("left",h.outerWidth()),h.css({left:q.left-h.outerWidth()+2*d.level}));break;case "center":t?h.css({left:q.left-(h.outerWidth()/2-l.outerWidth()/2-e[0]/2)}):(h.css({left:q.left-(h.outerWidth()/2-l.outerWidth()/2-e[0]/2)}),g.css("left",
h.outerWidth()))}if(t){if(parseInt(g.css("top"))==v){d.isOpen=!0;return}}else if(parseInt(g.css("left"))==y){1==d.isOpen;return}c.each(b._getSiblings(d),function(){b._closeItem(b,this,!0,!0)});f=c.data(b.element,"animationHideDelay");b.animationHideDelay=f;0<this.autoCloseInterval&&(null!=this.host.data("autoclose")&&null!=this.host.data("autoclose").close&&clearTimeout(this.host.data("autoclose").close),null!=this.host.data("autoclose")&&(this.host.data("autoclose").close=setTimeout(function(){b._closeAll()},
this.autoCloseInterval)));g.data("timer")&&(g.data("timer").show=setTimeout(function(){if(null!=h)if(t){g.stop();g.css("left",y);l.addClass(b.toThemeProperty("jqx-fill-state-pressed"));l.addClass(b.toThemeProperty("jqx-menu-item-top-selected"));"down"==d.openVerticalDirection?(c(d.element).addClass(b.toThemeProperty("jqx-rc-b-expanded")),h.addClass(b.toThemeProperty("jqx-rc-t-expanded"))):(c(d.element).addClass(b.toThemeProperty("jqx-rc-t-expanded")),h.addClass(b.toThemeProperty("jqx-rc-b-expanded")));
var e=c(d.arrow);0<e.length&&b.showTopLevelArrows&&(e.removeClass(),"down"==d.openVerticalDirection?(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-down-selected")),e.addClass(b.toThemeProperty("jqx-icon-arrow-down"))):(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-up-selected")),e.addClass(b.toThemeProperty("jqx-icon-arrow-up"))));0==b.animationShowDuration?(g.css({top:v}),d.isOpen=!0,b._raiseEvent("0",d),c.jqx.aria(c(d.element),"aria-expanded",!0)):g.animate({top:v},b.animationShowDuration,
b.easing,function(){d.isOpen=!0;c.jqx.aria(c(d.element),"aria-expanded",!0);b._raiseEvent("0",d)})}else g.stop(),g.css("top",v),0<d.level?(l.addClass(b.toThemeProperty("jqx-fill-state-pressed")),l.addClass(b.toThemeProperty("jqx-menu-item-selected"))):(l.addClass(b.toThemeProperty("jqx-fill-state-pressed")),l.addClass(b.toThemeProperty("jqx-menu-item-top-selected"))),e=c(d.arrow),0<e.length&&(e.removeClass(),"left"!=d.openHorizontalDirection?(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-"+b._getDir("right")+
"-selected")),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+b._getDir("right")))):(e.addClass(b.toThemeProperty("jqx-menu-item-arrow-"+b._getDir("left")+"-selected")),e.addClass(b.toThemeProperty("jqx-icon-arrow-"+b._getDir("left"))))),0==b.animationShowDuration?(g.css({left:y}),b._raiseEvent("0",d),d.isOpen=!0,c.jqx.aria(c(d.element),"aria-expanded",!0)):g.animate({left:y},b.animationShowDuration,b.easing,function(){b._raiseEvent("0",d);d.isOpen=!0;c.jqx.aria(c(d.element),"aria-expanded",!0)})},
this.animationShowDelay))},_getDir:function(b){switch(b){case "left":return this.rtl?"right":"left";case "right":return this.rtl?"left":"right"}return"left"},_applyOrientation:function(b,d){var e=this,f=0;e.host.removeClass(e.toThemeProperty("jqx-menu-horizontal"));e.host.removeClass(e.toThemeProperty("jqx-menu-vertical"));e.host.removeClass(e.toThemeProperty("jqx-menu"));e.host.removeClass(e.toThemeProperty("jqx-widget"));e.host.addClass(e.toThemeProperty("jqx-widget"));e.host.addClass(e.toThemeProperty("jqx-menu"));
if(void 0!=b&&void 0!=d&&"popup"==d){if(0<e.host.parent().length&&0<e.host.parent().parent().length&&e.host.parent().parent()[0]==document.body){var g=c.data(document.body,"jqxMenuOldHost"+e.element.id);if(null!=g){var h=e.host.closest("div.jqx-menu-wrapper");h.remove();h.appendTo(g);e.host.css("display","block");e.host.css("visibility","visible");h.css("display","block");h.css("visibility","visible")}}}else void 0==b&&void 0==d&&c.data(document.body,"jqxMenuOldHost"+e.element.id,e.host.parent()[0]);
e.autoOpenPopup?"popup"==e.mode?(e.addHandler(c(document),"contextmenu."+e.element.id,function(b){return!1}),e.addHandler(c(document),"mousedown.menu"+e.element.id,function(b){e._openContextMenu(b)})):(e.removeHandler(c(document),"contextmenu."+e.element.id),e.removeHandler(c(document),"mousedown.menu"+e.element.id)):(e.removeHandler(c(document),"contextmenu."+e.element.id),e.removeHandler(c(document),"mousedown.menu"+e.element.id),e.addHandler(c(document),"contextmenu."+e.element.id,function(b){if(b.target&&
b.target.className.indexOf&&0<=b.target.className.indexOf("jqx-menu"))return!1}));e.rtl&&e.host.addClass(e.toThemeProperty("jqx-rtl"));switch(e.mode){case "horizontal":e.host.addClass(e.toThemeProperty("jqx-widget-header"));e.host.addClass(e.toThemeProperty("jqx-menu-horizontal"));c.each(e.items,function(){$element=c(this.element);var b=c(this.arrow);b.removeClass();this.hasItems&&0<this.level&&(b=c('<span style="border: none; background-color: transparent;" id="arrow'+$element[0].id+'"></span>'),
b.prependTo($element),b.css("float",e._getDir("right")),b.addClass(e.toThemeProperty("jqx-menu-item-arrow-"+e._getDir("right"))),b.addClass(e.toThemeProperty("jqx-icon-arrow-"+e._getDir("right"))),this.arrow=b[0]);if(0==this.level){c(this.element).css("float",e._getDir("left"));if(!this.ignoretheme&&this.hasItems&&e.showTopLevelArrows){var b=c('<span style="border: none; background-color: transparent;" id="arrow'+$element[0].id+'"></span>'),d=c.jqx.browser.msie&&8>c.jqx.browser.version;null==this.arrow?
d?b.appendTo($element):b.prependTo($element):b=c(this.arrow);"down"==this.openVerticalDirection?(b.addClass(e.toThemeProperty("jqx-menu-item-arrow-down")),b.addClass(e.toThemeProperty("jqx-icon-arrow-down"))):(b.addClass(e.toThemeProperty("jqx-menu-item-arrow-up")),b.addClass(e.toThemeProperty("jqx-icon-arrow-up")));b.css("visibility","inherit");d?b.css("display","inline-block"):(b.css("display","block"),b.css("float","right"));this.arrow=b[0]}else this.ignoretheme||!this.hasItems||e.showTopLevelArrows||
null==this.arrow||(b=c(this.arrow),b.remove(),this.arrow=null);f=Math.max(f,$element.height())}});break;case "vertical":case "popup":case "simple":e.host.addClass(e.toThemeProperty("jqx-menu-vertical")),c.each(e.items,function(){$element=c(this.element);if(this.hasItems&&!this.ignoretheme){this.arrow&&c(this.arrow).remove();if("simple"==e.mode)return!0;var b=c('<span style="border: none; background-color: transparent;" id="arrow'+$element[0].id+'"></span>');b.prependTo($element);b.css("float","right");
0==this.level?b.addClass(e.toThemeProperty("jqx-menu-item-arrow-top-"+e._getDir("right"))):b.addClass(e.toThemeProperty("jqx-menu-item-arrow-"+e._getDir("right")));b.addClass(e.toThemeProperty("jqx-icon-arrow-"+e._getDir("right")));this.arrow=b[0]}$element.css("float","none")}),"popup"==e.mode?(e.host.addClass(e.toThemeProperty("jqx-widget-content")),e.host.wrap('<div tabindex=0 class="jqx-menu-wrapper" style="z-index:'+e.popupZIndex+'; border: none; background-color: transparent; padding: 0px; margin: 0px; position: absolute; top: 0; left: 0; display: block; visibility: visible;"></div>'),
h=e.host.closest("div.jqx-menu-wrapper"),e.host.addClass(e.toThemeProperty("jqx-popup")),h[0].id="menuWrapper"+e.element.id,h.appendTo(c(document.body)),e.addHandler(h,"keydown",function(b){return e.handleKeyDown(b)})):e.host.addClass(e.toThemeProperty("jqx-widget-header")),"popup"==e.mode&&(g=e.host.height(),e.host.css("position","absolute"),e.host.css("top","0"),e.host.css("left","0"),"simple"!=e.mode&&(e.host.height(g),e.host.css("display","none")))}g=e.isTouchDevice();e.autoCloseOnClick&&(e.removeHandler(c(document),
"mousedown.menu"+e.element.id,e._closeAfterClick),e.addHandler(c(document),"mousedown.menu"+e.element.id,e._closeAfterClick,e),g&&(e.removeHandler(c(document),c.jqx.mobile.getTouchEventName("touchstart")+".menu"+e.element.id,e._closeAfterClick,e),e.addHandler(c(document),c.jqx.mobile.getTouchEventName("touchstart")+".menu"+e.element.id,e._closeAfterClick,e)))},_getBodyOffset:function(){var b=0,d=0;"0px"!=c("body").css("border-top-width")&&(b=parseInt(c("body").css("border-top-width")),isNaN(b)&&(b=
0));"0px"!=c("body").css("border-left-width")&&(d=parseInt(c("body").css("border-left-width")),isNaN(d)&&(d=0));return{left:d,top:b}},_getOffset:function(b){var d=c.jqx.mobile.isSafariMobileBrowser(),e=c(b).coord(!0),f=e.top,e=e.left;"0px"!=c("body").css("border-top-width")&&(f=parseInt(f)+this._getBodyOffset().top);"0px"!=c("body").css("border-left-width")&&(e=parseInt(e)+this._getBodyOffset().left);var g=c.jqx.mobile.isWindowsPhone(),h=c.jqx.mobile.isTouchDevice();return this.hasTransform||null!=
d&&d||g||h?{left:c.jqx.mobile.getLeftPos(b),top:c.jqx.mobile.getTopPos(b)}:{left:e,top:f}},_isRightClick:function(b){var d;b||(b=window.event);b.which?d=3==b.which:b.button&&(d=2==b.button);return d},_openContextMenu:function(b){this._isRightClick(b)&&this.open(parseInt(b.clientX)+5,parseInt(b.clientY)+5)},close:function(){var b=this;c.data(this.element,"contextMenuOpened"+this.element.id)&&(c.each(b.items,function(){this.hasItems&&b._closeItem(b,this)}),c.each(b.items,function(){1==this.isOpen&&
($submenu=c(this.subMenuElement),$submenu.closest("div.jqx-menu-popup").hide(this.animationHideDuration))}),this.host.hide(this.animationHideDuration),c.data(b.element,"contextMenuOpened"+this.element.id,!1),b._raiseEvent("1",b),b._raiseEvent("5"))},open:function(b,d){if("popup"==this.mode){var e=0;"block"==this.host.css("display")&&(this.close(),e=this.animationHideDuration);var f=this;if(void 0==b||null==b)b=0;if(void 0==d||null==d)d=0;setTimeout(function(){f.host.show(f.animationShowDuration);
f.host.css("visibility","visible");c.data(f.element,"contextMenuOpened"+f.element.id,!0);f._raiseEvent("0",f);f._raiseEvent("4",{left:b,top:d});f.host.css("z-index",f.popupZIndex);void 0!=b&&void 0!=d&&f.host.css({left:b,top:d});f.focus()},e)}},_renderHover:function(b,d,e){var f=this;d.ignoretheme||(this.addHandler(b,"mouseenter",function(){f.hoveredItem=d;d.disabled||d.separator||!f.enableHover||f.disabled||(0<d.level?(b.addClass(f.toThemeProperty("jqx-fill-state-hover")),b.addClass(f.toThemeProperty("jqx-menu-item-hover"))):
(b.addClass(f.toThemeProperty("jqx-fill-state-hover")),b.addClass(f.toThemeProperty("jqx-menu-item-top-hover"))))}),this.addHandler(b,"mouseleave",function(){d.disabled||d.separator||!f.enableHover||f.disabled||(0<d.level?(b.removeClass(f.toThemeProperty("jqx-fill-state-hover")),b.removeClass(f.toThemeProperty("jqx-menu-item-hover"))):(b.removeClass(f.toThemeProperty("jqx-fill-state-hover")),b.removeClass(f.toThemeProperty("jqx-menu-item-top-hover"))))}))},_closeAfterClick:function(b){var d=null!=
b?b.data:this,e=!1;d.autoCloseOnClick&&(c.each(c(b.target).parents(),function(){if(this.className.indexOf&&-1!=this.className.indexOf("jqx-menu"))return e=!0,!1}),e||(b.data=d,d._closeAll(b)))},_autoSizeHorizontalMenuItems:function(){var b=this;if(b.autoSizeMainItems&&"horizontal"==this.mode){var d=this.maxHeight;parseInt(d)>parseInt(this.host.height())&&(d=parseInt(this.host.height()));d=parseInt(this.host.height());c.each(this.items,function(){$element=c(this.element);if(0==this.level&&0<d){var e=
0<$element.children().length?parseInt($element.children().height()):$element.height(),f=b.host.find("ul:first"),g=parseInt(f.css("padding-top")),f=parseInt(f.css("margin-top")),g=d-2*(f+g),f=parseInt(g)/2-e/2,e=parseInt(f),f=parseInt(f);$element.css("padding-top",e);$element.css("padding-bottom",f);parseInt($element.outerHeight())>g&&$element.css("padding-top",e-1)}})}c.each(this.items,function(){$element=c(this.element);if(this.hasItems&&0<this.level&&this.arrow){var b=c(this.arrow),d=c(this.element).height();
15<d&&b.css("margin-top",(d-15)/2)}})},_nextVisibleItem:function(b,d){if(null==b||void 0==b)return null;for(var e=b;null!=e;)if(e=e.nextItem,this._isVisible(e)&&!e.disabled&&"separator"!==e.type&&(this.minimized||void 0==d||!e||e.level==d))return e;return null},_prevVisibleItem:function(b,d){if(null==b||void 0==b)return null;for(var e=b;null!=e;)if(e=e.prevItem,this._isVisible(e)&&!e.disabled&&"separator"!==e.type&&(this.minimized||void 0==d||!e||e.level==d))return e;return null},_parentItem:function(b){if(null==
b||void 0==b)return null;var d=b.parentElement;if(!d)return null;var e=null;c.each(this.items,function(){if(this.element==d)return e=this,!1});return e},_isElementVisible:function(b){return null==b?!1:"none"!=c(b).css("display")&&"hidden"!=c(b).css("visibility")?!0:!1},_isVisible:function(b){if(null==b||void 0==b||!this._isElementVisible(b.element))return!1;b=this._parentItem(b);if(null==b||this.minimized)return!0;if(null!=b)if(this._isElementVisible(b.element)&&(b.isOpen||this.minimized))for(;null!=
b;){if(b=this._parentItem(b),null!=b&&!this._isElementVisible(b.element)||null!=b&&!b.isOpen)return!1}else return!1;return!0},_render:function(b,d){this.disabled&&(this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled")),this.host.addClass(this.toThemeProperty("jqx-menu-disabled")));void 0==this.host.attr("tabindex")&&this.host.attr("tabindex",0);var e=this.popupZIndex,f=[5,5],g=this;c.data(g.element,"animationHideDelay",g.animationHideDelay);var h=this.isTouchDevice(),l=h&&(c.jqx.mobile.isWindowsPhone()||
0<=navigator.userAgent.indexOf("Touch"));-1!=navigator.platform.toLowerCase().indexOf("win")&&(0<=navigator.userAgent.indexOf("Windows Phone")||0<=navigator.userAgent.indexOf("WPDesktop")||0<=navigator.userAgent.indexOf("IEMobile")||0<=navigator.userAgent.indexOf("ZuneWP7")?this.touchDevice=!0:0<=navigator.userAgent.indexOf("Touch")&&("MSPointerDown"in window||c.jqx.mobile.isWindowsPhone()||0<=navigator.userAgent.indexOf("ARM"))&&(l=!0,g.clickToOpen=!0,g.autoCloseOnClick=!1,g.enableHover=!1));c.data(document.body,
"menuel",this);this.hasTransform=c.jqx.utilities.hasTransform(this.host);this._applyOrientation(b,d);this.removeHandler(this.host,"blur");this.removeHandler(this.host,"focus");this.addHandler(this.host,"blur",function(b){!g.keyboardNavigation||!g.activeItem||"popup"===g.mode&&document.activeElement&&0<=document.activeElement.className.indexOf("jqx-menu-wrapper")||(c(g.activeItem.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=null)});this.addHandler(this.host,"focus",
function(b){g.keyboardNavigation&&!g.activeItem&&(g.hoveredItem?(c(g.hoveredItem.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=g.hoveredItem):(b=function(){if(c.jqx.isHidden(c(g.items[0].element))){var b=g._nextVisibleItem(g.items[0],0);b&&(c(b.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=b)}else c(g.items[0].element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=g.items[0]},g.activeItem?c.jqx.isHidden(c(g.activeItem.element))?
(c(g.activeItem.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),b()):c(g.activeItem.element).addClass(g.toThemeProperty("jqx-fill-state-focus")):b()))});this.removeHandler(this.host,"keydown.menu"+this.element.id);g.handleKeyDown=function(b){if(g.keyboardNavigation){if("input"===b.target.nodeName.toLowerCase())return!0;var e=null,d=null;c.each(g.items,function(){if(this.disabled)return!0;0<=this.element.className.indexOf("pressed")&&(d=this);if(0<=this.element.className.indexOf("focus"))return e=
this,!1});if(!e&&d)return e=d,!1;if(!e)return c(g.items[0].element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=g.items[0],e=g.activeItem,!1;if(27==b.keyCode&&(b.data=g,g._closeAll(b),e))for(var f=e;null!=f;)f.parentItem||(c(g.activeItem.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=f,c(g.activeItem.element).addClass(g.toThemeProperty("jqx-fill-state-focus"))),f=f.parentItem;if(13==b.keyCode&&e){g._raiseEvent("2",{item:e.element,event:b,type:"keyboard"});
var h=null!=e.anchor?c(e.anchor):null;null!=h&&0<h.length&&(f=h.attr("href"),h=h.attr("target"),null!=f&&(null!=h?window.open(f,h):window.location=f));b.preventDefault();b.stopPropagation();c(e.element).focus()}var h=function(b){if(null==b)return[];for(var e=[],d=0,f=0;f<g.items.length;f++)g.items[f].parentId==b.parentId&&(e[d++]=g.items[f]);return e},l="";switch(b.keyCode){case 40:l="down";break;case 38:l="up";break;case 39:l="right";break;case 37:l="left"}e&&"left"===e.openHorizontalDirection&&
"left"===l&&(l="right");e&&"left"===e.openHorizontalDirection&&"right"===l&&(l="left");e&&"top"===e.openVerticalDirection&&"top"===l&&(l="bottom");e&&"top"===e.openVerticalDirection&&"bottom"===l&&(l="top");g.rtl&&("right"===l?l="left":"left"===l&&(l="right"));if("right"===l&&!g.minimized){if(b.altKey&&(0!=e.level&&e.hasItems||"horizontal"!=g.mode))g._openItem(g,e);else{var w=g._nextVisibleItem(e,0),z=g._nextVisibleItem(e),f=h(z);w||(w=z);w&&(w.parentId===e.parentId&&0==w.level&&"horizontal"==g.mode||
z.id==f[0].id&&0!=z.level)&&(z.id==f[0].id&&(0!=e.level||0==e.level&&"horizontal"!=g.mode)&&(w=z),c(w.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=w)}b.preventDefault();b.stopPropagation()}"left"!==l||g.minimized||(b.altKey&&(0!=e.level&&"horizontal"!==g.mode||1<e.level&&"horizontal"===g.mode||1==e.level&&e.hasItems&&"horizontal"===g.mode)?e.hasItems?g._closeItem(g,e):e.parentItem&&(g._closeItem(g,e.parentItem),
c(e.parentItem.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=e.parentItem):(w=g._prevVisibleItem(e,0),f=e.parentItem,w&&w.parentId===e.parentId&&0==w.level&&"horizontal"==g.mode?(c(w.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=w):f&&0==f.level&&"horizontal"==g.mode||!f||f.level!=e.level-1||(c(f.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),
c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=f)),b.preventDefault(),b.stopPropagation());if("down"===l)b.altKey?(0==e.level&&e.hasItems&&g._openItem(g,e),g.minimized&&g.minimizedHidden&&g.minimizedItem.trigger("click")):(w=g._nextVisibleItem(e,e.level),f=h(w),g.minimized&&w?(c(w.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=w):(!w||w.parentId!==e.parentId&&(w.id!=f[0].id||
"horizontal"!=g.mode)||0==w.level&&"horizontal"==g.mode||(c(w.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=w),"horizontal"===g.mode&&0===e.level&&e.isOpen&&e.hasItems&&(w=g._nextVisibleItem(e),c(w.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=w))),b.preventDefault(),b.stopPropagation();else if("up"===l){if(b.altKey)e.parentItem&&
0==e.parentItem.level?(g._closeItem(g,e.parentItem),c(e.parentItem.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=e.parentItem):null===e.parentItem&&0===e.level&&"horizontal"===g.mode&&g._closeItem(g,e),g.minimized&&(g.minimizedHidden||g.minimizedItem.trigger("click"));else if(w=g._prevVisibleItem(e,e.level),f=h(e),g.minimized&&w)c(w.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),
g.activeItem=w;else if(w&&(w.parentId===e.parentId||w.id==e.parentId&&0==w.level&&"horizontal"==g.mode)){if(0!=w.level||"horizontal"!==g.mode||0!==e.level)c(w.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=w}else e&&e.id==f[0].id&&e.parentItem&&0===e.parentItem.level&&"horizontal"===g.mode&&(w=e.parentItem,c(w.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),
g.activeItem=w);b.preventDefault();b.stopPropagation()}if(9==b.keyCode)if(w=b.shiftKey?g._prevVisibleItem(e):g._nextVisibleItem(e))c(w.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=w,b.preventDefault(),b.stopPropagation();else if(g.lockFocus){f=[];for(l=h=0;l<g.items.length;l++)g.items[l]!=e&&g.items[l].parentId==e.parentId&&(f[h++]=g.items[l]);0<f.length&&(b.shiftKey?(c(f[f.length-1].element).addClass(g.toThemeProperty("jqx-fill-state-focus")),
g.activeItem=f[f.length-1]):(c(f[0].element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=f[0]),c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")));b.preventDefault();b.stopPropagation()}else e&&(c(e.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=null)}else return!0};this.addHandler(this.host,"keydown.menu"+this.element.id,function(b){g.handleKeyDown(b)});g.enableRoundedCorners&&this.host.addClass(g.toThemeProperty("jqx-rc-all"));
c.each(this.items,function(){var b=this,d=c(b.element);d.attr("role","menuitem");g.enableRoundedCorners&&d.addClass(g.toThemeProperty("jqx-rc-all"));g.removeHandler(d,"click");g.addHandler(d,"click",function(e){if(!b.disabled&&!g.disabled&&(g.keyboardNavigation&&(g.activeItem&&c(g.activeItem.element).removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.activeItem=b,c(b.element).addClass(g.toThemeProperty("jqx-fill-state-focus")),g.minimized&&e.stopPropagation()),g._raiseEvent("2",{type:"mouse",
item:b.element,event:e}),g.autoOpen?g.autoCloseOnClick&&!h&&!g.clickToOpen&&b.closeOnClick&&(e.data=g,g._closeAll(e)):0<b.level&&g.autoCloseOnClick&&!h&&!g.clickToOpen&&(e.data=g,g._closeAll(e)),h&&g.autoCloseOnClick&&(e.data=g,b.hasItems||g._closeAll(e)),"A"!=e.target.tagName&&"a"!=e.target.tagName)){var d=null!=b.anchor?c(b.anchor):null;null!=d&&0<d.length&&(e=d.attr("href"),d=d.attr("target"),null!=e&&(null!=d?window.open(e,d):window.location=e))}});g.removeHandler(d,"mouseenter");g.removeHandler(d,
"mouseleave");l||"simple"==g.mode||g._renderHover(d,b,h);if(null!=b.subMenuElement){var t=c(b.subMenuElement);if("simple"==g.mode)return t.show(),!0;t.wrap('<div class="jqx-menu-popup '+g.toThemeProperty("jqx-menu-popup")+'" style="border: none; background-color: transparent; z-index:'+e+'; padding: 0px; margin: 0px; position: absolute; top: 0; left: 0; display: block; visibility: hidden;"><div style="background-color: transparent; border: none; position:absolute; overflow:hidden; left: 0; top: 0; right: 0; width: 100%; height: 100%;"></div></div>');
t.css({overflow:"hidden",position:"absolute",left:0,display:"inherit",top:-t.outerHeight()});t.data("timer",{});0<b.level?t.css("left",-t.outerWidth()):"horizontal"==g.mode&&t.css("left",0);e++;var v=c(b.subMenuElement).closest("div.jqx-menu-popup").css({width:parseInt(c(b.subMenuElement).outerWidth())+parseInt(f[0])+"px",height:parseInt(c(b.subMenuElement).outerHeight())+parseInt(f[1])+"px"}),y=d.closest("div.jqx-menu-popup");if(0<y.length){var A=t.css("margin-left"),w=t.css("margin-right"),z=t.css("padding-left"),
C=t.css("padding-right");v.appendTo(y)}else A=t.css("margin-left"),w=t.css("margin-right"),z=t.css("padding-left"),C=t.css("padding-right"),v.appendTo(c(document.body));t.css("margin-left",A);t.css("margin-right",w);t.css("padding-left",z);t.css("padding-right",C);if(g.clickToOpen)g.removeHandler(d,"mousedown"),g.addHandler(d,"mousedown",function(e){clearTimeout(t.data("timer").hide);null!=t&&t.stop();0!=b.level||b.isOpen||(e.data=g,g._closeAll(e));b.isOpen?g._closeItem(g,b,!0):g._openItem(g,b)});
else{if(h||l)g.removeHandler(d,c.jqx.mobile.getTouchEventName("touchstart")),g.addHandler(d,c.jqx.mobile.getTouchEventName("touchstart"),function(e){clearTimeout(t.data("timer").hide);null!=t&&t.stop();0!=b.level||b.isOpen||"popup"==g.mode||(e.data=g,g._closeAll(e));b.isOpen?g._closeItem(g,b,!0):g._openItem(g,b);return!1});l||(g.addHandler(d,"mouseenter",function(){(g.autoOpen||0<b.level&&!g.autoOpen)&&clearTimeout(t.data("timer").hide);if(!b.parentId||0==b.parentId||!g.menuElements[b.parentId]||
g.menuElements[b.parentId].isOpen)return(g.autoOpen||0<b.level&&!g.autoOpen)&&g._openItem(g,b),!1}),g.addHandler(d,"mousedown",function(){g.autoOpen||0!=b.level||(clearTimeout(t.data("timer").hide),null!=t&&t.stop(),b.isOpen?g._closeItem(g,b,!0):g._openItem(g,b))}),g.addHandler(d,"mouseleave",function(e){if(g.autoCloseOnMouseLeave){clearTimeout(t.data("timer").hide);var d=c(b.subMenuElement),f=parseInt(e.pageX);e=parseInt(e.pageY);var h=parseInt(d.coord().left),l=parseInt(d.coord().top),w=parseInt(d.outerWidth()),
d=parseInt(d.outerHeight()),z=!0;h-5<=f&&f<=h+w+5&&l<=e&&e<=l+d&&(z=!1);z&&g._closeItem(g,b,!0)}}),g.removeHandler(v,"mouseenter"),g.addHandler(v,"mouseenter",function(){clearTimeout(t.data("timer").hide)}),g.removeHandler(v,"mouseleave"),g.addHandler(v,"mouseleave",function(e){g.autoCloseOnMouseLeave&&(clearTimeout(t.data("timer").hide),clearTimeout(t.data("timer").show),null!=t&&t.stop(),g._closeItem(g,b,!0))}))}}});"simple"==this.mode&&this._renderSimpleMode();this._autoSizeHorizontalMenuItems();
this._raiseEvent("3",this)},_renderSimpleMode:function(){this.host.show()},createID:function(){for(var b=Math.random()+"",b=b.replace(".",""),b=("99"+b)/1;this.items[b];)b=Math.random()+"",b=b.replace(".",""),b/=1;return"menuItem"+b},_createMenu:function(b,d){if(null!=b){void 0==d&&(d=!0);null==d&&(d=!0);c(b).addClass("jqx-menu-ul");var e=c(b).find("li"),f=0;this.itemMapping=[];for(var g=0;g<e.length;g++){var h=e[g],l=c(h);if(-1!=h.className.indexOf("jqx-menu")||0!=this.autoGenerate){var q=h.id;q||
(q=this.createID());d&&(h.id=q,this.items[f]=new c.jqx._jqxMenu.jqxMenuItem,this.menuElements[q]=this.items[f]);var f=f+1,r=0,t=this;l.children().each(function(){d||(this.className="",t.autoGenerate&&(c(t.items[f-1].subMenuElement)[0].className="",t.minimized||c(t.items[f-1].subMenuElement).addClass(t.toThemeProperty("jqx-widget-content")),c(t.items[f-1].subMenuElement).addClass(t.toThemeProperty("jqx-menu-dropdown")),c(t.items[f-1].subMenuElement).addClass(t.toThemeProperty("jqx-popup"))));if(-1!=
this.className.indexOf("jqx-menu-dropdown"))return d&&(t.items[f-1].subMenuElement=this),!1;if(t.autoGenerate&&("ul"==this.tagName||"UL"==this.tagName))return d&&(t.items[f-1].subMenuElement=this),this.className="",t.minimized||c(this).addClass(t.toThemeProperty("jqx-widget-content")),c(this).addClass(t.toThemeProperty("jqx-menu-dropdown")),c(this).addClass(t.toThemeProperty("jqx-popup")),c(this).attr("role","menu"),t.rtl?c(this).addClass(t.toThemeProperty("jqx-rc-l")):c(this).addClass(t.toThemeProperty("jqx-rc-r")),
c(this).addClass(t.toThemeProperty("jqx-rc-b")),!1});l.parents().each(function(){if(-1!=this.className.indexOf("jqx-menu-item")||t.autoGenerate&&("li"==this.tagName||"LI"==this.tagName))return r=this.id,!1});var v=!1,y=h.getAttribute("type"),A=h.getAttribute("ignoretheme")||h.getAttribute("data-ignoretheme");if(A){if("true"==A||1==A)A=!0}else A=!1;y?"separator"==y&&(v=!0):y=h.type;v||(y=r?"sub":"top");var w=this.items[f-1];d&&(w.id=q,w.parentId=r,w.type=y,w.separator=v,w.element=e[g],q=l.children("a"),
w.disabled="true"==h.getAttribute("item-disabled")?!0:!1,w.level=l.parents("li").length,w.anchor=0<q.length?q:null,w.anchor&&c(w.anchor).attr("tabindex",-1));w.ignoretheme=A;h=this.menuElements[r];null!=h&&(h.ignoretheme&&(A=w.ignoretheme=h.ignoretheme),w.parentItem=h,w.parentElement=h.element);this.autoGenerate&&("separator"==y?(l.removeClass(),l.addClass(this.toThemeProperty("jqx-menu-item-separator")),l.attr("role","separator")):A||(0<=l[0].className.indexOf("jqx-grid-menu-item-touch")?l[0].className=
this.toThemeProperty("jqx-grid-menu-item-touch"):l[0].className="",this.rtl&&l.addClass(this.toThemeProperty("jqx-rtl")),0<w.level&&!t.minimized?(l.addClass(this.toThemeProperty("jqx-item")),l.addClass(this.toThemeProperty("jqx-menu-item"))):(l.addClass(this.toThemeProperty("jqx-item")),l.addClass(this.toThemeProperty("jqx-menu-item-top")))));w.disabled&&(l.addClass(t.toThemeProperty("jqx-menu-item-disabled")),l.addClass(t.toThemeProperty("jqx-fill-state-disabled")));this.itemMapping[g]={element:e[g],
item:w};this.itemMapping["id"+e[g].id]=this.itemMapping[g];d&&!A&&(w.hasItems=0<l.find("li").length,w.hasItems&&w.element&&(c.jqx.aria(c(w.element),"aria-haspopup",!0),w.subMenuElement.id||(w.subMenuElement.id=c.jqx.utilities.createId()),c.jqx.aria(c(w.element),"aria-owns",w.subMenuElement.id)))}}for(g=0;g<e.length;g++)if(w=e[g],this.itemMapping["id"+w.id]&&(w=this.itemMapping["id"+w.id].item))w.prevItem=null,w.nextItem=null,0<g&&this.itemMapping["id"+e[g-1].id]&&(w.prevItem=this.itemMapping["id"+
e[g-1].id].item),g<e.length-1&&this.itemMapping["id"+e[g+1].id]&&(w.nextItem=this.itemMapping["id"+e[g+1].id].item)}},destroy:function(){var b=this;c.jqx.utilities.resize(b.host,null,!0);var d=b.host.closest("div.jqx-menu-wrapper");b.removeHandler(d,"keydown");d.remove();b.removeHandler(c("#menuWrapper"+b.element.id),"keydown");c("#menuWrapper"+b.element.id).remove();b.removeHandler(b.host,"keydown");b.removeHandler(b.host,"focus");b.removeHandler(b.host,"blur");b.removeHandler(c(document),"mousedown.menu"+
b.element.id,b._closeAfterClick);b.removeHandler(c(document),"mouseup.menu"+b.element.id,b._closeAfterClick);b.removeHandler(c(document),"contextmenu."+b.element.id);b.removeHandler(b.host,"contextmenu."+b.element.id);c.data(document.body,"jqxMenuOldHost"+b.element.id,null);b.isTouchDevice()&&b.removeHandler(c(document),c.jqx.mobile.getTouchEventName("touchstart")+".menu"+b.element.id,b._closeAfterClick,this);c(window).off&&c(window).off("resize.menu"+b.element.id);c.each(b.items,function(){var e=
c(this.element);b.removeHandler(e,"click");b.removeHandler(e,"selectstart");b.removeHandler(e,"mouseenter");b.removeHandler(e,"mouseleave");b.removeHandler(e,"mousedown");b.removeHandler(e,"mouseleave");c(this.subMenuElement).closest("div.jqx-menu-popup").remove();delete this.subMenuElement;delete this.element});c.data(document.body,"menuel",null);delete b.menuElements;b.items=[];delete b.items;(d=c.data(b.element,"jqxMenu"))&&delete d.instance;b.host.removeClass();b.host.remove();delete b.host;delete b.element},
_raiseEvent:function(b,d){void 0==d&&(d={owner:null});var e=this.events[b];args=d;args.owner=this;e=new c.Event(e);"2"==b&&(args=d.item,args.owner=this,args.clickType=d.type,c.extend(e,d.event),e.type="itemclick");e.owner=this;e.args=args;return this.host.trigger(e)},propertiesChangedHandler:function(b,d,e){e.width&&e.height&&2==Object.keys(e).length&&(b._setSize(),"popup"===b.mode&&(this.host.closest("div.jqx-menu-wrapper")[d](e),c("#"+this.host[0].id)[d](e)))},propertyChangedHandler:function(b,
d,e,f){if(void 0!=this.isInitialized&&0!=this.isInitialized&&!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length)&&("disabled"==d&&(b.disabled?(b.host.addClass(b.toThemeProperty("jqx-fill-state-disabled")),b.host.addClass(b.toThemeProperty("jqx-menu-disabled"))):(b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")),b.host.removeClass(b.toThemeProperty("jqx-menu-disabled")))),f!=e))if("touchMode"==d&&(this._isTouchDevice=null,b._render(f,e)),
"width"===d||"height"===d)b._setSize(),"popup"===b.mode&&(this.host.closest("div.jqx-menu-wrapper")[d](f),c("#"+this.host[0].id)[d](f));else{if("source"==d&&null!=b.source){var g=b.loadItems(b.source);b.element.innerHTML=g;g=b.host.find("ul:first");0<g.length&&(b.refresh(),b._createMenu(g[0]),b._render())}"autoCloseOnClick"==d?0==f?b.removeHandler(c(document),"mousedown.menu"+this.element.id,b._closeAll):b.addHandler(c(document),"mousedown.menu"+this.element.id,b,b._closeAll):"mode"==d||"width"==
d||"height"==d||"showTopLevelArrows"==d?(b.refresh(),"mode"==d?b._render(f,e):b._applyOrientation()):"theme"==d&&c.jqx.utilities.setTheme(e,f,b.host)}}})})(jqxBaseFramework);(function(c){c.jqx._jqxMenu.jqxMenuItem=function(b,d,e){return{id:b,parentId:d,parentItem:null,anchor:null,type:e,disabled:!1,level:0,isOpen:!1,hasItems:!1,element:null,subMenuElement:null,arrow:null,openHorizontalDirection:"right",openVerticalDirection:"down",closeOnClick:!0}}})(jqxBaseFramework);
(function(c){function b(b,d){this.owner=b;this.displayfield=this.datafield=null;this.text="";this.createfilterpanel=null;this.editable=this.hideable=this.sortable=!0;this.adaptivehidden=this.hidden=!1;this.groupable=!0;this.checkchange=this.cellsrenderer=this.renderer=null;this.threestatecheckbox=!1;this.columntype=this.buttonclick=null;this.cellsformat="";this.cellsalign=this.align="left";this.width="auto";this.minwidth=25;this.maxwidth="auto";this.pinned=!1;this.visibleindex=-1;this.filterable=
!0;this.filter=null;this.filteritems=[];this.resizable=!0;this.validation=this.geteditorvalue=this.destroyeditor=this.destroywidget=this.initwidget=this.createwidget=this.createeditor=this.initeditor=null;this.cellclassname=this.classname="";this.aggregatesrenderer=this.aggregates=this.cellvaluechanging=this.cellbeginedit=this.cellendedit=null;this.menu=!0;this.createfilterwidget=null;this.filtertype="default";this.rendered=this.filtercondition=null;this.exportable=!0;this.exporting=!1;this.clipboard=
this.nullable=this.draggable=!0;this.selectable=!1;this._applyStyle=function(){this.hovered?(this.style.headerBackgroundHoveredColor&&(this.element.style.backgroundColor=this.style.headerBackgroundHoveredColor),this.style.headerHoveredColor&&(this.element.style.color=this.style.headerHoveredColor)):this.selected?(this.style.headerBackgroundSelectedColor&&(this.element.style.backgroundColor=this.style.headerBackgroundSelectedColor),this.style.headerSelectedColor&&(this.element.style.color=this.style.headerSelectedColor)):
(this.element.style.backgroundColor=this.style.headerBackgroundColor?this.style.headerBackgroundColor:"",this.element.style.color=this.style.headerColor?this.style.headerColor:"")};this._applyCellStyle=function(b){var e=!1;if(b.length)for(e=0;e<b.length;e++)this._applyCellStyle(b[e]);else{if(this.style.backgroundColor||this.style.color||this.style.hoveredColor||this.style.hoveredColor||this.style.backgroundSelectedColor||this.style.selectedColor)e=!0;e&&(0<=b.className.indexOf("hover")?(this.style.backgroundHoveredColor&&
(b.style.backgroundColor=this.style.backgroundHoveredColor),this.style.hoveredColor&&(b.style.color=this.style.hoveredColor)):0<=b.className.indexOf("selected")?(this.style.backgroundSelectedColor&&(b.style.backgroundColor=this.style.backgroundSelectedColor),this.style.selectedColor&&(b.style.color=this.style.selectedColor)):(this.style.backgroundColor&&(b.style.backgroundColor=this.style.backgroundColor),this.style.color&&(b.style.color=this.style.color)))}};this.style={headerBackgroundColor:"",
headerColor:"",headerBackgroundHoveredColor:"",headerHoveredColor:"",headerBackgroundSelectedColor:"",headerSelectedColor:"",backgroundColor:"",color:"",backgroundHoveredColor:"",hoveredColor:"",backgroundSelectedColor:"",selectedColor:""};this.enabletooltips=!0;this.columngroup=null;this.filterdelay=800;this.destroyeverpresentrowwidget=this.validateeverpresentrowwidgetvalue=this.initeverpresentrowwidget=this.createeverpresentrowwidget=this.geteverpresentrowwidgetvalue=this.reseteverpresentrowwidgetvalue=
null;this.getcolumnproperties=function(){return{nullable:this.nullable,sortable:this.sortable,hideable:this.hideable,hidden:this.hidden,groupable:this.groupable,width:this.width,align:this.align,editable:this.editable,minwidth:this.minwidth,maxwidth:this.maxwidth,resizable:this.resizable,datafield:this.datafield,text:this.text,exportable:this.exportable,cellsalign:this.cellsalign,pinned:this.pinned,cellsformat:this.cellsformat,columntype:this.columntype,classname:this.classname,cellclassname:this.cellclassname,
menu:this.menu}};this.setproperty=function(b,e){if(this[b]){var d=this[b];this[b]=e;this.owner._columnPropertyChanged(this,b,e,d)}else this[b.toLowerCase()]&&(d=this[b.toLowerCase()],this[b.toLowerCase()]=e,this.owner._columnPropertyChanged(this,b.toLowerCase(),e,d))};this._initfields=function(d){if(null!=d){var f=this.that;c.jqx.hasProperty(d,"dataField")&&(this.datafield=c.jqx.get(d,"dataField"));c.jqx.hasProperty(d,"selectable")&&(this.selectable=c.jqx.get(d,"selectable"));c.jqx.hasProperty(d,
"displayField")?this.displayfield=c.jqx.get(d,"displayField"):this.displayfield=this.datafield;c.jqx.hasProperty(d,"enableTooltips")&&(this.enabletooltips=c.jqx.get(d,"enableTooltips"));c.jqx.hasProperty(d,"text")?this.text=c.jqx.get(d,"text"):this.text=this.displayfield;c.jqx.hasProperty(d,"style")&&(this.style=c.jqx.get(d,"style"));c.jqx.hasProperty(d,"createfilterpanel")&&(this.createfilterpanel=c.jqx.get(d,"createfilterpanel"));c.jqx.hasProperty(d,"sortable")&&(this.sortable=c.jqx.get(d,"sortable"));
c.jqx.hasProperty(d,"hideable")&&(this.hideable=c.jqx.get(d,"hideable"));c.jqx.hasProperty(d,"hidden")&&(this.hidden=c.jqx.get(d,"hidden"));c.jqx.hasProperty(d,"adaptivehidden")&&(this.adaptivehidden=c.jqx.get(d,"adaptivehidden"));c.jqx.hasProperty(d,"groupable")&&(this.groupable=c.jqx.get(d,"groupable"));c.jqx.hasProperty(d,"renderer")&&(this.renderer=c.jqx.get(d,"renderer"));c.jqx.hasProperty(d,"align")&&(this.align=c.jqx.get(d,"align"));c.jqx.hasProperty(d,"cellsAlign")&&(this.cellsalign=c.jqx.get(d,
"cellsAlign"));c.jqx.hasProperty(d,"clipboard")&&(this.clipboard=c.jqx.get(d,"clipboard"));c.jqx.hasProperty(d,"cellsFormat")&&(this.cellsformat=c.jqx.get(d,"cellsFormat"));c.jqx.hasProperty(d,"width")&&(this.width=c.jqx.get(d,"width"));c.jqx.hasProperty(d,"minWidth")&&(this.minwidth=parseInt(c.jqx.get(d,"minWidth")),isNaN(this.minwidth)&&(this.minwidth=25));c.jqx.hasProperty(d,"maxWidth")&&(this.maxwidth=parseInt(c.jqx.get(d,"maxWidth")),isNaN(this.maxwidth)&&(this.maxwidth="auto"));c.jqx.hasProperty(d,
"cellsRenderer")?this.cellsrenderer=c.jqx.get(d,"cellsRenderer"):d.cellsRenderer&&(this.cellsrenderer=d.cellsRenderer);c.jqx.hasProperty(d,"columnType")&&(this.columntype=c.jqx.get(d,"columnType"));c.jqx.hasProperty(d,"checkChange")&&(this.checkchange=c.jqx.get(d,"checkChange"));c.jqx.hasProperty(d,"buttonClick")?this.buttonclick=c.jqx.get(d,"buttonClick"):d.buttonClick&&(this.buttonclick=d.buttonClick);c.jqx.hasProperty(d,"pinned")&&(this.pinned=c.jqx.get(d,"pinned"));c.jqx.hasProperty(d,"visibleIndex")&&
(this.visibleindex=c.jqx.get(d,"visibleIndex"));c.jqx.hasProperty(d,"filterable")&&(this.filterable=c.jqx.get(d,"filterable"));c.jqx.hasProperty(d,"filter")&&(this.filter=c.jqx.get(d,"filter"));c.jqx.hasProperty(d,"resizable")&&(this.resizable=c.jqx.get(d,"resizable"));c.jqx.hasProperty(d,"editable")&&(this.editable=c.jqx.get(d,"editable"));c.jqx.hasProperty(d,"initEditor")?this.initeditor=c.jqx.get(d,"initEditor"):d.initEditor&&(this.initeditor=d.initEditor);c.jqx.hasProperty(d,"createEditor")?this.createeditor=
c.jqx.get(d,"createEditor"):d.createEditor&&(this.createeditor=d.createEditor);c.jqx.hasProperty(d,"initWidget")?this.initwidget=c.jqx.get(d,"initWidget"):d.initWidget&&(this.initwidget=d.initWidget);c.jqx.hasProperty(d,"createWidget")?this.createwidget=c.jqx.get(d,"createWidget"):d.createWidget&&(this.createwidget=d.createWidget);c.jqx.hasProperty(d,"destroyWidget")?this.destroywidget=c.jqx.get(d,"destroyWidget"):d.destroyWidget&&(this.destroywidget=d.destroyWidget);c.jqx.hasProperty(d,"reseteverpresentrowwidgetvalue")||
c.jqx.hasFunction(d,"reseteverpresentrowwidgetvalue")?this.reseteverpresentrowwidgetvalue=c.jqx.get(d,"reseteverpresentrowwidgetvalue"):d.resetEverPresentRowWidgetValue&&(this.reseteverpresentrowwidgetvalue=d.resetEverPresentRowWidgetValue);c.jqx.hasProperty(d,"geteverpresentrowwidgetvalue")||c.jqx.hasFunction(d,"geteverpresentrowwidgetvalue")?this.geteverpresentrowwidgetvalue=c.jqx.get(d,"geteverpresentrowwidgetvalue"):d.getEverPresentRowWidgetValue&&(this.geteverpresentrowwidgetvalue=d.getEverPresentRowWidgetValue);
c.jqx.hasProperty(d,"createeverpresentrowwidget")||c.jqx.hasFunction(d,"createeverpresentrowwidget")?this.createeverpresentrowwidget=c.jqx.get(d,"createeverpresentrowwidget"):d.createEverPresentRowWidget&&(this.createeverpresentrowwidget=d.createEverPresentRowWidget);c.jqx.hasProperty(d,"initeverpresentrowwidget")||c.jqx.hasFunction(d,"initeverpresentrowwidget")?this.initeverpresentrowwidget=c.jqx.get(d,"initeverpresentrowwidget"):d.initEverPresentRowWidget&&(this.initeverpresentrowwidget=d.initEverPresentRowWidget);
c.jqx.hasProperty(d,"validateeverpresentrowwidgetvalue")?this.validateeverpresentrowwidgetvalue=c.jqx.get(d,"validateeverpresentrowwidgetvalue"):d.validateEverPresentRowWidgetValue&&(this.validateeverpresentrowwidgetvalue=d.validateEverPresentRowWidgetValue);c.jqx.hasProperty(d,"destroyeverpresentrowwidget")||c.jqx.hasFunction(d,"destroyeverpresentrowwidget")?this.destroyeverpresentrowwidget=c.jqx.get(d,"destroyeverpresentrowwidget"):d.destroyEverPresentRowWidget&&(this.destroyEverPresentRowWidget=
d.destroyEverPresentRowWidget);c.jqx.hasProperty(d,"destroyEditor")?this.destroyeditor=c.jqx.get(d,"destroyEditor"):d.destroyEditor&&(this.destroyeditor=d.destroyEditor);c.jqx.hasProperty(d,"getEditorValue")?this.geteditorvalue=c.jqx.get(d,"getEditorValue"):d.getEditorValue&&(this.geteditorvalue=d.getEditorValue);c.jqx.hasProperty(d,"validation")?this.validation=c.jqx.get(d,"validation"):d.validation&&(this.validation=d.validation);c.jqx.hasProperty(d,"cellBeginEdit")?this.cellbeginedit=c.jqx.get(d,
"cellBeginEdit"):d.cellBeginEdit&&(this.cellbeginedit=d.cellBeginEdit);c.jqx.hasProperty(d,"cellEndEdit")?this.cellendedit=c.jqx.get(d,"cellEndEdit"):d.cellEndEdit&&(this.cellendedit=d.cellEndEdit);c.jqx.hasProperty(d,"className")&&(this.classname=c.jqx.get(d,"className"));c.jqx.hasProperty(d,"cellClassName")?this.cellclassname=c.jqx.get(d,"cellClassName"):d.cellClassName&&(this.cellclassname=d.cellClassName);c.jqx.hasProperty(d,"menu")&&(this.menu=c.jqx.get(d,"menu"));c.jqx.hasProperty(d,"aggregates")&&
(this.aggregates=c.jqx.get(d,"aggregates"));c.jqx.hasProperty(d,"aggregatesRenderer")&&(this.aggregatesrenderer=c.jqx.get(d,"aggregatesRenderer"));c.jqx.hasProperty(d,"createFilterWidget")&&(this.createfilterwidget=c.jqx.get(d,"createFilterWidget"));c.jqx.hasProperty(d,"filterType")&&(this.filtertype=c.jqx.get(d,"filterType"));c.jqx.hasProperty(d,"filterDelay")&&(this.filterdelay=c.jqx.get(d,"filterDelay"));c.jqx.hasProperty(d,"rendered")&&(this.rendered=c.jqx.get(d,"rendered"));c.jqx.hasProperty(d,
"exportable")&&(this.exportable=c.jqx.get(d,"exportable"));c.jqx.hasProperty(d,"filterItems")&&(this.filteritems=c.jqx.get(d,"filterItems"));c.jqx.hasProperty(d,"cellValueChanging")&&(this.cellvaluechanging=c.jqx.get(d,"cellValueChanging"));c.jqx.hasProperty(d,"draggable")&&(this.draggable=c.jqx.get(d,"draggable"));c.jqx.hasProperty(d,"filterCondition")&&(this.filtercondition=c.jqx.get(d,"filterCondition"));c.jqx.hasProperty(d,"threeStateCheckbox")&&(this.threestatecheckbox=c.jqx.get(d,"threeStateCheckbox"));
c.jqx.hasProperty(d,"nullable")&&(this.nullable=c.jqx.get(d,"nullable"));c.jqx.hasProperty(d,"columnGroup")&&(this.columngroup=c.jqx.get(d,"columnGroup"));if(!d instanceof String&&"string"!=typeof d)for(var l in d)if(!f.hasOwnProperty(l)&&!f.hasOwnProperty(l.toLowerCase()))throw b.host.remove(),Error("jqxGrid: Invalid property name - "+l+".");}};this._initfields(d);return this}function d(b,d){this.setdata=function(b){null!=b&&(this.bounddata=b,this.boundindex=b.boundindex,this.visibleindex=b.visibleindex,
this.group=b.group,this.parentbounddata=b.parentItem,this.uniqueid=b.uniqueid,this.level=b.level)};this.setdata(d);this.parentrow=null;this.subrows=[];this.owner=b;this.height=25;this.hidden=!1;this.rowdetails=null;this.rowdetailsheight=100;this.rowdetailshidden=!0;this.top=-1;this.setrowinfo=function(b){this.hidden=b.hidden;this.rowdetails=b.rowdetails;this.rowdetailsheight=b.rowdetailsheight;this.rowdetailshidden=!b.showdetails;this.height=b.height};return this}c.jqx.jqxWidget("jqxGrid","",{});
c.extend(c.jqx._jqxGrid.prototype,{defineInstance:function(){var b={adaptive:!1,adaptivewidth:600,disabled:!1,width:600,height:400,pagerheight:40,groupsheaderheight:34,pagesize:10,pagesizeoptions:["5","10","20"],rowsheight:32,columnsheight:32,filterrowheight:36,groupindentwidth:30,rowdetails:!1,enablerowdetailsindent:!0,enablemousewheel:!0,initrowdetails:null,layoutrowdetails:null,editable:!1,editmode:"selectedcell",pageable:!1,pagermode:"default",pagerbuttonscount:5,groupable:!1,sortable:!1,sortmode:"one",
filterable:!1,filtermode:"default",autoshowfiltericon:!0,showfiltercolumnbackground:!0,showpinnedcolumnbackground:!0,showsortcolumnbackground:!0,altrows:!1,altstart:1,altstep:1,showrowdetailscolumn:!0,showrowlines:!0,showcolumnlines:!0,showcolumnheaderlines:!0,showtoolbar:!1,toolbarheight:36,showstatusbar:!1,statusbarheight:36,enableellipsis:!0,groups:[],groupsrenderer:null,groupcolumnrenderer:null,groupsexpandedbydefault:!1,pagerrenderer:null,touchmode:"auto",columns:[],selectedrowindex:-1,selectedrowindexes:[],
selectedcells:[],autobind:!0,selectedcell:null,tableZIndex:79,headerZIndex:29,updatefilterconditions:null,showgroupaggregates:!1,showaggregates:!1,showfilterrow:!1,showeverpresentrow:!1,everpresentrowposition:"top",everpresentrowactions:"add reset",everpresentrowactionsmode:"buttons",everpresentrowheight:30,autorowheight:!1,autokoupdates:!0,handlekeyboardnavigation:null,showsortmenuitems:!0,showfiltermenuitems:!0,showgroupmenuitems:!0,enablebrowserselection:!1,enablekeyboarddelete:!0,clipboard:!0,
clipboardbegin:null,clipboardend:null,copytoclipboardwithheaders:!1,copytoclipboardhiddencolumns:!1,ready:null,updatefilterpanel:null,autogeneratecolumns:!1,rowdetailstemplate:null,scrollfeedback:null,rendertoolbar:null,renderstatusbar:null,rendered:null,multipleselectionbegins:null,columngroups:null,cellhover:null,source:{beforeprocessing:null,beforesend:null,loaderror:null,localdata:null,data:null,datatype:"array",datafields:[],url:"",root:"",record:"",id:"",totalrecords:0,recordstartindex:0,recordendindex:0,
loadallrecords:!0,sortcolumn:null,sortdirection:null,sort:null,filter:null,sortcomparer:null},filter:null,dataview:null,updatedelay:null,autoheight:!1,autowidth:!1,showheader:!0,showgroupsheader:!0,closeablegroups:!0,scrollbarsize:c.jqx.utilities.scrollBarSize,touchscrollbarsize:c.jqx.utilities.touchScrollBarSize,scrollbarautoshow:c.jqx.utilities.scrollBarAutoShow,virtualmode:!1,sort:null,columnsmenu:!0,columnsresize:!1,columnsautoresize:!0,columnsreorder:!1,columnsmenuwidth:16,autoshowcolumnsmenubutton:!0,
showcolumnsactionbutton:!1,popupwidth:"auto",popupheight:"auto",columnmenuopening:null,columnmenuclosing:null,sorttogglestates:2,rendergridrows:null,enableanimations:!0,enablecolumnsvirtualization:!0,enabletooltips:!1,selectionmode:"singlerow",enablehover:!0,loadingerrormessage:"The data is still loading. When the data binding is completed, the Grid raises the 'bindingcomplete' event. Call this function in the 'bindingcomplete' event handler.",verticalscrollbarstep:30,verticalscrollbarlargestep:400,
horizontalscrollbarstep:10,horizontalscrollbarlargestep:50,keyboardnavigation:!0,keyboardmenunavigation:!0,touchModeStyle:"auto",autoshowloadelement:!0,showdefaultloadelement:!0,showemptyrow:!0,autosavestate:!1,autoloadstate:!1,_updating:!1,_pagescache:[],_pageviews:[],_cellscache:[],_rowdetailscache:[],_rowdetailselementscache:[],_requiresupdate:!1,_hasOpenedMenu:!1,scrollmode:"physical",deferreddatafields:null,localization:null,rtl:!1,menuitemsarray:[],events:"initialized rowClick rowSelect rowUnselect groupExpand groupCollapse sort columnClick cellClick pageChanged pageSizeChanged bindingComplete groupsChanged filter columnResized cellSelect cellUnselect cellBeginEdit cellEndEdit cellValueChanged rowExpand rowCollapse rowDoubleClick cellDoubleClick columnReordered pageChanging".split(" ")};
if(this===c.jqx._jqxGrid.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(b){this.that=this;this.pagesize=parseInt(this.pagesize);this.toolbarheight=parseInt(this.toolbarheight);this.columnsheight=parseInt(this.columnsheight);this.filterrowheight=parseInt(this.filterrowheight);this.statusbarheight=parseInt(this.statusbarheight);this.groupsheaderheight=parseInt(this.groupsheaderheight);this.detailsVisibility=[];this.savedArgs=b&&0<b.length?b[0]:null;b="<div class='jqx-clear jqx-border-reset jqx-overflow-hidden jqx-max-size jqx-position-relative'><div tabindex='1' class='jqx-clear jqx-max-size jqx-position-relative jqx-overflow-hidden jqx-background-reset' id='wrapper"+
this.element.id+"'><div class='jqx-clear jqx-position-absolute' id='toolbar' style='visibility: hidden;'></div><div class='jqx-clear jqx-position-absolute' id='groupsheader' style='visibility: hidden;'></div><div class='jqx-clear jqx-overflow-hidden jqx-position-absolute jqx-border-reset jqx-background-reset' id='content"+this.element.id+"'></div><div class='jqx-clear jqx-position-absolute' id='verticalScrollBar"+this.element.id+"'></div><div class='jqx-clear jqx-position-absolute' id='horizontalScrollBar"+
this.element.id+"'></div><div class='jqx-clear jqx-position-absolute jqx-border-reset' id='bottomRight'></div><div class='jqx-clear jqx-position-absolute' id='addrow'></div><div class='jqx-clear jqx-position-absolute' id='statusbar'></div><div class='jqx-clear jqx-position-absolute' id='pager' style='z-index: 20;'></div></div></div>";this.element.innerHTML="";if(this.source){if(!this.source.dataBind){if(!c.jqx.dataAdapter)throw Error("jqxGrid: Missing reference to jqxdata.js");this.source=new c.jqx.dataAdapter(this.source)}var d=
this.source._source.datafields;d&&0<d.length&&(this.editmode=this.editmode.toLowerCase(),this.selectionmode=this.selectionmode.toLowerCase())}this.host.attr("role","grid");this.host.attr("align","left");this.element.innerHTML=b;this.host.addClass(this.toTP("jqx-grid"));this.host.addClass(this.toTP("jqx-reset"));this.host.addClass(this.toTP("jqx-rc-all"));this.host.addClass(this.toTP("jqx-widget"));this.host.addClass(this.toTP("jqx-widget-content"));this.wrapper=this.host.find("#wrapper"+this.element.id);
this.content=this.host.find("#content"+this.element.id);this.content.addClass(this.toTP("jqx-reset"));b=this.host.find("#verticalScrollBar"+this.element.id);d=this.host.find("#horizontalScrollBar"+this.element.id);this.bottomRight=this.host.find("#bottomRight").addClass(this.toTP("jqx-grid-bottomright jqx-scrollbar-state-normal"));if(!b.jqxScrollBar)throw Error("jqxGrid: Missing reference to jqxscrollbar.js");this.editors=[];this.vScrollBar=b.jqxScrollBar({vertical:!0,rtl:this.rtl,touchMode:this.touchmode,
step:this.verticalscrollbarstep,largestep:this.verticalscrollbarlargestep,theme:this.theme,_triggervaluechanged:!1});this.hScrollBar=d.jqxScrollBar({vertical:!1,rtl:this.rtl,touchMode:this.touchmode,step:this.horizontalscrollbarstep,largestep:this.horizontalscrollbarlargestep,theme:this.theme,_triggervaluechanged:!1});this.addnewrow=this.host.find("#addrow");this.addnewrow[0].id="addrow"+this.element.id;this.addnewrow.addClass(this.toTP("jqx-widget-header"));this.pager=this.host.find("#pager");this.pager[0].id=
"pager"+this.element.id;this.toolbar=this.host.find("#toolbar");this.toolbar[0].id="toolbar"+this.element.id;this.toolbar.addClass(this.toTP("jqx-grid-toolbar"));this.toolbar.addClass(this.toTP("jqx-widget-header"));this.statusbar=this.host.find("#statusbar");this.statusbar[0].id="statusbar"+this.element.id;this.statusbar.addClass(this.toTP("jqx-grid-statusbar"));this.statusbar.addClass(this.toTP("jqx-widget-header"));this.pager.addClass(this.toTP("jqx-grid-pager"));this.pager.addClass(this.toTP("jqx-widget-header"));
this.groupsheader=this.host.find("#groupsheader");this.groupsheader.addClass(this.toTP("jqx-grid-groups-header"));this.groupsheader.addClass(this.toTP("jqx-widget-header"));this.groupsheader[0].id="groupsheader"+this.element.id;this.vScrollBar.css("visibility","hidden");this.hScrollBar.css("visibility","hidden");this.vScrollInstance=c.data(this.vScrollBar[0],"jqxScrollBar").instance;this.hScrollInstance=c.data(this.hScrollBar[0],"jqxScrollBar").instance;this.gridtable=null;this.isNestedGrid=this.host.parent()?
299==this.host.parent().css("z-index"):!1;this.touchdevice=this.isTouchDevice();this.localizestrings&&(this.localizestrings(),null!=this.localization&&this.localizestrings(this.localization,!1));this.rowdetailstemplate&&(void 0==this.rowdetailstemplate.rowdetails&&(this.rowdetailstemplate.rowdetails="<div></div>"),void 0==this.rowdetailstemplate.rowdetailsheight&&(this.rowdetailstemplate.rowdetailsheight=200),void 0==this.rowdetailstemplate.rowdetailshidden&&(this.rowdetailstemplate.rowdetailshidden=
!0));if(this.showfilterrow&&!this.filterable)throw Error('jqxGrid: "showfilterrow" requires setting the "filterable" property to true!');if(this.autorowheight&&!this.autoheight&&!this.pageable)throw Error('jqxGrid: "autorowheight" requires setting the "autoheight" or "pageable" property to true!');if(this.virtualmode&&null==this.rendergridrows)throw Error('jqxGrid: "virtualmode" requires setting the "rendergridrows"!');if(this.virtualmode&&!this.pageable&&this.groupable)throw Error('jqxGrid: "grouping" in "virtualmode" without paging is not supported!');
if(!this._testmodules()){this._builddataloadelement();(this._cachedcolumns=this.columns)&&this.columns.length>this.headerZIndex&&(this.headerZIndex=this.columns.length+100);if(this.theme&&0<=this.theme.indexOf("material")){d=c("<span>Test</span>");b=c("<span>Test</span>");d.addClass(this.toTP("jqx-grid-row-cell"));b.addClass(this.toTP("jqx-grid-column-header-cell"));this.host.append(d);this.host.append(b);var g=d.outerHeight(),h=b.outerHeight();g>this.rowsheight&&(this._cellheight=this.rowsheight=
g);h>this.columnsheight&&(this._columnHeight=this.columnsheight=h);d.remove();b.remove()}31!=this.rowsheight&&this._measureElement("cell");(32!=this.columnsheight||this.columngroups)&&this._measureElement("column");if(this.source&&(d=this.source.datafields,null==d&&this.source._source&&(d=this.source._source.datafields),d))for(g=0;g<this.columns.length;g++)if((b=this.columns[g])&&b.cellsformat&&2<b.cellsformat.length)for(h=0;h<d.length;h++)if(d[h].name==b.datafield&&!d[h].format){d[h].format=b.cellsformat;
break}this.databind(this.source);this.showtoolbar&&this.toolbar.css("visibility","inherit");this.showstatusbar&&this.statusbar.css("visibility","inherit");this._arrange();this.pageable&&this._initpager&&this._initpager();this.tableheight=null;var l=this.that,q=function(){l.content&&(l.content[0].scrollTop=0,l.content[0].scrollLeft=0);l.gridcontent&&(l.gridcontent[0].scrollLeft=0,l.gridcontent[0].scrollTop=0)};this.addHandler(this.content,"mousedown",function(){q()});this.addHandler(this.content,"scroll",
function(b){q();return!1});this.showfilterrow||(this.showstatusbar||this.showtoolbar||this.host.addClass("jqx-disableselect"),this.content.addClass("jqx-disableselect"));this.enablebrowserselection&&(this.content.removeClass("jqx-disableselect"),this.host.removeClass("jqx-disableselect"));this._resizeWindow();this.disabled&&this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));this.hasTransform=c.jqx.utilities.hasTransform(this.host);"logical"==this.scrollmode&&(this.vScrollInstance.thumbStep=
this.rowsheight,this.vScrollInstance.step=this.rowsheight);c.jqx.isHidden(this.host)||(this.filterable||this.groupable||this.sortable)&&this._initmenu()}},_resizeWindow:function(){var b=this.that;if(null!=this.width&&-1!=this.width.toString().indexOf("%")||null!=this.height&&-1!=this.height.toString().indexOf("%")){this._updatesizeonwindowresize=!0;c.jqx.utilities.resize(this.host,function(d){var f=c(window).width(),g=c(window).height(),r=b.host.width(),t=b.host.height();if(b.pageable){var v=b.host.find(".jqx-grid-pager-input");
350>f?v.hide():v.show()}b.autoheight&&(b._lastHostWidth=g);if(b._lastHostWidth!=r||b._lastHostHeight!=t){if(b.touchdevice&&b.editcell&&"orientationchange"!==d)return;b._updatesize(b._lastHostWidth!=r,b._lastHostHeight!=t)}b._lastWidth=f;b._lastHeight=g;b._lastHostWidth=r;b._lastHostHeight=t});var d=b.host.width(),g=b.host.height();b._lastHostWidth=d;b._lastHostHeight=g}},_builddataloadelement:function(){this.dataloadelement&&this.dataloadelement.remove();this.dataloadelement=c('<div style="overflow: hidden; position: absolute;"></div>');
if(this.showdefaultloadelement){var b=c('<div style="z-index: 99; margin-left: -66px; left: 50%; top: 50%; margin-top: -24px; position: relative; width: 100px; height: 33px; padding: 5px; font-family: verdana; font-size: 12px; color: #767676; border-color: #898989; border-width: 1px; border-style: solid; background: #f6f6f6; border-collapse: collapse;"><div style="float: left;"><div style="float: left; overflow: hidden; width: 32px; height: 32px;" class="jqx-grid-load"/><span style="margin-top: 10px; float: left; display: block; margin-left: 5px;" >'+
this.gridlocalization.loadtext+"</span></div></div>");b.addClass(this.toTP("jqx-rc-all"));this.dataloadelement.addClass(this.toTP("jqx-rc-all"));b.addClass(this.toTP("jqx-fill-state-normal"));this.dataloadelement.append(b)}else this.dataloadelement.addClass(this.toTP("jqx-grid-load"));this.dataloadelement.width(this.host.width());this.dataloadelement.height(this.host.height());this.wrapper.prepend(this.dataloadelement)},_measureElement:function(b){var d=c("<span style='visibility: hidden; white-space: nowrap;'>measure Text</span>");
d.addClass(this.toTP("jqx-widget"));c(document.body).append(d);"cell"==b?this._cellheight=d.height():this._columnheight=d.height();d.remove()},_measureMenuElement:function(){var b=c("<span style='visibility: hidden; white-space: nowrap;'>measure Text</span>");b.addClass(this.toTP("jqx-widget"));b.addClass(this.toTP("jqx-menu"));b.addClass(this.toTP("jqx-menu-item-top"));b.addClass(this.toTP("jqx-fill-state-normal"));this.isTouchDevice()&&b.addClass(this.toTP("jqx-grid-menu-item-touch"));c(document.body).append(b);
var d=b.outerHeight();b.remove();return d},_measureElementWidth:function(b){b=c("<span style='visibility: hidden; white-space: nowrap;'>"+b+"</span>");b.addClass(this.toTP("jqx-widget"));b.addClass(this.toTP("jqx-grid"));b.addClass(this.toTP("jqx-grid-column-header"));b.addClass(this.toTP("jqx-widget-header"));c(document.body).append(b);var d=b.outerWidth()+20;b.remove();return d},_getBodyOffset:function(){var b=0,d=0;"0px"!=c("body").css("border-top-width")&&(b=parseInt(c("body").css("border-top-width")),
isNaN(b)&&(b=0));"0px"!=c("body").css("border-left-width")&&(d=parseInt(c("body").css("border-left-width")),isNaN(d)&&(d=0));return{left:d,top:b}},_testmodules:function(){var b="",d=this.that,g=function(){""!=b.length&&(b+=",")};this.columnsmenu&&!this.host.jqxMenu&&(this.sortable||this.groupable||this.filterable)&&(g(),b+=" jqxmenu.js");this.host.jqxScrollBar||(g(),b+=" jqxscrollbar.js");this.host.jqxButton||(g(),b+=" jqxbuttons.js");c.jqx.dataAdapter||(g(),b+=" jqxdata.js");this.pageable&&!this.gotopage&&
(g(),b+="jqxgrid.pager.js");this.filterable&&!this.applyfilters&&(g(),b+=" jqxgrid.filter.js");this.groupable&&!this._initgroupsheader&&(g(),b+=" jqxgrid.grouping.js");this.columnsresize&&!this.autoresizecolumns&&(g(),b+=" jqxgrid.columnsresize.js");this.columnsreorder&&!this.setcolumnindex&&(g(),b+=" jqxgrid.columnsreorder.js");this.sortable&&!this.sortby&&(g(),b+=" jqxgrid.sort.js");this.editable&&!this.begincelledit&&(g(),b+=" jqxgrid.edit.js");this.showaggregates&&!this.getcolumnaggregateddata&&
(g(),b+=" jqxgrid.aggregates.js");this.keyboardnavigation&&!this.selectrow&&(g(),b+=" jqxgrid.selection.js");if(""!=b||this.editable||this.filterable||this.pageable){var h=[],l=function(c){switch(c){case "checkbox":d.host.jqxCheckBox||h.checkbox||(h.checkbox=!0,g(),b+=" jqxcheckbox.js");break;case "numberinput":d.host.jqxNumberInput||h.numberinput||(h.numberinput=!0,g(),b+=" jqxnumberinput.js");break;case "datetimeinput":d.host.jqxDateTimeInput||h.datetimeinput?d.host.jqxCalendar||h.calendar||(g(),
b+=" jqxcalendar.js"):(g(),h.datetimeinput=!0,b+=" jqxdatetimeinput.js(requires: jqxcalendar.js)");break;case "combobox":d.host.jqxComboBox||h.combobox?d.host.jqxListBox||h.listbox||(g(),h.listbox=!0,b+=" jqxlistbox.js"):(g(),h.combobox=!0,b+=" jqxcombobox.js(requires: jqxlistbox.js)");break;case "dropdownlist":d.host.jqxDropDownList||h.dropdownlist?d.host.jqxListBox||h.listbox||(g(),h.listbox=!0,b+=" jqxlistbox.js"):(g(),h.dropdownlist=!0,b+=" jqxdropdownlist.js(requires: jqxlistbox.js)")}};(this.filterable||
this.pageable)&&l("dropdownlist");for(var q=0;q<this.columns.length;q++)if(void 0!=this.columns[q]){var r=this.columns[q].columntype;l(r);this.filterable&&this.showfilterrow&&(r=this.columns[q].filtertype,"checkedlist"!=r&&"bool"!=r||l("checkbox"),"date"==r&&l("datetimeinput"))}if(""!=b)throw Error("jqxGrid: Missing references to the following module(s): "+b);}return!1},focus:function(){try{this.wrapper.focus();var b=this.that;setTimeout(function(){b.wrapper.focus()},25);this.focused=!0}catch(d){}},
hiddenParent:function(){return c.jqx.isHidden(this.host)},resize:function(b,d){this.width=b;this.height=d;this._updatesize(!0,!0)},_updatesize:function(b,d){if(!this._loading){var g=this.that;g._newmax=null;var h=g.host.width(),l=g.host.height();g._oldWidth||(g._oldWidth=h);g._oldHeight||(g._oldHeight=l);g._resizeTimer&&clearTimeout(g._resizeTimer);g._resizeTimer=setTimeout(function(){g.resizingGrid=!0;if(!c.jqx.isHidden(g.host)){g.editcell&&(g.endcelledit(g.editcell.row,g.editcell.column,!0,!0),
g._oldselectedcell=null);if(v!=g._oldHeight||1==d){var l=g.groupable&&0<g.groups.length,r=g.vScrollBar.css("visibility");if(!g.autoheight){g.virtualmode&&(g._pageviews=[]);if(l||g.rowdetails||g.pageable){g._arrange();g.prerenderrequired=!0;v=Math.round(g.host.height())+2*g.rowsheight;realheight=g._gettableheight();var l=Math.round(v/g.rowsheight),t=Math.max(g.dataview.totalrows,g.dataview.totalrecords);g.pageable&&(t=g.pagesize,g.pagesize>Math.max(g.dataview.totalrows,g.dataview.totalrecords)&&g.autoheight?
t=Math.max(g.dataview.totalrows,g.dataview.totalrecords):g.autoheight||g.dataview.totalrows<g.pagesize&&(t=Math.max(g.dataview.totalrows,g.dataview.totalrecords)));g._getpagesize();!g.pageable&&g.autoheight&&(l=t);g.virtualsizeinfo&&(g.virtualsizeinfo.visiblerecords=l);g.rendergridcontent(!0,!1);g._renderrows(g.virtualsizeinfo)}else{g._arrange();g.virtualsizeinfo=g._calculatevirtualheight();var v=Math.round(g.host.height())+2*g.rowsheight;parseInt(v)>=parseInt(g._oldHeight)&&(g.prerenderrequired=
!0);g._renderrows(g.virtualsizeinfo);g.rtl&&(g._updatecolumnwidths(),g.table&&g.table.width(g.columnsheader.width()),g._updatecellwidths())}r!=g.vScrollBar.css("visibility")&&(g.vScrollInstance.setPosition(0),g._arrange(),g._updatecolumnwidths(),g.table&&g.table.width(g.columnsheader.width()),g._updatecellwidths())}}if(h!=g._oldWidth||1==b){r=!1;if(g.editcell&&g.editcell.editor)switch(g.editcell.columntype){case "dropdownlist":if(r=g.editcell.editor.jqxDropDownList("isOpened")||g.editcell.editor.jqxDropDownList("isanimating")&&
!g.editcell.editor.jqxDropDownList("ishiding")){g.editcell.editor.jqxDropDownList({openDelay:0});g.editcell.editor.jqxDropDownList("open");g.editcell.editor.jqxDropDownList({openDelay:250});return}break;case "combobox":if(r=g.editcell.editor.jqxComboBox("isOpened")||g.editcell.editor.jqxComboBox("isanimating")&&!g.editcell.editor.jqxComboBox("ishiding")){g.editcell.editor.jqxComboBox({openDelay:0});g.editcell.editor.jqxComboBox("open");g.editcell.editor.jqxComboBox({openDelay:250});return}break;case "datetimeinput":if(r){g.editcell.editor.jqxDateTimeInput("isOpened")||
g.editcell.editor.jqxDateTimeInput("isanimating")&&g.editcell.editor.jqxDateTimeInput("ishiding");g.editcell.editor.jqxDateTimeInput({openDelay:0});g.editcell.editor.jqxDateTimeInput("open");g.editcell.editor.jqxDateTimeInput({openDelay:250});return}}r=g.hScrollBar.css("visibility");g._arrange();g._updatecolumnwidths();g.table&&g.table.width(g.columnsheader.width());g._updatecellwidths();0==b&&g._oldWidth>h||d&&0!=g.dataview.rows.length||g._renderrows(g.virtualsizeinfo);r!=g.hScrollBar.css("visibility")&&
g.hScrollInstance.setPosition(0)}g._oldWidth=h;g._oldHeight=v;g.resizingGrid=!1}},5)}},getTouches:function(b){return c.jqx.mobile.getTouches(b)},_updateTouchScrolling:function(){var b=this.that;if(b.isTouchDevice()){b.scrollmode="logical";b.vScrollInstance.thumbStep=b.rowsheight;var d=c.jqx.mobile.getTouchEventName("touchstart"),g=c.jqx.mobile.getTouchEventName("touchend"),h=c.jqx.mobile.getTouchEventName("touchmove");b.enablehover=!1;b.gridcontent&&(b.removeHandler(b.gridcontent,d+".touchScroll"),
b.removeHandler(b.gridcontent,h+".touchScroll"),b.removeHandler(b.gridcontent,g+".touchScroll"),b.removeHandler(b.gridcontent,"touchcancel.touchScroll"),c.jqx.mobile.touchScroll(b.gridcontent[0],b.vScrollInstance.max,function(d,f){null!=f&&"visible"==b.vScrollBar.css("visibility")&&b.vScrollInstance.setPosition(f);null!=d&&"visible"==b.hScrollBar.css("visibility")&&b.hScrollInstance.setPosition(d);b.vScrollInstance.thumbCapture=!0;b._lastScroll=new Date},this.element.id,this.hScrollBar,this.vScrollBar),
b._overlayElement&&(b.removeHandler(b._overlayElement,d+".touchScroll"),b.removeHandler(b._overlayElement,h+".touchScroll"),b.removeHandler(b._overlayElement,g+".touchScroll"),b.removeHandler(b._overlayElement,"touchcancel.touchScroll"),c.jqx.mobile.touchScroll(b._overlayElement[0],b.vScrollInstance.max,function(d,f){null!=f&&"visible"==b.vScrollBar.css("visibility")&&b.vScrollInstance.setPosition(f);null!=d&&"visible"==b.hScrollBar.css("visibility")&&b.hScrollInstance.setPosition(d);b.vScrollInstance.thumbCapture=
!0;b._lastScroll=new Date},this.element.id,this.hScrollBar,this.vScrollBar),this.addHandler(this.host,d,function(){b.editcell?b._overlayElement.css("visibility","hidden"):b._overlayElement.css("visibility","visible")}),this.addHandler(this.host,g,function(){b.editcell?b._overlayElement.css("visibility","hidden"):b._overlayElement.css("visibility","visible")})))}},_rendercelltexts:function(){},isTouchDevice:function(){if(void 0!=this.touchDevice)return this.touchDevice;var b=c.jqx.mobile.isTouchDevice();
this.touchDevice=b;if(1==this.touchmode){if(c.jqx.browser.msie&&9>c.jqx.browser.version)return this.enablehover=!1;b=!0;c.jqx.mobile.setMobileSimulator(this.element);this.touchDevice=b}else 0==this.touchmode&&(b=!1);b&&0!=this.touchModeStyle&&(this.touchDevice=!0,this.host.addClass(this.toThemeProperty("jqx-touch")),this.host.find("jqx-widget-content").addClass(this.toThemeProperty("jqx-touch")),this.host.find("jqx-widget-header").addClass(this.toThemeProperty("jqx-touch")),this.scrollbarsize=this.touchscrollbarsize);
return b},toTP:function(b){return this.toThemeProperty(b)},localizestrings:function(b,d){this._cellscache=[];c.jqx.dataFormat&&c.jqx.dataFormat.cleardatescache();if(this._loading)throw Error("jqxGrid: "+this.loadingerrormessage);if(null!=b){for(var g in b)g.toLowerCase()!==g&&(b[g.toLowerCase()]=b[g]);b.okstring&&(this.gridlocalization.okstring=b.okstring);b.cancelstring&&(this.gridlocalization.cancelstring=b.cancelstring);b.pagergotopagestring&&(this.gridlocalization.pagergotopagestring=b.pagergotopagestring);
b.pagershowrowsstring&&(this.gridlocalization.pagershowrowsstring=b.pagershowrowsstring);b.pagerrangestring&&(this.gridlocalization.pagerrangestring=b.pagerrangestring);b.pagernextbuttonstring&&(this.gridlocalization.pagernextbuttonstring=b.pagernextbuttonstring);b.pagerpreviousbuttonstring&&(this.gridlocalization.pagerpreviousbuttonstring=b.pagerpreviousbuttonstring);b.pagerfirstbuttonstring&&(this.gridlocalization.pagerfirstbuttonstring=b.pagerfirstbuttonstring);b.pagerlastbuttonstring&&(this.gridlocalization.pagerlastbuttonstring=
b.pagerlastbuttonstring);b.groupsheaderstring&&(this.gridlocalization.groupsheaderstring=b.groupsheaderstring);b.sortascendingstring&&(this.gridlocalization.sortascendingstring=b.sortascendingstring);b.sortdescendingstring&&(this.gridlocalization.sortdescendingstring=b.sortdescendingstring);b.sortremovestring&&(this.gridlocalization.sortremovestring=b.sortremovestring);b.groupbystring&&(this.gridlocalization.groupbystring=b.groupbystring);b.groupremovestring&&(this.gridlocalization.groupremovestring=
b.groupremovestring);b.firstDay&&(this.gridlocalization.firstDay=b.firstDay);b.days&&(this.gridlocalization.days=b.days);b.months&&(this.gridlocalization.months=b.months);b.AM&&(this.gridlocalization.AM=b.AM);b.PM&&(this.gridlocalization.PM=b.PM);b.patterns&&(this.gridlocalization.patterns=b.patterns);b.percentsymbol&&(this.gridlocalization.percentsymbol=b.percentsymbol);b.currencysymbol&&(this.gridlocalization.currencysymbol=b.currencysymbol);b.currencysymbolposition&&(this.gridlocalization.currencysymbolposition=
b.currencysymbolposition);void 0!=b.decimalseparator&&(this.gridlocalization.decimalseparator=b.decimalseparator);void 0!=b.thousandsseparator&&(this.gridlocalization.thousandsseparator=b.thousandsseparator);b.filterclearstring&&(this.gridlocalization.filterclearstring=b.filterclearstring);b.filterstring&&(this.gridlocalization.filterstring=b.filterstring);b.filtershowrowstring&&(this.gridlocalization.filtershowrowstring=b.filtershowrowstring);b.filtershowrowdatestring&&(this.gridlocalization.filtershowrowdatestring=
b.filtershowrowdatestring);b.filterselectallstring&&(this.gridlocalization.filterselectallstring=b.filterselectallstring);b.filterchoosestring&&(this.gridlocalization.filterchoosestring=b.filterchoosestring);b.filterorconditionstring&&(this.gridlocalization.filterorconditionstring=b.filterorconditionstring);b.filterandconditionstring&&(this.gridlocalization.filterandconditionstring=b.filterandconditionstring);b.filterstringcomparisonoperators&&(this.gridlocalization.filterstringcomparisonoperators=
b.filterstringcomparisonoperators);b.filternumericcomparisonoperators&&(this.gridlocalization.filternumericcomparisonoperators=b.filternumericcomparisonoperators);b.filterdatecomparisonoperators&&(this.gridlocalization.filterdatecomparisonoperators=b.filterdatecomparisonoperators);b.filterbooleancomparisonoperators&&(this.gridlocalization.filterbooleancomparisonoperators=b.filterbooleancomparisonoperators);b.emptydatastring&&(this.gridlocalization.emptydatastring=b.emptydatastring);b.filterselectstring&&
(this.gridlocalization.filterselectstring=b.filterselectstring);b.todaystring&&(this.gridlocalization.todaystring=b.todaystring);b.clearstring&&(this.gridlocalization.clearstring=b.clearstring);b.validationstring&&(this.gridlocalization.validationstring=b.validationstring);b.loadtext&&(this.gridlocalization.loadtext=b.loadtext);b.addrowstring&&(this.gridlocalization.addrowstring=b.addrowstring);b.udpaterowstring&&(this.gridlocalization.udpaterowstring=b.udpaterowstring);b.deleterowstring&&(this.gridlocalization.deleterowstring=
b.deleterowstring);b.resetrowstring&&(this.gridlocalization.resetrowstring=b.resetrowstring);b.everpresentrowplaceholder&&(this.gridlocalization.everpresentrowplaceholder=b.everpresentrowplaceholder);if(!1!==d){this._initpager&&this._initpager();this._initgroupsheader&&this._initgroupsheader();this._initmenu&&this._initmenu();this._builddataloadelement();c(this.dataloadelement).css("visibility","hidden");c(this.dataloadelement).css("display","none");if(this.filterable&&this.showfilterrow&&this._updatefilterrow){for(g in this._filterrowcache)c(this._filterrowcache[g]).remove();
this._filterrowcache=[];this._updatefilterrow()}this.showaggregates&&this.refresheaggregates&&this.refresheaggregates();this._renderrows(this.virtualsizeinfo)}}else this.gridlocalization={"/":"/",":":":",firstDay:0,days:{names:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),namesAbbr:"Sun Mon Tue Wed Thu Fri Sat".split(" "),namesShort:"Su Mo Tu We Th Fr Sa".split(" ")},months:{names:"January February March April May June July August September October November December ".split(" "),
namesAbbr:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec ".split(" ")},AM:["AM","am","AM"],PM:["PM","pm","PM"],eras:[{name:"A.D.",start:null,offset:0}],twoDigitYearMax:2029,patterns:{d:"M/d/yyyy",D:"dddd, MMMM dd, yyyy",t:"h:mm tt",T:"h:mm:ss tt",f:"dddd, MMMM dd, yyyy h:mm tt",F:"dddd, MMMM dd, yyyy h:mm:ss tt",M:"MMMM dd",Y:"yyyy MMMM",S:"yyyy'-'MM'-'dd'T'HH':'mm':'ss",ISO:"yyyy-MM-dd hh:mm:ss",ISO2:"yyyy-MM-dd HH:mm:ss",d1:"dd.MM.yyyy",d2:"dd-MM-yyyy",d3:"dd-MMMM-yyyy",d4:"dd-MM-yy",d5:"H:mm",
d6:"HH:mm",d7:"HH:mm tt",d8:"dd/MMMM/yyyy",d9:"MMMM-dd",d10:"MM-dd",d11:"MM-dd-yyyy"},percentsymbol:"%",currencysymbol:"$",currencysymbolposition:"before",decimalseparator:".",thousandsseparator:",",pagergotopagestring:"Go to page:",pagershowrowsstring:"Show rows:",pagerrangestring:" of ",pagerpreviousbuttonstring:"previous",pagernextbuttonstring:"next",pagerfirstbuttonstring:"first",pagerlastbuttonstring:"last",groupsheaderstring:"Drag a column and drop it here to group by that column",sortascendingstring:"Sort Ascending",
sortdescendingstring:"Sort Descending",sortremovestring:"Remove Sort",groupbystring:"Group By this column",groupremovestring:"Remove from groups",filterclearstring:"Clear",filterstring:"Filter",filtershowrowstring:"Show rows where:",filtershowrowdatestring:"Show rows where date:",filterorconditionstring:"Or",filterandconditionstring:"And",filterselectallstring:"(Select All)",filterchoosestring:"Please Choose:",filterstringcomparisonoperators:"empty;not empty;contains;contains(match case);does not contain;does not contain(match case);starts with;starts with(match case);ends with;ends with(match case);equal;equal(match case);null;not null".split(";"),
filternumericcomparisonoperators:"equal;not equal;less than;less than or equal;greater than;greater than or equal;null;not null".split(";"),filterdatecomparisonoperators:"equal;not equal;less than;less than or equal;greater than;greater than or equal;null;not null".split(";"),filterbooleancomparisonoperators:["equal","not equal"],validationstring:"Entered value is not valid",emptydatastring:"No data to display",filterselectstring:"Select Filter",loadtext:"Loading...",clearstring:"Clear",todaystring:"Today",
addrowstring:"Add",udpaterowstring:"Update",deleterowstring:"Delete",resetrowstring:"Reset",everpresentrowplaceholder:"Enter ",okstring:"Ok",cancelstring:"Cancel"}},_getmenudefaultheight:function(){var b=0;this.sortable&&this._togglesort&&this.showsortmenuitems&&(b=3);this.groupable&&this._initgroupsheader&&this.showgroupmenuitems&&(b+=2);var d=this._measureMenuElement(),b=b*d+9;this.filterable&&!this.showfilterrow&&this.showfiltermenuitems&&(b+=194,c.jqx.browser.msie&&8>c.jqx.browser.version&&(b+=
20));return b},_initmenu:function(){var b=this.that;if(this.host.jqxMenu){if(this.gridmenu){if(this._hasOpenedMenu)return;this.filterable&&this._destroyfilterpanel&&this._destroyfilterpanel();this.removeHandler(this.gridmenu,"keydown");this.removeHandler(this.gridmenu,"closed");this.removeHandler(this.gridmenu,"itemclick");this.gridmenu.jqxMenu("destroy");this.gridmenu.removeData();this.gridmenu.remove()}this.menuitemsarray=[];var d="";this.isTouchDevice()&&(d="jqx-grid-menu-item-touch");this.gridmenu=
c('<div tabindex=0 id="gridmenu'+this.element.id+'" style="z-index: 99;"></div>');this.host.append(this.gridmenu);var g=c("<ul></ul>"),h=c('<li class="'+d+'"><div class="jqx-grid-sortasc-icon"></div>'+this.gridlocalization.sortascendingstring+"</li>"),l=c('<li class="'+d+'"><div class="jqx-grid-sortdesc-icon"></div>'+this.gridlocalization.sortdescendingstring+"</li>"),q=c('<li class="'+d+'"><div class="jqx-grid-sortremove-icon"></div>'+this.gridlocalization.sortremovestring+"</li>"),r=c('<li class="'+
d+'"><div class="jqx-grid-groupby-icon"></div>'+this.gridlocalization.groupbystring+"</li>"),t=c('<li class="'+d+'"><div class="jqx-grid-groupby-icon"></div>'+this.gridlocalization.groupremovestring+"</li>"),v=c('<li type="separator"></li>'),y=c('<li class="filter '+d+'" style="height: 194px;" ignoretheme="true"><div class="filter"></div></li>'),d=this.gridlocalization.sortascendingstring.length,A=this.gridlocalization.sortascendingstring;this.gridlocalization.sortdescendingstring.length>d&&(d=this.gridlocalization.sortdescendingstring.length,
A=this.gridlocalization.sortdescendingstring);this.gridlocalization.sortremovestring.length>d&&(d=this.gridlocalization.sortremovestring.length,A=this.gridlocalization.sortremovestring);this.groupable&&this._initgroupsheader&&this.showgroupmenuitems&&(this.gridlocalization.groupbystring.length>d&&(d=this.gridlocalization.groupbystring.length,A=this.gridlocalization.groupbystring),this.gridlocalization.groupremovestring.length>d&&(d=this.gridlocalization.groupremovestring.length,A=this.gridlocalization.groupremovestring));
d=200;A=c.trim(A).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,"");A=c("<span>"+A+"</span>");A.addClass(this.toThemeProperty("jqx-menu-item"));this.host.append(A);d=A.outerWidth()+60;A.remove();A=0;this.sortable&&this._togglesort&&this.showsortmenuitems&&(g.append(h),this.menuitemsarray[0]=h[0],g.append(l),this.menuitemsarray[1]=l[0],g.append(q),this.menuitemsarray[2]=q[0],A=3);this.groupable&&this._initgroupsheader&&this.showgroupmenuitems&&(g.append(r),this.menuitemsarray[3]=r[0],g.append(t),this.menuitemsarray[4]=
t[0],A+=2);var w=this._measureMenuElement(),A=A*w+9,w=!0;if(this.filterable&&!this.showfilterrow&&this.showfiltermenuitems)if(this._initfilterpanel)this.menuitemsarray[5]=y[0],this.menuitemsarray[6]=y[0],g.append(v),g.append(y),A+=194,c.jqx.browser.msie&&8>c.jqx.browser.version&&(A+=20),this.isTouchDevice()&&(A+=30),v=c(y).find("div:first"),this.excelfilterpanel=c("<div></div>"),this.filterpanel=v,this.filtermenu=c(y),d+=20,this.adaptive&&this.element.offsetWidth<this.adaptivewidth&&(d=this.element.offsetWidth-
50),this._initfilterpanel(this,v,"",d),this._initfilterpanel(this,this.excelfilterpanel,"",d,!0),w=!1,this.removeHandler(c(document),"click.menu"+b.element.id,b._closemenuafterclick,b),this.addHandler(c(document),"click.menu"+b.element.id,b._closemenuafterclick,b);else throw Error("jqxGrid: Missing reference to jqxgrid.filter.js.");this.gridmenu.append(g);c.jqx.browser.msie&&8>c.jqx.browser.version&&this.filterable&&(c("#listBoxfilter1"+this.element.id).css("z-index",49),c("#listBoxfilter2"+this.element.id).css("z-index",
49),c("#listBoxfilter3"+this.element.id).css("z-index",49),c("#gridmenu"+this.element.id).css("z-index",50),this.addHandler(c("#gridmenu"+this.element.id),"initialized",function(){c("#menuWrappergridmenu"+b.element.id).css("z-index",49)}));void 0==this.menuitemsarray[0]&&(A=65);this.removeHandler(c(window),"orientationchange.jqxgrid"+this.element.id);this.removeHandler(c(window),"orientationchanged.jqxgrid"+this.element.id);this.addHandler(c(window),"orientationchange.jqxgrid"+this.element.id,function(){b.gridmenu.jqxMenu("close")});
this.addHandler(c(window),"orientationchanged.jqxgrid"+this.element.id,function(){b.gridmenu.jqxMenu("close")});this.removeHandler(this.gridmenu,"keydown");this.addHandler(this.gridmenu,"keydown",function(d){var f=c(b.gridmenu.find(".jqx-item")).toArray(),g=function(b){for(var e=f.indexOf(b)-1;0<=e;e--)if(!(0<=f[e].className.indexOf("disabled")))return f[e];return b},h=function(b){for(var e=f.indexOf(b)+1;e<f.length;e++)if(!(0<=f[e].className.indexOf("disabled")))return f[e];return b},l=function(){var b=
f[f.length-1];return 0<=b.className.indexOf("disabled")?g(b):b},q=function(){for(var b=0;b<f.length;b++)if(f[b].active)return f[b];return null},w=function(b){c(f).removeClass("jqx-fill-state-focus");for(var e=0;e<f.length;e++)f[e].active=!1;b&&(c(b).addClass("jqx-fill-state-focus"),b.active=!0)};q()||b.filterable||(f[0].active=!0);if(b.keyboardmenunavigation&&b.keyboardnavigation&&(40===d.keyCode?(q=q(),w(h(q))):38===d.keyCode&&(q=q(),w(g(q))),9===d.keyCode)){if(!q()){if(d.shiftKey)if(document.activeElement===
c.find("#filter1"+b.element.id)[0]){var z=l();w(z);c(c.find("#filter1"+b.element.id)).removeClass("jqx-fill-state-focus");b.gridmenu.focus();d.stopPropagation();d.preventDefault()}else document.activeElement===c.find("#filter1"+b.element.id+"ex")[0]&&(z=l(),w(z),c(c.find("#filter1"+b.element.id)+"ex").removeClass("jqx-fill-state-focus"),b.gridmenu.focus(),d.stopPropagation(),d.preventDefault());return!0}d.shiftKey?(q=q(),w(g(q))):(q=q(),q===l()&&b.filterable&&!b.showfilterrow?(w(null),0<c(c.find("#filter1"+
b.element.id)).length?c(c.find("#filter1"+b.element.id)).jqxDropDownList("focus"):0<c(c.find("#filter1"+b.element.id+"ex")).length&&c(c.find("#filter1"+b.element.id+"ex")).jqxListBox("focus")):w(h(q)));d.stopPropagation();d.preventDefault()}if(27==d.keyCode)b.gridmenu.jqxMenu("close");else if(13==d.keyCode){f=b.gridmenu.find(".jqx-item");if(q=q())c(q).trigger("click"),w(null);else if(b._buildfilter&&b.filterable&&!b.showfilterrow){if(0<c.find("#filter1"+b.element.id).length)var z="block"==c(c.find("#filter1"+
b.element.id)).jqxDropDownList("container").css("display"),r="block"==c(c.find("#filter2"+b.element.id)).jqxDropDownList("container").css("display"),t="block"==c(c.find("#filter3"+b.element.id)).jqxDropDownList("container").css("display");d=c(c.find("#filterclearbutton"+b.element.id)).hasClass("jqx-fill-state-focus");w=c(c.find("#filterbutton"+b.element.id)).hasClass("jqx-fill-state-focus");d?(z=c.data(document.body,"contextmenu"+b.element.id).column,b._clearfilter(b,b.element,z),b.gridmenu.jqxMenu("close")):
!w||z||r||t||(z=c.data(document.body,"contextmenu"+b.element.id).column,b.gridmenu.jqxMenu("close"),b._buildfilter(b,y,z))}b.clearselection();if(z=b.getdisplayrows()[0])z=b.getboundindex(z),0<=b.selectionmode.indexOf("cell")?b.selectcell(z,b.columns.records[0].displayfield):b.selectrow(z)}});"auto"!=this.popupwidth&&(d=this.popupwidth);this.gridmenu.jqxMenu({popupZIndex:1E3,width:d,height:A,autoCloseOnClick:w,autoOpenPopup:!1,mode:"popup",theme:this.theme,animationShowDuration:0,animationHideDuration:0,
animationShowDelay:0});this.filterable&&this.gridmenu.jqxMenu("_setItemProperty",y[0].id,"closeOnClick",!1);if(this.rtl){var z=this.that;c.each(g.find("li"),function(){c(this).addClass(z.toTP("jqx-rtl"))});g=function(b){b=b.find("div");b.css("float","right");b.css("margin-left","4px");b.css("margin-right","-4px")};g(q);g(l);g(h);g(r);g(t)}this._handlemenueevents()}else this.columnsmenu=!1},_arrangemenu:function(){this.gridmenu||this._initmenu();var b=this.gridlocalization.sortascendingstring.length,
d=this.gridlocalization.sortascendingstring;this.gridlocalization.sortdescendingstring.length>b&&(b=this.gridlocalization.sortdescendingstring.length,d=this.gridlocalization.sortdescendingstring);this.gridlocalization.sortremovestring.length>b&&(b=this.gridlocalization.sortremovestring.length,d=this.gridlocalization.sortremovestring);this.groupable&&this._initgroupsheader&&(this.gridlocalization.groupbystring.length>b&&(b=this.gridlocalization.groupbystring.length,d=this.gridlocalization.groupbystring),
this.gridlocalization.groupremovestring.length>b&&(d=this.gridlocalization.groupremovestring));d=c.trim(d).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,"");d=c("<span>"+d+"</span>");d.addClass(this.toThemeProperty("jqx-menu-item"));this.host.append(d);b=d.outerWidth()+60;d.remove();d=0;this.sortable&&this._togglesort&&this.showsortmenuitems&&(d=3);this.groupable&&this._initgroupsheader&&this.showgroupmenuitems&&(d+=2);var g=this._measureMenuElement(),d=d*g+9;this.filterable&&this.showfiltermenuitems&&
this._initfilterpanel&&(d+=194,b+=20,c.jqx.browser.msie&&8>c.jqx.browser.version&&(d+=20),this.isTouchDevice()&&(d+=30));void 0==this.menuitemsarray[0]&&(d=65);"auto"!=this.popupwidth&&(b=this.popupwidth);"auto"!=this.popupheight&&(d=this.popupheight);this.gridmenu.jqxMenu({width:b,height:d})},_closemenuafterclick:function(b){var d=null!=b?b.data:this,g=!1;if(void 0==b.target||void 0!=b.target&&void 0==b.target.className.indexOf)d.gridmenu.jqxMenu("close");else if(-1==b.target.className.indexOf("filter")||
-1!=b.target.className.indexOf("jqx-grid-cell-filter"))if(-1!=b.target.className.indexOf("jqx-grid-cell"))d.gridmenu.jqxMenu("close");else if(!d._hasOpenedMenu||!c(b.target).ischildof(d.gridmenu)){d.host.coord();var h=d.gridmenu.coord(),l=b.pageX,q=b.pageY;c.each(c(b.target).parents(),function(){if(null!=this.id&&this.id.indexOf&&-1!=this.id.indexOf("filter")||this.className.indexOf&&-1!=this.className.indexOf("filter")&&-1==this.className.indexOf("jqx-grid-cell-filter"))return g=!0,!1;if(this.className.indexOf&&
-1!=this.className.indexOf("jqx-grid-cell")||this.className.indexOf&&-1!=this.className.indexOf("jqx-grid-column"))return d.gridmenu.jqxMenu("close"),!1});if(!g){try{if("default"===d.filtermode){var r=c(c.find("#filter1"+d.element.id)).jqxDropDownList("listBox").vScrollInstance._mouseup,t=new Date;if(100>t-r)return;var v=c(c.find("#filter3"+d.element.id)).jqxDropDownList("listBox").vScrollInstance._mouseup;if(100>t-v||"block"==c(c.find("#filter3"+d.element.id)).jqxDropDownList("container").css("display")||
"block"==c(c.find("#filter1"+d.element.id)).jqxDropDownList("container").css("display")||"block"==c(c.find("#filter2"+d.element.id)).jqxDropDownList("container").css("display")||d._hasdatefilter&&"div"==c(".filtertext1"+d.element.id)[0].nodeName.toLowerCase()&&("block"==c(".filtertext1"+d.element.id).jqxDateTimeInput("container").css("display")||"block"==c(".filtertext2"+d.element.id).jqxDateTimeInput("container").css("display")))return}else{r=c(c.find("#filter1"+d.element.id)).data().jqxListBox.instance.vScrollInstance._mouseup;
t=new Date;if(100>t-r)return;v=c(c.find("#filter1"+d.element.id)).data().jqxListBox.instance.hScrollInstance._mouseup;if(100>t-v)return}}catch(y){}if(!(l>=h.left&&l<=h.left+d.gridmenu.width()&&q>=h.top&&q<=h.top+d.gridmenu.height())){b=!1;if(d.columnmenuclosing&&((b=c.data(document.body,"contextmenu"+d.element.id))||(b={column:{displayfield:null}}),b=d.columnmenuclosing(d.gridmenu,b.column.displayfield,c(d.gridmenu).height()),!1===b))return;d.gridmenu.jqxMenu("close")}}}},_handlemenueevents:function(){var b=
this.that;this.removeHandler(this.gridmenu,"closed");this.addHandler(this.gridmenu,"closed",function(d){b._closemenu()});this.removeHandler(this.gridmenu,"itemclick");this.addHandler(this.gridmenu,"itemclick",function(d){var g=d.args;for(d=0;d<b.menuitemsarray.length;d++)if(g==b.menuitemsarray[d]){if(void 0!=c(g).attr("ignoretheme"))break;var g=c.data(document.body,"contextmenu"+b.element.id),h=g.column;b.filterable&&b.gridmenu.jqxMenu("close");var l=h.displayfield;null==l&&(l=h.datafield);if(null!=
g)switch(d){case 0:b.sortby(l,"ascending",null);break;case 1:b.sortby(l,"descending",null);break;case 2:b.sortby(l,null,null);break;case 3:b.addgroup(l);break;case 4:b.removegroup(l);break;case 5:d=c(b.menuitemsarray[6]),c(d).css("display","block")}break}})},getdatainformation:function(){var b=this.dataview.totalrecords;this.summaryrows&&(b+=this.summaryrows.length);return{rowscount:b,sortinformation:this.getsortinformation(),paginginformation:this.getpaginginformation()}},getsortinformation:function(){return{sortcolumns:this.getsortcolumns?
this.getsortcolumns():[],sortcolumn:this.sortcolumn,sortdirection:this.sortdirection}},getpaginginformation:function(){return{pagenum:this.dataview.pagenum,pagesize:this.pagesize,pagescount:Math.ceil(this.dataview.totalrecords/this.pagesize)}},_updaterowsproperties:function(){this._updatehiddenrows();this._updaterowheights();this._updaterowdetails()},_updatehiddenrows:function(){var b=this.that;this.hiddens=[];c.each(this.hiddenboundrows,function(d){void 0!=this.index&&(d=b.getrowvisibleindex(d),
b.hiddens[d]=this.hidden)})},_updaterowheights:function(){var b=this.that;this.heights=[];c.each(this.heightboundrows,function(d){void 0!=this.index&&(d=b.getrowvisibleindex(d),b.heights[d]=this.height)})},_updaterowdetails:function(){var b=this.that;this.details=[];c.each(this.detailboundrows,function(d){void 0!=this.index&&(d=b.getrowvisibleindex(d),b.details[d]=this.details)})},_getmenuitembyindex:function(b){return void 0==b?null:this.menuitemsarray[b]},openmenu:function(b){if(!this._openingmenu){this._openingmenu=
!0;this.closemenu();var d=this.getcolumn(b);if(!d.menu)return!1;this.gridmenu||this._initmenu();var g=d.columnsmenu;c(d.element).trigger("mouseenter");this.menuOwner=d;for(var h=this,d=0;d<h.columns.records.length;d++)h.columns.records[d].datafield!=b&&c(h.columns.records[d].element).trigger("mouseleave");setTimeout(function(){"block"==c(g)[0].style.display&&c(g).trigger("click");h._openingmenu=!1},200)}},closemenu:function(){this._closemenu()},_closemenu:function(){if(this._hasOpenedMenu){var b=
!1;if(this.columnmenuclosing){var d=c.data(document.body,"contextmenu"+this.element.id);d||(d={column:{displayfield:null}});b=this.columnmenuclosing(this.gridmenu,d.column.displayfield,c(this.gridmenu).height());if(!1===b)return}null!=this.gridmenu&&this.gridmenu.jqxMenu("close");d=c.data(document.body,"contextmenu"+this.element.id);null!=d&&this.autoshowcolumnsmenubutton&&(this.enableanimations?(c(d.columnsmenu).animate({"margin-left":0},"fast",function(){c(d.columnsmenu).css("display","none")}),
b=this.rtl?0:-32,d.column.iconscontainer.animate({"margin-left":b},"fast")):(c(d.columnsmenu).css("display","none"),b=this.rtl?0:-32,d.column.iconscontainer.css("margin-left",b)),c.data(document.body,"contextmenu"+this.element.id,null));this._hasOpenedMenu=!1;this.menuOwner=null;var g=this._getmenuitembyindex(5);if(g){var b=c(g).find("#filter1"+this.element.id),h=c(g).find("#filter2"+this.element.id),g=c(g).find("#filter3"+this.element.id);0<b.length&&"default"===this.filtermode&&(b.jqxDropDownList("hideListBox"),
0<h.length&&h.jqxDropDownList("hideListBox"),0<g.length&&g.jqxDropDownList("hideListBox"))}this.focus()}},scrolloffset:function(b,d){null!=b&&null!=d&&void 0!=b&&void 0!=d&&(this.vScrollBar.jqxScrollBar("setPosition",b),this.hScrollBar.jqxScrollBar("setPosition",d))},scrollleft:function(b){null!=b&&void 0!=b&&"hidden"!=this.hScrollBar.css("visibility")&&this.hScrollBar.jqxScrollBar("setPosition",b)},scrolltop:function(b){null!=b&&void 0!=b&&"hidden"!=this.vScrollBar.css("visibility")&&this.vScrollBar.jqxScrollBar("setPosition",
b)},beginupdate:function(b,d){this._updating=!0;this._datachanged=!1;!0===b&&(this._batchupdate=!0);!0===d&&(this._stopbindings=!0)},endupdate:function(){this.resumeupdate()},resumeupdate:function(){this._updating=!1;if(this._batchupdate)this._datachanged=this._batchupdate=!1,this._stopbindings?this.updatebounddata():this.render();else if(this._stopbindings)this.updatebounddata("data");else{if(1==this._datachanged){var b=this.vScrollInstance.value;this.render(!0,!0,!1);this._datachanged=!1;0!=b&&
b<this.vScrollInstance.max&&this.scrolltop(b)}else this.rendergridcontent(!0),this._renderrows(this.virtualsizeinfo);this.showaggregates&&this.renderaggregates&&this.renderaggregates();this._updatecolumnwidths();this._updatecellwidths();this._renderrows(this.virtualsizeinfo)}},updating:function(){return this._updating},showloadelement:function(){this.renderloadelement&&this.dataloadelement.html(this.renderloadelement());this.dataloadelement.width(this.host.width());this.dataloadelement.height(this.host.height());
c(this.dataloadelement).css("visibility","visible");c(this.dataloadelement).css("display","block")},hideloadelement:function(){c(this.dataloadelement).css("visibility","hidden");c(this.dataloadelement).css("display","none")},_updatefocusedfilter:function(){var b=this.that;b.focusedfilter&&(b.focusedfilter.focus(),setTimeout(function(){b.focusedfilter.focus();if("input"==b.focusedfilter[0].nodeName.toLowerCase()){var d=b.focusedfilter.val().length;try{if("selectionStart"in b.focusedfilter[0])b.focusedfilter[0].setSelectionRange(d,
d);else{var c=b.focusedfilter[0].createTextRange();c.collapse(!0);c.moveEnd("character",d);c.moveStart("character",d);c.select()}}catch(h){}}},50))},databind:function(b,d){if(!0!==this.loadingstate&&!0!==this._stopbindings){var g=window;"block"==this.host.css("display")&&(this.autoshowloadelement?(c(this.dataloadelement).css("visibility","visible"),c(this.dataloadelement).css("display","block"),this.dataloadelement.width(this.host.width()),this.dataloadelement.height(this.host.height()),this._hideemptyrow()):
(c(this.dataloadelement).css("visibility","hidden"),c(this.dataloadelement).css("display","none")));!this._initgroupsheader&&0<this.groups.length&&(this.groups=[]);var h=this.that;null==b&&(b={});b.recordstartindex||(b.recordstartindex=0);b.recordendindex||(b.recordendindex=0);if(void 0==b.loadallrecords||null==b.loadallrecords)b.loadallrecords=!0;if(void 0==b.sortcomparer||null==b.sortcomparer)b.sortcomparer=null;if(void 0==b.filter||null==b.filter)b.filter=null;if(void 0==b.sort||null==b.sort)b.sort=
null;if(void 0==b.data||null==b.data)b.data=null;var l=null;null!=b&&(l=void 0!=b._source?b._source.url:b.url);this.dataview=this.dataview||new c.jqx.dataview;c.jqx.dataview.sort&&c.extend(this.dataview,new c.jqx.dataview.sort);c.jqx.dataview.grouping&&c.extend(this.dataview,new c.jqx.dataview.grouping);this.dataview.suspendupdate();this.dataview.pageable=this.pageable;this.dataview.groupable=this.groupable;this.dataview.groups=this.groups;this.dataview.virtualmode=this.virtualmode;this.dataview.grid=
this;this.dataview._clearcaches();!this.pageable&&this.virtualmode&&(this.loadondemand=!0);if(!h.initializedcall){if(b._source&&this.sortable&&(void 0!=b._source.sortcolumn&&(this.sortcolumn=b._source.sortcolumn,this.source.sortcolumn=this.sortcolumn,this.dataview.sortfield=b._source.sortcolumn,b._source.sortcolumn=null),void 0!=b._source.sortdirection)){var q=this.dataview.sortfielddirection=b._source.sortdirection,r="a"==q||"asc"==q||"ascending"==q||1==q?!0:!1;this.sortdirection=null!=q?{ascending:r,
descending:!r}:{ascending:!1,descending:!1}}this.pageable&&b._source&&(void 0!=b._source.pagenum&&(this.dataview.pagenum=b._source.pagenum),void 0!=b._source.pagesize?(this.pagesize=b._source.pagesize,this.dataview.pagesize=b._source.pagesize):(this.dataview.pagesize=b._source.pagesize,void 0==this.dataview.pagesize&&(this.dataview.pagesize=this.pagesize)));this.sortable&&(b.sortcolumn&&(this.dataview.sortfield=b.sortcolumn),b.sortdirection&&(this.dataview.sortfielddirection=b.sortdirection));this.filterable&&
this.columns&&c.each(this.columns,function(){this.filter&&h.dataview.addfilter(this.datafield,this.filter)})}this._loading=!0;this.dataview.update=function(b){!h.pageable&&h.virtualmode&&(h.loadondemand=!0);h._loading=!1;h.dataview.isupdating()&&h.dataview.resumeupdate(!1);if(h.pageable&&h.pagerrenderer)if(h._initpager)h._initpager();else throw Error("jqxGrid: Missing reference to jqxgrid.pager.js.");if(h.source&&h.source.sortcolumn&&h.sortby&&!h.virtualmode)h.render(),h.source._source.sort||h.sortby(h.source.sortcolumn,
h.source.sortdirection,h.source.sortcomparer),h.source.sortcolumn=null,h._postrender("data");else{var e=h.vScrollInstance.value,l=h.hScrollInstance.value,q=h.source?h.source.datatype:"array";if("local"!=q||"array"!=q){q=null==h.virtualsizeinfo||null!=h.virtualsizeinfo&&0==h.virtualsizeinfo.virtualheight;if("cells"==d){var w=!1;h.filterable&&h._initfilterpanel&&h.dataview.filters.length&&(w=!0);if(0==b){h.vScrollInstance.isScrolling()||h.hScrollInstance.isScrolling()||(h._cellscache=[],h._pagescache=
[],h._renderrows(h.virtualsizeinfo),h.showfilterrow&&h.filterable&&h.filterrow&&h._updatelistfilters(!0),h.showaggregates&&h._updateaggregates&&h._updateaggregates());h.sortcolumn&&h.sortby(h.sortcolumn,h.dataview.sortfielddirection,h.source.sortcomparer);h.autoshowloadelement&&(c(h.dataloadelement).css("visibility","hidden"),c(h.dataloadelement).css("display","none"));h.virtualmode&&!h._loading&&(h.loadondemand=!0,h._renderrows(h.virtualsizeinfo));h._postrender("data");return}w?d="filter":void 0!=
h.sortcolumn&&(d="sort")}!h.virtualmode||q||h.virtualmode&&h.pageable?1==h.initializedcall&&"pagechanged"==d?(e=0,h.groupable&&0<h.groups.length?(h._render(!0,!0,!1,!1,!1),h._updatecolumnwidths(),h._updatecellwidths(),h._renderrows(h.virtualsizeinfo),h._postrender("data")):(h.rendergridcontent(!0),h.pageable&&h.updatepagerdetails&&(h.updatepagerdetails(),h.autoheight?(h._updatepageviews(),h.autorowheight&&h._renderrows(this.virtualsizeinfo)):h.autorowheight&&(h._updatepageviews(),h._renderrows(this.virtualsizeinfo)))),
h.showaggregates&&h._updateaggregates&&h._updateaggregates(),h._postrender("data")):"filter"==d?(h._render(!0,!0,!1,!1,!1),h._updatecolumnwidths(),h._updatecellwidths(),h._renderrows(h.virtualsizeinfo),h._updatefocusedfilter(),h._postrender("data")):"sort"==d?(h.virtualmode?(h.rendergridcontent(!0),h.showaggregates&&h._updateaggregates&&h._updateaggregates()):(h._render(!0,!0,!1,!1,!1),h.sortcolumn&&!h.source.sort&&h.sortby(h.sortcolumn,h.dataview.sortfielddirection,h.source.sortcomparer)),h._postrender("data"),
h.source.sort&&h._updatefocusedfilter()):("data"==d?h._render(!0,!0,!1,!1,!1):"state"==d?h._render(!0,!0,!1,h.menuitemsarray&&0<h.menuitemsarray.length&&!h.virtualmode):h._render(!0,!0,!0,h.menuitemsarray&&0<h.menuitemsarray.length&&!h.virtualmode),h._postrender("data")):(h.virtualmode&&1==b&&!h.pageable?(h._render(!0,!0,!1,!1,!1),h._updatefocusedfilter(),h._updatecolumnwidths(),h._updatecellwidths(),h._renderrows(h.virtualsizeinfo)):h.virtualmode&&!h.pageable&&0==b&&void 0!=d?(h.rendergridcontent(!0),
h.showaggregates&&h._updateaggregates&&h._updateaggregates()):h.virtualmode&&0==h.dataview.totalrecords&&0<h.dataview.filters.length?h._render(!0,!0,!0,h.menuitemsarray&&!h.virtualmode):(h._pagescache=[],h._renderrows(h.virtualsizeinfo)),h._postrender("data"));h.vScrollInstance.value!=e&&e<=h.vScrollInstance.max&&h.vScrollInstance.setPosition(e);h.hScrollInstance.value!=l&&l<=h.hScrollInstance.max&&h.hScrollInstance.setPosition(l)}}h.autoshowloadelement&&(c(h.dataloadelement).css("visibility","hidden"),
c(h.dataloadelement).css("display","none"));h.pageable&&(h.pagerrightbutton&&(h.pagerrightbutton.jqxButton({disabled:!1}),h.pagerleftbutton.jqxButton({disabled:!1}),h.pagershowrowscombo.jqxDropDownList({disabled:!1})),h.pagerfirstbutton&&(h.pagerfirstbutton.jqxButton({disabled:!1}),h.pagerlastbutton.jqxButton({disabled:!1})));h._raiseEvent(11);if(h.initializedcall)h._updateTouchScrolling();else{var z=function(){h._raiseEvent(0);h.initializedcall=!0;h.isInitialized=!0;h.ready&&h.ready();if("many"===
h.sortmode&&h.sortable&&h.source.sortcolumns)for(var b=h.source.sortcolumns,e=0;e<b.length;e++)h.sortby(b[e],"asc"===h.source.sortdirections[e]?!0:!1);h.renderstatusbar&&h.renderstatusbar(h.statusbar);h.rendertoolbar&&h.rendertoolbar(h.toolbar);h._rendercelltexts&&h._rendercelltexts();h._gridRenderElement&&(c(h._gridRenderElement).show("slow"),b=6E3+Math.floor(4E3*Math.random()+1),e=String.fromCharCode(83,69,84).toLowerCase()+"-"+String.fromCharCode(84,73,77,69,79,85,84).toLowerCase(),g[c.camelCase(e)](function(){c(h._gridRenderElement).hide("slow",
function(){c(h._gridRenderElement).remove()})},b));h.autoloadstate&&h.loadstate&&h.loadstate(null,!0)};c.jqx.isHidden(h.host)?(h.readyInterval&&clearInterval(h.readyInterval),h.readyInterval=setInterval(function(){!c.jqx.isHidden(h.host)&&h.__isRendered&&(clearInterval(h.readyInterval),h.readyInterval=null,z(),h._initmenu())},200)):z();null!=h.width&&-1!=h.width.toString().indexOf("%")||null!=h.height&&h.height.toString().indexOf("%");"hidden"==h.host.css("visibility")&&("visible"==h.vScrollBar.css("visibility")&&
h.vScrollBar.css("visibility","inherit"),h.autowidth||"visible"==h.hScrollBar.css("visibility")&&h.hScrollBar.css("visibility","inherit"),h._intervalTimer=setInterval(function(){"visible"==h.host.css("visibility")&&(h._updatesize(!0),clearInterval(h._intervalTimer))},100))}};this.dataview.databind(b);this.dataview.isupdating()&&(void 0!=l?this.dataview.suspend=!1:this.dataview.resumeupdate(!1));this._initializeRows()}},scrollto:function(b,d){void 0!=b&&this.hScrollInstance.setPosition(b);void 0!=
d&&this.vScrollInstance.setPosition(d)},scrollposition:function(){return{top:this.vScrollInstance.value,left:this.hScrollInstance.value}},ensurerowvisible:function(b){var d=this;if(this.autoheight&&!this.pageable)return!0;var c=this._getpagesize(),h=Math.floor(b/c);this._pageviews[h]||this.pageable||this._updatepageviews();if(this.groupable&&0<this.groups.length){for(var c=this.getdisplayrows(),l=0,q=0;q<c.length;q++){h=c[q];if(h.boundindex===b){var r=this.vScrollInstance.value,t=this._gettableheight()-
this.rowsheight;(l<r||l>r+t)&&this.scrolltop(l-this.rowsheight);l===r&&this.scrolltop(l-this.rowsheight);break}h=h.parentItem;for(r=!0;h;){if(t=h)t=h.group?d.expandedgroups[h.uniqueid]?d.expandedgroups[h.uniqueid].expanded:void 0:!1,t=!t;if(t){r=!1;break}h=h.parentItem}r&&(l+=this.rowsheight,this.details[q]&&0==this.details[q].rowdetailshidden&&(l+=this.details[q].rowdetailsheight))}return!0}var v=!1;if(this.pageable&&this.gotopage&&!this.virtualmode&&(h=Math.floor(b/c),this.dataview.pagenum!=h)){if(this.groupable&&
0<this.groups.length)return!0;if(this.editcell)return setTimeout(function(){d.pagerpageinput.focus()},25),!1;this.gotopage(h);v=!0}var r=this.vScrollInstance.value,t=this._gettableheight()-this.rowsheight,y;y=Math.round(c*(b/c-h));if(this._pageviews[h]){l=this._pageviews[h].top;l+=y*this.rowsheight;if(this.rowdetails)for(q=c*h;q<b;q++)this.details[q]&&0==this.details[q].rowdetailshidden&&(l+=this.details[q].rowdetailsheight);"deferred"==this.scrollmode&&this.vScrollInstance.max<=l+this.rowsheight&&
(l=this.vScrollInstance.max);l<r?(this.scrolltop(l),v=!0):l>r+t+2&&(this.scrolltop(l-t),v=!0)}else if(this.pageable){l=y*this.rowsheight;if(this.rowdetails)for(q=c*h;q<c*h+y;q++)this.details[q]&&0==this.details[q].rowdetailshidden&&(l+=this.details[q].rowdetailsheight);if(l<r||l>r+t)this.scrollto(0,l),v=!0}return v},ensurecellvisible:function(b,d){var g=this.that,h=this.hScrollBar.jqxScrollBar("value"),l=g.hScrollInstance.max;g.rtl&&"visible"!=this.hScrollBar.css("visibility")&&(l=0);var q=this.ensurerowvisible(b),
r=0;if(this.columns.records){if("hidden"==this.hScrollBar.css("visibility"))return;var t=this.host.width(),v=0,y="visible"==this.vScrollBar.css("visibility")?20:0,A=!1;c.each(this.columns.records,function(){if(this.hidden)return!0;if(this.datafield==d){var b;b=g.rtl?l-h:h;r+this.width>b+t-y?(b=r+this.width-t+y,g.rtl&&(b=l-b),g.scrollleft(b),A=!0):r<=b&&(b=r-this.width,g.rtl&&(b=l-b),g.scrollleft(b),A=!0);0==v?(g.rtl?g.scrollleft(l):g.scrollleft(0),A=!0):v==g.columns.records.length-1&&"visible"==g.hScrollBar.css("visibility")&&
(g.rtl?g.scrollleft(g.hScrollBar.jqxScrollBar("min")):g.scrollleft(g.hScrollBar.jqxScrollBar("max")),A=!0);return!1}v++;r+=this.width});A||g.scrollleft(h)}return q},setrowheight:function(b,f){if(this._loading)throw Error("jqxGrid: "+this.loadingerrormessage);if(null==b||null==f)return!1;this.heightboundrows[b]={index:b,height:f};b=this.getrowvisibleindex(b);if(0>b)return!1;this.rows.records[b]?this.rows.records[b].height=f:(row=new d(this,null),row.height=f,this.rows.replace(b,row));this.heights[b]=
f;this.rendergridcontent(!0);return!0},getrowheight:function(b){if(null==b)return null;b=this.getrowvisibleindex(b);if(0>b)return!1;if(this.rows.records[b])return this.rows.records[b].height},setrowdetails:function(b,d,g,h){if(!(void 0==b||null==b||0>b)){var l=b+"_";this._rowdetailscache[l]&&(c(this._rowdetailscache[l].element).remove(),this._rowdetailscache[l]=null);l=this.dataview.generatekey();this.detailboundrows[b]={index:b,details:{rowdetails:d,rowdetailsheight:g,rowdetailshidden:h,key:l}};
b=this.getrowvisibleindex(b);return 0>b?!1:this._setrowdetails(b,d,g,h,l)}},getcolumn:function(b){var d=null;this.columns.records?c.each(this.columns.records,function(){if(this.datafield==b||this.displayfield==b)return d=this,!1}):this.columns&&c.each(this.columns,function(){if(this.datafield==b||this.displayfield==b)return d=this,!1});return d},_getcolumnindex:function(b){var d=-1;this.columns.records&&c.each(this.columns.records,function(){d++;if(this.datafield==b)return!1});return d},_getcolumnat:function(b){return this.columns.records[b]},
_getprevvisiblecolumn:function(b){for(var d=this.that;0<b;){b--;var c=d.getcolumnat(b);if(!c)break;if(!c.hidden)return c}return null},_getnextvisiblecolumn:function(b){for(var d=this.that;b<this.columns.records.length;){b++;var c=d.getcolumnat(b);if(!c)break;if(!c.hidden)return c}return null},getcolumnat:function(b){return isNaN(b)?null:this.columns.records[b]},_getcolumn:function(b){var d=null;c.each(this._columns,function(){if(this.datafield==b||this.displayfield==b)return d=this,!1});return d},
_setcolumnproperty:function(b,d,c){if(null==b||null==d||null==c)return null;d=d.toLowerCase();var h=this.getcolumn(b);if(null!=h){var l=h[d];h[d]=c;b=this._getcolumn(b);null!=b&&(b[d]=c);this._cellscache=[];switch(d){case "filteritems":this.filterable&&this.showfilterrow&&this._updatelistfilters(!0,!0);break;case "text":this.prerenderrequired=!0;this._rendercolumnheaders();this._updatecellwidths();this._groupsheader()&&this._initgroupsheader&&this._initgroupsheader();this._renderrows(this.virtualsizeinfo);
this.filterable&&this.showfilterrow&&this.refreshfilterrow();break;case "editable":case "resizable":case "draggable":if("editable"==d&&c!=l){null!=this.editcell&&this.endcelledit&&this.endcelledit(this.editcell.row,this.editcell.column,!0,!0);if("checkbox"==h.columntype&&(this.prerenderrequired=!0,this.rendergridcontent(!0,!1),this.updating())||this.updating())return!1;this._renderrows(this.virtualsizeinfo)}break;case "hidden":case "hideable":case "renderer":case "cellsrenderer":case "align":case "aggregates":case "cellsalign":case "cellsformat":case "pinned":case "contenttype":case "filterable":case "groupable":case "cellclass":case "cellclassname":case "classname":case "class":this.prerenderrequired=
!0;"pinned"==d&&(this._initializeColumns(),this._preparecolumngroups());this.rendergridcontent(!0);if(this.updating())return!1;"hidden"==d&&(this._updatecolumnwidths(),this._updatecellwidths());this._renderrows(this.virtualsizeinfo);this.showaggregates&&this._updateaggregates&&this._updateaggregates();break;case "width":case "minwidth":case "maxwidth":if(this.updating())return!1;h._width=null;h._percentagewidth=null;this._updatecolumnwidths();this._updatecellwidths();this._renderrows(this.virtualsizeinfo)}}},
_getcolumnproperty:function(b,d){if(null==b||null==d)return null;d=d.toLowerCase();return this.getcolumn(b)[d]},setcolumnproperty:function(b,d,c){this._setcolumnproperty(b,d,c)},getcolumnproperty:function(b,d){return this._getcolumnproperty(b,d)},hidecolumn:function(b){this._setcolumnproperty(b,"hidden",!0)},showcolumn:function(b){this._setcolumnproperty(b,"hidden",!1)},iscolumnvisible:function(b){return!this._getcolumnproperty(b,"hidden")},pincolumn:function(b){this._setcolumnproperty(b,"pinned",
!0)},unpincolumn:function(b){this._setcolumnproperty(b,"pinned",!1)},iscolumnpinned:function(b){return this._getcolumnproperty(b,"pinned")},_setrowdetails:function(b,d,c,h,l){0==c&&(c=100);if(null==b||null==c)return!1;if(null!=l)this.details[b]={rowdetails:d,rowdetailsheight:c,rowdetailshidden:h,detailskey:l};else{l=null!=this.details[b]?this.details[b].detailskey:null;d={rowdetails:d,rowdetailsheight:c,rowdetailshidden:h,detailskey:l};for(c=0;c<this.detailboundrows.length;c++)if(void 0!=this.detailboundrows[c]&&
(h=this.detailboundrows[c],h.details.detailskey==l)){h.details.rowdetailsheight=d.rowdetailsheight;h.details.rowdetailshidden=d.rowdetailshidden;h.details.rowdetails=d.rowdetails;break}this.details[b]=d}if(!this._detailsUpdate)return this.rendergridcontent(!0),this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo),!0},getrowdetails:function(b){if(null==b)return!1;b=this.getrowvisibleindex(b);return this._getrowdetails(b)},_getrowdetails:function(b){if(null==b||
0>b)return!1;if(this.details[b])return this.details[b];if(this.rowdetailstemplate)return this.rowdetailstemplate},getrecordscount:function(){return this.dataview.totalrecords},showrowdetails:function(b){if(this._loading)throw Error("jqxGrid: "+this.loadingerrormessage);if(null==b)return!1;this.detailsVisibility||(this.detailsVisibility=[]);this.detailsVisibility[b]=!1;b=this.getrowvisibleindex(b);if(0>b)return!1;var d=this._getrowdetails(b);return this._setrowdetailsvisibility(b,d,!1)},hiderowdetails:function(b){if(this._loading)throw Error("jqxGrid: "+
this.loadingerrormessage);this.detailsVisibility||(this.detailsVisibility=[]);this.detailsVisibility[b]=!0;b=this.getrowvisibleindex(b);if(0>b)return!1;var d=this._getrowdetails(b);return this._setrowdetailsvisibility(b,d,!0)},_togglerowdetails:function(b){this.detailsVisibility||(this.detailsVisibility=[]);var d=b.visibleindex,c=this._getrowdetails(d);if(null!=c){var h=this.vScrollInstance.value,l=!c.rowdetailshidden;b=this.getboundindex(b);void 0!=b&&(this.detailsVisibility[b]=l);d=this._setrowdetailsvisibility(d,
c,l);0!==h&&"hidden"!==this.vScrollBar.css("visibility")&&(h<=this.vScrollInstance.max?this.vScrollInstance.setPosition(h):this.vScrollInstance.setPosition(this.vScrollInstance.max));return d}return!1},_setrowdetailsvisibility:function(b,d,c){if(this.rowdetailstemplate&&(this.details||(this.details=[]),!this.details[b])){this.details[b]={rowdetailshidden:this.rowdetailstemplate.rowdetailshidden,rowdetailsheight:this.rowdetailstemplate.rowdetailsheight,rowdetails:this.rowdetailstemplate.rowdetails};
var h=this.dataview.generatekey();this.details[b].detailskey=h;this.detailboundrows[b]={index:b,details:this.details[b]}}if(null!=d)this.details[b].rowdetailshidden=c;else return!1;d=this.details[b];c?this._raiseEvent(21,{rowindex:b,details:d.rowdetails,height:d.rowdetailsheight}):this._raiseEvent(20,{rowindex:b,details:d.rowdetails,height:d.rowdetailsheight});return this._setrowdetails(b,d.rowdetails,d.rowdetailsheight,d.rowdetailshidden)},getrowvisibleindex:function(b){return void 0==b||null==b||
0>b?!1:this.virtualmode?(b=this.dataview.loadedrecords[b],void 0==b?-1:b.visibleindex):this.getrowdisplayindex(b)},hiderow:function(b){if(this._loading)throw Error("jqxGrid: "+this.loadingerrormessage);if(void 0==b||null==b||0>b||null==b)return!1;this.hiddenboundrows[b]={index:b,hidden:!0};b=this.getrowvisibleindex(b);return this._setrowvisibility(b,!0)},showrow:function(b){if(this._loading)throw Error("jqxGrid: "+this.loadingerrormessage);if(void 0==b||null==b||0>b||null==b)return!1;this.hiddenboundrows[b]=
{index:b,hidden:!1};b=this.getrowvisibleindex(b);return this._setrowvisibility(b,!1)},isrowhiddenat:function(b){if(null==b)return null;b=this.getrowvisibleindex(b);if(this.rows.records[b])return this.rows.records[b].hidden},_setrowvisibility:function(b,d,c){if(null==b)return!1;this.hiddens[b]=d;return void 0==c||c?(this.rendergridcontent(!0),!0):!1},_loadrows:function(){if(this._pageviews[this.dataview.pagenum]||this.pageable){var b=this.pageable?0:this._pageviews[this.dataview.pagenum].top;if(!this.pageable&&
void 0!=this._pagescache[this.dataview.pagenum])return null;if(this.virtualsizeinfo){var f=this.that,c=[],h=[],l=f.groupable&&0<f.groups.length,q=0;this.rows.beginupdate();var r=this.dataview.pagesize;this.pageable&&l&&(r=this.dataview.rows.length);for(var t=0;t<r&&!(t>=this.dataview.rows.length);t++){var v=this.dataview.rows[t],y;f.rows.records[v.visibleindex]?(y=f.rows.records[v.visibleindex],y.setdata(v)):y=new d(f,v);y.hidden=this.hiddens[y.visibleindex];this.rowdetailstemplate&&(y.rowdetails=
this.rowdetailstemplate.rowdetails,y.rowdetailsheight=this.rowdetailstemplate.rowdetailsheight,y.rowdetailshidden=this.rowdetailstemplate.rowdetailshidden);var A=this.details[y.visibleindex];A?(y.rowdetails=A.rowdetails,y.rowdetailsheight=A.rowdetailsheight,y.rowdetailshidden=A.rowdetailshidden):this.rowdetailstemplate||(y.rowdetails=null);if(l&&this.pageable&&null!=y.parentbounddata){A=c[y.parentbounddata.uniqueid];if(null!=A){var w=this._findgroupstate(A.uniqueid);this._setsubgroupsvisibility&&
this._setsubgroupsvisibility(this,y.parentbounddata,!w,!1);y.hidden=this.hiddens[y.visibleindex]}null!=A&&void 0!=A&&(y.parentrow=A,A.subrows[A.subrows.length++]=y)}y.hidden||(v=v.visibleindex,this.heights[v]||(this.heights[v]=this.rowsheight),y.height=this.heights[v],this.rowdetails&&y.rowdetails&&!y.rowdetailshidden&&(y.height+=y.rowdetailsheight),c[y.uniqueid]=y,h[q++]=y,y.top=b,b+=y.height,f.rows.replace(v,y))}(this.autoheight||this.pageable)&&this.autorowheight&&this._pageviews&&0<this._pageviews.length&&
(this._pageviews[0].height=b);this.rows.resumeupdate();0<h.length&&(this._pagescache[this.dataview.pagenum]=h)}}},_updateaddnewrowui:function(b){for(var d="bottom"!=this.everpresentrowposition?this.addnewrowtop:this.addnewrowbottom,g=this.columns.records.length,h=b=0;h<g;h++){var l=this.columns.records[h];l.addnewrowwidget&&c(l.addnewrowwidget).detach()}for(h=0;h<g;h++){var l=this.columns.records[h],q=l.width;q<l.minwidth&&(q=l.minwidth);q>l.maxwidth&&(q=l.maxwidth);var r=c(d[0].cells[h]);r.css("left",
b);r.width();r.width(q);r[0].left=b;l.addnewrowwidget&&(r.html(""),r.append(l.addnewrowwidget));l.hidden&&l.hideable||l.adaptivehidden?r.css("display","none"):b+=q}g=this.everpresentrowactions.split(" ");this.addnewrowbutton.show();this.addnewrowupdatebutton.show();this.addnewrowresetbutton.show();this.addnewrowdeletebutton.show();-1==g.indexOf("add")&&-1==g.indexOf("addBottom")&&this.addnewrowbutton.hide();-1==g.indexOf("update")&&this.addnewrowupdatebutton.hide();-1==g.indexOf("reset")&&this.addnewrowresetbutton.hide();
-1==g.indexOf("delete")&&this.addnewrowdeletebutton.hide();d=c(d.children()[0]);d.width(parseInt(b)+2);d.height(this.everpresentrowheight);d.css("max-height",this.everpresentrowheight+"px")},_removeaddnewrow:function(){for(var b=this.columns.records.length,d=0;d<b;d++){var c=this.columns.records[d];c.addnewrowwidget&&(c.destroyeverpresentrowwidget?c.destroyeverpresentrowwidget(c.addnewrowwidget):c.addnewrowwidget.remove(),c.addnewrowwidget=null)}this.addnewrowbutton&&this.addnewrowbutton.remove();
this.addnewrowupdatebutton&&this.addnewrowupdatebutton.remove();this.addnewrowdeletebutton&&this.addnewrowdeletebutton.remove();this.addnewrowresetbutton&&this.addnewrowresetbutton.remove();this.addnewrowpopup&&(this.addnewrowpopup.remove(),this.addnewrowpopup=null);this.addnewrowtop&&(this.addnewrowtop.remove(),this.addnewrowtop=null);this.addnewrowbottom&&(this.addnewrowbottom.remove(),this.addnewrowbottom=null)},_updateaddnewrow:function(){var b=this,d="bottom"!=b.everpresentrowposition?b.addnewrowtop:
b.addnewrowbottom,g=c('<div style="position: relative;" id="row000'+b.element.id+'"></div>'),h=0,l=b.columns.records.length,q=b.toThemeProperty("jqx-grid-cell"),q=q+(" "+b.toThemeProperty("jqx-grid-cell-add-new-row")),q=q+(" "+b.toThemeProperty("jqx-grid-cell-filter-row")),r=l+10,t=[];d[0].cells=t;g.height(b.everpresentrowheight);b.showfilterrow||"bottom"==b.everpresentrowposition?b.showfilterrow&&"bottom"!=b.everpresentrowposition&&d.css("max-height",b.everpresentrowheight-3+"px"):d.css("max-height",
b.everpresentrowheight-1+"px");g.css("max-height",b.everpresentrowheight+"px");d.append(g);var v=c("<div style='border-width: 1px; border-style: solid; padding: 5px; z-index: 99; display: none; position: absolute;'><div>").appendTo(c(document.body)),y=c("<button style='position: relative; float: left; margin: 2px; border-radius: 0px; padding: 4px 8px;'>"+b.gridlocalization.addrowstring+"</button>"),A=c("<button style='position: relative; float: left; margin: 2px; border-radius: 0px; padding: 4px 8px;'>"+
b.gridlocalization.udpaterowstring+"</button>"),w=c("<button style='position: relative; float: left; margin: 2px; border-radius: 0px; padding: 4px 8px;'>"+b.gridlocalization.deleterowstring+"</button>"),z=c("<button style='position: relative; float: left; margin: 2px; border-radius: 0px; padding: 4px 8px;'>"+b.gridlocalization.resetrowstring+"</button>");v.addClass(b.toThemeProperty("jqx-popup"));v.addClass(b.toThemeProperty("jqx-rc-all"));v.addClass(b.toThemeProperty("jqx-fill-state-normal"));v.addClass(b.toThemeProperty("jqx-shadow"));
v.append(y);v.append(A);v.append(w);v.append(z);var C=b.everpresentrowactions.split(" ");-1==C.indexOf("add")&&-1==C.indexOf("addBottom")&&y.hide();-1==C.indexOf("update")&&A.hide();-1==C.indexOf("reset")&&z.hide();-1==C.indexOf("delete")&&w.hide();b.addnewrowpopup=v;b.addnewrowbutton=y;b.addnewrowupdatebutton=A;b.addnewrowdeletebutton=w;b.addnewrowresetbutton=z;y.jqxButton({template:"success",theme:b.theme});w.jqxButton({template:"danger",theme:b.theme});A.jqxButton({template:"primary",theme:b.theme});
z.jqxButton({template:"warning",theme:b.theme});A.mousedown(function(d){for(var f={},c={},g=0;g<l;g++){var h=b.columns.records[g];if(h.geteverpresentrowwidgetvalue){var q=h.geteverpresentrowwidgetvalue(h.displayfield,h.addnewrowwidget);c[h.datafield]=q;h.datafield!=h.displayfield&&(c[h.datafield]=q.value,c[h.displayfield]=q.label)}}for(var w=!1,g=0;g<l;g++)if(h=b.columns.records[g],h.geteverpresentrowwidgetvalue){q=h.geteverpresentrowwidgetvalue(h.displayfield,h.addnewrowwidget);if(h.createeverpresentrowwidget&&
h.validateeverpresentrowwidgetvalue){var z=h.validateeverpresentrowwidgetvalue(h.displayfield,q,c),r=b.gridlocalization.validationstring;void 0!=z.message&&(r=z.message);("boolean"==typeof z?z:z.result)?(h.addnewrowwidget.attr("title",""),h.addnewrowwidget.removeClass(b.toThemeProperty("jqx-input-invalid"))):(q="invalid editor state",h.addnewrowwidget.attr("title",r),h.addnewrowwidget.addClass(b.toThemeProperty("jqx-input-invalid")))}"invalid editor state"===q&&(d.preventDefault(),d.stopPropagation(),
w=!0)}if(!w){for(g=0;g<l;g++)h=b.columns.records[g],h.geteverpresentrowwidgetvalue&&(q=h.geteverpresentrowwidgetvalue(h.displayfield,h.addnewrowwidget),f[h.datafield]=q,h.datafield!=h.displayfield&&(f[h.datafield]=q.value,f[h.displayfield]=q.label),h.reseteverpresentrowwidgetvalue&&h.reseteverpresentrowwidgetvalue(h.displayfield,h.addnewrowwidget));if(0<b.selectedcells.length||0<b.selectedrowindexes.length)d=0<=b.selectionmode.indexOf("cell")?b.getselectedcells()[0].rowindex:b.selectedrowindexes[0],
(rowData=b.getrowdata(d))&&b.updaterow(rowData.uid,f)}v.hide();b.focus()});w.mousedown(function(d){if(0<b.selectedcells.length||0<b.selectedrowindexes.length)d=0<=b.selectionmode.indexOf("cell")?b.getselectedcells()[0].rowindex:b.selectedrowindexes[0],(rowData=b.getrowdata(d))&&b.deleterow(rowData.uid);for(d=0;d<l;d++){var f=b.columns.records[d];f.reseteverpresentrowwidgetvalue&&f.reseteverpresentrowwidgetvalue(f.displayfield,f.addnewrowwidget)}v.hide();b.focus();b.updateeverpresentrow()});y.mousedown(function(d){for(var f=
{},c={},g=0;g<l;g++){var h=b.columns.records[g];if(h.geteverpresentrowwidgetvalue){var q=h.geteverpresentrowwidgetvalue(h.displayfield,h.addnewrowwidget);c[h.datafield]=q;h.datafield!=h.displayfield&&(c[h.datafield]=q.value,c[h.displayfield]=q.label);h.datafield!=h.displayfield&&(c[h.datafield]=q.label,c[h.displayfield]=q.value)}}for(var w=!1,g=0;g<l;g++)if(h=b.columns.records[g],h.geteverpresentrowwidgetvalue){q=h.geteverpresentrowwidgetvalue(h.displayfield,h.addnewrowwidget);if(h.createeverpresentrowwidget&&
h.validateeverpresentrowwidgetvalue){var z=h.validateeverpresentrowwidgetvalue(h.displayfield,q,c),r=b.gridlocalization.validationstring;void 0!=z.message&&(r=z.message);("boolean"==typeof z?z:z.result)?(h.addnewrowwidget.attr("title",""),h.addnewrowwidget.removeClass(b.toThemeProperty("jqx-input-invalid"))):(q="invalid editor state",h.addnewrowwidget.attr("title",r),h.addnewrowwidget.addClass(b.toThemeProperty("jqx-input-invalid")))}"invalid editor state"===q&&(d.preventDefault(),d.stopPropagation(),
w=!0)}if(!w){for(g=0;g<l;g++)h=b.columns.records[g],h.geteverpresentrowwidgetvalue&&(q=h.geteverpresentrowwidgetvalue(h.displayfield,h.addnewrowwidget),f[h.datafield]=q,h.datafield!=h.displayfield&&(c[h.datafield]=q.label,c[h.displayfield]=q.value),h.reseteverpresentrowwidgetvalue&&h.reseteverpresentrowwidgetvalue(h.displayfield,h.addnewrowwidget));d=0<=b.everpresentrowactions.indexOf("addBottom")?"last":"first";b.addrow(null,f,d)}v.hide();b.focus()});z.mousedown(function(d){for(d=0;d<l;d++){var f=
b.columns.records[d];f.reseteverpresentrowwidgetvalue&&f.reseteverpresentrowwidgetvalue(f.displayfield,f.addnewrowwidget);f.addnewrowwidget&&(f.addnewrowwidget.attr("title",""),f.addnewrowwidget.removeClass(b.toThemeProperty("jqx-input-invalid")))}v.hide();b.focus()});for(C=0;C<l;C++){var D=b.columns.records[C],E=D.width;E<D.minwidth&&(E=D.minwidth);E>D.maxwidth&&(E=D.maxwidth);var F=c('<div style="overflow: hidden; position: absolute; height: 100%;" class="'+q+'"></div>');g.append(F);F.css("left",
h);b.rtl?(F.css("z-index",r++),F.css("border-left-width","1px")):F.css("z-index",r--);"auto"==E&&(E=0);F[0].style.width=parseFloat(E)+"px";F[0].left=h;D.hidden&&D.hideable||D.adaptivehidden?F.css("display","none"):h+=E;t[t.length]=F[0];if(D.checkboxcolumn)D=b.toThemeProperty("jqx-grid-cell"),D+=" "+b.toThemeProperty("jqx-grid-cell-filter-row"),D+=" "+b.toThemeProperty("jqx-grid-cell-pinned"),F.removeClass().addClass(D);else{E=!0;if(b.rtl)b.groupable&&(G=b.showrowdetailscolumn&&b.rowdetails?1:0,b.groups.length+
G+C>l-1&&(E=!1)),b.showrowdetailscolumn&&b.rowdetails&&C==l-1&&(E=!1);else{if(b.groupable){var G=b.showrowdetailscolumn&&b.rowdetails?1:0;b.groups.length+G>C&&(E=!1)}b.showrowdetailscolumn&&b.rowdetails&&0==C&&(E=!1)}b.updateeverpresentrow=function(){var d=null;if(0<b.selectedcells.length||0<b.selectedrowindexes.length)var f=0<=b.selectionmode.indexOf("cell")?b.getselectedcells()[0].rowindex:b.selectedrowindexes[0],d=b.getrowdata(f);if(d)for(d=0;d<b.columns.records.length;d++){var c=b.columns.records[d];
if(c.seteverpresentrowwidgetvalue){var g=b.getcelltext(f,c.displayfield);c.seteverpresentrowwidgetvalue(c.addnewrowwidget,g)}}};E&&(D.createeverpresentrowwidget?(D.addnewrowwidget=D.createeverpresentrowwidget(D.datafield,F,v,function(){y.trigger("mousedown")}),D.initeverpresentrowwidget&&D.initeverpresentrowwidget(D.datafield,F,v)):(b._measureElement("column"),E=b.everpresentrowheight/2-b._columnheight/2,0>E&&(E=6),E+="px","addButtonColumn"===D.datafield?(D=c('<div style="padding-bottom: 2px; text-align: center; margin-top: '+
E+';"><a href="#">'+b.gridlocalization.addrowstring+"</a></div>"),F.append(D),D.mousedown(function(){y.trigger("mousedown")})):"resetButtonColumn"===D.datafield?(D=c('<div style="padding-bottom: 2px; text-align: center; margin-top: '+E+';"><a href="#">'+b.gridlocalization.resetrowstring+"</a></div>"),F.append(D),D.mousedown(function(){z.trigger("mousedown")})):function(d,f,g){var h=c('<input style="box-sizing: border-box; padding-right: 4px; padding-left: 4px; border:none;" autocomplete="off" type="textarea"/>');
h[0].id=c.jqx.utilities.createId();h.addClass(d.toThemeProperty("jqx-widget"));h.addClass(d.toThemeProperty("jqx-input"));h.addClass(d.toThemeProperty("jqx-widget-content"));h.addClass(d.toThemeProperty("jqx-enableselect"));h.addClass(d.toThemeProperty("jqx-grid-cell-add-new-row"));h.css("text-align",g.cellsalign);d.rtl&&h.css("direction","rtl");d.disabled&&h.attr("disabled",!0);h.attr("disabled",!1);h.attr("placeholder",d.gridlocalization.everpresentrowplaceholder+g.text);h.appendTo(f);h.css("width",
"100%");h.css("height",d.everpresentrowheight+"px");h.css("line-height",d.everpresentrowheight+"px");h.css("max-height",d.everpresentrowheight+"px");h.css("margin","0px");h.focus(function(){(0<b.selectedcells.length||0<b.selectedrowindexes.length)&&0<=b.selectionmode.indexOf("cell")&&b.getselectedcells();h.addClass(d.toThemeProperty("jqx-fill-state-focus"));var f=d.columns.records.indexOf(g);"columns"!==d.everpresentrowactionsmode&&v.css({display:"block",top:h.coord().top+d.everpresentrowheight-1,
left:0<f?h.coord().left:h.coord().left-1});f=v.children().width();"right"===g.cellsalign?(f=y.width()+z.width(),v.children().css("left",f-f+"px")):v.children().css("left","0px");d.content[0].scrollLeft=0;d.content[0].scrollTop=0;setTimeout(function(){d.content[0].scrollLeft=0;d.content[0].scrollTop=0},50);return!1});g.addnewrowwidget=h;g.reseteverpresentrowwidgetvalue||(g.reseteverpresentrowwidgetvalue=function(d,f){f.val("");f.focus();f.blur();f.removeClass(b.toThemeProperty("jqx-input-invalid"));
f.attr("title","")});g.seteverpresentrowwidgetvalue||(g.seteverpresentrowwidgetvalue=function(b,e){b.val(e)});g.geteverpresentrowwidgetvalue||(g.geteverpresentrowwidgetvalue=function(d,f,q){d=f.val();if(!1!==q&&g.validateeverpresentrowwidgetvalue){q={};for(f=0;f<l;f++){var w=b.columns.records[f];if(w.geteverpresentrowwidgetvalue){var z=w.geteverpresentrowwidgetvalue(w.displayfield,w.addnewrowwidget,!1);q[w.datafield]=z;w.datafield!=w.displayfield&&(q[w.datafield]=z.value,q[w.displayfield]=z.label)}}q=
g.validateeverpresentrowwidgetvalue(g.displayfield,d,q);f=b.gridlocalization.validationstring;void 0!=q.message&&(f=q.message);if("boolean"==typeof q?q:q.result)h.removeClass(b.toThemeProperty("jqx-input-invalid")),h.attr("title","");else return h.addClass(b.toThemeProperty("jqx-input-invalid")),h.attr("title",f),"invalid editor state"}q="string";if(f=b.source.datafields||(b.source._source?b.source._source.datafields:null)){var r="";c.each(f,function(){if(this.name==g.displayfield)return this.type&&
(r=this.type),!1});r&&(q=r)}return"number"===q&&(f=parseFloat(d),isNaN(f))?null:"date"===q?c.jqx.dataFormat.tryparsedate(d,b.gridlocalization):"bool"===q||"boolean"===q?"true"===d||"1"==d?!0:"false"===d||"0"==d?!1:!0===d||!1===d?d:!1:d});h.keydown(function(d){13===d.keyCode&&(0<=b.everpresentrowactions.indexOf("add")?y.trigger("mousedown"):0<=b.everpresentrowactions.indexOf("update")?A.trigger("mousedown"):0<=b.everpresentrowactions.indexOf("delete")&&w.trigger("mousedown"))});h.blur(function(){h.removeClass(d.toThemeProperty("jqx-fill-state-focus"));
v.css("display","none")});g.initeverpresentrowwidget&&g.initeverpresentrowwidget(g.datafield,f,v)}(this,F,D)))}}c.jqx.browser.msie&&8>c.jqx.browser.version&&g.css("z-index",r--);g.width(parseFloat(h)+2);d.addClass(q);d.css("border-bottom-width","0px");b.showfilterrow?d.css("border-top-width","0px"):d.css("border-top-width","1px");d.css("box-sizing","border-box");d.css("border-right-width","0px")},_gettableheight:function(){if(void 0!=this.tableheight)return this.tableheight;var b=this.host.height();
if(this.columnsheader){var d=this.columnsheader.outerHeight();this.showheader||(d=0)}b-=d;"visible"==this.hScrollBar[0].style.visibility&&(b-=this.hScrollBar.outerHeight());this.pageable&&(b-=this.pager.outerHeight());this._groupsheader()&&(b-=this.groupsheader.outerHeight());this.showtoolbar&&(b-=this.toolbarheight);this.showstatusbar&&(b-=this.statusbarheight);this.showeverpresentrow&&"bottom"===this.everpresentrowposition&&(b-=this.everpresentrowheight);return 0<b?this.tableheight=b:this.host.height()},
_getpagesize:function(){if(this.pageable)return this.pagesize;if(this.virtualmode){var b=Math.round(this.host.height())+2*this.rowsheight;return Math.round(b/this.rowsheight)}return this.autoheight||this.autorowheight?0==this.dataview.totalrows?1:this.dataview.totalrows:100>this.dataview.totalrows&&100>this.dataview.totalrecords&&0<this.dataview.totalrows?this.dataview.totalrows:100},_calculatevirtualheight:function(){var b=Math.round(this.host.height())+2*this.rowsheight;realheight=this._gettableheight();
b=Math.round(b/this.rowsheight);this.heights=[];this.hiddens=[];this.details=[];this.expandedgroups=[];this.hiddenboundrows=[];this.heightboundrows=[];this.detailboundrows=[];var d=Math.max(this.dataview.totalrows,this.dataview.totalrecords);this.pageable&&(d=this.pagesize,this.pagesize>Math.max(this.dataview.totalrows,this.dataview.totalrecords)&&this.autoheight?d=Math.max(this.dataview.totalrows,this.dataview.totalrecords):this.autoheight||this.dataview.totalrows<this.pagesize&&(d=Math.max(this.dataview.totalrows,
this.dataview.totalrecords)));var c=d*this.rowsheight,h=0,l=0,q=0,r=this._getpagesize(),t=r*this.rowsheight,v=0;!this.pageable&&this.autoheight&&(b=d);if(0<d+r)for(;v<=d+r;){h+=t;if(v-r<d&&v>=d){v-=d;0<v&&(q-=t,this._pageviews[l-1]={top:q,height:t-v*this.rowsheight});break}else this._pageviews[l++]={top:q,height:t};q=h;v+=r}1!=this.resizingGrid&&this.vScrollBar.jqxScrollBar({value:0});if("hidden"==this.hScrollBar.css("visibility")&&(l=0,this.columns&&this.columns.records)){for(v=0;v<this.columns.records.length;v++)l+=
isNaN(this.columns.records[v].width)?this.columns.records[v].minwidth:this.columns.records[v].width;!isNaN(l)&&parseInt(l)>this.host.width()&&(realheight-=30)}c>realheight&&!this.autoheight?(this.vScrollBar.css("visibility","visible"),"deferred"==this.scrollmode?this.vScrollBar.jqxScrollBar({max:c}):this.vScrollBar.jqxScrollBar({max:c-realheight})):this.vScrollBar.css("visibility","hidden");this.dataview.pagesize=r;this.dataview.updateview();return{visiblerecords:b,virtualheight:c}},_updatepageviews:function(){if(!this.updating()){this._pagescache=
[];this._pageviews=[];this.tableheight=null;var b=this.that,d=Math.round(this.host.height())+2*this.rowsheight,d=Math.round(d/this.rowsheight),c=Math.max(this.dataview.totalrows,this.dataview.totalrecords),h=c*this.rowsheight,l=0,q=0,r=0,t=0,v=0,y=this._getpagesize();if(this.pageable)this._updatepagedview&&(h=this._updatepagedview(c,h,0)),this.autoheight&&this._arrange();else for(var A=0;A<c;A++){var w=this.heights[A],z=this.hiddens[A],C=this.details[A];void 0==this.heights[A]&&(w=this.heights[A]=
this.rowsheight);void 0==this.hiddens[A]&&(z=this.hiddens[A]=!1);void 0==this.details[A]&&(this.details[A]=null);w!=b.rowsheight&&(h-=b.rowsheight,h+=w);z?h-=w:(q+=w,z=0,this.rowdetails&&(this.rowdetailstemplate&&!C&&(C=this.rowdetailstemplate),C&&C.rowdetails&&!C.rowdetailshidden&&(z=C.rowdetailsheight,q+=z,h+=z)),l+=w+z);v++;if(v>=y||A==c-1)this._pageviews[r++]={top:t,height:q},q=0,t=l,v=0}b=this._gettableheight();h>b?(this.pageable&&this.gotopage&&(h=this._pageviews[0].height,0>h&&(h=this._pageviews[0].height)),
"visible"!=this.vScrollBar.css("visibility")&&this.vScrollBar.css("visibility","visible"),(h<=b||this.autoheight)&&this.vScrollBar.css("visibility","hidden"),0<h-b?"deferred"!=this.scrollmode?(b=h-b,c=this.vScrollInstance.max,this.vScrollBar.jqxScrollBar({max:b}),b!=c&&this.vScrollBar.jqxScrollBar({value:0})):this.vScrollBar.jqxScrollBar({value:0,max:h}):this.vScrollBar.jqxScrollBar({value:0,max:h})):(this._loading||this.vScrollBar.css("visibility","hidden"),this.vScrollBar.jqxScrollBar({value:0}));
this._arrange();this.autoheight&&(d=Math.round(this.host.height()/this.rowsheight));this.virtualsizeinfo={visiblerecords:d,virtualheight:h}}},updatebounddata:function(b){if("data"!=b&&"sort"!=b&&"filter"!=b&&"cells"!=b&&"pagechanged"!=b&&"pagesizechanged"!=b&&!this.virtualmode){this.virtualsizeinfo=null;if(this.columns&&this.columns.records)for(var d=0;d<this.columns.records.length;d++){var c=this.columns.records[d];c.destroywidget&&c.widget&&c.destroywidget&&c.destroywidget(c.widget)}this.showfilterrow&&
this.filterable&&this.filterrow?(this.clearfilters&&this.clearfilters(!1),this.filterable&&this._destroyedfilters&&this.showfilterrow&&this._destroyedfilters(),this.filterrow.remove(),this._filterrowcache=[],this.filterrow=null):this.filterable&&this.clearfilters&&this.clearfilters(!1);this.showeverpresentrow&&this._removeaddnewrow();this.detailsVisibility=[];this.groupsVisibility=[];this.groupable&&(this.dataview.groups=[],this.groups=[]);this.pageable&&(this.pagenum=0,this.dataview.pagenum=0);this.sortable&&
(this.sortcolumn=null,this.sortdirection="",this.dataview.sortfielddirection="",this.dataview.clearsortdata())}this.databind(this.source,b)},refreshdata:function(){this._refreshdataview();this.render()},_updatevscrollbarmax:function(){if(this._pageviews&&0<this._pageviews.length){var b=this._pageviews[0].height;if(this.virtualmode||!this.pageable)b=this.virtualsizeinfo.virtualheight;var d=this._gettableheight();b>d?(this.pageable&&this.gotopage&&(b=this._pageviews[0].height,0>b&&(b=this._pageviews[0].height)),
"visible"!=this.vScrollBar.css("visibility")&&this.vScrollBar.css("visibility","visible"),(b<=d||this.autoheight)&&this.vScrollBar.css("visibility","hidden"),0<b-d?this.vScrollBar.jqxScrollBar({max:b-d}):this.vScrollBar.jqxScrollBar({value:0,max:b})):(this.vScrollBar.css("visibility","hidden"),this.vScrollBar.jqxScrollBar({value:0}))}},_refreshdataview:function(){this.dataview.refresh()},refresh:function(b){1==b||c.jqx.isHidden(this.host)||null==this.virtualsizeinfo||(this._cellscache=[],this._renderrows(this.virtualsizeinfo),
this._updatesize())},render:function(){this._render(!0,!0,!0,!0)},invalidate:function(){this.virtualsizeinfo&&(this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo))},clear:function(){this.databind(null);this.render()},_preparecolumngroups:function(){var b=this.columnsheight;if(this.columngroups){this.columnshierarchy=[];if(this.columngroups.length){for(var d=this,b=0;b<this.columngroups.length;b++)this.columngroups[b].parent=null,this.columngroups[b].groups=null;
for(b=0;b<this.columns.records.length;b++)this.columns.records[b].parent=null,this.columns.records[b].groups=null;for(var c=function(b){for(var e=0;e<d.columngroups.length;e++){var c=d.columngroups[e];if(c.name===b)return c}return null},b=0;b<this.columngroups.length;b++){var h=this.columngroups[b];h.groups||(h.groups=null);if(h.parentgroup){var l=c(h.parentgroup);l&&(h.parent=l,l.groups||(l.groups=[]),-1===l.groups.indexOf(h)&&l.groups.push(h))}}for(b=0;b<this.columns.records.length;b++)if(h=this.columns.records[b],
h.columngroup&&(l=c(h.columngroup)))l.groups||(l.groups=[]),h.parent=l,-1===l.groups.indexOf(h)&&l.groups.push(h);for(b=c=0;b<this.columns.records.length;b++){l=h=this.columns.records[b];for(h.level=0;l.parent;)l=l.parent,h.level++;for(var l=h,q=h.level,c=Math.max(c,h.level);l.parent;)if(l=l.parent)l.level=--q}for(var r=function(b){var e=[];b.columngroup&&e.push(b);if(b.groups)for(var d=0;d<b.groups.length;d++)if(b.groups[d].columngroup)e.push(b.groups[d]);else if(b.groups[d].groups)for(var f=r(b.groups[d]),
c=0;c<f.length;c++)e.push(f[c]);return e},b=0;b<this.columngroups.length;b++){h=this.columngroups[b];l=r(h);h.columns=l;for(var h=[],t=q=0;t<l.length;t++)h.push(this.columns.records.indexOf(l[t])),l[t].pinned&&q++;if(0!=q)throw Error("jqxGrid: Column Groups initialization Error. Please, check the initialization of the jqxGrid's columns array. The columns in a column group cannot be pinned.");h.sort(function(b,e){b=parseInt(b);e=parseInt(e);return b<e?-1:b>e?1:0});for(l=1;l<h.length;l++)if(h[l]!=h[l-
1]+1)throw Error("jqxGrid: Column Groups initialization Error. Please, check the initialization of the jqxGrid's columns array. The columns in a column group are expected to be siblings in the columns array.");}}this.columngroupslevel=1+c;b=this.columngroupslevel*this.columnsheight}return b},_render:function(b,d,g,h,l){if(null!=this.dataview&&!this._loading&&!this._batchupdate)if(c.jqx.isHidden(this.host)){var q=this;q.___hiddenTimer&&(clearInterval(q.___hiddenTimer),q.___hiddenTimer=null);this.___hiddenTimer=
setInterval(function(){c.jqx.isHidden(q.host)||(clearInterval(q.___hiddenTimer),q.render())},300)}else{null!=this.editcell&&this.endcelledit&&this.endcelledit(this.editcell.row,this.editcell.column,!0,!1);this.validationpopup=null;this._removeHandlers();this._addHandlers();this._initializeRows();this._requiresupdate=void 0!=d?d:!0;this._newmax=null;if(g)if(this._requiresupdate||0!=h&&this._initmenu(),null==this.columns)this.columns=new c.jqx.collection(this.element);else{var r=this;this.columns&&
"observableArray"===this.columns.name&&(this.columns.notifier=function(b){switch(b.type){case "add":r.columns=r._columns;r.render();break;case "update":if("index"===b.name){r.beginupdate();for(var e in b.newValue)r.setcolumnproperty(b.newValue.datafield,e,b.newValue[e]);r.endupdate()}else e=b.path.split("."),r.setcolumnproperty(r.columns[e[0]].datafield,b.name,b.newValue);break;case "delete":r.columns=r._columns,r.render()}});this.columngroups&&"observableArray"===this.columngroups.name&&(this.columngroups.notifier=
function(b){r.render()});this._initializeColumns()}this.tableheight=null;this._pagescache=[];this._pageviews=[];this.visiblerows=[];this.hittestinfo=[];this._requiresupdate&&(this._clearcaches(),1==h&&this._initmenu());this.virtualsizeinfo=null;this.prerenderrequired=!0;(this.groupable&&0<this.groups.length&&this.rowdetails||this.rowdetails)&&this.gridcontent&&(this._rowdetailscache=[],this._rowdetailselementscache=[],this.detailboundrows=[],this.details=[],c.jqx.utilities.html(this.gridcontent,""),
this.gridcontent=null);this.gridcontent&&this.editable&&this._destroyeditors&&this._destroyeditors();g?(this.filterrow&&this.filterrow.detach(),c.jqx.utilities.html(this.content,""),this.columnsheader=this.columnsheader||c('<div style="overflow: hidden;"></div>'),this.columnsheader.remove(),this.columnsheader.addClass(this.toTP("jqx-widget-header")),this.columnsheader.addClass(this.toTP("jqx-grid-header"))):this.gridcontent&&c.jqx.utilities.html(this.gridcontent,"");this.showheader?this.columnsheader&&
this.columnsheader.css("display","block"):this.columnsheader.css("display","none");this.gridcontent=this.gridcontent||c('<div style="width: 100%; overflow: hidden; position: absolute;"></div>');this.gridcontent.remove();b=this.columnsheight;b=this._preparecolumngroups();this.showfilterrow&&this.filterable?(this.columnsheader.height(b+this.filterrowheight),this.showeverpresentrow&&"bottom"!==this.everpresentrowposition&&this.columnsheader.height(b+this.filterrowheight+this.everpresentrowheight)):this.showeverpresentrow&&
"bottom"!==this.everpresentrowposition?this.columnsheader.height(b+this.everpresentrowheight):this.columnsheader.height(b);this.content.append(this.columnsheader);this.content.append(this.gridcontent);this._arrange();this._initgroupsheader&&this._initgroupsheader();this.selectionarea=this.selectionarea||c("<div style='z-index: 99; visibility: hidden; position: absolute;'></div>");this.selectionarea.addClass(this.toThemeProperty("jqx-grid-selectionarea"));this.selectionarea.addClass(this.toThemeProperty("jqx-fill-state-pressed"));
this.content.append(this.selectionarea);this.tableheight=null;this.rendergridcontent(!1,g);0<this.groups.length&&this.groupable&&(b=this.vScrollBar[0].style.visibility,this.suspendgroupevents=!0,this.collapseallgroups&&(this.groupsexpandedbydefault?this.expandallgroups(!1):(this.collapseallgroups(!1),this._updatescrollbarsafterrowsprerender())),this.vScrollBar[0].style.visibility!=b&&(this._updatecolumnwidths(),this._updatecellwidths()),this.suspendgroupevents=!1);this.pageable&&this.updatepagerdetails&&
(this.updatepagerdetails(),this.autoheight&&this._updatepageviews(),this.autorowheight&&(this.autoheight||this._updatepageviews(),this._renderrows(this.virtualsizeinfo)));this.showaggregates&&this._updateaggregates&&this._updateaggregates();this._addoverlayelement();"deferred"==this.scrollmode&&this._addscrollelement();this.showfilterrow&&this.filterable&&this.filterrow&&(void 0==l||1==l)&&this._updatelistfilters(!g);this.rendered&&this.rendered("full");this.__isRendered=!0}},_addoverlayelement:function(){var b=
c.jqx.utilities.getBrowser();if("msie"==b.browser&&9>parseInt(b.version)||this.isTouchDevice())if(this._overlayElement&&this._overlayElement.remove(),this._overlayElement=c("<div class='jqxgrid-overlay' style='visibility: hidden; position: absolute; width: 100%; height: 100%;'></div>"),this._overlayElement.css("background","white"),this._overlayElement.css("z-index",180),this._overlayElement.css("opacity",.001),this.isTouchDevice())if("hidden"!==this.vScrollBar.css("visibility")||"hidden"!==this.hScrollBar.css("visibility")){b=
0;"checkbox"==this.selectionmode&&(b+=30);(this.groupable||this.rowdetails)&&this._overlayElement.css("left",30*(this.groups.length+(this.rowdetails?1:0)));var d=this._overlayElement.css("left");this._overlayElement.css("left",d+b)}else this._overlayElement&&this._overlayElement.remove();else this.content.prepend(this._overlayElement);this._updateTouchScrolling()},_addscrollelement:function(){this._scrollelement&&this._scrollelement.remove();this._scrollelementoverlay&&this._scrollelementoverlay.remove();
this._scrollelementoverlay=c("<div style='visibility: hidden; position: absolute; width: 100%; height: 100%;'></div>");this._scrollelementoverlay.css("background","black");this._scrollelementoverlay.css("z-index",1800);this._scrollelementoverlay.css("opacity",.1);this._scrollelement=c("<span style='visibility: hidden; top: 50%; right: 10px; position: absolute;'></span>");this._scrollelement.css("z-index",1900);this._scrollelement.addClass(this.toThemeProperty("jqx-button"));this._scrollelement.addClass(this.toThemeProperty("jqx-fill-state-normal"));
this._scrollelement.addClass(this.toThemeProperty("jqx-rc-all"));this._scrollelement.addClass(this.toThemeProperty("jqx-shadow"));this.content.prepend(this._scrollelement);this.content.prepend(this._scrollelementoverlay)},_postrender:function(b){if(("filter"==b||"sort"==b||"group"==b)&&this.rowdetails&&this.detailsVisibility&&0<this.detailsVisibility.length){this._detailsUpdate=!0;for(var d=0;d<this.details.length;d++)this.details[d]&&(this.details[d].rowdetailshidden=!0);for(d=0;d<this.detailsVisibility.length;d++)!1===
this.detailsVisibility[d]?this.showrowdetails(d):!0===this.detailsVisibility[d]&&this.hiderowdetails(d);this._detailsUpdate=!1;this.rendergridcontent(!0);this._updatecolumnwidths();this._updatecellwidths();this._renderrows(this.virtualsizeinfo)}if(this.groupable&&0<this.groups.length)if("filter"==b||"sort"==b)for(d=0;d<this.dataview.loadedgroups.length;d++){b=this.dataview.loadedgroups[d];var c=0,h;for(h in this.groupsVisibility)h==b.group&&this.groupsVisibility[h]&&(suspendgroupevents=!0,this._setgroupstate(b,
!0,!1),c++);0<c&&(suspendgroupevents=!1,b=this.vScrollBar[0].style.visibility,this.rendergridcontent(!0,!1),b!=this.vScrollBar[0].style.visibility||this._hiddencolumns)&&(this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo))}else"group"==b&&(this.groupsVisibility=[])},rendergridcontent:function(b,d){if(this.updating())return!1;if(void 0==b||null==b)b=!1;this._requiresupdate=b;var g=this.prerenderrequired;this.prerenderrequired&&this._arrange();var h=this.that;
if(null==d||void 0==d)d=!0;this.tableheight=null;h.virtualsizeinfo=h.virtualsizeinfo||h._calculatevirtualheight();h.pageable&&!h.autoheight&&h.dataview.totalrows<h.pagesize&&(h._requiresupdate=!0);d?h._rendercolumnheaders():(this._rendersortcolumn&&this._rendersortcolumn(),this._renderfiltercolumn&&this._renderfiltercolumn());h._renderrows(h.virtualsizeinfo);this.gridcontent&&(0!=this.gridcontent[0].scrollTop&&(this.gridcontent[0].scrollTop=0),0!=this.gridcontent[0].scrollLeft&&(this.gridcontent[0].scrollLeft=
0));g&&(g=this.tableheight,this._arrange(),g!=this.tableheight&&this.autoheight&&h._renderrows(h.virtualsizeinfo));this.rtl&&this._renderhorizontalscroll();this.autosavestate&&null!=this.initializedcall&&this.savestate&&this.savestate();if(this.adaptive&&this.element.offsetWidth<=this.adaptivewidth){var l=0,q=h.element.offsetWidth-2;c.each(this.columns.records,function(b,e){l+=this.width;if("adaptive"===this.columntype)return!0;l>=q&&(this.adaptivehidden=!0)});this._updatecolumnwidths();this._updatecellwidths();
this._renderrows(this.virtualsizeinfo)}return!0},_updatecolumnwidths:function(){var b=this.host.width(),d=b,g="";if(void 0!=this.columns&&void 0!=this.columns.records){var h=this.that,l=this.rowdetails&&this.showrowdetailscolumn?(1+this.groups.length)*this.groupindentwidth:this.groups.length*this.groupindentwidth,q=0;if(this.adaptive&&this.element.offsetWidth<=this.adaptivewidth){var r=1;c.each(this.columns.records,function(b,e){this.adaptivehidden&&r++});var t=0<this.vScrollBar[0].offsetWidth?this.vScrollBar[0].offsetWidth+
4:0;"hidden"==this.vScrollBar.css("visibility")&&(t=0);q=(this.element.offsetWidth-32-t)/(this.columns.records.length-r)}c.each(this.columns.records,function(c,q){if(!(this.hidden&&this.hideable||this.adaptivehidden))if(-1!=this.width.toString().indexOf("%")||void 0!=this._percentagewidth){var w="hidden"==h.vScrollBar[0].style.visibility?0:h.scrollbarsize+5;if(h.scrollbarautoshow||0==h.scrollbarsize)w=0;var r=d;q=parseFloat(this.width)*r/100;w+=l;void 0!=this._percentagewidth&&(q=parseFloat(this._percentagewidth)*
(r-w)/100);q<this.minwidth&&"auto"!=this.minwidth&&(q=this.minwidth);q>this.maxwidth&&"auto"!=this.maxwidth&&(q=this.maxwidth);b-=q}else"auto"==this.width||this._width?g+=this.text:b-=this.width});t=this._gettableheight();if(!this.autoheight&&this.virtualsizeinfo&&this.virtualsizeinfo.virtualheight>t)if(this.groupable&&0<this.groups.length)if(this.dataview&&this.dataview.loadedrootgroups&&!this.groupsexpandedbydefault){var v=this.dataview.loadedrootgroups.length*this.rowsheight;if(this.pageable)for(var y=
0;y<this.dataview.rows.length;y++)this.dataview.rows[y].group&&0===this.dataview.rows[y].level&&(v+=this.rowsheight);v>t?(b-=this.scrollbarsize+5,d-=this.scrollbarsize+5):"visible"==this.vScrollBar.css("visibility")&&(b-=this.scrollbarsize+5,d-=this.scrollbarsize+5)}else b-=this.scrollbarsize+5,d-=this.scrollbarsize+5;else"hidden"!=this.vScrollBar.css("visibility")&&0<this.scrollbarsize&&(b-=this.scrollbarsize+5,d-=this.scrollbarsize+5);l=this.rowdetails&&this.showrowdetailscolumn?(1+this.groups.length)*
this.groupindentwidth:this.groups.length*this.groupindentwidth;d-=l;if(this.columnsheader&&(t=this.columnsheader.find("#columntable"+this.element.id),0!=t.length)){var A=0,w=0;c.each(this.columns.records,function(l,r){var t=c(this.element);this.hidden||this.adaptivehidden||"none"!==this.element.style.display||(this.element.style.display="block");this.adaptivehidden&&(this.element.style.display="none");var y=!1,v=this.width;if(-1!=this.width.toString().indexOf("%")||void 0!=this._percentagewidth)v=
void 0!=this._percentagewidth?parseFloat(this._percentagewidth)*d/100:parseFloat(this.width)*d/100,y=!0;0<q&&"adaptive"!==this.columntype?(t.width(q),this.adaptivewidth=q):"auto"==this.width||this._width||y?y?(v<this.minwidth&&"auto"!=this.minwidth&&(this.width=v=this.minwidth),v>this.maxwidth&&"auto"!=this.maxwidth&&(this.width=v=this.maxwidth),parseInt(t[0].style.width)!=v&&(t.width(v),this.width=v)):(y=Math.floor(this.text.length/g.length*b),w+=y,3>b-w&&b!=w&&.01<b-w?1===b-w?y++:y+=2:l==h.columns.records.length-
1&&w<b&&(y+=b-w),isNaN(y)&&(y=this.minwidth),isNaN(y)&&(y=this.minwidth),Infinity==y&&(y=0),0>y&&($element=c("<span>"+this.text+"</span>"),c(document.body).append($element),y=10+$element.width(),$element.remove()),y<this.minwidth&&(y=this.minwidth),y>this.maxwidth&&(y=this.maxwidth),this._width="auto",this.width=y,t.width(this.width)):parseInt(t[0].style.width)!=this.width&&t.width(this.width);parseInt(t[0].style.left)!=A&&t.css("left",A);this.hidden&&this.hideable||this.adaptivehidden||(A=0<q&&"adaptive"!==
this.columntype?A+q:A+this.width);this._requirewidthupdate=!0});this.columnsheader.width(2+A);t.width(this.columnsheader.width());this.columnsheader[0].style.visibility=0==A?"hidden":"inherit";this._resizecolumngroups();this.showfilterrow&&this.filterrow&&(this.filterrow.width(this.columnsheader.width()),this._updatefilterrowui());this.showeverpresentrow&&("bottom"!==this.everpresentrowposition?this.addnewrowtop.width(this.columnsheader.width()):this.addnewrowbottom.width(this.columnsheader.width()),
this._updateaddnewrowui());this.autowidth&&this._arrange()}}},_rendercolumnheaders:function(){var b=this.that;if(this.prerenderrequired){this._columnsbydatafield=[];this.columnsheader.find("#columntable"+this.element.id).remove();var d=c('<div id="columntable'+this.element.id+'" style="height: 100%; position: relative;"></div>');d[0].cells=[];var g=0,h=0,l="",q=this.host.width(),r=q,t=[],v=[],y=this.rowdetails&&this.showrowdetailscolumn?(1+this.groups.length)*this.groupindentwidth:this.groups.length*
this.groupindentwidth;c.each(this.columns.records,function(d,f){if(!(this.hidden&&this.hideable||this.adaptivehidden))if("auto"==this.width||this._width)l+=this.text;else if(this.width<this.minwidth&&"auto"!=this.minwidth)q-=this.minwidth;else if(this.width>this.maxwidth&&"auto"!=this.maxwidth)q-=this.maxwidth;else if(-1!=this.width.toString().indexOf("%")){var c="hidden"==b.vScrollBar[0].style.visibility?0:b.scrollbarsize+5,c=c+y;f=parseFloat(this.width)*(r-c)/100;f<this.minwidth&&"auto"!=this.minwidth&&
(f=this.minwidth);f>this.maxwidth&&"auto"!=this.maxwidth&&(f=this.maxwidth);q-=f}else"string"==typeof this.width&&(this.width=parseInt(this.width)),q-=this.width;this.pinned||this.grouped||this.checkboxcolumn?(b._haspinned&&(this.pinned=!0),t[t.length]=this):v[v.length]=this});if(this.rtl){var A=0;t.reverse();for(w=this.columns.records.length-1;w>=this.columns.records.length-t.length;w--)this.columns.replace(w,t[A++]);for(A=0;A<v.length;A++)this.columns.replace(A,v[A])}else{for(var w=0;w<t.length;w++)this.columns.replace(w,
t[w]);for(A=0;A<v.length;A++)this.columns.replace(t.length+A,v[A])}var z=this.headerZIndex,C=b.groupable?b.groups.length:0;this.rowdetails&&this.showrowdetailscolumn&&C++;var D=b.columnsheader.height();this.showfilterrow&&(D=this.columngroups?D-this.filterrowheight:this.columnsheight);this.showeverpresentrow&&"bottom"!==this.everpresentrowposition&&(D=this.columngroups?D-this.everpresentrowheight:this.columnsheight);A=this._gettableheight();if(this.virtualsizeinfo&&this.virtualsizeinfo.virtualheight>
A&&!this.scrollbarautoshow)if(this.groupable&&0<this.groups.length)if(this.dataview&&this.dataview.loadedrootgroups&&!this.groupsexpandedbydefault){w=0;if(!this.pageable)w=this.dataview.loadedrootgroups.length*this.rowsheight;else if(this.pageable)for(var E=0;E<this.dataview.rows.length;E++)this.dataview.rows[E].group&&0===this.dataview.rows[E].level&&(w+=this.rowsheight);w>A&&(q-=this.scrollbarsize+5,r-=this.scrollbarsize+5)}else q-=this.scrollbarsize+5,r-=this.scrollbarsize+5;else!this.autoheight&&
0<this.scrollbarsize&&(q-=this.scrollbarsize+5,r-=this.scrollbarsize+5);var r=r-y,F=function(d,f){var c=b.columngroupslevel*b.columnsheight;return c-=f.level*b.columnsheight},G=document.createDocumentFragment(),I=0;c.each(this.columns.records,function(w,t){this.height=b.columnsheight;b.columngroups&&b.columngroups.length&&(D=this.height=F(this.datafield,this));var y=b.toTP("jqx-grid-column-header")+" "+b.toTP("jqx-widget-header");b.rtl&&(y+=" "+b.toTP("jqx-grid-column-header-rtl"));var A=b.rtl?150+
z+1:150+z-1,v=b.rtl?z++:z--,E=c('<div role="columnheader" style="z-index: '+v+';position: absolute; height: 100%;" class="'+y+'"><div style="height: 100%; width: 100%;"></div></div>');b.columngroups&&(E[0].style.height=D+"px",E[0].style.bottom="0px",this.pinned&&(E[0].style.zIndex=A));this.uielement=E;""!=this.classname&&this.classname&&E.addClass(this.classname);y=this.width;A=!1;null===this.width&&(this.width="auto");if(-1!=this.width.toString().indexOf("%")||void 0!=this._percentagewidth)y=void 0!=
this._percentagewidth?parseFloat(this._percentagewidth)*r/100:parseFloat(this.width)*r/100,A=!0;if("auto"==this.width||this._width||A)if(A){y<this.minwidth&&"auto"!=this.minwidth&&(y=this.minwidth);y>this.maxwidth&&"auto"!=this.maxwidth&&(y=this.maxwidth);if(void 0==this._percentagewidth||-1!=this.width.toString().indexOf("%"))this._percentagewidth=this.width;E.width(y);this.width=y}else this.hidden||this.adaptivehidden||(y=Math.floor(this.text.length/l.length*q),I+=y,3>q-I&&q!=I&&.01<q-I?1===q-I?
y++:y+=2:w==b.columns.records.length-1&&I<q&&(y+=q-I),isNaN(y)&&(y=this.minwidth),0>y&&($element=c("<span>"+this.text+"</span>"),c(document.body).append($element),y=10+$element.width(),$element.remove()),y<this.minwidth&&(y=this.minwidth),y>this.maxwidth&&(y=this.maxwidth),this._width="auto",y=this.width=y,E.width(this.width));else y<this.minwidth&&"auto"!=this.minwidth&&(this.width=y=this.minwidth),y>this.maxwidth&&"auto"!=this.maxwidth&&(this.width=y=this.maxwidth),E[0].style.width=parseInt(y)+
"px";(this.hidden&&this.hideable||this.adaptivehidden)&&E.css("display","none");var N=c(E.children()[0]),A=b.rtl?b.toTP("jqx-grid-column-menubutton")+" "+b.toTP("jqx-grid-column-menubutton-rtl"):b.toTP("jqx-grid-column-menubutton"),A=A+(" "+b.toTP("jqx-icon-arrow-down")),A=c('<div style="height: '+D+'px; display: none; left: 100%; top: 0%; position: absolute;"><div class="'+A+'" style="width: 100%; height:100%;"></div></div>');b.enableanimations||A.css("margin-left",-16);b.rtl&&A.css("left","0px");
this.columnsmenu=A[0];d[0].cells[w]=E[0];A[0].style.width=parseInt(b.columnsmenuwidth)+"px";var v=b.columnsmenu,V=!1,T=!1,R=b.groupable&&0<C&&g<C||b.rowdetails&&g<C;b.rtl&&(R=b.groupable&&0<C&&g<C||b.rowdetails&&g<C,R&=w>b.columns.records.length-1-C);if(R)g++,v&=0,this.editable=this.sortable=!1,T=!0;else{var H=null!=this.renderer?this.renderer(this.text,this.align,D):b._rendercolumnheader(this.text,this.align,D,b);null==H&&(H=b._rendercolumnheader(this.text,this.align,D,b));null!=this.renderer&&(H=
c(H));v&=1;V=!0}b.WinJS?MSApp.execUnsafeLocalFunction(function(){N.append(c(H))}):this.renderer?N.append(c(H)):H&&(N[0].innerHTML=H);if(null!=H){var J=c('<div class="iconscontainer" style="height: '+D+'px; margin-left: -32px; display: block; position: absolute; left: 100%; top: 0%; width: 32px;"><div class="filtericon '+b.toTP("jqx-widget-header")+'" style="height: '+D+'px; float: right; display: none; width: 16px;"><div class="'+b.toTP("jqx-grid-column-filterbutton")+'" style="width: 100%; height:100%;"></div></div><div class="sortasc '+
b.toTP("jqx-widget-header")+'" style="height: '+D+'px; float: right; display: none; width: 16px;"><div class="'+b.toTP("jqx-grid-column-sortascbutton")+" "+b.toTP("jqx-icon-arrow-up")+'" style="width: 100%; height:100%;"></div></div><div class="sortdesc '+b.toTP("jqx-widget-header")+'" style="height: '+D+'px; float: right; display: none; width: 16px;"><div class="'+b.toTP("jqx-grid-column-sortdescbutton")+" "+b.toTP("jqx-icon-arrow-down")+'" style="width: 100%; height:100%;"></div></div><div class="sorticon '+
b.toTP("jqx-widget-header")+'" style="height: '+D+'px; float: right; visibility: hidden; width: 16px;"><div class="'+b.toTP("jqx-grid-column-sorticon")+" "+b.toTP("jqx-icon-arrow-down")+'" style="width: 100%; height:100%;"></div></div></div>');A.addClass(b.toTP("jqx-widget-header"));N.append(J);R=J.children();this.sorticon=R[3];this.sortasc=R[1];this.sortdesc=R[2];this.filtericon=R[0];this.iconscontainer=J;b.rtl&&(J.css("margin-left","0px"),J.css("left","0px"),c(this.sorticon).css("float","left"),
c(this.sortasc).css("float","left"),c(this.filtericon).css("float","left"),c(this.sortdesc).css("float","left"));!b.autoshowfiltericon&&this.filterable&&c(this.filtericon).css("display","block")}this.element=E[0];v&&(b._handlecolumnsmenu(b,N,E,A,this),this.menu||A.hide());G.appendChild(E[0]);if(b.groupable&&V)if(E[0].id=b.dataview.generatekey(),b._handlecolumnstogroupsdragdrop)b._handlecolumnstogroupsdragdrop(this,E);else throw Error("jqxGrid: Missing reference to jqxgrid.grouping.js.");b.columnsreorder&&
this.draggable&&b._handlecolumnsdragreorder&&b._handlecolumnsdragreorder(this,E);var P=this;P._applyStyle();b.addHandler(E,"mouseenter",function(b){P.hovered=!0;P._applyStyle()});b.addHandler(E,"mouseleave",function(b){P.hovered=!1;P._applyStyle()});var L=function(d,f,c){if(d.selectable){var g=b.getrows();void 0===d.selected&&(d.selected=!1);f.shiftKey&&void 0!==b._clickedcolumn||(b._clickedcolumn=d);if(f.shiftKey&&b._clickedcolumn&&void 0===c){var h=b.columns.records.indexOf(b._clickedcolumn);c=
b.columns.records.indexOf(d);d=Math.min(h,c);c=Math.max(h,c);b.clearselection();for(h=d;h<=c;h++)L(b.columns.records[h],f,!0);b._renderrows(this.virtualsizeinfo)}else{c?d.selected=!0:(f.ctrlKey||b.clearselection(),d.selected=!d.selected);for(h=0;h<g.length;h++)b._applycellselection(g[h].boundindex,d.displayfield,d.selected,!1);d.selected?d.element.setAttribute("selected",""):d.element.removeAttribute("selected");d._applyStyle();void 0===c&&b._renderrows(this.virtualsizeinfo)}}};b.addHandler(E,"click",
function(d){if(P.checkboxcolumn)return!0;if(0<b.sorttogglestates&&b._togglesort&&!b._loading){if(b.suspendClick)return!0;b._togglesort(P)}L(P,d);d.preventDefault();b._raiseEvent(7,{column:P.getcolumnproperties(),datafield:P.datafield,originalEvent:d})});if(P.resizable&&b.columnsresize&&!T){var Y=!1,A="mousemove";b.isTouchDevice()&&!0!==b.touchmode&&(Y=!0,A=c.jqx.mobile.getTouchEventName("touchstart"));b.addHandler(E,A,function(d){var f=parseInt(d.pageX),g=parseInt(E.coord().left);b.hasTransform&&
(g=c.jqx.utilities.getOffset(E).left);if(b.resizing)return!0;if(b._handlecolumnsresize){if(Y)return f=b.getTouches(d)[0].pageX,f>=g+P.width-40?(b.resizablecolumn={columnelement:E,column:P},E.css("cursor","col-resize")):(E.css("cursor",""),b.resizablecolumn=null),!0;d=P.width;b.rtl&&(d=0);if(f>=g+d-5){if(f<=g+d+5)return b.resizablecolumn={columnelement:E,column:P},E.css("cursor","col-resize"),!1;E.css("cursor","")}else E.css("cursor",""),f<g+d-5&&(P._animating||P._menuvisible||E.mouseenter());b.resizablecolumn=
null}})}E.css("left",h);this.hidden&&this.hideable||this.adaptivehidden||(h+=y);P.rendered&&P.rendered(c(N[0].firstChild),P.align,D)&&null!=J&&J.hide();if(P.checkboxcolumn){J&&J.hide();if(!b.host.jqxCheckBox)throw Error("jqxGrid: Missing reference to jqxcheckbox.js");N.html('<div style="cursor: pointer; margin-left: 3px; top: 50%; margin-top: -9px; position: relative;"></div>');var aa=N.find("div:first");aa.jqxCheckBox({_canFocus:!1,disabled:b.disabled,disabledContainer:!0,theme:b.theme,enableContainerClick:!1,
animationShowDelay:0,animationHideDelay:0});aa.addClass(b.toThemeProperty("jqx-checkbox"));P.checkboxelement=aa;J=aa.data().jqxCheckBox.instance;b._checkboxcolumn=P;J.updated=function(d,f,c){b._checkboxcolumnupdating=!0;b.disabled&&(aa.jqxCheckBox({disabled:b.disabled}),f=c);f?b.selectallrows():b.unselectallrows();b._checkboxcolumnupdating=!1}}});0<h?this.columnsheader.width(2+h):this.columnsheader.width(h);d[0].appendChild(G);this.columnsrow=d;b.columnsheader.append(d);this.showfilterrow&&this._updatefilterrow&&
(this.columngroups?d.height(this.columngroupslevel*this.columnsheight):d.height(this.columnsheight),this.filterrow||(A=c("<div style='position: relative !important; '></div>"),A[0].id="filterrow."+this.element.id,A.height(this.filterrowheight),this.filterrow=A),this.filterrow.width(2+h),this.columnsheader.append(this.filterrow),this._updatefilterrow());this.showeverpresentrow&&"bottom"!==this.everpresentrowposition?(this.columngroups?d.height(this.columngroupslevel*this.columnsheight):d.height(this.columnsheight),
this.addnewrowtop||(A=c("<div style='position: relative !important; z-index:"+this.headerZIndex+";'></div>"),A[0].id="addnewrowtop."+this.element.id,A.height(this.everpresentrowheight),this.addnewrowtop=A),this.addnewrowtop.width(2+h),"topAboveFilterRow"==this.everpresentrowposition?this.filterrow?this.addnewrowtop.insertBefore(this.filterrow):this.columnsheader.append(this.addnewrowtop):this.columnsheader.append(this.addnewrowtop),this._updateaddnewrow()):this.showeverpresentrow&&"bottom"===this.everpresentrowposition&&
(this.addnewrowbottom||(A=c("<div style='position: relative !important; z-index:"+this.headerZIndex+";'></div>"),A[0].id="addnewrowbottom."+this.element.id,A.height(this.everpresentrowheight),this.addnewrowbottom=A),this.addnewrowbottom.width(2+h),this.addnewrow.append(this.addnewrowbottom),this._updateaddnewrow());d[0].style.visibility=0==h?"hidden":"inherit";d.width(h);this._handlecolumnsdragdrop&&this._handlecolumnsdragdrop();this._handlecolumnsreorder&&this._handlecolumnsreorder();this._rendersortcolumn&&
this._rendersortcolumn();this._renderfiltercolumn&&this._renderfiltercolumn();this._handlecolumnsresize&&this._handlecolumnsresize();this.columngroups&&this._rendercolumngroups();this._updatecheckboxselection&&this._updatecheckboxselection()}else this._rendersortcolumn&&this._rendersortcolumn(),this._renderfiltercolumn&&this._renderfiltercolumn(),this.showfilterrow&&this.filterrow&&(this.filterrow.width(this.columnsheader.width()),this._updatefilterrowui()),this.showeverpresentrow&&("bottom"!==this.everpresentrowposition?
this.addnewrowtop.width(this.columnsheader.width()):this.addnewrowbottom.width(this.columnsheader.width()),this._updateaddnewrowui())},_rendercolumngroups:function(){if(this.columngroups){for(var b=0,d=0;d<this.columns.records.length;d++)this.columns.records[d].pinned&&b++;var b=this.headerZIndex-b+this.columns.records.length,d=this.that,g=d.toTP("jqx-grid-column-header")+" "+d.toTP("jqx-grid-columngroup-header")+" "+d.toTP("jqx-widget-header");d.rtl&&(g+=" "+d.toTP("jqx-grid-columngroup-header-rtl"));
var h=this.columnsheader.find("#columntable"+this.element.id);h.find("jqx-grid-columngroup-header").remove();for(var l=0;l<this.columngroupslevel-1;l++)for(d=0;d<this.columngroups.length;d++){var q=this.columngroups[d],r=q.level;if(r===l){var r=r*this.columnsheight,t=99999;if(q.groups){var v=function(b){for(var e=0,d=0;d<b.groups.length;d++){var f=b.groups[d];f.groups?e+=v(f):f.hidden||(e+=f.width,t=Math.min(parseFloat(f.element.style.left),t))}return e};q.width=v(q);q.left=t;var y=this.columnsheight,
A=b--,A=c('<div role="columnheader" style="z-index: '+A+';position: absolute;" class="'+g+'"></div>'),w=c(this._rendercolumnheader(q.text,q.align,this.columnsheight,this));if(q.renderer){var w=c("<div style='height: 100%; width: 100%;'></div>"),z=q.renderer(q.text,q.align,y);w.html(z)}A.append(w);A[0].style.left=t+"px";0===t&&(A[0].style.borderLeftColor="transparent");this.showcolumnheaderlines||(A[0].style.borderRightColor="transparent",A[0].style.borderBottomColor="transparent",A[0].style.boxShadow=
"none");A[0].style.top=r+"px";A[0].style.height=y+"px";A[0].style.width=-1+q.width+"px";h.append(A);q.element=A;q.rendered&&q.rendered(w,q.align,y)}}}}},_resizecolumngroups:function(){if(this.columngroups)for(var b=0;b<this.columngroups.length;b++){var d=this.columngroups[b],c=d.level*this.columnsheight,h=99999;if(d.groups){var l=function(b){for(var e=0,d=0;d<b.groups.length;d++){var f=b.groups[d];f.groups?e+=l(f):f.hidden||(e+=f.width,h=Math.min(parseFloat(f.element.style.left),h))}return e};d.width=
l(d);d.left=h;var q=this.columnsheight,r=d.element;r[0].style.left=h+"px";r[0].style.top=c+"px";r[0].style.height=q+"px";r[0].style.width=-1+d.width+"px"}}},_handlecolumnsmenu:function(b,d,g,h,l){b.dragmousedown=null;h[0].id=b.dataview.generatekey();d.append(h);g[0].columnsmenu=h[0];l.element=g[0];var q=this.columnsmenuwidth+1,r=function(){if(!l.menu)return!1;if(!b.resizing){if(l._menuvisible&&b._hasOpenedMenu)return!1;l._animating=!0;if(b.menuitemsarray&&0<b.menuitemsarray.length)if(b.enableanimations)h.css("display",
"block"),h.stop(),l.iconscontainer.stop(),b.rtl?(h.css("margin-left",-q),h.animate({"margin-left":"0px"},"fast",function(){h.css("display","block");l._animating=!1;l._menuvisible=!0})):(h.css("margin-left","0px"),h.animate({"margin-left":-q},"fast",function(){h.css("display","block");l._animating=!1;l._menuvisible=!0})),d=b.rtl?q:-(32+q),l.iconscontainer.animate({"margin-left":d},"fast");else{h.css("display","block");var d=b.rtl?16:-48;l.iconscontainer.css("margin-left",d+"px");l._animating=!1;l._menuvisible=
!0}}};d="mouseenter";b.isTouchDevice()&&(d="touchstart");b.addHandler(g,d,function(d){d=parseInt(d.pageX);var f=b.columnsresize&&l.resizable?3:0,h=parseInt(g.coord().left);b.hasTransform&&(h=c.jqx.utilities.getOffset(g).left);var q=l.width;b.rtl&&(q=0);if(0!=f&&d>=h+q-f&&d<=h+q+f)return!1;d=b.vScrollInstance.isScrolling();l.menu&&b.autoshowcolumnsmenubutton&&!d&&!b.disabled&&r()});b.autoshowcolumnsmenubutton||(h.css("display","block"),l.iconscontainer.css("margin-left",(b.rtl?16:-48)+"px"),b.rtl?
h.css({"margin-left":"0px"}):h.css({"margin-left":-q}));b.addHandler(g,"mouseleave",function(d){b.menuitemsarray&&0<b.menuitemsarray.length&&l.menu&&(d=c.data(document.body,"contextmenu"+b.element.id),void 0!=d&&h[0].id==d.columnsmenu.id||!b.autoshowcolumnsmenubutton||(b.enableanimations?(b.rtl?h.css("margin-left","0px"):h.css("margin-left",-q),h.stop(),l.iconscontainer.stop(),b.rtl?h.animate({"margin-left":-q},"fast",function(){h.css("display","none");l._menuvisible=!1}):h.animate({"margin-left":0},
"fast",function(){h.css("display","none");l._menuvisible=!1}),d=b.rtl?0:-32,l.iconscontainer.animate({"margin-left":d},"fast")):(h.css("display","none"),d=b.rtl?0:-32,l.iconscontainer.css("margin-left",d+"px"),l._menuvisible=!1)))});var t=!0,v="";d=c(l.filtericon);b.addHandler(h,"mousedown",function(d){b.gridmenu||b._initmenu();t=!c.data(b.gridmenu[0],"contextMenuOpened"+b.gridmenu[0].id);v=c.data(document.body,"contextmenu"+b.element.id);null!=v&&(v=v.column.datafield)});b.addHandler(d,"mousedown",
function(d){b.gridmenu||b._initmenu();t=!c.data(b.gridmenu[0],"contextMenuOpened"+b.gridmenu[0].id);v=c.data(document.body,"contextmenu"+b.element.id);null!=v&&(v=v.column.datafield)});var y=function(){if(!l.menu)return!1;b.gridmenu||b._initmenu();if(b.disabled)return!1;for(var d=0;d<b.columns.records.length;d++)b.columns.records[d].datafield!=l.datafield&&(b.columns.records[d]._menuvisible=!1);var d=h.coord(!0),f=h.height();if(!t&&(t=!0,v==l.datafield))return b._closemenu(),!1;var g=b.host.coord(!0);
b.hasTransform&&(g=c.jqx.utilities.getOffset(b.host),d=c.jqx.utilities.getOffset(h));g.left+b.host.width()>parseInt(d.left)+b.gridmenu.width()?b.gridmenu.jqxMenu("open",d.left,d.top+f):b.gridmenu.jqxMenu("open",h.width()+d.left-b.gridmenu.width(),d.top+f);100>b.gridmenu.width()&&b._arrangemenu();if(b.adaptive&&b.element.offsetWidth<b.adaptivewidth){b.gridmenu.jqxMenu("close");b.gridmenu.jqxMenu("open",g.left,d.top+f);for(d=f=0;d<b.columns.records.length;d++)g=b.columns.records[d],g.hidden||g.adaptivehidden||
"adaptive"===g.columntype||(f+=g.adaptivewidth);b.gridmenu.width(f);b.gridmenu.height(b.content.height())}(!b.filterable||b.filterable&&b.showfilterrow)&&setTimeout(function(){b.gridmenu.focus();for(var d=b.gridmenu.find(".jqx-item"),f=0;f<d.length;f++)d[f].active&&(d[f].active=!1);f=d[0];0<=d[0].className.indexOf("disabled")&&(f=d[1]);c(d).removeClass("jqx-fill-state-focus");c(f).addClass("jqx-fill-state-focus");f.active=!0},225);b._hasOpenedMenu=!0;var f=b._getmenuitembyindex(0),g=b._getmenuitembyindex(1),
q=b._getmenuitembyindex(2),r=b._getmenuitembyindex(3),y=b._getmenuitembyindex(4),d=b._getmenuitembyindex(5);if(null!=f&&null!=g&&null!=q){var F=l.sortable&&b.sortable;b.gridmenu.jqxMenu("disable",f.id,!F);b.gridmenu.jqxMenu("disable",g.id,!F);b.gridmenu.jqxMenu("disable",q.id,!F);void 0!=l.displayfield&&(b.sortcolumn==l.displayfield?(q=b.getsortinformation(),F&&(q.sortdirection.ascending?b.gridmenu.jqxMenu("disable",f.id,!0):b.gridmenu.jqxMenu("disable",g.id,!0))):b.gridmenu.jqxMenu("disable",q.id,
!0))}null!=r&&null!=y&&(b.groupable&&l.groupable?b.groups&&-1!=b.groups.indexOf(l.datafield)?(b.gridmenu.jqxMenu("disable",r.id,!0),b.gridmenu.jqxMenu("disable",y.id,!1)):(b.gridmenu.jqxMenu("disable",r.id,!1),b.gridmenu.jqxMenu("disable",y.id,!0)):(b.gridmenu.jqxMenu("disable",y.id,!0),b.gridmenu.jqxMenu("disable",r.id,!0)));null!=d&&(b.menuOwner=l,b._updatefilterpanel(b,d,l),f=0,b.sortable&&b._togglesort&&b.showsortmenuitems&&(f+=3),b.groupable&&b.addgroup&&b.showgroupmenuitems&&(f+=2),g=33*f+6,
g=b._measureMenuElement(),g=f*g+14,c.jqx.browser.msie&&8>c.jqx.browser.version&&(g+=20,c(d).height(194)),b.isTouchDevice()&&(g+=10),b.filterable&&b.showfiltermenuitems&&(l.filterable?(b.gridmenu.height(g+194),c(d).css("display","block")):(b.gridmenu.height(g),c(d).css("display","none"))));b.columnmenuopening&&!1===b.columnmenuopening(b.gridmenu,l.displayfield,b.gridmenu.height())&&setTimeout(function(){b._closemenu()});c.data(document.body,"contextmenu"+b.element.id,{column:l,columnsmenu:h[0]})};
b.addHandler(d,"click",function(d){if(!l.menu)return!1;b.showfilterrow||("block"!=h[0].style.display&&g.trigger("mouseenter"),setTimeout(function(){"block"!=h[0].style.display&&g.trigger("mouseenter");y()},200));return!1});b.addHandler(h,"click",function(b){if(!l.menu)return!1;y();return!1});b.isTouchDevice()&&b.addHandler(h,c.jqx.mobile.getTouchEventName("touchstart"),function(d){if(!l.menu)return!1;b._hasOpenedMenu?b._closemenu():y();return!1})},_removecolumnhandlers:function(b){var d=this.that,
g=c(b.element);0<g.length&&(d.removeHandler(g,"mouseenter"),d.removeHandler(g,"mouseleave"),b=c(b.filtericon),d.removeHandler(b,"mousedown"),d.removeHandler(b,"click"),d.removeHandler(g,"click"),d.removeHandler(g,"mousemove"),d.columnsreorder&&(d.removeHandler(g,"mousedown.drag"),d.removeHandler(g,"mousemove.drag")),d.removeHandler(g,"dragstart"),g[0].columnsmenu&&(g=c(g[0].columnsmenu),d.removeHandler(g,"click"),d.removeHandler(g,"mousedown"),d.removeHandler(g,c.jqx.mobile.getTouchEventName("touchstart"))))},
_rendercolumnheader:function(b,d,c,h){return this.enableellipsis?"left"==d?'<div style="padding-bottom: 2px; overflow: hidden; text-overflow: ellipsis; text-align: '+d+"; margin-left: 4px; margin-right: 2px; line-height: "+c+'px;"><span style="text-overflow: ellipsis; cursor: default;">'+b+"</span></div>":'<div style="padding-bottom: 2px; overflow: hidden; text-overflow: ellipsis; text-align: '+d+"; margin-left: 2px; margin-right: 4px; line-height: "+c+'px;"><span style="text-overflow: ellipsis; cursor: default;">'+
b+"</span></div>":"center"==d||"middle"==d?'<div style="padding-bottom: 2px; text-align: center; line-height: '+c+'px;"><a href="#">'+b+"</a></div>":'<a style="line-height: '+c+"px; float: "+d+';" href="#">'+b+"</a>"},_renderrows:function(b,d,g){var h=this.that;(this.pageable||this.groupable)&&(this.autoheight||this.autorowheight)&&null!=this.table&&null!=this.table[0].rows&&this.table[0].rows.length<this.dataview.rows.length&&(h.prerenderrequired=!0);this.pageable||!this.autoheight&&!this.autorowheight||
!this.virtualmode&&!this.unboundmode||(g=this.source.totalrecords,isNaN(g)||null==this.table||null==this.table[0].rows||this.table[0].rows.length==g||(h.prerenderrequired=!0));(this.autoheight||this.autorowheight)&&!h.prerenderrequired&&this.table&&this.table[0].rows&&(this.table[0].rows.length<this.dataview.records.length&&(this.pageable&&this.table[0].rows.length<this.dataview.pagesize?h.prerenderrequired=!0:this.pageable||(h.prerenderrequired=!0)),this.table[0].rows.length<this.dataview.cachedrecords.length&&
(this.pageable&&this.table[0].rows.length<this.dataview.pagesize?h.prerenderrequired=!0:this.pageable||(h.prerenderrequired=!0)));h._prerenderrows(b);h._requiresupdate&&(h._requiresupdate=!1,h._updatepageviews());var l=function(){h._loading||(h.WinJS?MSApp.execUnsafeLocalFunction(function(){h._rendervisualrows()}):h._rendervisualrows(),h.virtualmode&&h.showaggregates&&h._updateaggregates&&h.refreshaggregates())};b=c.jqx.browser.msie&&10>c.jqx.browser.version;if(this.virtualmode)g=function(){if(h.rendergridrows){var b=
h._startboundindex;void 0==b&&(b=0);var e=b+1+h.dataview.pagesize;if(null!=b&&null!=e){var c=h.source._source?!0:!1;if((c?h.source._source.recordstartindex:h.source.recordstartindex)!=b||1==d){if(c){if(e>=h.source._source.totalrecords&&(e=h.source._source.totalrecords,b=e-h.dataview.pagesize-1,0>b&&(b=0),h.source._source.recordendindex==e&&h.source._source.recordstartindex==b))return;h.source._source.recordstartindex=b;h.source._source.recordendindex=e}else h.source.recordstartindex=b,h.source.recordendindex=
e;h.updatebounddata("cells")}}}},this.loadondemand&&(l(),g(),this.loadondemand=!1),g=void 0==this._browser?this._isIE10():this._browser,this.editable&&this.editcell&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()?l():this.autoheight?l():g||b||navigator&&-1!=navigator.userAgent.indexOf("Safari")?(null!=this._scrolltimer&&clearTimeout(this._scrolltimer),this._scrolltimer=setTimeout(function(){l()},5)):l();else{if("deferred"==this.scrollmode&&(this.hScrollInstance.isScrolling()||
this.vScrollInstance.isScrolling())){null!=this._scrolltimer&&clearInterval(this._scrolltimer);var q=this._getfirstvisualrow();null!=q&&(b=function(b){if(null==q)return"";b="<table>";var e=h.deferreddatafields;null==e&&0<h.columns.records.length&&(e=[],e.push(h.columns.records[0].displayfield));for(var d=0;d<e.length;d++){var f=h._getcolumnbydatafield(e[d]);if(f){var g=h._getcellvalue(f,q);""!=f.cellsformat&&c.jqx.dataFormat&&(c.jqx.dataFormat.isDate(g)?g=c.jqx.dataFormat.formatdate(g,f.cellsformat,
h.gridlocalization):c.jqx.dataFormat.isNumber(g)&&(g=c.jqx.dataFormat.formatnumber(g,f.cellsformat,h.gridlocalization)));b+="<tr><td>"+g+"</td></tr>"}}return b+"</table>"},b=this.scrollfeedback?this.scrollfeedback(q.bounddata):b(q.bounddata),b!=this._scrollelementcontent&&(this._scrollelementcontent=this._scrollelement[0].innerHTML=b));this._scrollelement.css("visibility","visible");this._scrollelementoverlay.css("visibility","visible");this._scrollelement.css("margin-top",-this._scrollelement.height()/
2);this._scrolltimer=setInterval(function(){h.hScrollInstance.isScrolling()||h.vScrollInstance.isScrolling()||(l(),h._scrollelement.css("visibility","hidden"),h._scrollelementoverlay.css("visibility","hidden"),clearInterval(h._scrolltimer),q&&h.ensurerowvisible(q.visibleindex))},100);return}navigator&&-1==navigator.userAgent.indexOf("Chrome")&&-1!=navigator.userAgent.indexOf("Safari")&&(this._updatedelay=1);void 0!=this.touchDevice&&1==this.touchDevice&&(this._updatedelay=5);if((g=void 0==this._browser?
this._isIE10():this._browser)||b)this._updatedelay=5;if(g&&this.hScrollInstance.isScrolling()){l();return}c.jqx.browser.mozilla&&0==this._updatedelay&&(this.vScrollInstance.isScrolling()||this.hScrollInstance.isScrolling())&&(this._updatedelay=0);this.isTouchDevice()&&(this._updatedelay=0);null!=this.updatedelay&&(this._updatedelay=this.updatedelay);0==this._updatedelay?l():(b=this._jqxgridrendertimer,null!=b&&clearTimeout(b),this.vScrollInstance.isScrolling()||this.hScrollInstance.isScrolling()?
(this._updatedelay?b=setTimeout(function(){l()},this._updatedelay):(b=null,l()),this._jqxgridrendertimer=b):(this._jqxgridrendertimer=b,l()))}if(h.autorowheight&&!h.autoheight&&0<this._pageviews.length){g=this._gettableheight();b=this._pageviews[0].height;if(b>g)if(this.pageable&&this.gotopage&&(b=this._pageviews[0].height,0>b&&(b=this._pageviews[0].height)),"visible"!=this.vScrollBar.css("visibility")&&this.vScrollBar.css("visibility","visible"),(b<=g||this.autoheight)&&this.vScrollBar.css("visibility",
"hidden"),0<b-g){if("deferred"!=this.scrollmode){g=b-g;var r=this.vScrollInstance.max;this.vScrollBar.jqxScrollBar({max:g});Math.round(g)!=Math.round(r)&&this.vScrollBar.jqxScrollBar("value")>g&&this.vScrollBar.jqxScrollBar({value:0})}}else this.vScrollBar.jqxScrollBar({value:0,max:b});else this._loading||this.vScrollBar.css("visibility","hidden"),this.vScrollBar.jqxScrollBar({value:0});this._arrange();this.virtualsizeinfo&&(this.virtualsizeinfo.virtualheight=b)}},scrolling:function(){var b=this.vScrollInstance.isScrolling(),
d=this.hScrollInstance.isScrolling();return{vertical:b,horizontal:d}},_renderhorizontalscroll:function(){var b=this.hScrollInstance,d=b.value;"hidden"===this.hScrollBar.css("visibility")&&(d=b.value=0);var c=parseInt(d);if(null!=this.table){var h=this.table[0].rows.length,l=this.columnsrow,q=this.groupable&&0<this.groups.length?this.groups.length:0,r=this.columns.records.length-q,t=this.columns.records,v=0==this.dataview.rows.length;this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(c=b.max-
c);if(v&&!this._haspinned){for(b=0;b<h;b++)for(var v=this.table[0].rows[b],y=0;y<q+r;y++){var A=v.cells[y];if(void 0!=A){var w=t[y];w.pinned&&(A.style.marginLeft=c+"px",0==b&&(A=l[0].cells[y],A.style.marginLeft=c+"px"))}}this.table[0].style.marginLeft=-c+"px";l[0].style.marginLeft=-c+"px"}else if(this._haspinned||void 0==this._haspinned){for(b=0;b<h;b++)for(v=this.table[0].rows[b],y=0;y<q+r;y++)if(A=v.cells[y],void 0!=A&&(w=t[y],w.pinned&&(0!=c||""!=A.style.marginLeft))){var z=w=null,C=null;this.showeverpresentrow&&
this.addnewrowtop&&this.addnewrowtop[0].cells&&(C=this.addnewrowtop[0].cells[y]);this.showfilterrow&&this.filterrow&&this.filterrow[0].cells&&(z=this.filterrow[0].cells[y]);this.showaggregates&&this.statusbar[0].cells&&(w=this.statusbar[0].cells[y]);this.rtl?(A.style.marginLeft=-parseInt(d)+"px",0==b&&(A=l[0].cells[y],A.style.marginLeft=-parseInt(d)+"px",w&&(w.style.marginLeft=-parseInt(d)+"px"),z&&(z.style.marginLeft=-parseInt(d)+"px"),C&&(C.style.marginLeft=-parseInt(d)+"px"))):(A.style.marginLeft=
c+"px",0==b&&(A=l[0].cells[y],A.style.marginLeft=c+"px",w&&(w.style.marginLeft=c+"px"),z&&(z.style.marginLeft=c+"px"),C&&(C.style.marginLeft=c+"px")))}this.table[0].style.marginLeft=-c+"px";l[0].style.marginLeft=-c+"px"}else 0==this._haspinned&&(this.table[0].style.marginLeft=-c+"px",l[0].style.marginLeft=-c+"px");this.showaggregates&&this.statusbar[0].cells&&(d=0,this.rtl&&"hidden"!=this.vScrollBar.css("visibility")&&"hidden"!=this.hScrollBar.css("visibility")&&(d=2+parseInt(this.hScrollBar.css("left"))),
this.statusbar[0].style.marginLeft=-c+d+"px");this.showfilterrow&&this.filterrow&&this.filterrow[0].cells&&(this.filterrow[0].style.marginLeft=-c+"px");this.showeverpresentrow&&this.addnewrowtop&&this.addnewrowtop[0].cells&&(this.addnewrowtop[0].style.marginLeft=-c+"px")}},_updaterowdetailsvisibility:function(){if(this.rowdetails)for(var b=0;b<this._rowdetailselementscache.length;b++)c(this._rowdetailselementscache[b]).css("display","none")},_getvisualcolumnsindexes:function(b,d,c,h,l,q){if(this.rowdetails||
this.rtl||this.editcell||this.width&&0<=this.width.toString().indexOf("%")||this.exporting)return{start:0,end:c+h};var r=0,t=-1,v=c+h,y=!1;if(this.autorowheight)return{start:0,end:c+h};if(!l)for(l=0;l<c+h;l++)if(y||this.columns.records[l].pinned&&q&&(y=!0),this.columns.records[l].hidden||this.columns.records[l].adaptivehidden||(r+=this.columns.records[l].width),r>=b&&-1==t&&(t=l),r>d+b){v=l;break}v++;v>c+h&&(v=c+h);if(-1==t||y)t=0;return{start:t,end:v}},_getvirtualcolumnsindexes:function(b,d,c,h,
l){if(this.rtl||this.editcell||this.exporting)return{start:0,end:c+h};var q=0,r=-1,t=c+h;if(this.autorowheight)return{start:0,end:c+h};if(!l)for(l=0;l<c+h;l++)if(this.columns.records[l].hidden||this.columns.records[l].adaptivehidden||(q+=this.columns.records[l].width),q>=b&&-1==r&&(r=l),q>d+b){t=l;break}t++;t>c+h&&(t=c+h);-1==r&&(r=0);return{start:r,end:t}},_getfirstvisualrow:function(){var b=parseInt(this.vScrollInstance.value);0==this._pagescache.length&&(this.dataview.updateview(),this._loadrows());
"visible"!=this.vScrollBar[0].style.visibility&&(b=0);if(!this.pageable){var d=this._findvisiblerow(b,this._pageviews);if(-1==d)return null;d!=this.dataview.pagenum?(this.dataview.pagenum=d,this.dataview.updateview(),this._loadrows()):this._pagescache[this.dataview.pagenum]||this._loadrows()}b=this._findvisiblerow(b,this._pagescache[this.dataview.pagenum]);if((d=this._pagescache[this.dataview.pagenum])&&d[0])return d[b]},_rendervisualrows:function(){if(this.virtualsizeinfo){var b=this.vScrollInstance,
d=this.hScrollInstance,g=d.value,h=parseInt(b.value),l=parseInt(g),q=this._gettableheight(),r=void 0!=this._hostwidth?this._hostwidth:this.host.width();"visible"==this.hScrollBar[0].style.visibility&&(q+=29);"deferred"==this.scrollmode&&0!=this._newmax&&h>this._newmax&&null!=this._newmax&&(h=this._newmax);var t=b.isScrolling()||d.isScrolling()||this._keydown,v=this.groupable&&0<this.groups.length;this.visiblerows=[];this.hittestinfo=[];this.editcell&&void 0==this.editrow&&this._hidecelleditor(!1);
void 0!=this.editrow&&this._hideeditors();this.virtualmode&&!this.pageable&&(this._pagescache=[]);0==this._pagescache.length&&(this.dataview.updateview(),this._loadrows());"hidden"==this.vScrollBar[0].style.visibility&&(h=0);if(!this.pageable){d=this._findvisiblerow(h,this._pageviews);if(-1==d){this._clearvisualrows();this._renderemptyrow();this._updaterowdetailsvisibility();return}d!=this.dataview.pagenum?(this.dataview.pagenum=d,this.dataview.updateview(),this._loadrows()):this._pagescache[this.dataview.pagenum]||
this._loadrows()}var y=this.groupable&&0<this.groups.length?this.groups.length:0;if(this.columns.records){var A=this.columns.records.length-y,d=this._findvisiblerow(h,this._pagescache[this.dataview.pagenum]),w=this._pagescache[this.dataview.pagenum],z=d;0>z&&(z=0);var C=0,D=0,E=0,F=0,G=this.virtualsizeinfo.visiblerecords,I=this.groupable?this.groups.length:0,M=this.toTP("jqx-grid-cell")+" "+this.toTP("jqx-item");this.rtl&&(M+=" "+this.toTP("jqx-grid-cell-rtl"));(this.autoheight||this.autorowheight)&&
this.pageable&&(!this.groupable||this.groupable&&0===this.groups.length)&&(G=this.dataview.pagesize);v&&(M=" "+this.toTP("jqx-grid-group-cell"));this.isTouchDevice()&&(M+=" "+this.toTP("jqx-touch"));this.autorowheight&&(M+=" jqx-grid-cell-wrap");var O=this.rowsheight,K=this._rendercell,g=this._getvisualcolumnsindexes(l,r,y,A,v,!0),d=g.start,g=g.end,Q=this._getvirtualcolumnsindexes(l,r,y,A,v),U=Q.start,X=Q.end;(this.autoheight||this.pageable)&&this.autorowheight&&this._pageviews[0]&&(this._oldpageviewheight=
this._pageviews[0].height);this.autorowheight&&(z=0);if(0<=z){this._updaterowdetailsvisibility();this._startboundindex=null!=w?w[z].bounddata.boundindex:0;this._startvisibleindex=null!=w?w[z].bounddata.visibleindex:0;var N=this.table[0].rows;if(10<this.columns.records.length&&this.enablecolumnsvirtualization)for(var V=function(b){return b.parentNode&&"#document-fragment"!=b.parentNode.nodeName?!0:!1},T=0;T<N.length;T++){for(var Q=N[T],R=0;R<U;R++){var H=R;if(!this.columns.records[H].pinned&&null!=
this.columns.records[H].datafield){var J=Q.cells[H];V(J)&&J.parentNode.removeChild(J);var P=this.columns.records[H].element;this.columns.records[H]._rendered=!1;V(P)&&this.columnsrow[0].removeChild(P);this.filterrow&&V(this.filterrow[0].cells[H])&&this.columns.records[H].filterable&&this.filterrow[0].cells[H].parentNode.removeChild(this.filterrow[0].cells[H])}}for(R=X;R<this.columns.records.length;R++)H=R,this.columns.records[H].pinned||null==this.columns.records[H].datafield||(J=Q.cells[H],V(J)&&
J.parentNode.removeChild(J),P=this.columns.records[H].element,this.columns.records[H]._rendered=!1,V(P)&&this.columnsrow[0].removeChild(P),this.filterrow&&V(this.filterrow[0].cells[H])&&this.columns.records[H].filterable&&this.filterrow[0].cells[H].parentNode.removeChild(this.filterrow[0].cells[H]));for(R=U;R<X;R++)H=R,J=Q.cells[H],V(J)||Q.appendChild(J),P=this.columns.records[H].element,this.columns.records[H]._rendered=!0,P.selectable&&(J.removeAttribute("selected"),P.selected&&J.setAttribute("selected",
"")),V(P)||this.columnsrow[0].appendChild(P),this.filterrow&&!V(this.filterrow[0].cells[H])&&this.columns.records[H].filterable&&this.filterrow[0].firstChild.appendChild(this.filterrow[0].cells[H])}for(T=0;T<G&&D<G;T++){N=void 0!=w?w[z+T]:null;this.virtualmode&&T>=this.source.totalrecords&&(N=null);if(null==N){z=-T;if(this._pagescache[this.dataview.pagenum+1])w=this._pagescache[this.dataview.pagenum+1],this.dataview.pagenum++;else{Q=this._pageviews.length;do if(this.dataview.pagenum<this._pageviews.length-
1)this.dataview.pagenum++,w=void 0,0<this._pageviews[this.dataview.pagenum].height&&(this.dataview.updateview(),this._loadrows(),w=this._pagescache[this.dataview.pagenum]);else{w=void 0;break}while(void 0==w&&this.dataview.pagenum<Q)}void 0!=w&&(N=w[z+T])}if(null!=N){if(N.hidden)continue;this._endboundindex=this._startboundindex+T;this._endvisibleindex=this._startvisibleindex+T;0==T&&(Q=Math.abs(h-N.top),this.table[0].style.top=-Q+"px",F=-Q);Q=this.table[0].rows[D];if(!Q)continue;parseInt(Q.style.height)!=
N.height&&(Q.style.height=parseInt(N.height)+"px");E+=N.height;U=this.rowdetails&&N.rowdetails;X=!N.rowdetailshidden;U&&X&&(Q.style.height=parseInt(N.height-N.rowdetailsheight)+"px",G++);V=this._isrowselected(!0,N);for(R=d;R<g;R++)H=R,this._rendervisualcell(K,M,V,U,X,v,I,Q,N,H,D,t);void 0!=N.group&&this._rendergroup&&this._rendergroup(I,Q,N,y,A,D,r);if(this.autorowheight&&(this.autoheight||this.pageable)){O=this.rowsheight;for(R=d;R<g;R++)this.editable&&this.editcell&&this.editcell.column==this.columns.records[R].datafield&&
this.editcell.row==this.getboundindex(N)&&this.editcell.editor?O=Math.max(O,this.editcell.editor.height()):Q.cells[R].firstChild&&(O=Math.max(O,8+parseInt(Q.cells[R].firstChild.offsetHeight)));Q.style.height=parseInt(O)+"px";this.heights[this._startboundindex+T]=O;U&&X&&(O+=N.rowdetailsheight);N.height=O}this.visiblerows[this.visiblerows.length]=N;this.hittestinfo[this.hittestinfo.length]={row:N,visualrow:Q,details:!1};U&&X&&(D++,Q=this.table[0].rows[D],this._renderrowdetails(M,Q,N,y,A,D),this.visiblerows[this.visiblerows.length]=
N,this.hittestinfo[this.hittestinfo.length]={row:N,visualrow:Q,details:!0});if(!this.autorowheight&&E+F>=q)break}else cansetheight=!0,this._clearvisualrow(l,v,D,y,A),E+C+F<=q&&(C+=O);D++}this._horizontalvalue=l;0<C&&"visible"==this.vScrollBar[0].style.visibility&&(parseInt(this.table.css("top")),l=this._pageviews[this._pageviews.length-1],h=b.max,q=l.top+l.height-q,"visible"==this.hScrollBar.css("visibility")&&(q+=this.scrollbarsize+20),h!=q&&!this.autorowheight&&0<=q&&("deferred"!=this.scrollmode?
(b.max=q,b.setPosition(b.max)):this._newmax!=q&&(this._newmax=q,this._rendervisualrows())))}if((this.autoheight||this.pageable)&&this.autorowheight){this._pagescache=[];for(T=q=b=0;T<this.visiblerows.length;T++)for(h=this.visiblerows[T],h.top=b,b+=h.height,q+=h.height,U=this.rowdetails&&h.rowdetails,X=!h.rowdetailshidden,Q=this.table[0].rows[T],U&&X&&T++,R=d;R<g;R++)l=this.columns.records[R],l.hidden||l.adaptivehidden||l.cellsrenderer||(r=Q.cells[R],t=0,r.firstChild?(t=(h.height-parseInt(r.firstChild.offsetHeight)-
8)/2,U&&X&&(t=(h.height-h.rowdetailsheight-c(r.firstChild).height()-8)/2)):t=(h.height-parseInt(c(r).height())-8)/2,0<=t&&(t=parseInt(t)+4,!r.firstChild||-1!=r.firstChild.className.indexOf("jqx-grid-groups-row")||"checkbox"==l.columntype||"button"==l.columntype||this.editable&&this.editcell&&this.editcell.column==l.datafield&&this.editcell.row==this.getboundindex(h)||(r.firstChild.style.marginTop=t+"px")));this._pageviews[0]&&(this._pageviews[0].height=q);this._arrange()}this._renderemptyrow();this.toCompile&&
0<this.toCompile.length&&c.each(this.toCompile,function(b,d){if(this.compiled)return!0;var e=this.cell;if(!e)return!0;c.jqx.angularCompile&&c.jqx.angularCompile(e,"<div>"+this.value+"</div>");this.compiled=!0})}}},_hideemptyrow:function(){if(this.showemptyrow&&this.table&&this.table[0].rows){var b=this.table[0].rows[0];if(b)for(var d=!1,g=0;g<b.cells.length;g++){var h=c(b.cells[g]);"none"==h.css("display")||d||h.width()!=this.host.width()&&h.text()!=this.gridlocalization.emptydatastring||(h[0].checkbox=
null,h[0].button=null,d=!0,h[0].innerHTML="")}}},_renderemptyrow:function(){if(!this._loading&&0==this.dataview.records.length&&this.showemptyrow){var b=!1,d=this.toTP("jqx-grid-cell");if(this.table&&0<this.table.length&&this.table[0].rows&&0<this.table[0].rows.length){var g=this.table[0].rows[0];this.table[0].style.top="0px";for(var h=0;h<g.cells.length;h++){var l=c(g.cells[h]);if("none"!=l.css("display")&&!b){l[0].checkbox=null;l[0].button=null;l[0].className=d;b=!0;l[0].innerHTML="";var q=c("<span style='white-space: nowrap; float: left; margin-left: 50%; position: relative;'></span>");
q.text(this.gridlocalization.emptydatastring);l.append(q);var r=0;this.oldhscroll||(r=parseInt(this.table[0].style.marginLeft),this.rtl&&(l.css("z-index",999),l.css("overflow","visible")));q.css("left",-r-q.width()/2);q.css("top",this._gettableheight()/2-q.height()/2);c.jqx.browser.msie&&8>c.jqx.browser.version&&(q.css("margin-left","0px"),q.css("left",this.host.width()/2-q.width()/2));q=Math.abs(parseInt(this.table[0].style.top));isNaN(q)&&(q=0);c(g).height(this._gettableheight()+q);l.css("margin-left",
"0px");l.width(this.host.width());this.table.width()<this.host.width()&&this.table.width(this.host.width())}l.addClass(this.toThemeProperty("jqx-grid-empty-cell"))}}}},_clearvisualrows:function(){var b=this.virtualsizeinfo.visiblerecords,d=parseInt(this.hScrollInstance.value),c=this.groupable&&0<this.groups.length;if(this.columns.records)for(var h=0;h<b;h++)this._clearvisualrow(d,c,h,0,this.columns.records.length)},_iscellselected:function(b,d,c){var h=!1,l=0;this.virtualmode&&this.pageable&&this.groupable&&
0<this.groups.length&&(l=this.dataview.pagesize*this.dataview.pagenum);if(0<this.groups.length&&this.pageable&&this.groupable){b=this.getrowboundindexbyid(d.bounddata.uid);if(-1!=b){for(var q in this.selectedcells)q==b+"_"+c&&(h=!0);return h}return!1}if(b&&null!=d.bounddata)if("singlerow"!=this.selectionmode)if(0<this.dataview.filters.length)if(this.virtualmode||void 0==d.bounddata.dataindex)for(q in this.selectedcells)q==l+d.bounddata.boundindex+"_"+c&&(h=!0);else for(q in this.selectedcells)q==
l+d.bounddata.dataindex+"_"+c&&(h=!0);else for(q in this.selectedcells){if(q==l+d.bounddata.boundindex+"_"+c){h=!0;break}}else if(0<this.dataview.filters.length)if(!this.virtualmode&&void 0!=d.bounddata.dataindex)for(q in this.selectedcells){if(q==l+d.bounddata.dataindex+"_"+c){h=!0;break}}else for(q in this.selectedcells){if(q==l+d.bounddata.boundindex+"_"+c){h=!0;break}}else for(q in this.selectedcells)if(q==l+d.bounddata.boundindex==this.selectedrowindex){h=!0;break}return h},_isrowselected:function(b,
d){var c=!1,h=0;this.virtualmode&&this.pageable&&this.groupable&&0<this.groups.length&&(h=this.dataview.pagesize*this.dataview.pagenum);if(this.groupable&&0<this.groups.length&&this.pageable){h=this.getrowboundindexbyid(d.bounddata.uid);if(void 0==h||-1==h)return!1;-1!=this.selectedrowindexes.indexOf(h)&&(c=!0);c||(c=h==this.selectedrowindex&&-1!=this.selectedrowindex);return c}b&&null!=d.bounddata&&("singlerow"!=this.selectionmode?0<this.dataview.filters.length?this.virtualmode||void 0==d.bounddata.dataindex?
-1!=this.selectedrowindexes.indexOf(h+d.bounddata.boundindex)&&(c=!0):-1!=this.selectedrowindexes.indexOf(h+d.bounddata.dataindex)&&(c=!0):-1!=this.selectedrowindexes.indexOf(h+d.bounddata.boundindex)&&(c=!0):0<this.dataview.filters.length?this.virtualmode||void 0==d.bounddata.dataindex?-1!=this.selectedrowindexes.indexOf(h+d.bounddata.boundindex)&&(c=!0):-1!=this.selectedrowindexes.indexOf(h+d.bounddata.dataindex)&&(c=!0):h+d.bounddata.boundindex==this.selectedrowindex&&(c=!0));return c},_rendervisualcell:function(b,
d,g,h,l,q,r,t,v,y,A,w){var z=this.columns.records[y];if(z.hidden||z.adaptivehidden)A=t.cells[y],A.innerHTML="";else{cellvalue=this._getcellvalue(z,v);A=t.cells[y];-1!=this.selectionmode.indexOf("cell")&&(g=0<this.dataview.filters.length?this.selectedcells[v.bounddata.dataindex+"_"+z.datafield]?!0:!1:this.selectedcells[v.boundindex+"_"+z.datafield]?!0:!1,this.editcell&&this.editcell.row===v.boundindex&&this.editcell.column===z.datafield&&"checkbox"!==z.columntype&&(g=!1),this.virtualmode||this.groupable&&
0<this.groups.length&&this.pageable)&&(g=this._iscellselected(!0,v,z.datafield));if(""!=z.cellclassname&&z.cellclassname)if("string"==typeof z.cellclassname)d+=" "+z.cellclassname;else{var C=z.cellclassname(this.getboundindex(v),z.datafield,cellvalue,v.bounddata);C&&(d+=" "+C)}C=this.showsortcolumnbackground&&this.sortcolumn&&z.displayfield==this.sortcolumn;if("many"===this.sortmode&&this.showsortcolumnbackground)for(var D=this.getsortcolumns(),E=0;E<D.length;E++)z.displayfield===D[E].dataField&&
(C=!0);C&&(d+=" "+this.toTP("jqx-grid-cell-sort"));z.filter&&this.showfiltercolumnbackground&&(d+=" "+this.toTP("jqx-grid-cell-filter"));v.bounddata.totalsrow&&(d+=" "+this.toTP("jqx-grid-cell-pinned"));if(z.pinned&&this.showpinnedcolumnbackground||z.grouped)q?v.bounddata.totalsrow||(d+=" "+this.toTP("jqx-grid-cell-pinned")):d+=" "+this.toTP("jqx-grid-cell-pinned");this.altrows&&void 0==v.group&&(D=v.visibleindex,D>=this.altstart&&0==(this.altstart+D)%(1+this.altstep)&&(d=C?d+(" "+this.toTP("jqx-grid-cell-sort-alt")):
d+(" "+this.toTP("jqx-grid-cell-alt")),z.filter&&this.showfiltercolumnbackground&&(d+=" "+this.toTP("jqx-grid-cell-filter-alt")),z.pinned&&this.showpinnedcolumnbackground&&(d+=" "+this.toTP("jqx-grid-cell-pinned-alt"))));if(y<=r){if(q||this.rowdetails||this.pageable&&this.virtualmode)C=c(A),D=this.columns.records[y].width,A.style.width!=parseInt(D)+"px"&&C.width(D)}else(q||this.rowdetails)&&this._hiddencolumns&&(C=c(A),D=this.columns.records[y].width,parseInt(A.style.width)!=D&&C.width(D));if(this.rowdetails&&
h&&(l&&!q?d+=" "+this.toTP("jqx-grid-details-cell"):q&&(d+=" "+this.toTP("jqx-grid-group-details-cell")),this.showrowdetailscolumn))if(!this.rtl){if(void 0==v.group&&y==r&&!v.bounddata.totalsrow){b=this.toThemeProperty("jqx-icon-arrow-down");l?d+=" "+this.toTP("jqx-grid-group-expand"):(d+=" "+this.toTP("jqx-grid-group-collapse"),b=this.toThemeProperty("jqx-icon-arrow-right"));d+=" "+b;A.title="";A.innerHTML="";A.className!=d&&(A.className=d);return}}else if(void 0==v.group&&y==t.cells.length-r-1){b=
this.toThemeProperty("jqx-icon-arrow-down");l?d+=" "+this.toTP("jqx-grid-group-expand-rtl"):(d+=" "+this.toTP("jqx-grid-group-collapse-rtl"),b=this.toThemeProperty("jqx-icon-arrow-left"));d+=" "+b;A.title="";A.innerHTML="";A.className!=d&&(A.className=d);return}g&&y>=r&&(d+=" "+this.toTP("jqx-grid-cell-selected"),d+=" "+this.toTP("jqx-fill-state-pressed"));A.className!=d&&(A.className=d);z._applyCellStyle(A);void 0!=v.group?(cellvalue="",A.title="",A.innerHTML=""):b(this,z,v,cellvalue,A,w)}},_rendercell:function(b,
d,g,h,l,q){var r=h+"_"+d.visibleindex;if("number"==d.columntype||null!=d.cellsrenderer)r=g.uniqueid+"_"+d.visibleindex;"number"==d.columntype&&(h=g.visibleindex);"adaptive"===d.columntype&&(h="...");d._applyCellStyle(l);l.style.borderBottomColor=b.showrowlines?"":"transparent";b.showcolumnheaderlines?(d.element.style.borderRightColor="",d.element.style.boxShadow=""):(d.element.style.borderRightColor="transparent",d.element.style.boxShadow="none");l.style.borderRightColor=b.showcolumnlines?"":"transparent";
if(b.editcell&&void 0==b.editrow)if("selectedrow"==b.editmode&&d.editable&&b.editable){if(b.editcell.row==b.getboundindex(g)&&b._showcelleditor){b.hScrollInstance.isScrolling()||b.vScrollInstance.isScrolling()?b._showcelleditor(b.editcell.row,d,l,!1,!1):b._showcelleditor(b.editcell.row,d,l,b.editcell.init);l.className+=" "+b.toTP("jqx-grid-cell-edit");return}}else if(b.editcell.row==b.getboundindex(g)&&b.editcell.column==d.datafield&&(b.editcell.element=l,b.editcell.editing&&b._showcelleditor)){b.hScrollInstance.isScrolling()||
b.vScrollInstance.isScrolling()?b._showcelleditor(b.editcell.row,d,b.editcell.element,b.editcell.init,!1):b._showcelleditor(b.editcell.row,d,b.editcell.element,b.editcell.init);l.className+=" "+b.toTP("jqx-grid-cell-edit");return}var t=b._defaultcellsrenderer(h,d),v=b._cellscache[r];if(v){if("checkbox"==d.columntype){if(b.host.jqxCheckBox){""===h&&(h=null);r=0==l.innerHTML.toString().length;!l.checkbox||b.groupable||r?b._rendercheckboxcell(b,l,d,g,h):(l.checkboxrow=b.getboundindex(g),""==h&&(h=!1),
"1"==h&&(h=!0),"0"==h&&(h=!1),1==h&&(h=!0),0==h&&(h=!1),"true"==h&&(h=!0),"false"==h&&(h=!1),null!=h||d.threestatecheckbox||(h=!1),d.checkboxcolumn&&(h=!1,0<b.dataview.filters.length&&!b.virtualmode&&void 0!=g.bounddata.dataindex?-1!=b.selectedrowindexes.indexOf(g.bounddata.dataindex)&&(h=!0):-1!=b.selectedrowindexes.indexOf(g.bounddata.boundindex)&&(h=!0)),b.disabled||(l.checkboxinstance?l.checkboxinstance._setState(h):l.checkbox.jqxCheckBox("_setState",h)));null!=d.cellsrenderer&&(b=d.cellsrenderer(b.getboundindex(g),
d.datafield,h,t,d.getcolumnproperties(),g.bounddata),void 0!=b&&(l.innerHTML=b));return}}else if("button"==d.columntype&&b.host.jqxButton){""==h&&(h=!1);null!=d.cellsrenderer&&(h=d.cellsrenderer(b.getboundindex(g),d.datafield,h,t,d.getcolumnproperties(),g.bounddata));""==l.innerHTML&&(l.buttonrow=b.getboundindex(g),l.button=null,b._renderbuttoncell(b,l,d,g,h));l.button&&!b.groupable?(l.buttonrow=b.getboundindex(g),l.button.val(h)):b._renderbuttoncell(b,l,d,g,h);return}if(d.createwidget)if(""==l.innerHTML&&
(l.widgetrow=b.getboundindex(g),l.widget=null,d.widget=null,b._renderwidgetcell(b,l,d,g,h)),l.widget&&!b.groupable)if(l.widgetrow=b.getboundindex(g),d.initwidget)d.initwidget(b.getboundindex(g),d.datafield,h,l.firstChild);else throw Error("jqxGrid: 'initwidget' column function is not implemented. Please, implement 'initwidget'");else b._renderwidgetcell(b,l,d,g,h);else{var y=v.element;null!=d.cellsrenderer||l.childNodes&&0==l.childNodes.length||b.groupable||b.rowdetails?l.innerHTML!=y&&(l.innerHTML=
y):0<=l.innerHTML.indexOf("editor")?l.innerHTML=y:q?(h=y.indexOf(">"),t=y.indexOf("</"),t=y.substring(h+1,t),h=l.childNodes[0],0<=t.indexOf(">")?l.innerHTML=y:h.childNodes[0]?t!=h.childNodes[0].nodeValue&&(0<=t.indexOf("&")?l.innerHTML=y:h.childNodes[0].nodeValue=t):(y=document.createTextNode(t),h.appendChild(y))):l.innerHTML!=y&&(l.innerHTML=y);b.enabletooltips&&d.enabletooltips&&(l.title=v.title)}}else if("checkbox"==d.columntype)b._rendercheckboxcell(b,l,d,g,h),b._cellscache[r]={element:"",title:h},
b.enabletooltips&&d.enabletooltips&&(l.title=""+h);else if("button"==d.columntype)null!=d.cellsrenderer&&(h=d.cellsrenderer(b.getboundindex(g),d.datafield,h,t,d.getcolumnproperties(),g.bounddata)),b._renderbuttoncell(b,l,d,g,h),b._cellscache[r]={element:"",title:h},b.enabletooltips&&d.enabletooltips&&(l.title=""+h);else if("number"==d.columntype&&(h=g.visibleindex),d.createwidget)null!=d.cellsrenderer&&(h=d.cellsrenderer(b.getboundindex(g),d.datafield,h,t,d.getcolumnproperties(),g.bounddata)),b._renderwidgetcell(b,
l,d,g,h),b._cellscache[r]={element:"",title:h},b.enabletooltips&&d.enabletooltips&&(l.title=h);else{if(null!=d.cellsrenderer){if((y=d.cellsrenderer(b.getboundindex(g),d.datafield,h,t,d.getcolumnproperties(),g.bounddata))&&(0<=y.indexOf("<jqx-")||0<=y.indexOf(" ng-"))){b.toCompile&&b.toCompile.push({cell:l,value:y,row:b.getboundindex(g)});return}}else y=t;null==y&&(y=t);v=h;b.enabletooltips&&d.enabletooltips&&(""!=d.cellsformat&&c.jqx.dataFormat&&(c.jqx.dataFormat.isDate(h)?v=c.jqx.dataFormat.formatdate(v,
d.cellsformat,b.gridlocalization):c.jqx.dataFormat.isNumber(h)&&(v=c.jqx.dataFormat.formatnumber(v,d.cellsformat,b.gridlocalization))),l.title=v);b.WinJS?c(l).html(y):(g=l.innerHTML,0<=g.indexOf("editor")||null!=d.cellsrenderer||b.groupable||b.virtualmode?l.innerHTML=y:0<g.length?(h=y.indexOf(">"),t=y.indexOf("</"),t=y.substring(h+1,t),h=l.childNodes[0],0<=t.indexOf(">")?l.innerHTML=y:h.childNodes[0]?t!=h.childNodes[0].nodeValue&&(0<=t.indexOf("&")||0<=g.indexOf("span")?l.innerHTML=y:h.childNodes[0].nodeValue=
t):(y=document.createTextNode(t),h.appendChild(y))):g!=y&&(l.innerHTML=y));b._cellscache[r]={element:l.innerHTML,title:v};return!0}},_isIE10:function(){if(void 0==this._browser){var b=c.jqx.utilities.getBrowser();"msie"==b.browser&&9<parseInt(b.version)?this._browser=!0:(this._browser=!1,"msie"==b.browser&&(b="Browser CodeName: "+navigator.appCodeName+"",b+="Browser Name: "+navigator.appName+"",b+="Browser Version: "+navigator.appVersion+"",b+="Platform: "+navigator.platform+"",b+="User-agent header: "+
navigator.userAgent+"",-1!=b.indexOf("Zune 4.7")&&(this._browser=!0)))}return this._browser},_renderinlinecell:function(b,d,g,h,l){c(d);d.innerHTML='<div style="position: absolute;"></div>'},_rendercheckboxcell:function(b,d,g,h,l){if(b.host.jqxCheckBox){var q=c(d);""===l&&(l=g.threestatecheckbox?null:!1);null!==l||g.threestatecheckbox||(l=!1);"1"==l&&(l=!0);"0"==l&&(l=!1);1==l&&(l=!0);0==l&&(l=!1);"true"==l&&(l=!0);"false"==l&&(l=!1);if(g.checkboxcolumn){l=!1;var r=this.getboundindex(h);-1!=this.selectedrowindexes.indexOf(r)&&
(l=!0)}0==q.find(".jqx-checkbox").length?(d.innerHTML='<div style="position: absolute; top: 50%; left: 50%; margin-top: -9px; margin-left: -12px;"></div>',c(d.firstChild).jqxCheckBox({disabled:b.disabled,_canFocus:!1,hasInput:!1,hasThreeStates:g.threestatecheckbox,enableContainerClick:!1,animationShowDelay:0,animationHideDelay:0,locked:!0,theme:b.theme,checked:l}),this.enabletooltips&&g.enabletooltips&&(d.title=""+l),this.editable&&g.editable&&c(d.firstChild).jqxCheckBox({locked:!1}),g.checkboxcolumn&&
c(d.firstChild).jqxCheckBox({locked:!1}),d.checkbox=c(d.firstChild),d.checkboxinstance=d.checkbox.data().jqxCheckBox.instance,d.checkboxrow=this.getboundindex(h),c.data(d.firstChild,"jqxCheckBox").instance.updated=function(h,l,q){if(b.disabled){l=q;h=b.table[0].rows.length;for(var r=b._getcolumnindex(g.datafield),w=0;w<h;w++){var z=b.table[0].rows[w].cells[r].firstChild;z&&c(z).jqxCheckBox({disabled:b.disabled})}}if(g.editable&&!b.disabled){if(h=b.table[0].rows.length,r=b._getcolumnindex(g.datafield),
void 0==b.editrow)if(g.cellbeginedit&&0==g.cellbeginedit(d.checkboxrow,g.datafield,g.columntype,!l))b.setcellvalue(d.checkboxrow,g.datafield,!l,!0);else{g.cellvaluechanging&&(w=g.cellvaluechanging(d.checkboxrow,g.datafield,g.columntype,q,l),void 0!=w&&(l=w));if("selectedrow"!==b.editmode)for(w=0;w<h;w++)(z=b.table[0].rows[w].cells[r].firstChild)&&c(z).jqxCheckBox("destroy");b.editcell&&0==b.editcell.validated?b.setcellvalue(d.checkboxrow,g.datafield,!l,!0):"selectedrow"!==b.editmode||null==b.editcell?
(h=b.getrowdata(d.checkboxrow),b._raiseEvent(17,{rowindex:d.checkboxrow,row:h,datafield:g.datafield,value:q,columntype:g.columntype}),b.setcellvalue(d.checkboxrow,g.datafield,l,!0),b._raiseEvent(18,{rowindex:d.checkboxrow,row:h,datafield:g.datafield,oldvalue:q,value:l,columntype:g.columntype})):b.setcellvalue(d.checkboxrow,g.datafield,l,!1,!1);g.cellendedit&&g.cellendedit(d.checkboxrow,g.datafield,g.columntype,l)}}else g.checkboxcolumn&&(b.editcell&&b.endcelledit(b.editcell.row,b.editcell.column,
!1,!0),b.disabled||(l?b.selectrow(d.checkboxrow):b.unselectrow(d.checkboxrow),b.autosavestate&&b.savestate&&b.savestate()))}):(d.checkboxrow=this.getboundindex(h),c(d.firstChild).jqxCheckBox("_setState",l,!(this.editable&&g.editable)&&!g.checkboxcolumn))}},_renderwidgetcell:function(b,d,g,h,l){0==c(d).find(".jqx-grid-widget").length?(d.innerHTML='<div class="jqx-grid-widget" style="opacity: 0.99; position: absolute; width: 100%; height:100%; top: 0%; left: 0%; padding: 0px;"></div>',g.createwidget(h,
g.datafield,l,d.firstChild),c(d.firstChild).attr("hideFocus","true"),c(d.firstChild).children().addClass("jqx-grid-widget"),d.widget=c(d.firstChild),d.widgetrow=b.getboundindex(h),g.widget=c(d.firstChild)):(g.initwidget(b.getboundindex(h),g.datafield,l,d.firstChild),d.widgetrow=b.getboundindex(h),c(d.firstChild).val(l))},_renderbuttoncell:function(b,d,g,h,l){if(b.host.jqxButton){var q=c(d);""==l&&(l=!1);0==q.find(".jqx-button").length?(d.innerHTML='<input type="button" style="opacity: 0.99; position: absolute; top: 0%; left: 0%; padding: 0px; margin-top: 2px; margin-left: 2px;"/>',
c(d.firstChild).val(l),c(d.firstChild).attr("hideFocus","true"),c(d.firstChild).jqxButton({disabled:b.disabled,theme:b.theme,height:b.rowsheight-4,width:g.width-4}),d.button=c(d.firstChild),d.buttonrow=b.getboundindex(h),this.isTouchDevice()?(h=c.jqx.mobile.getTouchEventName("touchend"),b.addHandler(c(d.firstChild),h,function(b){g.buttonclick&&g.buttonclick(d.buttonrow,b)})):b.addHandler(c(d.firstChild),"click",function(b){g.buttonclick&&g.buttonclick(d.buttonrow,b)})):(d.buttonrow=b.getboundindex(h),
c(d.firstChild).val(l))}},_clearvisualrow:function(b,d,g,h,l){var q=this.toTP("jqx-grid-cell");d&&(q=" "+this.toTP("jqx-grid-group-cell"));q+=" "+this.toTP("jqx-grid-cleared-cell");d=this.table[0].rows;for(var r=0;r<h+l;r++)if(d[g]){var t=d[g].cells[r];t.className!=q&&(t.className=q);var v=this.columns.records[r];this._horizontalvalue==b||v.pinned||1!=this.oldhscroll||(t.style.marginLeft=-b+"px");var y=v.width;v.adaptivewidth&&(y=v.adaptivewidth);y<v.minwidth&&(y=v.minwidth);y>v.maxwidth&&(y=v.maxwidth);
parseInt(t.style.width)!=y&&("auto"!=y?c(t)[0].style.width=y+"px":c(t)[0].style.width=y);""!=t.title&&(t.title="");""!=t.innerHTML&&(t.innerHTML="")}d[g]&&parseInt(d[g].style.height)!=this.rowsheight&&(d[g].style.height=parseInt(this.rowsheight)+"px")},_findgroupstate:function(b){b=this._findgroup(b);return null==b?!1:b.expanded},_findgroup:function(b){return this.expandedgroups[b]?this.expandedgroups[b]:null},_clearcaches:function(){this._columnsbydatafield=[];this._pagescache=[];this._pageviews=
[];this._cellscache=[];this.heights=[];this.hiddens=[];this.hiddenboundrows=[];this.heightboundrows=[];this.detailboundrows=[];this.details=[];this.expandedgroups=[];this._rowdetailscache=[];this._rowdetailselementscache=[];c.jqx.dataFormat&&c.jqx.dataFormat.cleardatescache();this.tableheight=null},_getColumnText:function(b){void 0==this._columnsbydatafield&&(this._columnsbydatafield=[]);if(this._columnsbydatafield[b])return this._columnsbydatafield[b];var d=b,g=null;c.each(this.columns.records,function(){if(this.datafield==
b||this.displayfield==b)return d=this.text,g=this,!1});this._columnsbydatafield[b]={label:d,column:g};return this._columnsbydatafield[b]},_getcolumnbydatafield:function(b){void 0==this.__columnsbydatafield&&(this.__columnsbydatafield=[]);if(this.__columnsbydatafield[b])return this.__columnsbydatafield[b];var d=null;c.each(this.columns.records,function(){if(this.datafield==b||this.displayfield==b)return d=this,!1});this.__columnsbydatafield[b]=d;return this.__columnsbydatafield[b]},isscrollingvertically:function(){return this.vScrollBar.jqxScrollBar("isScrolling")},
_renderrowdetails:function(b,d,g,h,l,q){if(void 0!=d){var r=c(d);q=this.rowdetails&&this.showrowdetailscolumn?(1+this.groups.length)*this.groupindentwidth:this.groups.length*this.groupindentwidth;if(this.groupable&&0<this.groups.length)for(var t=0;t<=l;t++){var v=c(d.cells[t]);v[0].innerHTML="";v[0].className="jqx-grid-details-cell"}v=c(d.cells[0]);if("none"==v[0].style.display){v=d.cells[0];for(t=2;void 0!=v&&"none"==v.style.display&&10>t;)v=d.cells[0+t-1],t++;v=c(v)}if(this.rtl)for(;h<l;h++)d.cells[h].innerHTML=
"",d.cells[h].className="jqx-grid-details-cell";v.css("width","100%");r.height(g.rowdetailsheight);v[0].className=b;b=this.getboundindex(g);l=b+"_";this._rowdetailscache[l]?(d=this._rowdetailscache[l].html,this.initrowdetails?this._rowdetailscache[l].element&&(d=this._rowdetailscache[l].element,v=v.coord(),h=this.gridcontent.coord(),g=parseInt(v.top)-parseInt(h.top),v=parseInt(v.left)-parseInt(h.left),this.rtl&&(v=0),c(d).css("top",g),c(d).css("left",v),c(d).css("display","block"),c(d).width(this.host.width()-
q),this.layoutrowdetails&&this.layoutrowdetails(b,d,this.element,this.getrowdata(b))):v[0].innerHTML=d):(v[0].innerHTML="",this.enablerowdetailsindent||(q=0),h='<div class="jqx-enableselect" role="rowgroup" style="border: none; overflow: hidden; width: 100%; height: 100%; margin-left: '+q+'px;">'+g.rowdetails+"</div>",this.rtl&&(h='<div class="jqx-enableselect" role="rowgroup" style="border: none; overflow: hidden; width: 100%; height: 100%; margin-left: 0px; margin-right: '+q+'px;">'+g.rowdetails+
"</div>"),this._rowdetailscache[l]={id:d.id,html:h},this.initrowdetails?(d=c(h)[0],c(this.gridcontent).prepend(c(d)),c(d).css("position","absolute"),c(d).width(this.host.width()-q),c(d).height(v.height()),v.coord(),c(d).css("z-index",599),this.isTouchDevice()&&c(d).css("z-index",999),c(d).addClass(this.toThemeProperty("jqx-widget-content")),v=v.coord(),h=this.gridcontent.coord(),g=parseInt(v.top)-parseInt(h.top),v=parseInt(v.left)-parseInt(h.left),c(d).css("top",g),c(d).css("left",v),this.content[0].scrollTop=
0,this.content[0].scrollLeft=0,q=c(c(d).children()[0]),""!=q[0].id&&(q[0].id+=b),this.initrowdetails(b,d,this.element,this.getrowdata(b)),this._rowdetailscache[l].element=d,this._rowdetailselementscache[b]=d):v[0].innerHTML=h)}},_defaultcellsrenderer:function(b,d){""!=d.cellsformat&&c.jqx.dataFormat&&(c.jqx.dataFormat.isDate(b)?b=c.jqx.dataFormat.formatdate(b,d.cellsformat,this.gridlocalization):c.jqx.dataFormat.isNumber(b)&&(b=c.jqx.dataFormat.formatnumber(b,d.cellsformat,this.gridlocalization)));
var g="8px";31!=this.rowsheight&&(g=this.rowsheight/2-this._cellheight/2,0>g&&(g=4),g+="px");if(this.enableellipsis){if("center"==d.cellsalign||"middle"==d.cellsalign)return'<div class="jqx-grid-cell-middle-align" style="margin-top: '+g+';">'+b+"</div>";if("left"==d.cellsalign)return'<div class="jqx-grid-cell-left-align" style="margin-top: '+g+';">'+b+"</div>";if("right"==d.cellsalign)return'<div class="jqx-grid-cell-right-align" style="margin-top: '+g+';">'+b+"</div>"}return"center"==d.cellsalign||
"middle"==d.cellsalign?'<div style="text-align: center; margin-top: '+g+';">'+b+"</div>":'<span style="margin-left: 4px; margin-right: 2px; margin-top: '+g+"; float: "+d.cellsalign+';">'+b+"</span>"},getcelltext:function(b,d){if(null==b||null==d)return null;var g=this.getcellvalue(b,d),h=this.getcolumn(d);h&&""!=h.cellsformat&&c.jqx.dataFormat&&(c.jqx.dataFormat.isDate(g)?g=c.jqx.dataFormat.formatdate(g,h.cellsformat,this.gridlocalization):c.jqx.dataFormat.isNumber(g)&&(g=c.jqx.dataFormat.formatnumber(g,
h.cellsformat,this.gridlocalization)));return g},getcelltextbyid:function(b,d){if(null==b||null==d)return null;var g=this.getcellvaluebyid(b,d),h=this.getcolumn(d);h&&""!=h.cellsformat&&c.jqx.dataFormat&&(c.jqx.dataFormat.isDate(g)?g=c.jqx.dataFormat.formatdate(g,h.cellsformat,this.gridlocalization):c.jqx.dataFormat.isNumber(g)&&(g=c.jqx.dataFormat.formatnumber(g,h.cellsformat,this.gridlocalization)));return g},_getcellvalue:function(b,d){var c;c=d.bounddata[b.datafield];null!=b.displayfield&&(c=
d.bounddata[b.displayfield]);null==c&&(c="");return c},getcell:function(b,d){if(null==b||null==d)return null;var c=parseInt(b),h=b,l="";isNaN(c)||(h=this.getrowdata(c));null!=h&&(l=h[d]);return this._getcellresult(l,b,d)},getrenderedcell:function(b,d){if(null==b||null==d)return null;var c=parseInt(b),h=b,l="";isNaN(c)||(h=this.getrenderedrowdata(c));null!=h&&(l=h[d]);return this._getcellresult(l,b,d)},_getcellresult:function(b,d,c){var h=this.getcolumn(c);if(null==h||void 0==h)return null;var l=h.getcolumnproperties(),
h=l.hidden,q=l.width,r=l.pinned,t=l.cellsalign,l=l.cellsformat,v=this.getrowheight(d);return 0==v?null:{value:b,row:d,column:c,datafield:c,width:q,height:v,hidden:h,pinned:r,align:t,format:l}},setcellvaluebyid:function(b,d,c,h,l){b=this.getrowboundindexbyid(b);return this.setcellvalue(b,d,c,h,l)},getcellvaluebyid:function(b,d){var c=this.getrowboundindexbyid(b);return this.getcellvalue(c,d)},setcellvalue:function(b,d,g,h,l){if(null==b||null==d)return!1;var q=parseInt(b),r=b;isNaN(q)||(r=this.getrowdata(q));
var t=!1;this.filterable&&this._initfilterpanel&&this.dataview.filters.length&&(t=!0);this.virtualmode&&(this._pagescache=[]);this.sortcache&&(this.sortcache={});var v="",y="";if(null!=r&&r[d]!==g){if(null===r[d]&&""===g)return;var A=this._getcolumnbydatafield(d),w="string",z=this.source.datafields||(this.source._source?this.source._source.datafields:null);if(z){var C="";c.each(z,function(){if(this.name==A.displayfield)return this.type&&(C=this.type),!1});C&&(w=C);y=r[A.displayfield]}v=r[d];if(!A.nullable||
null!=g&&""!==g&&A.nullable&&void 0===g.label)if(c.jqx.dataFormat.isNumber(v)||"number"==w||"float"==w||"int"==w||"decimal"==w&&"date"!=w?(this.gridlocalization&&","==this.gridlocalization.decimalseparator&&g&&g.indexOf&&0<=g.indexOf(",")&&(g=g.replace(",",".")),g=new Number(g),g=parseFloat(g),isNaN(g)&&(g=0)):!c.jqx.dataFormat.isDate(v)&&"date"!=w||""==g||(z=new Date(g),"Invalid Date"!=z&&null!=z?g=z:"Invalid Date"==z&&(g=z=new Date)),r[d]===g){this._updating||0==h||this._renderrows(this.virtualsizeinfo);
return}z=this.source&&this.source._source.localdata&&"observableArray"===this.source._source.localdata.name;r[d]=g;if(z){var D=this.source._source.localdata;D._updating||(D._updating=!0,D[b][d]=g,D._updating=!1)}w=this.getrenderedrowdata(q,!0);if(!w)return;w[d]=g;null!=g&&null!=g.label&&(A=this._getcolumnbydatafield(d),r[A.displayfield]=g.label,w[A.displayfield]=g.label,r[d]=g.value,w[d]=g.value,z&&!D._updating&&(D._updating=!0,D[b][d]=g.value,D[b][A.displayfield]=g.label,D._updating=!1));t&&void 0!=
r.dataindex&&(this.dataview.cachedrecords[r.dataindex][d]=g,null!=g&&void 0!=g.label&&(this.dataview.cachedrecords[r.dataindex][d]=g.value,this.dataview.cachedrecords[r.dataindex][A.displayfield]=g.label))}else return this._updating||0==h||this._renderrows(this.virtualsizeinfo),!1;if(this.source&&this.source._knockoutdatasource&&!this._updateFromAdapter&&this.autokoupdates&&this.source._source._localdata){D=q;t&&void 0!=r.dataindex&&(D=r.dataindex);D=this.source._source._localdata()[D];this.source.suspendKO=
!0;if(D[d]&&D[d].subscribe)if(null!=g&&null!=g.label)D[A.displayfield](g.label),D[d](g.value);else D[d](g);else{var z=this.source._source.datafields,E=null;z&&c.each(z,function(){if(this.name==d)return E=this.map,!1});if(null==E)null!=g&&null!=g.label?(D[d]=g.value,D[A.displayfield]=g.label):D[d]=g;else if(z=E.split(this.source.mapChar),0<z.length){for(var w=D,F=0;F<z.length-1;F++)w=w[z[F]];w[z[z.length-1]]=g}this.source._source._localdata.replace(D,c.extend({},D))}this.source.suspendKO=!1}if(this.sortcolumn&&
this.dataview.sortby&&!this._updating)if(D=this.getsortinformation(),this.sortcolumn==d&&"many"!==this.sortmode)this.dataview.clearsortdata(),this.dataview.sortby(D.sortcolumn,D.sortdirection.ascending);else{if("many"===this.sortmode)for(D=this.getsortcolumns(),this.dataview.clearsortdata(),this.sortby(null),z=0;z<D.length;z++)this.sortby(D[z].dataField,D[z].ascending)}else this._updating||this.dataview.sortby&&this.dataview.sortcache[d]&&(this.dataview.sortcache[d]=null);this._cellscache=[];this._pagescache=
[];if(this.source.updaterow&&(void 0==l||1==l)){l=!1;var G=this.that,D=function(c){0==c&&(G.setcellvalue(b,d,v,!0,!1),v!=y&&G.setcellvalue(b,G.getcolumn(d).displayfield,y,!0,!1))};try{var I=this.getrowid(q);l=this.source.updaterow(I,r,D);void 0==l&&(l=!0)}catch(M){l=!1;G.setcellvalue(b,d,v,!0,!1);v!=y&&G.setcellvalue(b,G.getcolumn(d).displayfield,y,!0,!1);return}}q=this.vScrollInstance.value;this._updating&&1!=h&&(h=!1);if(1==h||void 0==h)if(G=this.that,h=function(){G.pageable&&G.updatepagerdetails&&
(G.updatepagerdetails(),(G.autoheight||G.autorowheight)&&G._updatepageviews())},r=this.groupable&&0<this.groups.length,t&&!r){if(this.autoheight||this.autorowheight)this.prerenderrequired=!0;this.dataview.refresh();this.rendergridcontent(!0,!1);h();this._renderrows(this.virtualsizeinfo)}else if(this.sortcolumn&&!r){if(this.autoheight||this.autorowheight)this.prerenderrequired=!0;this.dataview.reloaddata();this.rendergridcontent(!0,!1);h();this._renderrows(this.virtualsizeinfo)}else if(this.groupable&&
0<this.groups.length){if(this.autoheight||this.autorowheight)this.prerenderrequired=!0;this.pageable?-1!=this.groups.indexOf(d)?(this._pagescache=[],this._cellscache=[],this.dataview.refresh(),this._render(!0,!0,!1,!1)):(this._pagescache=[],this._cellscache=[],this.dataview.updateview(),this._renderrows(this.virtualsizeinfo)):(this._pagescache=[],this._cellscache=[],this.dataview.updateview(),this._renderrows(this.virtualsizeinfo))}else this.dataview.updateview(),this._renderrows(this.virtualsizeinfo);
this.vScrollInstance.setPosition(q);this.showaggregates&&this._updatecolumnsaggregates&&this._updatecolumnsaggregates();this.showfilterrow&&this.filterable&&this.filterrow&&(t=this.getcolumn(d).filtertype,"list"!=t&&"checkedlist"!=t||this._updatelistfilters(!0));this._raiseEvent(19,{rowindex:b,datafield:d,newvalue:g,value:g,oldvalue:v});return!0},getcellvalue:function(b,d){if(null==b||null==d)return null;var c=parseInt(b),h=b;isNaN(c)||(h=this.getrowdata(c));return null!=h?h[d]:null},getrows:function(){var b=
this.dataview.records.length;if(this.virtualmode){for(var d=[],g=0;g<this.dataview.records.length;g++)(b=this.dataview.records[g])&&d.push(b);void 0===this.dataview.records.length&&c.each(this.dataview.records,function(){this&&d.push(this)});g=0;this.pageable&&(g=this.dataview.pagenum*this.dataview.pagesize);return d.length>this.source._source.totalrecords-g?d.slice(0,this.source._source.totalrecords-g):d}if(this.dataview.sortdata){d=[];for(g=0;g<b;g++){var h={},h=c.extend({},this.dataview.sortdata[g].value);
d[g]=h}return d}return this.dataview.records},getrowboundindexbyid:function(b){var d=this.dataview.recordsbyid["id"+b];if(d&&d.boundindex)return this.getboundindex(d);for(var d=this.getboundrows(),c=0;c<d.length;c++)if(d[c]&&d[c].uid==b)return c;return-1},getrowdatabyid:function(b){var d=this.dataview.recordsbyid["id"+b];if(d)return d;b=this.getrowboundindexbyid(b);return this.getboundrows()[b]},getrowdata:function(b){void 0==b&&(b=0);return this.virtualmode?this.dataview.records[b]:this.getboundrows()[b]},
getrenderedrowdata:function(b,d){void 0==b&&(b=0);if(this.virtualmode){var c=this.getrowvisibleindex(b);return c=this.dataview.loadedrecords[c]}c=this.getrowvisibleindex(b);return 0<=c?(this.groupable&&0<this.groups.length?c=this.dataview.loadedrecords[c]:(c=this.dataview.loadedrecords[c],!this.pageable||void 0!=d&&0!=d||(c=this.dataview.loadedrecords[this.dataview.pagesize*this.dataview.pagenum+b])),c):null},getboundrows:function(){return this.dataview.cachedrecords},getrowdisplayindex:function(b){for(var d=
this.getdisplayrows(),c=0;c<d.length;c++)if(d[c])if(void 0!==d[c].dataindex){if(d[c].dataindex==b)return d[c].visibleindex}else if(d[c].boundindex==b)return d[c].visibleindex;return-1},getboundindex:function(b){var d=b.boundindex;this.groupable&&0<this.groups.length&&this.pageable&&b.bounddata&&(d=this.getrowboundindexbyid(b.bounddata.uid));0<this.dataview.filters.length&&(b.bounddata?void 0!==b.bounddata.dataindex&&(d=b.bounddata.dataindex):void 0!==b.dataindex&&(d=b.dataindex));return d},getrowboundindex:function(b){return(b=
this.getdisplayrows()[b])?void 0!==b.dataindex?b.dataindex:b.boundindex:-1},getdisplayrows:function(){return this.dataview.loadedrecords},getloadedrows:function(){return this.getdisplayrows()},getvisiblerowdata:function(b){var d=this.getvisiblerows();return d?d[b]:null},getloadedrowdata:function(b){var d=this.getloadedrows();return d?d[b]:null},getvisiblerows:function(){if(this.virtualmode)return this.dataview.loadedrecords;if(this.pageable){for(var b=[],d=0;d<this.dataview.pagesize;d++){var c=this.dataview.loadedrecords[d+
this.dataview.pagesize*this.dataview.pagenum];if(void 0==c)break;b.push(c)}return b}if(void 0!=this._startboundindex&&void 0!=this._endboundindex){b=[];for(d=this._startvisibleindex;d<=this._endvisibleindex;d++){c=this.dataview.loadedrecords[d];if(void 0==c)break;b.push(c)}return b}return this.dataview.loadedrecords},getrowid:function(b){void 0==b&&(b=0);if(this.virtualmode){var d=this.getrowvisibleindex(b);if(d=this.dataview.loadedrecords[d])return d.uid}else if(d=0<this.dataview.filters.length,
0<=b&&b<this.dataview.bounditems.length&&!d&&(d=this.getrowvisibleindex(b),d=this.dataview.loadedrecords[d])||0<this.dataview.filters.length&&(d=this.getboundrows()[b])&&null!=d.uid)return d.uid;return null},_updateGridData:function(b){var d=!1;this.filterable&&this._initfilterpanel&&this.dataview.filters.length&&(d=!0);d?(this.dataview.refresh(),"updaterow"==b?(this._render(!0,!0,!1,!1,!1),this.invalidate()):this.render()):this.sortcolumn||this.groupable&&0<this.groups.length?(this.dataview.reloaddata(),
this.render()):("updaterow"===b&&(this.dataview.refresh(),this.virtualmode||this._render(!0,!0,!1,!1,!1)),this._cellscache=[],this._pagescache=[],this._renderrows(this.virtualsizeinfo));this.showfilterrow&&this.filterable&&this.filterrow&&this._updatelistfilters(!0)},updaterow:function(b,d,g){if(void 0!=b&&void 0!=d){var h=this.that,l=!1;h._datachanged=!0;var q=function(b,d,e){if(b._loading)throw Error("jqxGrid: "+b.loadingerrormessage);var f=!1;c.isArray(d)?(c.each(d,function(d,c){f=b.dataview.updaterow(this,
e[d],!1)}),b._cellscache=[],b._pagescache=[],b.dataview.refresh()):f=b.dataview.updaterow(d,e);var h=b.vScrollInstance.value;if(void 0==g||1==g)void 0!=b._updating&&0!=b._updating||b._updateGridData("updaterow");b.showaggregates&&b._updatecolumnsaggregates&&b._updatecolumnsaggregates();if(b.source&&b.source._knockoutdatasource&&!b._updateFromAdapter&&b.autokoupdates&&b.source._source._localdata){var l=b.dataview.recordsbyid["id"+d],q=b.dataview.records.indexOf(l),q=b.source._source._localdata()[q];
b.source.suspendKO=!0;b.source._source._localdata.replace(q,c.extend({},l));b.source.suspendKO=!1}b.source&&b.source._source.localdata&&"observableArray"===b.source._source.localdata.name&&!b.source._source.localdata._updating&&(b.source._source.localdata._updating=!0,d=b.getrowboundindexbyid(d),b.source._source.localdata.set(d,e),b.source._source.localdata._updating=!1);b.vScrollInstance.setPosition(h);return f};if(this.source.updaterow){var r=function(c){1==c||void 0==c?q(h,b,d):l=!1};try{l=this.source.updaterow(b,
d,r),void 0==l&&(l=!0)}catch(t){l=!1}}else l=q(h,b,d);return l}return!1},deleterow:function(b,d){if(void 0!=b){this._datachanged=!0;var g=!1,h=this.that,l=this.getrowboundindexbyid(b),q=[];if(void 0!=l&&(0<=this.selectedrowindexes.indexOf(l)&&this.selectedrowindexes.splice(this.selectedrowindexes.indexOf(l),1),this.selectedrowindex==l&&(this.selectedrowindex=-1),!this.virtualmode))if(0<=h.selectionmode.indexOf("row"))c.each(this.selectedrowindexes,function(){var b=h.getrowid(this);q.push(b)}),this.selectedrowindexes=
[],this.selectedrowindex=-1;else if(0<=h.selectionmode.indexOf("cell"))for(var r in h.selectedcells){var t=h.selectedcells[r],v=h.getrowid(t.rowindex);t.rowid=v}var y=function(b,e){if(b._loading)throw Error("jqxGrid: "+b.loadingerrormessage);var g=!1,h=b.vScrollInstance.value;c.isArray(e)?(c.each(e,function(){g=b.dataview.deleterow(this,!1)}),b._cellscache=[],b._pagescache=[],b.dataview.refresh()):g=b.dataview.deleterow(e);if(!b.virtualmode)if(0<=b.selectionmode.indexOf("row"))c.each(q,function(){var d=
b.getrowboundindexbyid(this);-1!=d&&b.selectrow(d,!1)});else{var r=[],t;for(t in b.selectedcells){var y=b.selectedcells[t],v=b.getrowboundindexbyid(y.rowid);-1!=v&&(y.rowindex=v,r[v+"_"+y.datafield]=y)}b.selectedcells=r}if(void 0==b._updating||0==b._updating)void 0!=d&&1!=d||setTimeout(function(){b._render(!0,!0,!1,!1);"visible"!=b.vScrollBar.css("visibility")&&(b._arrange(),b._updatecolumnwidths(),b._updatecellwidths(),b._renderrows(b.virtualsizeinfo))});b.source&&b.source._knockoutdatasource&&!b._updateFromAdapter&&
b.autokoupdates&&b.source._source._localdata&&(b.source.suspendKO=!0,b.source._source._localdata.pop(rowdata),b.source.suspendKO=!1);b.source&&b.source._source.localdata&&"observableArray"===b.source._source.localdata.name&&!b.source._source.localdata._updating&&(b.source._source.localdata._updating=!0,b.source._source.localdata.splice(l,1),b.source._source.localdata._updating=!1);b.dataview.sortby&&"many"!==b.sortmode&&(r=b.getsortinformation(),r.sortcolumn&&(b.dataview.clearsortdata(),b.dataview.sortby(r.sortcolumn,
r.sortdirection?r.sortdirection.ascending:null)));b.vScrollInstance.setPosition(h);return g};if(this.source.deleterow){r=function(d){1!=d&&void 0!=d||y(h,b)};try{this.source.deleterow(b,r),void 0==g&&(g=!0)}catch(A){g=!1}}else g=y(h,b);return g}return!1},addrow:function(b,d,g){if(void 0!=d){this._datachanged=!0;void 0==g&&(g="last");var h=!1,l=this.that;if(null==b){var q=this.dataview.filters&&0<this.dataview.filters.length?this.dataview.cachedrecords.length:this.dataview.totalrecords;if(c.isArray(d)){var r=
[];c.each(d,function(b,e){var c=l.dataview.getid(l.dataview.source.id,d[b],q+b);r.push(c)});b=r}else for(b=this.dataview.getid(this.dataview.source.id,d,q);null!=this.dataview.recordsbyid["id"+b];)b++}var t=function(b,d,e,f){if(b._loading)throw Error("jqxGrid: "+b.loadingerrormessage);var g=b.vScrollInstance.value,h=!1;c.isArray(e)?(c.each(e,function(e,c){void 0!=this.dataindex&&delete this.dataindex;var g=null;null!=d&&null!=d[e]&&(g=d[e]);h=b.dataview.addrow(g,this,f,!1)}),b._cellscache=[],b._pagescache=
[],b.dataview.refresh()):(void 0!=e&&void 0!=e.dataindex&&delete e.dataindex,h=b.dataview.addrow(d,e,f));if(void 0==b._updating||0==b._updating)b._render(!0,!0,!1,!1),b.invalidate();b.source&&b.source._knockoutdatasource&&!b._updateFromAdapter&&b.autokoupdates&&b.source._source._localdata&&(b.source.suspendKO=!0,b.source._source._localdata.push(e),b.source.suspendKO=!1);if(b.source&&b.source._source.localdata&&"observableArray"===b.source._source.localdata.name&&!b.source._source.localdata._updating){b.source._source.localdata._updating=
!0;var l=b.getrowboundindexbyid(d);b.source._source.localdata.set(l,e);b.source._source.localdata._updating=!1}"deferred"!=b.scrollmode?b.vScrollInstance.setPosition(g):b.vScrollInstance.setPosition(0);return h};if(this.source.addrow){var v=function(c,h){if(1==c||void 0==c)void 0!=h&&(b=h),t(l,b,d,g)};try{h=this.source.addrow(b,d,g,v),void 0==h&&(h=!0)}catch(y){h=!1}if(0==h)return!1}else t(this,b,d,g);return h}return!1},_findvisiblerow:function(b,d){void 0==b&&(b=parseInt(this.vScrollInstance.value));
var c=0;if(void 0==d||null==d)d=this.rows.records;for(var h=d.length;c<=h;){mid=parseInt((c+h)/2);var l=d[mid];if(void 0==l)break;if(l.top>b&&l.top+l.height>b)h=mid-1;else if(l.top<b&&l.top+l.height<b)c=mid+1;else return mid}return-1},_updatecellwidths:function(){var b=this.virtualsizeinfo;if(b){var d=this.that;if(void 0!=d.gridcontent){void 0==d.table&&(d.table=d.gridcontent.find("#contenttable"+d.element.id));var c=d.groupable&&0<d.groups.length,h=0,b=b.visiblerecords;d.pageable&&(d.autoheight||
d.autorowheight)&&(b=d.dataview.pagesize,d.groupable&&(d.dataview.updateview(),b=d.dataview.rows.length));d.groupable||d.pageable||!d.autoheight&&!d.autorowheight||(b=d.dataview.totalrecords);d.rowdetails&&(b+=d.dataview.pagesize);if(d.columns.records){for(var l=d.columns.records.length,q=d.table[0].rows,r=0;r<b;r++){var t=q[r];if(!t)break;for(var t=t.cells,v=0,y=0;y<l;y++){var A=d.columns.records[y],w=A.width;A.adaptivewidth&&(w=A.adaptivewidth);var z=t[y];parseInt(z.style.left)!=v&&(z.style.left=
v+"px");parseInt(z.style.width)!=w&&(z.style.width=w+"px");A.hidden&&A.hideable||A.adaptivehidden?z.style.display="none":v+=parseFloat(w)}0==h&&(d.table.width(parseFloat(v)+2),h=v)}d.showaggregates&&d._updateaggregates&&d._updateaggregates();d.showfilterrow&&d.filterable&&d._updatefilterrowui&&d._updatefilterrowui();d.showeverpresentrow&&d._updateaddnewrowui();d._updatescrollbarsafterrowsprerender();c&&d._renderrows(d.virtualsizeinfo)}}}},_updatescrollbarsafterrowsprerender:function(){var b=this.that,
d=b.hScrollBar[0].style.visibility,c=0,h=b.vScrollBar[0].style.visibility;"visible"==h&&(c=b.scrollbarsize+3);0==b.scrollbarsize&&(c=0);b.scrollbarautoshow&&(c=0);var l=b.element.style.width,l=0<=l.toString().indexOf("%")?b.host.width():parseInt(l);parseInt(b.table[0].style.width)-2>l-c?("visible"!=d&&(b.autowidth||(b.hScrollBar[0].style.visibility="visible"),b._arrange()),"visible"==h?"deferred"==b.scrollmode||b.virtualmode?b._updatevscrollbarmax():b.virtualsizeinfo&&(h=b.virtualsizeinfo.virtualheight-
b._gettableheight(),!isNaN(h)&&0<h&&("hidden"!=d?b.vScrollBar.jqxScrollBar("max",h+b.scrollbarsize+4):b.vScrollBar.jqxScrollBar("max",h))):c=-2,b.hScrollBar.jqxScrollBar("max",c+b.table.width()-b.host.width())):"hidden"!=d&&(b.hScrollBar.css("visibility","hidden"),b._arrange());b._renderhorizontalscroll()},_hascolumnstyle:function(){if(void 0!==this._hascolumnstyles)return this._hascolumnstyles;this._hascolumnstyles=!1;for(var b=0;b<this.columns.records.length;b++){var d=this.columns.records[b];if(d.style.headerBackgroundColor||
d.style.headerColor||d.style.headerBackgroundHoveredColor||d.style.headerHoveredColor||d.style.headerBackgroundSelectedColor||d.style.headerSelectedColor||d.style.backgroundColor||d.style.color||d.style.backgroundHoveredColor||d.style.hoveredColor||d.style.backgroundSelectedColor||d.style.selectedColor)return this._hascolumnstyles=!0}return!1},_prerenderrows:function(b){var d=this.that;if(1==d.prerenderrequired&&(d.prerenderrequired=!1,d.editable&&d._destroyeditors&&d._destroyeditors(),void 0!=d.gridcontent)){d.gridcontent.find("#contenttable"+
d.element.id).remove();null!=d.table&&(d.table.remove(),d.table=null);d.table=c('<div id="contenttable'+d.element.id+'" style="overflow: hidden; position: relative;"></div>');d.gridcontent.addClass(d.toTP("jqx-grid-content"));d.gridcontent.addClass(d.toTP("jqx-widget-content"));d.gridcontent.append(d.table);var g=d.groupable&&0<d.groups.length,h=0;d.table[0].rows=[];var l=d.toTP("jqx-grid-cell");g&&(l=" "+d.toTP("jqx-grid-group-cell"));b=b.visiblerecords;d.pageable&&(d.autoheight||d.autorowheight)&&
(b=d.dataview.pagesize,d.groupable&&(d.dataview.updateview(),b=d.dataview.rows.length,b<d.dataview.pagesize&&(b=d.dataview.pagesize)));d.pageable||!d.autoheight&&!d.autorowheight||(b=d.dataview.totalrecords);d.groupable&&0<d.groups.length&&(d.autoheight||d.autorowheight)&&!d.pageable&&(b=d.dataview.rows.length);d.rowdetails&&(b=d.autoheight||d.autorowheight?b+d.dataview.pagesize:b+b);if(d.columns.records){g=d.columns.records.length;c.jqx.browser.msie&&8<c.jqx.browser.version&&d.table.css("opacity",
"0.99");-1!=navigator.userAgent.indexOf("Safari")&&d.table.css("opacity","0.99");var q=c.jqx.browser.msie&&8>c.jqx.browser.version;q&&d.host.attr("hideFocus","true");var r=d.tableZIndex;b*g>r&&(r=b*g);d.isTouchDevice();var t="";d._hiddencolumns=!1;for(var v=5+d.columns.records.length,y=0;y<b;y++){var A='<div role="row" style="position: relative; height:'+d.rowsheight+'px;" id="row'+y+d.element.id+'">';q&&(A='<div role="row" style="position: relative; z-index: '+r+"; height:"+d.rowsheight+'px;" id="row'+
y+d.element.id+'">',r--);for(var w=0,z=0;z<g;z++){var C=d.columns.records[z],D=C.width;D<C.minwidth&&(D=C.minwidth);D>C.maxwidth&&(D=C.maxwidth);if(d.rtl){var E='<div columnindex="'+z+'" role="gridcell" style="left: '+w+"px; z-index: "+(r-g+2*z)+"; width:"+D+"px;";r--}else E='<div columnindex="'+z+'" role="gridcell" style="left: '+w+"px; z-index: "+r--+"; width:"+D+"px;";C.hidden&&C.hideable||C.adaptivehidden?(E+="display: none;",d._hiddencolumns=!0,r++):w+=D;0===y&&0===z&&(E+='" tabindex="'+v+'"');
E+='" class="'+l+'">';C=this._defaultcellsrenderer("",C);E+=C;E+="</div>";A+=E}0==h&&(d.table.width(parseInt(w)+2),h=w);A+="</div>";t+=A}d.WinJS?MSApp.execUnsafeLocalFunction(function(){d.table.html(t)}):d.table[0].innerHTML=t;d.table[0].rows=[];h=d.table.children();for(y=0;y<b;y++)for(q=h[y],d.table[0].rows.push(q),q.cells=[],v=c(q).children(),z=0;z<g;z++)q.cells.push(v[z]);if(0==b){w=0;d.showemptyrow&&(A=c('<div style="position: relative;" id="row0'+d.element.id+'"></div>'),d.table.append(A),A.height(d.rowsheight),
d.table[0].rows[0]=A[0],d.table[0].rows[0].cells=[]);for(z=0;z<g;z++)C=d.columns.records[z],D=C.width,d.showemptyrow&&(E=c('<div style="position: absolute; height: 100%; left: '+w+"px; z-index: "+r--+"; width:"+D+'px;" class="'+l+'"></div>'),E.height(d.rowsheight),A.append(E),d.table[0].rows[0].cells[z]=E[0]),D<C.minwidth&&(D=C.minwidth),D>C.maxwidth&&(D=C.maxwidth),C.hidden&&C.hideable||C.adaptivehidden||(w+=D);d.table.width(parseInt(w)+2);h=w}d._updatescrollbarsafterrowsprerender();d.rendered&&
d.rendered("rows");d.toCompile=[];d._addoverlayelement()}}},_groupsheader:function(){return this.groupable&&this.showgroupsheader},_arrange:function(){var b=null,d=null;this.tableheight=null;var c=this.that,h=!1,l=!1;null!=c.width&&-1!=c.width.toString().indexOf("px")?b=c.width:void 0==c.width||isNaN(c.width)||(b=c.width);null!=c.width&&-1!=c.width.toString().indexOf("%")&&(b=c.width,h=!0);c.scrollbarautoshow&&(c.vScrollBar[0].style.display="none",c.hScrollBar[0].style.display="none",c.vScrollBar[0].style.zIndex=
c.tableZIndex+c.headerZIndex,c.hScrollBar[0].style.zIndex=c.tableZIndex+c.headerZIndex);if(c.autowidth){for(var q=b=0;q<c.columns.records.length;q++){var r=c.columns.records[q].width;"auto"==r&&(r=c._measureElementWidth(c.columns.records[q].text));b+=r}"hidden"!=c.vScrollBar.css("visibility")&&(b+=c.scrollbarsize+4);c.width=b}null!=c.height&&-1!=c.height.toString().indexOf("px")?d=c.height:void 0==c.height||isNaN(c.height)||(d=c.height);null!=c.height&&-1!=c.height.toString().indexOf("%")&&(d=c.height,
l=!0);q=function(){var b=0,d=c.showheader?null!=c.columnsheader?c.columnsheader.height()+2:0:0,b=b+d;c.pageable&&(b+=c.pagerheight);c._groupsheader()&&(b+=c.groupsheaderheight);c.showtoolbar&&(b+=c.toolbarheight);c.showstatusbar&&(b+=c.statusbarheight);c.showeverpresentrow&&"bottom"===c.everpresentrowposition&&(b+=c.everpresentrowheight);"visible"==c.hScrollBar[0].style.visibility&&(b+=15);return b};c.autoheight&&c.virtualsizeinfo?c.pageable&&c.gotopage?(d=0+(c._pageviews[0]?c._pageviews[0].height:
0),d+=q(),c.showemptyrow&&0==c.dataview.totalrecords&&(d+=c.rowsheight)):(d=c.host.height()-c._gettableheight(),0<c._pageviews.length?(d=d+c._pageviews[c._pageviews.length-1].height+c._pageviews[c._pageviews.length-1].top,c.vScrollBar[0].style.visibility="hidden"):(d=q(),c.showemptyrow&&(d+=c.rowsheight))):c.autoheight&&(d=c.dataview.totalrecords*c.rowsheight,c.pageable&&c.gotopage&&(d=c.pagesize*c.rowsheight),c._loading&&(d=250,c.dataloadelement.height(d)),d+=q(),1E4<d&&(d=1E4));null!=b?(b=parseInt(b),
h?c.element.style.width=c.width:c.element.style.width!=parseInt(c.width)+"px"&&(c.element.style.width=parseInt(c.width)+"px"),h&&(b=c.host.width(),2>=b&&(b=600,c.host.width(b)),c._oldWidth||(c._oldWidth=b))):c.host.width(250);null!=d?(l||(d=parseInt(d)),l?c.element.style.height=c.height:c.element.style.height!=parseInt(d)+"px"&&(c.element.style.height=parseInt(d)+"px"),l&&!c.autoheight&&(d=c.host.height(),0==d&&(d=400,c.host.height(d)),c._oldHeight||(c._oldHeight=d))):c.host.height(250);c.autoheight&&
(c.tableheight=null,c._gettableheight());h=0;c.showtoolbar?(c.toolbar.width(b),c.toolbar.height(c.toolbarheight-1),c.toolbar.css("top",0),h+=c.toolbarheight,d-=parseInt(c.toolbarheight)):c.toolbar[0].style.height="0px";c.showstatusbar?(c.showaggregates?c.statusbar.width(c.table?Math.max(b,c.table.width()):b):c.statusbar.width(b),c.statusbar.height(c.statusbarheight)):c.statusbar[0].style.height="0px";c.showeverpresentrow&&"bottom"===c.everpresentrowposition?(c.addnewrow.width(b),c.addnewrow.height(c.everpresentrowheight)):
c.addnewrow[0].style.height="0px";c._groupsheader()?(c.groupsheader.width(b),c.groupsheader.height(c.groupsheaderheight),c.groupsheader.css("top",h),l=c.groupsheader.height()+1,h+=l,d>l&&(d-=parseInt(l))):(c.groupsheader[0].style.width!=b+"px"&&(c.groupsheader[0].style.width=parseInt(b)+"px"),c.groupsheader[0].style.height="0px",c.groupsheader[0].style.top!=h+"px"&&c.groupsheader.css("top",h),l=c.showgroupsheader&&c.groupable?c.groupsheaderheight:0,c.content[0].style.top!=h+l+"px"&&c.content.css("top",
h+c.groupsheaderheight));var t=c.scrollbarsize;isNaN(t)&&(t=parseInt(t),t=isNaN(t)?"17px":t+"px");t=parseInt(t);r=2;l=0;"visible"==c.vScrollBar[0].style.visibility&&(l=t+4);"visible"==c.hScrollBar[0].style.visibility&&(r=t+4+2);0==t&&(r=l=0);q=0;c.pageable&&(q=c.pagerheight,r+=c.pagerheight);c.showstatusbar&&(r+=c.statusbarheight,q+=c.statusbarheight);c.showeverpresentrow&&"bottom"===c.everpresentrowposition&&(r+=c.everpresentrowheight,q+=c.everpresentrowheight);c.hScrollBar[0].style.height!=t+"px"&&
(c.hScrollBar[0].style.height=parseInt(t)+"px");c.hScrollBar[0].style.top==h+d-4-t-q+"px"&&"0px"==c.hScrollBar[0].style.left||c.hScrollBar.css({top:h+d-4-t-q+"px",left:"0px"});var v=c.hScrollBar[0].style.width,y=!1,A=!1;0==l?v!=b-2+"px"&&(c.hScrollBar.width(b-2),y=!0):v!=b-t-4+"px"&&(c.hScrollBar.width(b-t-4+"px"),y=!0);c.autoheight||(c.vScrollBar[0].style.width!=t+"px"&&(c.vScrollBar.width(t),A=!0),c.vScrollBar[0].style.height!=parseInt(d)-r+"px"&&(c.vScrollBar.height(parseInt(d)-r+"px"),A=!0),c.vScrollBar[0].style.left==
parseInt(b)-parseInt(t)-4+"px"&&c.vScrollBar[0].style.top==h+"px"||c.vScrollBar.css({left:parseInt(b)-parseInt(t)-4+"px",top:h}));c.rtl&&(c.vScrollBar.css({left:"0px",top:h}),"hidden"!=c.vScrollBar.css("visibility")&&c.hScrollBar.css({left:t+2}));v=c.vScrollInstance;v.disabled=c.disabled;c.autoheight||A&&v.refresh();A=c.hScrollInstance;A.disabled=c.disabled;y&&A.refresh();c.autowidth&&(c.hScrollBar[0].style.visibility="hidden");c.statusbarheight=parseInt(c.statusbarheight);c.toolbarheight=parseInt(c.toolbarheight);
y=function(b){if("visible"==b.vScrollBar[0].style.visibility&&"visible"==b.hScrollBar[0].style.visibility){b.bottomRight[0].style.visibility="visible";b.bottomRight.css({left:1+parseInt(b.vScrollBar.css("left")),top:parseInt(b.hScrollBar.css("top"))});b.rtl&&b.bottomRight.css("left","0px");b.bottomRight.width(parseInt(t)+3);b.bottomRight.height(parseInt(t)+4);var d=b.showeverpresentrow&&"bottom"==b.everpresentrowposition?b.everpresentrowheight:0;0<d&&!b.showaggregates&&(b.bottomRight.css("z-index",
99),b.bottomRight.height(parseInt(t)+4+d),b.bottomRight.css({top:parseInt(b.hScrollBar.css("top"))-d}));b.showaggregates&&(b.bottomRight.css("z-index",99),b.bottomRight.height(parseInt(t)+4+b.statusbarheight+d),b.bottomRight.css({top:parseInt(b.hScrollBar.css("top"))-b.statusbarheight-d}))}else b.bottomRight[0].style.visibility="hidden"};y(this);c.content[0].style.width!=b-l+"px"&&c.content.width(b-l);c.content[0].style.height!=d-r+3+"px"&&c.content.height(d-r+3);c.scrollbarautoshow&&(c.content[0].style.width!=
b+"px"&&c.content.width(b),c.content[0].style.height!=d+"px"&&c.content.height(d));c.content[0].style.top!=h+"px"&&c.content.css("top",h);c.rtl&&(c.content.css("left",l),c.scrollbarautoshow&&c.content.css("left","0px"),c.table&&(r=c.table.width(),r<b-l&&c.content.css("left",b-r)));c.showstatusbar&&(c.statusbar.css("top",h+d-c.statusbarheight-(c.pageable?c.pagerheight:0)),c.showaggregates&&("visible"==c.hScrollBar.css("visibility")&&(c.hScrollBar.css({top:h+d-4-t-q+c.statusbarheight+"px"}),c.statusbar.css("top",
1+h+d-t-5-c.statusbarheight-(c.pageable?c.pagerheight:0))),y(this)),c.rtl&&("visible"!=c.hScrollBar.css("visibility")?c.statusbar.css("left",c.content.css("left")):c.statusbar.css("left","0px")));c.showeverpresentrow&&"bottom"===c.everpresentrowposition&&(c.addnewrow.css("top",h+d-(c.showstatusbar?c.statusbarheight:0)-(c.pageable?c.pagerheight:0)-c.everpresentrowheight),c.rtl&&("visible"!=c.hScrollBar.css("visibility")?c.addnewrow.css("left",c.content.css("left")):c.addnewrow.css("left","0px")));
c.pageable?(c.pager.width(b),c.pager.height(c.pagerheight),c.pager.css("top",h+d-c.pagerheight-1)):c.pager[0].style.height="0px";null!=c.table&&(h=-2,"visible"==c.vScrollBar[0].style.visibility&&(h=c.scrollbarsize+3),"visible"==c.hScrollBar[0].style.visibility&&(h=h+c.table.width()-c.host.width(),0<=h&&c.hScrollBar.jqxScrollBar("max",h),"visible"==c.hScrollBar[0].style.visibility&&0==h&&(c.hScrollBar[0].style.visibility="hidden",c._arrange())));b!=parseInt(c.dataloadelement[0].style.width)&&(c.dataloadelement[0].style.width=
c.element.style.width);d!=parseInt(c.dataloadelement[0].style.height)&&(c.dataloadelement[0].style.height=c.element.style.height);this.pagergotoinput&&(this.pagergotoinput.offset().top!==this.pagergoto.offset().top?(this.pagergotoinput.css("visibility","hidden"),this.pagergoto.css("visibility","hidden")):(this.pagergotoinput.css("visibility","inherit"),this.pagergoto.css("visibility","inherit")));c._hostwidth=b},destroy:function(){delete c.jqx.dataFormat.datescache;delete this.gridlocalization;c.jqx.utilities.resize(this.host,
null,!0);(""!=document.referrer||window.frameElement)&&null!=window.top&&window.top!=window.self&&this.removeHandler(c(window.top.document),"mouseup.grid"+this.element.id);if(this.table&&this.table[0]){for(var b=this.table[0].rows.length,d=0;d<b;d++){for(var g=this.table[0].rows[d],h=g.cells.length,l=0;l<h;l++)c(g.cells[l]).remove(),g.cells[l]=null,delete g.cells[l];g.cells=null;g.cells&&delete g.cells;c(this.table[0].rows[d]).remove();this.table[0].rows[d]=null}try{delete this.table[0].rows}catch(q){}this.table.remove();
delete this.table}if(this.columns&&this.columns.records){for(d=0;d<this.columns.records.length;d++)b=this.columns.records[d],b.addnewrowwidget&&b.destroyeverpresentrowwidget&&b.destroyeverpresentrowwidget(b.addnewrowwidget),b.destroywidget&&b.destroywidget&&b.destroywidget(b.widget),this._removecolumnhandlers(this.columns.records[d]),b.element&&(c(b.element).remove(),c(b.sortasc).remove(),c(b.sortdesc).remove(),c(b.filtericon).remove(),c(b.menu).remove(),b.element=null,b.uielement=null,b.sortasc=
null,b.sortdesc=null,b.filtericon=null,b.menu=null,delete b.element,delete b.uielement,delete b.sortasc,delete b.sortdesc,delete b.filtericon,delete b.menu,delete this.columnsrow[0].cells[d]);try{delete this.columnsrow[0].cells}catch(q){}delete this.columnsrow}c.removeData(document.body,"contextmenu"+this.element.id);this.host.jqxDropDownList&&this._destroyfilterpanel&&this._destroyfilterpanel();this.editable&&this._destroyeditors&&this._destroyeditors();this.filterable&&this._destroyedfilters&&this.showfilterrow&&
this._destroyedfilters();this.host.jqxMenu&&this.gridmenu&&(this.removeHandler(c(document),"click.menu"+this.element.id),this.removeHandler(this.gridmenu,"keydown"),this.removeHandler(this.gridmenu,"closed"),this.removeHandler(this.gridmenu,"itemclick"),this.gridmenu.jqxMenu("destroy"),this.gridmenu=null);this.pagershowrowscombo&&(this.pagershowrowscombo.jqxDropDownList("destroy"),this.pagershowrowscombo=null);this.pagerrightbutton&&(this.removeHandler(this.pagerrightbutton,"mousedown"),this.removeHandler(this.pagerrightbutton,
"mouseup"),this.removeHandler(this.pagerrightbutton,"click"),this.pagerrightbutton.jqxButton("destroy"),this.pagerrightbutton=null);this.pagerleftbutton&&(this.removeHandler(this.pagerleftbutton,"mousedown"),this.removeHandler(this.pagerleftbutton,"mouseup"),this.removeHandler(this.pagerleftbutton,"click"),this.pagerleftbutton.jqxButton("destroy"),this.removeHandler(c(document),"mouseup.pagerbuttons"+this.element.id),this.pagerleftbutton=null);this.removeHandler(c(document),"selectstart."+this.element.id);
this.removeHandler(c(document),"mousedown.resize"+this.element.id);this.removeHandler(c(document),"mouseup.resize"+this.element.id);this.removeHandler(c(document),"mousemove.resize"+this.element.id);this.isTouchDevice()&&(d=c.jqx.mobile.getTouchEventName("touchmove")+".resize"+this.element.id,b=c.jqx.mobile.getTouchEventName("touchstart")+".resize"+this.element.id,g=c.jqx.mobile.getTouchEventName("touchend")+".resize"+this.element.id,this.removeHandler(c(document),d),this.removeHandler(c(document),
b),this.removeHandler(c(document),g));this.removeHandler(c(document),"mousedown.reorder"+this.element.id);this.removeHandler(c(document),"mouseup.reorder"+this.element.id);this.removeHandler(c(document),"mousemove.reorder"+this.element.id);this.isTouchDevice()&&(d=c.jqx.mobile.getTouchEventName("touchmove")+".reorder"+this.element.id,b=c.jqx.mobile.getTouchEventName("touchstart")+".reorder"+this.element.id,g=c.jqx.mobile.getTouchEventName("touchend")+".reorder"+this.element.id,this.removeHandler(c(document),
d),this.removeHandler(c(document),b),this.removeHandler(c(document),g));this.removeHandler(c(window),"resize."+this.element.id);this.resizeline&&this.resizeline.remove();this.resizestartline&&this.resizestartline.remove();this.groupable&&(d="mousemove.grouping"+this.element.id,b="mousedown.grouping"+this.element.id,g="mouseup.grouping"+this.element.id,this.removeHandler(c(document),d),this.removeHandler(c(document),b),this.removeHandler(c(document),g));this.columnsreorder&&(d="mousemove.reorder"+
this.element.id,b="mousedown.reorder"+this.element.id,g="mouseup.reorder"+this.element.id,this.removeHandler(c(document),d),this.removeHandler(c(document),b),this.removeHandler(c(document),g),delete this.columnsbounds);this.content&&(this.removeHandler(this.content,"mousedown"),this.removeHandler(this.content,"scroll"));this._removeHandlers();this.hScrollInstance.destroy();this.vScrollInstance.destroy();this.hScrollBar.remove();this.vScrollBar.remove();this._clearcaches();delete this.hScrollInstance;
delete this.vScrollInstance;delete this.visiblerows;delete this.hittestinfo;delete this.rows;delete this.columns;delete this.columnsbydatafield;delete this.pagescache;delete this.pageviews;delete this.cellscache;delete this.heights;delete this.hiddens;delete this.hiddenboundrows;delete this.heightboundrows;delete this.detailboundrows;delete this.details;delete this.expandedgroups;delete this._rowdetailscache;delete this._rowdetailselementscache;delete this.columnsmenu;this.columnsheader&&(this.columnsheader.remove(),
delete this.columnsheader);this.selectionarea&&(this.selectionarea.remove(),delete this.selectionarea);if(this.menuitemsarray&&this.menuitemsarray.length)for(b=this.menuitemsarray.length,d=0;d<b;d++)c(this.menuitemsarray[d]).remove();delete this.menuitemsarray;this.dataview._clearcaches();this.content.removeClass();this.content.remove();this.content=null;delete this.content;this.hScrollBar=this.vScrollBar=null;delete this.hScrollBar;delete this.hScrollBar;this.gridcontent&&(this.gridcontent.remove(),
delete this.gridcontent);this.gridmenu&&(this.gridmenu=null,delete this.gridmenu);delete this._mousemovefunc;delete this._mousewheelfunc;this.dataview.destroy();delete this.dataview;this.bottomRight.remove();delete this.bottomRight;this.wrapper.remove();delete this.wrapper;this.pagerdiv&&(this.pagerdiv.remove(),delete this.pagerdiv);this.pagerpageinput&&(this.pagerpageinput.remove(),delete this.pagerpageinput);this.pagergoto&&(this.pagergoto.remove(),delete this.pagergoto);this.pagershowrows&&(this.pagershowrows.remove(),
delete this.pagershowrows);this.pagerfirstbutton&&(this.pagerfirstbutton.remove(),delete this.pagerfirstbutton);this.pagerlastbutton&&(this.pagerlastbutton.remove(),delete this.pagerlastbutton);this.pagerbuttons&&(this.pagerbuttons.remove(),delete this.pagerbuttons);this.pagerdetails&&(this.pagerdetails.remove(),delete this.pagerdetails);this.pagergotoinput&&(this.pagergotoinput.remove(),delete this.pagergotoinput);this.pager.remove();delete this.pager;this.groupsheader.remove();delete this.groupsheader;
this.dataloadelement.remove();delete this.dataloadelement;this.toolbar.remove();delete this.toolbar;this.statusbar.remove();delete this.statusbar;this.host.removeData();this.host.removeClass();this.host.remove();this.host=null;delete this.host;delete this.element;delete this.set;delete this.get;delete this.that;delete this.call},_initializeColumns:function(){var d=this.source?this.source.datafields:null;null==d&&this.source&&this.source._source&&(d=this.source._source.datafields);var f=d?0<d.length:
!1;if(this.autogeneratecolumns){var g=[];if(d)c.each(d,function(){g.push({datafield:this.name,text:this.text||this.name,cellsformat:this.format||""})});else if(0<this.source.records.length)for(obj in d=this.source.records[0],d)"uid"!=obj&&(d={width:100,datafield:obj,text:obj},g.push(d));this.columns=g}if(this.columns&&this.columns.records)for(d=0;d<this.columns.records.length;d++)this._removecolumnhandlers(this.columns.records[d]);var h=this.that,l=new c.jqx.collection(this.element),q=0;this._haspinned=
!1;this._columns?this.columns=this._columns:this._columns=this.columns;this.groupable&&c.each(this.groups,function(d){d=new b(h,this);d.visibleindex=q++;d.width=h.groupindentwidth;l.add(d);d.grouped=!0;d.filterable=!1;d.sortable=!1;d.editable=!1;d.resizable=!1;d.draggable=!1});this.rowdetails&&this.showrowdetailscolumn&&(d=new b(h,this),d.visibleindex=q++,d.width=h.groupindentwidth,d.pinned=!0,d.editable=!1,d.filterable=!1,d.draggable=!1,d.groupable=!1,d.resizable=!1,l.add(d),h._haspinned=!0);"checkbox"==
this.selectionmode&&(d=new b(h,null),d.visibleindex=q++,d.width=h.groupindentwidth,d.checkboxcolumn=!0,d.editable=!1,d.columntype="checkbox",d.groupable=!1,d.draggable=!1,d.filterable=!1,d.resizable=!1,d.datafield="_checkboxcolumn",l.add(d));var r=[];c.each(this.columns,function(d){if(void 0!=h.columns[d]){var e=new b(h,this);e.visibleindex=q++;void 0!=this.dataField&&(this.datafield=this.dataField);this.pinned&&(h._haspinned=!0);!h.showeverpresentrow||"addButtonColumn"!==this.datafield&&"resetButtonColumn"!==
this.datafield&&"updateButtonColumn"!==this.datafield&&"deleteButtonColumn"!==this.datafield||(e.editable=!1,e.groupable=!1,e.draggable=!1,e.filterable=!1,e.resizable=!1,e.menu=!1);if(null==this.datafield)h.source&&h.source._source&&"array"==h.source._source.datatype&&(f||(h.source._source.datafields||(h.source._source.datafields=[]),h.source._source.datafields.push({name:d.toString()})),this.datafield=d.toString(),this.displayfield=d.toString(),e.datafield=this.datafield,e.displayfield=this.displayfield);
else{if(r[this.datafield])throw Error("jqxGrid: Invalid column 'datafield' setting. jqxGrid's columns should be initialized with unique data fields.");r[this.datafield]=!0}l.add(e)}});this.adaptive&&(d=new b(h,null),d.visibleindex=q++,d.width=h.groupindentwidth,d.editable=!1,d.columntype="adaptive",d.cellsalign="center",d.groupable=!1,d.draggable=!1,d.menu=!1,d.sortable=!1,d.filterable=!1,d.resizable=!1,d.datafield="_adaptivecolumn",l.add(d));this.rtl&&l.records.reverse();this.columns=l},_initializeRows:function(){var b=
new c.jqx.collection(this.element);this.rows&&this.rows.clear();this.rows=b},_raiseEvent:function(b,d){void 0==d&&(d={owner:null});if(!1!==this._trigger){var g=this.events[b];this._camelCase||(g=g.toLowerCase());if((2==b||15==b)&&this.showeverpresentrow&&(0<=this.everpresentrowactions.indexOf("delete")||0<=this.everpresentrowactions.indexOf("update"))){if(this.updateeverpresentrow)var h=this;setTimeout(function(){h.updateeverpresentrow()},50)}args=d;args.owner=this;g=new c.Event(g);g.owner=this;g.args=
args;var l=this.host.trigger(g);d=g.args;return l}},wheel:function(b,d){if(d.autoheight&&"visible"!=d.hScrollBar.css("visibility"))return b.returnValue=!0;var c=0;b||(b=window.event);b.originalEvent&&b.originalEvent.wheelDelta&&(b.wheelDelta=b.originalEvent.wheelDelta);b.wheelDelta?c=b.wheelDelta/120:b.detail&&(c=-b.detail/3);if(c){if(c=d._handleDelta(c))b.preventDefault&&b.preventDefault(),null!=b.originalEvent&&(b.originalEvent.mouseHandled=!0),void 0!=b.stopPropagation&&b.stopPropagation();return c?
(c=!1,b.returnValue=c):!1}b.preventDefault&&b.preventDefault();b.returnValue=!1},_handleDelta:function(b){if("hidden"!=this.vScrollBar.css("visibility")){var d=this.vScrollInstance.value;0>b?this.scrollDown():this.scrollUp();b=this.vScrollInstance.value;if(d!=b)return!0}else if("hidden"!=this.hScrollBar.css("visibility")&&(d=this.hScrollInstance.value,0<b?this.hScrollInstance.value>2*this.horizontalscrollbarstep?this.hScrollInstance.setPosition(this.hScrollInstance.value-2*this.horizontalscrollbarstep):
this.hScrollInstance.setPosition(0):this.hScrollInstance.value<this.hScrollInstance.max?this.hScrollInstance.setPosition(this.hScrollInstance.value+2*this.horizontalscrollbarstep):this.hScrollInstance.setPosition(this.hScrollInstance.max),b=this.hScrollInstance.value,d!=b))return!0;return!1},scrollDown:function(){if("hidden"!=this.vScrollBar.css("visibility")){var b=this.vScrollInstance;b.value+this.rowsheight<=b.max?b.setPosition(parseInt(b.value)+this.rowsheight):b.setPosition(b.max)}},scrollUp:function(){if("hidden"!=
this.vScrollBar.css("visibility")){var b=this.vScrollInstance;b.value-this.rowsheight>=b.min?b.setPosition(parseInt(b.value)-this.rowsheight):b.setPosition(b.min)}},_removeHandlers:function(){var b=this.that;b.removeHandler(c(window),"orientationchange.jqxgrid"+b.element.id);b.removeHandler(c(window),"orientationchanged.jqxgrid"+b.element.id);b.removeHandler(b.vScrollBar,"valueChanged");b.removeHandler(b.hScrollBar,"valueChanged");b.vScrollInstance.valueChanged=null;b.hScrollInstance.valueChanged=
null;var d="mousedown.jqxgrid";b.isTouchDevice()&&(d=c.jqx.mobile.getTouchEventName("touchend"));b.removeHandler(b.host,"dblclick.jqxgrid");b.removeHandler(b.host,d);b.removeHandler(b.content,"mousemove",b._mousemovefunc);b.removeHandler(b.host,"mouseleave.jqxgrid");b.removeHandler(b.content,"mouseenter");b.removeHandler(b.content,"mouseleave");b.removeHandler(b.content,"mousedown");b.removeHandler(b.content,"scroll");b.removeHandler(b.content,"selectstart."+b.element.id);b.removeHandler(b.host,"dragstart."+
b.element.id);b.removeHandler(b.host,"keydown.edit"+b.element.id);b.removeHandler(c(document),"keydown.edit"+b.element.id);b.removeHandler(c(document),"keyup.edit"+b.element.id);b._mousemovedocumentfunc&&b.removeHandler(c(document),"mousemove.selection"+b.element.id,b._mousemovedocumentfunc);b.removeHandler(c(document),"mouseup.selection"+b.element.id);b._mousewheelfunc&&b.removeHandler(b.host,"mousewheel",b._mousewheelfunc);b.editable&&b.removeHandler(c(document),"mousedown.gridedit"+b.element.id);
b.host.off&&(b.content.off("mousemove"),b.host.off("mousewheel"))},_addHandlers:function(){var b=this.that,d=b.isTouchDevice();d||b.addHandler(b.host,"dragstart."+b.element.id,function(b){return!1});b.scrollbarautoshow&&(b.addHandler(b.host,"mouseenter.gridscroll"+b.element.id,function(d){b.vScrollBar.fadeIn("fast");b.hScrollBar.fadeIn("fast")}),b.addHandler(b.host,"mouseleave.gridscroll"+b.element.id,function(d){b.vScrollInstance.isScrolling()||b.hScrollInstance.isScrolling()||(b.vScrollBar.fadeOut("fast"),
b.hScrollBar.fadeOut("fast"))}));b.editable&&b.addHandler(c(document),"mousedown.gridedit"+b.element.id,function(d){if(b.editable&&b.begincelledit&&b.editcell&&!b.vScrollInstance.isScrolling()&&!b.vScrollInstance.isScrolling()){var c=b.host.coord(),f=b.host.width(),g=b.host.height(),t=!1,v=!1;if(d.pageY<c.top||d.pageY>c.top+g)v=t=!0;if(d.pageX<c.left||d.pageX>c.left+f)t=!0;if(t){if(b.editcell&&b.editcell.editor)switch(b.editcell.columntype){case "datetimeinput":if(b.editcell.editor.jqxDateTimeInput&&
b.editcell.editor.jqxDateTimeInput("container")&&"block"==b.editcell.editor.jqxDateTimeInput("container")[0].style.display)if(c=b.editcell.editor.jqxDateTimeInput("container").coord().top,f=b.editcell.editor.jqxDateTimeInput("container").coord().top+b.editcell.editor.jqxDateTimeInput("container").height(),v&&(d.pageY<c||d.pageY>f))b.editcell.editor.jqxDateTimeInput("close");else return;break;case "combobox":if(b.editcell.editor.jqxComboBox&&b.editcell.editor.jqxComboBox("container")&&"block"==b.editcell.editor.jqxComboBox("container")[0].style.display)if(c=
b.editcell.editor.jqxComboBox("container").coord().top,f=b.editcell.editor.jqxComboBox("container").coord().top+b.editcell.editor.jqxComboBox("container").height(),v&&(d.pageY<c||d.pageY>f))b.editcell.editor.jqxComboBox("close");else return;break;case "dropdownlist":if(b.editcell.editor.jqxDropDownList&&b.editcell.editor.jqxDropDownList("container")&&"block"==b.editcell.editor.jqxDropDownList("container")[0].style.display)if(c=b.editcell.editor.jqxDropDownList("container").coord().top,f=b.editcell.editor.jqxDropDownList("container").coord().top+
b.editcell.editor.jqxDropDownList("container").height(),v&&(d.pageY<c||d.pageY>f))b.editcell.editor.jqxDropDownList("close");else return;break;case "template":case "custom":for(c=["jqxDropDownList","jqxComboBox","jqxDropDownButton","jqxDateTimeInput"],f=0;f<c.length;f++){g=c[f];t=b.editcell.editor.data();if(t[g]&&t[g].instance.container&&"block"==t[g].instance.container[0].style.display){var g=t[g].instance,t=g.container.coord().top,y=g.container.coord().top+g.container.height();v&&(d.pageY<t||d.pageY>
y)?(g.close(),g=!0):g=!1}else g=void 0;if(0==g)return}}b.endcelledit(b.editcell.row,b.editcell.column,!1,!0);b._oldselectedcell=null}}});b.vScrollInstance.valueChanged=function(c){b.virtualsizeinfo&&(b._closemenu(),b._renderrows(b.virtualsizeinfo),b.currentScrollValue=c.currentValue,b.pageable||b.groupable||!b.dataview.virtualmode||(b.loadondemandupdate&&clearTimeout(b.loadondemandupdate),b.loadondemandupdate=setTimeout(function(){b.loadondemand=!0;b._renderrows(b.virtualsizeinfo)},100)),d&&(b._lastScroll=
new Date))};b.hScrollInstance.valueChanged=function(g){if(b.virtualsizeinfo){b._closemenu();var l=function(){b._renderhorizontalscroll();b._renderrows(b.virtualsizeinfo);b.editcell&&!b.editrow&&b._showcelleditor&&b.editcell.editing&&(b.hScrollInstance.isScrolling()||b._showcelleditor(b.editcell.row,b.getcolumn(b.editcell.column),b.editcell.element,b.editcell.init))};d?l():(void 0==b._browser&&b._isIE10(),navigator&&-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")?
(b._hScrollTimer&&clearTimeout(b._hScrollTimer),b._hScrollTimer=setTimeout(function(){l()},1)):c.jqx.browser.msie?(b._hScrollTimer&&clearTimeout(b._hScrollTimer),b._hScrollTimer=setTimeout(function(){l()},.01)):l());d&&(b._lastScroll=new Date)}};b._mousewheelfunc=b._mousewheelfunc||function(d){if(!b.editcell&&b.enablemousewheel)return b.wheel(d,b),!1};b.removeHandler(b.host,"mousewheel",b._mousewheelfunc);b.addHandler(b.host,"mousewheel",b._mousewheelfunc);var g="mousedown.jqxgrid";d&&(g=c.jqx.mobile.getTouchEventName("touchend"));
b.addHandler(b.host,g,function(d){if(b.isTouchDevice()&&(b._newScroll=new Date,500>b._newScroll-b._lastScroll||c(d.target).ischildof(b.vScrollBar)||c(d.target).ischildof(b.hScrollBar)))return!1;b._mousedown=new Date;var f=b._handlemousedown(d,b);b.isNestedGrid&&(b.resizablecolumn||b.columnsreorder||d.stopPropagation());b._lastmousedown=new Date;return f});d||(b.addHandler(b.host,"dblclick.jqxgrid",function(d){b.editable&&b.begincelledit&&"dblclick"==b.editmode?b._handledblclick(d,b):c.jqx.browser.msie&&
9>c.jqx.browser.version&&b._handlemousedown(d,b);b.mousecaptured=!1;b._lastmousedown=new Date;return!0}),b._mousemovefunc=function(d){if(b._handlemousemove)return b._handlemousemove(d,b)},b.addHandler(b.content,"mousemove",b._mousemovefunc),b._handlemousemoveselection&&(b._mousemovedocumentfunc=function(d){if(b._handlemousemoveselection)return b._handlemousemoveselection(d,b)},b.addHandler(c(document),"mousemove.selection"+b.element.id,b._mousemovedocumentfunc)),b.addHandler(c(document),"mouseup.selection"+
b.element.id,function(d){b._handlemouseupselection&&b._handlemouseupselection(d,b)}));try{""==document.referrer&&!window.frameElement||null==window.top||window.top==window.self||(g=null,window.parent&&document.referrer&&(g=document.referrer),g&&-1!=g.indexOf(document.location.host)&&b.addHandler(c(window.top.document),"mouseup.grid"+b.element.id,function(d){if(b._handlemouseupselection)try{b._handlemouseupselection(d,b)}catch(c){}}))}catch(h){}b.focused=!1;d||(b.addHandler(b.content,"mouseenter",
function(d){b.focused=!0;b.wrapper&&(b.wrapper.attr("tabindex",1),b.content.attr("tabindex",2));b._overlayElement&&(b.vScrollInstance.isScrolling()||b.hScrollInstance.isScrolling()?b._overlayElement[0].style.visibility="visible":b._overlayElement[0].style.visibility="hidden")}),b.addHandler(b.content,"mouseleave",function(d){b._handlemousemove&&b.enablehover&&b._clearhoverstyle();b._overlayElement&&(b._overlayElement[0].style.visibility="hidden");b.focused=!1}),(b.groupable||b.columnsreorder)&&b.addHandler(c(document),
"selectstart."+b.element.id,function(d){if(!0===b.__drag)return!1}),b.addHandler(b.content,"selectstart."+b.element.id,function(d){if(b.enablebrowserselection||b.showfilterrow&&c(d.target).ischildof(b.filterrow)||b.showeverpresentrow&&(c(d.target).ischildof(b.addnewrow)||b.addnewrowtop&&c(d.target).ischildof(b.addnewrowtop))||d.target.className&&0<=d.target.className.indexOf("jqx-grid-widget"))return!0;if(!b.editcell)return!1;d.stopPropagation&&d.stopPropagation()}),b.addHandler(c(document),"keyup.edit"+
b.element.id,function(d){b._keydown=!1}),b.addHandler(c(document),"keydown.edit"+b.element.id,function(d){if(b.adaptiveview)return!0;b._keydown=!b.editcell;var f=d.charCode?d.charCode:d.keyCode?d.keyCode:0;20===f&&(b._capsLock=b._capsLock?!1:!0);if(b.handlekeyboardnavigation&&(b.focused||d.target===b.element||c(d.target).ischildof(b.host))&&1==b.handlekeyboardnavigation(d))return!1;b.editable&&b.editcell&&(13==f||27==f||9==f||32==f)&&b._handleeditkeydown&&(g=b._handleeditkeydown(d,b));27==f&&(b.mousecaptured=
!1,"visible"==b.selectionarea.css("visibility")&&b.selectionarea.css("visibility","hidden"));if(c.jqx.browser.msie&&12>c.jqx.browser.version&&b.focused&&!b.isNestedGrid){if(13==f&&0==g)return g;var g=!0;!b.editcell&&b.editable&&"programmatic"!=b.editmode&&b._handleeditkeydown&&(g=b._handleeditkeydown(d,b));if(g&&b.keyboardnavigation&&b._handlekeydown)return g=b._handlekeydown(d,b),g||(d.preventDefault&&d.preventDefault(),void 0!=d.stopPropagation&&d.stopPropagation()),g}return!0}),b.addHandler(b.host,
"keyup.edit"+b.element.id,function(d){if(b.adaptiveview)return!0;if(9===d.keyCode&&!c(document.activeElement).ischildof(b.filterrow)&&!c(document.activeElement).ischildof(b.pager))switch(b.selectionmode){case "singlecell":case "multiplecells":case "multiplecellsextended":case "multiplecellsadvanced":null===b.getselectedcell()&&b.selectcell(0,b.columns.records[0].displayfield);break;default:-1===b.getselectedrowindex()&&b.selectrow(0)}}),b.addHandler(b.host,"keydown.edit"+b.element.id,function(d){var f=
!0;if(b.adaptiveview)return!0;if(b.handlekeyboardnavigation&&1==b.handlekeyboardnavigation(d))return!1;b.editable&&"programmatic"!=b.editmode&&b._handleeditkeydown&&(f=b._handleeditkeydown(d,b),b.isNestedGrid&&d.stopPropagation());if(!b.editcell&&d.altKey&&!c(document.activeElement).ischildof(b.filterrow)&&!c(document.activeElement).ischildof(b.pager))if(40===d.keyCode){var g=b.getselectedcell();g&&b.openmenu(g.column)}else 38===d.keyCode&&b._closemenu();c.jqx.browser.msie&&8>c.jqx.browser.version?
b.isNestedGrid&&f&&b.keyboardnavigation&&b._handlekeydown&&(f=b._handlekeydown(d,b),d.stopPropagation()):f&&b.keyboardnavigation&&b._handlekeydown&&(f=b._handlekeydown(d,b),b.isNestedGrid&&d.stopPropagation());f||(d.preventDefault&&d.preventDefault(),void 0!=d.stopPropagation&&d.stopPropagation());f&&b.selectedcells&&0<b.selectedcells.length&&9===d.keyCode&&d.shiftKey&&b.table&&b.table[0].rows&&0<b.table[0].rows.length&&(c(document.activeElement).ischildof(b.filterrow)||c(document.activeElement).ischildof(b.pager)||
b.table[0].rows[0].cells[0].focus());return f}))},_hittestrow:function(b,d){if(null!=this.vScrollInstance&&null!=this.hScrollInstance){void 0==d&&0==d;var g=this.hScrollInstance,h=this.vScrollInstance.value;"visible"!=this.vScrollBar.css("visibility")&&(h=0);g=g.value;"visible"!=this.hScrollBar.css("visibility")&&(g=0);"deferred"==this.scrollmode&&null!=this._newmax&&h>this._newmax&&(h=this._newmax);var l=parseInt(h)+d;parseInt(g);if(null!=this.visiblerows&&0!=this.visiblerows.length){h=!1;g=this._findvisiblerow(l,
this.visiblerows);if(0<=g){var q=this.visiblerows[g],l=!q.rowdetailshidden;if(this.rowdetails&&q.rowdetails){var r=this.visiblerows[g-1];r==q&&(q=r,g--);l&&(l=c(this.hittestinfo[g].visualrow).position().top+parseInt(this.table.css("top")),r=c(this.hittestinfo[g].visualrow).height(),d>=l&&d<=l+r||(g++,q=this.visiblerows[g],h=!0))}}return{index:g,row:q,details:h}}}},getcellatposition:function(b,d){var g=this.that,h=this.showheader?this.columnsheader.height()+2:0,l=this._groupsheader()?this.groupsheader.height():
0,l=l+(this.showtoolbar?this.toolbarheight:0),q=this.host.coord();this.hasTransform&&(q=c.jqx.utilities.getOffset(this.host));var r=b-q.left,t=d-h-q.top-l,l=this._hittestrow(r,t),h=l.row,l=this.table[0].rows[l.index];if(this.dataview&&0==this.dataview.records.length){for(var h=this.table[0].rows,v=0,q=0;q<h.length;q++){if(t>=v&&t<v+this.rowsheight){l=h[q];break}v+=this.rowsheight}h={boundindex:q}}if(null==l)return!0;t=this.hScrollInstance.value;for(q=v=0;q<l.cells.length;q++){var y=parseInt(c(this.columnsrow[0].cells[q]).css("left"));
b=y-t;g.columns.records[q].pinned&&(b=y);if(!g.columns.records[q].hidden&&!g.columns.records[q].adaptivehidden&&b+c(this.columnsrow[0].cells[q]).width()>=r&&r>=b){v=q;break}}return null!=h?(g=this._getcolumnat(v),{row:this.getboundindex(h),column:g.datafield,value:this.getcellvalue(this.getboundindex(h),g.datafield)}):null},_handlemousedown:function(b,d){if(null==b.target||d.disabled||c(b.target).ischildof(this.columnsheader)||c(b.target).ischildof(this.hScrollBar)||c(b.target).ischildof(this.vScrollBar)||
b.target===d.bottomRight[0])return!0;var g;b.which?g=3==b.which:b.button&&(g=2==b.button);var h;b.which?h=2==b.which:b.button&&(h=1==b.button);if(h||this.adaptiveview&&(c(b.target).ischildof(c(this.adaptiveview))||b.target==this.adaptiveview)||this.showstatusbar&&(c(b.target).ischildof(this.statusbar)||b.target==this.statusbar[0])||this.showtoolbar&&(c(b.target).ischildof(this.toolbar)||b.target==this.toolbar[0])||this.pageable&&(c(b.target).ischildof(this.pager)||b.target==this.pager[0])||!this.columnsheader||
!this.editcell&&this.pageable&&c(b.target).ischildof(this.pager))return!0;h=this.showheader?this.columnsheader.height()+2:0;var l=this._groupsheader()?this.groupsheader.height():0,l=l+(this.showtoolbar?this.toolbarheight:0),q=this.host.coord();if(this.hasTransform){var q=c.jqx.utilities.getOffset(this.host),r=this._getBodyOffset();q.left-=r.left;q.top-=r.top}var t=parseInt(b.pageX),r=parseInt(b.pageY);if(this.isTouchDevice()){var v=d.getTouches(b)[0],t=parseInt(v.pageX),r=parseInt(v.pageY);1==d.touchmode&&
void 0!=v._pageX&&(t=parseInt(v._pageX),r=parseInt(v._pageY))}v=t-q.left;r=r-h-q.top-l;if(this.pageable&&!this.autoheight&&this.gotopage&&(h=this.pager.coord().top-q.top-l-h,r>h))return;if((q=this._hittestrow(v,r))&&!q.details){h=q.row;var r=q.index,y=b.target.className,A=this.table[0].rows[r];if(null==A)return d.editable&&d.begincelledit&&d.editcell&&d.endcelledit(d.editcell.row,d.editcell.column,!1,!0),!0;d.mousecaptured=!0;d.mousecaptureposition={left:b.pageX,top:b.pageY-l,clickedrow:A};var l=
this.hScrollInstance,w=l.value;this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(w=l.max-l.value);var z=-1,C=this.groupable?this.groups.length:0;this.rtl&&("hidden"!=this.vScrollBar[0].style.visibility&&(w-=this.scrollbarsize+4),"hidden"==this.hScrollBar[0].style.visibility&&(w=-parseInt(this.content.css("left"))));for(var D=0;D<A.cells.length;D++)if(l=parseInt(c(this.columnsrow[0].cells[D]).css("left")),t=l-w,d.columns.records[D].pinned&&!d.rtl&&(t=l),l=this._getcolumnat(D),null==l||!l.hidden)if(null==
l||!l.adaptivehidden)if(l=t+c(this.columnsrow[0].cells[D]).width(),l>=v&&v>=t){z=D;d.mousecaptureposition.clickedcell=D;break}if(this.rtl&&this._haspinned)for(D=A.cells.length-1;0<=D&&d.columns.records[D].pinned;D--)if(t=l=c(this.columnsrow[0].cells[D]).coord().left-this.host.coord().left,l=this._getcolumnat(D),null==l||!l.hidden)if(null==l||!l.adaptivehidden)if(l=t+c(this.columnsrow[0].cells[D]).width(),l>=v&&v>=t){z=D;d.mousecaptureposition.clickedcell=D;break}if(null!=h&&0<=z){this._raiseEvent(1,
{rowindex:this.getboundindex(h),visibleindex:h.visibleindex,row:h,group:h.group,rightclick:g,originalEvent:b});l=this._getcolumnat(z);v=this.getcellvalue(this.getboundindex(h),l.datafield);this.editable&&this.editcell&&(this._currentEditableColumn=z,l.datafield==this.editcell.column&&this.getboundindex(h)==this.editcell.row&&(this.mousecaptured=!1));if("adaptive"===l.columntype){var E=document.createElement("div"),F=document.createElement("div");g=document.createElement("a");var l=document.createElement("a"),
q=document.createElement("div"),G=this.getrowdata(this.getboundindex(h));g.href="#";l.href="#";E.style.zIndex=99999;E.style.position="absolute";E.style.left="0px";E.style.top="0px";E.style.width="100%";E.style.height="100%";E.className="jqx-adaptive-view jqx-widget-content";q.style.position="relative";q.style.top="100%";q.style.textAlign="center";q.style.marginTop="-40px";F.style.position="absolute";F.style.left="0px";F.style.top="0px";F.style.width="100%";F.style.height="100%";this.theme&&(E.className=
"jqx-widget-content jqx-widget-content-"+this.theme);h=document.createElement("span");h.className="jqx-icon-close";this.theme&&(h.className="jqx-icon-close jqx-widget-close-"+this.theme);h.style.zIndex=99;h.style.position="absolute";h.style.right="10px";h.style.top="10px";h.style.width="16px";h.style.height="16px";E.appendChild(F);E.appendChild(h);g.innerHTML=this.gridlocalization.okstring;l.innerHTML=this.gridlocalization.cancelstring;g.addEventListener("mousedown",function(b){for(var e={},c=d.adaptiveview.querySelectorAll("input"),
g=0;g<c.length;g++){var h=c[g].value,l=c[g].getAttribute("data-column");e[l]=h}d.updaterow(G.uid,e);E.parentNode.removeChild(E);d.adaptiveview=null;b.stopPropagation();return!1});l.addEventListener("mousedown",function(){E.parentNode.removeChild(E);d.adaptiveview=null;b.stopPropagation();return!1});this.editable&&(q.appendChild(g),q.appendChild(l),E.appendChild(q));g="<table class='jqx-adaptive-table'><tr>";for(D=r=0;D<this.columns.records.length;D++)l=this.columns.records[D],"adaptive"!==l.columntype&&
(0<D&&0===r%2&&(g+="</tr><tr>"),q=G[l.displayfield],""!=l.cellsformat&&c.jqx.dataFormat&&(c.jqx.dataFormat.isDate(q)?q=c.jqx.dataFormat.formatdate(q,l.cellsformat,this.gridlocalization):c.jqx.dataFormat.isNumber(q)&&(q=c.jqx.dataFormat.formatnumber(q,l.cellsformat,this.gridlocalization))),v=this.filterable?'<div datafield="'+l.datafield+'" class="'+d.toTP("jqx-grid-column-filterbutton")+'" style="position: relative; top: 4px; display: inline-block; width: 16px; height:16px;"></div>':"",g=this.editable?
l.editable?g+("<td>"+v+l.text+": <input data-column='"+l.displayfield+"' value='"+q+"'/></td>"):g+("<td>"+v+l.text+": <input data-column='"+l.displayfield+"' readonly value='"+q+"'/></td>"):g+("<td>"+v+l.text+": "+q+"</td>"),r++);F.innerHTML=g+"</tr></table>";h.addEventListener("mousedown",function(b){E.parentNode.removeChild(E);d.adaptiveview=null});this.wrapper[0].appendChild(E);this.adaptiveview=E;c(this.adaptiveview).find(".jqx-grid-column-filterbutton").on("click",function(){var b=this.getAttribute("datafield"),
e=this.offsetTop;d.openmenu(b);setTimeout(function(){d.gridmenu.css("top",30+e);d.gridmenu.css("left",25);d.gridmenu.css("z-index",99999);d.gridmenu.parent().css("z-index",99999)},300)});return}this._raiseEvent(8,{rowindex:this.getboundindex(h),column:l?l.getcolumnproperties():null,row:h,visibleindex:h.visibleindex,datafield:l?l.datafield:null,columnindex:z,value:v,rightclick:g,originalEvent:b});if(l.createwidget)return!0;if(this.isTouchDevice())if("checkbox"==l.columntype&&this.editable&&this._overlayElement){if(!this.editcell)return this._overlayElement.css("visibility",
"hidden"),this.editcell=this.getcell(r,l.datafield),!0}else if("button"==l.columntype&&this._overlayElement)return l.buttonclick&&l.buttonclick(A.cells[z].buttonrow,b),!0;r=!1;if(null!=this._lastmousedown&&300>this._mousedown-this._lastmousedown&&this._clickedrowindex==this.getboundindex(h)&&(this._raiseEvent(22,{rowindex:this.getboundindex(h),row:h,visibleindex:h.visibleindex,group:h.group,rightclick:g,originalEvent:b}),this._clickedcolumn==l.datafield&&this._raiseEvent(23,{rowindex:this.getboundindex(h),
row:h,visibleindex:h.visibleindex,column:l?l.getcolumnproperties():null,datafield:l?l.datafield:null,columnindex:z,value:v,rightclick:g,originalEvent:b}),r=!0,this._clickedrowindex=-1,this._clickedcolumn=null,b.isPropagationStopped&&b.isPropagationStopped()))return!1;if(g)return!0;r||(this._clickedrowindex=this.getboundindex(h),this._clickedcolumn=l.datafield);g=c.jqx.utilities.getBrowser();"msie"==g.browser&&7>=parseInt(g.version)&&(0==z&&this.rowdetails&&(y="jqx-grid-group-collapse"),0<C&&z<=C&&
(y="jqx-grid-group-collapse"));if(-1!=y.indexOf("jqx-grid-group-expand")||-1!=y.indexOf("jqx-grid-group-collapse"))this.rtl?0<C&&z>A.cells.length-C-1&&this._togglegroupstate?this._togglegroupstate(h.bounddata,!0):z==A.cells.length-1-C&&this.rowdetails&&this.showrowdetailscolumn&&(this._togglerowdetails(h.bounddata,!0),this.gridcontent[0].scrollTop=0,this.gridcontent[0].scrollLeft=0):0<C&&z<C&&this._togglegroupstate?this._togglegroupstate(h.bounddata,!0):z==C&&this.rowdetails&&this.showrowdetailscolumn&&
(this._togglerowdetails(h.bounddata,!0),this.gridcontent[0].scrollTop=0,this.gridcontent[0].scrollLeft=0);else if(-1!=h.boundindex){v=this.selectedrowindexes.slice(0);g=!1;if("none"!=d.selectionmode&&"checkbox"!=d.selectionmode&&this._selectrowwithmouse){"multiplecellsadvanced"!=d.selectionmode&&"multiplecellsextended"!=d.selectionmode&&"multiplerowsextended"!=d.selectionmode&&"multiplerowsadvanced"!=d.selectionmode||b.ctrlKey||b.shiftKey||b.metaKey||(d.selectedrowindexes=[],d.selectedcells=[]);F=
!1;r=this.getboundindex(h);if(d._oldselectedrow===r||"none"===d.selectionmode)F=!0;if(-1==d.selectionmode.indexOf("cell")){if("singlerow"!=d.selectionmode||d.selectedrowindex!=r&&"singlerow"==d.selectionmode)this._applyrowselection(r,!0,!1,null,l.datafield),this._selectrowwithmouse(d,q,v,l.datafield,b.ctrlKey||b.metaKey,b.shiftKey)}else null!=l.datafield&&(this._selectrowwithmouse(d,q,v,l.datafield,b.ctrlKey||b.metaKey,b.shiftKey),b.shiftKey||this._applycellselection(r,l.datafield,!0,!1));d._oldselectedcell&&
d._oldselectedcell.datafield==d.selectedcell.datafield&&d._oldselectedcell.rowindex==d.selectedcell.rowindex&&(g=!0);d._oldselectedcell=d.selectedcell;d._oldselectedrow=r}d.autosavestate&&d.savestate&&d.savestate();if(d.editable&&d.begincelledit&&"programmatic"!=d.editmode){if(b.isPropagationStopped&&b.isPropagationStopped())return!1;"selectedrow"==d.editmode?F&&!d.editcell?"checkbox"!==l.columntype&&(this._currentEditableColumn=z,d.beginrowedit(this.getboundindex(h))):d.editcell&&!F&&"none"!=d.selectionmode&&
d.endrowedit(d.editcell.row):(r=this.getboundindex(h),F="click"==d.editmode||g&&"selectedcell"==d.editmode,-1==d.selectionmode.indexOf("cell")&&"dblclick"!=d.editmode&&(F=!0),F&&void 0!=h.boundindex&&l.editable&&(d.begincelledit(this.getboundindex(h),l.datafield,l.defaulteditorvalue),-1!=d.selectionmode.indexOf("cell")&&d._applycellselection(r,l.datafield,!1,!1)),-1!=d.selectionmode.indexOf("cell")&&"selectedcell"==d.editmode&&!g&&d.editcell&&d.endcelledit(d.editcell.row,d.editcell.column,!1,!0),
"dblclick"!=d.editmode||g||!d.editcell||d.editcell.row==r&&l.datafield==d.editcell.column||d.endcelledit(d.editcell.row,d.editcell.column,!1,!0))}}}return!0}},_columnPropertyChanged:function(b,d,c,h){},_rowPropertyChanged:function(b,d,c,h){},_serializeObject:function(b){if(null==b)return"";var d="";c.each(b,function(b){0<b&&(d+=", ");d+="[";b=0;for(obj in this)0<b&&(d+=", "),d+="{"+obj+":"+this[obj]+"}",b++;d+="]"});return d},isbindingcompleted:function(){return!this._loading},propertiesChangedHandler:function(b,
d,c){c.width&&c.height&&2==Object.keys(c).length&&(b._updatesize(!0,!0),b._resizeWindow(),b.virtualmode&&!b._loading?b.vScrollInstance.setPosition(0):setTimeout(function(){b._renderrows(b.virtualsizeinfo)},100))},propertyChangedHandler:function(b,d,g,h){if(void 0!=this.isInitialized&&0!=this.isInitialized&&!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length))switch(d=d.toLowerCase(),d){case "editable":case "showcolumnheaderlines":case "showcolumnlines":case "showrowlines":b.refresh();
break;case "everpresentrowactionsmode":g!=h&&(b._removeaddnewrow(),b.render());break;case "everpresentrowactions":b._updateaddnewrowui();break;case "showeverpresentrow":case "everpresentrowposition":case "everpresentrowheight":g!=h&&(b._removeaddnewrow(),b.render());break;case "rtl":b.content.css("left","");b.columns=b._columns;b._filterrowcache=[];b.vScrollBar.jqxScrollBar({rtl:h});b.hScrollBar.jqxScrollBar({rtl:h});b._initpager&&b._initpager();b._initgroupsheader&&b._initgroupsheader();b.render();
break;case "enablebrowserselection":b.showfilterrow||(b.showstatusbar||b.showtoolbar||b.host.addClass("jqx-disableselect"),b.content.addClass("jqx-disableselect"));b.enablebrowserselection&&(b.content.removeClass("jqx-disableselect"),b.host.removeClass("jqx-disableselect"));break;case "columnsheight":(32!=b.columnsheight||b.columngroups)&&b._measureElement("column");b._render(!0,!0,!0,!1,!1);break;case "rowsheight":h!=g&&(31!=b.rowsheight&&b._measureElement("cell"),b.virtualsizeinfo=null,b.rendergridcontent(!0,
!1),b.refresh());break;case "scrollMode":b.vScrollInstance.thumbStep=b.rowsheight;break;case "showdefaultloadelement":b._builddataloadelement();break;case "showfiltermenuitems":case "showsortmenuitems":case "showgroupmenuitems":case "filtermode":b._initmenu();break;case "touchmode":g!=h&&(b._removeHandlers(),b.touchDevice=null,b.vScrollBar.jqxScrollBar({touchMode:h}),b.hScrollBar.jqxScrollBar({touchMode:h}),b._updateTouchScrolling(),b._arrange(),b._updatecolumnwidths(),b._updatecellwidths(),b._addHandlers());
break;case "autoshowcolumnsmenubutton":g!=h&&b._rendercolumnheaders();break;case "rendergridrows":g!=h&&b.updatebounddata();break;case "editmode":g!=h&&(b._removeHandlers(),b._addHandlers());break;case "source":b.updatebounddata();b.virtualmode&&!b._loading&&(b.loadondemand=!0,b._renderrows(b.virtualsizeinfo));break;case "horizontalscrollbarstep":case "verticalscrollbarstep":case "horizontalscrollbarlargestep":case "verticalscrollbarlargestep":this.vScrollBar.jqxScrollBar({step:this.verticalscrollbarstep,
largestep:this.verticalscrollbarlargestep});this.hScrollBar.jqxScrollBar({step:this.horizontalscrollbarstep,largestep:this.horizontalscrollbarlargestep});break;case "closeablegroups":b._initgroupsheader&&b._initgroupsheader();break;case "showgroupsheader":g!=h&&(b._arrange(),b._initgroupsheader&&b._initgroupsheader(),b._renderrows(b.virtualsizeinfo));break;case "theme":h!=g&&(c.jqx.utilities.setTheme(g,h,b.host),b.gridmenu&&b.gridmenu.jqxMenu({theme:h}),b.pageable&&b._updatepagertheme(),b.filterable&&
b._updatefilterrowui(!0),b.showeverpresentrow&&b._updateaddnewrowui(!0));break;case "showtoolbar":case "toolbarheight":g!=h&&(b._arrange(),b.refresh());break;case "showstatusbar":g!=h&&(b.statusbar&&(h?b.statusbar.show():b.statusbar.hide()),b._arrange(),b.refresh());break;case "statusbarheight":g!=h&&(b._arrange(),b.refresh());break;case "filterable":case "showfilterrow":g!=h&&b.render();break;case "autoshowfiltericon":case "showfiltercolumnbackground":case "showpinnedcolumnbackground":case "showsortcolumnbackground":g!=
h&&b.rendergridcontent();break;case "showrowdetailscolumn":g!=h&&b.render();break;case "scrollbarsize":g!=h&&(c.jqx.utilities.scrollBarSize=h,b._arrange());break;case "width":case "height":g!=h&&(b._updatesize(!0,!0),b._resizeWindow(),b.virtualmode&&!b._loading?b.vScrollInstance.setPosition(0):setTimeout(function(){b._renderrows(b.virtualsizeinfo)},100));break;case "altrows":case "altstart":case "altstep":g!=h&&b._renderrows(b.virtualsizeinfo);break;case "groupsheaderheight":g!=h&&(b._arrange(),b._initgroupsheader&&
b._initgroupsheader());break;case "pagerheight":g!=h&&b._initpager();break;case "selectedrowindex":b.selectrow(h);break;case "selectionmode":g!=h&&("none"==h&&(b.selectedrowindexes=[],b.selectedcells=[],b.selectedrowindex=-1),b._renderrows(b.virtualsizeinfo),"checkbox"==h&&b._render(!1,!1,!0,!1,!1));break;case "showheader":h?b.columnsheader.css("display","block"):b.columnsheader.css("display","none");break;case "virtualmode":g!=h&&(b.dataview.virtualmode=b.virtualmode,b.dataview.refresh(!1),b._render(!1,
!1,!1));break;case "columnsmenu":g!=h&&b.render();break;case "columngroups":b._render(!0,!0,!0,!1,!1);break;case "columns":b.columns&&b.columns.length>b.headerZIndex&&(b.headerZIndex=b.columns.length+100);if(b._serializeObject(b._cachedcolumns)!==b._serializeObject(h)){var l=!1;b.filterable&&g&&g.records&&c.each(g.records,function(){this.filter&&(l=!0);b.dataview.removefilter(this.displayfield,this.filter)});b._columns=null;b._filterrowcache=[];b.render();l&&b.applyfilters();b._cachedcolumns=b.columns;
b.removesort&&b.removesort()}else b[d]=g;break;case "autoheight":g!=h&&b._render(!1,!1,!0);break;case "pagermode":case "pagerbuttonscount":g!=h&&b._initpager&&(b.pagershowrowscombo&&(b.pagershowrowscombo.jqxDropDownList("destroy"),b.pagershowrowscombo=null),b.pagerrightbutton&&(b.removeHandler(b.pagerrightbutton,"mousedown"),b.removeHandler(b.pagerrightbutton,"mouseup"),b.removeHandler(b.pagerrightbutton,"click"),b.pagerrightbutton.jqxButton("destroy"),b.pagerrightbutton=null),b.pagerleftbutton&&
(b.removeHandler(b.pagerleftbutton,"mousedown"),b.removeHandler(b.pagerleftbutton,"mouseup"),b.removeHandler(b.pagerleftbutton,"click"),b.pagerleftbutton.jqxButton("destroy"),b.removeHandler(c(document),"mouseup.pagerbuttons"+b.element.id),b.pagerleftbutton=null),b.pagerdiv.remove(),b._initpager());break;case "pagesizeoptions":case "pageable":case "pagesize":if(g!=h){if(b._loading)throw Error("jqxGrid: "+b.loadingerrormessage);if(b.host.jqxDropDownList&&b.host.jqxListBox){if(b._initpager){if("pageable"!=
d&&"pagermode"!=d&&"string"==typeof h)throw g="The expected value type is: Int.","pagesize"!=d&&(g="The expected value type is: Array of Int values."),Error("Invalid Value for: "+d+". "+g);b.dataview.pageable=b.pageable;b.dataview.pagenum=0;b.dataview.pagesize=b._getpagesize();b.virtualmode&&b.updatebounddata();b.dataview.refresh(!0);b._initpager();"pagesizeoptions"==d&&null!=h&&0<h.length&&(b.pagesize=parseInt(h[0]),b.dataview.pagesize=parseInt(h[0]),b.prerenderrequired=!0,b._requiresupdate=!0,b.dataview.pagenum=
-1,b.gotopage(0))}b._render(!1,!1,!1)}else b._testmodules()}break;case "groups":b._serializeObject(g)!==b._serializeObject(h)&&(b.dataview.groups=h,b._refreshdataview(),b._render(!0,!0,!0,!1));break;case "groupable":g!=h&&(b.dataview.groupable=b.groupable,b.dataview.pagenum=0,b.dataview.refresh(!1),b._render(!1,!1,!0));break;case "renderstatusbar":null!=h&&b.renderstatusbar(b.statusbar);break;case "rendertoolbar":null!=h&&b.rendertoolbar(b.toolbar);break;case "disabled":h?b.host.addClass(b.toThemeProperty("jqx-fill-state-disabled")):
b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")),c.jqx.aria(b,"aria-disabled",b.disabled),b.pageable&&(b.pagerrightbutton&&(b.pagerrightbutton.jqxButton({disabled:h}),b.pagerleftbutton.jqxButton({disabled:h}),b.pagershowrowscombo.jqxDropDownList({disabled:h}),b.pagergotoinput.attr("disabled",h)),b.pagerfirstbutton&&(b.pagerfirstbutton.jqxButton({disabled:h}),b.pagerlastbutton.jqxButton({disabled:h}))),b.vScrollBar.jqxScrollBar({disabled:h}),b.hScrollBar.jqxScrollBar({disabled:h}),
b.filterable&&b.showfilterrow&&b._updatefilterrowui(!0),b.showeverpresentrow&&b._updateaddnewrowui(!0)}}});c.jqx.collection=function(b){this.records=[];this.owner=b;this.updating=!1;this.beginupdate=function(){this.updating=!0};this.resumeupdate=function(){this.updating=!1};this._raiseEvent=function(b){};this.clear=function(){this.records=[]};this.replace=function(b,d){this.records[b]=d;this.updating||this._raiseEvent({type:"replace",element:d})};this.isempty=function(b){return void 0==this.records[b]?
!0:!1};this.initialize=function(b){1>b&&(b=1);this.records[b-1]=-1};this.length=function(){return this.records.length};this.indexOf=function(b){return this.records.indexOf(b)};this.add=function(b){if(null==b)return!1;this.records[this.records.length]=b;this.updating||this._raiseEvent({type:"add",element:b});return!0};this.insertAt=function(b,d){return null==b||void 0==b||null==d?!1:0<=b?b<this.records.length?(this.records.splice(b,0,d),this.updating||this._raiseEvent({type:"insert",index:b,element:d}),
!0):this.add(d):!1};this.remove=function(b){if(null==b||void 0==b)return!1;var d=this.records.indexOf(b);return-1!=d?(this.records.splice(d,1),this.updating||this._raiseEvent({type:"remove",element:b}),!0):!1};this.removeAt=function(b){if(null==b||void 0==b||0>b)return!1;if(b<this.records.length){var d=this.records[b];this.records.splice(b,1);this.updating||this._raiseEvent({type:"removeAt",index:b,element:d});return!0}return!1};return this};c.jqx.dataview=function(){this.self=this;this.aggregates=
!1;this.grid=null;this.uniqueId="id";this.records=[];this.rows=[];this.columns=[];this.groups=[];this.filters=[];this.update=this.updated=null;this.suspend=!1;this.totalrecords=this.totalrows=this.pagenum=this.pagesize=0;this.groupable=!0;this.loadedrecords=[];this.loadedrootgroups=[];this.loadedgroups=[];this.loadedgroupsByKey=[];this.virtualmode=!0;this._cachegrouppages=[];this.source=null;this.changedrecords=[];this.rowschangecallback=null;this.that=this;this.destroy=function(){delete this.self;
delete this.grid;delete this.uniqueId;delete this.records;delete this.rows;delete this.columns;delete this.groups;delete this.filters;delete this.updated;delete this.update;delete this.suspend;delete this.pagesize;delete this.pagenum;delete this.totalrows;delete this.totalrecords;delete this.groupable;delete this.loadedrecords;delete this.loadedrootgroups;delete this.loadedgroups;delete this.loadedgroupsByKey;delete this.virtualmode;delete this._cachegrouppages;delete this.source;delete this.changedrecords;
delete this.rowschangecallback;delete this.that};this.suspendupdate=function(){this.suspend=!0};this.isupdating=function(){return this.suspend};this.resumeupdate=function(b){this.suspend=!1;void 0==b&&(b=!0);this.refresh(b)};this.getrecords=function(){return this.records};this.clearrecords=function(){this.recordids=[]};this.databind=function(b,d){var g=b._source?!0:!1,h=null;this.grid&&(this.aggregates=this.grid.showgroupaggregates);g?(h=b,b=b._source):h=new c.jqx.dataAdapter(b,{autoBind:!1});var l=
function(d){d.totalrecords=h.totalrecords;if(d.virtualmode){var f={startindex:d.pagenum*d.pagesize,endindex:d.pagenum*d.pagesize+d.pagesize};void 0!=b.recordstartindex&&(f.startindex=parseInt(b.recordstartindex));void 0!=b.recordendindex?f.endindex=parseInt(b.recordendindex):d.grid.pageable||(f.endindex=f.startindex+100,d.grid.autoheight&&(f.endindex=f.startindex+d.totalrecords));b.recordendindex||(d.grid.pageable?f={startindex:d.pagenum*d.pagesize,endindex:d.pagenum*d.pagesize+d.pagesize}:(f.endindex=
f.startindex+100,d.grid.autoheight&&(f.endindex=f.startindex+d.totalrecords)));f.data=h.records;if(d.grid.rendergridrows&&0<d.totalrecords){var g=0;b.records=d.grid.rendergridrows(f);b.records.length&&(g=b.records.length);if(b.records&&!b.records[f.startindex]){var l=[],q=f.startindex;c.each(b.records,function(){l[q]=this;q++;g++});b.records=l}0==g&&b.records&&c.each(b.records,function(){g++});if(0<g&&g<f.endindex-f.startindex&&!d.grid.groupable)for(var w=b.records[0],z=0;z<f.endindex-f.startindex-
g;z++){var r={};for(obj in w)r[obj]="";b.records.push&&b.records.push(r)}}b.records&&0!=d.totalrecords||(b.records=[]);d.originaldata=b.records;d.records=b.records;d.cachedrecords=b.records}else d.originaldata=h.originaldata,d.records=h.records,d.recordids=h.recordids,d.cachedrecords=h.cachedrecords};h.recordids=[];h.records=[];h.cachedrecords=[];h.originaldata=[];h._options.virtualmode=this.virtualmode;h._options.totalrecords=this.totalrecords;h._options.originaldata=this.originaldata;h._options.recordids=
this.recordids;h._options.cachedrecords=[];h._options.pagenum=this.pagenum;h._options.pageable=this.pageable;void 0!=b.type&&(h._options.type=b.type);void 0!=b.formatdata&&(h._options.formatData=b.formatdata);void 0!=b.contenttype&&(h._options.contentType=b.contenttype);void 0!=b.async&&(h._options.async=b.async);void 0!=b.updaterow&&(h._options.updaterow=b.updaterow);void 0!=b.addrow&&(h._options.addrow=b.addrow);void 0!=b.deleterow&&(h._options.deleterow=b.deleterow);0==this.pagesize&&(this.pagesize=
10);h._options.pagesize=this.pagesize;this.source=b;void 0!==d&&(uniqueId=d);var q=this.that;switch(b.datatype){default:null==b.localdata&&(b.localdata=[]);null!=b.localdata&&(h.unbindBindingUpdate(q.grid.element.id),(!q.grid.autobind&&q.grid.isInitialized||q.grid.autobind)&&h.dataBind(),g=function(d){if(void 0!=d&&""!=d){if(h._changedrecords[0]){var f=[];c.each(h._changedrecords,function(b){var e=this.index,c=this.record;q.grid._updateFromAdapter=!0;switch(d){case "update":e=q.grid.getrowid(e);b==
h._changedrecords.length-1?q.grid.updaterow(e,c):q.grid.updaterow(e,c,!1);q.grid._updateFromAdapter=!1;break;case "add":q.grid.addrow(null,c);q.grid._updateFromAdapter=!1;break;case "remove":e=q.grid.getrowid(e),f.push(e)}});0<f.length&&(q.grid.deleterow(f,!1),q.grid._updateFromAdapter=!1)}if("update"==d)return}var g=q.totalrecords;l(q,d);null===b.localdata.notifier&&"observableArray"==b.localdata.name&&(b.localdata.notifier=function(d){if(!this._updating){this._updating=!0;var f=q.grid.getrowid(d.index);
switch(d.type){case "add":var g=c.extend({},d.object[d.index]),f=h.getid(b.id,g,d.index);0===d.index?q.grid.addrow(f,g,"first"):q.grid.addrow(f,g);break;case "delete":q.grid.deleterow(f);break;case "update":d.path&&1<d.path.split(".").length?(g=d.path.split("."),q.grid.setcellvalue(d.index,g[g.length-1],d.newValue)):(g=c.extend({},d.object[d.index]),q.grid.updaterow(f,g))}this._updating=!1}});"updateData"==d?(q.refresh(),q.grid._updateGridData()):(b.recordstartindex&&this.virtualmode?q.updateview(b.recordstartindex,
b.recordstartindex+q.pagesize):q.refresh(),q.update(g!=q.totalrecords))},g(),h.bindBindingUpdate(q.grid.element.id,g));break;case "json":case "jsonp":case "xml":case "xhtml":case "script":case "text":case "csv":case "tab":if(null!=b.localdata)h.unbindBindingUpdate(q.grid.element.id),(!q.grid.autobind&&q.grid.isInitialized||q.grid.autobind)&&h.dataBind(),g=function(d){var c=q.totalrecords;l(q);"updateData"==d?(q.refresh(),q.grid._updateGridData()):(b.recordstartindex&&q.virtualmode?q.updateview(b.recordstartindex,
b.recordstartindex+q.pagesize):q.refresh(),q.update(c!=q.totalrecords))},g(),h.bindBindingUpdate(q.grid.element.id,g);else{for(var r=[],t=0,g={},v=0;v<this.filters.length;v++){var y=this.filters[v].datafield,A=this.filters[v].filter;if(A.getfilters){var w=A.getfilters();g[y+"operator"]=A.operator;for(A=0;A<w.length;A++){w[A].datafield=y;var z=w[A].value;if("datefilter"==w[A].type)if(w[A].value&&w[A].value.toLocaleString){var C=this.grid.getcolumn(w[A].datafield);C&&C.cellsformat?(C=this.grid.source.formatDate(w[A].value,
C.cellsformat,this.grid.gridlocalization),g["filtervalue"+t]=C?C:w[A].value.toLocaleString()):g["filtervalue"+t]=z.toString()}else g["filtervalue"+t]=z.toString();else g["filtervalue"+t]=z.toString(),w[A].data&&(g["filterid"+t]=w[A].data.toString()),w[A].id&&(g["filterid"+t]=w[A].id.toString());g["filtercondition"+t]=w[A].condition;g["filteroperator"+t]=w[A].operator;g["filterdatafield"+t]=y;C={label:z.toString()};w[A].data&&(C.value=w[A].data.toString());C.value=w[A].id?w[A].id.toString():z.toString();
C.condition=w[A].condition;C.operator=0==w[A].operator?"and":"or";C.field=y;C.type=w[A].type;z=!1;if(0<r.length)for(var D=0;D<r.length;D++){var E=r[D];if(E.field==y){E.filters.push(C);z=!0;break}}z||(r.push({field:y,filters:[]}),r[r.length-1].filters.push(C));t++}}}g.filterGroups=r;g.filterscount=t;g.groupscount=q.groups.length;for(v=0;v<q.groups.length;v++)g["group"+v]=q.groups[v];void 0==b.recordstartindex&&(b.recordstartindex=0);if(void 0==b.recordendindex||0==b.recordendindex)q.grid.height&&-1==
q.grid.height.toString().indexOf("%")?(b.recordendindex=parseInt(q.grid.height)/q.grid.rowsheight,b.recordendindex+=2):b.recordendindex=c(window).height()/q.grid.rowsheight,b.recordendindex=parseInt(b.recordendindex),this.pageable&&(b.recordendindex=this.pagesize);this.pageable&&(b.recordstartindex=this.pagenum*this.pagesize,b.recordendindex=(this.pagenum+1)*this.pagesize);c.extend(g,{sortdatafield:q.sortfield,sortorder:q.sortfielddirection,pagenum:q.pagenum,pagesize:q.grid.pagesize,recordstartindex:b.recordstartindex,
recordendindex:b.recordendindex});(r=h._options.data)?c.extend(h._options.data,g):(b.data&&c.extend(g,b.data),h._options.data=g);g=function(){var d=function(){var d=q.totalrecords;l(q);b.recordstartindex&&q.virtualmode?q.updateview(b.recordstartindex,b.recordstartindex+q.pagesize):q.refresh();q.update(d!=q.totalrecords)};if(c.jqx.browser.msie&&9>c.jqx.browser.version)try{d()}catch(f){}else d()};h.unbindDownloadComplete(q.grid.element.id);h.bindDownloadComplete(q.grid.element.id,g);!q.grid.autobind&&
q.grid.isInitialized||q.grid.autobind?h.dataBind():q.grid.isInitialized||q.grid.autobind||g();h._options.data=r}}};this.getid=function(b,d,g){return 0<c(b,d).length?c(b,d).text():b&&0<b.toString().length&&(b=c(d).attr(b),null!=b&&0<b.toString().length)?b:g};this.getvaluebytype=function(b,d){var g=b;if("date"==d.type){var h=new Date(b);b="NaN"==h.toString()||"Invalid Date"==h.toString()?c.jqx.dataFormat?c.jqx.dataFormat.tryparsedate(b):h:h;null==b&&(b=g)}else"float"==d.type?(b=parseFloat(b),isNaN(b)&&
(b=g)):"int"==d.type?(b=parseInt(b),isNaN(b)&&(b=g)):"bool"==d.type&&(null!=b&&("false"==b.toLowerCase()?b=!1:"true"==b.toLowerCase()&&(b=!0)),b=1==b?!0:0==b?!1:"");return b};this.setpaging=function(b){void 0!=b.pageSize&&(this.pagesize=b.pageSize);void 0!=b.pageNum&&(this.pagenum=Math.min(b.pageNum,Math.ceil(this.totalrows/this.pagesize)));this.refresh()};this.getpagingdetails=function(){return{pageSize:this.pagesize,pageNum:this.pagenum,totalrows:this.totalrows}};this._clearcaches=function(){this.sortcache=
{};this.sortdata=null;this.changedrecords=[];this.records=[];this.rows=[];this.cacheddata=[];this.originaldata=[];this.bounditems=[];this.loadedrecords=[];this.loadedrootgroups=[];this.loadedgroups=[];this.loadedgroupsByKey=[];this._cachegrouppages=[];this.recordsbyid=[];this.cachedrecords=[];this.recordids=[]};this.addfilter=function(b,d){for(var c=-1,h=0;h<this.filters.length;h++)if(this.filters[h].datafield==b){c=h;break}-1==c?this.filters[this.filters.length]={filter:d,datafield:b}:this.filters[c]=
{filter:d,datafield:b}};this.removefilter=function(b){for(var d=0;d<this.filters.length;d++)if(this.filters[d].datafield==b){this.filters.splice(d,1);break}};this.getItemFromIndex=function(b){return this.records[b]};this.updaterow=function(b,d,c){if(!(this.filters&&0<this.filters.length&&!this.virtualmode||void 0==d)&&void 0!=b){d.uid=b;d[this.source.id]||(d[this.source.id]=d.uid);var h=this.recordsbyid["id"+b],l=this.records.indexOf(h);if(-1==l)return!1;this.records[l]=d;this.cachedrecords&&(this.cachedrecords[l]=
d);1!=c&&void 0!=c||this.refresh();this.changedrecords[d.uid]={Type:"Update",OldData:h,Data:d};return!0}if(this.filters&&0<this.filters.length){for(var q=this.cachedrecords,h=null,l=-1,r=0;r<q.length;r++)if(q[r].uid==b){h=q[r];l=r;break}if(h){b=this.that;for(var t in d)b.cachedrecords[l][t]=d[t];1!=c&&void 0!=c||this.refresh();return!0}}return!1};this.addrow=function(b,d,g,h){if(void 0!=d){c.isEmptyObject(d)&&this.source&&this.source.datafields&&c.each(this.source.datafields,function(){var b="";"number"==
this.type&&(b=null);"date"==this.type&&(b=null);if("bool"==this.type||"boolean"==this.type)b=!1;d[this.name]=b});if(!b||this.recordsbyid["id"+b])for(d.uid=this.getid(this.source.id,d,this.totalrecords),b=this.recordsbyid["id"+d.uid];null!=b;)b=Math.floor(1E4*Math.random()).toString(),d.uid=b,b=this.recordsbyid["id"+b];else d.uid=b;d[this.source.id]||void 0==this.source.id||(d[this.source.id]=d.uid);"last"==g?this.records.push(d):"number"===typeof g&&isFinite(g)?this.records.splice(g,0,d):this.records.splice(0,
0,d);this.filters&&0<this.filters.length&&("last"==g?this.cachedrecords.push(d):"number"===typeof g&&isFinite(g)?this.cachedrecords.splice(g,0,d):this.cachedrecords.splice(0,0,d));this.totalrecords++;this.virtualmode&&(this.source.totalrecords=this.totalrecords);1!=h&&void 0!=h||this.refresh();this.changedrecords[d.uid]={Type:"New",Data:d};return!0}return!1};this.deleterow=function(b,d){if(void 0!=b){var c=this.filters&&0<this.filters.length;if(this.recordsbyid["id"+b]&&!c){var c=this.recordsbyid["id"+
b],h=this.records.indexOf(c);if(this.grid&&this.grid.sortable&&"many"==this.grid.sortmode)for(var l=0;l<this.records.length;l++)if(this.records[l].boundindex===c.boundindex){h=l;break}this.changedrecords[b]={Type:"Delete",Data:this.records[h]};this.records.splice(h,1);this.totalrecords--;this.virtualmode&&(this.source.totalrecords=this.totalrecords);1!=d&&void 0!=d||this.refresh();return!0}if(this.filters&&0<this.filters.length){for(var q=this.cachedrecords,c=null,h=-1,l=0;l<q.length;l++)if(q[l].uid==
b){c=q[l];h=l;break}if(c){this.cachedrecords.splice(h,1);if(1==d||void 0==d)this.totalrecords=0,this.records=this.cachedrecords,this.refresh();return!0}}}return!1};this.reload=function(b,d,g,h,l,q,r){var t=this.that;l=[];var v=d.length,y=0;this.columns=[];this.bounditems=[];this.loadedrecords=[];this.loadedrootgroups=[];this.loadedgroups=[];this.loadedgroupsByKey=[];this._cachegrouppages=[];this.recordsbyid={};0==this.totalrecords&&(Object.size=function(b){var d=0,e;for(e in b)b.hasOwnProperty(e)&&
d++;return d},this.totalrecords=Object.size(b),c.each(this.records,function(b){var d=0;c.each(this,function(b,e){t.columns[d++]=b});return!1}));if(this.virtualmode){if(this.pageable){this.updateview();return}q=0;if(this.groupable)r=this.totalrecords;else{this.updateview();return}}else q=0,r=this.totalrecords;if(this.groupable&&0<this.groups.length&&this.loadgrouprecords)var A=q,A=this.loadgrouprecords(0,q,r,g,0,h,d,v,l);else y=this.loadflatrecords(q,r,g,0,h,d,v,l);0<v&&d.splice(0,v-0);this.totalrows=
0<this.groups.length&&this.groupable?A:y;return l};this.loadflatrecords=function(b,d,g,h,l,q,r,t){var v=this.that,y=g=b;d=Math.min(d,this.totalrecords);for(var A=null!=this.sortdata,w=A?this.sortdata:this.records;b<d;b++){var z={};A?(z=c.extend({},w[b].value),id=z[v.uniqueId],z.boundindex=w[b].index,void 0==z.uid&&(z.uid=v.getid(v.source.id,z,z.boundindex)),v.recordsbyid["id"+z.uid]=w[b].value,v.loadedrecords[g]=z,z.uniqueid=v.generatekey(),v.bounditems[z.boundindex]=z):(z=Object(w[b]),id=z[v.uniqueId],
z.boundindex=g,v.loadedrecords[g]=z,void 0==z.uid&&(z.uid=v.getid(v.source.id,z,g)),v.recordsbyid["id"+z.uid]=w[b],z.uniqueid=v.generatekey(),v.bounditems[this.bounditems.length]=z);if(h>=r||id!=q[h][v.uniqueId]||l&&l[id])t[t.length]=h;q[h]=z;h++;z.visibleindex=y;y++;g++}if(v.grid.summaryrows){var C=g;c.each(v.grid.summaryrows,function(){var b=c.extend({},this);b.boundindex=d++;v.loadedrecords[C]=b;b.uniqueid=v.generatekey();v.bounditems[v.bounditems.length]=b;q[h]=b;h++;b.visibleindex=y;y++;C++})}return y};
this.updateview=function(b,d){var c=this.that,h=this.pagesize*this.pagenum,l=0,q=[],r=this.filters,t=this.updated,v=q.length;if(this.pageable){if(this.virtualmode)if(!this.groupable||0==this.groups.length)this.loadflatrecords(this.pagesize*this.pagenum,this.pagesize*(1+this.pagenum),r,l,t,q,v,[]),this.totalrows=q.length;else if(this.groupable&&0<this.groups.length&&this.loadgrouprecords){if(void 0!=this._cachegrouppages[this.pagenum+"_"+this.pagesize]){this.rows=this._cachegrouppages[this.pagenum+
"_"+this.pagesize];this.totalrows=this.rows.length;return}c=this.pagesize*(1+this.pagenum);c>this.totalrecords&&(c=this.totalrecords);this.loadgrouprecords(0,this.pagesize*this.pagenum,c,r,l,t,q,v,[]);this._cachegrouppages[this.pagenum+"_"+this.pagesize]=this.rows;this.totalrows=this.rows.length;return}}else if(this.virtualmode&&(!this.groupable||0==this.groups.length)){var y=this.pagesize;0==y&&(y=Math.min(100,this.totalrecords));null!=b&&null!=d?this.loadflatrecords(b,d,r,l,t,q,v,[]):this.loadflatrecords(this.pagesize*
this.pagenum,this.pagesize*(1+this.pagenum),r,l,t,q,v,[]);this.totalrows=this.loadedrecords.length;this.rows=q;if(q.length>=y)return}if(this.groupable&&this.pageable&&0<this.groups.length&&this._updategroupsinpage)q=this._updategroupsinpage(c,r,h,l,v,this.pagesize*this.pagenum,this.pagesize*(1+this.pagenum));else for(r=this.pagesize*this.pagenum;r<this.pagesize*(1+this.pagenum);r++)if(t=r<this.loadedrecords.length?this.loadedrecords[r]:null,null!=t){if(!this.pagesize||h>=this.pagesize*this.pagenum&&
h<=this.pagesize*(this.pagenum+1))q[l]=t,l++;h++}if((0==q.length||q.length<this.pagesize)&&!this.pageable&&this.virtualmode)for(h=l=q.length,r=this.pagesize*this.pagenum;r<this.pagesize*(1+this.pagenum)-h;r++)t={},t.boundindex=r+h,t.visibleindex=r+h,t.uniqueid=c.generatekey(),t.empty=!0,c.bounditems[r+h]=t,q[l]=t,l++;this.rows=q};this.generatekey=function(){var b=function(){return 16*(1+Math.random())|0};return""+b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()};this.reloaddata=function(){this.reload(this.records,
this.rows,this.filter,this.updated,!0)};this.refresh=function(b){if(!this.suspend){void 0==b&&(b=!0);var d=this.rows.length,g=this.totalrows;if(0<this.filters.length&&!this.virtualmode){var h,l=this.cachedrecords.length,q=[];this.totalrecords=0;var r=this.cachedrecords;this._dataIndexToBoundIndex=[];var t=this.filters.length;if(null!=this.source&&void 0!=this.source.filter&&void 0!=this.source.localdata)q=this.source.filter(this.filters,r,l),void 0==q&&(q=[]),this.records=q;else if(null==this.source.filter||
void 0==this.source.filter){for(var v=0;v<l;v++){for(var y=r[v],A=void 0,w=0;w<t;w++){h=this.filters[w].filter;var z=y[this.filters[w].datafield],C=h.evaluate(z);this.grid.filter&&(z=this.grid.filter(z,y,this.filters[w].datafield,h,C),void 0!==z&&(C=z));A=void 0==A?C:"or"==h.operator?A||C:A&&C}A?(q[q.length]=c.extend({dataindex:v},y),this._dataIndexToBoundIndex[v]={boundindex:q.length-1}):this._dataIndexToBoundIndex[v]=null}this.records=q}if(this.sortdata)if(this.grid&&"many"!==this.grid.sortmode){if(h=
this.sortfield,this.sortcache[h]){this.sortdata=null;d=this.sortcache[h].direction;this.sortcache[h]=null;this.sortby(this.sortfield,d);return}}else{d=this.grid.getsortcolumns();for(g=0;g<d.length;g++)b=d[g],h=b.dataField,this.grid.sortby(h,b.ascending,null);return}}else if(0==this.filters.length&&!this.virtualmode&&this.cachedrecords&&(this.totalrecords=0,this.records=r=this.cachedrecords,this.sortdata))if(this.grid&&"many"!==this.grid.sortmode){if(h=this.sortfield,this.sortcache[h]){this.sortdata=
null;d=this.sortcache[h].direction;this.sortcache[h]=null;this.sortby(this.sortfield,d);return}}else{d=this.grid.getsortcolumns();for(g=0;g<d.length;g++)b=d[g],h=b.dataField,this.grid.sortby(h,b.ascending,null);return}b=this.reload(this.records,this.rows,this.filter,this.updated,b);this.updated=null;null!=this.rowschangecallback&&(g!=totalrows&&this.rowschangecallback({type:"PagingChanged",data:getpagingdetails()}),d!=rows.length&&this.rowschangecallback({type:"RowsCountChanged",data:{previous:d,
current:rows.length}}),(0<b.length||d!=rows.length)&&this.rowschangecallback({type:"RowsChanged",data:{previous:d,current:rows.length,diff:b}}))}};return this}})(jqxBaseFramework);
(function(c){c.extend(c.jqx._jqxGrid.prototype,{selectallrows:function(){this._trigger=!1;var b=this.virtualmode?this.dataview.totalrecords:this.dataview.loadedrecords.length;this.selectedrowindexes=[];for(var d=this.dataview.loadedrecords,e=0;e<b;e++){var c=d[e];c?(c=this.getboundindex(c),void 0!=c&&(this.selectedrowindexes[e]=c)):this.selectedrowindexes[e]=e}"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!0});
this._renderrows(this.virtualsizeinfo);this._trigger=!0;"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},unselectallrows:function(){this._trigger=!1;this.selectedrowindexes=[];"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn&&this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1});this._renderrows(this.virtualsizeinfo);this._trigger=!0;"checkbox"==this.selectionmode&&this._raiseEvent(2,{rowindex:this.selectedrowindexes})},
selectrow:function(b,d){this._applyrowselection(b,!0,d);!1!==d&&this._updatecheckboxselection()},_updatecheckboxselection:function(){if("checkbox"==this.selectionmode){var b=this.getrows();if(b&&this._checkboxcolumn)if(0===b.length)this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1});else{b=b.length;this.groupable&&(b=this.dataview.loadedrecords.length);this.virtualmode&&(b=this.source._source.totalrecords);var d=this.selectedrowindexes.length;d===b?this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!0}):
0===d?this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1}):this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:null})}}},unselectrow:function(b,d){this._applyrowselection(b,!1,d);!1!==d&&this._updatecheckboxselection()},selectcell:function(b,d){this._applycellselection(b,d,!0)},unselectcell:function(b,d){this._applycellselection(b,d,!1)},clearselection:function(b,d){this._trigger=!1;this.selectedrowindex=-1;this._oldselectedcell=null;if(!1!==d)for(var e=0;e<this.selectedrowindexes.length;e++)this._raiseEvent(3,
{rowindex:this.selectedrowindexes[e]});this.selectedrowindexes=[];this.selectedcells=[];this.selectedcell=null;"checkbox"!=this.selectionmode||this._checkboxcolumnupdating||this._checkboxcolumn.checkboxelement.jqxCheckBox({checked:!1});for(e=0;e<this.columns.records.length;e++)this.columns.records[e].selected=!1,this.columns.records[e]._applyStyle();!1===b?this._trigger=!0:(this._renderrows(this.virtualsizeinfo),this._trigger=!0,"checkbox"==this.selectionmode&&this._raiseEvent(3,{rowindex:this.selectedrowindexes}))},
getselectedrowindex:function(){if(-1==this.selectedrowindex||void 0==this.selectedrowindex)for(;0<this.selectedrowindexes.length;)return this.selectedrowindexes[0];return this.selectedrowindex},getselectedrowindexes:function(){return this.selectedrowindexes},getselectedcell:function(){if(!this.selectedcell)return null;var b=this.selectedcell;b.row=this.selectedcell.rowindex;b.column=this.selectedcell.datafield;b.value=this.getcellvalue(b.row,b.column);return b},getselectedcells:function(){var b=[];
for(obj in this.selectedcells)b[b.length]=this.selectedcells[obj];return b},_getcellsforcopypaste:function(){var b=[];if(-1==this.selectionmode.indexOf("cell"))for(var d=this.selectedrowindexes,e=0;e<d.length;e++)for(var c=d[e],g=0;g<this.columns.records.length;g++)"_checkboxcolumn"!==this.columns.records[g].datafield&&b.push({rowindex:c,datafield:this.columns.records[g].datafield});return b},deleteselection:function(){var b=this.getselectedcells();-1==this.selectionmode.indexOf("cell")&&(b=this._getcellsforcopypaste());
if(null!=b&&0<b.length){for(var d=0;d<b.length;d++){var e=b[d],c=this.getcolumn(e.datafield),g=this.getcellvalue(e.rowindex,e.datafield);if(c&&""!==g){var h=null;"checkbox"==c.columntype&&(c.threestatecheckbox||(h=!1));this._raiseEvent(17,{rowindex:e.rowindex,datafield:e.datafield,value:g});d==b.length-1?this.setcellvalue(e.rowindex,e.datafield,h,!0):this.setcellvalue(e.rowindex,e.datafield,h,!1);c.displayfield!=c.datafield&&this.setcellvalue(e.rowindex,c.displayfield,h,!0);this._raiseEvent(18,{rowindex:e.rowindex,
datafield:e.datafield,oldvalue:g,value:h})}}this.dataview.updateview();this._renderrows(this.virtualsizeinfo)}},copyselection:function(){var b="",d=this;this.clipboardselection={};this.logicalclipboardselection={};this._clipboardselection=[];var e=d.getselectedcells();-1==this.selectionmode.indexOf("cell")&&(e=this._getcellsforcopypaste());var f=[];if(null!=e&&0<e.length){for(var g=999999999999999,h=-1,l=0;l<e.length;l++){var q=e[l],r=d.getcolumn(q.datafield);if(null!=r&&r.clipboard&&(!r.hidden||
this.copytoclipboardhiddencolumns)){-1==f.indexOf(r.text)&&f.push(r.text);var t=d.getcelltext(q.rowindex,r.displayfield),v=this.getrowdisplayindex(q.rowindex);this.clipboardselection[v]||(this.clipboardselection[v]={});this.clipboardselection[v][r.displayfield]=t;this.logicalclipboardselection[v]||(this.logicalclipboardselection[v]={});this.logicalclipboardselection[v][r.displayfield]=t;r.displayfield!=r.datafield&&(this.logicalclipboardselection[v][r.datafield]=d.getcellvalue(q.rowindex,r.datafield));
g=Math.min(g,v);h=Math.max(h,v)}}e=[];for(l=g;l<=h;l++)this.logicalclipboardselection[l]&&(q=c.extend({},this.logicalclipboardselection[l]),e.push(q));this.logicalclipboardselection=e;if(this.copytoclipboardwithheaders){for(e=0;e<f.length;e++)0<e&&(b+="\t"),b+=f[e];b+="\r\n"}for(l=g;l<=h;l++){var y=0;this._clipboardselection[this._clipboardselection.length]=[];void 0!=this.clipboardselection[l]&&(c.each(this.clipboardselection[l],function(e,c){0<y&&(b+="\t");var f=c;null==c&&(f="");d._clipboardselection[d._clipboardselection.length-
1][y]=f;y++;b+=f}),l<h&&(b+="\r\n"))}}return this.clipboardselectedtext=b},pasteselection:function(){var b=this.getselectedcells();this._oldselectedcell=null;-1==this.selectionmode.indexOf("cell")&&(b=this._getcellsforcopypaste());if(null!=b&&0<b.length){var d=this.getrowdisplayindex(b[0].rowindex),e=this._getcolumnindex(b[0].datafield);this.selectedrowindexes=[];this.selectedcells=[];var c=0,g=[];this.copytoclipboardwithheaders&&this._clipboardselection.splice(0,1);for(var h=0;h<this._clipboardselection.length;h++){c+=
this._clipboardselection[h].length;g[h]=[];for(var l=0;l<this._clipboardselection[h].length;l++){var q=this._clipboardselection[h][l];g[h].push(q)}}if(c<b.length){d=[];for(h=0;h<b.length;h++)c=b[h],d[c.rowindex]||(d[c.rowindex]=[]),d[c.rowindex].push(c);for(var r=e=0,h=0;h<d.length;h++)if(d[h]){for(l=0;l<d[h].length;l++){var c=d[h][l],b=c.rowindex,t=this.getcolumn(c.datafield);if("_checkboxcolumn"!==t.datafield&&!t.hidden){q="";void 0==g[e][r]&&(r=0);q=g[e][r];r++;if(t.cellsformat&&(-1!=t.cellsformat.indexOf("p")||
-1!=t.cellsformat.indexOf("c")||-1!=t.cellsformat.indexOf("n")||-1!=t.cellsformat.indexOf("f"))){-1<q.indexOf(this.gridlocalization.currencysymbol)&&(q=q.replace(this.gridlocalization.currencysymbol,""));var v=function(b,d,e){var c=b;if(d==e)return b;for(b=c.indexOf(d);-1!=b;)c=c.replace(d,e),b=c.indexOf(d);return c},q=v(q,this.gridlocalization.thousandsseparator,""),q=q.replace(this.gridlocalization.decimalseparator,".");-1<q.indexOf(this.gridlocalization.percentsymbol)&&(q=q.replace(this.gridlocalization.percentsymbol,
""));for(var v="",y=0;y<q.length;y++){var A=q.substring(y,y+1);"-"===A&&(v+="-");"."===A&&(v+=".");null!=A.match(/^[0-9]+$/)&&(v+=A)}q=v;q=q.replace(/ /g,"");q=new Number(q);isNaN(q)&&(q="")}this._raiseEvent(17,{rowindex:b,datafield:c.datafield,value:q});this.setcellvalue(b,t.displayfield,q,!1);t.displayfield!=t.datafield&&this.logicalclipboardselection&&this.logicalclipboardselection[b]&&(v=this.logicalclipboardselection[b][t.datafield],void 0!=v&&this.setcellvalue(b,t.datafield,v,!1));this._raiseEvent(18,
{rowindex:b,datafield:c.datafield,oldvalue:this.getcellvalue(c.rowindex,c.datafield),value:q});this._applycellselection(b,c.datafield,!0,!1)}}e++;r=0;g[e]||(e=0)}}else{if(!this._clipboardselection)return;for(g=0;g<this._clipboardselection.length;g++)for(h=0;h<this._clipboardselection[g].length;h++)if((t=this.getcolumnat(e+h))&&"_checkboxcolumn"!==t.datafield&&!t.hidden&&(b=this.getrowboundindex(d+g),c=this.getcell(b,t.datafield),q=null,q=this._clipboardselection[g][h],null!=q)){if(t.cellsformat&&
(-1!=t.cellsformat.indexOf("p")||-1!=t.cellsformat.indexOf("c")||-1!=t.cellsformat.indexOf("n")||-1!=t.cellsformat.indexOf("f"))){-1<q.indexOf(this.gridlocalization.currencysymbol)&&(q=q.replace(this.gridlocalization.currencysymbol,""));v=function(b,d,e){var c=b;if(d==e)return b;for(b=c.indexOf(d);-1!=b;)c=c.replace(d,e),b=c.indexOf(d);return c};q=v(q,this.gridlocalization.thousandsseparator,"");q=q.replace(this.gridlocalization.decimalseparator,".");-1<q.indexOf(this.gridlocalization.percentsymbol)&&
(q=q.replace(this.gridlocalization.percentsymbol,""));v="";for(y=0;y<q.length;y++)A=q.substring(y,y+1),"-"===A&&(v+="-"),"."===A&&(v+="."),null!=A.match(/^[0-9]+$/)&&(v+=A);q=v;q=q.replace(/ /g,"");q=new Number(q);isNaN(q)&&(q="")}this._raiseEvent(17,{rowindex:b,datafield:c.datafield,value:q});this.setcellvalue(b,t.displayfield,q,!1);t.displayfield!=t.datafield&&this.logicalclipboardselection&&(v=this.logicalclipboardselection[g][t.datafield],void 0!=v&&this.setcellvalue(b,t.datafield,v,!1));this._raiseEvent(18,
{rowindex:b,datafield:c.datafield,oldvalue:this.getcellvalue(c.rowindex,c.datafield),value:q});this._applycellselection(b,c.datafield,!0,!1)}}"checkbox"==this.selectionmode&&this._updatecheckboxselection();this.dataview.updateview();this._renderrows(this.virtualsizeinfo)}this.clipboardend&&this.clipboardend("paste")},_applyrowselection:function(b,d,e,c,g){if(null==b)return!1;g=this.selectedrowindex;"singlerow"==this.selectionmode&&(d?this._raiseEvent(2,{rowindex:b,row:this.getrowdata(b)}):this._raiseEvent(3,
{rowindex:b,row:this.getrowdata(b)}),this._raiseEvent(3,{rowindex:g}),this.selectedrowindexes=[],this.selectedcells=[]);1==c&&(this.selectedrowindexes=[]);0<this.dataview.filters.length&&((c=this.getrowdata(b))&&void 0!==c.dataindex?b=c.dataindex:c&&void 0===c.dataindex&&void 0!=c.uid&&(b=this.getrowboundindexbyid(c.uid)));c=this.selectedrowindexes.indexOf(b);if(d)this.selectedrowindex=b,-1==c?(this.selectedrowindexes.push(b),"singlerow"!=this.selectionmode&&this._raiseEvent(2,{rowindex:b,row:this.getrowdata(b)})):
"multiplerows"==this.selectionmode&&(this.selectedrowindexes.splice(c,1),this._raiseEvent(3,{rowindex:this.selectedrowindex,row:this.getrowdata(b)}),this.selectedrowindex=0<this.selectedrowindexes.length?this.selectedrowindexes[this.selectedrowindexes.length-1]:-1);else if(0<=c||"singlerow"==this.selectionmode||"multiplerowsextended"==this.selectionmode||"multiplerowsadvanced"==this.selectionmode)d=this.selectedrowindexes[c],this.selectedrowindexes.splice(c,1),this._raiseEvent(3,{rowindex:d,row:this.getrowdata(b)}),
this.selectedrowindex=-1;(void 0==e||e)&&this._rendervisualrows();return!0},_applycellselection:function(b,d,e,c){if(null==b||null==d)return!1;if("singlecell"==this.selectionmode){var g=this.selectedcell;null!=g&&this._raiseEvent(16,{rowindex:g.rowindex,datafield:g.datafield});this.selectedcells=[]}if("multiplecellsextended"==this.selectionmode||"multiplecellsadvanced"==this.selectionmode)g=this.selectedcell,null!=g&&this._raiseEvent(16,{rowindex:g.rowindex,datafield:g.datafield});g=b+"_"+d;if(0<
this.dataview.filters.length){var h=this.getrowdata(b);h&&void 0!==h.dataindex?(b=h.dataindex,g=b+"_"+d):h&&void 0===h.dataindex&&h.uid&&(b=this.getrowboundindexbyid(h.uid),g=b+"_"+d)}b={rowindex:b,datafield:d};if(e)if(this.selectedcell=b,!this.selectedcells[g])this.selectedcells[g]=b,this.selectedcells.length++,this._raiseEvent(15,b);else{if("multiplecells"==this.selectionmode||"multiplecellsextended"==this.selectionmode||"multiplecellsadvanced"==this.selectionmode)delete this.selectedcells[g],0<
this.selectedcells.length&&this.selectedcells.length--,this._raiseEvent(16,b)}else delete this.selectedcells[g],0<this.selectedcells.length&&this.selectedcells.length--,this._raiseEvent(16,b);(void 0==c||c)&&this._rendervisualrows();return!0},_getcellindex:function(b){var d=-1;c.each(this.selectedcells,function(){d++;if(this[b])return!1});return d},_clearhoverstyle:function(){if(void 0!=this.hoveredrow&&-1!=this.hoveredrow&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()){var b=
this.table.find(".jqx-grid-cell-hover");0<b.length&&(b.removeClass(this.toTP("jqx-grid-cell-hover")),b.removeClass(this.toTP("jqx-fill-state-hover")));for(var d=0;d<b.length;d++){var e=b[d].getAttribute("columnindex");e&&(e=this.columns.records[parseInt(e)])&&e._applyCellStyle(b[d])}this.hoveredrow=-1}},_clearselectstyle:function(){for(var b=this.table[0].rows.length,d=this.table[0].rows,e=this.toTP("jqx-grid-cell-selected"),f=this.toTP("jqx-fill-state-pressed"),g=this.toTP("jqx-grid-cell-hover"),
h=this.toTP("jqx-fill-state-hover"),l=0;l<b;l++)for(var q=d[l],r=q.cells.length,q=q.cells,t=0;t<r;t++){var v=q[t],y=c(v);-1!=v.className.indexOf("jqx-grid-cell-selected")&&(y.removeClass(e),y.removeClass(f));-1!=v.className.indexOf("jqx-grid-cell-hover")&&(y.removeClass(g),y.removeClass(h));(y=v.getAttribute("columnindex"))&&(y=this.columns.records[parseInt(y)])&&y._applyCellStyle(v)}},_selectpath:function(b,d){var e=this._lastClickedCell?Math.min(this._lastClickedCell.row,b):0,c=this._lastClickedCell?
Math.max(this._lastClickedCell.row,b):0;if(e<=c){var g=this._getcolumnindex(this._lastClickedCell.column),h=this._getcolumnindex(d),l=Math.min(g,h),g=Math.max(g,h);this.selectedcells=[];for(h=this.dataview.loadedrecords;e<=c;e++)for(var q=l;q<=g;q++)b=h[e],this._applycellselection(this.getboundindex(b),this._getcolumnat(q).datafield,!0,!1);this._rendervisualrows()}},_selectrowpath:function(b){if("multiplerowsextended"==this.selectionmode){var d=this._lastClickedCell?Math.min(this._lastClickedCell.row,
b):0;b=this._lastClickedCell?Math.max(this._lastClickedCell.row,b):0;if(d<=b){for(this.selectedrowindexes=[];d<=b;d++){var e=this.getrowboundindex(d);this._applyrowselection(e,!0,!1)}this._rendervisualrows()}}},_selectrowwithmouse:function(b,d,e,c,g,h){var l=d.row;if(void 0!=l&&(d=d.index,void 0!=this.hittestinfo[d])){for(var q=0;q<this.columns.records.length;q++){var r=this.columns.records[q];r.selected=!1;r.element&&r.element.removeAttribute("selected");r._applyStyle()}q=this.hittestinfo[d].visualrow;
if(!this.hittestinfo[d].details&&!l.group){if("multiplerows"==this.selectionmode||"multiplecells"==this.selectionmode||"checkbox"==this.selectionmode||-1!=this.selectionmode.indexOf("multiple")&&(1==h||1==g)){r=this.getboundindex(l);if(0<this.dataview.filters.length){var t=this.getrowdata(r);t&&(r=t.dataindex,void 0==r&&(r=this.getboundindex(l)))}r=-1!=e.indexOf(r);e=this.getboundindex(l)+"_"+c;if(-1!=this.selectionmode.indexOf("cell"))g=void 0!=this.selectedcells[e],void 0!=this.selectedcells[e]&&
g?this._selectcellwithstyle(b,!1,d,c,q):this._selectcellwithstyle(b,!0,d,c,q),h&&void 0==this._lastClickedCell&&(b=this.getselectedcells())&&0<b.length&&(this._lastClickedCell={row:b[0].rowindex,column:b[0].datafield}),h&&this._lastClickedCell&&(this._selectpath(l.visibleindex,c),this.mousecaptured=!1,"visible"==this.selectionarea.css("visibility")&&this.selectionarea.css("visibility","hidden"));else if(r?g?this._applyrowselection(this.getboundindex(l),!1):this._selectrowwithstyle(b,q,!1,c):this._selectrowwithstyle(b,
q,!0,c),h&&void 0==this._lastClickedCell&&(b=this.getselectedrowindexes())&&0<b.length&&(this._lastClickedCell={row:b[0],column:c}),h&&this._lastClickedCell){this.selectedrowindexes=[];b=this._lastClickedCell?Math.max(this._lastClickedCell.row,l.visibleindex):0;g=this.dataview.loadedrecords;for(d=this._lastClickedCell?Math.min(this._lastClickedCell.row,l.visibleindex):0;d<=b;d++)(l=g[d])&&this._applyrowselection(this.getboundindex(l),!0,!1,!1);this._rendervisualrows()}}else this._clearselectstyle(),
this._selectrowwithstyle(b,q,!0,c),-1!=this.selectionmode.indexOf("cell")&&this._selectcellwithstyle(b,!0,d,c,q);h||(this._lastClickedCell={row:l.visibleindex,column:c})}}},_selectcellwithstyle:function(b,d,e,f,g){b=c(g.cells[b._getcolumnindex(f)]);b.removeClass(this.toTP("jqx-grid-cell-hover"));b.removeClass(this.toTP("jqx-fill-state-hover"));d?(b.addClass(this.toTP("jqx-grid-cell-selected")),b.addClass(this.toTP("jqx-fill-state-pressed"))):(b.removeClass(this.toTP("jqx-grid-cell-selected")),b.removeClass(this.toTP("jqx-fill-state-pressed")));
this.getcolumn(f)._applyCellStyle(b)},_selectrowwithstyle:function(b,d,e,f){var g=d.cells.length,h=0;b.rowdetails&&b.showrowdetailscolumn?this.rtl?g=g-1-this.groups.length:h=1+this.groups.length:this.groupable&&(this.rtl?g-=this.groups.length:h=this.groups.length);for(;h<g;h++){var l=d.cells[h];e?(c(l).removeClass(this.toTP("jqx-grid-cell-hover")),c(l).removeClass(this.toTP("jqx-fill-state-hover")),-1==b.selectionmode.indexOf("cell")&&(c(l).addClass(this.toTP("jqx-grid-cell-selected")),c(l).addClass(this.toTP("jqx-fill-state-pressed")))):
(c(l).removeClass(this.toTP("jqx-grid-cell-hover")),c(l).removeClass(this.toTP("jqx-grid-cell-selected")),c(l).removeClass(this.toTP("jqx-fill-state-hover")),c(l).removeClass(this.toTP("jqx-fill-state-pressed")));(f=l.getAttribute("columnindex"))&&(f=this.columns.records[parseInt(f)])&&f._applyCellStyle(l)}},_handlemousemoveselection:function(b,d){if(d.hScrollInstance.isScrolling()||d.vScrollInstance.isScrolling())return!1;if(("multiplerowsextended"==d.selectionmode||"multiplecellsextended"==d.selectionmode||
"multiplecellsadvanced"==d.selectionmode)&&d.mousecaptured){if(d.multipleselectionbegins&&!1===d.multipleselectionbegins(b))return!0;var e=this.showheader?this.columnsheader.height()+2:0,f=this._groupsheader()?this.groupsheader.height():0,g=this.showtoolbar?this.toolbar.height():0,f=f+g,g=this.host.coord();if(this.hasTransform){var g=c.jqx.utilities.getOffset(this.host),h=this._getBodyOffset();g.left-=h.left;g.top-=h.top}"0px"===this.host.css("border-top-width")&&(f-=2);var l=b.pageX,h=b.pageY-f;
if(3<Math.abs(this.mousecaptureposition.left-l)||3<Math.abs(this.mousecaptureposition.top-h)){parseInt(this.columnsheader.coord().top);this.hasTransform&&c.jqx.utilities.getOffset(this.columnsheader);l<g.left&&(l=g.left);l>g.left+this.host.width()&&(l=g.left+this.host.width());e=g.top+e;h<e&&(h=e+5);var q=parseInt(Math.min(d.mousecaptureposition.left,l)),e=-5+parseInt(Math.min(d.mousecaptureposition.top,h)),r=parseFloat(Math.abs(d.mousecaptureposition.left-l)),t=parseInt(Math.abs(d.mousecaptureposition.top-
h)),q=q-g.left,e=e-g.top;this.selectionarea.css("visibility","visible");if("multiplecellsadvanced"==d.selectionmode){var l=q,v=l+r,y=d.hScrollInstance,h=y.value;this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(h=y.max-y.value);var A=d.table[0].rows[0],w=0,z=y=d.mousecaptureposition.clickedcell,w=!1,C=0,D=A.cells.length;d.mousecaptureposition.left<=b.pageX&&(C=y);for(var E=!1;C<D;C++){var F=parseFloat(c(this.columnsrow[0].cells[C]).css("left")),G=F-h;if(d.columns.records[C].pinned&&!d.columns.records[C].hidden)if(C==
y&&(E=!0),F+=c(this.columnsrow[0].cells[C]).width(),d.mousecaptureposition.left>b.pageX){if(F>=l&&l>=G){z=C;w=!0;break}}else{if(F>=v&&v>=G){z=C;w=!0;break}}else{if(E){w=!0;z--;break}F=this._getcolumnat(C);if(!(null!=F&&F.hidden||d.groupable&&0<d.groups.length&&C<d.groups.length))if(F=G+c(this.columnsrow[0].cells[C]).width(),d.mousecaptureposition.left>b.pageX){if(F>=l&&l>=G){z=C;w=!0;break}}else if(F>=v&&v>=G){z=C;w=!0;break}}}if(!w)if(d.mousecaptureposition.left>b.pageX)c.each(this.columns.records,
function(b,e){if(d.groupable&&0<d.groups.length&&b<d.groups.length)return!0;if(!this.pinned&&!this.hidden)return z=b,!1});else if(!d.groupable||d.groupable&&0< !d.groups.length)z=A.cells.length-1;C=y;y=Math.min(y,z);z=Math.max(C,z);e=e+5+f;d.table[0].rows.indexOf(d.mousecaptureposition.clickedrow);A=0;v=l=-1;for(C=D=0;C<d.table[0].rows.length;C++){G=c(d.table[0].rows[C]);0==C&&(D=G.coord().top);var F=G.height(),I=D-g.top;if(-1==l&&I+F>=e){for(var w=!1,M=0;M<d.groups.length;M++){var O=G[0].cells[M].className;
if(-1!=O.indexOf("jqx-grid-group-collapse")||-1!=O.indexOf("jqx-grid-group-expand")){w=!0;break}}if(w)continue;l=C}D+=F;if(d.groupable&&0<d.groups.length){w=!1;for(M=0;M<d.groups.length;M++)if(O=G[0].cells[M].className,-1!=O.indexOf("jqx-grid-group-collapse")||-1!=O.indexOf("jqx-grid-group-expand")){w=!0;break}if(w)continue;w=0;for(M=d.groups.length;M<G[0].cells.length;M++)""==c(G[0].cells[M]).html()&&w++;if(w==G[0].cells.length-d.groups.length)continue}-1!=l&&(A+=F);if(I+F>e+t){v=C;break}}if(-1!=
l&&(e=c(d.table[0].rows[l]).coord().top-g.top-f-2,f=0,this.filterable&&this.showfilterrow&&(f=this.filterrowheight),0>parseFloat(d.table[0].style.top)&&e<this.rowsheight+f&&(e-=parseFloat(d.table[0].style.top),A+=parseFloat(d.table[0].style.top)),t=A,g=c(this.columnsrow[0].cells[y]),f=c(this.columnsrow[0].cells[z]),q=parseFloat(g.css("left")),r=parseFloat(f.css("left"))-parseFloat(q)+f.width()-2,q-=h,E&&(q+=h),d.editcell&&d.editable&&d.endcelledit&&(y!=z||l!=v))){if(0==d.editcell.validated)return;
d.endcelledit(d.editcell.row,d.editcell.column,!0,!0)}}this.selectionarea.width(r);this.selectionarea.height(t);this.selectionarea.css("left",q);this.selectionarea.css("top",e)}}},_handlemouseupselection:function(b,d){if(this.selectionarea){if("visible"!=this.selectionarea[0].style.visibility)return d.mousecaptured=!1,!0;if(d.mousecaptured&&("multiplerowsextended"==d.selectionmode||"multiplerowsadvanced"==d.selectionmode||"multiplecellsextended"==d.selectionmode||"multiplecellsadvanced"==d.selectionmode)&&
(d.mousecaptured=!1,"visible"==this.selectionarea.css("visibility"))){this.selectionarea.css("visibility","hidden");var e=this.showheader?this.columnsheader.height()+2:0,f=this._groupsheader()?this.groupsheader.height():0;"0px"===this.host.css("border-top-width")&&(f-=2);var g=this.showtoolbar?this.toolbar.height():0,f=f+g,h=this.selectionarea.coord(),l=this.host.coord();this.hasTransform&&(l=c.jqx.utilities.getOffset(this.host),h=c.jqx.utilities.getOffset(this.selectionarea));"0px"===this.host.css("border-top-width")&&
(f-=2);var g=h.left-l.left,q=e=h.top-e-l.top-f,f=g+this.selectionarea.width(),r=[],h=[];if("multiplerowsextended"==d.selectionmode){for(;e<q+this.selectionarea.height();){var t=this._hittestrow(g,e),l=t.row,v=t.index;-1==v||h[v]||(h[v]=!0,r[r.length]=t);e+=20}q=0;c.each(r,function(){var e=this.row;"none"!=d.selectionmode&&d._selectrowwithmouse&&(b.ctrlKey||b.metaKey?d._applyrowselection(d.getboundindex(e),!0,!1,!1):0==q?d._applyrowselection(d.getboundindex(e),!0,!1,!0):d._applyrowselection(d.getboundindex(e),
!0,!1,!1),q++)})}else{"multiplecellsadvanced"==d.selectionmode&&(e+=2);l=d.hScrollInstance;r=l.value;this.rtl&&("hidden"!=this.hScrollBar.css("visibility")&&(r=l.max-l.value),"hidden"!=this.vScrollBar[0].style.visibility&&(r-=this.scrollbarsize+4));var y=d.table[0].rows[0],A=d.selectionarea.height();!b.ctrlKey&&!b.metaKey&&0<A&&(d.selectedcells=[]);for(;e<q+A;){if(t=d._hittestrow(g,e))if(l=t.row,v=t.index,-1!=v&&!h[v])for(h[v]=!0,t=0;t<y.cells.length;t++){var v=parseFloat(c(d.columnsrow[0].cells[t]).css("left"))-
r,w=v+c(d.columnsrow[0].cells[t]).width();(g>=v&&g<=w||f>=v&&f<=w||v>=g&&v<=f)&&d._applycellselection(d.getboundindex(l),d._getcolumnat(t).datafield,!0,!1)}e+=5}}d.autosavestate&&d.savestate&&d.savestate();d._renderrows(d.virtualsizeinfo)}}},selectprevcell:function(b,d){var e=this._getcolumnindex(d),e=this._getprevvisiblecolumn(e);null!=e&&(this.clearselection(),this.selectcell(b,e.datafield))},selectnextcell:function(b,d){var e=this._getcolumnindex(d),e=this._getnextvisiblecolumn(e);null!=e&&(this.clearselection(),
this.selectcell(b,e.datafield))},_getfirstvisiblecolumn:function(){for(var b=this.columns.records.length,d=0;d<b;d++){var e=this.columns.records[d];if(!e.hidden&&null!=e.datafield)return e}return null},_getlastvisiblecolumn:function(){for(var b=this.columns.records.length-1;0<=b;b--){var d=this.columns.records[b];if(!d.hidden&&null!=d.datafield)return d}return null},_handlekeydown:function(b,d){if(d.disabled)return!1;var e=b.charCode?b.charCode:b.keyCode?b.keyCode:0;if(d.editcell&&"multiplecellsadvanced"!=
d.selectionmode)return!0;if(d.editcell&&"multiplecellsadvanced"==d.selectionmode)if(33<=e&&40>=e){if(b.altKey||void 0!=d._cancelkeydown&&0!=d._cancelkeydown)return d._cancelkeydown=!1,!0;if("selectedrow"!==d.editmode){if(d.endcelledit(d.editcell.row,d.editcell.column,!1,!0),d._cancelkeydown=!1,d.editcell&&!d.editcell.validated)return d._rendervisualrows(),d.endcelledit(d.editcell.row,d.editcell.column,!1,!0),!1}else return!0}else return!0;if("none"==d.selectionmode||d.showfilterrow&&d.filterable&&
this.filterrow&&c(b.target).ischildof(d.filterrow)||d.showeverpresentrow&&(d.addnewrowtop&&c(b.target).ischildof(d.addnewrowtop)||d.addnewrowbottom&&c(b.target).ischildof(d.addnewrowbottom))||b.target.className&&0<=b.target.className.indexOf("jqx-grid-widget")||d.pageable&&c(b.target).ischildof(this.pager)||this.showtoolbar&&c(b.target).ischildof(this.toolbar)||this.showstatusbar&&c(b.target).ischildof(this.statusbar))return!0;var f=!1;if(b.altKey)return!0;if((b.ctrlKey||b.metaKey)&&this.clipboard){var g=
String.fromCharCode(e).toLowerCase();if(this.clipboardbegin){var h=null;"c"==g?h=this.clipboardbegin("copy",this.copyselection()):"x"==g?h=this.clipboardbegin("cut",this.copyselection()):"v"==g&&(h=this.clipboardbegin("paste"));if(!1===h)return!1}if("c"==g||"x"==g){h=this.copyselection();"c"==g&&this.clipboardend&&this.clipboardend("copy");"x"==g&&this.clipboardend&&this.clipboardend("cut");if(window.clipboardData)window.clipboardData.setData("Text",h);else{var l=c('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');
l.val(h);c("body").append(l);l.select();setTimeout(function(){document.designMode="off";l.select();l.remove();d.focus()},100)}if("c"==g&&c.jqx.browser.msie)return!1;if("c"==g)return!0}else if("v"==g){var q=c('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');c("body").append(q);q.select();var r=this;setTimeout(function(){r._clipboardselection=[];var b=q.val();0==b.length&&window.clipboardData&&(q.val(window.clipboardData.getData("Text")),b=q.val());for(var b=b.split("\n"),d=0;d<
b.length;d++)if(0<b[d].split("\t").length){var e=b[d].split("\t");(1!=e.length||d!=b.length-1||""!=e[0])&&0<e.length&&r._clipboardselection.push(e)}r.pasteselection();q.remove();r.focus()},100);return!0}if("x"==g)return this.deleteselection(),this.host.focus(),!1}var g=Math.round(d._gettableheight()),t=Math.round(g/d.rowsheight),v=d.getdatainformation();switch(d.selectionmode){case "singlecell":case "multiplecells":case "multiplecellsextended":case "multiplecellsadvanced":h=d.getselectedcell();null===
h&&d.selectcell(0,d.columns.records[0].displayfield);if(null!=h){var g=this.getrowvisibleindex(h.rowindex),y=h.datafield,A=d._getcolumnindex(y),w=function(e,c,g,h){var l=function(e,c){var l=d.dataview.loadedrecords[e];if(d.groupable&&0<d.groups.length){var q=e;"up"==h&&q++;"down"==h&&q--;for(var l=d.getdisplayrows()[q],w=1,z=!0;z&&300>w;){z=!1;"down"==h?l=d.getdisplayrows()[q+w]:"up"==h&&(l=d.getdisplayrows()[q-w]);if(!l)break;l&&l.group&&(z=!0);for(var r=l.parentItem;r;){var t;if(t=r)t=r.group?d.expandedgroups[r.uniqueid]?
d.expandedgroups[r.uniqueid].expanded:void 0:!1,t=!t;t&&(z=!0);r=r.parentItem}if(!z)break;w++}300==w&&(l=null);if(d.pageable&&(q=!1,l)){for(w=0;w<d.dataview.rows.length;w++)d.dataview.rows[w].boundindex==l.boundindex&&(q=!0);q||(l=null)}}else if(d.pageable&&(q=!1,l)){for(w=0;w<d.dataview.rows.length;w++)d.dataview.rows[w].boundindex==l.boundindex&&(q=!0);q||(d.pagerpageinput&&9===b.keyCode&&l.boundindex>d.dataview.rows[d.dataview.rows.length-1].boundindex&&(d.pagerpageinput.focus(),b.preventDefault()),
d.ensurerowvisible(l))}return void 0!=l&&null!=c?((g||void 0==g)&&d.clearselection(),l=d.getboundindex(l),d.selectcell(l,c),d._oldselectedcell=d.selectedcell,f=!0,d.groupable?d.ensurecellvisible(l,c):d.ensurecellvisible(e,c),!0):!1};l(e,c)||d.groupable||(d.ensurecellvisible(e,c),l(e,c),d.virtualmode&&d.host.focus());d.groupable&&0<d.groups.length||(b.shiftKey&&9!=b.keyCode?"multiplecellsextended"!=d.selectionmode&&"multiplecellsadvanced"!=d.selectionmode||!d._lastClickedCell||(d._selectpath(e,c),
e=d.getboundindex(d.dataview.loadedrecords[e]),d.selectedcell={rowindex:e,datafield:c}):b.shiftKey||(d._lastClickedCell={row:e,column:c}))},z=b.shiftKey&&"singlecell"!=d.selectionmode&&"multiplecells"!=d.selectionmode,h=function(){d.pageable?w(d.dataview.pagenum*d.dataview.pagesize,y,!z):w(0,y,!z)},C=function(){var b=v.rowscount-1;d.pageable&&(b=d.dataview.pagenum*d.dataview.pagesize+d.dataview.rows.length-1);w(b,y,!z)},D=9==e&&!b.shiftKey,E=9==e&&b.shiftKey;if(d.rtl)var F=D,D=E,E=F;if(D||E)z=!1;
if((D||E)&&document.activeElement&&document.activeElement.className&&0<=document.activeElement.className.indexOf("jqx-grid-cell-add-new-row"))return!0;if((F=b.ctrlKey||b.metaKey)&&37==e)t=d._getfirstvisiblecolumn(A),null!=t&&w(g,t.datafield);else if(F&&39==e)t=d._getlastvisiblecolumn(A),null!=t&&w(g,t.datafield);else if(39==e||D)t=d._getnextvisiblecolumn(A),null!=t?w(g,t.datafield,!z):D?(t=d._getfirstvisiblecolumn(),e=40,y=t.displayfield):f=!0;else if(37==e||E)t=d._getprevvisiblecolumn(A),null!=t?
w(g,t.datafield,!z):E?(t=d._getlastvisiblecolumn(),e=38,y=t.displayfield):f=!0;else if(36==e)h();else if(35==e)C();else if(33==e)if(0<=g-t){var G=g-t;w(G,y,!z);d.pageable&&d.virtualmode&&(d.gotoprevpage(),setTimeout(function(){w(G,y,!z)},25))}else h();else 34==e&&(v.rowscount>g+t?(G=g+t,w(G,y,!z),d.pageable&&d.virtualmode&&(d.gotonextpage(),setTimeout(function(){w(G,y,!z)},25))):C());38==e&&(F?h():0<g?w(g-1,y,!z,"up"):f=!1);40==e&&(F?C():v.rowscount>g+1||d.groupable&&0<d.groups.length?w(g+1,y,!z,
"down"):f=!0)}break;case "singlerow":case "multiplerows":case "multiplerowsextended":case "multiplerowsadvanced":g=d.getselectedrowindex();if(null==g||-1==g)return!0;var g=this.getrowvisibleindex(g),I=function(c,g,h){var l=function(b){var e=d.dataview.loadedrecords[b];if(d.groupable&&0<d.groups.length){"up"==h&&b++;"down"==h&&b--;for(var e=d.getdisplayrows()[b],c=1,l=!0;l&&300>c;){l=!1;"down"==h?e=d.getdisplayrows()[b+c]:"up"==h&&(e=d.getdisplayrows()[b-c]);if(!e)break;e&&e.group&&(l=!0);for(var q=
e.parentItem;q;){var w;if(w=q)w=q.group?d.expandedgroups[q.uniqueid]?d.expandedgroups[q.uniqueid].expanded:void 0:!1,w=!w;w&&(l=!0);q=q.parentItem}if(!l)break;c++}300==c&&(e=null);if(d.pageable&&(c=!1,e)){for(l=0;l<d.dataview.rows.length;l++)d.dataview.rows[l].boundindex==e.boundindex&&(c=!0);c||(e=null)}}return void 0!=e?(e=d.getboundindex(e),c=d.selectedrowindex,(g||void 0==g)&&d.clearselection(),d.selectedrowindex=c,d.selectrow(e,!1),(d.groupable?d.ensurerowvisible(e):d.ensurerowvisible(b))&&!d.autoheight&&
!d.groupable||d._rendervisualrows(),f=!0):!1};l(c)||d.groupable||(d.ensurerowvisible(c),l(c,g),d.virtualmode&&setTimeout(function(){l(c,g)},25),d.virtualmode&&d.host.focus());d.groupable&&0<d.groups.length||(b.shiftKey&&9!=e?"multiplerowsextended"==d.selectionmode&&d._lastClickedCell&&(d._selectrowpath(c),d.selectedrowindex=d.getrowboundindex(c)):b.shiftKey||(d._lastClickedCell={row:c},d.selectedrowindex=d.getrowboundindex(c)))},z=b.shiftKey&&"singlerow"!=d.selectionmode&&"multiplerows"!=d.selectionmode,
h=function(){d.pageable?I(d.dataview.pagenum*d.dataview.pagesize,!z):I(0,!z)},C=function(){var b=v.rowscount-1;d.pageable&&(b=d.dataview.pagenum*d.dataview.pagesize+d.dataview.rows.length-1);I(b,!z)},F=b.ctrlKey||b.metaKey;36==e||F&&38==e?h():35==e||F&&40==e?C():33==e?0<=g-t?(G=g-t,I(G,!z),d.pageable&&d.virtualmode&&(d.gotoprevpage(),setTimeout(function(){I(G,!z)},25))):h():34==e?v.rowscount>g+t?(G=g+t,I(G,!z),d.pageable&&d.virtualmode&&(d.gotonextpage(),setTimeout(function(){I(G,!z)},25))):C():38==
e?0<g?I(g-1,!z,"up"):f=!0:40==e&&(v.rowscount>g+1||d.groupable&&0<d.groups.length?I(g+1,!z,"down"):f=!0)}return f?(d.autosavestate&&d.savestate&&d.savestate(),!1):!0},_handlemousemove:function(b,d){if(!d.vScrollInstance.isScrolling()&&!d.hScrollInstance.isScrolling()){var e,f,g,h;if(d.enablehover||"multiplerows"==d.selectionmode)e=this.showheader?this.columnsheader.height()+2:0,f=this._groupsheader()?this.groupsheader.height():0,f+=this.showtoolbar?this.toolbarheight:0,g=this.host.coord(),this.hasTransform&&
(g=c.jqx.utilities.getOffset(this.host),h=this._getBodyOffset(),g.left-=h.left,g.top-=h.top),h=b.pageX-g.left,e=b.pageY-e-g.top-f;if("multiplerowsextended"!=d.selectionmode&&"multiplecellsextended"!=d.selectionmode&&"multiplecellsadvanced"!=d.selectionmode||1!=d.mousecaptured)if(d.enablehover){if(!d.disabled&&!this.vScrollInstance.isScrolling()&&!this.hScrollInstance.isScrolling()&&(e=this._hittestrow(h,e))){var l=e.row;e=e.index;if(-1==this.hoveredrow||-1==e||this.hoveredrow!=e||-1!=this.selectionmode.indexOf("cell")||
"checkbox"==this.selectionmode)if(this._clearhoverstyle(),-1!=e&&void 0!=l&&(f=this.hittestinfo[e].visualrow,null!=f&&!(this.hittestinfo[e].details||b.clientX>c(f).width()+c(f).coord().left))){var q=0;g=f.cells.length;d.rowdetails&&d.showrowdetailscolumn?this.rtl?g=g-1-this.groups.length:q=1+this.groups.length:this.groupable&&(this.rtl?g-=this.groups.length:q=this.groups.length);if(0!=f.cells.length){var r=f.cells[q].className;if(!(l.group||0<=this.selectionmode.indexOf("row")&&-1!=r.indexOf("jqx-grid-cell-selected")))if(this.hoveredrow=
e,-1!=this.selectionmode.indexOf("cell")||"checkbox"==this.selectionmode){var l=-1,t=this.hScrollInstance,r=t.value;for(this.rtl&&"hidden"!=this.hScrollBar.css("visibility")&&(r=t.max-t.value);q<g;q++)if(t=parseInt(c(this.columnsrow[0].cells[q]).css("left"))-r,this.columns.records[q].pinned&&!this.rtl&&(t=parseInt(c(this.columnsrow[0].cells[q]).css("left"))),t+c(this.columnsrow[0].cells[q]).width()>=h&&h>=t){l=q;break}if(-1!=l){h=f.cells[l];this.cellhover&&this.cellhover(h,b.pageX,b.pageY);if(-1==
h.className.indexOf("jqx-grid-cell-selected")&&this.editcell&&(r=this._getcolumnat(l))&&this.editcell.row==e&&this.editcell.column==r.datafield)return;c(h).addClass(this.toTP("jqx-grid-cell-hover"));c(h).addClass(this.toTP("jqx-fill-state-hover"));r=this._getcolumnat(l);r._applyCellStyle(h)}}else for(;q<g;q++)h=f.cells[q],c(h).addClass(this.toTP("jqx-grid-cell-hover")),c(h).addClass(this.toTP("jqx-fill-state-hover")),this.cellhover&&this.cellhover(h,b.pageX,b.pageY),r=this._getcolumnat(q),r._applyCellStyle(h)}}}}else return!0}}})})(jqxBaseFramework);
(function(c){c.jqx.dataview.grouping=function(){this.loadgrouprecords=function(b,d,e,f,g,h,l,q,r){for(var t=b,t=[],v=0;v<this.groups.length;v++)t[v]=this.generatekey();f=[];var y=0,A=[],w=d,z=d,C=this.groups.length;this.loadedrecords=[];this.bounditems=[];this.loadedrecords=[];this.loadedrootgroups=[];this.loadedgroups=[];this.loadedgroupsByKey=[];this.sortedgroups=[];var D=null!=this.sortdata,E=D?this.sortdata:this.records;if(this.pageable){var F=[],G=0;E[d]||(c.each(E,function(b,e){F[d+b++]=this}),
E=F)}if(this.virtualmode){F=[];for(w=G=0;w<e-d;w++)E[w]?F[d+G++]=E[w]:E[d+G]&&(F[d+G]=E[d+G],G++);w=0;E=F}for(G=d;G<e;G++){var I={},I=D?c.extend({},E[G].value):c.extend({},E[G]);id=I[this.uniqueId];if(g>=q||id!=l[g][this.uniqueId]||h&&h[id])r[r.length]=g;for(var M=[],O=0,v=0;v<C;v++){var K=this.groups[v],K=I[K];null==K&&(K="");M[O++]={value:K,hash:t[v]}}if(M.length!=C)break;for(var K=null,v="",O=-1,Q=0;Q<M.length;Q++){O++;var U=M[Q].value,v=v+"_"+M[Q].hash+"_"+U;if(void 0!=A[v]&&null!=A[v])K=A[v];
else{if(null==K)K={group:U,subItems:[],subGroups:[],level:0},f[y++]=K,K.uniqueid=this.generatekey(),this.loadedgroupsByKey[U]=K;else{var X={group:U,subItems:[],subGroups:[],parentItem:K,level:K.level+1};this.loadedgroupsByKey[K.uniqueid+"_"+U]=X;X.uniqueid=this.generatekey();K=K.subGroups[K.subGroups.length++]=X}A[v]=K}}null!=K?(void 0==I.uid&&(I.uid=this.getid(this.source.id,I,w)),D?(I.boundindex=E[G].index,this.recordsbyid["id"+I.uid]=E[G].value):(I.boundindex=w,this.recordsbyid["id"+I.uid]=E[G]),
this.bounditems[I.boundindex]=I,this.sortedgroups[w]=I,I.uniqueid=this.generatekey(),I.parentItem=K,I.level=K.level+1,K.subItems[K.subItems.length++]=I):(void 0==I.uid&&(I.uid=this.getid(this.source.id,I,w)),D?(I.boundindex=E[G].index,this.recordsbyid["id"+I.uid]=E[G].value):(I.boundindex=w,this.recordsbyid["id"+I.uid]=E[G]),this.sortedgroups[w]=I,this.bounditems[I.boundindex]=I,I.uniqueid=this.generatekey());g++;w++;z++}var N=function(d,e,c){for(var f=0;f<e.subItems.length;f++)e.subItems[f].visibleindex=
b+c,d.rows[c]=e.subItems[f],d.loadedrecords[c]=e.subItems[f],c++;return c},V=function(d,e,c){var f=1,g=d.grid.columns.records?d.grid.columns.records:d.grid.columns;if(1==d.aggregates)for(var h=0;h<g.length;h++)g[h].aggregates&&(f=Math.max(f,g[h].aggregates.length));for(subGroup in e.subGroups)h=e.subGroups[subGroup],h.subGroups&&(d.loadedgroups[d.loadedgroups.length]=h,h.visibleindex=b+c,d.rows[c]=h,d.loadedrecords[c]=h,c++,0<h.subGroups.length?c=V(d,h,c):0<h.subItems.length&&(c=N(d,h,c)));0<e.subItems.length&&
(c=N(d,e,c));(function(e){if(1==d.aggregates)for(var h=function(f){var h=e,l={},q=function(b){for(var e=0;e<g.length;e++)if(g[e].aggregates)for(var c=d.grid.getcolumnaggregateddata(g[e].datafield,g[e].aggregates,!0,b),h=0;h<g[e].aggregates.length;h++)if(g[e].aggregates[f]){var q=g[e],w=g[e].aggregates[f],z=w,z=d.grid._getaggregatename(z),r=z+":"+c[w];l[q.datafield]=c[w]?r:z+":"+c[z]}};if(null!=h)if(l.level=h.level,l.visibleindex=b+c,l.uniqueid=d.generatekey(),d.rows[c]=l,d.loadedrecords[c++]=l,l.totalsrow=
!0,0<e.subItems.length){h=e.subItems[e.subItems.length-1];l.parentItem=h.parentItem;l.parentItem.subItems&&(l.parentItem.subItems[l.parentItem.subItems.length]=l);var w=[],z=function(){for(var b=0;b<e.subItems.length;b++)e.subItems[b].totalsrow||(w[w.length]=e.subItems[b])};z(e);q(w)}else 0<e.subGroups.length&&(h=e.subGroups[e.subGroups.length-1],l.level=h.level,l.parentItem=e,e.subGroups[e.subGroups.length]=l,w=[],z=function(b){if(!b.totalsrow){for(var d=0;d<b.subItems.length;d++)b.subItems[d].totalsrow||
(w[w.length]=b.subItems[d]);for(d=0;d<b.subGroups.length;d++)z(b.subGroups[d])}},z(e),q(w))},l=0;l<f;l++)h(l)})(e);return c};e=f.length;this.loadedgroups=[];this.rows=[];for(w=t=0;w<e;w++)K=f[w],this.loadedrootgroups[w]=K,this.loadedgroups[this.loadedgroups.length]=K,K.visibleindex=b+t,this.rows[t]=K,this.loadedrecords[t]=K,t++,t=V(this,K,t);return t};this._updategroupsinpage=function(b,d,e,f,g,h,l){var q=[];if(this.groupable&&0<this.groups.length){d=0;g=[];for(var r=[],t=0;t<b.groups.length;t++)r[t]=
b.generatekey();var v=0,y=[],A=0;l>this.totalrecords&&(l=this.totalrecords);for(;h<l;h++){var w=c.extend({},b.sortedgroups[h]);id=w[b.uniqueId];if(!b.pagesize||e>=b.pagesize*b.pagenum&&e<b.pagesize*(b.pagenum+1)){for(var z=[],C=0,t=0;t<b.groups.length;t++){var D=b.groups[t],D=w[D];null==D&&(D="");z[C++]={value:D,hash:r[t]}}if(z.length!=b.groups.length)break;for(var t=null,C="",D=-1,E=0;E<z.length;E++){D++;var F=z[E].value,C=C+"_"+z[E].hash+"_"+F;if(void 0!=g[C]&&null!=g[C])t=g[C];else{if(null==t)t=
{group:F,subItems:[],subGroups:[],level:0},y[A++]=t,F=b.loadedgroupsByKey[F],void 0!=F&&(t.visibleindex=F.visibleindex,t.uniqueid=F.uniqueid);else{var G={group:F,subItems:[],subGroups:[],parentItem:t,level:t.level+1},F=b.loadedgroupsByKey[t.uniqueid+"_"+F];G.visibleindex=F.visibleindex;G.uniqueid=F.uniqueid;t=t.subGroups[t.subGroups.length++]=G}g[C]=t}}null!=t&&(w.parentItem=t,w.level=t.level+1,t.subItems[t.subItems.length++]=w);f++}v++;e++}for(var I=function(b,d,e){for(b=0;b<d.subItems.length;b++)q[e]=
c.extend({},d.subItems[b]),e++;return e},M=function(b){for(subGroup in b.subGroups){var d=b.subGroups[subGroup];if(d.subGroups&&(0<d.subGroups.length&&M(d)||0<d.subItems.length))return!0}return 0<b.subItems.length?!0:!1},O=function(b,d,e){var c=1,f=b.grid.columns.records?b.grid.columns.records:b.grid.columns;if(1==b.aggregates)for(var g=0;g<f.length;g++)f[g].aggregates&&(c=Math.max(c,f[g].aggregates.length));g=function(d){if(1==b.aggregates)for(var g=function(c){var g=d,h={},l=function(d){for(var e=
0;e<f.length;e++)if(f[e].aggregates)for(var g=b.grid.getcolumnaggregateddata(f[e].datafield,f[e].aggregates,!0,d),l=0;l<f[e].aggregates.length;l++)if(f[e].aggregates[c]){var q=f[e],w=f[e].aggregates[c],z=w,z=b.grid._getaggregatename(z);h[q.datafield]=z+":"+g[w]}};if(null!=g)if(h.level=g.level,h.visibleindex=e,h.uniqueid=b.generatekey(),q[e]=h,b.loadedrecords[e++]=h,h.totalsrow=!0,0<d.subItems.length){g=d.subItems[d.subItems.length-1];h.parentItem=g.parentItem;h.parentItem.subItems&&(h.parentItem.subItems[h.parentItem.subItems.length]=
h);var w=[],z=function(){for(var b=0;b<d.subItems.length;b++)d.subItems[b].totalsrow||(w[w.length]=d.subItems[b])};z(d);l(w)}else 0<d.subGroups.length&&(g=d.subGroups[d.subGroups.length-1],h.level=g.level,h.parentItem=d,d.subGroups[d.subGroups.length]=h,w=[],z=function(b){if(!b.totalsrow){for(var d=0;d<b.subItems.length;d++)b.subItems[d].totalsrow||(w[w.length]=b.subItems[d]);for(d=0;d<b.subGroups.length;d++)z(b.subGroups[d])}},z(d),l(w))},h=0;h<c;h++)g(h)};for(subGroup in d.subGroups){var h=d.subGroups[subGroup];
h.subGroups&&M(h)&&(q[e]=h,e++,0<h.subGroups.length?e=O(b,h,e):0<h.subItems.length&&(e=I(b,h,e)),g(h))}0<d.subItems.length&&(e=I(b,d,e));g(d);return e},v=0;v<y.length;v++)D=y[v],M(D)&&(q[d]=D,d++,d=O(this,D,d))}return q}};c.extend(c.jqx._jqxGrid.prototype,{_initgroupsheader:function(){this.groupsheader.css("visibility","hidden");if(this._groupsheader()){this.groupsheader.css("visibility","inherit");var b=this,d=this.gridlocalization.groupsheaderstring;this.groupsheaderdiv=this.groupsheaderdiv||c('<div style="width: 100%; position: relative;"></div>');
this.groupsheaderdiv.height(this.groupsheaderheight);this.groupsheaderdiv.css("top",0);this.groupsheader.append(this.groupsheaderdiv);this.groupheadersbounds=[];var e=this.groups.length;this.groupsheaderdiv.children().remove();this.groupsheaderdiv[0].innerHTML="";var f=[];0<e?c.each(this.groups,function(d){var h=this,l=b._getColumnText(this).label,l=b._rendergroupcolumn(l,h);l.addClass(b.toThemeProperty("jqx-grid-group-column"));b.groupsheaderdiv.append(l);if(b.closeablegroups){var q=c(l.find(".jqx-icon-close"));
b.isTouchDevice()&&!0!==b.touchmode?b.addHandler(q,"touchstart",function(){b.removegroupat(d);return!1}):b.addHandler(q,"click",function(){b.removegroupat(d);return!1})}b.sortable&&b.addHandler(l,"click",function(){var d=b.getcolumn(h);null!=d&&b._togglesort(d);return!1});f[f.length]=l;b._handlegroupstocolumnsdragdrop(this,l);d<e-1&&(l=l.height(),q=c('<div style="float: left; position: relative;"></div>'),b.rtl&&q.css("float","right"),q.width(b.groupindentwidth/3),q.height(1),q.css("top",l/2),q.addClass(b.toThemeProperty("jqx-grid-group-column-line")),
b.groupsheaderdiv.append(q))}):(d=c('<div style="position: relative;">'+d+"</div>"),this.groupsheaderdiv.append(d),this.rtl&&d.addClass(this.toThemeProperty("jqx-rtl")));this._groupheaders=f;this._updategroupheadersbounds()}},_updategroupheadersbounds:function(){var b=this,d=this.groupsheaderdiv.children().outerHeight(),d=(this.groupsheader.height()-d)/2;this.groupsheaderdiv.css("top",d);this.rtl?(this.groupsheaderdiv.css("left",""),this.groupsheaderdiv.css("right",d)):(this.groupsheaderdiv.css("left",
d),this.groupsheaderdiv.css("right",""));this.rtl&&this._groupheaders.reverse();c.each(this._groupheaders,function(d){var c=this.coord();b.groupheadersbounds[d]={left:c.left,top:c.top,width:this.outerWidth(),height:this.outerHeight(),index:d}})},addgroup:function(b){b&&(this.groups!==this.dataview.groups&&(this.dataview.groups=this.groups),this.groups[this.groups.length]=b,this.refreshgroups(),this._raiseEvent(12,{type:"Add",index:this.groups[this.groups.length],groups:this.groups}))},insertgroup:function(b,
d){void 0!=b&&null!=b&&0<=b&&b<=this.groups.length&&d&&(this.groups!==this.dataview.groups&&(this.dataview.groups=this.groups),this.groups.splice(b,0,d.toString()),this.refreshgroups(),this._raiseEvent(12,{type:"Insert",index:b,groups:this.groups}))},refreshgroups:function(){this._refreshdataview();this._render(!0,!0,!0,!1);this._postrender("group")},_insertaftergroup:function(b,d){var e=this._getGroupIndexByDataField(b);this.insertgroup(e+1,d)},_insertbeforegroup:function(b,d){var e=this._getGroupIndexByDataField(b);
this.insertgroup(e,d)},removegroupat:function(b){return 0<=b&&null!=b&&void 0!=b?(this.groups!==this.dataview.groups&&(this.dataview.groups=this.groups),this.groups.splice(b,1),this.refreshgroups(),this.virtualmode&&this.updatebounddata(),this._raiseEvent(12,{type:"Remove",index:b,groups:this.groups}),!0):!1},cleargroups:function(){this.groups=[];this.dataview.groups=this.groups;this.refreshgroups();this._raiseEvent(12,{type:"Clear",index:-1,groups:this.groups});return!0},removegroup:function(b){if(null==
b)return!1;b=this.groups.indexOf(b.toString());return this.removegroupat(b)},getrootgroupscount:function(){return this.dataview.loadedrootgroups.length},collapsegroup:function(b){if(0<=b&&-1===b.toString().indexOf("."))return this._setrootgroupstate(b,!1);var d=b.toString().split("."),e=null;this.groupsVisibility||(this.groupsVisibility=[]);for(var c=0;c<d.length;c++)if(b=parseInt(d[c]),0==c)e=this.dataview.loadedrootgroups[b],this.groupsVisibility[e.group]=null;else if(b=e.subGroups[b])e=b,c==d.length-
1&&(this._setgroupstate(e,!1,!0),this.groupsVisibility[e.group]=null)},expandgroup:function(b){if(0<=b&&-1===b.toString().indexOf("."))return this._setrootgroupstate(b,!0);for(var d=b.toString().split("."),e=null,c=0;c<d.length;c++)if(b=parseInt(d[c]),0==c)e=this.dataview.loadedrootgroups[b],this._setrootgroupstate(b,!0),this.groupsVisibility||(this.groupsVisibility=[]),this.groupsVisibility[e.group]=e;else if(b=e.subGroups[b])e=b,this._setgroupstate(e,!0,!0),this.groupsVisibility||(this.groupsVisibility=
[]),this.groupsVisibility[e.group]=e},collapseallgroups:function(b){this._setbatchgroupstate(!1,b)},expandallgroups:function(b){this._setbatchgroupstate(!0,b)},isgroupexpanded:function(b){b=this.dataview.loadedrootgroups[b];return null==b?null:this.expandedgroups[b.uniqueid].expanded},getgroup:function(b){b=this.dataview.loadedrootgroups[b];if(null==b)return null;var d=this.expandedgroups[b.uniqueid].expanded,e=b.group,f=b.level,g=[];this._getsubgroups(g,b);var h=this,d={group:e,level:f,expanded:d,
subgroups:g};if(b.subItems){var l=[];c.each(b.subItems,function(){l[l.length]=h.getrowdata(this.boundindex)});0<l.length&&(d.subrows=l)}return d},getrootgroups:function(){for(var b=this.dataview.loadedrootgroups.length,d=[],e=0;e<b;e++)d[e]=this.getgroup(e);return d},_getsubgroups:function(b,d){var e=this;for(obj in d.subGroups){var f=d.subGroups[obj];b[b.length]={group:f.group,level:f.level,expanded:e.expandedgroups[f.uniqueid].expanded};if(f.subItems){var g=[];c.each(f.subItems,function(){g[g.length]=
e.getrowdata(this.boundindex)});b[b.length-1].subrows=g}f.subGroups&&e._getsubgroups([],f)}return b},_setbatchgroupstate:function(b,d){for(obj in this.dataview.loadedrootgroups)this._setrootgroupstate(obj,b,!1,!0);if(0==d)return this._requiresupdate=!0,this._renderrows(this.virtualsizeinfo),!0;var e=this.vScrollBar[0].style.visibility;this.rendergridcontent(!0,!1);if(e!=this.vScrollBar[0].style.visibility||this._hiddencolumns)this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo);
return!0},_setrootgroupstate:function(b,d,e,c){if(void 0==b||null==b||0>b||!this.groupable||0==this.groups.length)return!1;e=void 0!=e?e:!0;if(0<=b&&b<this.dataview.loadedrootgroups.length){var g=this.dataview.loadedrootgroups[b];if(this.pageable){for(var g=[],h=0;h<this.dataview.rows.length;h++)null!=this.dataview.rows[h].group&&0===this.dataview.rows[h].level&&g.push(this.dataview.rows[h]);g=g[b];if(!g)return}return this._setgroupstate(g,d,e,c)}return!1},_togglegroupstate:function(b,d){if(null==
b||void 0==b)return!1;var e=this.vScrollInstance.value,c=this.expandedgroups[b.uniqueid],c=void 0==c?!1:c.expanded,c=!c;this.groupsVisibility||(this.groupsVisibility=[]);this.groupsVisibility[b.group]=c?b:null;c=this._setgroupstate(b,c,d);this._newmax=null;0!==e&&"hidden"!==this.vScrollBar.css("visibility")&&(e<=this.vScrollInstance.max?this.vScrollInstance.setPosition(e):this.vScrollInstance.setPosition(this.vScrollInstance.max));return c},_setgroupstate:function(b,d,e,c){if(null==b||void 0==b)return!1;
var g=!1;this.editable&&this.editcell&&this.endcelledit(this.editcell.row,this.editcell.column,!1,!1);var h=this.expandedgroups[b.uniqueid];void 0==h&&(h={expanded:!1},g=!0);h.expanded!=d&&(g=!0);if(g){this.expandedgroups[b.uniqueid]={expanded:d,group:b};this._setsubgroupsvisibility(this,b,!d,c);e&&(e=this.vScrollBar[0].style.visibility,this.rendergridcontent(!0,!1),e!=this.vScrollBar[0].style.visibility||this._hiddencolumns)&&(this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo));
if(void 0==this.suspendgroupevents||0==this.suspendgroupevents)d?this._raiseEvent(4,{group:b.group,parentgroup:b.parentItem?b.parentItem.group:null,level:b.level,visibleindex:b.visibleindex}):this._raiseEvent(5,{group:b.group,parentgroup:b.parentItem?b.parentItem.group:null,level:b.level,visibleindex:b.visibleindex});return!0}return!1},_setgroupitemsvisibility:function(b,d,e){for(var c=0;c<d.subItems.length;c++)b._setrowvisibility(d.subItems[c].visibleindex,e,!1)},_setsubgroupsvisibility:function(b,
d,e,c){if(null!=d.parentItem){if(this.hiddens[d.parentItem.visibleindex])return}else if(null==d.parentItem&&this.hiddens[d.visibleindex])return;for(subGroup in d.subGroups){var g=d.subGroups[subGroup];e||b._setrowvisibility(g.visibleindex,e,!1);var h=!e;c?this.expandedgroups[g.uniqueid]={expanded:h,group:g}:h=void 0==b.expandedgroups[g.uniqueid]?!1:b.expandedgroups[g.uniqueid].expanded;g.subGroups&&(0<g.subGroups.length?b._setsubgroupsvisibility(b,g,!h||e,c):0<g.subItems.length&&b._setgroupitemsvisibility(b,
g,!h||e));e&&b._setrowvisibility(g.visibleindex,e,!1)}d.subItems&&0<d.subItems.length&&b._setgroupitemsvisibility(b,d,e)},_handlecolumnsdragdrop:function(){var b=this,d=-1,e=!1;if(b.groupable){var f="mousemove.grouping"+this.element.id,g="mouseup.grouping"+this.element.id,h=!1;this.isTouchDevice()&&!0!==this.touchmode&&(h=!0,f=c.jqx.mobile.getTouchEventName("touchmove")+".grouping"+this.element.id,c.jqx.mobile.getTouchEventName("touchstart"),g=c.jqx.mobile.getTouchEventName("touchend")+".grouping"+
this.element.id);this.removeHandler(c(document),f);this.addHandler(c(document),f,function(f){if(!b.showgroupsheader)return!0;if(null!=b.dragcolumn){var g=parseInt(f.pageX),r=parseInt(f.pageY);h&&(r=b.getTouches(f)[0],g=parseInt(r.pageX),r=parseInt(r.pageY));var t=b.host.coord(),v=parseInt(t.left),t=parseInt(t.top);if(void 0==b.dragmousedownoffset||null==b.dragmousedownoffset)b.dragmousedownoffset={left:0,top:0};var y=parseInt(g)-parseInt(b.dragmousedownoffset.left),A=parseInt(r)-parseInt(b.dragmousedownoffset.top);
b.dragcolumn.css({left:y+"px",top:A+"px"});e=!1;g>=v&&g<=v+b.host.width()&&r>=t&&r<=t+b.host.height()&&(e=!0);d=-1;e?(b.dragcolumnicon.removeClass(b.toThemeProperty("jqx-grid-dragcancel-icon")),b.dragcolumnicon.addClass(b.toThemeProperty("jqx-grid-drag-icon")),v=b.groupsheader.coord(),t=v.top+b.groupsheader.height(),y=(y=c.data(b.dragcolumn[0],"datarecord"))?b.groups.indexOf(y.toString()):-1,y=-1==y||1<b.groups.length&&-1<y,null!=b.dropline&&(r>=v.top&&r<=t?y&&(d=b._handlegroupdroplines(g)):b.dropline.fadeOut("slow"))):
(null!=b.dropline&&b.dropline.fadeOut("slow"),b.dragcolumnicon.removeClass(b.toThemeProperty("jqx-grid-drag-icon")),b.dragcolumnicon.addClass(b.toThemeProperty("jqx-grid-dragcancel-icon")));if(h)return f.preventDefault(),f.stopPropagation(),!1}});this.removeHandler(c(document),g);this.addHandler(c(document),g,function(f){if(!b.showgroupsheader)return!0;b.__drag=!1;c(document.body).removeClass("jqx-disableselect");parseInt(f.pageX);var g=parseInt(f.pageY);h&&(f=b.getTouches(f)[0],parseInt(f.pageX),
g=parseInt(f.pageY));f=b.host.coord();parseInt(f.left);var r=parseInt(f.top),t=b.groupsheader.height();b.showtoolbar&&(r+=b.toolbarheight);b.dragstarted=!1;b.dragmousedown=null;null!=b.dragcolumn&&(f=c.data(b.dragcolumn[0],"datarecord"),b.dragcolumn.remove(),b.dragcolumn=null,null!=f&&(b.getcolumn(f).groupable&&e&&(-1!=d?(g=d.index,r=b.groups[g],t=b._getGroupIndexByDataField(f),t!=g&&(void 0!=t&&0<=t&&b.groups.splice(t,1),"before"==d.position?b.rtl?b._insertaftergroup(r,f):b._insertbeforegroup(r,
f):b.rtl?b._insertbeforegroup(r,f):b._insertaftergroup(r,f))):0==b.groups.length?g>r&&g<=r+t&&b.addgroup(f):g>r+t&&(t=b._getGroupIndexByDataField(f),b.removegroupat(t))),null!=b.dropline&&(b.dropline.remove(),b.dropline=null)))})}},_getGroupIndexByDataField:function(b){for(var d=0;d<this.groups.length;d++)if(this.groups[d]==b)return d;return-1},_isColumnInGroups:function(b){for(var d=0;d<this.groups.length;d++)if(this.groups[d]==b)return!0;return!1},_handlegroupdroplines:function(b){var d=this,e=
-1;c.each(d.groupheadersbounds,function(c){if(b<=this.left+this.width/2){var g=this.left-3;0<c&&(g=this.left-1-d.groupindentwidth/6);d.dropline.css("left",g);d.dropline.css("top",this.top);d.dropline.height(this.height);d.dropline.fadeIn("slow");e={index:c,position:"before"};d.rtl&&(e={index:d.groupheadersbounds.length-1-c,position:"before"});return!1}b>=this.left+this.width/2&&(d.dropline.css("left",1+this.left+this.width),d.dropline.css("top",this.top),d.dropline.height(this.height),d.dropline.fadeIn("slow"),
e={index:c,position:"after"},d.rtl&&(e={index:d.groupheadersbounds.length-1-c,position:"after"}))});return e},_handlegroupstocolumnsdragdrop:function(b,d){this.dragmousedownoffset=this.dragmousedown=null;this.dragstarted=!1;this.dragcolumn=null;var e=this,f,g="mousedown",h="mousemove",l=!1;this.isTouchDevice()&&!0!==this.touchmode&&(l=!0,g=c.jqx.mobile.getTouchEventName("touchstart"),h=c.jqx.mobile.getTouchEventName("touchmove"));this.addHandler(d,"dragstart",function(b){return!1});this.addHandler(d,
g,function(b){if(!e.showgroupsheader)return!0;var d=b.pageX,f=b.pageY;e.__drag=!0;e.dragmousedown={left:d,top:f};l&&(f=e.getTouches(b)[0],d=f.pageX,f=f.pageY,e.dragmousedown={left:d,top:f},b.preventDefault&&b.preventDefault());b=c(b.target).coord();e.dragmousedownoffset={left:parseInt(d)-parseInt(b.left),top:parseInt(f-b.top)}});this.addHandler(d,h,function(g){if(!e.showgroupsheader)return!0;if(e.dragmousedown){f={left:g.pageX,top:g.pageY};if(l){var h=e.getTouches(g)[0];f={left:h.pageX,top:h.pageY}}!e.dragstarted&&
null==e.dragcolumn&&(h=Math.abs(f.top-e.dragmousedown.top),3<Math.abs(f.left-e.dragmousedown.left)||3<h)&&(e._createdragcolumn(d,f,!0),c(document.body).addClass("jqx-disableselect"),c.data(e.dragcolumn[0],"datarecord",b),g.preventDefault&&g.preventDefault())}})},_createdragcolumn:function(b,d,e){this.dragcolumn=c("<div></div>");var f=b.clone();this.dragcolumn.css("z-index",999999);f.css("border-width","1px");f.css("opacity","0.4");var g=c(f.find("."+this.toThemeProperty("jqx-grid-column-menubutton")));
0<g.length&&g.css("display","none");g=c(f.find(".jqx-icon-close"));0<g.length&&g.css("display","none");this.dragcolumnicon=c('<div style="z-index: 9999; position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -7px;"></div>');this.dragcolumnicon.addClass(this.toThemeProperty("jqx-grid-drag-icon"));this.dragcolumn.css("float","left");this.dragcolumn.css("position","absolute");this.host.coord();f.width(b.width()+16);this.dragcolumn.append(f);this.dragcolumn.height(b.height());this.dragcolumn.width(f.width());
this.dragcolumn.append(this.dragcolumnicon);c(document.body).append(this.dragcolumn);f.css("margin-left",0);f.css("left",0);f.css("top",0);this.dragcolumn.css("left",d.left+this.dragmousedown.left);this.dragcolumn.css("top",d.top+this.dragmousedown.top);void 0!=e&&e&&(this.dropline=c('<div style="display: none; position: absolute;"></div>'),this.dropline.width(2),this.dropline.addClass(this.toThemeProperty("jqx-grid-group-drag-line")),c(document.body).append(this.dropline))},iscolumngroupable:function(b){return this._getcolumnproperty(b,
"groupable")},_handlecolumnstogroupsdragdrop:function(b,d){this.dragmousedownoffset=this.dragmousedown=null;this.dragstarted=!1;this.dragcolumn=null;var e=this,f,g=!1;this.isTouchDevice()&&!0!==this.touchmode&&(g=!0);var h="mousedown.drag";f="mousemove.drag";g?(h=c.jqx.mobile.getTouchEventName("touchstart")+".drag",f=c.jqx.mobile.getTouchEventName("touchmove")+".drag"):this.addHandler(d,"dragstart",function(b){return!1});this.addHandler(d,h,function(f){if(!e.showgroupsheader)return!0;e.__drag=!0;
if(e._isColumnInGroups(b.displayfield))return d.css("cursor"),!0;if(0==b.groupable)return!0;var h=f.pageX,r=f.pageY;g&&(r=e.getTouches(f)[0],h=r.pageX,r=r.pageY);e.dragmousedown={left:h,top:r};g&&f.preventDefault&&f.preventDefault();f=c(f.target).coord();e.dragmousedownoffset={left:parseInt(h)-parseInt(f.left),top:parseInt(r-f.top)}});this.addHandler(d,f,function(h){if(!e.showgroupsheader)return!0;if(e._isColumnInGroups(b.displayfield))return d.css("cursor"),!0;if(e.dragmousedown){var q=h.pageX,r=
h.pageY;g&&(r=e.getTouches(h)[0],q=r.pageX,r=r.pageY);f={left:q,top:r};!e.dragstarted&&null==e.dragcolumn&&(q=Math.abs(f.top-e.dragmousedown.top),3<Math.abs(f.left-e.dragmousedown.left)||3<q)&&(e._createdragcolumn(d,f,!0),c.data(e.dragcolumn[0],"datarecord",b.displayfield),h.preventDefault&&h.preventDefault())}})},_rendergroupcolumn:function(b,d){var e=c('<div style="float: left; position: relative;"></div>');this.rtl&&e.css("float","right");null!=this.groupcolumnrenderer&&(e[0].innerHTML=this.groupcolumnrenderer(b),
e.addClass(this.toThemeProperty("jqx-grid-group-column")),e.addClass(this.toThemeProperty("jqx-fill-state-normal")));if(this.closeablegroups){""==e[0].innerHTML&&(e[0].innerHTML='<a style="float: left;" href="#">'+b+"</a>");this.rtl&&(e[0].innerHTML='<a style="float: right;" href="#">'+b+"</a>");var f=this.rtl?"left":"right",g='<div style="float: '+f+'; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
this.toThemeProperty("jqx-icon-close")+'"></div></div>';c.jqx.browser.msie&&8>c.jqx.browser.version&&(g='<div style="float: left; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>');this.rtl&&(g='<div style="float: '+f+'; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
this.toThemeProperty("jqx-icon-close")+'"></div></div>',c.jqx.browser.msie&&8>c.jqx.browser.version&&(g='<div style="float: left; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>'));e[0].innerHTML+=g}else""==e[0].innerHTML&&(e[0].innerHTML='<a href="#">'+b+"</a>");this.sortable&&(f=c('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),g=c('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'),this.closeablegroups&&(f=c('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -32px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),g=c('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -32px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>')),this.rtl&&(f=c('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 0px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),g=c('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 0px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'),this.closeablegroups&&(f=c('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+
this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),g=c('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'))),f.css("display","none"),g.css("display","none"),c.jqx.browser.msie&&8>c.jqx.browser.version&&(f.css("float","left"),g.css("float","left")),e.append(f),
e.append(g),c.data(document.body,"groupsortelements"+d,{sortasc:f,sortdesc:g}));e.addClass(this.toThemeProperty("jqx-fill-state-normal"));e.addClass(this.toThemeProperty("jqx-grid-group-column"));return e},_rendergroup:function(b,d,e,f,g,h,l){f=d.cells[e.level];this.rtl&&(f=d.cells[d.cells.length-1-e.level]);var q=this._findgroupstate(e.uniqueid);if(0<e.bounddata.subGroups.length||0<e.bounddata.subItems.length)g=this.rtl?"-rtl":"",h=this.toThemeProperty("jqx-icon-arrow-right"),g&&(h=this.toThemeProperty("jqx-icon-arrow-left")),
f.className=q?f.className+(" "+this.toThemeProperty("jqx-grid-group-expand"+g)+" "+this.toThemeProperty("jqx-icon-arrow-down")):f.className+(" "+this.toThemeProperty("jqx-grid-group-collapse"+g)+" "+h);g=this._getColumnText(this.groups[e.level]).label;f=this.groupindentwidth;var r=this.rowdetails&&this.showrowdetailscolumn?(1+b)*f:b*f,t=l-r;h=e.level+1;this.rtl&&(h=0);b=d.cells[h];for(r=2;void 0!=b&&"none"==b.style.display&&r<d.cells.length-1;)b=d.cells[h+r-1],r++;h=c(b);if(b){b.style.width=parseInt(t)+
"px";-1!=b.className.indexOf("jqx-grid-cell-filter")&&h.removeClass(this.toThemeProperty("jqx-grid-cell-filter"));-1!=b.className.indexOf("jqx-grid-cell-sort")&&h.removeClass(this.toThemeProperty("jqx-grid-cell-sort"));-1!=b.className.indexOf("jqx-grid-cell-pinned")&&h.removeClass(this.toThemeProperty("jqx-grid-cell-pinned"));if(null!=this.groupsrenderer)if(t={group:e.group,level:e.level,parent:e.bounddata.parentItem,subGroups:e.bounddata.subGroups,subItems:e.bounddata.subItems,groupcolumn:this._getColumnText(this.groups[e.level]).column},
q=this.groupsrenderer(g+": "+e.group,e.group,q,t))b.innerHTML=q;else{q=0<e.bounddata.subItems.length?e.bounddata.subItems.length:e.bounddata.subGroups.length;if(this.showgroupaggregates)for(t=0<e.bounddata.subItems.length?e.bounddata.subItems:e.bounddata.subGroups,r=q=0;r<t.length;r++)t[r].totalsrow||q++;b.innerHTML='<div class="'+this.toThemeProperty("jqx-grid-groups-row")+'" style="position: absolute;"><span>'+g+': </span><span class="'+this.toThemeProperty("jqx-grid-groups-row-details")+'">'+e.group+
" ("+q+")</span></div>"}else{var v=this._getcolumnbydatafield(this.groups[e.level]),y=e.group;if(null!=v){v.cellsformat&&c.jqx.dataFormat&&(c.jqx.dataFormat.isDate(y)?y=c.jqx.dataFormat.formatdate(y,v.cellsformat,this.gridlocalization):c.jqx.dataFormat.isNumber(y)&&(y=c.jqx.dataFormat.formatnumber(y,v.cellsformat,this.gridlocalization)));q=0<e.bounddata.subItems.length?e.bounddata.subItems.length:e.bounddata.subGroups.length;if(this.showgroupaggregates)for(t=0<e.bounddata.subItems.length?e.bounddata.subItems:
e.bounddata.subGroups,r=q=0;r<t.length;r++)t[r].totalsrow||q++;b.innerHTML='<div class="'+this.toThemeProperty("jqx-grid-groups-row")+'" style="position: absolute;"><span>'+g+': </span><span class="'+this.toThemeProperty("jqx-grid-groups-row-details")+'">'+y+" ("+q+")</span></div>"}else throw Error("jqxGrid: Unable to find '"+this.groups[e.level]+"' group in the Grid's columns collection.");}this.rtl&&(v||(v=this._getcolumnbydatafield(this.groups[e.level])),g="hidden"==this.hScrollBar.css("visibility")?
0:this.hScrollInstance.max-this.hScrollInstance.value,q="hidden"==this.vScrollBar.css("visibility")?0:this.scrollbarsize+6,r=this.rowdetails&&this.showrowdetailscolumn?(2+e.level)*f:(1+e.level)*f,b.style.width=l+parseInt(g)-r-q+"px",h.addClass(this.toThemeProperty("jqx-rtl")),f=c(d.cells[d.cells.length-1]).css("z-index"),h.css("z-index",f),f=h.find("div"),t=f.width(),f.css("left","100%"),d=null!=this.columns.records[d.cells.length-2-e.level]?this.columns.records[d.cells.length-2-e.level].pinned:!1,
this.table.width()<l&&(l=this.table.width(),"hidden"!=this.vScrollBar.css("visibility")&&(l+=this.vScrollBar.outerWidth())),v.pinned||d?(this.rowdetails&&this.showrowdetailscolumn&&(l+=30),f.css("margin-left",-t),b.style.width=l+g-r-q+"px"):(g="hidden"==this.hScrollBar.css("visibility")?0:this.hScrollInstance.max,b.style.width=l+g-r-q+"px",t=f.width(),f.css("margin-left",-t)))}}})})(jqxBaseFramework);
(function(c){c.extend(c.jqx._jqxGrid.prototype,{autoresizecolumns:function(b,d){"cells"!=b&&"all"!=b&&"column"!=b&&(b="all");var e=this.that,f=this.getrows();this.pageable&&(f=this.dataview.rows,this.groupable&&(f=this.dataview.records));d=void 0==d?0:parseInt(d);var g=f.length;if(void 0==g&&void 0!=f){var h=[];c.each(f,function(b){h.push(this)});f=h;g=f.length}var l=c("<span></span>");l.addClass(this.toThemeProperty("jqx-widget"));l.addClass(this.toThemeProperty("jqx-grid-cell"));c(document.body).append(l);
var q=[],r=[],t=[],v=[],y=e.host.width();"hidden"!=e.vScrollBar[0].style.visibility&&(y-=this.scrollbarsize+5);0>y&&(y=0);for(var A=0;A<g;A++)for(var w=f[A],y=0;y<this.columns.records.length;y++){var z=this.columns.records[y];if(!(z.hidden||0<this.groups.length&&y<=this.groups.length-1)){void 0==r[z.displayfield]&&(r[z.displayfield]=0);void 0==t[z.displayfield]&&(t[z.displayfield]="");var C=w[z.displayfield];""!=z.cellsformat?c.jqx.dataFormat&&(c.jqx.dataFormat.isDate(C)?C=c.jqx.dataFormat.formatdate(C,
z.cellsformat,this.gridlocalization):c.jqx.dataFormat.isNumber(C)&&(C=c.jqx.dataFormat.formatnumber(C,z.cellsformat,this.gridlocalization))):z.cellsrenderer&&(q=e._defaultcellsrenderer(C,z),q=z.cellsrenderer(A,z.datafield,C,q,z.getcolumnproperties(),w),void 0!=q&&(C=c(q).text()));if((void 0==b||"cells"==b||"all"==b)&&null!=C){var q=C.toString().length,D=C.toString(),D=D.replace(/[^A-Z]/g,"").length;q>r[z.displayfield]&&(r[z.displayfield]=q,t[z.displayfield]=C,v[z.displayfield]=D);if(0<q&&q>=D){var E=
20*D+15*(q-D),F=20*v[z.displayfield]+15*(r[z.displayfield]-v[z.displayfield]);E>F&&0<E&&0<F&&(r[z.displayfield]=q,t[z.displayfield]=C,v[z.displayfield]=D)}}if("column"==b||"all"==b)z.text.toString().length>r[z.displayfield]&&(t[z.displayfield]=z.text,r[z.displayfield]=z.text.length,D=z.text.toString(),D=D.replace(/[^A-Z]/g,"").length,v[z.displayfield]=D),C=z.text,q=C.toString().length,D=C.toString(),D=D.replace(/[^A-Z]/g,"").length,0<q&&q>=D&&(E=20*D+15*(q-D),F=20*v[z.displayfield]+15*(r[z.displayfield]-
v[z.displayfield]),E>F&&0<E&&0<F&&(r[z.displayfield]=q,t[z.displayfield]=C,v[z.displayfield]=D))}}if(this.columns.records){for(y=0;y<this.columns.records.length;y++)if(z=this.columns.records[y],z.displayfield&&(void 0==t[z.displayfield]&&(t[z.displayfield]=z.text),0<=l[0].className.indexOf("jqx-grid-column-header")&&l.removeClass(this.toThemeProperty("jqx-grid-column-header")),t[z.displayfield]==z.text&&l.addClass(this.toThemeProperty("jqx-grid-column-header")),l[0].innerHTML=t[z.displayfield].toString(),
e=l.outerWidth()+10,0<l.children().length&&(e=l.children().outerWidth()+10),c.jqx.browser.msie&&8>c.jqx.browser.version&&(e+=10),this.filterable&&this.showfilterrow&&(e+=5),e+=d,e>z.maxwidth&&(e=z.maxwidth),void 0!=z._width&&(z.__width=z._width),z._width=null,"auto"==z.maxwidth||e<=z.maxwidth))f=z.width,e<z.minwidth&&(e=z.minwidth),z.width=e,void 0!=z._percentagewidth&&(z._percentagewidth=null),this._raiseEvent(14,{columntext:z.text,column:z.getcolumnproperties(),datafield:z.datafield,displayfield:z.displayfield,
oldwidth:f,newwidth:e});l.remove();this._updatecolumnwidths();this._updatecellwidths();this._renderrows(this.virtualsizeinfo);for(y=0;y<this.columns.records.length;y++)z=this.columns.records[y],void 0!=z.__width&&(z._width=z.__width)}},autoresizecolumn:function(b,d,e){"cells"!=d&&"all"!=d&&"column"!=d&&(d="all");if(void 0==b)return!1;var f=this.getrows();this.pageable&&(f=this.dataview.rows,this.groupable&&(f=this.dataview.records));var g=this.getcolumn(b);if(void 0==g)return!1;e=void 0==e?0:parseInt(e);
var h=f.length,l=c("<span></span>");l.addClass(this.toThemeProperty("jqx-widget"));l.addClass(this.toThemeProperty("jqx-grid-cell"));c(document.body).append(l);var q=0,r="",t=0;this.that.host.width();if(void 0==d||"cells"==d||"all"==d)for(var v=0;v<h;v++){var y=f[v][g.displayfield];if(""!=g.cellsformat)c.jqx.dataFormat&&(c.jqx.dataFormat.isDate(y)?y=c.jqx.dataFormat.formatdate(y,g.cellsformat,this.gridlocalization):c.jqx.dataFormat.isNumber(y)&&(y=c.jqx.dataFormat.formatnumber(y,g.cellsformat,this.gridlocalization)));
else if(g.cellsrenderer){var A=g.cellsrenderer(v,g,y);void 0!=A&&(y=c(A).text())}if(null!=y){var A=y.toString().length,w=y.toString(),w=w.replace(/[^A-Z]/g,"").length;A>q&&(q=A,r=y,t=w);if(0<A&&A>=w){var z=20*w+15*(A-w),C=20*t+15*(q-t);z>C&&0<z&&0<C&&(q=A,r=y,t=w)}}}if("column"==d||"all"==d)g.text.toString().length>q&&(r=g.text),y=g.text.toString(),A=y.toString().length,w=y.toString(),w=w.replace(/[^A-Z]/g,"").length,0<A&&A>=w&&(z=20*w+15*(A-w),C=20*t+15*(q-t),z>C&&0<z&&0<C&&(r=y));void 0==r&&(r=
g.text);l[0].innerHTML=r;r==g.text&&l.addClass(this.toThemeProperty("jqx-grid-column-header"));d=l.outerWidth()+10;c.jqx.browser.msie&&8>c.jqx.browser.version&&(d+=5);this.filterable&&this.showfilterrow&&(d+=5);d+=e;l.remove();d>g.maxwidth&&(d=g.maxwidth);if("auto"==g.maxwidth||d<=g.maxwidth)e=g.width,d<g.minwidth&&(d=g.minwidth),g.width=d,void 0!=g._width&&(g.__width=g._width),g._width=null,void 0!=g._percentagewidth&&(g._percentagewidth=null),this._updatecolumnwidths(),this._updatecellwidths(),
this._raiseEvent(14,{columntext:g.text,column:g.getcolumnproperties(),datafield:b,displayfield:g.displayfield,oldwidth:e,newwidth:d}),this._renderrows(this.virtualsizeinfo),void 0!=g._width&&(g._width=g.__width)},_handlecolumnsresize:function(){var b=this.that;if(this.columnsresize){var d=!1;b.isTouchDevice()&&!0!==b.touchmode&&(d=!0);var e="mousemove.resize"+this.element.id,f="mousedown.resize"+this.element.id,g="mouseup.resize"+this.element.id;d&&(e=c.jqx.mobile.getTouchEventName("touchmove")+".resize"+
this.element.id,f=c.jqx.mobile.getTouchEventName("touchstart")+".resize"+this.element.id,g=c.jqx.mobile.getTouchEventName("touchend")+".resize"+this.element.id);this.removeHandler(c(document),e);this.addHandler(c(document),e,function(e){if(null!=c.data(document.body,"contextmenu"+b.element.id)&&b.autoshowcolumnsmenubutton)return!0;if(null!=b.resizablecolumn&&!b.disabled&&b.resizing&&null!=b.resizeline){var f=b.host.coord(),g=parseInt(b.resizestartline.coord().left),h=g-b._startcolumnwidth,v=b.resizablecolumn.column.minwidth,
v="auto"==v?0:parseInt(v),y=b.resizablecolumn.column.maxwidth,y="auto"==y?0:parseInt(y),A=e.pageX;d&&(A=b.getTouches(e)[0].pageX);h+=v;v=0<y?g+y:0;g=0==y?!0:b._startcolumnwidth+A-g<y?!0:!1;b.rtl&&(g=!0);if(g)if(!b.rtl){if(A>=f.left&&A>=h&&(0!=v&&e.pageX<v?b.resizeline.css("left",A):0==v&&b.resizeline.css("left",A),d))return!1}else if(A>=f.left&&A<=f.left+b.host.width()&&(b.resizeline.css("left",A),d))return!1}if(!d&&null!=b.resizablecolumn)return!1});this.removeHandler(c(document),f);this.addHandler(c(document),
f,function(d){if(null!=c.data(document.body,"contextmenu"+b.element.id)&&b.autoshowcolumnsmenubutton)return!0;if(null!=b.resizablecolumn&&!b.disabled){var e=b.resizablecolumn.columnelement;if(e.coord().top+e.height()+5<d.pageY)b.resizablecolumn=null;else if(e.coord().top-5>d.pageY)b.resizablecolumn=null;else{b._startcolumnwidth=b.resizablecolumn.column.width;b.resizablecolumn.column._width=null;c(document.body).addClass("jqx-disableselect");c(document.body).addClass("jqx-position-reset");b.host.addClass("jqx-disableselect");
b.content.addClass("jqx-disableselect");b._mouseDownResize=new Date;b.resizing=!0;if(b._lastmouseDownResize&&b.columnsautoresize&&300>b._lastmouseDownResize-b._mouseDownResize&&-500<b._lastmouseDownResize-b._mouseDownResize&&(e=b.resizablecolumn.column,e.resizable)){var f=b.hScrollBar[0].style.visibility;b._resizecolumn=null;b.resizeline.hide();b.resizestartline.hide();b.resizebackground.remove();b.resizablecolumn=null;b.columndragstarted=!1;b.dragmousedown=null;b.__drag=!1;b.autoresizecolumn(e.displayfield,
"all");f!=b.hScrollBar[0].style.visibility&&b.hScrollInstance.setPosition(0);b.rtl&&b._arrange();b.autosavestate&&b.savestate&&b.savestate();d.stopPropagation();b.suspendClick=!0;setTimeout(function(){b.suspendClick=!1},100);return!1}b._lastmouseDownResize=new Date;b._resizecolumn=b.resizablecolumn.column;b.resizeline=b.resizeline||c('<div style="position: absolute;"></div>');b.resizestartline=b.resizestartline||c('<div style="position: absolute;"></div>');b.resizebackground=b.resizebackground||c('<div style="position: absolute; left: 0; top: 0; background: #000;"></div>');
b.resizebackground.css("opacity",.01);b.resizebackground.css("cursor","col-resize");b.resizeline.css("cursor","col-resize");b.resizestartline.css("cursor","col-resize");b.resizeline.addClass(b.toThemeProperty("jqx-grid-column-resizeline"));b.resizestartline.addClass(b.toThemeProperty("jqx-grid-column-resizestartline"));c(document.body).append(b.resizeline);c(document.body).append(b.resizestartline);c(document.body).append(b.resizebackground);var g=b.resizablecolumn.columnelement.coord();b.resizebackground.css("left",
b.host.coord().left);b.resizebackground.css("top",b.host.coord().top);b.resizebackground.width(b.host.width());b.resizebackground.height(b.host.height());b.resizebackground.css("z-index",9999);d=function(d){b.rtl?d.css("left",parseInt(g.left)):d.css("left",parseInt(g.left)+b._startcolumnwidth);var e=b._groupsheader()?b.groupsheader.height():0,e=e+(b.showtoolbar?b.toolbarheight:0)+(b.showstatusbar?b.statusbarheight:0),c=0;b.pageable&&(c=b.pagerheight);var f="visible"==b.hScrollBar.css("visibility")?
17:0;d.css("top",parseInt(g.top));d.css("z-index",99999);b.columngroups?d.height(b.host.height()+b.resizablecolumn.columnelement.height()-c-e-f-b.columngroupslevel*b.columnsheight):d.height(b.host.height()-c-e-f);b.enableanimations?d.show("fast"):d.show()};d(b.resizeline);d(b.resizestartline);b.dragmousedown=null}}});var h=function(){c(document.body).removeClass("jqx-disableselect");c(document.body).removeClass("jqx-position-reset");if(b.showfilterrow||b.showstatusbar||b.showtoolbar||b.enablebrowserselection)b.host.removeClass("jqx-disableselect"),
b.content.removeClass("jqx-disableselect");if(b.resizing)if(b._mouseUpResize=new Date,200>b._mouseUpResize-b._mouseDownResize)b.resizing=!1,null!=b._resizecolumn&&null!=b.resizeline&&"block"==b.resizeline.css("display")&&(b._resizecolumn=null,b.resizeline.hide(),b.resizestartline.hide(),b.resizebackground.remove());else if(b.resizing=!1,!b.disabled){var d=b.host.width();"hidden"!=b.vScrollBar[0].style.visibility&&(d-=20);0>d&&(d=0);if(null!=b._resizecolumn&&null!=b.resizeline&&"block"==b.resizeline.css("display")){var e=
parseInt(b.resizeline.css("left")),f=parseInt(b.resizestartline.css("left")),g=b._startcolumnwidth+e-f;b.rtl&&(g=b._startcolumnwidth-e+f);e=b._resizecolumn.width;b._closemenu();g<b._resizecolumn.minwidth&&(g=b._resizecolumn.minwidth);b._resizecolumn.width=g;void 0!=b._resizecolumn._percentagewidth&&(b._resizecolumn._percentagewidth=g/d*100);for(d=0;d<b._columns.length;d++)if(b._columns[d].datafield===b._resizecolumn.datafield){b._columns[d].width=b._resizecolumn.width;b._columns[d].width<b._resizecolumn.minwidth&&
(b._columns[d].width=b._resizecolumn.minwidth);break}d=b.hScrollBar[0].style.visibility;b._updatecolumnwidths();b._updatecellwidths();b._raiseEvent(14,{columntext:b._resizecolumn.text,column:b._resizecolumn.getcolumnproperties(),datafield:b._resizecolumn.datafield,oldwidth:e,newwidth:g});b._renderrows(b.virtualsizeinfo);b.autosavestate&&b.savestate&&b.savestate();d!=b.hScrollBar[0].style.visibility&&b.hScrollInstance.setPosition(0);b.rtl&&b._arrange();b._resizecolumn=null;b.resizeline.hide();b.resizestartline.hide();
b.resizebackground.remove()}b.resizablecolumn=null}};try{if(""!=document.referrer||window.frameElement)e=null,null!=window.top&&window.top!=window.self&&window.parent&&document.referrer&&(e=document.referrer),e&&-1!=e.indexOf(document.location.host)&&(e=function(b){h()},window.top.document.addEventListener?window.top.document.addEventListener("mouseup",e,!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",e))}catch(l){}this.removeHandler(c(document),g);this.addHandler(c(document),
g,function(d){if(null!=c.data(document.body,"contextmenu"+b.element.id)&&b.autoshowcolumnsmenubutton)return!0;h()})}}})})(jqxBaseFramework);
(function(c){c.jqx.dataview.sort=function(){this.sortby=function(b,d,e){var f=Object.prototype.toString;if(null==d&&(this.sortdata=null,"many"!==this.grid.sortmode?this.sortcache={}:this.sortcache[b]&&delete this.sortcache[b],this.grid._pagescache=[],this.grid._cellscache=[],"many"!==this.grid.sortmode)){this.refresh();return}"many"===this.grid.sortmode&&(this.grid._pagescache=[],this.grid._cellscache=[]);null!=d&&(d="a"==d||"asc"==d||"ascending"==d||1==d?!0:!1);var g=b;this.sortfield=b;this.sortfielddirection=
d?"asc":"desc";null==d&&(this.sortfielddirection=null);void 0==this.sortcache&&(this.sortcache={});this.sortdata=[];var h=[],l=!1;"constructor"==g&&(g="");if(!this.virtualmode&&null!=this.sortcache[g]&&"many"!==this.grid.sortmode){var q=this.sortcache[g],h=q._sortdata;q.direction==d?h.reverse():(!q.direction&&d&&h.reverse(),l=!0);h.length<this.totalrecords&&(this.sortcache={},l=!1,h=[])}Object.prototype.toString="function"==typeof b?b:function(){return this[b]};var r=this.records,t="";this.source.datafields&&
c.each(this.source.datafields,function(){if(this.name==b)return this.type&&(t=this.type),!1});if(0==h.length)if(r.length)for(var q=r.length,v=0;v<q;v++){var y=r[v];null!=y&&h.push({sortkey:y.toString(),value:y,index:v})}else{q=!1;for(obj in r){y=r[obj];if(void 0==y){q=!0;break}h.push({sortkey:y.toString(),value:y,index:obj})}q&&c.each(r,function(b,d){h.push({sortkey:d.toString(),value:d,index:b})})}if(!l)if(null==e){this._sortcolumntype=t;var A=this;h.sort(function(b,d){return A._compare(b,d,t)})}else h.sort(e);
d||h.reverse();Object.prototype.toString=f;this.sortdata=h;null!==d&&(this.sortcache[g]={_sortdata:h,direction:d,dataType:this._sortcolumntype,dataField:g});if("many"===this.grid.sortmode){d=[];e=[];var f=[],w;for(w in this.sortcache)"data"!==w&&(q=this.sortcache[w],d.push(q.dataField),e.push(q.direction?"asc":"desc"),f.push(q.dataType));if(0<d.length)r=this.multiSort(r,d,e,f),h=[],c.each(r,function(b,d){h.push({sortkey:g,value:d,index:d.boundindex})}),this.sortdata=h;else{this.sortcache={};this.sortdata=
null;this.refresh();return}}this.reload(this.records,this.rows,this.filters,this.updated,!0)};this.multiSort=function(b,d,e,f,g){if(0!==b.length){for(var h=[],l=0;l<b.length;l++){var q=c.extend({},b[l]);h.push(q)}l=!1;h&&h.constructor&&"ObservableArray"===h.constructor.name&&(l=!0);if((!(h&&h instanceof Array&&0!==h.length&&d)||d instanceof Array&&0===d.length)&&!l)throw Error("sort: Missing or Invalid arguments!");"string"===typeof d&&(d=[d]);var r=[],t=[];void 0===e&&(e=[]);b=function(b,d){var e;
switch(d||typeof b){default:e=(new Intl.Collator).compare;break;case "date":case "time":case "datetime":case "number":case "int":case "float":e=function(b,d){return b-d};break;case "boolean":e=function(b,d){return b===d?0:!1===b?-1:1};break;case "object":b instanceof Date&&(e=function(b,d){return b.getTime()-d.getTime()})}return e};for(l=0;l<d.length;l++)r[l]=void 0===e[l]||"asc"===e[l]||"ascending"===e[l]?1:-1,t[l]=b(h[0][d[l]],f[l]);if(g)g(h,d,e,t);else return h.sort(function(b,e){for(var c=0;c<
d.length;c++){var f=t[c](b[d[c]],e[d[c]]);if(0===f){if(d[c+1])continue;else if(void 0!==b._index)return(b._index-e._index)*r[c];return 0}return f*r[c]}if(0===d.length)return b.boundIndex<e.boundIndex?-1:b.boundIndex>e.boundIndex?1:0}),h}};this.clearsortdata=function(){this.sortcache={};this.sortdata=null};this._compare=function(b,d,e){b=b.sortkey;d=d.sortkey;void 0===b&&(b=null);void 0===d&&(d=null);if(null===b&&null===d)return 0;if(null===b&&null!==d)return-1;if(null!==b&&null===d)return 1;if(c.jqx.dataFormat)if(e&&
""!=e)switch(e){case "string":case "text":b=String(b).toLowerCase(),d=String(d).toLowerCase()}else{if(c.jqx.dataFormat.isNumber(b)&&c.jqx.dataFormat.isNumber(d)||c.jqx.dataFormat.isDate(b)&&c.jqx.dataFormat.isDate(d))return b<d?-1:b>d?1:0;c.jqx.dataFormat.isNumber(b)||c.jqx.dataFormat.isNumber(d)||(b=String(b).toLowerCase(),d=String(d).toLowerCase())}return b<d?-1:b>d?1:0};this._equals=function(b,d){return 0===this._compare(b,d)}};c.extend(c.jqx._jqxGrid.prototype,{_rendersortcolumn:function(){var b=
this.that,d=this.getsortcolumn();if("many"===this.sortmode){var e=this.getsortcolumns();c.each(this.columns.records,function(b,d){c(this.sortasc).hide();c(this.sortdesc).hide();c(this.sorticon).css("visibility","hidden");this.element.removeAttribute("sort")});if(0<e.length)for(var f=0;f<e.length;f++){var g=e[f],h=this._getcolumnbydatafield(g.dataField);h.element.setAttribute("sort",!0);b.isMaterialized()||b.isModern()?(c(h.sorticon).show(),c(h.sorticon).css("visibility","inherit"),c(h.sorticon).removeClass("ascending"),
c(h.sorticon).removeClass("descending"),g.ascending?c(h.sorticon).addClass("ascending"):c(h.sorticon).addClass("descending")):g.ascending?(c(h.sortasc).show(),c(h.sortdesc).hide()):!1===g.ascending&&(c(h.sortasc).hide(),c(h.sortdesc).show())}}else this.sortdirection&&(e=function(d,e){var f=b.getcolumn(d);f&&(e.ascending?c.jqx.aria(f.element,"aria-sort","ascending"):e.descending?c.jqx.aria(f.element,"aria-sort","descending"):c.jqx.aria(f.element,"aria-sort","none"))},this._oldsortinfo&&this._oldsortinfo.column&&
e(this._oldsortinfo.column,{ascending:!1,descending:!1}),e(d,this.sortdirection)),this._oldsortinfo={column:d,direction:this.sortdirection},this.sortdirection&&c.each(this.columns.records,function(e,f){var g=c.data(document.body,"groupsortelements"+this.displayfield);null==d||this.displayfield!=d?(c(this.sortasc).hide(),c(this.sortdesc).hide(),c(this.sorticon).css("visibility","hidden"),c(this.sorticon).removeClass("ascending"),c(this.sorticon).removeClass("descending"),this.element.removeAttribute("sort"),
null!=g&&(g.sortasc.hide(),g.sortdesc.hide())):(b.isMaterialized()||b.isModern()?(c(this.sortasc).hide(),c(this.sortdesc).hide(),c(this.sorticon).show(),c(this.sorticon).css("visibility","inherit"),null!=g&&(g.sortasc.hide(),g.sortdesc.show()),c(this.sorticon).removeClass("ascending"),c(this.sorticon).removeClass("descending"),b.sortdirection.ascending?c(this.sorticon).addClass("ascending"):c(this.sorticon).addClass("descending")):b.sortdirection.ascending?(c(this.sortasc).show(),c(this.sortdesc).hide(),
null!=g&&(g.sortasc.show(),g.sortdesc.hide())):(c(this.sortasc).hide(),c(this.sortdesc).show(),null!=g&&(g.sortasc.hide(),g.sortdesc.show())),this.element.setAttribute("sort",!0))})},getsortcolumns:function(){var b=[],d;for(d in this.dataview.sortcache)"data"!==d&&b.push({dataField:d,ascending:this.dataview.sortcache[d].direction});if(0===b.length)for(var e in this.sortcolumns)d=this.sortcolumns[e],null!==d&&b.push({dataField:e,ascending:d});return b},getsortcolumn:function(){return void 0!=this.sortcolumn?
this.sortcolumn:null},removesort:function(){this.sortby(null)},sortby:function(b,d,e,c,g){if(this._loading&&!1!==g)return!1;null==b&&(d=null,b=this.sortcolumn);if(void 0!=b){g=this.that;void 0==e&&null!=g.source.sortcomparer&&(e=g.source.sortcomparer);void 0===d&&(d=!0);ascending="a"==d||"asc"==d||"ascending"==d||1==d?!0:!1;g.sortdirection=null!=d?{ascending:ascending,descending:!ascending}:{ascending:!1,descending:!1};g.sortcolumn=null!=d?b:null;g.sortcolumns||(g.sortcolumns=[]);g.sortcolumns[b]=
d;if(g.source.sort||g.virtualmode){if(g.dataview.sortfield=b,g.dataview.sortfielddirection=null==d?"":ascending?"asc":"desc",g.source.sort&&!this._loading){g.source.sort(b,d,g.sortcolumns);g._raiseEvent(6,{sortinformation:g.getsortinformation()});return}}else g.dataview.sortby(b,d,e);!1!==c&&(g.groupable&&0<g.groups.length?(g._render(!0,!1,!1),g._updategroupheadersbounds&&g.showgroupsheader&&g._updategroupheadersbounds()):(g.pageable&&g.dataview.updateview(),g._updaterowsproperties(),g.rendergridcontent(!0)),
g._postrender("sort"),g._raiseEvent(6,{sortinformation:g.getsortinformation()}))}},_togglesort:function(b){var d=this.that;if(!this.disabled)if("many"===this.sortmode){if(b.sortable&&d.sortable){for(var e=d.getsortcolumns(),c=0;c<e.length;c++){var g=e[c];if(b.displayfield===g.dataField){e=g.ascending;e=1<d.sorttogglestates?1==e?!1:null:!e;d.sortby(b.displayfield,e,null);return}}d.sortby(b.displayfield,!0,null)}}else b.sortable&&d.sortable&&(e=d.getsortinformation(),null!=e.sortcolumn&&e.sortcolumn==
b.displayfield?(e=e.sortdirection.ascending,e=1<d.sorttogglestates?1==e?!1:null:!e):e=!0,d.sortby(b.displayfield,e,null))}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxToolBar","",{});c.extend(c.jqx._jqxToolBar.prototype,{defineInstance:function(){var b={width:"100%",minWidth:null,maxWidth:null,height:35,tools:"",initTools:null,minimizeWidth:200,disabled:!1,rtl:!1,events:["open","close"]};if(this===c.jqx._jqxToolBar.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(){if("none"===this.host.css("display")||!1===document.body.contains(this.element))this._initiallyHidden=!0;this._toolToWidgetMapping={button:"jqxButton",
toggleButton:"jqxToggleButton",dropdownlist:"jqxDropDownList",combobox:"jqxComboBox",input:"jqxInput"};this._toolChanges=[];this.render()},render:function(){var b=!0;this.element.innerHTML="";0<this.element.className.length&&this._removeClass(this.element,this.toThemeProperty("jqx-widget jqx-fill-state-normal jqx-rc-all jqx-toolbar jqx-fill-state-disabled"));this._setSize();this._destroyTools(!1);this._toolWidgets&&(b=!1,c(this._minimizeButton).remove(),c(this._minimizePopup).remove());this._appendMinimizeButton();
this._addClasses();this._initiallyHidden||this._createTools();!0===this.disabled&&(this.element.className+=" "+this.toThemeProperty("jqx-fill-state-disabled"),this._disableTools(!0));this._initiallyHidden||this._minimize();this._removeHandlers();this._addHandlers();!1===b&&0<this._toolChanges.length&&this._restoreChanges()},refresh:function(b){!0!==b&&this.render()},getTools:function(){return this._toolWidgets},destroy:function(){this._removeHandlers();this._destroyTools();this.host.remove()},_destroyTools:function(b){!1!==
b&&(b=!0);if(this._toolWidgets)for(var d=this._toolWidgets.length-1;0<=d;d--)this._destroyTool(d,b,!0)},_destroyTool:function(b,d,e){b=parseInt(b,10);var f=this._toolWidgets[b];if(f){var g=f.type,h=f.tool,l=f.menuTool;if("custom"!==g){if(h[this._toolToWidgetMapping[g]]("destroy"),l)l[this._toolToWidgetMapping[g]]("destroy")}else h.remove(),l&&l.remove();f.menuSeparator&&c(f.menuSeparator).remove();this._toolWidgets.splice(b,1);this._checkType(g)&&this._refreshButtonGroups();!0!==e&&this._minimize();
!1!==d&&this._toolChanges.push({action:"destroyTool",index:b})}},destroyTool:function(b){this._destroyTool(b,!0)},addTool:function(b,d,e,c){var g,h,l,q;g="first"===d?0:this._toolWidgets.length;this._toolWidgets[g-1]&&(h=this._toolWidgets[g-1].tool,l=this._toolWidgets[g-1].separatorAfterWidget?"|":this._toolWidgets[g-1].type);!0===e?q="|":this._toolWidgets[g+1]&&(q=this._toolWidgets[g+1].type);g=this._initializeTool(g,b,h,l,q,c,!1);"first"===d?this._toolWidgets.splice(0,0,g):this._toolWidgets.push(g);
this._removeHandlers();this._addHandlers();this._checkType(b)&&this._refreshButtonGroups();"first"!==d&&0<this._minimizedTools?this._minimizeTool(!0):this._minimize();this._toolChanges.push({action:"addTool",type:b,position:d,separator:e,initCallback:c})},_disableTools:function(b){for(var d=0;d<this._toolWidgets.length;d++)this.disableTool(d,b)},disableTool:function(b,d){b=parseInt(b,10);var e=this._toolWidgets[b];if(e){var c=e.type;"custom"!==c&&(e.tool[this._toolToWidgetMapping[c]]({disabled:d}),
e.menuTool[this._toolToWidgetMapping[c]]({disabled:d}));this._toolChanges.push({action:"disableTool",index:b,disable:d})}},propertyChangedHandler:function(b,d,e,f){if("initTools"!==d&&f!==e)switch(d){case "theme":""!==e&&(b._removeClass(b.element,b.toThemeProperty("jqx-widget-"+e+" jqx-fill-state-normal-"+e+" jqx-rc-all-"+e+" jqx-toolbar-"+e)),b._removeClass(b._minimizePopup,"jqx-popup-"+e+" jqx-fill-state-normal-"+e+" jqx-rc-b-"+e+" jqx-toolbar-minimized-popup-"+e));b._addClasses();b._minimizePopup.className+=
" "+b.toThemeProperty("jqx-popup jqx-fill-state-normal jqx-rc-b jqx-toolbar-minimized-popup");for(var g=0;g<b._toolWidgets.length;g++)d=b._toolWidgets[g],"custom"!==d.type&&(d.menuTool&&(d.menuSeparator&&(""!==e&&b._removeClass(d.menuSeparator,"jqx-fill-state-pressed-"+e+" jqx-toolbar-minimized-popup-separator-"+e),d.menuSeparator.className+=" jqx-fill-state-pressed-"+f+" jqx-toolbar-minimized-popup-separator-"+f),d.menuTool[b._toolToWidgetMapping[b._toolWidgets[g].type]]({theme:f})),d.tool[b._toolToWidgetMapping[b._toolWidgets[g].type]]({theme:f}));
c.jqx.utilities.setTheme(e,f,b.host);break;case "width":b.element.style.width=b._toPx(f);b._minimize();break;case "minWidth":b.element.style.minWidth=b._toPx(f);b._minimize();break;case "maxWidth":b.element.style.maxWidth=b._toPx(f);b._minimize();break;case "height":d=!1;b.element.style.height=b._toPx(f);if("string"===typeof f&&-1!==f.indexOf("%")){if("string"===typeof e&&-1!==e.indexOf("%")){b.host.trigger("resize");break}d=!0}else g=parseInt(f,10),g-=b._getComputedStyle(b.element,"paddingTop")+
b._getComputedStyle(b.element,"paddingBottom")+b._getComputedStyle(b.element,"borderTopWidth")+b._getComputedStyle(b.element,"borderBottomWidth");for(f=0;f<b._toolWidgets.length;f++){e=b._toolWidgets[f];var h=e.type;if("button"===h||"toggleButton"===h||"repeatButton"===h||"linkButton"===h)e.tool[0].style.height=d?"100%":b._toPx(g),e.menuTool&&(e.menuTool[0].style.height=d?"100%":b._toPx(g));else if("dropdownlist"===h||"combobox"===h||"input"===h)if(e.tool[b._toolToWidgetMapping[h]]({height:d?"100%":
g-2}),e.menuTool)e.menuTool[b._toolToWidgetMapping[h]]({height:d?"100%":g-2})}break;case "tools":b._removeHandlers();b._destroyTools();b._createTools();b._addHandlers();b._minimize();break;case "minimizeWidth":!0===b._isOpen?(g=b._getComputedStyle(b._minimizePopup,"left")-(f-e),b._minimizePopup.style.width=b._toPx(f),b._minimizePopup.style.left=b._toPx(g)):b._minimizePopup.style.width=b._toPx(f);break;case "rtl":b.render();break;case "disabled":!0===f?(b.element.className+=" "+b.toThemeProperty("jqx-fill-state-disabled"),
b._disableTools(!0)):(b._removeClass(b.element,b.toThemeProperty("jqx-fill-state-disabled")),b._disableTools(!1))}},_raiseEvent:function(b,d){void 0===d&&(d={owner:null});var e=this.events[b];d.owner=this;e=new c.Event(e);e.owner=this;e.args=d;e.preventDefault&&e.preventDefault();return this.host.trigger(e)},_addClasses:function(){var b="jqx-widget jqx-fill-state-normal jqx-rc-all jqx-toolbar";!0===this.rtl&&(b+=" jqx-toolbar-rtl");this.element.className+=" "+this.toThemeProperty(b)},_checkType:function(b){return"button"===
b||"toggleButton"===b||"repeatButton"===b||"linkButton"===b?!0:!1},_refreshButtonGroups:function(){function b(b,e,f,g,h,l){var q=b.tool[0];b=b.menuTool[0];var r={add:"",remove:""};r[e]+=" jqx-toolbar-tool-inner-button";r[f]+=" jqx-rc-all";r[g]+=" jqx-rc-l";r[h]+=" jqx-rc-r";""!==r.add&&(q.className+=" "+d.toThemeProperty(c.trim(r.add)),b&&(b.className+=" "+d.toThemeProperty(c.trim(r.add))));""!==r.remove&&(d._removeClass(q,d.toThemeProperty(c.trim(r.remove))),b&&d._removeClass(b,d.toThemeProperty(c.trim(r.remove))));
q.style.borderLeftWidth=l+"px";b&&(b.style.borderLeftWidth=l+"px")}for(var d=this,e=0;e<d._toolWidgets.length;e++){var f=d._toolWidgets[e];if(d._checkType(f.type)){var g,h,l=f.tool,q=f.menuTool;0<e&&(g=d._toolWidgets[e-1].separatorAfterWidget?"|":d._toolWidgets[e-1]);f.separatorAfterWidget?h="|":e<d._toolWidgets.length-1&&(h=d._toolWidgets[e+1]);var r=g&&d._checkType(g.type),t=!1===f.separatorAfterWidget&&h&&d._checkType(h.type);r||t?!r&&t?b(f,"remove","remove","add","remove",1):r&&t?b(f,"add","remove",
"remove","remove",0):r&&!t&&b(f,"remove","remove","remove","add",0):b(f,"remove","add","remove","remove",1);r=d.rtl?"rtl":"ltr";t?(d._removeClass(l[0],d.toThemeProperty("jqx-toolbar-tool-separator-"+r)),d._removeClass(l[0],d.toThemeProperty("jqx-toolbar-tool-no-separator-"+r)),q&&(d._removeClass(q[0],d.toThemeProperty("jqx-toolbar-tool-separator-"+r)),d._removeClass(q[0],d.toThemeProperty("jqx-toolbar-tool-no-separator-"+r)))):f.separatorAfterWidget?(d._removeClass(l[0],d.toThemeProperty("jqx-toolbar-tool-no-separator-"+
r)),l[0].className+=" "+d.toThemeProperty("jqx-toolbar-tool-separator-"+r),q&&(d._removeClass(q[0],d.toThemeProperty("jqx-toolbar-tool-no-separator-"+r)),q[0].className+=" "+d.toThemeProperty("jqx-toolbar-tool-separator-"+r))):(d._removeClass(l[0],d.toThemeProperty("jqx-toolbar-tool-separator-"+r)),l[0].className+=" "+d.toThemeProperty("jqx-toolbar-tool-no-separator-"+r),q&&(d._removeClass(q[0],d.toThemeProperty("jqx-toolbar-tool-separator-"+r)),q[0].className+=" "+d.toThemeProperty("jqx-toolbar-tool-no-separator-"+
r)))}}},_addHandlers:function(){var b=this,d=b.element.id;c.jqx.utilities.resize(b.host,function(){b._initiallyHidden?(b._createTools(),b._minimize(),b._initiallyHidden=!1):(!0===b._isOpen&&(b._minimizePopup.style.display="none",b._isOpen=!1,b._raiseEvent("1")),b._minimize())});b.addHandler(document,"click.jqxToolbar"+d,function(){!0===b._isOpen&&b._openMinimizePopup()});b.addHandler(b._minimizeButton,"click.jqxToolbar"+d,function(d){d.stopPropagation();b._openMinimizePopup()});b.addHandler(c(".jqx-popup"),
"click.jqxToolbar"+d,function(b){-1===b.target.className.indexOf("jqx-window-content")&&b.stopPropagation()})},_removeHandlers:function(){var b=this.element.id;this.removeHandler(document,"click.jqxToolbar"+b);this.removeHandler(this._minimizeButton,"click.jqxToolbar"+b);this.removeHandler(c(".jqx-popup"),"click.jqxToolbar"+b)},_setSize:function(){var b=this.element.style;b.width=this._toPx(this.width);b.height=this._toPx(this.height);this.minWidth&&(b.minWidth=this._toPx(this.minWidth));this.maxWidth&&
(b.maxWidth=this._toPx(this.maxWidth))},_createTools:function(){var b=this.tools.split(" "),d=c.trim(this.tools.replace(/\|/g,"")),d=d.replace(/\s+/g," "),d=d.split(" ");this._toolWidgets=[];for(var e=0,f=0;f<d.length;f++){d[f]!==b[f+e]&&e++;var g=f+e,h;this._toolWidgets[f-1]&&(h=this._toolWidgets[f-1].tool);var l=b[g];if(""===l)return!0;g=this._initializeTool(f,l,h,b[g-1],b[g+1],this.initTools,!0);this._toolWidgets.push(g)}this._minimizePopup.style.display="none";this._minimizePopup.style.visibility=
"visible"},_initializeTool:function(b,d,e,c,g,h,l){var q,r;r=this._initializeWidget(d,q,r,e);q=r.tool;r=r.menuTool;e=q[0];var t="jqx-toolbar-tool",v=r[0],y,A=!0;!0===this.rtl&&(t+=" jqx-toolbar-tool-rtl");if(this.initTools){var w;w=!0===l?this.initTools(d,b,q,!1):h(d,q,!1);if(!w||!1!==w.minimizable&&!1!==w.menuTool)!0===l?this.initTools(d,b,r,!0):h(d,r,!0),r&&(y="jqx-toolbar-tool-minimized");else{if("custom"!==d)r[this._toolToWidgetMapping[d]]("destroy");else r.remove();!1===w.minimizable&&(A=!1);
r=!1}}b=!1;r&&(v.style.display="none");var z;h=this.rtl?"rtl":"ltr";l=["button","toggleButton","repeatButton","linkButton"];w={button:"jqxButton",toggleButton:"jqxToggleButton",repeatButton:"jqxRepeatButton",linkButton:"jqxRepeatButton"};if("|"===g)b=!0,t+=" jqx-toolbar-tool-separator-"+h,r&&(y+=" jqx-toolbar-tool-separator-"+h),r&&(z=document.createElement("div"),z.className=this.toThemeProperty("jqx-fill-state-pressed jqx-toolbar-minimized-popup-separator"),this._minimizePopup.appendChild(z));else if(-1===
l.indexOf(d)||-1!==l.indexOf(d)&&-1===l.indexOf(g))t+=" jqx-toolbar-tool-no-separator-"+h,r&&(y+=" jqx-toolbar-tool-no-separator-"+h);if(-1===l.indexOf(c)&&-1!==l.indexOf(d)&&-1!==l.indexOf(g))if(!1===this.rtl){if(q[w[d]]({roundedCorners:"left"}),r)r[w[d]]({roundedCorners:"left"})}else q[w[d]]({roundedCorners:"left"}),e.style.borderLeftWidth="0px",r&&(r[w[d]]({roundedCorners:"left"}),v.style.borderLeftWidth="0px");else if(-1!==l.indexOf(c)&&-1!==l.indexOf(d)&&-1!==l.indexOf(g))t+=" jqx-toolbar-tool-inner-button",
e.style.borderLeftWidth="0px",r&&(y+=" jqx-toolbar-tool-inner-button",v.style.borderLeftWidth="0px");else if(-1!==l.indexOf(c)&&-1!==l.indexOf(d)&&-1===l.indexOf(g))if(!1===this.rtl)q[w[d]]({roundedCorners:"right"}),e.style.borderLeftWidth="0px",r&&(r[w[d]]({roundedCorners:"right"}),v.style.borderLeftWidth="0px");else if(q[w[d]]({roundedCorners:"left"}),r)r[w[d]]({roundedCorners:"left"});e.className+=" "+this.toThemeProperty(t);r&&(v.className+=" "+this.toThemeProperty(y));return{type:d,tool:q,separatorAfterWidget:b,
minimizable:A,minimized:!1,menuTool:r,menuSeparator:z}},_initializeWidget:function(b,d,e,f){var g,h=this._toolToWidgetMapping[b],l,q=!1;"string"===typeof this.height&&-1!==this.height.indexOf("%")?q=!0:(l=window.getComputedStyle?window.getComputedStyle(this.element):this.element.currentStyle,l=this.element.offsetHeight-(parseInt(l.paddingTop,10)+parseInt(l.paddingBottom,10)+parseInt(l.borderTopWidth,10)+parseInt(l.borderBottomWidth,10)));if("custom"!==b&&void 0===this.host[h])throw b=this._toolToWidgetMapping[b].toLowerCase(),
Error("jqxToolBar: Missing reference to "+b+".js");switch(b){case "button":case "toggleButton":d=document.createElement("button");e=document.createElement("button");g={theme:this.theme,height:q?"100%":l,disabled:this.disabled,rtl:this.rtl};break;case "dropdownlist":case "combobox":d=document.createElement("div");e=document.createElement("div");g={theme:this.theme,autoDropDownHeight:!0,height:q?"100%":l-2,disabled:this.disabled,rtl:this.rtl};break;case "input":d=document.createElement("input");d.setAttribute("type",
"text");e=document.createElement("input");e.setAttribute("type","text");g={theme:this.theme,height:q?"100%":l-2,disabled:this.disabled,rtl:this.rtl};break;case "custom":d=document.createElement("div"),e=document.createElement("div")}q=this.host.children();l=c(this._minimizePopup).children();f||1===q.length&&0===l.length?(this.element.appendChild(d),this._minimizePopup.appendChild(e)):(this.element.insertBefore(d,q[1]),this._minimizePopup.insertBefore(e,l[0]));d=c(d);e=c(e);"custom"!==b&&(d[h](g),
e[h](g));return{tool:d,menuTool:e}},_appendMinimizeButton:function(){this._minimizedTools=0;var b=document.createElement("div"),d="jqx-menu-minimized-button jqx-toolbar-minimized-button",e=document.createElement("div"),c="jqx-popup jqx-fill-state-normal jqx-rc-b jqx-toolbar-minimized-popup";e.setAttribute("id",this.element.id+"Popup");!0===this.rtl&&(d+=" jqx-toolbar-minimized-button-rtl",c+=" jqx-toolbar-minimized-popup-rtl");b.className=this.toThemeProperty(d);e.className=this.toThemeProperty(c);
this.element.appendChild(b);document.body.appendChild(e);this._isOpen=!1;e.style.width=this._toPx(this.minimizeWidth);this._minimizeButton=b;this._minimizePopup=e},_openMinimizePopup:function(){var b=this;if(!1===b._isOpen){var d=b.host.offset(),e=d.left;!1===b.rtl&&(e+=b.element.offsetWidth-parseInt(b.minimizeWidth,10)-(b._getComputedStyle(b._minimizePopup,"paddingLeft")+b._getComputedStyle(b._minimizePopup,"paddingRight")+b._getComputedStyle(b._minimizePopup,"borderLeftWidth")+b._getComputedStyle(b._minimizePopup,
"borderRightWidth")));d=d.top+b.element.offsetHeight-1;b._minimizePopup.style.left=e+"px";b._minimizePopup.style.top=d+"px";c(b._minimizePopup).slideDown("fast",function(){b._isOpen=!0;b._raiseEvent("0")})}else c(b._minimizePopup).slideUp("fast"),b._isOpen=!1,b._raiseEvent("1")},_minimize:function(){var b=0;0<this._minimizedTools&&(b=this._minimizeButton.offsetWidth+this._getComputedStyle(this._minimizeButton,"marginLeft"));b=this.element.offsetWidth-this._getComputedStyle(this.element,"paddingLeft")-
this._getComputedStyle(this.element,"paddingRight")-b-10;if(!(0>b)){for(var d=0,e,f=0;f<this._toolWidgets.length;f++){var g=this._toolWidgets[f].tool;!1===this._toolWidgets[f].minimized?(g=g[0].offsetWidth+this._getComputedStyle(g[0],"marginLeft")+this._getComputedStyle(g[0],"marginRight"),d+=g):void 0===e&&(e=g[0].cloneNode(!0),e.style.visibility="hidden",e.style.display="block",e.style.position="absolute",document.body.appendChild(e),g=e.offsetWidth+this._getComputedStyle(e,"marginLeft")+this._getComputedStyle(e,
"marginRight"),c(e).remove(),e=g)}d>b?(this._minimizeTool(!0),this._minimize()):void 0!==e&&d+e<b&&(this._minimizeTool(!1),this._minimize())}},_minimizeTool:function(b){var d;if(!0===b)for(var e=this._toolWidgets.length-1;0<=e;e--){if(b=this._toolWidgets[e],!1!==b.minimizable&&!1===b.minimized){d=this._getToolValue(b.tool,b.type);b.tool[0].style.display="none";b.menuTool&&(b.menuTool[0].style.display="block",this._setToolValue(d,b.menuTool,b.type));b.menuSeparator&&(b.menuSeparator.style.display=
"block");this._toolWidgets[e].minimized=!0;this._minimizedTools++;1===this._minimizedTools&&(this._minimizeButton.style.display="block");break}}else for(e=0;e<this._toolWidgets.length;e++)if(b=this._toolWidgets[e],!0===b.minimized){b.menuTool&&(d=this._getToolValue(b.menuTool,b.type),b.menuTool[0].style.display="none");b.menuSeparator&&(b.menuSeparator.style.display="none");b.tool.show();b.menuTool&&this._setToolValue(d,b.tool,b.type);this._toolWidgets[e].minimized=!1;this._minimizedTools--;0===this._minimizedTools&&
(this._minimizeButton.style.display="none");break}},_getToolValue:function(b,d){var e;switch(d){case "button":case "custom":e=void 0;break;case "toggleButton":e=-1!==b[0].className.indexOf("jqx-fill-state-pressed");e={text:b[0].innerHTML,toggled:e};break;case "dropdownlist":case "combobox":e=this._toolToWidgetMapping[d];e=b[e]("checkboxes")?b[e]("val"):b[e]("getSelectedIndex");break;case "input":e=b.val()}return e},_setToolValue:function(b,d,e){if(void 0!==b)switch(e){case "toggleButton":d[0].innerHTML=
b.text;-1!==d[0].className.indexOf("jqx-fill-state-pressed")!==b.toggled&&d.jqxToggleButton("toggle");break;case "dropdownlist":case "combobox":e=this._toolToWidgetMapping[e];if(d[e]("checkboxes")){if(d[e]("uncheckAll"),""!==b){b=b.split(",");for(var c=0;c<b.length;c++)d[e]("checkItem",b[c])}}else d[e]("selectIndex",b);break;case "input":d.val(b)}},_restoreChanges:function(){var b=this;c.each(b._toolChanges,function(d,e){"addTool"===e.action?b.addTool(e.type,e.position,e.separator,e.initCallback):
"destroyTool"===e.action?b._destroyTool(e.index):"disableTool"===e.action&&b.disableTool(e.index,e.disable)})},_removeClass:function(b,d){c(b).removeClass(d)},_toPx:function(b){return"number"===typeof b?b+"px":b},_getComputedStyle:function(b,d){var e;window.getComputedStyle?e=window.getComputedStyle(b):b.currentStyle&&(e=b.currentStyle);return"string"===typeof e[d]&&-1===e[d].indexOf("px")?0:parseInt(e[d],10)}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxTooltip","",{});c.extend(c.jqx._jqxTooltip.prototype,{defineInstance:function(){var b={width:"auto",height:"auto",position:"default",enableBrowserBoundsDetection:!0,content:"",left:0,top:0,absolutePositionX:0,absolutePositionY:0,trigger:"hover",showDelay:100,autoHide:!0,autoHideDelay:3E3,closeOnClick:!0,disabled:!1,animationShowDelay:200,animationHideDelay:"fast",showArrow:!0,name:"",opacity:.9,rtl:!1,_isOpen:!1,selector:null,opening:null,value:null,_eventsMap:{mousedown:c.jqx.mobile.getTouchEventName("touchstart"),
mouseup:c.jqx.mobile.getTouchEventName("touchend")},events:["open","close","opening","closing"]};if(this===c.jqx._jqxTooltip.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(){this._isTouchDevice=c.jqx.mobile.isTouchDevice();var b=c.data(document.body,"_tooltipIDArray"+this.name);b?this.IDArray=b:(this.IDArray=[],c.data(document.body,"_tooltipIDArray"+this.name,this.IDArray));b="jqxtooltip"+this._generatekey();this.IDArray.push({tooltipID:b,tooltipHost:this.host});var d=document.createElement("div");
d.setAttribute("id",b);d.innerHTML='<div id="'+b+'Main"><div id="'+b+'Text"></div></div><div id="'+b+'Arrow"></div>';c.jqx.browser.msie&&(d.className=this.toThemeProperty("jqx-noshadow"));document.body.appendChild(d);this._tooltip=d;this._tooltipHelper=c(d);this._tooltipHelper.initAnimate&&this._tooltipHelper.initAnimate();d.style.visibility="hidden";d.style.display="none";d.style.opacity=0;d.style.zIndex=99999;this._arrow=d=document.getElementById(b+"Arrow");!1===this.showArrow&&(d.style.visibility=
"hidden",d.style.display="none");this._main=document.getElementById(b+"Main");this._text=document.getElementById(b+"Text");this._setTheme();this._setSize();this._setContent();!1===this.disabled&&(this._trigger(),!0===this.closeOnClick&&this._clickHide())},open:function(){arguments&&arguments.length&&2===arguments.length&&(this.position="absolute",this.left=arguments[0],this.top=arguments[1],this.absolutePositionX=arguments[0],this.absolutePositionY=arguments[1]);if(!1===this.disabled&&"removed"!==
this._id())if("mouse"===this.position||"mouseenter"===this.position){var b=this.position;this.position="default";this._raiseEvent("2");this._setPosition();this._animateShow();this.position=b}else this._raiseEvent("2"),this._setPosition(),this._animateShow()},close:function(b){var d=this,e=c.jqx.browser.msie&&9>c.jqx.browser.version;"object"===typeof b&&c.isEmptyObject(b)&&(b=this.animationHideDelay);var f=parseFloat(d._tooltip.style.opacity),g=function(){clearTimeout(d.autoHideTimeout);d._raiseEvent("3");
d._tooltipHelper.animate({opacity:0},b,function(){d._tooltip.style.visibility="hidden";d._tooltip.style.display="none";d._raiseEvent("1");d._isOpen=!1})};!1===this._isOpen&&0!==f?g():!0===this._isOpen&&(!e&&f===this.opacity||e)&&g()},destroy:function(){var b=this.IDArray.length;this._removeHandlers();this._tooltipHelper.remove();for(var d=0;d<b;d++)if(this.IDArray[d].tooltipHost===this.host){this.IDArray.splice(d,1);break}this.host.removeData("jqxTooltip")},refresh:function(b){if(!0!==b){var d=this;
this.rtl&&(d._text.className+=" "+d.toThemeProperty("jqx-rtl"),d._text.style.direction="rtl");b=parseFloat(d._tooltip.style.opacity);"removed"!==this._id()&&(!0===this.disabled&&!0===this._isOpen&&b===this.opacity&&(clearTimeout(this.autoHideTimeout),this._tooltipHelper.animate({opacity:0},this.animationHideDelay,function(){d._tooltip.style.visibility="hidden";d._tooltip.style.display="none";d._isOpen=!1})),this._setTheme(),this._setContent(),this._setSize(),"mouse"!==this.position&&"mouseenter"!==
this.position&&this._setPosition(),this._removeHandlers(),!1===this.disabled&&(this._trigger(),!0===this.closeOnClick&&this._clickHide()))}},propertyChangedHandler:function(b,d,e,c){"content"===d&&(this.changeContentFlag=!0);b.refresh()},_raiseEvent:function(b,d){var e=new c.Event(this.events[b]);e.owner=this;e.args=d;var f;try{f=this.host.trigger(e)}catch(g){}return f},_generatekey:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)+(65536*(1+Math.random())|0).toString(16).substring(1)},
_id:function(){for(var b,d=this.IDArray.length,e=0;e<d;e++)if(this.IDArray[e].tooltipHost===this.host){b=this.IDArray[e].tooltipID;b="#"+b;break}void 0===b&&(b="removed");return b},_setPosition:function(b){var d=this,e=d._tooltip;if(!1===this._isOpen&&0===parseFloat(e.style.opacity)||!0===this.changeContentFlag)if(b||"mouse"!==this.position&&"mouseenter"!==this.position){e.style.display="block";this.changeContentFlag=!1;this.documentTop=document.documentElement.scrollTop;this.documentLeft=document.documentElement.scrollLeft;
this.windowWidth=window.innerWidth;this.windowHeight=window.innerHeight;this.hostWidth=d.element.offsetWidth;this.hostHeight=d.element.offsetHeight;this.tooltipWidth=e.offsetWidth;this.tooltipHeight=e.offsetHeight;this.hostOffset=this.host.offset();this.tooltipOffset=d._tooltipHelper.offset();this.defaultOffset=30;this.offsetHorizontal=parseInt(this.left,10);this.offsetVertical=parseInt(this.top,10);var e=d._arrow,f=c(e),g=d._main,h=c(g),l=g.offsetWidth,q=g.offsetHeight;this.arrowSize=5;this.tooltipMainOffset=
h.offset();this.tooltipArrowOffset={};switch(this.position){case "top":this.tooltipOffset.left=this.hostOffset.left+this.hostWidth/2-this.tooltipWidth/2+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top-this.tooltipHeight-this.arrowSize+this.offsetVertical;this._detectBrowserBounds();this.tooltipMainOffset=h.offset();d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-t-b");e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+
"px 0px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+(l/2-this.arrowSize);this.tooltipArrowOffset.top=this.tooltipMainOffset.top+q;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "bottom":this.tooltipOffset.left=this.hostOffset.left+this.hostWidth/2-this.tooltipWidth/2+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top+this.hostHeight+this.arrowSize+this.offsetVertical;this._detectBrowserBounds();this.tooltipMainOffset=h.offset();
d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-t-b");e.style.borderWidth="0 "+this.arrowSize+"px "+this.arrowSize+"px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+(l/2-this.arrowSize);this.tooltipArrowOffset.top=this.tooltipMainOffset.top-this.arrowSize;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "left":g=window.getComputedStyle?window.getComputedStyle(g):g.currentStyle;this.tooltipOffset.left=
this.hostOffset.left-this.tooltipWidth-this.arrowSize+this.offsetHorizontal-(parseInt(g.borderLeftWidth,10)+parseInt(g.borderRightWidth,10));this.tooltipOffset.top=this.hostOffset.top+this.hostHeight/2-this.tooltipHeight/2+this.offsetVertical;this._detectBrowserBounds();d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-t-b"));e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-l-r");e.style.borderWidth=this.arrowSize+"px 0px "+this.arrowSize+"px "+this.arrowSize+"px";this.tooltipMainOffset=
h.offset();this.tooltipArrowOffset.left=this.tooltipMainOffset.left+l;this.tooltipArrowOffset.top=this.tooltipMainOffset.top+q/2-this.arrowSize;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "right":this.tooltipOffset.left=this.hostOffset.left+this.hostWidth+this.arrowSize+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top+this.hostHeight/2-this.tooltipHeight/2+this.offsetVertical;this.tooltipOffset.top=parseInt(this.tooltipOffset.top,10);this._detectBrowserBounds();
this.tooltipMainOffset=h.offset();d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-t-b"));e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-l-r");e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+"px "+this.arrowSize+"px 0px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left-this.arrowSize;this.tooltipArrowOffset.top=this.tooltipMainOffset.top+g.offsetHeight/2-this.arrowSize;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "top-left":this.tooltipOffset.left=
this.hostOffset.left+this.defaultOffset-this.tooltipWidth+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top-this.tooltipHeight-this.arrowSize+this.offsetVertical;this._detectBrowserBounds();this.tooltipMainOffset=h.offset();d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-t-b");e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+"px  0px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+l-6*this.arrowSize;
this.tooltipArrowOffset.top=this.tooltipMainOffset.top+q;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "bottom-left":this.tooltipOffset.left=this.hostOffset.left+this.defaultOffset-this.tooltipWidth+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top+this.hostHeight+this.arrowSize+this.offsetVertical;this._detectBrowserBounds();this.tooltipMainOffset=h.offset();d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-t-b");
e.style.borderWidth="0 "+this.arrowSize+"px "+this.arrowSize+"px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+l-6*this.arrowSize;this.tooltipArrowOffset.top=this.tooltipMainOffset.top-this.arrowSize;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "top-right":this.tooltipOffset.left=this.hostOffset.left+this.hostWidth-this.defaultOffset+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top-this.tooltipHeight-this.arrowSize+this.offsetVertical;
this._detectBrowserBounds();this.tooltipMainOffset=h.offset();d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-t-b");e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+"px  0px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+4*this.arrowSize;this.tooltipArrowOffset.top=this.tooltipMainOffset.top+q;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "bottom-right":this.tooltipOffset.left=
this.hostOffset.left+this.hostWidth-this.defaultOffset+this.offsetHorizontal;this.tooltipOffset.top=this.hostOffset.top+this.hostHeight+this.arrowSize+this.offsetVertical;this._detectBrowserBounds();this.tooltipMainOffset=h.offset();d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-l-r"));e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-t-b");e.style.borderWidth="0 "+this.arrowSize+"px "+this.arrowSize+"px";this.tooltipArrowOffset.left=this.tooltipMainOffset.left+4*this.arrowSize;this.tooltipArrowOffset.top=
this.tooltipMainOffset.top-this.arrowSize;f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left});break;case "absolute":d._tooltipHelper.offset({top:this.absolutePositionY,left:this.absolutePositionX});e.style.borderWidth="0px";break;case "mouse":if(!1===this._isTouchDevice)switch(this.trigger){case "hover":this.mouseHoverTimeout&&clearTimeout(this.mouseHoverTimeout);this.mouseHoverTimeout=setTimeout(function(){d.tooltipOffset.left=b.pageX+10;d.tooltipOffset.top=b.pageY+10;d._detectBrowserBounds()},
this.showDelay);break;case "click":this.tooltipOffset.left=b.pageX+10,this.tooltipOffset.top=b.pageY+10,this._detectBrowserBounds()}else{f=b.pageX;h=b.pageY;if(b.originalEvent){var r;b.originalEvent.touches&&b.originalEvent.touches.length?r=b.originalEvent.touches[0]:b.originalEvent.changedTouches&&b.originalEvent.changedTouches.length&&(r=b.originalEvent.changedTouches[0]);void 0!==r&&(f=r.pageX,h=r.pageY)}this.tooltipOffset.left=f+10;this.tooltipOffset.top=h+10;this._detectBrowserBounds()}e.style.borderWidth=
"0px";break;case "mouseenter":r=b.pageY;var t=b.pageX;r<this.hostOffset.top+10&&r>this.hostOffset.top-10?(this.tooltipOffset.left=t-this.tooltipWidth/2,this.tooltipOffset.top=this.hostOffset.top-this.tooltipHeight-this.arrowSize,this._detectBrowserBounds(),this.tooltipMainOffset=h.offset(),d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-l-r")),e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-t-b"),e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+"px  0px",this.tooltipArrowOffset.left=
this.tooltipMainOffset.left+(l/2-this.arrowSize),this.tooltipArrowOffset.top=this.tooltipMainOffset.top+q,f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left})):r<this.hostOffset.top+this.hostHeight+10&&r>this.hostOffset.top+this.hostHeight-10?(this.tooltipOffset.left=t-this.tooltipWidth/2,this.tooltipOffset.top=this.hostOffset.top+this.hostHeight+this.arrowSize,this._detectBrowserBounds(),this.tooltipMainOffset=h.offset(),d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-l-r")),
e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-t-b"),e.style.borderWidth="0 "+this.arrowSize+"px "+this.arrowSize+"px",this.tooltipArrowOffset.left=this.tooltipMainOffset.left+(l/2-this.arrowSize),this.tooltipArrowOffset.top=this.tooltipMainOffset.top-this.arrowSize,f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left})):t<this.hostOffset.left+10&&t>this.hostOffset.left-10?(g=window.getComputedStyle?window.getComputedStyle(g):g.currentStyle,this.tooltipOffset.left=this.hostOffset.left-
this.tooltipWidth-this.arrowSize-(parseInt(g.borderLeftWidth,10)+parseInt(g.borderRightWidth,10)),this.tooltipOffset.top=r-this.tooltipHeight/2,this._detectBrowserBounds(),this.tooltipMainOffset=h.offset(),d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-t-b")),e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-l-r"),e.style.borderWidth=this.arrowSize+"px 0px "+this.arrowSize+"px "+this.arrowSize+"px",this.tooltipMainOffset=h.offset(),this.tooltipArrowOffset.left=this.tooltipMainOffset.left+
l,this.tooltipArrowOffset.top=this.tooltipMainOffset.top+q/2-this.arrowSize,f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left})):t<this.hostOffset.left+this.hostWidth+10&&t>this.hostOffset.left+this.hostWidth-10&&(this.tooltipOffset.left=this.hostOffset.left+this.hostWidth+this.arrowSize,this.tooltipOffset.top=r-this.tooltipHeight/2,this._detectBrowserBounds(),this.tooltipMainOffset=h.offset(),d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-t-b")),e.className+=" "+
d.toThemeProperty("jqx-tooltip-arrow-l-r"),e.style.borderWidth=this.arrowSize+"px "+this.arrowSize+"px "+this.arrowSize+"px 0px",this.tooltipMainOffset=h.offset(),this.tooltipArrowOffset.left=this.tooltipMainOffset.left-this.arrowSize,this.tooltipArrowOffset.top=this.tooltipMainOffset.top+q/2-this.arrowSize,f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left}));break;case "default":this.tooltipOffset.left=this.hostOffset.left+this.hostWidth-this.defaultOffset,this.tooltipOffset.top=
this.hostOffset.top+this.hostHeight+this.arrowSize,this._detectBrowserBounds(),this.tooltipMainOffset=h.offset(),d._removeClass(e,d.toThemeProperty("jqx-tooltip-arrow-l-r")),e.className+=" "+d.toThemeProperty("jqx-tooltip-arrow-t-b"),e.style.borderWidth="0 "+this.arrowSize+"px "+this.arrowSize+"px",this.tooltipArrowOffset.left=this.tooltipMainOffset.left+4*this.arrowSize,this.tooltipArrowOffset.top=this.tooltipMainOffset.top-this.arrowSize,f.offset({top:this.tooltipArrowOffset.top,left:this.tooltipArrowOffset.left})}}},
_setContent:function(){this._text.innerHTML=this.content},opened:function(){return this._isOpen&&"block"==this.host.css("display")&&"visible"==this.host.css("visibility")},_animateShow:function(){this._closeAll();clearTimeout(this.autoHideTimeout);var b=parseFloat(this._tooltip.style.opacity);if(!1===this._isOpen&&0===b){var d=this;d._tooltip.style.visibility="visible";d._tooltip.style.display="block";d._tooltip.style.opacity=0;this.opening&&!1===this.opening(this)||d._tooltipHelper.animate({opacity:this.opacity},
this.animationShowDelay,function(){d._raiseEvent("0");d._isOpen=!0;d.openedTooltip=d;c.data(document.body,"_openedTooltip"+d.name,d);d.autoHideTimeout&&clearTimeout(d.autoHideTimeout);0<d.autoHideDelay&&!0===d.autoHide&&(d.autoHideTimeout=setTimeout(function(){d._autoHide()},d.autoHideDelay))})}},_trigger:function(){if("removed"!==this._id()){var b=this,d=this.host;this.selector&&(d=c("#"+this.selector));if(!1===this._isTouchDevice)switch(this.trigger){case "hover":"mouse"===this.position?(this.addHandler(d,
"mousemove.tooltip",function(d){1===b._enterFlag&&(b._raiseEvent("2"),b._setPosition(d),clearTimeout(b.hoverShowTimeout),b.hoverShowTimeout=setTimeout(function(){b._animateShow();b._enterFlag=0},b.showDelay))}),this.addHandler(d,"mouseenter.tooltip",function(){0!==b._leaveFlag&&(b._enterFlag=1)}),this.addHandler(d,"mouseleave.tooltip",function(d){b._leaveFlag=1;clearTimeout(b.hoverShowTimeout);var c=b._tooltipHelper.offset(),g=b._tooltip.offsetWidth,h=b._tooltip.offsetHeight;(parseInt(d.pageX,10)<
parseInt(c.left,10)||parseInt(d.pageX,10)>parseInt(c.left,10)+g)&&b.close();(parseInt(d.pageY,10)<parseInt(c.top,10)||parseInt(d.pageY,10)>parseInt(c.top,10)+h)&&b.close()}),this.addHandler(b._tooltipHelper,"mouseleave.tooltip",function(d){b._checkBoundariesAuto(d);0!==b._clickFlag&&0!==b._autoFlag?b._leaveFlag=0:(b._leaveFlag=1,b.close())})):(this.addHandler(d,"mouseenter.tooltip",function(d){clearTimeout(b.hoverShowTimeout);b.hoverShowTimeout=setTimeout(function(){b._raiseEvent("2");b._setPosition(d);
b._animateShow()},b.showDelay)}),this.addHandler(d,"mouseleave.tooltip",function(d){b._leaveFlag=1;clearTimeout(b.hoverShowTimeout);if(b.autoHide){var c=d.pageX;d=d.pageY;var g=b._tooltipHelper.offset(),h=g.left,g=g.top,l=b._tooltip.offsetWidth,q=b._tooltip.offsetHeight;(parseInt(c,10)<parseInt(h,10)||parseInt(c,10)>parseInt(h,10)+l||parseInt(d,10)<parseInt(g,10)||parseInt(d,10)>parseInt(g,10)+q)&&b.close()}}),this.addHandler(b._tooltipHelper,"mouseleave.tooltip",function(d){b._checkBoundariesAuto(d);
0!==b._clickFlag&&0!==b._autoFlag?b._leaveFlag=0:(b._leaveFlag=1,b.autoHide&&b.close())}));break;case "click":this.addHandler(d,"click.tooltip",function(d){"mouseenter"===b.position&&(b.position="mouse");b._raiseEvent("2");b._setPosition(d);b._animateShow()})}else"none"!==this.trigger&&this.addHandler(d,"touchstart.tooltip",function(d){"mouseenter"===b.position&&(b.position="mouse");b._raiseEvent("2");b._setPosition(d);b._animateShow()})}},_autoHide:function(){var b=this,d=parseFloat(b._tooltip.style.opacity);
!0===this.autoHide&&!0===this._isOpen&&d>=this.opacity&&(b._raiseEvent("3"),b._tooltipHelper.animate({opacity:0},b.animationHideDelay,function(){b._tooltip.style.visibility="hidden";b._tooltip.style.display="none";b._raiseEvent("1");b._isOpen=!1}))},_clickHide:function(){var b=this;this.addHandler(b._tooltipHelper,"click.tooltip",function(d){b._checkBoundariesClick(d);b.close()})},_setSize:function(){this._tooltip.style.width=this._toPx(this.width);this._tooltip.style.height=this._toPx(this.height)},
resize:function(){this._setSize()},_setTheme:function(){-1===this._tooltip.className.indexOf("jqx-tooltip")&&(this._tooltip.className+=" "+this.toThemeProperty("jqx-tooltip jqx-popup"),this._main.className+=" "+this.toThemeProperty("jqx-widget jqx-fill-state-normal jqx-tooltip-main"),this._text.className+=" "+this.toThemeProperty("jqx-widget jqx-fill-state-normal jqx-tooltip-text"),this._arrow&&(this._arrow.className+=" "+this.toThemeProperty("jqx-widget jqx-fill-state-normal jqx-tooltip-arrow")))},
_initialPosition:function(){var b=this.position;this.position="default";this._setPosition();this.position=b},_detectBrowserBounds:function(){var b=this._tooltipHelper;this.enableBrowserBoundsDetection?this.tooltipOffset.top<this.documentTop&&0>this.tooltipOffset.left?b.offset({top:this.documentTop,left:this.documentLeft}):this.tooltipOffset.top<this.documentTop&&this.tooltipOffset.left+this.tooltipWidth>this.windowWidth+this.documentLeft?b.offset({top:this.documentTop,left:this.windowWidth+this.documentLeft-
this.tooltipWidth}):this.tooltipOffset.top<this.documentTop?b.offset({top:this.documentTop,left:this.tooltipOffset.left}):this.tooltipOffset.top+this.tooltipHeight>this.windowHeight+this.documentTop&&0>this.tooltipOffset.left?b.offset({top:this.windowHeight+this.documentTop-this.tooltipHeight,left:this.documentLeft}):this.tooltipOffset.top+this.tooltipHeight>this.windowHeight+this.documentTop&&this.tooltipOffset.left+this.tooltipWidth>this.windowWidth+this.documentLeft?b.offset({top:this.windowHeight+
this.documentTop-this.tooltipHeight,left:this.windowWidth+this.documentLeft-this.tooltipWidth}):this.tooltipOffset.top+this.tooltipHeight>this.windowHeight+this.documentTop?b.offset({top:this.windowHeight+this.documentTop-this.tooltipHeight,left:this.tooltipOffset.left}):0>this.tooltipOffset.left?b.offset({top:this.tooltipOffset.top,left:this.documentLeft}):this.tooltipOffset.left+this.tooltipWidth>this.windowWidth+this.documentLeft?b.offset({top:this.tooltipOffset.top,left:this.windowWidth+this.documentLeft-
this.tooltipWidth}):b.offset({top:this.tooltipOffset.top,left:this.tooltipOffset.left}):b.offset({top:this.tooltipOffset.top,left:this.tooltipOffset.left})},_checkBoundaries:function(b){return b.pageX>=this.hostOffset.left&&b.pageX<=this.hostOffset.left+this.hostWidth&&b.pageY>=this.hostOffset.top&&b.pageY<=this.hostOffset.top+this.hostHeight?!0:!1},_checkBoundariesClick:function(b){this._checkBoundaries(b)?this._clickFlag=1:this._clickFlag=0},_checkBoundariesAuto:function(b){this._checkBoundaries(b)?
this._autoFlag=1:this._autoFlag=0},_removeHandlers:function(){this.removeHandler(this.host,"mouseenter.tooltip");this.removeHandler(this.host,"mousemove.tooltip");this.removeHandler(this.host,"mouseleave.tooltip");this.removeHandler(this.host,"click.tooltip");this.removeHandler(this.host,"touchstart.tooltip");this.removeHandler(this._tooltipHelper,"click.tooltip");this.removeHandler(this._tooltipHelper,"mouseleave.tooltip")},_closeAll:function(){for(var b=0;b<this.IDArray.length;b++){var d=document.getElementById(this.IDArray[b].tooltipID);
d!==this._tooltip&&(d.style.opacity=0,d.style.visibility="hidden",d.style.display="none",this._isOpen=!1)}},_toPx:function(b){return"number"===typeof b?b+"px":b},_removeClass:function(b,d){c(b).removeClass(d)}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxCheckBox","",{});c.extend(c.jqx._jqxCheckBox.prototype,{defineInstance:function(){var b={animationShowDelay:300,animationHideDelay:300,width:null,height:null,boxSize:"16px",checked:!1,hasThreeStates:!1,disabled:!1,enableContainerClick:!0,locked:!1,groupName:"",keyboardCheck:!0,enableHover:!0,hasInput:!0,rtl:!1,updated:null,disabledContainer:!1,changeType:null,_canFocus:!0,aria:{"aria-checked":{name:"checked",type:"boolean"},"aria-disabled":{name:"disabled",type:"boolean"}},
events:["checked","unchecked","indeterminate","change"]};if(this===c.jqx._jqxCheckBox.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(b){this._createFromInput("CheckBox");this.render()},_createFromInput:function(b){if("input"==this.element.nodeName.toLowerCase()){this.field=this.element;this.field.className&&(this._className=this.field.className);var d={title:this.field.title};this.field.value&&(d.value=this.field.value);this.field.checked&&(d.checked=!0);d.id=this.field.id.length?
this.field.id.replace(/[^\w]/g,"_")+"_"+b:c.jqx.utilities.createId()+"_"+b;var e=this.element.nextSibling,f=!1;!e||"#text"!=e.nodeName&&"span"!=e.nodeName||(f=!0);var g=0;b=c("<div></div>",d);f&&(b.append(e),e=c("<span>"+c(e).text()+"</span>"),e.appendTo(c(document.body)),g+=e.width(),e.remove());b[0].style.cssText=this.field.style.cssText;this.width||(this.width=c(this.field).width()+g+10);this.height||(this.height=c(this.field).outerHeight()+10);c(this.field).hide().after(b);g=this.host.data();
this.host=b;this.host.data(g);this.element=b[0];this.element.id=this.field.id;this.field.id=d.id;this._className&&(this.host.addClass(this._className),c(this.field).removeClass(this._className));this.field.tabIndex&&(d=this.field.tabIndex,this.field.tabIndex=-1,this.element.tabIndex=d)}},_addInput:function(){if(this.hasInput){this.input&&this.input.remove();var b=this.host.attr("name");this.input=c("<input type='hidden'/>");this.host.append(this.input);b&&this.input.attr("name",b);this.input.val(this.checked);
this.host.attr("role","checkbox");c.jqx.aria(this)}},render:function(){this.init=!0;var b=this;this.setSize();this.propertyChangeMap.width=function(d,e,c,f){b.setSize()};this.propertyChangeMap.height=function(d,e,c,f){b.setSize()};this._removeHandlers();this.width||this.host.css("overflow-x","visible");this.height||this.host.css("overflow-y","visible");this.checkbox&&(this.checkbox.remove(),this.checkbox=null);this.checkMark&&(this.checkMark.remove(),this.checkMark=null);this.box&&(this.box.remove(),
this.box=null);this.clear&&(this.clear.remove(),this.clear=null);null==this.boxSize&&(this.boxSize=16);var d=parseInt(this.boxSize)+"px",e=Math.floor((parseInt(this.boxSize)-16)/2),f=e,e=e+"px",f=f+"px";16!=parseInt(this.boxSize)?this.checkbox=c('<div><div style="width: '+d+"; height: "+d+';"><span style="position: relative; left: '+e+"; top: "+f+'; width: 16px; height: 16px;"></span></div></div>'):this.checkbox=c('<div><div style="width: '+d+"; height: "+d+';"><span style="width: '+d+"; height: "+
d+';"></span></div></div>');this.host.prepend(this.checkbox);this.disabledContainer||(this.host.attr("tabIndex")||this.host.attr("tabIndex",0),this.clear=c('<div style="clear: both;"></div>'),this.host.append(this.clear));this.checkMark=c(this.checkbox[0].firstChild.firstChild);this.box=this.checkbox;this.box.addClass(this.toThemeProperty("jqx-checkbox-default")+" "+this.toThemeProperty("jqx-fill-state-normal")+" "+this.toThemeProperty("jqx-rc-all"));this.disabled&&this.disable();this.disabledContainer||
(this.host.addClass(this.toThemeProperty("jqx-widget")),this.host.addClass(this.toThemeProperty("jqx-checkbox")));this.locked&&!this.disabledContainer&&this.host.css("cursor","auto");d=this.element.getAttribute("checked");if("checked"==d||"true"==d||1==d)this.checked=!0;this._addInput();this._render();this._addHandlers();this.init=!1;this._centerBox();this.isMaterialized()&&(c(this.checkbox).addClass("ripple"),c.jqx.ripple(c(this.checkbox),this.host,"checkbox"))},_centerBox:function(){if(this.height&&
-1==this.height.toString().indexOf("%")&&this.box){var b=parseInt(this.height);this.host.css("line-height",b+"px");b=b-parseInt(this.boxSize)-1;this.box.css("margin-top",parseInt(b/2))}},refresh:function(b){b||(this.setSize(),this._render())},resize:function(b,d){this.width=b;this.height=d;this.refresh()},setSize:function(){null!=this.width&&-1!=this.width.toString().indexOf("px")?this.host.width(this.width):void 0==this.width||isNaN(this.width)?null!=this.width&&-1!=this.width.toString().indexOf("%")&&
(this.element.style.width=this.width):this.host.width(this.width);null!=this.height&&-1!=this.height.toString().indexOf("px")?this.host.height(this.height):void 0==this.height||isNaN(this.height)?null!=this.height&&-1!=this.height.toString().indexOf("%")&&(this.element.style.height=this.height):this.host.height(this.height);this._centerBox()},_addHandlers:function(){var b=this,d="mousedown";c.jqx.mobile.isTouchDevice()&&(d=c.jqx.mobile.getTouchEventName("touchend"));this.addHandler(this.box,d,function(d){if(!b.disabled&&
!b.enableContainerClick&&!b.locked)return b.changeType="mouse",b.toggle(),b.updated&&(d.owner=b,b.updated(d,b.checked,b.oldChecked)),d.preventDefault&&d.preventDefault(),!1});this.disabledContainer||(this.addHandler(this.host,"keydown",function(d){if(!b.disabled&&!b.locked&&b.keyboardCheck&&32==d.keyCode){if(!b._canFocus)return!0;b.changeType="keyboard";b.toggle();b.updated&&(d.owner=b,b.updated(d,b.checked,b.oldChecked));d.preventDefault&&d.preventDefault();return!1}}),this.addHandler(this.host,
d,function(d){if(!b.disabled&&b.enableContainerClick&&!b.locked)return b.clickTime=new Date,b.changeType="mouse",b.toggle(),d.preventDefault&&d.preventDefault(),b._canFocus&&b.focus(),!1}),this.addHandler(this.host,"selectstart",function(d){if(!b.disabled&&b.enableContainerClick)return d.preventDefault&&d.preventDefault(),!1}),this.addHandler(this.host,"mouseup",function(d){!b.disabled&&b.enableContainerClick&&d.preventDefault&&d.preventDefault()}),this.addHandler(this.host,"focus",function(d){if(!b.disabled&&
!b.locked){if(!b._canFocus)return!0;b.enableHover&&b.box.addClass(b.toThemeProperty("jqx-checkbox-hover"));b.box.addClass(b.toThemeProperty("jqx-fill-state-focus"));d.preventDefault&&d.preventDefault();c(b.checkbox).removeClass("active");(!b.clickTime||b.clickTime&&300<new Date-b.clickTime)&&c(b.checkbox).addClass("active");b.hovered=!0;return!1}}),this.addHandler(this.host,"blur",function(d){c(b.checkbox).removeClass("active");if(!b.disabled&&!b.locked){if(!b._canFocus)return!0;b.enableHover&&b.box.removeClass(b.toThemeProperty("jqx-checkbox-hover"));
b.box.removeClass(b.toThemeProperty("jqx-fill-state-focus"));d.preventDefault&&d.preventDefault();return b.hovered=!1}}),this.addHandler(this.host,"mouseenter",function(d){b.locked&&b.host.css("cursor","arrow");if(b.enableHover&&!b.disabled&&b.enableContainerClick&&!b.locked)return b.box.addClass(b.toThemeProperty("jqx-checkbox-hover")),b.box.addClass(b.toThemeProperty("jqx-fill-state-hover")),d.preventDefault&&d.preventDefault(),b.hovered=!0,!1}),this.addHandler(this.host,"mouseleave",function(d){if(b.enableHover&&
!b.disabled&&b.enableContainerClick&&!b.locked)return b.box.removeClass(b.toThemeProperty("jqx-checkbox-hover")),b.box.removeClass(b.toThemeProperty("jqx-fill-state-hover")),d.preventDefault&&d.preventDefault(),b.hovered=!1}),this.addHandler(this.box,"mouseenter",function(){b.locked||b.disabled||b.enableContainerClick||(b.box.addClass(b.toThemeProperty("jqx-checkbox-hover")),b.box.addClass(b.toThemeProperty("jqx-fill-state-hover")))}),this.addHandler(this.box,"mouseleave",function(){b.disabled||b.enableContainerClick||
(b.box.removeClass(b.toThemeProperty("jqx-checkbox-hover")),b.box.removeClass(b.toThemeProperty("jqx-fill-state-hover")))}))},focus:function(){try{this.host.focus()}catch(b){}},_removeHandlers:function(){var b="mousedown";c.jqx.mobile.isTouchDevice()&&(b="touchend");this.box&&(this.removeHandler(this.box,b),this.removeHandler(this.box,"mouseenter"),this.removeHandler(this.box,"mouseleave"));this.removeHandler(this.host,b);this.removeHandler(this.host,"mouseup");this.removeHandler(this.host,"selectstart");
this.removeHandler(this.host,"mouseenter");this.removeHandler(this.host,"mouseleave");this.removeHandler(this.host,"keydown");this.removeHandler(this.host,"blur");this.removeHandler(this.host,"focus")},_render:function(){this.disabled?this.disable():this.enableContainerClick?this.host.css("cursor","pointer"):this.init||this.host.css("cursor","auto");this.rtl&&(this.box.addClass(this.toThemeProperty("jqx-checkbox-rtl")),this.host.addClass(this.toThemeProperty("jqx-rtl")));this.updateStates();this.host.attr("checked",
this.checked)},_setState:function(b,d){this.checked!=b&&(this.checked=b,this.checkMark[0].className=this.checked?this.toThemeProperty("jqx-checkbox-check-checked"):null==this.checked?this.toThemeProperty("jqx-checkbox-check-indeterminate"):"");if(!1===d||!0===d)this.locked=d;b?this.element.setAttribute("checked",!0):this.element.removeAttribute("checked")},val:function(b){if(0==arguments.length||null!=b&&"object"==typeof b)return this.checked;"string"==typeof b?("true"==b&&this.check(),"false"==b&&
this.uncheck(),""==b&&this.indeterminate()):(1==b&&this.check(),0==b&&this.uncheck(),null==b&&this.indeterminate());return this.checked},check:function(){this.checked=!0;var b=this;this.checkMark.removeClass();this.element.setAttribute("checked",!0);c.jqx.browser.msie||0==this.animationShowDelay?this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-checked")):(this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-checked")),this.checkMark.css("opacity",0),this.checkMark.stop().animate({opacity:1},
this.animationShowDelay,function(){}));if(null!=this.groupName&&0<this.groupName.length){var d=c.find(this.toThemeProperty(".jqx-checkbox",!0));c.each(d,function(){c(this).jqxCheckBox("groupName")==b.groupName&&this!=b.element&&c(this).jqxCheckBox("uncheck")})}d=this.changeType;this._raiseEvent("0",!0);this.changeType=d;this._raiseEvent("3",{checked:!0});void 0!=this.input&&(this.input.val(this.checked),c.jqx.aria(this,"aria-checked",this.checked),this.host.attr("checked",this.checked))},uncheck:function(){this.checked=
!1;var b=this;this.element.removeAttribute("checked");c.jqx.browser.msie||0==this.animationHideDelay?""!=b.checkMark[0].className&&(b.checkMark[0].className=""):(this.checkMark.css("opacity",1),this.checkMark.stop().animate({opacity:0},this.animationHideDelay,function(){""!=b.checkMark[0].className&&(b.checkMark[0].className="")}));var d=this.changeType;this._raiseEvent("1");this.changeType=d;this._raiseEvent("3",{checked:!1});void 0!=this.input&&(this.input.val(this.checked),c.jqx.aria(this,"aria-checked",
this.checked),this.host.attr("checked",this.checked))},indeterminate:function(){this.checked=null;this.checkMark.removeClass();c.jqx.browser.msie||0==this.animationShowDelay?this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-indeterminate")):(this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-indeterminate")),this.checkMark.css("opacity",0),this.checkMark.stop().animate({opacity:1},this.animationShowDelay,function(){}));this._raiseEvent("2");this._raiseEvent("3",{checked:null});
void 0!=this.input&&(this.input.val(this.checked),c.jqx.aria(this,"aria-checked","undefined"),this.host.attr("checked","undefined"))},toggle:function(){this.disabled||this.locked||(null!=this.groupName&&0<this.groupName.length?1!=this.checked&&(this.checked=!0,this.updateStates()):(this.oldChecked=this.checked,this.checked=1==this.checked?this.hasThreeStates?null:!1:null!=this.checked,this.updateStates(),void 0!=this.input&&this.input.val(this.checked)))},updateStates:function(){this.checked?this.check():
0==this.checked?this.uncheck():null==this.checked&&this.indeterminate()},disable:function(){this.disabled=!0;1==this.checked?this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-disabled")):null==this.checked&&this.checkMark.addClass(this.toThemeProperty("jqx-checkbox-check-indeterminate-disabled"));this.box.addClass(this.toThemeProperty("jqx-checkbox-disabled-box"));this.host.addClass(this.toThemeProperty("jqx-checkbox-disabled"));this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));
this.box.addClass(this.toThemeProperty("jqx-checkbox-disabled"));c.jqx.aria(this,"aria-disabled",this.disabled)},enable:function(){1==this.checked?this.checkMark.removeClass(this.toThemeProperty("jqx-checkbox-check-disabled")):null==this.checked&&this.checkMark.removeClass(this.toThemeProperty("jqx-checkbox-check-indeterminate-disabled"));this.box.removeClass(this.toThemeProperty("jqx-checkbox-disabled-box"));this.host.removeClass(this.toThemeProperty("jqx-checkbox-disabled"));this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled"));
this.box.removeClass(this.toThemeProperty("jqx-checkbox-disabled"));this.disabled=!1;c.jqx.aria(this,"aria-disabled",this.disabled)},destroy:function(){this.host.remove()},_raiseEvent:function(b,d){if(!this.init){var e=new c.Event(this.events[b]);e.owner=this;d||(d={});d.type=this.changeType;this.changeType=null;e.args=d;try{var f=this.host.trigger(e)}catch(g){}return f}},propertiesChangedHandler:function(b,d,e){e.width&&e.height&&2==Object.keys(e).length&&b.setSize()},propertyChangedHandler:function(b,
d,e,f){if(void 0!=this.isInitialized&&0!=this.isInitialized&&!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length)){"enableContainerClick"!=d||b.disabled||b.locked||(f?b.host.css("cursor","pointer"):b.host.css("cursor","auto"));"rtl"==d&&(f?(b.box.addClass(b.toThemeProperty("jqx-checkbox-rtl")),b.host.addClass(b.toThemeProperty("jqx-rtl"))):(b.box.removeClass(b.toThemeProperty("jqx-checkbox-rtl")),b.host.removeClass(b.toThemeProperty("jqx-rtl"))));"boxSize"==
d&&b.render();"theme"==d&&c.jqx.utilities.setTheme(e,f,b.host);if("checked"==d&&f!=e)switch(f){case !0:b.check();break;case !1:b.uncheck();break;case null:b.indeterminate()}"disabled"==d&&f!=e&&(f?b.disable():b.enable())}}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxRibbon","",{});c.extend(c.jqx._jqxRibbon.prototype,{defineInstance:function(){var b={width:null,height:"auto",mode:"default",position:"top",selectedIndex:-1,selectionMode:"click",popupCloseMode:"click",animationType:"fade",animationDelay:400,scrollPosition:"both",disabled:!1,rtl:!1,scrollStep:10,scrollDelay:30,reorder:!1,initContent:null,_roundedCorners:!0,_removeByDrag:!1,_suppressReorder:!0,events:["select","unselect","change","_removeByDrag","reorder"]};if(this===
c.jqx._jqxRibbon.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(){if("none"===this.host.css("display")||!1===document.body.contains(this.element))this._initiallyHidden=!0;this._browser=c.jqx.browser;"popup"!==this.mode&&-1===this.selectedIndex&&(this.selectedIndex=0);this._originalHTML=this.element.innerHTML;this._render(!0)},render:function(){this._render()},refresh:function(b){!0!==b&&this._render()},destroy:function(){this._removeHandlers();this.host.remove()},selectAt:function(b){this._selectAt(b)},
clearSelection:function(){-1!==this.selectedIndex&&this._clearSelection()},disableAt:function(b){this._items[b]._disabled=!0;c(this._items[b]).addClass(this.toThemeProperty("jqx-fill-state-disabled"));b===this.selectedIndex&&this._clearSelection()},enableAt:function(b){this._items[b]._disabled=!1;c(this._items[b]).removeClass(this.toThemeProperty("jqx-fill-state-disabled"))},hideAt:function(b){this._items[b].style.display="none";this._checkScrollButtons();b===this.selectedIndex?this._clearSelection():
this._updatePositions()},showAt:function(b){this._items[b].style.display="horizontal"===this._orientation?"inline-block":"inherit";this._checkScrollButtons();this._updatePositions()},val:function(b){if(b)this._selectAt(b);else return this.selectedIndex},addAt:function(b,d){var e="jqx-ribbon-item jqx-ribbon-item-"+this.position,f="jqx-widget-content jqx-ribbon-content-section jqx-ribbon-content-section-"+this.position;this._removeHandlers();var g=document.createElement("li");g.innerHTML=d.title;var h=
document.createElement("div");if("string"===typeof d.content)h.innerHTML=d.content;else if(void 0!==d.content.length)try{if(void 0!==jQuery&&d.content instanceof jQuery)c(h).append(d.content);else if(c.isArray(d.content))for(var l=0;l<d.content.length;l++)d.content[l].appendTo(h);else for(;0<d.content.length;)h.appendChild(d.content[0])}catch(q){}else h.appendChild(d.content);switch(this.position){case "top":e+=" jqx-rc-t";f+=" jqx-rc-b";break;case "bottom":e+=" jqx-rc-b";f+=" jqx-rc-t";break;case "left":e+=
" jqx-rc-l";f+=" jqx-rc-r";break;case "right":e+=" jqx-rc-r",f+=" jqx-rc-l"}"popup"===this.mode&&(f+=" jqx-ribbon-content-section-popup jqx-ribbon-content-section-"+this._orientation+"-popup");!0===this.rtl&&(e+=" jqx-ribbon-item-rtl");g.className=this.toThemeProperty(e);h.className=this.toThemeProperty(f);this._items.length-1>=b?(this._headerElement.insertBefore(g,this._items[b]),this._contentElement.insertBefore(h,this._contentSections[b])):(this._headerElement.appendChild(g),this._contentElement.appendChild(h));
this._updateItems();this._addHandlers();this._checkScrollButtons();b<=this.selectedIndex&&this.selectedIndex<this._items.length-1&&this.selectedIndex++;this._updatePositions();0>this.selectedIndex||(this._suppressSelectionEvents=!0,this._selectAt(this.selectedIndex,this.selectedIndex,!0))},removeAt:function(b){b===this.selectedIndex&&this._clearSelection();c(this._items[b]).remove();c(this._contentSections[b]).remove();this._updateItems(!0);this._updatePositions();this._checkScrollButtons()},updateAt:function(b,
d){var e=this._items[b];e.innerHTML=d.newTitle;this._contentSections[b].innerHTML=d.newContent;e._isInitialized=!1;this.initContent&&b===this.selectedIndex&&(this.initContent(b),e._isInitialized=!0);this._updatePositions()},setPopupLayout:function(b,d,e,c){var g=this._contentSections[b];"popup"===this.mode&&(g.getAttribute("data-width")||(g.style.width&&g.setAttribute("data-width",g.style.width),g.style.height&&g.setAttribute("data-height",g.style.height)),e&&(g.style.width=this._toPx(e)),c&&(g.style.height=
this._toPx(c)),g._layout=d,this._positionContent(b))},propertiesChangedHandler:function(b,d,e){e&&e.width&&e.height&&2===Object.keys(e).length&&(b.element.style.width=b._toPx(b.width),b.element.style.height=b._toPx(b.height),b._updateSize())},propertyChangedHandler:function(b,d,e,f){if(!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2===Object.keys(b.batchUpdate).length)&&f!==e)switch(d){case "width":case "height":b.element.style[d]=b._toPx(f);b._updateSize();break;case "position":b._render();
break;case "mode":b._contentElement.style.width="auto";b._removeHandlers(null,e);b._render();break;case "selectedIndex":b._selectAt(f,e);break;case "selectionMode":b._removeHandlers(e);b._addHandlers();break;case "scrollPosition":d=b._scrollButtonNear;var g=b._scrollButtonFar;c(d).removeClass(b.toThemeProperty("jqx-ribbon-scrollbutton-"+e+" jqx-rc-tr jqx-rc-bl jqx-rc-tl"));c(g).removeClass(b.toThemeProperty("jqx-ribbon-scrollbutton-"+e+" jqx-rc-tr jqx-rc-bl jqx-rc-br"));d.className+=" "+b.toThemeProperty("jqx-ribbon-scrollbutton-"+
f);g.className+=" "+b.toThemeProperty("jqx-ribbon-scrollbutton-"+f);b._scrollButtonRc(d,g);b._checkScrollButtons();b._updatePositions();break;case "disabled":!0===f?(b._removeHandlers(),b.element.className+=" "+b.toThemeProperty("jqx-fill-state-disabled")):(b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")),b._addHandlers());break;case "theme":c.jqx.utilities.setTheme(e,f,b.host);break;case "rtl":if(!0===f)for(b._headerElement.className+=" "+b.toThemeProperty("jqx-ribbon-header-rtl"),
e=0;e<b._items.length;e++)b._items[e].className+=" "+b.toThemeProperty("jqx-ribbon-item-rtl");else for(b._header.removeClass(b.toThemeProperty("jqx-ribbon-header-rtl")),e=0;e<b._items.length;e++)c(b._items[e]).removeClass(b.toThemeProperty("jqx-ribbon-item-rtl"));b._positionSelectionToken(b.selectedIndex)}},_raiseEvent:function(b,d){var e=new c.Event(this.events[b]);e.owner=this;e.args=d;var f;try{f=this.host.trigger(e)}catch(g){}return f},_render:function(b){var d=this;!0!==b&&d._removeHandlers();
d._selectionTokenOffsetY=0;switch(d._browser.browser){case "mozilla":d._browserWidthRtlFlag=0;d._browserScrollRtlFlag=1;d._selectionTokenOffsetX=1;break;case "msie":d._browserWidthRtlFlag=0;d._browserScrollRtlFlag=-1;"8.0"===d._browser.version?d._selectionTokenOffsetX=1:"7.0"===d._browser.version?(d._selectionTokenOffsetX=0,"popup"!==d.mode||"bottom"!==d.position&&"right"!==d.position||(d._selectionTokenOffsetY=2)):d._selectionTokenOffsetX=0;break;default:d._browserWidthRtlFlag=1,d._browserScrollRtlFlag=
1,d._selectionTokenOffsetX=0}if(!0===b){var e=d.host.children();d._headerElement=e[0];d._header=c(e[0]);d._contentElement=e[1];d._content=c(e[1]);d._checkStructure(e);d._refreshBarPosition()}d._headerElement.style["float"]="none";d._contentElement.style.padding="0px";d.element.style.width=d._toPx(d.width);d.element.style.height=d._toPx(d.height);"bottom"!==d.position&&"right"!==d.position||d.element.insertBefore(d._contentElement,d._headerElement);d._orientation="top"===d.position||"bottom"===d.position?
"horizontal":"vertical";"right"===d.position?d._headerElement.style["float"]="right":"left"===d.position&&(d._headerElement.style["float"]="left");d._contentSections=d._content.children();c.each(d._contentSections,function(){this.getAttribute("data-width")&&(this.style.width=this.getAttribute("data-width"),this.style.height=this.getAttribute("data-height"),this.removeAttribute("data-width"),this.removeAttribute("data-height"))});!0===b&&(d._selectionToken=document.createElement("div"),d._selectionToken.className=
d.toThemeProperty("jqx-widget-content jqx-ribbon-selection-token jqx-ribbon-selection-token-"+d.position),d.element.appendChild(d._selectionToken));d._updateItems();!0!==d._initiallyHidden&&d._addClasses();!0===b&&(d._appendScrollButtons(),d._checkScrollButtons());d._allowSelection=!0;-1!==d.selectedIndex&&(d._items[d.selectedIndex].className+=" "+d.toThemeProperty("jqx-widget-content jqx-ribbon-item-selected"),d._positionSelectionToken(d.selectedIndex),d._contentSections[d.selectedIndex].style.display=
"block",d.initContent&&(d.initContent(d.selectedIndex),d._items[d.selectedIndex]._isInitialized=!0));d.disabled?d.element.className+=" "+d.toThemeProperty("jqx-fill-state-disabled"):d._addHandlers();c.jqx.utilities.resize(d.host,function(){d._initiallyHidden&&(d._initiallyHidden=!1,d._addClasses(),-1!==d.selectedIndex&&(d._items[d.selectedIndex].className+=" "+d.toThemeProperty("jqx-widget-content jqx-ribbon-item-selected")));d._updateSize(!0)});"popup"===d.mode&&""!==d.theme&&setTimeout(function(){d._positionPopup();
d._positionSelectionToken(d.selectedIndex)},30)},_updateSize:function(b){if("7.0"===this._browser.version&&"msie"===this._browser.browser)if("horizontal"===this._orientation)this._header.css("width",this.host.width()-parseInt(this._header.css("padding-left"),10)-parseInt(this._header.css("padding-right"),10)-parseInt(this._header.css("border-left-width"),10)-parseInt(this._header.css("border-right-width"),10)),this._contentSections.width(this._content.width()-parseInt(this._contentSections.css("border-left-width"),
10)-parseInt(this._contentSections.css("border-right-width"),10)-parseInt(this._contentSections.css("padding-left"),10)-parseInt(this._contentSections.css("padding-right"),10)),"default"===this.mode&&"string"===typeof this.height&&-1!==this.height.indexOf("%")&&this._contentSections.height(this._content.height()-this._header.height()-parseInt(this._contentSections.css("border-bottom-width"),10)-parseInt(this._contentSections.css("border-top-width"),10)-1);else if(this._header.css("height",this.host.height()-
parseInt(this._header.css("padding-top"),10)-parseInt(this._header.css("padding-bottom"),10)-parseInt(this._header.css("border-top-width"),10)-parseInt(this._header.css("border-bottom-width"),10)),this._contentSections.height(this._content.height()-parseInt(this._contentSections.css("border-top-width"),10)-parseInt(this._contentSections.css("border-bottom-width"),10)-parseInt(this._contentSections.css("padding-top"),10)-parseInt(this._contentSections.css("padding-bottom"),10)),"default"===this.mode&&
"string"===typeof this.width&&-1!==this.height.indexOf("%")){var d="left"===this.position?parseInt(this._contentSections.css("border-left-width"),10)+parseInt(this._contentSections.css("border-right-width"),10)+1:0;this._contentSections.width(this._content.width()-this._header.width()-d)}this._checkScrollButtons(!0);this._updatePositions(void 0,b);"popup"===this.mode&&this._positionPopup();this._refreshBarPosition()},_stopAnimation:function(){if(!this._allowSelection){this.selectedIndex=this._animatingIndex;
var b=c(this._contentSections[this._animatingIndex]);this._initAnimate(b);b.animate("finish");this._clearSelection(!0,this._animatingIndex);this._allowSelection=!0}},_refreshBarPosition:function(){var b=this;if(!this.bar){var d=c("<span></span>");c(this.host).append(d);d.addClass(this.toThemeProperty("jqx-tabs-bar"));this.bar=d}setTimeout(function(){var d=parseInt(c(b._headerElement).css("left"),10)-b._headerElement.scrollLeft,f=parseInt(c(b._headerElement).css("top"),10)-b._headerElement.scrollTop,
g=void 0!==b._animatingIndex?b._animatingIndex:b.selectedIndex;b._items[g]&&b.bar&&("top"===b.position||"bottom"===b.position?(b.bar.css("left",b._items[g].offsetLeft+d),"top"===b.position?b.bar.css("top",b._items[g].offsetTop+f+b._items[g].offsetHeight):b.bar.css("top",f),b.bar.width(c(b._items[g]).outerWidth()-2),b.bar.removeClass(b.toThemeProperty("vertical"))):("left"===b.position?b.bar.css("left",b._items[g].offsetLeft+d+b._items[g].offsetWidth):b.bar.css("left",b._items[g].offsetLeft+d),b.bar.css("top",
f+b._items[g].offsetTop),b.bar.height(c(b._items[g]).outerHeight()-2),b.bar.addClass(b.toThemeProperty("vertical"))))})},_selectAt:function(b,d,e){var f=this;void 0===d&&(d=f.selectedIndex);if(b!==d||!0===e)if(f._stopAnimation(),f._refreshBarPosition(),f._allowSelection){f._animatingIndex=b;-1!==f.selectedIndex&&f._clearSelection(!0,d);f._allowSelection=!1;f._selecting=b;"click"===f.selectionMode&&c(f._items[b]).removeClass(f.toThemeProperty("jqx-fill-state-hover jqx-ribbon-item-hover"));if("popup"===
f.mode&&f._roundedCorners){f._header.removeClass(f.toThemeProperty("jqx-rc-all"));var g,h;switch(f.position){case "top":g="jqx-rc-t";h="jqx-rc-b";break;case "bottom":g="jqx-rc-b";h="jqx-rc-t";break;case "left":g="jqx-rc-l";h="jqx-rc-r";break;case "right":g="jqx-rc-r",h="jqx-rc-l"}f._headerElement.className+=" "+f.toThemeProperty(g);for(e=0;e<f._items.length;e++)f._items[e].className+=" "+f.toThemeProperty(g),f._contentSections[e].className+=" "+f.toThemeProperty(h)}f._items[b].className+=" "+f.toThemeProperty("jqx-widget-content jqx-ribbon-item-selected");
f._selectionToken.style.display="block";f._updatePositions(b);switch(f.animationType){case "fade":g=c(f._contentSections[b]);f._initAnimate(g);"none"===g.css("display")?g.fadeIn({duration:f.animationDelay,complete:function(){f._animationComplete(b,d)}}):g.fadeOut({duration:f.animationDelay,complete:function(){f._animationComplete(b,d)}});break;case "slide":g=c(f._contentSections[b]);h=f.position;"top"===h?h="up":"bottom"===h&&(h="down");f.slideAnimation=f._slide(g,{mode:"show",direction:h,duration:f.animationDelay},
b,d);break;case "none":f._contentSections[b].style.display="block",f._animationComplete(b,d)}}},_clearSelection:function(b,d){var e=this;"popup"===e.mode&&e._roundedCorners&&(e._headerElement.className+=" "+e.toThemeProperty("jqx-rc-all"));e._selecting=-1;void 0===d&&(d=e.selectedIndex);c(e._items[d]).removeClass(e.toThemeProperty("jqx-widget-content jqx-ribbon-item-selected"));e._selectionToken.style.display="none";if(!0!==b&&"none"!==e.animationType){var f=c(e._contentSections[d]);if("fade"===e.animationType)e._initAnimate(f),
f.fadeOut({duration:e.animationDelay,complete:function(){e._clearSelectionComplete(d)}});else if("slide"===e.animationType){var g=e.position;"top"===g?g="up":"bottom"===g&&(g="down");e._stopAnimation();d=e.selectedIndex;e.slideAnimation=e._slide(f,{mode:"hide",direction:g,duration:e.animationDelay},d);e.selectedIndex=-1}}else-1!==d&&(e._contentSections[d].style.display="none",e._clearSelectionComplete(d,b))},_addHandlers:function(){function b(b){b=r._closest(b.target,"li");var d=b._index;r._items[d]._disabled||
(d!==r.selectedIndex?r._selectAt(d):"popup"===r.mode&&"none"!==r.popupCloseMode&&(b.className+=" "+r.toThemeProperty("jqx-fill-state-hover jqx-ribbon-item-hover"),r._clearSelection()))}function d(b){if(!0===r.reorder&&!0===v){var d=r._closest(b.target,"li")._index;b=r._items[y].innerHTML;for(var e=r._contentSections[y].childNodes,f=[];0<e.length;)f.push(c(e[0]).detach());r._suppressSelectionEvents=!0;r._oldReorderIndex=y;r.removeAt(y);r.clearSelection();r.addAt(d,{title:b,content:f});r.selectAt(d);
setTimeout(function(){c(r._items[d]).trigger("mousedown")},0)}else b=r._closest(b.target,"li"),w(b._index)&&(b.className+=" "+r.toThemeProperty("jqx-fill-state-hover jqx-ribbon-item-hover"))}function e(b){b=r._closest(b.target,"li");w(b._index)&&c(b).removeClass(r.toThemeProperty("jqx-fill-state-hover jqx-ribbon-item-hover"))}function f(b){"#document"!==b.target.nodeName&&(b=r._closest(b.target,"li"),!0!==r.reorder&&!0!==r._removeByDrag||b._index!==r.selectedIndex||(v=!0,y=b._index,b.style.cursor=
"move"))}function g(){"mouseLeave"===r.popupCloseMode&&"popup"===r.mode&&r._clearSelection()}function h(b){b=r._closest(b.target,"li")._index;r._items[b]._disabled||b===r.selectedIndex||r._selectAt(b)}function l(b){b=r._closest(b.target,"li")._index;r._items[b]._disabled||"popup"===r.mode&&"none"!==r.popupCloseMode&&r._clearSelection()}function q(){"mouseLeave"===r.popupCloseMode&&"popup"===r.mode&&r._clearSelection()}var r=this,t=r.element.id,v=!1,y,A=function(b){if("click"===r.popupCloseMode&&"popup"===
r.mode&&-1!==r.selectedIndex&&"svg"!==b.target.tagName){var d=r._closest(b.target,void 0,"jqx-ribbon");if(void 0!==d&&d.getAttribute("id")!==t)r._clearSelection();else if(void 0===b.target.className||-1!==b.target.className.indexOf("jqx-ribbon-content-popup"))r._clearSelection();else if(!c(b.target).ischildof(r.host)){var e=!1,f=[],g=function(b){b.parentElement&&(f.push(b.parentElement),g(b.parentElement))};g(b.target);c.each(f,function(){if(void 0!==this.className&&this.className.indexOf){if(-1!==
this.className.indexOf("jqx-ribbon"))return e=!0,!1;if(-1!==this.className.indexOf("jqx-ribbon"))return t===this.id&&(e=!0),!1}});e||r._clearSelection()}}};if("click"===r.selectionMode){for(var w=function(b){return(r._selecting!==b&&!1===r._allowSelection||(-1===r._selecting||r.selectedIndex!==b)&&!0===r._allowSelection)&&!r._items[b]._disabled},z=0;z<r._items.length;z++){var C=r._items[z];r.addHandler(C,"click.ribbon"+t,b);r.addHandler(C,"mouseenter.ribbon"+t,d);r.addHandler(C,"mouseleave.ribbon"+
t,e);r.addHandler(C,"mousedown.ribbon"+t,f)}if("popup"===r.mode){r.addHandler(r.host,"mouseleave.ribbon"+t,function(){"mouseLeave"===r.popupCloseMode&&"popup"===r.mode&&r._clearSelection()});for(z=0;z<r._contentSections.length;z++)r.addHandler(r._contentSections[z],"mouseleave.ribbon"+t,g);r.addHandler(c(document),"mousedown.ribbon"+t,function(b){A(b)})}if(!0===r._removeByDrag)for(z=0;z<r._items.length;z++)r._items[z].className+=" "+r.toThemeProperty("jqx-ribbon-item-docking-layout");r.addHandler(document,
"mouseup.ribbon"+t,function(){v=!1;for(var b=0;b<r._items.length;b++)r._items[b].style.cursor=""});r.addHandler(r._header,"mouseleave.ribbon"+t,function(b){!0===r._removeByDrag&&!0===v&&(r._raiseEvent("3",{draggedIndex:y,x:b.pageX,y:b.pageY}),1<r._items.length&&r.removeAt(y),v=!1,b.target.style.cursor="")})}else if("hover"===r.selectionMode){for(z=0;z<r._items.length;z++)C=r._items[z],r.addHandler(C,"mouseenter.ribbon"+t,h),"popup"===r.mode&&r.addHandler(C,"click.ribbon"+t,l);if("popup"===r.mode){r.addHandler(r.host,
"mouseleave.ribbon"+t,function(){"mouseLeave"===r.popupCloseMode&&"popup"===r.mode&&r._clearSelection()});for(z=0;z<r._contentSections.length;z++)r.addHandler(r._contentSections,"mouseleave.ribbon"+t,q);r.addHandler(c(document),"mousedown.ribbon"+t,function(b){A(b)})}}c.jqx.mobile.isTouchDevice()?(z="touchstart",C="touchend"):(z="mousedown",C="mouseup");r.addHandler(r._scrollButtonNear,z+".ribbon"+t,function(){r._timeoutNear="horizontal"===r._orientation?setInterval(function(){r._headerElement.scrollLeft-=
r.scrollStep*(r.rtl&&"msie"===r._browser.browser?-1:1);r._updatePositions()},r.scrollDelay):setInterval(function(){r._headerElement.scrollTop-=r.scrollStep;r._updatePositions()},r.scrollDelay);return!1});r.addHandler(r._scrollButtonFar,z+".ribbon"+t,function(){r._timeoutFar="horizontal"===r._orientation?setInterval(function(){r._headerElement.scrollLeft+=r.scrollStep*(r.rtl&&"msie"===r._browser.browser?-1:1);r._updatePositions()},r.scrollDelay):setInterval(function(){r._headerElement.scrollTop+=r.scrollStep;
r._updatePositions()},r.scrollDelay);return!1});r.addHandler(c(document),C+".ribbon"+t,function(){clearInterval(r._timeoutNear);clearInterval(r._timeoutFar)})},_removeHandlers:function(b,d){var e=this.element.id;b||(b=this.selectionMode);d||(d=this.mode);for(var f=0;f<this._items.length;f++){var g=this._items[f];this.removeHandler(g,"mouseenter.ribbon"+e);"click"===b&&(this.removeHandler(g,"click.ribbon"+e),this.removeHandler(g,"mouseleave.ribbon"+e),this.removeHandler(g,"mousedown.ribbon"+e))}"click"===
b?(this.removeHandler(document,"mouseup.ribbon"+e),this.removeHandler(this._header,"mouseleave.ribbon"+e)):"hover"===b&&"popup"===d&&this.removeHandler(this.host,"mouseleave.ribbon"+e);c.jqx.mobile.isTouchDevice()?(f="touchstart",g="touchend"):(f="mousedown",g="mouseup");this.removeHandler(this._scrollButtonNear,f+".ribbon"+e);this.removeHandler(this._scrollButtonFar,f+".ribbon"+e);this.removeHandler(c(document),g+".ribbon"+e)},_checkStructure:function(b){if(2!==b.length)throw Error("jqxRibbon: Invalid HTML structure. You need to add a ul and a div to the widget container.");
b=this._header.children().length;var d=this._content.children().length;if(b!==d)throw Error("jqxRibbon: Invalid HTML structure. For each list item you must have a corresponding div element.");},_addClasses:function(){var b="jqx-widget-content jqx-ribbon-content-section jqx-ribbon-content-section-"+this.position,d="jqx-widget-content jqx-ribbon-content jqx-ribbon-content-"+this._orientation,e="jqx-widget-header jqx-disableselect jqx-ribbon-header jqx-ribbon-header-"+this._orientation,f="jqx-ribbon-item jqx-ribbon-item-"+
this.position;this._content.removeClass();this._header.removeClass(this.toThemeProperty("jqx-rc-all jqx-widget-header jqx-disableselect jqx-rc-t jqx-rc-b jqx-rc-l jqx-rc-r jqx-rc-all jqx-ribbon-header-"+this._orientation+"-popup jqx-ribbon-header-bottom jqx-ribbon-header-auto jqx-ribbon-header-right jqx-ribbon-header-rtl"));this.host.removeClass();if(this._roundedCorners)switch(this.position){case "top":e+=" jqx-rc-t";f+=" jqx-rc-t";b+=" jqx-rc-b";break;case "bottom":e+=" jqx-rc-b";f+=" jqx-rc-b";
b+=" jqx-rc-t";break;case "left":e+=" jqx-rc-l";f+=" jqx-rc-l";b+=" jqx-rc-r";break;case "right":e+=" jqx-rc-r",f+=" jqx-rc-r",b+=" jqx-rc-l"}else switch(this.position){case "top":f+=" jqx-rc-t";break;case "bottom":f+=" jqx-rc-b";break;case "left":f+=" jqx-rc-l";break;case "right":f+=" jqx-rc-r"}!0===this.rtl&&(e+=" jqx-ribbon-header-rtl",f+=" jqx-ribbon-item-rtl");this.element.className+=" "+this.toThemeProperty("jqx-widget jqx-ribbon");this._headerElement.className+=" "+this.toThemeProperty(e);
this._contentElement.className+=" "+this.toThemeProperty(d);for(d=0;d<this._items.length;d++){var e=c(this._contentSections[d]),g=c(this._items[d]);e.removeClass();g.removeClass(this.toThemeProperty("jqx-fill-state-disabled jqx-ribbon-item-rtl jqx-widget-content jqx-ribbon-item-selected jqx-rc-t jqx-rc-b jqx-rc-l jqx-rc-r jqx-ribbon-item-docking-layout jqx-ribbon-item jqx-ribbon-item-"+this.position));"popup"===this.mode&&(b+=" jqx-ribbon-content-section-popup jqx-ribbon-content-popup-"+this.position+
" jqx-ribbon-content-section-"+this._orientation+"-popup");this._contentSections[d].className+=" "+this.toThemeProperty(b);this._items[d].className+=" "+this.toThemeProperty(f)}var h,l;"popup"===this.mode?(-1===this.selectedIndex&&this._roundedCorners&&(this.element.className+=" "+this.toThemeProperty("jqx-rc-all"),this._headerElement.className+=" "+this.toThemeProperty("jqx-rc-all")),this.element.className+=" "+this.toThemeProperty("jqx-ribbon-popup"),this._headerElement.className+=" "+this.toThemeProperty("jqx-ribbon-header-"+
this._orientation+"-popup"),this._contentElement.className+=" "+this.toThemeProperty("jqx-ribbon-content-popup"),this._positionPopup()):("horizontal"===this._orientation?"auto"!==this.height?(l=this._headerElement.offsetHeight,"top"===this.position?this._contentElement.style.paddingTop=this._toPx(l):this._headerElement.className+=" "+this.toThemeProperty("jqx-ribbon-header-bottom")):this._headerElement.className+=" "+this.toThemeProperty("jqx-ribbon-header-auto"):"vertical"===this._orientation&&("auto"!==
this.width?(h=this._headerElement.offsetWidth,"left"===this.position?this._contentElement.style.paddingLeft=this._toPx(h):(this._headerElement.className+=" "+this.toThemeProperty("jqx-ribbon-header-right"),this._contentElement.style.paddingRight=this._toPx(h))):(this.element.className+=" "+this.toThemeProperty("jqx-ribbon-auto"),this._headerElement.className+=" "+this.toThemeProperty("jqx-ribbon-header-auto"),this._contentElement.className+=" "+this.toThemeProperty("jqx-ribbon-content-auto-width"))),
this.host.addClass("jqx-tabs-header-position-"+this.position));c(this._headerElement).addClass(this.toThemeProperty("jqx-ribbon-header-"+this.position));"7.0"===this._browser.version&&"msie"===this._browser.browser&&("horizontal"===this._orientation?(this._header.css("width",this.host.width()-parseInt(this._header.css("padding-left"),10)-parseInt(this._header.css("padding-right"),10)-parseInt(this._header.css("border-left-width"),10)-parseInt(this._header.css("border-right-width"),10)),this._items.height(this._items.height()-
parseInt(this._items.css("padding-top"),10)-parseInt(this._items.css("padding-bottom"),10)-parseInt(this._items.css("border-top-width"),10)-parseInt(this._items.css("border-bottom-width"),10)),this._contentSections.width(this._contentSections.width()-parseInt(this._contentSections.css("border-left-width"),10)-parseInt(this._contentSections.css("border-right-width"),10)-parseInt(this._contentSections.css("padding-left"),10)-parseInt(this._contentSections.css("padding-right"),10)),"default"===this.mode&&
"auto"!==this.height&&("top"===this.position?this._contentSections.css("padding-top",l):this._contentSections.css("padding-bottom",l),this._content.css("height",this.host.height()+2),this._contentSections.css("height",this._content.height()-parseInt(this._contentSections.css("border-bottom-width"),10)-parseInt(this._contentSections.css("border-top-width"),10)-1))):("left"===this.position?(this._contentElement.className+=" "+this.toThemeProperty("jqx-ribbon-content-left"),b=parseInt(this._contentSections.css("border-left-width"),
10)+parseInt(this._contentSections.css("border-right-width"),10)+1):(this._contentElement.className+=" "+this.toThemeProperty("jqx-ribbon-content-right"),b=0),this._header.css("height",this.host.height()-parseInt(this._header.css("padding-top"),10)-parseInt(this._header.css("padding-bottom"),10)-parseInt(this._header.css("border-top-width"),10)-parseInt(this._header.css("border-bottom-width"),10)),this._items.width(this._items.width()-parseInt(this._items.css("padding-left"),10)-parseInt(this._items.css("padding-right"),
10)-parseInt(this._items.css("border-left-width"),10)-parseInt(this._items.css("border-right-width"),10)),this._contentSections.height(this._contentSections.height()-parseInt(this._contentSections.css("border-top-width"),10)-parseInt(this._contentSections.css("border-bottom-width"),10)-parseInt(this._contentSections.css("padding-top"),10)-parseInt(this._contentSections.css("padding-bottom"),10)),"default"===this.mode&&"auto"!==this.width&&("left"===this.position?this._contentSections.css("padding-left",
h):this._contentSections.css("padding-right",h),this._contentSections.width(this._content.width()-this._header.width()-b))));"bottom"===this.position&&this._content.css("padding-bottom",l)},_positionPopup:function(){var b="7.0"===this._browser.version&&"msie"===this._browser.browser;switch(this.position){case "top":this._contentElement.style.top=this._toPx(this._headerElement.offsetHeight);break;case "bottom":this._contentElement.style.bottom=b?this._toPx(this._height(this._headerElement)):this._toPx(this._headerElement.offsetHeight);
break;case "left":this._contentElement.style.left=this._toPx(this._headerElement.offsetWidth);break;case "right":this._contentElement.style.right=this._header.outerWidth()+"px"}},_appendScrollButtons:function(){function b(b,e,c){b.className=d.toThemeProperty("jqx-ribbon-scrollbutton jqx-ribbon-scrollbutton-"+d.position+" jqx-ribbon-scrollbutton-"+d.scrollPosition+" jqx-widget-header "+e);b.innerHTML='<div class="'+d.toThemeProperty("jqx-ribbon-scrollbutton-inner "+c)+'"></div>';"horizontal"===d._orientation?
b.style.height=d._toPx(d._height(d._headerElement)):b.style.width=d._toPx(d._width(d._headerElement));d.element.appendChild(b)}var d=this,e="horizontal"===d._orientation?["left","right"]:["up","down"],c=document.createElement("div");b(c,"jqx-ribbon-scrollbutton-lt","jqx-icon-arrow-"+e[0]);var g=document.createElement("div");b(g,"jqx-ribbon-scrollbutton-rb","jqx-icon-arrow-"+e[1]);d._scrollButtonRc(c,g);d._scrollButtonNear=c;d._scrollButtonFar=g;if(d.roundedCorners)switch(d.position){case "top":case "bottom":c.style.marginLeft=
"-1px";g.style.marginRight="-1px";break;case "right":case "left":c.style.marginTop="-1px",g.style.marginBottom="-1px"}},_scrollButtonRc:function(b,d){if(this.roundedCorners)switch(this.position){case "top":"far"!==this.scrollPosition&&(b.className+=" "+this.toThemeProperty("jqx-rc-tl"));"near"!==this.scrollPosition&&(d.className+=" "+this.toThemeProperty("jqx-rc-tr"));break;case "bottom":"far"!==this.scrollPosition&&(b.className+=" "+this.toThemeProperty("jqx-rc-bl"));"near"!==this.scrollPosition&&
(d.className+=" "+this.toThemeProperty("jqx-rc-br"));break;case "left":"far"!==this.scrollPosition&&(b.className+=" "+this.toThemeProperty("jqx-rc-tl"));"near"!==this.scrollPosition&&(d.className+=" "+this.toThemeProperty("jqx-rc-bl"));break;case "right":"far"!==this.scrollPosition&&(b.className+=" "+this.toThemeProperty("jqx-rc-tr")),"near"!==this.scrollPosition&&(d.className+=" "+this.toThemeProperty("jqx-rc-br"))}},_updateItems:function(b){function d(){e._items[c]._index===e.selectedIndex&&(e.selectedIndex=
c)}var e=this;e._items=e._header.children();e._contentSections=e._content.children();for(var c=0;c<e._items.length;c++){var g=e._items[c];g.setAttribute("unselectable","on");void 0===g._index&&(g._disabled=!1,g._isInitialized=!1,e._contentSections[c]._layout="default");!0===b&&d();g._index=c;!0!==b&&d();e._contentSections[c]&&(e._contentSections[c]._index=c)}},_positionContent:function(b){var d=this,e=d._contentSections[b],f,g,h,l,q;"horizontal"===d._orientation?(f=d.element.offsetWidth,g=d.host.offset().left,
h=d._items[b].offsetWidth,b=c(d._items[b]).offset().left,l=e.offsetWidth||parseInt(e.style.width,10),q="left"):(f=d.element.offsetHeight,g=d.host.offset().top,h=d._items[b].offsetHeight,b=c(d._items[b]).offset().top,l=e.offsetHeight||parseInt(e.style.height,10),q="top");var r=function(b){0>b?b=0:b+l>f&&(b=f-l);e.style[q]=d._toPx(b)};switch(e._layout){case "near":r(b-g);break;case "far":r(b-g-(l-h));break;case "center":r(b-g-(l-h)/2);break;default:if("right"===d.position)for(g=0;g<d._contentSections.length;g++)d._contentSections[g].style.right=
"1px";else e.style[q]=""}},_checkScrollButtons:function(b){var d=this,e=0;c.each(d._items,function(){var b=c(this);"none"!==b.css("display")&&(e+="horizontal"===d._orientation?b.outerWidth(!0):b.outerHeight(!0))});var f="horizontal"===d._orientation?["margin-left","margin-right"]:["margin-top","margin-bottom"],g="horizontal"===d._orientation?d._width(d._headerElement):d._height(d._headerElement);d._itemMargins||(d._itemMargins=[],d._itemMargins.push(c(d._items[0]).css(f[0])),d._itemMargins.push(c(d._items[d._items.length-
1]).css(f[1])));if(e>g){d._scrollButtonNear.style.display="block";d._scrollButtonFar.style.display="block";var g=d.rtl?d._itemMargins[0]:17,h=d.rtl?d._itemMargins[0]:17;switch(d.scrollPosition){case "near":h=0;g=34;break;case "far":h=34,g=17}d._items[0]&&(d._items[0].style[f[0]]=d._toPx(g));d._items[d._items.length-1]&&(d._items[d._items.length-1].style[f[1]]=d._toPx(h))}else d._items[0]&&(d._items[0].style[f[0]]=d._toPx(d._itemMargins[0])),d._items[d._items.length-1]&&(d._items[d._items.length-1].style[f[1]]=
d._toPx(d._itemMargins[1])),d._scrollButtonNear.style.display="none",d._scrollButtonFar.style.display="none";!0===b&&("horizontal"===d._orientation?(b=d._toPx(d._height(d._headerElement)),d._scrollButtonNear.style.height=b,d._scrollButtonFar.style.height=b):(b=d._toPx(d._width(d._headerElement)),d._scrollButtonNear.style.width=b,d._scrollButtonFar.style.width=b))},_positionSelectionToken:function(b){if(-1!==b){var d=c(this._items[b]);if(0!==d.length){var e,f;"horizontal"===this._orientation?(!0===
this.rtl?(b=1===this._browserWidthRtlFlag?this._headerElement.scrollWidth-this._headerElement.clientWidth:0,f=this._browserScrollRtlFlag):(b=0,f=1),f=d[0].offsetLeft+b-this._headerElement.scrollLeft*f-this._selectionTokenOffsetX+2,e=this._headerElement.offsetHeight-1,d=this._width(d[0])+parseInt(d.css("padding-left"),10)+parseInt(d.css("padding-right"),10),"top"===this.position?(b=e-this._selectionTokenOffsetY,e=""):(b="",e-=this._selectionTokenOffsetY),this._selectionToken.style.top=this._toPx(b),
this._selectionToken.style.bottom=this._toPx(e),this._selectionToken.style.left=this._toPx(f),this._selectionToken.style.width=this._toPx(d)):(b=d[0].offsetTop-this._headerElement.scrollTop-this._selectionTokenOffsetX+2,e=this._headerElement.offsetWidth-1,d=this._height(d[0])+parseInt(d.css("padding-top"),10)+parseInt(d.css("padding-bottom"),10),"left"===this.position?(f=e-this._selectionTokenOffsetY,e=""):(f="",e-=this._selectionTokenOffsetY),this._selectionToken.style.top=this._toPx(b),this._selectionToken.style.left=
this._toPx(f),this._selectionToken.style.right=this._toPx(e),this._selectionToken.style.height=this._toPx(d))}}},_updatePositions:function(b,d){isNaN(b)&&(b=!0===d&&null!==this._selecting&&0<=this._selecting?this._selecting:this.selectedIndex);-1!==b&&(this._positionSelectionToken(b),"popup"===this.mode&&"default"!==this._contentSections[b]._layout&&this._positionContent(b),"popup"!==this.mode||"left"!==this.position&&"right"!==this.position||(this._contentElement.style.width="auto",this._contentSections[b].style.width&&
0<=this._contentSections[b].style.width.indexOf("%")?this._contentElement.style.width=this._toPx(this._width(this._contentSections[b])-this._width(this._headerElement)):this._contentElement.style.width=this._toPx(this._width(this._contentSections[b]))),this._refreshBarPosition())},_animationComplete:function(b,d){var e=-1!==d?d:null;this._contentElement.style.pointerEvents="auto";this.selectedIndex=b;!0!==this._suppressSelectionEvents?(this._raiseEvent("0",{selectedIndex:b}),this._raiseEvent("2",
{unselectedIndex:e,selectedIndex:b})):(!0!==this._suppressReorder&&void 0!==this._oldReorderIndex&&b!==this._oldReorderIndex&&this._raiseEvent("4",{newIndex:b,oldIndex:this._oldReorderIndex}),this._suppressReorder=this._suppressSelectionEvents=!1);this.initContent&&!1===this._items[b]._isInitialized&&(this.initContent(b),this._items[b]._isInitialized=!0);this._allowSelection=!0;this._selecting=null;this._refreshBarPosition()},_clearSelectionComplete:function(b,d){this._selecting=null;void 0===b&&
(b=this.selectedIndex);-1!==b&&(this._contentElement.style.pointerEvents="none",!0!==this._suppressSelectionEvents&&this._raiseEvent("1",{unselectedIndex:b}));!0!==d&&(this.selectedIndex=-1)},_slide:function(b,d,e,f){var g=this;g.activeAnimations||(g.activeAnimations=[]);if(0<g.activeAnimations.length)for(var h=0;h<g.activeAnimations.length;h++)g.activeAnimations[h].clearQueue(),g.activeAnimations[h].finish();else b.clearQueue(),b.animate("finish");var l={save:function(b,d){for(var e=0;e<d.length;e++)null!==
d[e]&&0<b.length&&b.data("ui-effects-"+d[e],b[0].style[d[e]])},restore:function(b,d){var e,c;for(c=0;c<d.length;c++)null!==d[c]&&(e=b.data("ui-effects-"+d[c]),void 0===e&&(e=""),b.css(d[c],e))},createWrapper:function(b){if(b.parent().is(".ui-effects-wrapper"))return b.parent();var d={width:b.outerWidth(!0),height:b.outerHeight(!0),"float":b.css("float")},e=c("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),f={width:b.width(),
height:b.height()},g=document.activeElement;try{g.id}catch(h){g=document.body}b.wrap(e);(b[0]===g||c.contains(b[0],g))&&c(g).focus();e=b.parent();"static"===b.css("position")?(e.css({position:"relative"}),b.css({position:"relative"})):(c.extend(d,{position:b.css("position"),zIndex:b.css("z-index")}),c.each(["top","left","bottom","right"],function(e,c){d[c]=b.css(c);isNaN(parseInt(d[c],10))&&(d[c]="auto")}),b.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"}));b.css(f);return e.css(d).show()},
removeWrapper:function(b){var d=document.activeElement;b.parent().is(".ui-effects-wrapper")&&(b.parent().replaceWith(b),(b[0]===d||c.contains(b[0],d))&&c(d).focus());return b}},q="position top bottom left right width height".split(" "),r=d.mode,h="show"===r,t=d.direction||"left",v="up"===t||"down"===t?"top":"left",t="up"===t||"left"===t,y,A={};l.save(b,q);b.show();y=d.distance||b["top"===v?"outerHeight":"outerWidth"](!0);l.createWrapper(b).css({overflow:"hidden"});h&&b.css(v,t?isNaN(y)?"-"+y:-y:y);
A[v]=(h?t?"+=":"-=":t?"-=":"+=")+y;g.activeAnimations.push(b);b.animate(A,{duration:d.duration,easing:d.easing,complete:function(){g.activeAnimations.pop(b);"show"===r?g._animationComplete(e,f):"hide"===r&&(b.hide(),g._clearSelectionComplete(e));l.restore(b,q);l.removeWrapper(b)}});return function(){b.clearQueue();b.stop(!0,!0)}},_toPx:function(b){return"number"===typeof b?b+"px":b},_width:function(b){var d=c(b),e=d.css("border-left-width"),f=d.css("border-right-width"),g=parseInt(d.css("padding-left"),
10),h=parseInt(d.css("padding-right"),10);if(d="none"===d.css("display")?!0:!1)b.style.display="block";e=-1===e.indexOf("px")?1:parseInt(e,10);f=-1===f.indexOf("px")?1:parseInt(f,10);e=b.offsetWidth-(e+f+g+h);d&&(b.style.display="none");return Math.max(0,e)},_height:function(b){var d=c(b),e=d.css("border-top-width"),f=d.css("border-bottom-width"),g=parseInt(d.css("padding-top"),10),d=parseInt(d.css("padding-bottom"),10),e=-1===e.indexOf("px")?1:parseInt(e,10),f=-1===f.indexOf("px")?1:parseInt(f,10);
return Math.max(0,b.offsetHeight-(e+f+g+d))},_closest:function(b,d,e){if(d){if(b.nodeName.toLowerCase()===d)return b;for(var c=b.parentNode;null!==c&&"#document"!==c.nodeName;){if(c.nodeName.toLowerCase()===d)return c;c=c.parentNode}}if(e){if(-1<(" "+b.className+" ").replace(/[\n\t]/g," ").indexOf(" "+e+" "))return b;for(b=b.parentNode;null!==b&&"#document"!==b.nodeName;){if(-1<(" "+b.className+" ").replace(/[\n\t]/g," ").indexOf(" "+e+" "))return b;b=b.parentNode}}},_initAnimate:function(b){b.initAnimate&&
!b.animate&&b.initAnimate()}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxRadioButton","",{});c.extend(c.jqx._jqxRadioButton.prototype,{defineInstance:function(){var b={animationShowDelay:300,animationHideDelay:300,width:null,height:null,boxSize:"16px",checked:!1,hasThreeStates:!1,disabled:!1,enableContainerClick:!0,locked:!1,groupName:"",rtl:!1,changeType:null,_canFocus:!0,aria:{"aria-checked":{name:"checked",type:"boolean"},"aria-disabled":{name:"disabled",type:"boolean"}},events:["checked","unchecked","indeterminate","change"]};if(this===
c.jqx._jqxRadioButton.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(b){this._createFromInput("RadioButton");this.render()},_createFromInput:function(b){if("input"==this.element.nodeName.toLowerCase()){this.field=this.element;this.field.className&&(this._className=this.field.className);var d={title:this.field.title};this.field.value&&(d.value=this.field.value);this.field.checked&&(d.checked=!0);d.id=this.field.id.length?this.field.id.replace(/[^\w]/g,"_")+"_"+b:c.jqx.utilities.createId()+
"_"+b;var e=this.element.nextSibling,f=!1;!e||"#text"!=e.nodeName&&"span"!=e.nodeName||(f=!0);var g=0;b=c("<div></div>",d);f&&(b.append(e),e=c("<span>"+c(e).text()+"</span>"),e.appendTo(c(document.body)),g+=e.width(),e.remove());b[0].style.cssText=this.field.style.cssText;this.width||(this.width=c(this.field).width()+g+10);this.height||(this.height=c(this.field).outerHeight()+10);c(this.field).hide().after(b);g=this.host.data();this.host=b;this.host.data(g);this.element=b[0];this.element.id=this.field.id;
this.field.id=d.id;this._className&&(this.host.addClass(this._className),c(this.field).removeClass(this._className));this.field.tabIndex&&(d=this.field.tabIndex,this.field.tabIndex=-1,this.element.tabIndex=d)}},render:function(){this.setSize();var b=this;this.propertyChangeMap.width=function(d,e,c,f){b.setSize()};this.propertyChangeMap.height=function(d,e,c,f){b.setSize()};this.radiobutton&&this.radiobutton.remove();this.width||this.host.css("overflow-x","visible");this.height||this.host.css("overflow-y",
"visible");null==this.boxSize&&(this.boxSize=16);var d=parseInt(this.boxSize)+"px",e=Math.floor((parseInt(this.boxSize)-16)/2),f=e,e=e+"px",f=f+"px",g=parseInt(this.boxSize)/2+"px";this.radiobutton="16px"!=this.boxSize?c('<div><div style="width: '+d+"; height: "+d+';"><span style="position: relative; left: '+e+"; top: "+f+'; width: 16px; height: 16px;"></span></div></div>'):c('<div><div style="width: '+d+"; height: "+d+';"><span style="width: '+g+"; height: "+g+';"></span></div></div>');this.host.attr("role",
"radio");this.host.prepend(this.radiobutton);this.disabledContainer||(this.host.attr("tabIndex")||this.host.attr("tabIndex",0),this.clear=c('<div style="clear: both;"></div>'),this.host.append(this.clear));this.checkMark=c(this.radiobutton[0].firstChild.firstChild);this.box=this.radiobutton;this._supportsRC=!0;c.jqx.browser.msie&&9>c.jqx.browser.version&&(this._supportsRC=!1);this.box.addClass(this.toThemeProperty("jqx-fill-state-normal"));this.box.addClass(this.toThemeProperty("jqx-radiobutton-default"));
this.host.addClass(this.toThemeProperty("jqx-widget"));this.disabled&&this.disable();this.host.addClass(this.toThemeProperty("jqx-radiobutton"));this.locked&&this.host.css("cursor","auto");d=this.element.getAttribute("checked");if("checked"==d||"true"==d||1==d)this.checked=!0;this._addInput();this._render();this._addHandlers();c.jqx.aria(this);this._centerBox();this.isMaterialized()&&(c(this.radiobutton).addClass("ripple"),c.jqx.ripple(c(this.radiobutton),this.host,"radiobutton"))},_centerBox:function(){if(this.height&&
-1==this.height.toString().indexOf("%")&&this.box){var b=parseInt(this.height);this.host.css("line-height",b+"px");b=b-parseInt(this.boxSize)-1;this.box.css("margin-top",parseInt(b/2))}},_addInput:function(){var b=this.host.attr("name");this.input=c("<input type='hidden'/>");this.host.append(this.input);b&&this.input.attr("name",b)},refresh:function(b){b||(this.setSize(),this._render())},resize:function(b,d){this.width=b;this.height=d;this.setSize()},setSize:function(){null!=this.width&&-1!=this.width.toString().indexOf("px")?
this.host.width(this.width):void 0==this.width||isNaN(this.width)?null!=this.width&&-1!=this.width.toString().indexOf("%")&&(this.element.style.width=this.width):this.host.width(this.width);null!=this.height&&-1!=this.height.toString().indexOf("px")?this.host.height(this.height):void 0==this.height||isNaN(this.height)?null!=this.height&&-1!=this.height.toString().indexOf("%")&&(this.element.style.height=this.height):this.host.height(this.height);this._centerBox()},_addHandlers:function(){var b=this;
this.addHandler(this.box,"click",function(d){if(!b.disabled&&!b.enableContainerClick)return b.changeType="mouse",b.toggle("click"),d.preventDefault(),!1});this.addHandler(this.host,"keydown",function(d){if(!b.disabled&&!b.locked&&32==d.keyCode){if(!b._canFocus)return!0;b.changeType="keyboard";b.toggle("click");d.preventDefault();return!1}});this.addHandler(this.host,"mousedown",function(d){if(!b.disabled&&b.enableContainerClick)return b.clickTime=new Date,b.changeType="mouse",b.toggle("click"),b._canFocus&&
b.focus(),d.preventDefault(),!1});this.addHandler(this.host,"selectstart",function(d){!b.disabled&&b.enableContainerClick&&d.preventDefault()});this.addHandler(this.host,"mouseup",function(d){!b.disabled&&b.enableContainerClick&&d.preventDefault()});this.addHandler(this.host,"focus",function(d){if(!b.disabled&&b.enableContainerClick&&!b.locked)return c(b.radiobutton).removeClass("active"),(!b.clickTime||b.clickTime&&300<new Date-b.clickTime)&&c(b.radiobutton).addClass("active"),b.box.addClass(b.toThemeProperty("jqx-radiobutton-hover")),
b.box.addClass(b.toThemeProperty("jqx-fill-state-focus")),d.preventDefault(),!1});this.addHandler(this.host,"blur",function(d){c(b.radiobutton).removeClass("active");if(!b.disabled&&b.enableContainerClick&&!b.locked)return b.box.removeClass(b.toThemeProperty("jqx-radiobutton-hover")),b.box.removeClass(b.toThemeProperty("jqx-fill-state-focus")),d.preventDefault(),!1});this.addHandler(this.host,"mouseenter",function(d){if(!b.disabled&&b.enableContainerClick&&!b.locked)return b.box.addClass(b.toThemeProperty("jqx-radiobutton-hover")),
b.box.addClass(b.toThemeProperty("jqx-fill-state-hover")),d.preventDefault(),!1});this.addHandler(this.host,"mouseleave",function(d){if(!b.disabled&&b.enableContainerClick&&!b.locked)return b.box.removeClass(b.toThemeProperty("jqx-radiobutton-hover")),b.box.removeClass(b.toThemeProperty("jqx-fill-state-hover")),d.preventDefault(),!1});this.addHandler(this.box,"mouseenter",function(){b.disabled||b.enableContainerClick||(b.box.addClass(b.toThemeProperty("jqx-radiobutton-hover")),b.box.addClass(b.toThemeProperty("jqx-fill-state-hover")))});
this.addHandler(this.box,"mouseleave",function(){b.disabled||b.enableContainerClick||(b.box.removeClass(b.toThemeProperty("jqx-radiobutton-hover")),b.box.removeClass(b.toThemeProperty("jqx-fill-state-hover")))})},focus:function(){try{this.host.focus()}catch(b){}},_removeHandlers:function(){this.removeHandler(this.box,"click");this.removeHandler(this.box,"mouseenter");this.removeHandler(this.box,"mouseleave");this.removeHandler(this.host,"click");this.removeHandler(this.host,"mouseup");this.removeHandler(this.host,
"mousedown");this.removeHandler(this.host,"selectstart");this.removeHandler(this.host,"mouseenter");this.removeHandler(this.host,"mouseleave");this.removeHandler(this.host,"keydown");this.removeHandler(this.host,"focus");this.removeHandler(this.host,"blur")},_render:function(){null==this.boxSize&&(this.boxSize=13);this.box.width(this.boxSize);this.box.height(this.boxSize);this.disabled?this.disable():this.enableContainerClick?this.host.css("cursor","pointer"):this.host.css("cursor","auto");this.rtl&&
(this.box.addClass(this.toThemeProperty("jqx-radiobutton-rtl")),this.host.addClass(this.toThemeProperty("jqx-rtl")));this.updateStates()},val:function(b){if(0==arguments.length||"object"==typeof b)return this.checked;"string"==typeof b?("true"==b&&this.check("api"),"false"==b&&this.uncheck("api"),""==b&&this.indeterminate("api")):(1==b&&this.check("api"),0==b&&this.uncheck("api"),null==b&&this.indeterminate("api"));return this.checked},check:function(b){this.checked=!0;var d=this;this.checkMark.removeClass();
this.checkMark.addClass(this.toThemeProperty("jqx-fill-state-pressed"));c.jqx.browser.msie?(this.disabled&&this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-disabled")),this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-checked"))):(this.disabled&&this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-disabled")),this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-checked")),this.checkMark.css("opacity",0),this.checkMark.stop().animate({opacity:1},
this.animationShowDelay,function(){}));var e=c.find(".jqx-radiobutton");null==this.groupName&&(this.groupName="");c.each(e,function(){c(this).jqxRadioButton("groupName")==d.groupName&&this!=d.element&&c(this).jqxRadioButton("uncheck","api")});e=this.changeType;this._raiseEvent("0");this.changeType=e;this._raiseEvent("3",{type:b,checked:!0});0==this.checkMark.height()?(b=parseInt(this.boxSize)/2,this.checkMark.height(b),this.checkMark.width(b)):"13px"!=this.boxSize&&(b=parseInt(this.boxSize)/2,this.checkMark.height(b),
this.checkMark.width(b),this.checkMark.css("margin-left",1+b/4),this.checkMark.css("margin-top",1+b/4));this.input.val(this.checked);c.jqx.aria(this,"aria-checked",this.checked);this.host.attr("checked",this.checked)},uncheck:function(b){var d=this.checked;this.checked=!1;var e=this;c.jqx.browser.msie?e.checkMark.removeClass():(this.checkMark.css("opacity",1),this.checkMark.stop().animate({opacity:0},this.animationHideDelay,function(){e.checkMark.removeClass()}));d&&(d=this.changeType,this._raiseEvent("1"),
this.changeType=d,this._raiseEvent("3",{type:b,checked:!1}));this.input.val(this.checked);c.jqx.aria(this,"aria-checked",this.checked);this.host.attr("checked",this.checked)},indeterminate:function(b){var d=this.checked;this.checked=null;this.checkMark.removeClass();c.jqx.browser.msie?this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-indeterminate")):(this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-indeterminate")),this.checkMark.css("opacity",0),this.checkMark.stop().animate({opacity:1},
this.animationShowDelay,function(){}));null!=d&&(d=this.changeType,this._raiseEvent("2"),this.changeType=d,this._raiseEvent("3",{type:b,checked:null}));this.input.val(this.checked);c.jqx.aria(this,"aria-checked","undefined");this.host.attr("checked","undefined")},toggle:function(b){if(!this.disabled&&!this.locked){var d=this.checked;this.checked=1==this.checked?this.hasTreeStates?null:!0:!0;d!=this.checked&&this.updateStates(b);this.input.val(this.checked)}},updateStates:function(b){this.checked?
this.check(b):0==this.checked?this.uncheck(b):null==this.checked&&this.indeterminate(b)},disable:function(){this.disabled=!0;1==this.checked?this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-disabled")):null==this.checked&&this.checkMark.addClass(this.toThemeProperty("jqx-radiobutton-check-indeterminate-disabled"));this.box.addClass(this.toThemeProperty("jqx-radiobutton-disabled"));this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));c.jqx.aria(this,"aria-disabled",
this.disabled)},enable:function(){this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled"));1==this.checked?this.checkMark.removeClass(this.toThemeProperty("jqx-radiobutton-check-disabled")):null==this.checked&&this.checkMark.removeClass(this.toThemeProperty("jqx-radiobutton-check-indeterminate-disabled"));this.box.removeClass(this.toThemeProperty("jqx-radiobutton-disabled"));this.disabled=!1;c.jqx.aria(this,"aria-disabled",this.disabled)},destroy:function(){this._removeHandlers();this.host.remove()},
_raiseEvent:function(b,d){var e=new c.Event(this.events[b]);e.owner=this;d||(d={});d.type=this.changeType;this.changeType=null;e.args=d;try{var f=this.host.trigger(e)}catch(g){}return f},propertiesChangedHandler:function(b,d,e){e.width&&e.height&&2==Object.keys(e).length&&b.setSize()},propertyChangedHandler:function(b,d,e,f){if(void 0!=this.isInitialized&&0!=this.isInitialized&&!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length)){d!=this.enableContainerClick||
this.disabled||this.locked||(f?this.host.css("cursor","pointer"):this.host.css("cursor","auto"));"rtl"==d&&(f?(b.box.addClass(b.toThemeProperty("jqx-radiobutton-rtl")),b.host.addClass(b.toThemeProperty("jqx-rtl"))):(b.box.removeClass(b.toThemeProperty("jqx-radiobutton-rtl")),b.host.removeClass(b.toThemeProperty("jqx-rtl"))));"boxSize"==d&&b.render();if("checked"==d)switch(f){case !0:this.check("api");break;case !1:this.uncheck("api");break;case null:this.indeterminate()}"theme"==d&&c.jqx.utilities.setTheme(e,
f,this.host);"disabled"==d&&(f?this.disable():this.enable())}}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxSplitter","",{});c.extend(c.jqx._jqxSplitter.prototype,{defineInstance:function(){var b={width:300,height:300,panels:[],orientation:"vertical",disabled:!1,splitBarSize:5,touchSplitBarSize:15,panel1:null,panel2:null,_eventsMap:{mousedown:c.jqx.mobile.getTouchEventName("touchstart"),mouseup:c.jqx.mobile.getTouchEventName("touchend"),mousemove:c.jqx.mobile.getTouchEventName("touchmove"),mouseenter:"mouseenter",mouseleave:"mouseleave"},_isTouchDevice:!1,_isNested:!1,resizable:!0,
touchMode:"auto",showSplitBar:!0,initContent:null,_events:["resize","expanded","collapsed","resizeStart","layout"]};if(this===c.jqx._jqxSplitter.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(){this.render()},_initOverlay:function(b){this.overlay||"undefined"==b?(this.overlay.remove(),this.overlay=null):1==b&&(this.overlay=c("<div style='z-index: 100; background: #fff;'></div>"),this.overlay.css("opacity",.01),this.overlay.css("position","absolute"),this.overlay.appendTo(c(document.body)),
this.host.coord(),this.overlay.css("left","0px"),this.overlay.css("top","0px"),this.overlay.width(c(window).width()),this.overlay.height(c(window).height()),this.overlay.addClass("jqx-disableselect"),"horizontal"==this.orientation?this.overlay.css("cursor","row-resize"):this.overlay.css("cursor","col-resize"))},_startDrag:function(b){return b.target==this.splitBarButton[0]||this.disabled||this.panels[0].collapsed||this.panels[1].collapsed||!this.resizable?!0:null==this.overlay?(this._dragging=!0,
this._initOverlay(!0),this._dragStart=c.jqx.position(b),!1):!0},_drag:function(b){if(this.panels[0].collapsed||this.panels[1].collapsed||this.disabled||!this._dragging)return!0;var d="horizontal"==this.orientation?"top":"left",e="vertical"==this.orientation?"width":"height";this._position=c.jqx.position(b);if(this.overlay&&!this._splitBarClone&&3<=Math.abs(this._position[d]-this._dragStart[d]))b=this.splitBar.coord(),this._cloneStart={left:b.left,top:b.top},this._splitBarClone=this._createSplitBarClone(),
this._raiseEvent(3,{panels:this.panels});else{if(this._splitBarClone){var f,g,h=this.host[e](),l=h/100,e=this._splitBarClone[e]()+2;f=parseInt(this.host.coord()[d]);var q=this._position[d]-this._dragStart[d]+this._cloneStart[d]-f;0>q&&(q=0);q>h+0-e&&(q=h+0-e);f=this.panels[0].min;g=this.panels[1].min;-1!=g.toString().indexOf("%")&&(g=parseFloat(g)*l);-1!=f.toString().indexOf("%")&&(f=parseFloat(f)*l);this._splitBarClone.removeClass(this.toThemeProperty("jqx-splitter-splitbar-invalid"));q<f&&(this._splitBarClone.addClass(this.toThemeProperty("jqx-splitter-splitbar-invalid")),
q=f);q>h+0-e-g&&(this._splitBarClone.addClass(this.toThemeProperty("jqx-splitter-splitbar-invalid")),q=h+0-e-g);this._splitBarClone.css(d,q);b.preventDefault&&b.preventDefault();b.stopPropagation&&b.stopPropagation();return!1}return!0}},resize:function(b,d){this.width=b;this.height=d;this._arrange()},_resize:function(){var b="horizontal"==this.orientation?"height":"width",d=this._splitBarClone.css("horizontal"==this.orientation?"top":"left"),b=this.host[b](),e=1/(b/100);-1!=this.panels[0].size.toString().indexOf("%")?
(this.panels[0].size=parseFloat(d)*e+"%",this.panels[1].size=100-parseFloat(d)*e+"%"):(this.panels[0].size=parseFloat(d),this.panels[1].size=b-parseFloat(d));this._layoutPanels();this._raiseEvent(0,{panels:this.panels})},_stopDrag:function(){this._dragging&&this._initOverlay();this._dragging=!1;if(this._splitBarClone){if(this.panels[0].collapsed||this.panels[1].collapsed||this.disabled)return!0;this._resize();this._splitBarClone.remove();this._splitBarClone=null}},_createSplitBarClone:function(){var b=
this.splitBar.clone();b.fadeTo(0,.7);b.css("z-index",99999);"vertical"==this.orientation?b.css("cursor","col-resize"):b.css("cursor","row-resize");this.host.append(b);return b},_eventName:function(b){return this._isTouchDevice?this._eventsMap[b]:b},_addHandlers:function(){var b=this;c.jqx.utilities.resize(this.host,function(){b._layoutPanels()});this.addHandler(this.splitBar,"dragstart."+this.element.id,function(b){return!1});this.splitBarButton&&(this.addHandler(this.splitBarButton,"click."+this.element.id,
function(){b.panels[0].collapsible?b.panels[0].collapsed?b.expand():b.collapse():b.panels[1].collapsible&&(b.panels[1].collapsed?b.expand():b.collapse())}),this.addHandler(this.splitBarButton,this._eventName("mouseenter"),function(){b.splitBarButton.addClass(b.toThemeProperty("jqx-splitter-collapse-button-hover"));b.splitBarButton.addClass(b.toThemeProperty("jqx-fill-state-hover"))}),this.addHandler(this.splitBarButton,this._eventName("mouseleave"),function(){b.splitBarButton.removeClass(b.toThemeProperty("jqx-splitter-collapse-button-hover"));
b.splitBarButton.removeClass(b.toThemeProperty("jqx-fill-state-hover"))}));this.addHandler(c(document),this._eventName("mousemove")+"."+this.element.id,function(d){return b._drag(d)});this.addHandler(c(document),this._eventName("mouseup")+"."+this.element.id,function(){return b._stopDrag()});this.addHandler(this.splitBar,this._eventName("mousedown"),function(d){return b._startDrag(d)});this.addHandler(this.splitBar,this._eventName("mouseenter"),function(){b.resizable&&!b.disabled&&(b.splitBar.addClass(b.toThemeProperty("jqx-splitter-splitbar-hover")),
b.splitBar.addClass(b.toThemeProperty("jqx-fill-state-hover")))});this.addHandler(this.splitBar,this._eventName("mouseleave"),function(){b.resizable&&!b.disabled&&(b.splitBar.removeClass(b.toThemeProperty("jqx-splitter-splitbar-hover")),b.splitBar.removeClass(b.toThemeProperty("jqx-fill-state-hover")))});if((""!=document.referrer||window.frameElement)&&null!=window.top&&window.top!=window.self){var d=null;window.parent&&document.referrer&&(d=document.referrer);d&&-1!=d.indexOf(document.location.host)&&
(d=function(d){b._stopDrag()},window.top.document.addEventListener?window.top.document.addEventListener("mouseup",d,!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",d))}},_removeHandlers:function(){this.removeHandler(c(window),"resize."+this.element.id);this.splitBarButton&&(this.removeHandler(this.splitBarButton,"click."+this.element.id),this.removeHandler(this.splitBarButton,this._eventName("mouseenter")),this.removeHandler(this.splitBarButton,this._eventName("mouseleave")));
this.removeHandler(c(document),this._eventName("mousemove")+"."+this.element.id);this.removeHandler(c(document),this._eventName("mouseup")+"."+this.element.id);this.splitBar&&(this.removeHandler(this.splitBar,"dragstart."+this.element.id),this.removeHandler(this.splitBar,this._eventName("mousedown")),this.removeHandler(this.splitBar,this._eventName("mouseenter")),this.removeHandler(this.splitBar,this._eventName("mouseleave")))},render:function(){this.splitBar&&this.splitBar.remove();var b=this.host.children();
if(2!=b.length)throw"Invalid HTML Structure! jqxSplitter requires 1 container DIV tag and 2 nested DIV tags.";if(2==b.length){var d=b[0].className.split(" "),b=b[1].className.split(" ");if(-1!=d.indexOf("jqx-reset")&&-1!=d.indexOf("jqx-splitter")&&-1!=d.indexOf("jqx-widget"))throw"Invalid HTML Structure! Nested jqxSplitter cannot be initialized from a Splitter Panel. You need to add a new DIV tag inside the Splitter Panel and initialize the nested jqxSplitter from it!";if(-1!=b.indexOf("jqx-reset")&&
-1!=b.indexOf("jqx-splitter")&&-1!=b.indexOf("jqx-widget"))throw"Invalid HTML Structure! Nested jqxSplitter cannot be initialized from a Splitter Panel. You need to add a new DIV tag inside the Splitter Panel and initialize the nested jqxSplitter from it!";}if(0<this.host.parent().length&&-1!=this.host.parent()[0].className.indexOf("jqx-splitter")){if(-1!=this.element.className.indexOf("jqx-splitter-panel"))throw"Invalid HTML Structure! Nested jqxSplitter cannot be initialized from a Splitter Panel. You need to add a new DIV tag inside the Splitter Panel and initialize the nested jqxSplitter from it!";
this._isNested=!0;300==this.width&&(this.width="100%");300==this.height&&(this.height="100%");"100%"==this.width&&"100%"==this.height&&(this.host.addClass("jqx-splitter-nested"),-1!=this.host.parent()[0].className.indexOf("jqx-splitter-panel")&&this.host.parent().addClass("jqx-splitter-panel-nested"))}this._hasBorder=0==this.host.hasClass("jqx-hideborder")||""!=this.element.style.borderTopWidth;this._removeHandlers();this._isTouchDevice=c.jqx.mobile.isTouchDevice();this._validate();this.panel1.css("left",
"0px");this.panel1.css("top","0px");this.panel2.css("left","0px");this.panel2.css("top","0px");this.splitBar=c("<div><div></div></div>");this.resizable||this.splitBar.css("cursor","default");this.splitBarButton=this.splitBar.find("div:last");this._setTheme();this.splitBar.insertAfter(this.panel1);this._arrange();0==this.panels[0].collapsible&&0==this.panels[1].collapsible&&this.splitBarButton.hide();this._addHandlers();this.initContent&&this.initContent();this.disabled&&this.disable()},_hiddenParent:function(){return c.jqx.isHidden(this.host)},
_setTheme:function(){this.panel1.addClass(this.toThemeProperty("jqx-widget-content"));this.panel2.addClass(this.toThemeProperty("jqx-widget-content"));this.panel1.addClass(this.toThemeProperty("jqx-splitter-panel"));this.panel2.addClass(this.toThemeProperty("jqx-splitter-panel"));this.panel1.addClass(this.toThemeProperty("jqx-reset"));this.panel2.addClass(this.toThemeProperty("jqx-reset"));this.host.addClass(this.toThemeProperty("jqx-reset"));this.host.addClass(this.toThemeProperty("jqx-splitter"));
this.host.addClass(this.toThemeProperty("jqx-widget"));this.host.addClass(this.toThemeProperty("jqx-widget-content"));this.splitBar.addClass(this.toThemeProperty("jqx-splitter-splitbar-"+this.orientation));this.splitBar.addClass(this.toThemeProperty("jqx-fill-state-normal"));this.splitBarButton.addClass(this.toThemeProperty("jqx-splitter-collapse-button-"+this.orientation));this.splitBarButton.addClass(this.toThemeProperty("jqx-fill-state-pressed"))},_validate:function(){var b=this.host.children();
if(2!=b.length)throw"Invalid HTML Structure! jqxSplitter requires two nested DIV tags!";this.panels&&!this.panels[1]?this.panels[0]?this.panels[1]={}:this.panels=[{size:"50%"},{size:"50%"}]:void 0==this.panels&&(this.panels=[{size:"50%"},{size:"50%"}]);b=this.host.children();this.panel1=this.panels[0].element=c(b[0]);this.panel2=this.panels[1].element=c(b[1]);this.panel1[0].style.minWidth="";this.panel1[0].style.maxWidth="";this.panel2[0].style.minWidth="";this.panel2[0].style.maxWidth="";c.each(this.panels,
function(){void 0==this.min&&(this.min=0);void 0==this.size&&(this.size=0);0>this.size&&(this.size=0);0>this.min&&(this.min=0);void 0==this.collapsible&&(this.collapsible=!0);void 0==this.collapsed&&(this.collapsed=!1);0!=this.size&&(-1!=this.size.toString().indexOf("px")&&(this.size=parseInt(this.size)),-1==this.size.toString().indexOf("%")?parseInt(this.min)>parseInt(this.size)&&(this.min=this.size):-1!=this.min.toString().indexOf("%")&&parseInt(this.min)>parseInt(this.size)&&(this.min=this.size))})},
_arrange:function(){if(null!=this.width){var b=this.width;"string"!=typeof b&&(b=parseInt(this.width)+"px");this.host.css("width",b)}null!=this.height&&(b=this.height,"string"!=typeof b&&(b=parseInt(this.height)+"px"),this.host.css("height",b));this._splitBarSize=this._isTouchDevice?this.touchSplitBarSize:this.splitBarSize;this.showSplitBar||(this._splitBarSize=0,this.splitBar.hide());b="horizontal"==this.orientation?"width":"height";this.splitBar.css(b,"100%");this.panel1.css(b,"100%");this.panel2.css(b,
"100%");"horizontal"==this.orientation?this.splitBar.height(this._splitBarSize):this.splitBar.width(this._splitBarSize);"vertical"===this.orientation?(this.splitBarButton.width(this._splitBarSize),this.splitBarButton.height(45)):(this.splitBarButton.height(this._splitBarSize),this.splitBarButton.width(45));this.splitBarButton.css("position","relative");"vertical"===this.orientation?(this.splitBarButton.css("top","50%"),this.splitBarButton.css("left","0"),this.splitBarButton.css("margin-top","-23px"),
this.splitBarButton.css("margin-left","-0px")):(this.splitBarButton.css("left","50%"),this.splitBarButton.css("top","0"),this.splitBarButton.css("margin-left","-23px"),this.splitBarButton.css("margin-top","-0px"));this._layoutPanels()},collapse:function(){if(!this.disabled){var b=-1;this.panels[0].collapsed=this.panels[1].collapsed=!1;this.panels[0].element[0].style.visibility="inherit";this.panels[1].element[0].style.visibility="inherit";this.panels[0].collapsible?b=0:this.panels[1].collapsible&&
(b=1);-1!=b&&(this.panels[b].collapsed=!0,this.panels[b].element[0].style.visibility="hidden",this.splitBar.addClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed")),this._layoutPanels(),this._raiseEvent(2,{index:b,panels:this.panels}),this._raiseEvent(0,{panels:this.panels}))}},expand:function(){if(!this.disabled){var b=-1;this.panels[0].collapsed=this.panels[1].collapsed=!1;this.panels[0].element[0].style.visibility="inherit";this.panels[1].element[0].style.visibility="inherit";this.panels[0].collapsible?
b=0:this.panels[1].collapsible&&(b=1);-1!=b&&(this.panels[b].collapsed=!1,this.panels[b].element[0].style.visibility="inherit",this.splitBar.removeClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed")),this._layoutPanels(),this._raiseEvent(1,{index:b,panels:this.panels}),this._raiseEvent(0,{panels:this.panels}))}},disable:function(){this.disabled=!0;this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));this.splitBar.addClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed"));
this.splitBarButton.addClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed"))},enable:function(){this.disabled=!1;this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled"));this.splitBar.removeClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed"));this.splitBarButton.removeClass(this.toThemeProperty("jqx-splitter-splitbar-collapsed"))},refresh:function(b){1!=b&&this._arrange()},propertyChangedHandler:function(b,d,e,f){"panels"===d||"orientation"===d||"showSplitBar"===d?
b.render():("touchMode"===d&&(b._isTouchDevice=f),"disabled"===d?f?b.disable():b.enable():"theme"===d?c.jqx.utilities.setTheme(e,f,b.host):b.refresh())},_layoutPanels:function(){var b="horizontal"==this.orientation?"height":"width",d="horizontal"==this.orientation?"top":"left",e,c,g,h,l=parseInt(this._splitBarSize)+2;this.showSplitBar||(l=0);var q=this.host[b](),r=q/100,t=1/r,v=t*l,y=this.panel1,A=this.panel2,w=this.panels[0].size;this.panels[0].collapsed&&(g=!0);this.panels[1].collapsed&&(h=!0);
e=this.panels[0].min;c=this.panels[1].min;-1!=c.toString().indexOf("%")&&(c=parseFloat(c)*r);-1!=e.toString().indexOf("%")&&(e=parseFloat(e)*r);this._isNested&&this._isTouchDevice&&("horizontal"==this.orientation?(y.width(this.host.width()),A.width(this.host.width())):(y.height(this.host.height()),A.height(this.host.height())));if(g)e=Math.max(c,q-l),y[b](0),A[b](e);else if(h)e=Math.max(e,q-l),A[b](0),y[b](e);else if(-1!=w.toString().indexOf("%"))g=100-parseFloat(w),y.css(b,parseFloat(w)+"%"),A.css(b,
g-v+"%"),g=A[b](),g<c&&(c=(g-c)*t,w=parseFloat(w)+parseFloat(c),g=100-parseFloat(w),y.css(b,parseFloat(w)+"%"),A.css(b,g-v+"%")),y[b]()<e&&y.css(b,parseFloat(e*t)+"%");else{g=q-w-l;if(y[0].style[b]!=w+"px")y[b](w);if(A[0].style[b]!=g+"px")A[b](g);g<c&&(w+=g-c,A[b](c),y[b](w));if(w<e)y[b](e)}b=this.panel1[b]();this.splitBar[0].style[d]!=b+"px"&&("vertical"==this.orientation?(this.splitBar[0].style.borderLeftColor="",this.splitBar[0].style.borderRightColor="",this.splitBarButton[0].style.width=parseInt(this._splitBarSize)+
"px",this.splitBarButton[0].style.left="0px"):(this.splitBar[0].style.borderTopColor="",this.splitBar[0].style.borderBottomColor="",this.splitBarButton[0].style.height=parseInt(this._splitBarSize)+"px",this.splitBarButton[0].style.top="0px"),this._hasBorder&&(q-l==b?"vertical"==this.orientation?(this.splitBar[0].style.borderRightColor="transparent",this.splitBarButton[0].style.width=parseInt(this._splitBarSize+1)+"px"):(this.splitBar[0].style.borderBottomColor="transparent",this.splitBarButton[0].style.height=
parseInt(this._splitBarSize+1)+"px"):0==b&&("vertical"==this.orientation?(this.splitBar[0].style.borderLeftColor="transparent",this.splitBarButton[0].style.width=parseInt(this._splitBarSize+1)+"px",this.splitBarButton[0].style.left="-1px"):(this.splitBar[0].style.borderTopColor="transparent",this.splitBarButton[0].style.height=parseInt(this._splitBarSize+1)+"px",this.splitBarButton[0].style.top="-1px"))),this.splitBar[0].style[d]=b+"px");this.panel2[0].style[d]!=b+l+"px"&&(this.panel2[0].style[d]=
b+l+"px");this._raiseEvent(4,{panels:this.panels})},destroy:function(){this._removeHandlers();c.jqx.utilities.resize(this.host,null,!0);this.host.remove()},_raiseEvent:function(b,d){var e=new c.Event(this._events[b]);e.owner=this;e.args=d;var f=[{},{}];f[0].size="vertical"==this.orientation?this.panel1[0].offsetWidth:this.panel1[0].offsetHeight;f[1].size="vertical"==this.orientation?this.panel2[0].offsetWidth:this.panel2[0].offsetHeight;f[0].min=this.panels[0].min;f[1].min=this.panels[1].min;f[0].collapsible=
this.panels[0].collapsible;f[1].collapsible=this.panels[1].collapsible;f[0].collapsed=this.panels[0].collapsed;f[1].collapsed=this.panels[1].collapsed;e.args.panels=f;return this.host.trigger(e)}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxTabs","",{});c.extend(c.jqx._jqxTabs.prototype,{defineInstance:function(){var b={scrollAnimationDuration:200,enabledHover:!0,disabled:!1,collapsible:!1,animationType:"none",enableScrollAnimation:!0,contentTransitionDuration:450,toggleMode:"click",selectedItem:0,height:"auto",width:"auto",position:"top",selectionTracker:!1,scrollable:!0,scrollPosition:"right",scrollStep:70,autoHeight:!0,headerHeight:null,showCloseButtons:!1,canCloseAllTabs:!0,closeButtonSize:16,arrowButtonSize:16,
keyboardNavigation:!0,reorder:!1,selectionTrackerAnimationDuration:300,_isTouchDevice:!1,roundedCorners:!0,_headerExpandingBalance:0,_dragStarted:!1,_tabCaptured:!1,_lastUnorderedListPosition:0,_selectedItem:0,_titleList:[],_contentList:[],_contentWrapper:null,_unorderedList:null,_scrollTimeout:null,isCollapsed:!1,touchMode:!1,initTabContent:null,enableDropAnimation:!1,_currentEvent:null,_needScroll:!0,_isAnimated:{},_events:"created selected add removed enabled disabled selecting unselecting unselected dragStart dragEnd locked unlocked collapsed expanded tabclick".split(" "),
_initTabContentList:[],_invalidArgumentExceptions:{invalidScrollAnimationDuration:"The scroll animation duration is not valid!",invalidWidth:"Width you've entered is invalid!",invalidHeight:"Height you've entered is invalid!",invalidAnimationType:"You've entered invalid animation type!",invalidcontentTransitionDuration:"You've entered invalid value for contentTransitionDuration!",invalidToggleMode:"You've entered invalid value for toggleMode!",invalidPosition:"You've entered invalid position!",invalidScrollPosition:"You've entered invalid scroll position!",
invalidScrollStep:"You've entered invalid scroll step!",invalidStructure:"Invalid structure!",invalidArrowSize:"Invalid scroll button size!",invalidCloseSize:"Invalid close button size!"},aria:{"aria-disabled":{name:"disabled",type:"boolean"}},rtl:!1};if(this===c.jqx._jqxTabs.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(){this._IE8=c.jqx.browser.msie&&9>c.jqx.browser.version;c.jqx.aria(this);this.element.className+=" "+this.toThemeProperty("jqx-tabs jqx-widget jqx-widget-content");
this.element.setAttribute("role","tablist");for(var b=this.host.children(),d=0;d<b.length;d++){var e=b[d];"ul"===e.nodeName.toLowerCase()?this._unorderedList=e:"div"===e.nodeName.toLowerCase()&&this._contentList.push(e)}this._unorderedListHelper=c(this._unorderedList);this._unorderedListHelper.initAnimate&&this._unorderedListHelper.initAnimate();this._closeButtonList=[];this._selectedItem=this.selectedItem;this._isTouchDevice=c.jqx.mobile.isTouchDevice();this._needScroll=this.scrollable;this.selectionTracker&&
(this.selectionTracker=this._seletionTrackerBrowserCheck());this._isTouchDevice&&(this.keyboardNavigation=this.reorder=!1);this._titleList=this._unorderedListHelper.children();for(b=this._titleList.length;b;)b--,this._titleList[b].setAttribute("role","tab"),this._titleList[b].getAttribute("id")||this._titleList[b].setAttribute("id",this.element.id+"Tab"+b),this._contentList[b].setAttribute("role","tabpanel");this._validateProperties();this._refresh();this._moveSelectionTrack(this._selectedItem,0);
this.disabled&&this.disable();this.element.tabIndex=0;this._raiseEvent(0);this._enableWindowResize()},_hiddenParent:function(){if("none"===this.host.css("display"))return!0;var b=!1;c.each(this.host.parents(),function(){if("none"===c(this).css("display"))return b=!0,!1});return b},_enableWindowResize:function(){var b=this,d=c.jqx.isHidden(b.host);c.jqx.utilities.resize(this.host,function(){d?(b._uiRefresh(!0),d=!1):b.refresh();b._refreshBarPosition()})},resize:function(b,d){this.width=b;this.height=
d;c.jqx.isHidden(this.host)?this._uiRefresh(!0):this.refresh()},refresh:function(b){!0===b&&void 0!==b||this._setSize()},_seletionTrackerBrowserCheck:function(){var b="Browser CodeName: "+navigator.appCodeName+"",b=b+("Browser Name: "+navigator.appName+""),b=b+("Browser Version: "+navigator.appVersion+""),b=b+("Platform: "+navigator.platform+""),b=b+("User-agent header: "+navigator.userAgent+"");return-1!==b.indexOf("IEMobile")||-1!==b.indexOf("Windows Phone OS")||c.jqx.browser.msie&&7>=c.jqx.browser.version?
!1:!0},render:function(){this._refresh()},_uiRefresh:function(b){this._unorderedListLeftBackup=this._unorderedListHelper.css("left");b&&this._render();this._addStyles();this._performLayout();this._prepareTabs();this._removeEventHandlers();this._addEventHandlers();"auto"===this._unorderedListLeftBackup&&(this._unorderedListLeftBackup=this._getArrowsDisplacement());this._unorderedList.style.left=this._toPx(this._unorderedListLeftBackup);this.rtl&&this.scrollable&&this._rightArrow&&"hidden"!==c(this._rightArrow).css("visibility")&&
(b=2*this.arrowButtonSize,b=this._width(this.element)-parseInt(this._width(this._unorderedList)+b+parseInt(this._unorderedListHelper.css("margin-left"),10),10),this._unorderedList.style.left=b+"px");var d=this;setTimeout(function(){d._performLayout()},100)},_refresh:function(){c.jqx.isHidden(this.host)||(this._uiRefresh(!0),this.host.addClass("jqx-tabs-header-position-"+this.position))},_addStyles:function(){this._unorderedList.className+=" "+this.toThemeProperty("jqx-tabs-title-container");this._unorderedList.style.outline=
"none";this._unorderedList.style.whiteSpace="nowrap";this._unorderedList.style.marginTop="0px";this._unorderedList.style.marginBottom="0px";this._unorderedList.style.padding="0px";this._unorderedList.style.background="transparent";this._unorderedList.style.border="none";this._unorderedList.style.borderStyle="none";this._unorderedList.style.textIndent="0px";for(var b=this.length();b;){b--;var d=this._titleList[b],e="jqx-tabs-title jqx-item";d.style.padding="";"bottom"===this.position&&(e+=" jqx-tabs-title-bottom");
d.disabled&&(e+=" jqx-tabs-title-disable jqx-fill-state-disabled");switch(this.position){case "top":e+=" jqx-rc-t";this._removeClass(this._contentList[b],this.toThemeProperty("jqx-rc-t"));this._contentList[b].className+=" "+this.toThemeProperty("jqx-rc-b");break;case "bottom":e+=" jqx-rc-b",this._removeClass(this._contentList[b],this.toThemeProperty("jqx-rc-b")),this._contentList[b].className+=" "+this.toThemeProperty("jqx-rc-t")}d.className="jqx-reset jqx-disableselect "+this.toThemeProperty(e)}if(this.selectionTracker)switch(this.position){case "top":this._removeClass(this._selectionTracker,
this.toThemeProperty("jqx-rc-b"));this._selectionTracker.className+=" "+this.toThemeProperty("jqx-rc-t");break;case "bottom":this._removeClass(this._selectionTracker,this.toThemeProperty("jqx-rc-t")),this._selectionTracker.className+=" "+this.toThemeProperty("jqx-rc-b")}},_raiseEvent:function(b,d){var e=new c.Event(this._events[b]);e.owner=this;e.args=d;if(6===b||7===b)e.cancel=!1,this._currentEvent=e;var f="";try{if(f=this.host.trigger(e),1===b){var g=this;if(this.selectionTracker||"none"!==this.animationType)setTimeout(function(){!g._initTabContentList[g.selectedItem]&&
g.initTabContent&&(g.initTabContent(g.selectedItem),g._initTabContentList[g.selectedItem]=!0);var b=new c.Event("loadContent");b.owner=this;0<g._contentList.length&&g._contentList[g.selectedItem]&&c(g._contentList[g.selectedItem]).trigger(b)},50+g.selectionTrackerAnimationDuration);else{var h=new c.Event("loadContent");!g._initTabContentList[g.selectedItem]&&g.initTabContent&&(g.initTabContent(g.selectedItem),g._initTabContentList[g.selectedItem]=!0);h.owner=this;var l=new c.Event("resize");this.host.trigger(l)}}}catch(q){q&&
console&&console.log(q)}return f},_getArrowsDisplacement:function(){if(!this._needScroll)return 0;var b=this.arrowButtonSize,d=this.arrowButtonSize;return"left"===this.scrollPosition?b+d:"both"===this.scrollPosition?b:0},_scrollRight:function(b){this._stop(this._unorderedListHelper);this._unlockAnimation("unorderedList");var d=parseInt(this._width(this._unorderedList)+parseInt(this._unorderedListHelper.css("margin-left"),10),10),e=this._width(this.element),f,g,h=parseInt(this._unorderedListHelper.css("left"),
10),l=this._getArrowsDisplacement(),q;this.scrollable?(f=this._leftArrow.offsetWidth,g=this._rightArrow.offsetWidth):g=f=0;b=this.enableScrollAnimation?b:0;this._width(this._headerWrapper)>parseInt(this._unorderedListHelper.css("margin-left"),10)+this._width(this._unorderedList)||(Math.abs(h)+this.scrollStep<Math.abs(e-d)+f+g+l?(l=h-this.scrollStep,q=h-this.scrollStep+parseInt(c(this._titleList[this._selectedItem]).position().left,10)):(l=e-d-(2*this.arrowButtonSize-l),l<parseInt(this._unorderedListHelper.css("left"),
10)-4&&l>parseInt(this._unorderedListHelper.css("left"),10)+4&&(q=e-d-f-g+parseInt(c(this._titleList[this._selectedItem]).position().left,10))));this._performScrollAnimation(l,q,b)},_scrollLeft:function(b){this._stop(this._unorderedListHelper);this._unlockAnimation("unorderedList");var d=parseInt(this._unorderedListHelper.css("left"),10),e=this._getArrowsDisplacement(),f;b=this.enableScrollAnimation?b:0;this._width(this._headerWrapper)>=this._width(this._unorderedList)||(d+this.scrollStep<e?(e=d+
this.scrollStep,f=d+this.scrollStep+parseInt(c(this._titleList[this._selectedItem]).position().left,10)):e<parseInt(this._unorderedListHelper.css("left"),10)-4&&e>parseInt(this._unorderedListHelper.css("left"),10)+4&&(f=parseInt(c(this._titleList[this._selectedItem]).position().left,10)));this._performScrollAnimation(e,f,b)},_performScrollAnimation:function(b,d,e){var c=this;void 0!==d&&this._moveSelectionTrack(this._selectedItem,0,d);this._lockAnimation("unorderedList");c._refreshBarPosition();this._unorderedListHelper.animate({left:b},
e,function(){c._moveSelectionTrack(c.selectedItem,0);c._unlockAnimation("unorderedList");c._refreshBarPosition()})},_addKeyboardHandlers:function(){var b=this;this.keyboardNavigation&&this.addHandler(this.host,"keydown",function(d){if(!b._activeAnimation()){var e=b.selectionTracker,f=b.getContentAt(b._selectedItem);if(c(d.target).ischildof(f)||c(document.activeElement).ischildof(c(f)))return!0;switch(d.keyCode){case 37:return b.rtl?b.next():b.previous(),!1;case 39:return b.rtl?b.previous():b.next(),
!1;case 36:return b.first(),!1;case 35:return b.last(),!1;case 27:b._tabCaptured&&(b._cancelClick=!0,b._uncapture(null,b.selectedItem),b._tabCaptured=!1)}b.selectionTracker=e}return!0})},_addScrollHandlers:function(){var b=this;this.addHandler(this._leftArrow,"mousedown",function(){b._startScrollRepeat(!0,b.scrollAnimationDuration)});this.addHandler(this._rightArrow,"mousedown",function(){b._startScrollRepeat(!1,b.scrollAnimationDuration)});this.addHandler(this._rightArrow,"mouseleave",function(){clearTimeout(b._scrollTimeout)});
this.addHandler(this._leftArrow,"mouseleave",function(){clearTimeout(b._scrollTimeout)});this.addHandler(c(document),"mouseup.tab"+this.element.id,this._mouseUpScrollDocumentHandler,this);this.addHandler(c(document),"mouseleave.tab"+this.element.id,this._mouseLeaveScrollDocumentHandler,this)},_mouseLeaveScrollDocumentHandler:function(b){b=b.data;b._scrollTimeout&&clearTimeout(b._scrollTimeout)},_mouseUpScrollDocumentHandler:function(b){clearTimeout(b.data._scrollTimeout)},_mouseUpDragDocumentHandler:function(b){var d=
b.data;d._tabCaptured&&d._dragStarted&&d._uncapture(b);d._tabCaptured=!1},_addReorderHandlers:function(){this.addHandler(c(document),"mousemove.tab"+this.element.id,this._moveElement,this);this.addHandler(c(document),"mouseup.tab"+this.element.id,this._mouseUpDragDocumentHandler,this)},_addEventHandlers:function(){for(var b=this.length();b;)b--,this._addEventListenerAt(b);this.keyboardNavigation&&this._addKeyboardHandlers();this.scrollable&&this._addScrollHandlers();this.reorder&&!this._isTouchDevice&&
this._addReorderHandlers();var d=this;try{if((""!==document.referrer||window.frameElement)&&null!==window.top&&window.top!==window.self){var b=function(){d._tabCaptured&&(d._cancelClick=!0,d._uncapture(null,d.selectedItem),d._tabCaptured=!1)},e=null;window.parent&&document.referrer&&(e=document.referrer);e&&-1!==e.indexOf(document.location.host)&&window.top.document&&this.addHandler(c(window.top.document),"mouseup.tabs"+this.element.id,b)}}catch(f){}},focus:function(){try{this.host.focus();var b=
this;setTimeout(function(){b.host.focus()},25)}catch(d){}},_getFocusedItem:function(b){for(var d=this.length();d;){d--;var e=this._titleList[d],f=this._outerWidth(e,!0),g=parseInt(c(e).offset().left,10);if(g<=b&&g+f>=b&&e!==this._capturedElement&&!this._titleList[d].locked&&!0!==this._titleList[d].disabled)return d}return-1},_uncapture:function(b){var d=this.selectionTracker;this._unorderedListLeftBackup=this._unorderedListHelper.css("left");this._tabCaptured=this._dragStarted=!1;var e=this._indexOf(this._capturedElement);
if(this._capturedElement){switch(this.position){case "top":this._capturedElement.style.bottom="0px";break;case "bottom":this._capturedElement.style.top="0px"}var c;b&&(c=this._getFocusedItem(b.clientX));-1!==c&&b?(this._raiseEvent(10,{item:e,dropIndex:c}),this._reorderItems(c,e)):this._capturedElement.style.left="0px";for(var g=0;g<this._titleList.length;g++)this._titleList[g].style.position="static";this._reorderHeaderElements();this._unorderedList.style.position="relative";this._unorderedList.style.top=
"0px";this._prepareTabs();-1!==c&&b?this._moveSelectionTrack(this._selectedItem,0):(this._selectedItem=e,this._moveSelectionTrack(e,0));this._addSelectStyle(this._selectedItem,!0);document.selection&&document.selection.clear();this._unorderedList.style.left=this._toPx(this._unorderedListLeftBackup);this.selectionTracker=d}},_reorderItems:function(b,d){var e=this._titleList[this.selectedItem],f=this._titleList[d];"undefined"===typeof this._capturedElement&&(this._capturedElement=f);c(f).remove();d<
b?this._titleList[b+1]?this._unorderedList.insertBefore(f,this._titleList[b+1]):this._unorderedList.appendChild(f):this._unorderedList.insertBefore(f,this._titleList[b]);this._reorderElementArrays(b,d);this._getSelectedItem(e);this._removeEventHandlers();this._addEventHandlers()},_reorderElementArrays:function(b,d){var e=this._contentList[d];if(d<b)for(var c=d;c<=b;c++)this._titleList[c]=this._titleList[c+1],this._contentList[c]=this._contentList[c+1];else for(c=d;c>=b;c--)this._titleList[c]=this._titleList[c-
1],this._contentList[c]=this._contentList[c-1];this._contentList[b]=e;this._titleList[b]=this._capturedElement},getSelectedItem:function(){return this.selectedItem},_getSelectedItem:function(b){for(var d=this.length();d;)if(d--,this._titleList[d]===b){this._selectedItem=this.selectedItem=d;break}},_moveElement:function(b){var d=b.data;if(d._tabCaptured)if(document.selection&&document.selection.clear(),d._dragStarted)d._performDrag(b),clearTimeout(d._scrollTimeout);else{var e=-parseInt(d._unorderedListHelper.css("left"),
10);if(b.clientX+e>d._startX+3||b.clientX+e<d._startX-3)d._prepareTabForDragging(),d._dragStarted=!0}},_performDrag:function(b){var d=this.getZoomFactor(),e=-parseInt(this._unorderedListHelper.css("left"),10);this._capturedElement.style.left=this._toPx(e+b.clientX/d-this._startX/d);this._lastX=b.clientX/d;this._moveSelectionTrack(this.selectedItem,0)},getZoomFactor:function(){var b=1;document.body.getBoundingClientRect&&(b=document.body.getBoundingClientRect(),b=Math.round((b.right-b.left)/document.body.offsetWidth*
100)/100);return b},_prepareTabForDragging:function(){this._capturedElement.style.position="relative";this._capturedElement.style.left="0px";this._capturedElement.style.top="0px";this._capturedElement.style.zIndex=300;this.selectedItem=this._indexOf(this._capturedElement);switch(this.position){case "top":this._capturedElement.style.bottom=this._toPx(c(this._capturedElement).css("top"));break;case "bottom":this._capturedElement.style.top=this._toPx(c(this._capturedElement).css("top"))}this._raiseEvent(9,
{item:this._indexOf(this._capturedElement)})},_dragScroll:function(b){var d=parseInt(this._unorderedListHelper.css("left"),10),e=this,f=c(e._headerWrapper);b.clientX<=f.offset().left?(this._scrollLeft(this.scrollAnimationDuration),this._capturedElement.style.left=parseInt(c(this._capturedElement).css("left"),10)+this._lastUnorderedListPosition-d):b.clientX>f.offset().left+e._width(this._headerWrapper)?(this._scrollRight(this.scrollAnimationDuration),this._capturedElement.style.left=parseInt(c(this._capturedElement).css("left"),
10)+this._lastUnorderedListPosition-d):(e._stop(e._unorderedListHelper),this._unlockAnimation("unorderedList"),clearTimeout(this._scrollTimeout));this._scrollTimeout=setTimeout(function(){e._dragScroll(b)},this.scrollAnimationDuration);this._lastUnorderedListPosition=d},_captureElement:function(b,d){this._tabCaptured||this._titleList[d].locked||!0===this._titleList[d].disabled||this._activeAnimation()||(this._startX=-parseInt(this._unorderedListHelper.css("left"),10)+b.clientX,this._startY=b.clientY,
this._lastX=b.clientX,this._lastY=b.clientY,this._tabCaptured=!0,this._capturedElement=this._titleList[d])},_titleInteractionTrigger:function(b){0<this._headerExpandingBalance&&this._removeOppositeBorder();this._selectedItem!==b?(this.select(this._titleList[b],"toggle"),this._titleList[b].collapsed=!1,this.collapsible||("auto"!==this.height?this._contentWrapper.style.visibility="visible":this._contentWrapper.style.display="block")):this.collapsible&&(this.isCollapsed?this.expand():this.collapse())},
collapse:function(){var b=this._selectedItem;this.isCollapsed=!0;"auto"!==this.height?this._contentWrapper.style.visibility="hidden":this._contentWrapper.style.display="none";this._raiseEvent(13,{item:b});"top"===this.position?(this._headerWrapper.className+=" "+this.toThemeProperty("jqx-tabs-header-collapsed"),this.element.className+=" "+this.toThemeProperty("jqx-tabs-collapsed")):(this._headerWrapper.className+=" "+this.toThemeProperty("jqx-tabs-header-collapsed-bottom"),this.element.className+=
" "+this.toThemeProperty("jqx-tabs-collapsed-bottom"))},expand:function(){var b=this._selectedItem;this.isCollapsed=!1;this._select(b,this.contentTransitionDuration,null,!1,!0);"auto"!==this.height?this._contentWrapper.style.visibility="visible":this._contentWrapper.style.display="block";this._raiseEvent(14,{item:b});"top"===this.position?(this._removeClass(this._headerWrapper,this.toThemeProperty("jqx-tabs-header-collapsed")),this._removeClass(this.element,this.toThemeProperty("jqx-tabs-collapsed"))):
(this._removeClass(this._headerWrapper,this.toThemeProperty("jqx-tabs-header-collapsed-bottom")),this._removeClass(this.element,this.toThemeProperty("jqx-tabs-collapsed-bottom")))},_addSelectHandler:function(b){var d=this;this.addHandler(this._titleList[b],"selectstart",function(){return!1});this.addHandler(this._titleList[b],this.toggleMode,function(b){return function(){d._raiseEvent("15",{item:b});d._tabCaptured||d._cancelClick||d._titleInteractionTrigger(b);return!0}}(b))},_addDragDropHandlers:function(b){var d=
this;this.addHandler(this._titleList[b],"mousedown",function(e){d._captureElement(e,b)});this.addHandler(this._titleList[b],"mouseup",function(e){d._tabCaptured&&d._dragStarted?(d._cancelClick=!0,d._uncapture(e,b)):d._cancelClick=!1;return d._tabCaptured=!1})},_removeHoverStates:function(){var b=this;c.each(this._titleList,function(){b._removeClass(this,b.toThemeProperty("jqx-tabs-title-hover-top jqx-tabs-title-hover-bottom"))})},_addHoverHandlers:function(b){var d=this,e=this._titleList[b];this.addHandler(e,
"mouseenter mouseleave",function(c){if(b!==d._selectedItem){var g="jqx-fill-state-hover",g="top"===d.position?g+" jqx-tabs-title-hover-top":g+" jqx-tabs-title-hover-bottom";"mouseenter"===c.type?e.className+=" "+d.toThemeProperty(g):d._removeClass(e,d.toThemeProperty(g));d.showCloseButtons&&(g=d._closeButtonList[b],"mouseenter"===c.type?g.className+=" "+d.toThemeProperty("jqx-tabs-close-button-hover",!0):d._removeClass(g,d.toThemeProperty("jqx-tabs-close-button-hover",!0)))}})},_addEventListenerAt:function(b){var d=
this;if(!this._titleList[b].disabled){this.reorder&&!this._isTouchDevice&&this._addDragDropHandlers(b);this._addSelectHandler(b);this.enabledHover&&this._addHoverHandlers(b);var e=d._closeButtonList[b];this.removeHandler(e,"click");this.addHandler(e,"click",function(){d.removeAt(b);return!1})}},_removeEventHandlers:function(){for(var b=this.length();b;)b--,this._removeEventListenerAt(b);this.scrollable&&(this.removeHandler(this._leftArrow,"mousedown"),this.removeHandler(this._rightArrow,"mousedown"));
this.removeHandler(c(document),"mousemove.tab"+this.element.id,this._moveElement);this.removeHandler(c(document),"mouseup.tab"+this.element.id,this._mouseUpScrollDocumentHandler);this.removeHandler(c(document),"mouseup.tab"+this.element.id,this._mouseUpDragDocumentHandler);this.removeHandler(this.host,"keydown")},_removeEventListenerAt:function(b){this.removeHandler(this._titleList[b],this.toggleMode);this.removeHandler(this._titleList[b],"mouseenter");this.removeHandler(this._titleList[b],"mouseleave");
this.removeHandler(this._titleList[b],"mousedown");this.removeHandler(this._titleList[b],"mouseup");this.removeHandler(this._closeButtonList[b],"click")},_moveSelectionTrack:function(b,d,e){var f=this;if(-1!==b&&0!==this._titleList.length&&!(b>=this._titleList.length)){var g=this._titleList[b],h=c(g);f._refreshBarPosition();if(this.selectionTracker&&this._selectionTracker){f._stop(f._selectionTrackerHelper);this._unlockAnimation("selectionTracker");void 0===e&&(e=parseInt(h.position().left,10),isNaN(parseInt(this._unorderedListHelper.css("left"),
10))||(e+=parseInt(this._unorderedListHelper.css("left"),10)),isNaN(parseInt(this._unorderedListHelper.css("margin-left"),10))||(e+=parseInt(this._unorderedListHelper.css("margin-left"),10)),isNaN(parseInt(h.css("margin-left"),10))||(e+=parseInt(h.css("margin-left"),10)),isNaN(parseInt(h.css("margin-right"),10)));var l=0;"top"===this.position&&(this._height(f._headerWrapper),this.autoHeight||(l+=parseInt(h.css("margin-top"),10)));this._lockAnimation("selectionTracker");var l=parseInt(h.css("padding-left"),
10)+parseInt(h.css("padding-right"),10),q="top"===this.position?0:1,r=parseInt(c(this._headerWrapper).css("padding-top"),10),t=parseInt(h.css("padding-top"),10)+parseInt(h.css("padding-bottom"),10);this._selectionTracker.style.visibility="visible";this._moveSelectionTrackerContainer.style.visibility="visible";h=parseInt(h.css("margin-top"),10);isNaN(h)&&(h=0);f._refreshBarPosition();f._selectionTrackerHelper.animate({top:r+h-q,left:e+"px",height:parseInt(this._height(g)+t,10),width:f._width(g)+l},
d,function(){f._unlockAnimation("selectionTracker");f._selectionTracker.style.visibility="hidden";f._addSelectStyle(b,!0);f._moveSelectionTrackerContainer.style.visibility="hidden"})}}},destroy:function(){c.jqx.utilities.resize(this.host,null,!0);(""!=document.referrer||window.frameElement)&&null!=window.top&&window.top!=window.self&&this.removeHandler(c(window.top.document),"mouseup.tabs"+this.element.id);this.host.remove()},_switchTabs:function(b,d){if(b!==d&&!this._activeAnimation()&&!this._tabCaptured){this._raiseEvent(7,
{item:d});this._raiseEvent(6,{item:b});if(this._currentEvent&&this._currentEvent.cancel){this._currentEvent=null;return}this._unselect(d,null,!0);this._select(b,this.contentTransitionDuration,null,!0);return!0}return!1},_activeAnimation:function(){for(var b in this._isAnimated)if(this._isAnimated.hasOwnProperty(b)&&this._isAnimated[b])return!0;return!1},_indexOf:function(b){for(var d=this.length();d;)if(d--,this._titleList[d]===b||this._contentList[d]===b)return d;return-1},_validateProperties:function(){try{if(0>
this.scrollAnimationDuration||isNaN(this.scrollAnimationDuration))throw Error(this._invalidArgumentExceptions.invalidScrollAnimationDuration);if(0>parseInt(this.width,10)&&"auto"!==this.width)throw Error(this._invalidArgumentExceptions.invalidWidth);if(0>parseInt(this.height,10)&&"auto"!==this.height)throw Error(this._invalidArgumentExceptions.invalidHeight);if("none"!==this.animationType&&"fade"!==this.animationType)throw Error(this._invalidArgumentExceptions.invalidAnimationType);if(0>this.contentTransitionDuration||
isNaN(this.contentTransitionDuration))throw Error(this._invalidArgumentExceptions.invalidcontentTransitionDuration);if("click"!==this.toggleMode&&"dblclick"!==this.toggleMode&&"mouseenter"!==this.toggleMode&&"none"!==this.toggleMode)throw Error(this._invalidArgumentExceptions.invalidToggleMode);if("top"!==this.position&&"bottom"!==this.position)throw Error(this._invalidArgumentExceptions.invalidPosition);if("left"!==this.scrollPosition&&"right"!==this.scrollPosition&&"both"!==this.scrollPosition)throw Error(this._invalidArgumentExceptions.invalidScrollPosition);
if(0>this.scrollStep||isNaN(this.scrollStep))throw Error(this._invalidArgumentExceptions.invalidScrollStep);if(this._titleList.length!==this._contentList.length||0===this._titleList.length)throw Error(this._invalidArgumentExceptions.invalidStructure);if(0>this.arrowButtonSize||isNaN(this.arrowButtonSize))throw Error(this._invalidArgumentExceptions.invalidArrowSize);if(0>this.closeButtonSize||isNaN(this.closeButtonSize))throw Error(this._invalidArgumentExceptions.invalidCloseSize);}catch(b){try{console.log(b)}catch(d){}}},
_startScrollRepeat:function(b,d){var e=this;b?this._scrollLeft(d):this._scrollRight(d);this._scrollTimeout&&clearTimeout(this._scrollTimeout);this._scrollTimeout=setTimeout(function(){e._startScrollRepeat(b,e.scrollAnimationDuration)},d)},_performLayout:function(){for(var b=this.length();b;)if(b--,"top"===this.position||"bottom"===this.position)this._titleList[b].style["float"]=this.rtl?"right":"left";this._fitToSize();this._performHeaderLayout();this._fitToSize()},updatetabsheader:function(){this._performHeaderLayout()},
_setSize:function(){this._fitToSize();this._positionArrows(this._totalItemsWidth);this._unorderedList.style.width=this._totalItemsWidth>this.element.offsetWidth?this._toPx(this._totalItemsWidth):this.element.offsetWidth-2+"px";this._fitToSize()},_addArrows:function(){this._leftArrow&&this._rightArrow&&(c(this._leftArrow).remove(),c(this._rightArrow).remove());this._leftArrow=document.createElement("div");this._leftArrow.innerHTML='<span style="display: block; width: 16px; height: 16px;" class="'+
this.toThemeProperty("jqx-tabs-arrow-left")+'"></span>';this._leftArrow.className=this.toThemeProperty("jqx-tabs-arrow-background jqx-widget-header");this._leftArrow.style.zIndex=30;this._leftArrow.style.display="none";this._leftArrow.style.width=this._toPx(this.arrowButtonSize);this._leftArrow.style.height="100%";this._rightArrow=document.createElement("div");this._rightArrow.innerHTML='<span style="display: block; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-tabs-arrow-right")+
'"></span>';this._rightArrow.className=this.toThemeProperty("jqx-tabs-arrow-background jqx-widget-header");this._rightArrow.style.zIndex=30;this._rightArrow.style.display="none";this._rightArrow.style.width=this._toPx(this.arrowButtonSize);this._rightArrow.style.height="100%";this._headerWrapper.appendChild(this._leftArrow);this._headerWrapper.appendChild(this._rightArrow)},_tabsWithVisibleCloseButtons:function(){if(!this.showCloseButtons)return 0;var b=this.length();c.each(this._titleList,function(){var d=
this.attr("hasclosebutton");void 0!==d&&null!==d&&("false"!==d&&!1!==d||b--)});return b},_calculateTitlesSize:function(){function b(b,d){b&&(b.style.display=d?"block":"none")}var d=0,e=0,f=this.length();this.rtl&&c.jqx.browser.msie&&8>c.jqx.browser.version&&(this._measureItem=document.createElement("span"),this._measureItem.style.position="relative",this._measureItem.style.visibility="hidden",document.body.appendChild(this._measureItem));for(;f;){f--;var g=this._titleList[f],h=this._closeButtonList[f];
this._measureItem&&(this._measureItem.innerHTML=g.innerHTML,this._measureItem.html(this._titleList[f].html()),g.style.width=this._toPx(this._width(this._measureItem)));g.style.position="static";b(h,!1);var e=e+this._outerWidth(g,!0),l=this._outerHeight(g,!0);d<l&&(d=l);0===this._height(g)&&(l=g.cloneNode(!0),document.body.appendChild(l),d=this._outerHeight(l,!0),document.body.removeChild(l));var l=g.getAttribute("hasCloseButton"),q;void 0!==l&&null!==l?(q=!1,this.hiddenCloseButtons&&1===this.hiddenCloseButtons[f]&&
(b(h,!1),q=!0),q||("true"===l||!0===l?(e+=this.closeButtonSize,b(h,!0)):"false"!==l&&!1!==l||b(h,!1))):this.showCloseButtons&&(this.canCloseAllTabs||1<this._tabsWithVisibleCloseButtons())&&(q=!1,this.hiddenCloseButtons&&1===this.hiddenCloseButtons[f]&&(b(h,!1),q=!0),q||(e+=this.closeButtonSize,b(h,!0)));g.style.height=this._toPx(this._height(g))}this._measureItem&&c(this._measureItem).remove();return{height:d,width:10+e}},_reorderHeaderElements:function(){this.selectionTracker&&(this._moveSelectionTrackerContainer.style.position=
"absolute",this._moveSelectionTrackerContainer.style.height="100%",this._moveSelectionTrackerContainer.style.top="0px",this._moveSelectionTrackerContainer.style.left="0px",this._moveSelectionTrackerContainer.style.width="100%");this._headerWrapper.style.position="relative";this._headerWrapper.style.left="0px";this._headerWrapper.style.top="0px";if(this.scrollable){this._rightArrow.style.width=this._toPx(this.arrowButtonSize);this._rightArrow.style.position="absolute";this._rightArrow.style.top="0px";
this._leftArrow.style.width=this._toPx(this.arrowButtonSize);this._leftArrow.style.position="absolute";this._leftArrow.style.top="0px";var b=this.theme&&-1!==this.theme.indexOf("ui-")?3:0;0<b&&(this._rightArrow.className+=" "+this.toThemeProperty("jqx-rc-r"),this._leftArrow.className+=" "+this.toThemeProperty("jqx-rc-l"));var d=this.scrollPosition;this.rtl&&("left"===d&&(d="right"),"right"===d&&(d="left"));switch(d){case "both":this._rightArrow.style.right="0px";this._leftArrow.style.left="0px";break;
case "left":this._rightArrow.style.left=this._toPx(this.arrowButtonSize);this._leftArrow.style.left="0px";break;case "right":this._rightArrow.style.right=this._toPx(-b),this._leftArrow.style.right=this._toPx(parseInt(this.arrowButtonSize,10)-b)}}},_positionArrows:function(b){b>=this._headerWrapper.offsetWidth&&this.scrollable?(this._needScroll=!0,0===this._unorderedListHelper.position().left&&(this._unorderedListLeftBackup=this._getArrowsDisplacement()+"px"),this._leftArrow.style.display="block",
this._rightArrow.style.display="block"):(this._needScroll=!1,this._leftArrow.style.display="none",this._rightArrow.style.display="none",this._unorderedList.style.left="0px")},_performHeaderLayout:function(){this._removeSelectStyle();var b=this._calculateTitlesSize(),d=b.height,b=b.width;this._headerWrapper.style.height=this._toPx(d);this._unorderedList.style.height=this._toPx(d);null!==this.headerHeight&&"auto"!==this.headerHeight&&(this._headerWrapper.style.height=this._toPx(this.headerHeight),this._unorderedList.style.height=
this._toPx(this.headerHeight));d=this._width(this.element);this._unorderedList.style.width=b>d?this._toPx(b):this._toPx(d);c.jqx.browser.msie&&8>c.jqx.browser.version&&(this._unorderedList.style.position="relative",this._unorderedList.style.overflow="hidden");this._reorderHeaderElements();this._totalItemsWidth=b+=parseInt(this._unorderedListHelper.css("margin-left"),10);this._positionArrows(b);this._unorderedList.style.position="relative";this._unorderedList.style.top="0px";this._verticalAlignElements();
this._moveSelectionTrack(this._selectedItem,0);this._addSelectStyle(this.selectedItem)},_verticalAlignElements:function(){for(var b=this.length();b;){b--;var d=this._titleList[b],e=c(d),f=e.children()[0],g=this._closeButtonList[b];parseInt(e.css("padding-top"),10);if(this.autoHeight){var h=parseInt(e.css("padding-top"),10),l=parseInt(e.css("padding-bottom"),10),q=e.css("border-top-width"),e=e.css("border-bottom-width"),q=-1===q.indexOf("px")?1:parseInt(q,10),e=-1===e.indexOf("px")?1:parseInt(e,10);
d.style.height=this._toPx(this._outerHeight(this._unorderedList,!0)-(h+l+q+e))}else"top"===this.position?(h=this._height(this._unorderedList)-parseInt(this._outerHeight(d,!0),10),parseInt(e.css("margin-top"),10)!==h&&0!==h&&(d.style.marginTop=this._toPx(h))):d.style.height=this._toPx(this._height(d));f.style.height="100%";d=this._height(d);g&&(e=d/2-this._height(g)/2,g.style.marginTop=this._toPx(1+e));g=d/2-this._height(f)/2;f.style.marginTop=this._toPx(g)}this.scrollable&&(b=(parseInt(this._headerWrapper.offsetHeight,
10)-this.arrowButtonSize)/2,c(this._rightArrow).children()[0].style.marginTop=this._toPx(b),this._rightArrow.style.height="100%",c(this._leftArrow).children()[0].style.marginTop=this._toPx(b),this._leftArrow.style.height="100%")},_getImageUrl:function(b){b=b.css("background-image");b=b.replace('url("',"");b=b.replace('")',"");b=b.replace("url(","");return b=b.replace(")","")},_fitToSize:function(){var b=!1,d=!1;null!==this.width&&-1!==this.width.toString().indexOf("%")&&(b=!0);null!==this.height&&
-1!==this.height.toString().indexOf("%")&&(d=!0);b?(this.element.style.width=this.width,this._contentWrapper.style.width="100%"):(this.element.style.width=this._toPx(this.width),"auto"!==this.width&&(this._contentWrapper.style.width="100%"));d?(this.element.style.height=this.height,this._contentWrapper.style.width="100%",this._contentWrapper.style.height="auto",b=this.element.offsetHeight-this._headerWrapper.offsetHeight-2,this._contentWrapper.style.height=b+"px"):"auto"!==this.height?(this.element.style.height=
this._toPx(this.height),b=this._height(this.element)-this._headerWrapper.offsetHeight,this._contentWrapper.style.height=this._toPx(b)):this._contentWrapper.style.height="auto"},_maxHeightTab:function(){for(var b=this.length(),d=-1;b;)b--,-1<this._outerHeight(this._titleList[b],!0)&&(d=b);return d},_addSelectionTracker:function(){this._moveSelectionTrackerContainer&&c(this._moveSelectionTrackerContainer).remove();this._moveSelectionTrackerContainer=document.createElement("div");this._moveSelectionTrackerContainer.className=
this.toThemeProperty("jqx-tabs-selection-tracker-container");this._selectionTracker=document.createElement("div");this._selectionTracker.className=this.toThemeProperty("jqx-tabs-selection-tracker-"+this.position);this._selectionTracker.style.color="inherit";this._selectionTracker.style.position="absolute";this._selectionTracker.style.zIndex=10;this._selectionTracker.style.left="0px";this._selectionTracker.style.top="0px";this._selectionTracker.style.display="inline-block";this._moveSelectionTrackerContainer.appendChild(this._selectionTracker);
this._headerWrapper.appendChild(this._moveSelectionTrackerContainer);this._selectionTrackerHelper=c(this._selectionTracker);this._selectionTrackerHelper.initAnimate&&this._selectionTrackerHelper.initAnimate()},_addContentWrapper:function(){var b=null===this._contentWrapper;b&&(this._contentWrapper=document.createElement("div"),this._contentWrapper.className=this.toThemeProperty("jqx-tabs-content jqx-widget-content"),this._contentWrapper.style["float"]="none");for(var d=this.length();d;)d--,this._contentList[d].className+=
" "+this.toThemeProperty("jqx-tabs-content-element");if(b)for("top"===this.position?this.element.appendChild(this._contentWrapper):this.element.insertBefore(this._contentWrapper,this.element.firstChild),b=0;b<this._contentList.length;b++)this._contentWrapper.appendChild(this._contentList[b]);this.roundedCorners&&(this._contentWrapper.className="top"===this.position?this._contentWrapper.className+(" "+this.toThemeProperty("jqx-rc-b")):this._contentWrapper.className+(" "+this.toThemeProperty("jqx-rc-t")),
this.element.className+=" "+this.toThemeProperty("jqx-rc-all"))},_addHeaderWrappers:function(){var b=this.length();void 0!==this._headerWrapper&&(c(this._headerWrapper).remove(),this.bar&&(this.bar=null));this._headerWrapper=document.createElement("div");this._headerWrapper.style.outline="none";"top"===this.position?this.element.insertBefore(this._headerWrapper,this.element.firstChild):this.element.appendChild(this._headerWrapper);this._headerWrapper.appendChild(this._unorderedList);var d="jqx-tabs-headerWrapper jqx-tabs-header jqx-widget-header";
"bottom"===this.position&&(d+=" jqx-tabs-header-bottom");this.roundedCorners&&(d="top"===this.position?d+" jqx-rc-t":d+" jqx-rc-b");for(this._headerWrapper.className=this.toThemeProperty(d);b;)if(b--,d=this._titleList[b],null===d.querySelector(".jqx-tabs-titleWrapper")){var e=document.createElement("div");e.className="jqx-tabs-titleWrapper";e.style.outline="none";e.style.position="relative";e.style.zIndex=15;var f=c(d).children();e.appendChild(f[0]);e.appendChild(f[1]);d.appendChild(e)}},_render:function(){this._addCloseButtons();
this._addHeaderWrappers();this._addContentWrapper();this.selectionTracker&&this._addSelectionTracker();this._addArrows()},_addCloseButton:function(b,d){var e=document.createElement("div"),f=this._titleList[b];e.className="jqx-tabs-titleContentWrapper jqx-disableselect";var g="left";this.rtl&&(g="right");0<c(f).find(".jqx-tabs-close-button").length&&c(f).find(".jqx-tabs-close-button").remove();e.style["float"]=g;e.innerHTML=f.innerHTML;f.innerHTML="";var h=document.createElement("div");h.className=
this.toThemeProperty("jqx-tabs-close-button");h.style.height=this._toPx(this.closeButtonSize);h.style.width=this._toPx(this.closeButtonSize);h.style["float"]=g;h.style.fontSize="1px";f.appendChild(e);f.appendChild(h);!0===d?this._closeButtonList[b]=h:this._closeButtonList.splice(b,0,h);this.showCloseButtons?this.hiddenCloseButtons&&1===this.hiddenCloseButtons[b]&&(h.style.display="none"):h.style.display="none"},_addCloseButtons:function(){for(var b=this.length();b;)b--,this._addCloseButton(b,!0)},
_prepareTabs:function(){var b=this.length(),d=this.selectionTracker;for(this.selectionTracker=!1;b;)b--,this._selectedItem!==b&&this._unselect(b,null,!1);this._select(this._selectedItem,0,null,!1);this.selectionTracker=d;!this.initTabContent||this._initTabContentList[this.selectedItem]||this._hiddenParent()||(this.initTabContent(this.selectedItem),this._initTabContentList[this.selectedItem]=!0)},_isValidIndex:function(b){return 0<=b&&b<this.length()},_removeSelectStyle:function(){for(var b=this.length();b;){b--;
var d=this._titleList[b];this.showCloseButtons&&this._removeClass(this._closeButtonList[b],this.toThemeProperty("jqx-tabs-close-button-selected"));var e="jqx-fill-state-pressed",e="top"===this.position?e+" jqx-tabs-title-selected-top":e+" jqx-tabs-title-selected-bottom";this._removeClass(d,this.toThemeProperty(e))}},_addSelectStyle:function(b,d){this._removeSelectStyle();if(!this.selectionTracker||void 0!==d&&d){var e=this._titleList[b];if(0<=b&&void 0!==e){var c=null;this.showCloseButtons&&(c=this._closeButtonList[b],
this.hiddenCloseButtons&&1===this.hiddenCloseButtons[b]&&(c=null));var g="jqx-fill-state-hover",h=" jqx-fill-state-pressed";"top"===this.position?(g+=" jqx-tabs-title-hover-top",h+=" jqx-tabs-title-selected-top"):(g+=" jqx-tabs-title-hover-bottom",h+=" jqx-tabs-title-selected-bottom");this._removeClass(e,this.toThemeProperty(g));e.className+=this.toThemeProperty(h);null!==c&&(c.className+=" "+this.toThemeProperty("jqx-tabs-close-button-selected"))}}},_addItemTo:function(b,d,e){if(d<b.length){for(var c,
g,h=d;h+1<b.length;h++)void 0===c?(c=b[h+1],b[h+1]=b[h]):(g=b[h+1],b[h+1]=c,c=g);void 0===c&&(c=b[d]);b[d]=e;b.push(c)}else b.push(e)},_refreshBarPosition:function(){var b=this;if(!this.bar){var d=c("<span></span>");c(this._headerWrapper).append(d);d.addClass(this.toThemeProperty("jqx-tabs-bar"));this.bar=d}setTimeout(function(){var d=parseInt(b._unorderedListHelper.css("left"),10),f=parseInt(b._unorderedListHelper.css("margin-left"));b.bar.css("left",f+b._titleList[b._selectedItem].offsetLeft+d);
b.bar.width(c(b._titleList[b._selectedItem]).outerWidth()-2)})},_select:function(b,d,e,f,g){if(!this._tabCaptured){this.host.attr("hideFocus","true");var h=this;void 0===g?this._addSelectStyle(b):this._addSelectStyle(b,g);var l=c(h._titleList[b]),q=h._titleList[b].getAttribute("id"),r=c(h._contentList[b]);if(this.isCollapsed&&this.collapsible)r[0].style.display="none",this._selectCallback(b,e,f);else switch(h._refreshBarPosition(),this.animationType){case "none":if(h.selectionTracker)setTimeout(function(){r[0].style.display=
"block";c.jqx.aria(l,"aria-selected",!0);c.jqx.aria(r,"aria-hidden",!1);c.jqx.aria(h,"aria-activedescendant",q)},this.selectionTrackerAnimationDuration);else{for(d=0;d<this._contentList.length;d++)b!==d&&"block"===c(h._contentList[d]).css("display")&&(h._contentList[d].style.display="none",c.jqx.aria(c(h._titleList[d]),"aria-selected",!1),c.jqx.aria(c(h._contentList[d]),"aria-hidden",!0));r[0].style.display="block";c.jqx.aria(l,"aria-selected",!0);c.jqx.aria(r,"aria-hidden",!1);c.jqx.aria(this,"aria-activedescendant",
q)}this._selectCallback(b,e,f);break;case "fade":this._lockAnimation("contentListSelect"),h._selectCallback(b,e,f),r.initAnimate&&void 0===r.fadeIn&&r.initAnimate(),r.fadeIn({duration:1E3,complete:function(){h._unlockAnimation("contentListSelect");c.jqx.aria(l,"aria-selected",!0);c.jqx.aria(r,"aria-hidden",!1);c.jqx.aria(h,"aria-activedescendant",q)}})}}},_selectCallback:function(b,d,e){this.selectedItem=this._selectedItem=b;d&&d();e&&this._raiseEvent(1,{item:b})},_unselect:function(b,d,e){if(0<=
b&&!this._tabCaptured){var f=this._contentList[b],g=c(f),h=this._titleList[b],l=c(h);g.initAnimate&&void 0===g.animate&&g.initAnimate();this._stop(g);"fade"===this.animationType?(f.style.display="none",c.jqx.aria(l,"aria-selected",!1),c.jqx.aria(g,"aria-hidden",!0)):this.selectionTracker?setTimeout(function(){f.style.display="none";c.jqx.aria(l,"aria-selected",!1);c.jqx.aria(g,"aria-hidden",!0)},this.selectionTrackerAnimationDuration):(f.style.display="none",c.jqx.aria(l,"aria-selected",!1),c.jqx.aria(g,
"aria-hidden",!0));this._unselectCallback(b,d,e);this.selectionTracker||this._removeClass(h,this.toThemeProperty("jqx-tabs-title-selected jqx-fill-state-pressed"))}},_unselectCallback:function(b,d,e){e&&this._raiseEvent(8,{item:b});d&&d()},disable:function(){for(var b=this.length();b;)b--,this.disableAt(b)},enable:function(){for(var b=this.length();b;)b--,this.enableAt(b)},getEnabledTabsCount:function(){var b=0;c.each(this._titleList,function(){this.disabled||b++});return b},getDisabledTabsCount:function(){var b=
0;c.each(this._titleList,function(){this.disabled&&b++});return b},removeAt:function(b){if(this._isValidIndex(b)&&(this.canCloseAllTabs||1<this.length())){this._removeHoverStates();var d=this,e=d._outerWidth(this._titleList[b],!0),f=this.getTitleAt(b);this._unorderedList.style.width=d._toPx(d._width(this._unorderedList)-e);c(this._titleList[b]).remove();c(this._contentList[b]).remove();this._titleList.splice(b,1);this._contentList.splice(b,1);d._closeButtonList.splice(b,1);this._addStyles();this._performHeaderLayout();
this._removeEventHandlers();this._addEventHandlers();this._raiseEvent(3,{item:b,title:f});this._isAnimated={};0<this.selectedItem?(this._selectedItem=-1,this.selectedItem>=b?(b=this._getPreviousIndex(this.selectedItem),this.select(b)):this.select(d.selectedItem)):(this._selectedItem=-1,b=this._getNextIndex(this.selectedItem),this.select(b));parseInt(this._unorderedListHelper.css("left"),10)>this._getArrowsDisplacement()&&(this._unorderedList.style.left=d._toPx(this._getArrowsDisplacement()));d._width(this._unorderedList)<=
d._width(this._headerWrapper)&&(b=this.enableScrollAnimation?this.scrollAnimationDuration:0,this._lockAnimation("unorderedList"),this._unorderedListHelper.animate({left:0},b,function(){d._unlockAnimation("unorderedList")}))}},removeFirst:function(){this.removeAt(0)},removeLast:function(){this.removeAt(this.length()-1)},disableAt:function(b){var d=this._titleList[b];d.disabled&&void 0!==d.disabled||(this.selectedItem===b&&(this.next()||this.previous()),d.disabled=!0,this.removeHandler(d,this.toggleMode),
this.enabledHover&&c(d).off("mouseenter").off("mouseleave"),this._removeEventListenerAt(b),d.className+=" "+this.toThemeProperty("jqx-tabs-title-disable jqx-fill-state-disabled"),this._raiseEvent(5,{item:b}))},enableAt:function(b){var d=this._titleList[b];d.disabled&&(d.disabled=!1,this._addEventListenerAt(b),this._removeClass(d,this.toThemeProperty("jqx-tabs-title-disable jqx-fill-state-disabled")),this._raiseEvent(4,{item:b}))},addAt:function(b,d,e){if(0<=b&&b<=this.length()){this._removeHoverStates();
var c=document.createElement("li");c.innerHTML=d;c.className=this.toThemeProperty("jqx-tabs-title jqx-item");d=document.createElement("div");d.innerHTML=e;d.className=this.toThemeProperty("jqx-tabs-content-element");"bottom"===this.position&&(c.className+=" "+this.toThemeProperty("jqx-tabs-title-bottom"));0===this._titleList.length?this._unorderedList.appendChild(c):b<this.length()&&0<=b?this._unorderedList.insertBefore(c,this._titleList[b]):this._unorderedList.appendChild(c);this._contentWrapper.appendChild(d);
this._addItemTo(this._titleList,b,c);this._addItemTo(this._contentList,b,d);this._addCloseButton(b);this._selectedItem>b&&this._selectedItem++;this._switchTabs(b,this._selectedItem);this._selectedItem=b;this._uiRefresh(!1);this._raiseEvent(2,{item:b});this._moveSelectionTrack(this._selectedItem,0)}},addFirst:function(b,d){this.addAt(0,b,d)},addLast:function(b,d){this.addAt(this.length(),b,d)},val:function(b){if(0===arguments.length||"object"===typeof b)return this._selectedItem;this.select(b);return this._selectedItem},
select:function(b){"object"===typeof b&&(b=this._indexOf(b));var d=0<=b&&b<this._titleList.length?this._titleList[b].getAttribute("canselect"):!0;(void 0===d||null===d||"true"===d||!0===d)&&b!==this._selectedItem&&this._isValidIndex(b)&&(this._activeAnimation()||this._titleList[b].disabled||this._switchTabs(b,this._selectedItem)&&this.ensureVisible(b))},previous:function(b){var d=this._selectedItem;for(void 0===b||isNaN(b)||(d=b);0<d&&d<this._titleList.length;)if(d--,!this._titleList[d].disabled)return this.select(d),
!0;return!1},_getPreviousIndex:function(b){if(void 0===b||isNaN(b))return 0;for(var d=b;0<b&&b<=this._titleList.length;)if(b--,!this._titleList[b].disabled)return b;return d},_getNextIndex:function(b){if(void 0===b||isNaN(b))return 0;for(var d=b;0<=b&&b<this._titleList.length;){if(!this._titleList[b].disabled)return b;b++}return d},next:function(b){var d=this._selectedItem;for(void 0===b||isNaN(b)||(d=b);0<=d&&d<this._titleList.length-1;)if(d++,!this._titleList[d].disabled)return this.select(d),!0;
return!1},first:function(){this._titleList[0].disabled?this.next(0):this.select(0)},last:function(){var b=this._titleList.length-1;this._titleList[b].disabled?this.previous(b):this.select(b)},length:function(){return this._titleList.length},lockAt:function(b){!this._isValidIndex(b)||this._titleList[b].locked&&void 0!==this._titleList[b].locked||(this._titleList[b].locked=!0,this._raiseEvent(11,{item:b}))},unlockAt:function(b){this._isValidIndex(b)&&this._titleList[b].locked&&(this._titleList[b].locked=
!1,this._raiseEvent(12,{item:b}))},lockAll:function(){for(var b=this.length();b;)b--,this.lockAt(b)},unlockAll:function(){for(var b=this.length();b;)b--,this.unlockAt(b)},showCloseButtonAt:function(b){this._isValidIndex(b)&&(this.showCloseButtons||(this.showCloseButtons=!0,this.updatetabsheader()),this._closeButtonList[b].style.display="block",this.hiddenCloseButtons||(this.hiddenCloseButtons=[]),this.hiddenCloseButtons[b]=0)},hideCloseButtonAt:function(b){this._isValidIndex(b)&&(this._closeButtonList[b].style.display=
"none",this.hiddenCloseButtons||(this.hiddenCloseButtons=[]),this.hiddenCloseButtons[b]=1)},hideAllCloseButtons:function(){for(var b=this.length();b;)b--,this.hideCloseButtonAt(b)},showAllCloseButtons:function(){for(var b=this.length();b;)b--,this.showCloseButtonAt(b)},getTitleAt:function(b){return this._titleList[b]?c(this._titleList[b]).text():null},getContentAt:function(b){return this._contentList[b]?this._contentList[b]:null},setTitleAt:function(b,d){this._titleList[b]&&(c(this._titleList[b]).text(d),
this.showCloseButtons&&(this._addCloseButton(b),this._removeEventHandlers(),this._addEventHandlers()),this.render(),this.refresh())},setContentAt:function(b,d){this._contentList[b]&&c(this._contentList[b]).html(d)},ensureVisible:function(b){var d=this;if(void 0===b||-1===b||null===b)b=this.selectedItem;if(!this._isValidIndex(b))return!1;var e=this._titleList[b],f=parseInt(c(e).position().left,10)+parseInt(this._unorderedListHelper.css("margin-left"),10),g=parseInt(this._unorderedListHelper.css("left"),
10),h=this._outerWidth(this._headerWrapper,!0),e=this._outerWidth(e,!0),g=g-this._getArrowsDisplacement(),l=h-this._getArrowsDisplacement()-g;if(f<-g)f=-f+this._getArrowsDisplacement(),h=this._getArrowsDisplacement();else if(f+e>l-this._getArrowsDisplacement())f=-f+h-e-(this.scrollable?2*this.arrowButtonSize-this._getArrowsDisplacement():0),h=h-e-this._getArrowsDisplacement();else return this._moveSelectionTrack(b,this.selectionTrackerAnimationDuration),!0;this._lockAnimation("unorderedList");this._unorderedListHelper.animate({left:f},
this.scrollAnimationDuration,function(){d._unlockAnimation("unorderedList");d._moveSelectionTrack(d._selectedItem,0);return!0});this._moveSelectionTrack(b,this.selectionTrackerAnimationDuration,h);return!0},isVisibleAt:function(b){if(void 0===b||-1===b||null===b)b=this.selectedItem;if(!this._isValidIndex(b))return!1;var d=this._titleList[b];b=parseInt(c(d).position().left,10)+parseInt(this._unorderedListHelper.css("margin-left"),10);var e=parseInt(this._unorderedListHelper.css("left"),10),f=this._outerWidth(this._headerWrapper,
!0),d=this._outerWidth(d,!0),e=e-this._getArrowsDisplacement(),f=f-this._getArrowsDisplacement()-e;return b<-e?!1:b+d>f?!1:!0},isDisabled:function(b){return this._titleList[b].disabled},_lockAnimation:function(b){this._isAnimated&&(this._isAnimated[b]=!0)},_unlockAnimation:function(b){this._isAnimated&&(this._isAnimated[b]=!1)},propertiesChangedHandler:function(b,d,e){e&&e.width&&e.height&&2===Object.keys(e).length&&b._setSize()},propertyChangedHandler:function(b,d,e,f){if(!(b.batchUpdate&&b.batchUpdate.width&&
b.batchUpdate.height&&2===Object.keys(b.batchUpdate).length)){this._validateProperties();switch(d){case "touchMode":f&&(b.enabledHover=!1,b.keyboardNavigation=!1);break;case "width":case "height":b._setSize();return;case "disabled":f?this.disable():this.enable();return;case "showCloseButtons":f?this.showAllCloseButtons():this.hideAllCloseButtons();this._performHeaderLayout();return;case "selectedItem":this._isValidIndex(f)&&this.select(f);return;case "scrollStep":case "contentTransitionDuration":case "scrollAnimationDuration":case "enableScrollAnimation":return;
case "selectionTracker":f?(this._refresh(),this.select(this._selectedItem)):this._selectionTracker&&this._selectionTrackerHelper.remove();return;case "scrollable":f?(this._refresh(),this.select(this._selectedItem)):(c(this._leftArrow).remove(),c(this._rightArrow).remove(),this._performHeaderLayout());return;case "autoHeight":this._performHeaderLayout();return;case "theme":c.jqx.utilities.setTheme(e,f,this.host);return}this._unorderedList.style.left="0px";this._refresh();this.select(this._selectedItem);
this._addSelectStyle(this._selectedItem,!0)}},_toPx:function(b){return"number"===typeof b?b+"px":b},_removeClass:function(b,d){c(b).removeClass(d)},_width:function(b){var d=c(b),e=d.css("border-left-width"),f=d.css("border-right-width"),g=parseInt(d.css("padding-left"),10),d=parseInt(d.css("padding-right"),10),e=-1===e.indexOf("px")?1:parseInt(e,10),f=-1===f.indexOf("px")?1:parseInt(f,10);return b.offsetWidth-(e+f+g+d)},_outerWidth:function(b,d){var e=b.offsetWidth;if(d)var f=c(b),g=parseInt(f.css("margin-left"),
10),f=parseInt(f.css("margin-right"),10),e=e+(g+f);return e},_height:function(b){var d=c(b),e=d.css("border-top-width"),f=d.css("border-bottom-width"),g=parseInt(d.css("padding-top"),10),d=parseInt(d.css("padding-bottom"),10),e=-1===e.indexOf("px")?1:parseInt(e,10),f=-1===f.indexOf("px")?1:parseInt(f,10);return b.offsetHeight-(e+f+g+d)},_outerHeight:function(b,d){var e=b.offsetHeight;if(d)var f=c(b),g=parseInt(f.css("margin-top"),10),f=parseInt(f.css("margin-bottom"),10),e=e+(g+f);return e},_stop:function(b){b.stop?
b.stop():b.animate("stop",!0)}})})(jqxBaseFramework);
(function(c){function b(b){b=c(b);return"none"!==b.css("display")&&"hidden"!==b.css("visibility")}c.jqx.jqxWidget("jqxWindow","",{});c.extend(c.jqx._jqxWindow.prototype,{defineInstance:function(){var b={height:"auto",width:200,minHeight:50,maxHeight:1200,minWidth:50,maxWidth:1200,showCloseButton:!0,disabled:!1,autoOpen:!0,keyboardCloseKey:"esc",title:"",content:"",draggable:!0,resizable:!0,animationType:"fade",closeAnimationDuration:250,showAnimationDuration:250,isModal:!1,position:"center",closeButtonSize:16,
closeButtonAction:"hide",modalOpacity:.3,dragArea:null,okButton:null,cancelButton:null,dialogResult:{OK:!1,Cancel:!1,None:!0},collapsed:!1,showCollapseButton:!1,collapseAnimationDuration:150,collapseButtonSize:16,rtl:!1,keyboardNavigation:!0,headerHeight:null,_events:"created closed moving moved open collapse expand open close resize".split(" "),initContent:null,enableResize:!0,restricter:null,autoFocus:!0,closing:null,_invalidArgumentExceptions:{invalidHeight:"Invalid height!",invalidWidth:"Invalid width!",
invalidMinHeight:"Invalid minHeight!",invalidMaxHeight:"Invalid maxHeight!",invalidMinWidth:"Invalid minWidth!",invalidMaxWidth:"Invalid maxWidth",invalidKeyCode:"Invalid keyCode!",invalidAnimationType:"Invalid animationType!",invalidCloseAnimationDuration:"Invalid closeAnimationDuration!",invalidShowAnimationDuration:"Invalid showAnimationDuration!",invalidPosition:"Invalid position!",invalidCloseButtonSize:"Invalid closeButtonSize!",invalidCollapseButtonSize:"Invalid collapseButtonSize!",invalidCloseButtonAction:"Invalid cluseButtonAction!",
invalidModalOpacity:"Invalid modalOpacity!",invalidDragArea:"Invalid dragArea!",invalidDialogResult:"Invalid dialogResult!",invalidIsModal:"You can have just one modal window!"},_enableResizeCollapseBackup:null,_enableResizeBackup:void 0,_heightBeforeCollapse:null,_minHeightBeforeCollapse:null,_mouseDown:!1,_isDragging:!1,_rightContentWrapper:null,_leftContentWrapper:null,_headerContentWrapper:null,_closeButton:null,_collapseButton:null,_title:null,_content:null,_mousePosition:{},_windowPosition:{},
_modalBackground:null,_SCROLL_WIDTH:21,_visible:!0,modalBackgroundZIndex:1299,modalZIndex:1800,zIndex:1E3,_touchEvents:{mousedown:c.jqx.mobile.getTouchEventName("touchstart"),mouseup:c.jqx.mobile.getTouchEventName("touchend"),mousemove:c.jqx.mobile.getTouchEventName("touchmove"),mouseenter:"mouseenter",mouseleave:"mouseleave",click:c.jqx.mobile.getTouchEventName("touchstart")}};if(this===c.jqx._jqxWindow.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(){this.host.initAnimate&&
this.host.initAnimate();this.host.attr("role","dialog");this.host.removeAttr("data-bind");this.host.appendTo(document.body);var b=this;(function(e){for(var c=0;c<e.length;c++){var h=e[c];b[h]&&0<=b[h].toString().indexOf("px")&&(b[h]=parseInt(b[h],10))}})("minWidth minHeight maxWidth maxHeight width height".split(" "));var e=function(){var e=parseInt(c(b.restricter).css("padding-top"),10),g=parseInt(c(b.restricter).css("padding-left"),10),h=parseInt(c(b.restricter).css("padding-bottom"),10),l=parseInt(c(b.restricter).css("padding-right"),
10),q=c(b.restricter).coord();b.dragArea={left:g+q.left,top:e+q.top,width:1+l+c(b.restricter).width(),height:1+h+c(b.restricter).height()}};this.restricter&&e();this.restricter&&(this.addHandler(c(window),"resize."+this.element.id,function(){e()}),this.addHandler(c(window),"orientationchanged."+this.element.id,function(){e()}),this.addHandler(c(window),"orientationchange."+this.element.id,function(){e()}));this._isTouchDevice=c.jqx.mobile.isTouchDevice();this._validateProperties();this._createStructure();
this._refresh();this.autoOpen||(this.element.style.display="none");c.jqx.browser.msie&&this.host.addClass(this.toThemeProperty("jqx-noshadow"));this.isModal||this._fixWindowZIndex();this._setStartupSettings();this._positionWindow();this._raiseEvent(0);this.autoOpen&&(this._performLayout(),this.isModal&&this._fixWindowZIndex("modal-show"),this.initContent&&(this.initContent(),this._contentInitialized=!0),this._raiseEvent(7),this._raiseEvent(9))},refresh:function(){this._performLayout()},_setStartupSettings:function(){this.disabled&&
this.disable();this.collapsed&&(this.collapsed=!1,this.collapse(0));this.autoOpen||(this.hide(null,.001,!0),this._visible=!1);null!==this.title&&""!==this.title&&this.setTitle(this.title);null!==this.content&&""!==this.content&&this.setContent(this.content);this.title=this._headerContentWrapper.html();this.content=this._content.html()},_fixWindowZIndex:function(b){var e=c.data(document.body,"jqxwindows-list")||[],f=this.zIndex;if(this.isModal)e&&(e=this._removeFromArray(this.host,e),c.data(document.body,
"jqxwindows-list",e)),(e=c.data(document.body,"jqxwindows-modallist"))?"modal-show"==b?e.push(this.host):(b=e.indexOf(this.host),-1!=b&&e.splice(b,1)):"modal-show"==b?(e=[],e.push(this.host),c.data(document.body,"jqxwindows-modallist",e)):(c.data(document.body,"jqxwindows-modallist",[]),e=[]),f=this.modalZIndex,c.each(e,function(){if(this.data()&&this.data().jqxWindow){var b=this.data().jqxWindow.instance;b._modalBackground.style.zIndex=f;b.element.style.zIndex=f+1;f+=2}}),c.data(document.body,"jqxwindow-modal",
this.host);else{0>this._indexOf(this.host,e)&&e.push(this.host);c.data(document.body,"jqxwindows-list",e);if(1<e.length)if(b=e[e.length-2],"auto"==b.css("z-index"))f=this.zIndex+e.length+1;else{var g=this.zIndex,f=parseInt(b.css("z-index"),10)+1;f<g&&(f=g)}this.element.style.zIndex=f;this._sortByStyle("z-index",e)}},_validateProperties:function(){try{this._validateSize();this._validateAnimationProperties();this._validateInteractionProperties();this._validateModalProperties();if(!this.position)throw Error(this._invalidArgumentExceptions.invalidPosition);
if(isNaN(this.closeButtonSize)||0>parseInt(this.closeButtonSize,10))throw Error(this._invalidArgumentExceptions.invalidCloseButtonSize);if(isNaN(this.collapseButtonSize)||0>parseInt(this.collapseButtonSize,10))throw Error(this._invalidArgumentExceptions.invalidCollapseButtonSize);}catch(b){throw Error(b);}},_validateModalProperties:function(){if(0>this.modalOpacity||1<this.modalOpacity)throw Error(this._invalidArgumentExceptions.invalidModalOpacity);if(this.isModal&&!this._singleModalCheck())throw Error(this._invalidArgumentExceptions.invalidIsModal);
},_validateSize:function(){this._validateSizeLimits();if("auto"!==this.height&&isNaN(parseInt(this.height,10)))throw Error(this._invalidArgumentExceptions.invalidHeight);if("auto"!==this.width&&isNaN(parseInt(this.width,10)))throw Error(this._invalidArgumentExceptions.invalidWidth);"auto"!==this.height&&this.height<this.minHeight&&(this.height=this.minHeight);this.width<this.minWidth&&(this.width=this.minWidth);"auto"!==this.height&&this.height>this.maxHeight&&(this.height=this.maxHeight);this.width>
this.maxWidth&&(this.width=this.maxWidth);null!==this.dragArea&&this.dragArea&&(null!==this.dragArea.height&&this.host.height()>this.dragArea.height||parseInt(this.height,10))},_validateSizeLimits:function(){null==this.maxHeight&&(this.maxHeight=9999);null==this.minWidth&&(this.minWidth=0);null==this.maxWidth&&(this.maxWidth=9999);null==this.minHeight&&(this.minHeight=0);if(isNaN(parseInt(this.minHeight,10)))throw Error(this._invalidArgumentExceptions.invalidMinHeight);if(isNaN(parseInt(this.maxHeight,
10)))throw Error(this._invalidArgumentExceptions.invalidMaxHeight);if(isNaN(parseInt(this.minWidth,10)))throw Error(this._invalidArgumentExceptions.invalidMinWidth);if(isNaN(parseInt(this.maxWidth,10)))throw Error(this._invalidArgumentExceptions.invalidMaxWidth);if(this.minHeight&&this.maxHeight&&parseInt(this.minHeight,10)>parseInt(this.maxHeight,10)&&this.maxHeight!=Number.MAX_VALUE)throw Error(this._invalidArgumentExceptions.invalidMinHeight);if(this.minWidth&&this.maxWidth&&parseInt(this.minWidth,
10)>parseInt(this.maxWidth,10)&&this.maxWidth!=Number.MAX_VALUE)throw Error(this._invalidArgumentExceptions.invalidMinWidth);},_validateAnimationProperties:function(){if("fade"!==this.animationType&&"slide"!==this.animationType&&"combined"!==this.animationType&&"none"!==this.animationType)throw Error(this._invalidArgumentExceptions.invalidAnimationType);if(isNaN(parseInt(this.closeAnimationDuration,10))||0>this.closeAnimationDuration)throw Error(this._invalidArgumentExceptions.invalidCloseAnimationDuration);
if(isNaN(parseInt(this.showAnimationDuration,10))||0>this.showAnimationDuration)throw Error(this._invalidArgumentExceptions.invalidShowAnimationDuration);},_validateInteractionProperties:function(){if(0>parseInt(this.keyCode,10)||130<parseInt(this.keyCode,10)&&"esc"!==this.keyCode)throw Error(this._invalidArgumentExceptions.invalidKeyCode);if(null!==this.dragArea&&("undefined"===typeof this.dragArea.width||"undefined"===typeof this.dragArea.height||"undefined"===typeof this.dragArea.left||"undefined"===
typeof this.dragArea.top))throw Error(this._invalidArgumentExceptions.invalidDragArea);if(!this.dialogResult||!this.dialogResult.OK&&!this.dialogResult.Cancel&&!this.dialogResult.None)throw Error(this._invalidArgumentExceptions.invalidDialogResult);if("hide"!==this.closeButtonAction&&"close"!==this.closeButtonAction)throw Error(this._invalidArgumentExceptions.invalidCloseButtonAction);},_singleModalCheck:function(){for(var b=c.data(document.body,"jqxwindows-list")||[],e=b.length;e;)if(--e,0<c(b[e].attr("id")).length&&
c(b[e].attr("id")).jqxWindow("isModal"))return!1;return!0},_createStructure:function(){var b=this.host.children();if(1===b.length)this._content=b[0],this._header=document.createElement("div"),this._header.innerHTML=this.host.attr("caption"),this.element.insertBefore(this._header,this._content),this.host.attr("caption",""),this._header=c(this._header),this._content=c(this._content);else if(2===b.length)this._header=c(b[0]),this._content=c(b[1]);else throw Error("Invalid structure!");},_refresh:function(){this._render();
this._addStyles();this._performLayout();this._removeEventHandlers();this._addEventHandlers();this._initializeResize()},_render:function(){this._addHeaderWrapper();this._addCloseButton();this._addCollapseButton();this._removeModal();this._makeModal()},_addHeaderWrapper:function(){this._headerContentWrapper||(this._header[0].innerHTML='<div style="float:left;">'+this._header[0].innerHTML+"</div>",this._headerContentWrapper=c(this._header.children()[0]),null!==this.headerHeight&&this._header.height(this.headerHeight))},
_addCloseButton:function(){this._closeButton||(this._closeButtonWrapper=document.createElement("div"),this._closeButtonWrapper.className=this.toThemeProperty("jqx-window-close-button-background"),this._closeButton=document.createElement("div"),this._closeButton.className=this.toThemeProperty("jqx-window-close-button jqx-icon-close"),this._closeButton.style.width="100%",this._closeButton.style.height="100%",this._closeButtonWrapper.appendChild(this._closeButton),this._header[0].appendChild(this._closeButtonWrapper),
this._closeButtonWrapper=c(this._closeButtonWrapper),this._closeButton=c(this._closeButton))},_addCollapseButton:function(){this._collapseButton||(this._collapseButtonWrapper=document.createElement("div"),this._collapseButtonWrapper.className=this.toThemeProperty("jqx-window-collapse-button-background"),this._collapseButton=document.createElement("div"),this._collapseButton.className=this.toThemeProperty("jqx-window-collapse-button jqx-icon-arrow-up"),this._collapseButton.style.width="100%",this._collapseButton.style.height=
"100%",this._collapseButtonWrapper.appendChild(this._collapseButton),this._header[0].appendChild(this._collapseButtonWrapper),this._collapseButtonWrapper=c(this._collapseButtonWrapper),this._collapseButton=c(this._collapseButton))},_removeModal:function(){this.isModal||"object"!==typeof this._modalBackground||null===this._modalBackground||(c("."+this.toThemeProperty("jqx-window-modal")).remove(),this._modalBackground=null)},focus:function(){try{this.host.focus();var b=this;setTimeout(function(){b.host.focus()},
10)}catch(e){}},_makeModal:function(){if(this.isModal&&!this._modalBackground){var b=c.data(document.body,"jqxwindows-list");b&&(this._removeFromArray(this.host,b),c.data(document.body,"jqxwindows-list",b));this._modalBackground=document.createElement("div");this._modalBackground.className=this.toThemeProperty("jqx-window-modal");this._setModalBackgroundStyles();document.body.appendChild(this._modalBackground);this.addHandler(this._modalBackground,this._getEvent("click"),function(){return!1});var e=
this;this.addHandler(this._modalBackground,"mouseup",function(b){e._stopResizing(e);b.preventDefault()});this.addHandler(this._modalBackground,"mousedown",function(b){var d=e._getTabbables();0<d.length&&(d[0].focus(),setTimeout(function(){d[0].focus()},100));b.preventDefault();return!1});this.addHandler(c(document),"keydown.window"+this.element.id,function(b){if(9===b.keyCode){var d=c.data(document.body,"jqxwindows-modallist");if(!(1<d.length&&d[d.length-1][0]!=e.element)){var d=e._getTabbables(),
h=null,l=null;if(0!==e.element.offsetWidth&&0!==e.element.offsetHeight&&(0<d.length&&(h=d[0],l=d[d.length-1]),b.target!=e.element&&null!=h)){if(!e.element.contains(b.target)||b.target===l&&!b.shiftKey)return h.focus(),!1;if(b.target===h&&b.shiftKey)return l.focus(),!1}}}})}},_addStyles:function(){this.host.addClass(this.toThemeProperty("jqx-rc-all"));this.host.addClass(this.toThemeProperty("jqx-window"));this.host.addClass(this.toThemeProperty("jqx-popup"));c.jqx.browser.msie&&this.host.addClass(this.toThemeProperty("jqx-noshadow"));
this.host.addClass(this.toThemeProperty("jqx-widget"));this.host.addClass(this.toThemeProperty("jqx-widget-content"));this._header.addClass(this.toThemeProperty("jqx-window-header"));this._content.addClass(this.toThemeProperty("jqx-window-content"));this._header.addClass(this.toThemeProperty("jqx-widget-header"));this._content.addClass(this.toThemeProperty("jqx-widget-content"));this._header.addClass(this.toThemeProperty("jqx-disableselect"));this._header.addClass(this.toThemeProperty("jqx-rc-t"));
this._content.addClass(this.toThemeProperty("jqx-rc-b"));this.host.attr("tabindex")||(this.element.tabIndex=0,this._header[0].tabIndex=0,this._content[0].tabIndex=0);this.element.setAttribute("hideFocus","true");this.element.style.outline="none"},_performHeaderLayout:function(){this._handleHeaderButtons();this._header[0].style.position="relative";this.rtl?(this._headerContentWrapper[0].style.direction="rtl",this._headerContentWrapper[0].style["float"]="right"):(this._headerContentWrapper[0].style.direction=
"ltr",this._headerContentWrapper[0].style["float"]="left");this._performHeaderCloseButtonLayout();this._performHeaderCollapseButtonLayout();this._centerElement(this._headerContentWrapper,this._header,"y","margin");this.headerHeight&&(this._centerElement(this._closeButtonWrapper,this._header,"y","margin"),this._centerElement(this._collapseButtonWrapper,this._header,"y","margin"))},_handleHeaderButtons:function(){if(this._closeButtonWrapper){if(this.showCloseButton){this._closeButtonWrapper[0].style.visibility=
"visible";var b=this._toPx(this.closeButtonSize);this._closeButtonWrapper[0].style.width=b;this._closeButtonWrapper[0].style.height=b}else this._closeButtonWrapper[0].style.visibility="hidden";this.showCollapseButton?(this._collapseButtonWrapper[0].style.visibility="visible",b=this._toPx(this.collapseButtonSize),this._collapseButtonWrapper[0].style.width=b,this._collapseButtonWrapper[0].style.height=b):this._collapseButtonWrapper[0].style.visibility="hidden"}},_performHeaderCloseButtonLayout:function(){if(this._closeButtonWrapper){var b=
parseInt(this._header.css("padding-right"),10);isNaN(b)||(this._closeButtonWrapper.width(this._closeButton.width()),this.rtl?(this._closeButtonWrapper[0].style.marginRight="0px",this._closeButtonWrapper[0].style.marginLeft=this._toPx(b)):(this._closeButtonWrapper[0].style.marginRight=this._toPx(b),this._closeButtonWrapper[0].style.marginLeft="0px"));this._closeButtonWrapper[0].style.position="absolute";this.rtl?(this._closeButtonWrapper[0].style.right="",this._closeButtonWrapper[0].style.left="0px"):
(this._closeButtonWrapper[0].style.right="0px",this._closeButtonWrapper[0].style.left="")}},_performHeaderCollapseButtonLayout:function(){if(this._closeButtonWrapper){var b=parseInt(this._header.css("padding-right"),10);if(!isNaN(b)){var e=this._toPx(this.collapseButtonSize);this._collapseButtonWrapper[0].style.width=e;this._collapseButtonWrapper[0].style.height=e;this.rtl?(this._collapseButtonWrapper[0].style.marginRight="0px",this._collapseButtonWrapper[0].style.marginLeft=this._toPx(b)):(this._collapseButtonWrapper[0].style.marginRight=
this._toPx(b),this._collapseButtonWrapper[0].style.marginLeft="0px")}this._collapseButtonWrapper[0].style.position="absolute";b=this._toPx(this.showCloseButton?this._closeButton.outerWidth(!0):0);this.rtl?(this._collapseButtonWrapper[0].style.right="",this._collapseButtonWrapper[0].style.left=b):(this._collapseButtonWrapper[0].style.right=b,this._collapseButtonWrapper[0].style.left="");this._centerElement(this._collapseButton,c(this._collapseButton[0].parentElement),"y")}},_performWidgetLayout:function(){var b;
"auto"!==this.width&&(this.width&&0<=this.width.toString().indexOf("%")?this.element.style.width=this.width:this.element.style.width=this._toPx(this.width));this.collapsed||("auto"!==this.height?this.height&&0<=this.height.toString().indexOf("%")?this.element.style.height=this.height:this.element.style.height=this._toPx(this.height):this.element.style.height=this.host.height()+"px",this.element.style.minHeight=this._toPx(this.minHeight));this._setChildrenLayout();b=this._validateMinSize();this.element.style.maxHeight=
this._toPx(this.maxHeight);this.element.style.minWidth=this._toPx(this.minWidth);this.element.style.maxWidth=this._toPx(this.maxWidth);b||this._setChildrenLayout()},_setChildrenLayout:function(){this._header.width(this.host.width()-(this._header.outerWidth(!0)-this._header.width()));this._content.width(this.host.width()-(this._content.outerWidth(!0)-this._content.width()));this._content.height(this.host.height()-this._header.outerHeight(!0)-(this._content.outerHeight(!0)-this._content.height()))},
_validateMinSize:function(){var b=!0;this.minHeight<this._header.height()&&(this.minHeight=this._header.height(),b=!1);var e=c(this._header.children()[0]).outerWidth(),f=this._header.children()[1]?c(this._header.children()[1]).outerWidth():0;100>this.minWidth&&(this.minWidth=Math.min(e+f,100),b=!1);return b},_centerElement:function(b,e,c,g){"number"===typeof e.left&&"number"===typeof e.top&&"number"===typeof e.height&&"number"===typeof e.width?this._centerElementInArea(b,e,c):this._centerElementInParent(b,
e,c,g)},_centerElementInParent:function(b,e,c,g){var h="none"===b.css("display"),l;c=c.toLowerCase();g?(l=g+"Top",g+="Left"):(l="top",g="left");if(0<=c.indexOf("y")){h&&(b[0].style.display="block");var q=b.outerHeight(!0),r;h&&(b[0].style.display="none");r=e.height();b[0].style[l]=Math.max(0,r-q)/2+"px"}0<=c.indexOf("x")&&(h&&(b[0].style.display="block"),c=b.outerWidth(!0),h&&(b[0].style.display="none"),e=e.width(),b[0].style[g]=Math.max(0,e-c)/2+"px")},_centerElementInArea:function(b,e,c){c=c.toLowerCase();
if(0<=c.indexOf("y")){var g=b.outerHeight(!0);b[0].style.top=(e.height-g)/2+e.top+"px"}0<=c.indexOf("x")&&(c=b.outerWidth(!0),b[0].style.left=(e.width-c)/2+e.left+"px")},_removeEventHandlers:function(){this.removeHandler(this._header,this._getEvent("mousedown"));this.removeHandler(this._header,this._getEvent("mousemove"));this.removeHandler(this._header,"focus");this.removeHandler(c(document),this._getEvent("mousemove")+"."+this.host.attr("id"));this.removeHandler(c(document),this._getEvent("mouseup")+
"."+this.host.attr("id"));this.removeHandler(this.host,"keydown");this.removeHandler(this._closeButton,this._getEvent("click"));this.removeHandler(this._closeButton,this._getEvent("mouseenter"));this.removeHandler(this._closeButton,this._getEvent("mouseleave"));this.removeHandler(this._collapseButton,this._getEvent("click"));this.removeHandler(this._collapseButton,this._getEvent("mouseenter"));this.removeHandler(this._collapseButton,this._getEvent("mouseleave"));this.removeHandler(this.host,this._getEvent("mousedown"));
this.okButton&&this.removeHandler(c(this.okButton),this._getEvent("click"),this._setDialogResultHandler);this.cancelButton&&this.removeHandler(c(this.cancelButton),this._getEvent("click"),this._setDialogResultHandler);this.removeHandler(this._header,this._getEvent("mouseenter"));this.removeHandler(this._header,this._getEvent("mouseleave"));this.removeHandler(this.host,"resizing",this._windowResizeHandler)},_removeFromArray:function(b,e){return 0<=this._indexOf(b,e)?e.splice(this._indexOf(b,e),1):
e},_sortByStyle:function(b,e){for(var c=0;c<e.length;c++)for(var g=e.length-1;g>c;g--){var h=e[g],l=e[g-1];parseInt(h.css(b),10)<parseInt(l.css(b),10)&&(e[g]=l,e[g-1]=h)}},_initializeResize:function(){this.resizable&&this.initResize({target:this.host,alsoResize:this._content,maxWidth:this.maxWidth,minWidth:this.minWidth,maxHeight:this.maxHeight,minHeight:this.minHeight,indicatorSize:10,resizeParent:this.dragArea})},_removeResize:function(){this.removeResize()},_getEvent:function(b){return this._isTouchDevice?
this._touchEvents[b]:b},_addEventHandlers:function(){this._addDragDropHandlers();this._addCloseHandlers();this._addCollapseHandlers();this._addFocusHandlers();this._documentResizeHandlers();this._closeButtonHover();this._collapseButtonHover();this._addDialogButtonsHandlers();this._addHeaderHoverEffect();this._addResizeHandlers();var b=this;this.addHandler(this._header,this._getEvent("mousemove"),function(){b._addHeaderCursorHandlers(b)})},_addResizeHandlers:function(){var b=this;b.addHandler(b.host,
"resizing",b._windowResizeHandler,{self:b});this.addHandler(c(window),"orientationchanged."+this.element.id,function(){b._performLayout()});this.addHandler(c(window),"orientationchange."+this.element.id,function(){b._performLayout()})},_windowResizeHandler:function(b){var e=b.data.self;e._header.width(e.host.width()-(e._header.outerWidth(!0)-e._header.width()));if(e.width&&0<=e.width.toString().indexOf("%")){var f=c(document.body).width()/100;e.width=1/f*b.args.width+"%"}else e.width=b.args.width;
e.height&&0<=e.height.toString().indexOf("%")?(f=c(document.body).height()/100,e.height=1/f*b.args.height+"%"):e.height=b.args.height},_addHeaderHoverEffect:function(){var b=this;this.addHandler(this._header,this._getEvent("mouseenter"),function(){c(this).addClass(b.toThemeProperty("jqx-window-header-hover"))});this.addHandler(this._header,this._getEvent("mouseleave"),function(){c(this).removeClass(b.toThemeProperty("jqx-window-header-hover"))})},_addDialogButtonsHandlers:function(){this.okButton&&
this.addHandler(c(this.okButton),this._getEvent("click"),this._setDialogResultHandler,{self:this,result:"ok"});this.cancelButton&&this.addHandler(c(this.cancelButton),this._getEvent("click"),this._setDialogResultHandler,{self:this,result:"cancel"})},_documentResizeHandlers:function(){var b=this;this.isModal&&this.addHandler(c(window),"resize.window"+this.element.id,function(){if("object"===typeof b._modalBackground&&null!==b._modalBackground){b.isOpen()&&(b._modalBackground.style.display="none");
if(b.restricter)b._modalBackground.style.left=b._toPx(b.dragArea.left),b._modalBackground.style.top=b._toPx(b.dragArea.top),b._modalBackground.style.width=b._toPx(b.dragArea.width),b._modalBackground.style.height=b._toPx(b.dragArea.height);else{var e=b._getDocumentSize();b._modalBackground.style.width=e.width+"px";b._modalBackground.style.height=e.height+"px"}b.isOpen()&&(b._modalBackground.style.display="block")}})},_setDialogResultHandler:function(b){var e=b.data.self;e._setDialogResult(b.data.result);
e.closeWindow()},_setDialogResult:function(b){this.dialogResult.OK=!1;this.dialogResult.None=!1;this.dialogResult.Cancel=!1;b=b.toLowerCase();switch(b){case "ok":this.dialogResult.OK=!0;break;case "cancel":this.dialogResult.Cancel=!0;break;default:this.dialogResult.None=!0}},_getDocumentSize:function(){var b=c.jqx.browser.msie&&9>c.jqx.browser.version,e=b?4:0,f=e;document.body.scrollHeight>document.body.clientHeight&&b&&(e=this._SCROLL_WIDTH);document.body.scrollWidth>document.body.clientWidth&&b&&
(f=this._SCROLL_WIDTH);return{width:c(document).width()-e,height:c(document).height()-f}},_closeButtonHover:function(){var b=this;this.addHandler(this._closeButton,this._getEvent("mouseenter"),function(){b._closeButton.addClass(b.toThemeProperty("jqx-window-close-button-hover"))});this.addHandler(this._closeButton,this._getEvent("mouseleave"),function(){b._closeButton.removeClass(b.toThemeProperty("jqx-window-close-button-hover"))})},_collapseButtonHover:function(){var b=this;this.addHandler(this._collapseButton,
this._getEvent("mouseenter"),function(){b._collapseButton.addClass(b.toThemeProperty("jqx-window-collapse-button-hover"))});this.addHandler(this._collapseButton,this._getEvent("mouseleave"),function(){b._collapseButton.removeClass(b.toThemeProperty("jqx-window-collapse-button-hover"))})},_setModalBackgroundStyles:function(){if(this.isModal){var b=this._getDocumentSize();c.jqx.browser.msie&&9>c.jqx.browser.version?this._modalBackground.style.filter="alpha(opacity="+100*this.modalOpacity+")":this._modalBackground.style.opacity=
this.modalOpacity;this._modalBackground.style.position="absolute";this._modalBackground.style.top="0px";this._modalBackground.style.left="0px";this._modalBackground.style.width=b.width;this._modalBackground.style.height=b.height;this._modalBackground.style.zIndex=this.modalBackgroundZIndex;this.autoOpen||(this._modalBackground.style.display="none")}},_addFocusHandlers:function(){var b=this;this.addHandler(this.host,this._getEvent("mousedown"),function(){b.isModal||b.bringToFront()})},_indexOf:function(b,
e){for(var c=0;c<e.length;c++)if(e[c][0]===b[0])return c;return-1},_addCloseHandlers:function(){var b=this;this.addHandler(this._closeButton,this._getEvent("click"),function(e){return b._closeWindow(e)});"none"!==this.keyboardCloseKey&&"number"!==typeof this.keyboardCloseKey&&"esc"===this.keyboardCloseKey.toLowerCase()&&(this.keyboardCloseKey=27);this.addHandler(this.host,"keydown",function(e){e.keyCode===b.keyboardCloseKey&&null!=b.keyboardCloseKey&&"none"!=b.keyboardCloseKey?b._closeWindow(e):b._handleKeys(e)},
{self:this});this.addHandler(this.host,"keyup",function(){if(b.keyboardNavigation&&b._moved){var e=b.host.coord(),c=e.left,e=e.top;b._raiseEvent(3,c,e,c,e);b._moved=!1}})},_handleKeys:function(b){if(this.keyboardNavigation&&this._headerFocused&&!c(document.activeElement).ischildof(this._content)){var e=b.ctrlKey,f=b.keyCode,g=this.host.coord(),h=g.left,g=g.top,l=this._getDraggingArea(),q=this.host.width(),r=this.host.height(),t=!0;switch(f){case 37:e?this.resizable&&this.resize(q-10,r):this.draggable&&
0<=h-10&&this.move(h-10,g);t=!1;break;case 38:e?this.resizable&&this.resize(q,r-10):this.draggable&&0<=g-10&&this.move(h,g-10);t=!1;break;case 39:e?this.resizable&&this.resize(q+10,r):this.draggable&&h+q+10<=l.width&&this.move(h+10,g);t=!1;break;case 40:e?this.resizable&&this.resize(q,r+10):this.draggable&&g+r+10<=l.height&&this.move(h,g+10),t=!1}t||(b.preventDefault&&b.preventDefault(),b.stopPropagation&&b.stopPropagation());return t}},_addCollapseHandlers:function(){var b=this;this.addHandler(this._collapseButton,
this._getEvent("click"),function(){b.collapsed?b.expand():b.collapse()})},_closeWindow:function(){this.closeWindow();return!1},_addHeaderCursorHandlers:function(b){b.resizeArea&&b.resizable&&!b.collapsed?b._header[0].style.cursor=b._resizeWrapper.style.cursor:b.draggable?b._header[0].style.cursor="move":(b._header[0].style.cursor="default",b._resizeWrapper&&(b._resizeWrapper.style.cursor="default"))},_addDragDropHandlers:function(){if(this.draggable){var b=this;this.addHandler(this.host,"focus",function(){b._headerFocused=
!0});this.addHandler(this.host,"blur",function(){b._headerFocused=!1});this.addHandler(this._header,"focus",function(){b._headerFocused=!0;return!1});this.addHandler(this._header,this._getEvent("mousedown"),function(e,c,h){c&&(e.pageX=c);h&&(e.pageY=h);b._headerMouseDownHandler(b,e);return!0});this.addHandler(this._header,"dragstart",function(b){b.preventDefault&&b.preventDefault();return!1});this.addHandler(this._header,this._getEvent("mousemove"),function(e){return b._headerMouseMoveHandler(b,e)});
this.addHandler(c(document),this._getEvent("mousemove")+"."+this.host.attr("id"),function(e){return b._dragHandler(b,e)});this.addHandler(c(document),this._getEvent("mouseup")+"."+this.host.attr("id"),function(e){return b._dropHandler(b,e)});try{if(""!==document.referrer||window.frameElement){var e=null;null!=window.top&&window.top!=window.self&&window.parent&&document.referrer&&(e=document.referrer);e&&-1!=e.indexOf(document.location.host)&&(e=function(e){b._dropHandler(b,e)},window.top.document.addEventListener?
window.top.document.addEventListener("mouseup",e,!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",e))}}catch(f){}}},_headerMouseDownHandler:function(b,e){b.isModal||b.bringToFront();if(null==b._resizeDirection){var f=c.jqx.position(e);b._mousePosition.x=f.left;b._mousePosition.y=f.top;b._mouseDown=!0;b._isDragging=!1}},_headerMouseMoveHandler:function(b,e){if(b._mouseDown&&!b._isDragging){c.jqx.mobile.getTouches(e);var f,g;g=c.jqx.position(e);f=g.left;g=g.top;if(f+
3<b._mousePosition.x||f-3>b._mousePosition.x||g+3<b._mousePosition.y||g-3>b._mousePosition.y)b._isDragging=!0,b._mousePosition={x:f,y:g},b._windowPosition={x:b.host.coord().left,y:b.host.coord().top},c(document.body).addClass(b.toThemeProperty("jqx-disableselect"));return b._isTouchDevice?(e.preventDefault(),!0):!1}return b._isDragging?b._isTouchDevice?(e.preventDefault(),!0):!1:!0},_dropHandler:function(b,e){var f=!0;if(b._isDragging&&!b.isResizing&&!b._resizeDirection){var f=parseInt(b.host.css("left"),
10),g=parseInt(b.host.css("top"),10),h=b._isTouchDevice?0:e.pageX,l=b._isTouchDevice?0:e.pageY;b.enableResize=b._enableResizeBackup;b._enableResizeBackup="undefined";b._raiseEvent(3,f,g,h,l);f=!1;"undefined"!=e.preventDefault&&e.preventDefault();null!=e.originalEvent&&(e.originalEvent.mouseHandled=!0);"undefined"!=e.stopPropagation&&e.stopPropagation()}b._isDragging=!1;b._mouseDown=!1;c(document.body).removeClass(b.toThemeProperty("jqx-disableselect"));return f},_dragHandler:function(b,e){if(b._isDragging&&
!b.isResizing&&!b._resizeDirection){var f=b._isTouchDevice?e.originalEvent.which:e.which;"undefined"===typeof b._enableResizeBackup&&(b._enableResizeBackup=b.enableResize);b.enableResize=!1;if(0===f&&c.jqx.browser.msie&&8>c.jqx.browser.version)return b._dropHandler(b,e);f=c.jqx.position(e);b.move(b._windowPosition.x+(f.left-b._mousePosition.x),b._windowPosition.y+(f.top-b._mousePosition.y),e);e.preventDefault();return!1}return!0},_validateCoordinates:function(b,e,c,g){var h=this._getDraggingArea();
b=b<h.left?h.left:b;e=e<h.top?h.top:e;var l=this.host.outerWidth(!0),q=this.host.outerHeight(!0);b+l>=h.width+h.left-2*g&&(b=h.width+h.left-l-g);e+q>=h.height+h.top-c&&(e=h.height+h.top-q-c);return{x:b,y:e}},_performLayout:function(){this._performHeaderLayout();this._performWidgetLayout()},_parseDragAreaAttributes:function(){null!==this.dragArea&&(this.dragArea.height=parseInt(this.dragArea.height,10),this.dragArea.width=parseInt(this.dragArea.width,10),this.dragArea.top=parseInt(this.dragArea.top,
10),this.dragArea.left=parseInt(this.dragArea.left,10))},_positionWindow:function(){this._parseDragAreaAttributes();if(this.position instanceof Array&&2===this.position.length&&"number"===typeof this.position[0]&&"number"===typeof this.position[1])this.element.style.left=this._toPx(this.position[0]),this.element.style.top=this._toPx(this.position[1]);else if(this.position instanceof Object)if(this.position.left)this.host.offset(this.position);else if(void 0!==this.position.x&&void 0!==this.position.y)this.element.style.left=
this._toPx(this.position.x),this.element.style.top=this._toPx(this.position.y);else{if(this.position.center){this._centerElement(this.host,this.position.center,"xy");var b=this.position.center.coord(),e=parseInt(this.host.css("left"),10),c=parseInt(this.host.css("top"),10);this.element.style.left=this._toPx(e+b.left);this.element.style.top=this._toPx(c+b.top)}}else this._positionFromLiteral()},_getDraggingArea:function(){var b={};b.left=this.dragArea&&this.dragArea.left?this.dragArea.left:0;b.top=
this.dragArea&&this.dragArea.top?this.dragArea.top:0;b.width=this.dragArea&&this.dragArea.width?this.dragArea.width:this._getDocumentSize().width;b.height=this.dragArea&&this.dragArea.height?this.dragArea.height:this._getDocumentSize().height;return b},_positionFromLiteral:function(){this.position instanceof Array||(this.position=this.position.split(","));for(var b=this.position.length,e=this._getDraggingArea();b;)switch(--b,this.position[b]=this.position[b].replace(/ /g,""),this.position[b]){case "top":this.element.style.top=
this._toPx(e.top);break;case "left":this.element.style.left=this._toPx(e.left);break;case "bottom":this.element.style.top=this._toPx(e.height-this.host.height()+e.top);break;case "right":this.element.style.left=this._toPx(e.left+e.width-this.host.width());break;default:this.dragArea||(e=c(window)),this._centerElement(this.host,e,"xy")}},_raiseEvent:function(b,e,f,g,h){var l=this._events[b],q=c.Event(l),r={};if(2===b||3===b)r.x=e,r.y=f,r.pageX=g,r.pageY=h;if("closed"===l||"close"===l)r.dialogResult=
this.dialogResult;q.args=r;return this.host.trigger(q)},destroy:function(){this.removeHandler(c(window),"resize.window"+this.element.id);this._removeEventHandlers();this._destroy()},_destroy:function(){this.isModal&&(null!==this._modalBackground&&c(this._modalBackground).remove(),this.host.jqxWindow({isModal:!1}));this.restricter&&(this.removeHandler(c(window),"resize."+this.element.id),this.removeHandler(c(window),"orientationchanged."+this.element.id),this.removeHandler(c(window),"orientationchange."+
this.element.id));this.host.remove();null!==this._modalBackground&&c(this._modalBackground).remove()},_toClose:function(b,e){return b&&e[0]===this.element||e[0]!==this.element&&"object"===typeof e[0]},propertyChangedHandler:function(b,e,f,g){this._validateProperties();switch(e){case "rtl":this._performLayout();break;case "dragArea":this._positionWindow();break;case "collapseButtonSize":this._performLayout();break;case "closeButtonSize":this._performLayout();break;case "isModal":this._refresh();this._fixWindowZIndex();
if(!1===g){b=c.data(document.body,"jqxwindows-modallist");var h=[];for(e=0;e<b.length;e++)b[e][0]!==this.element&&h.push(b[e])}c.data(document.body,"jqxwindows-modallist",h);break;case "keyboardCloseKey":this._removeEventHandlers();this._addEventHandlers();break;case "disabled":g?this.disable():(this.disabled=!0,this.enable());break;case "showCloseButton":case "showCollapseButton":this._performLayout();break;case "height":this._performLayout();break;case "width":this._performLayout();break;case "title":this.setTitle(g);
this.title=g;break;case "content":this.setContent(g);break;case "draggable":this._removeEventHandlers();this._addEventHandlers();this._removeResize();this._initializeResize();break;case "resizable":(this.enableResize=g)?this._initializeResize():this._removeResize();break;case "position":this._positionWindow();break;case "modalOpacity":this._setModalBackgroundStyles();break;case "okButton":g?this._addDialogButtonsHandlers():this.removeHandler(this.okButton);break;case "cancelButton":g?this._addDialogButtonsHandlers():
this.removeHandler(this.cancelButton);break;case "collapsed":g?f||(this.collapsed=!1,this.collapse(0)):f&&(this.collapsed=!0,this.expand(0));break;case "theme":c.jqx.utilities.setTheme(f,g,this.host);break;case "maxWidth":case "maxHeight":case "minWidth":case "minHeight":b._performLayout(),b._removeResize(),b._initializeResize()}},collapse:function(b){if(!this.collapsed&&!0!==this._animationInProgress&&"none"!=this.host.css("display")){var e=this,f=this._header.outerHeight(!0),g=parseInt(this._header.css("border-bottom-width"),
10),h=parseInt(this._header.css("margin-bottom"),10);b=isNaN(parseInt(b,10))?this.collapseAnimationDuration:b;isNaN(g)||(f-=2*g);isNaN(h)||(f+=h);this._heightBeforeCollapse=this.host.height();this._minHeightBeforeCollapse=this.host.css("min-height");this.element.style.minHeight=this._toPx(f);e._animationInProgress=!0;this.host.animate({height:f},{duration:b,complete:function(){e._animationInProgress=!1;e.collapsed=!0;e._collapseButton.addClass(e.toThemeProperty("jqx-window-collapse-button-collapsed"));
e._collapseButton.addClass(e.toThemeProperty("jqx-icon-arrow-down"));e._content[0].style.display="none";e._raiseEvent(5);e._raiseEvent(9);c.jqx.aria(e,"aria-expanded",!1)}})}},expand:function(b){if(this.collapsed&&!0!==this._animationInProgress){var e=this;b=isNaN(parseInt(b,10))?this.collapseAnimationDuration:b;e._animationInProgress=!0;this.host.animate({height:this._heightBeforeCollapse},{duration:b,complete:function(){e._animationInProgress=!1;e.collapsed=!1;e.element.style.minHeight=e._toPx(e._minHeightBeforeCollapse);
e._collapseButton.removeClass(e.toThemeProperty("jqx-window-collapse-button-collapsed"));e._collapseButton.removeClass(e.toThemeProperty("jqx-icon-arrow-down"));e._content[0].style.display="block";e._raiseEvent(6);e._performWidgetLayout();e._raiseEvent(9);c.jqx.aria(e,"aria-expanded",!0)}})}},closeAll:function(b){b=!0;for(var e=c.data(document.body,"jqxwindows-list"),f=e.length,g=c.data(document.body,"jqxwindow-modal")||[];f;)--f,this._toClose(b,e[f])&&(e[f].jqxWindow("closeWindow","close"),e.splice(f,
1));this._toClose(b,g)&&(g.jqxWindow("closeWindow","close"),c.data(document.body,"jqxwindow-modal",[]));c.data(document.body,"jqxwindows-list",e)},setTitle:function(b){if("string"===typeof b)this._headerContentWrapper.html(b);else if("object"===typeof b)try{this._headerContentWrapper[0].innerHTML="",b instanceof HTMLElement?this._headerContentWrapper[0].appendChild(b):b.appendTo&&b.appendTo(this._headerContentWrapper)}catch(e){throw Error(e);}this.title=b;this._performLayout()},setContent:function(b){this._contentInitialized=
!1;for(var e=this._content,f=!1;!f;)e[0].style.width="auto",e[0].style.height="auto",e.hasClass("jqx-window")?f=!0:e=c(e[0].parentNode);if(c.isArray(b))for(e=0;e<b.length;e++)b[e].appendTo(this._content);else if("string"===typeof b)c(this._content[0]).html(b);else if("object"===typeof b)try{this._content[0].innerHTML="",b instanceof HTMLElement?this._content[0].appendChild(b):b.appendTo&&b.appendTo(this._content)}catch(g){throw Error(g);}this.content=b;this._performLayout()},disable:function(){this.disabled=
!0;this._removeEventHandlers();this._header.addClass(this.toThemeProperty("jqx-window-header-disabled"));this._closeButton.addClass(this.toThemeProperty("jqx-window-close-button-disabled"));this._collapseButton.addClass(this.toThemeProperty("jqx-window-collapse-button-disabled"));this._content.addClass(this.toThemeProperty("jqx-window-content-disabled"));this.host.addClass(this.toThemeProperty("jqx-window-disabled"));this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));this._removeResize()},
enable:function(){this.disabled&&(this._addEventHandlers(),this._header.removeClass(this.toThemeProperty("jqx-window-header-disabled")),this._content.removeClass(this.toThemeProperty("jqx-window-content-disabled")),this._closeButton.removeClass(this.toThemeProperty("jqx-window-close-button-disabled")),this._collapseButton.removeClass(this.toThemeProperty("jqx-window-collapse-button-disabled")),this.host.removeClass(this.toThemeProperty("jqx-window-disabled")),this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled")),
this.disabled=!1,this._initializeResize())},isOpen:function(){return this._visible},closeWindow:function(b){var e=this;b="undefined"===typeof b?this.closeButtonAction:b;this.hide(function(){"close"===b&&e._destroy()})},bringToFront:function(){var b=c.data(document.body,"jqxwindows-list");if(this.isModal)c.data(document.body,"jqxwindows-modallist"),this._fixWindowZIndex("modal-hide"),this._fixWindowZIndex("modal-show");else{for(var e=parseInt(b[b.length-1].css("z-index"),10),f=this._indexOf(this.host,
b),g=b.length-1;g>f;--g){var h=parseInt(b[g].css("z-index"),10)-1;b[g][0].style.zIndex=h}this.element.style.zIndex=e;this._sortByStyle("z-index",b)}},hide:function(b,e,f){var g=this;if(!this.closing||!1!==this.closing()){e=e||this.closeAnimationDuration;switch(this.animationType){case "none":this.element.style.display="none";break;case "fade":g._animationInProgress=!0;this.host.fadeOut({duration:e,callback:function(){g._animationInProgress=!1;b instanceof Function&&b()}});break;case "slide":g._animationInProgress=
!0;this.host.slideUp({duration:e,callback:function(){g._animationInProgress=!1;b instanceof Function&&b()}});break;case "combined":g._animationInProgress=!0,this.host.animate({opacity:0,width:"0px",height:"0px"},{duration:e,complete:function(){g._animationInProgress=!1;g.element.style.display="none";b instanceof Function&&b()}})}this._visible=!1;this.isModal&&(c(this._modalBackground).hide(),this._fixWindowZIndex("modal-hide"));!0!==f&&(this._raiseEvent(1),this._raiseEvent(8))}},open:function(b,e){this.show(b,
e)},close:function(b,e,c){this.hide(b,e,c)},show:function(b,e){var f=this;this._setDialogResult("none");e=e||this.showAnimationDuration;switch(this.animationType){case "none":this.element.style.display="block";break;case "fade":f._animationInProgress=!0;this.host.fadeIn({duration:e,complete:function(){f._animationInProgress=!1;b instanceof Function&&b()}});break;case "slide":f._animationInProgress=!0;this.host.slideDown({duration:e,callback:function(){f._animationInProgress=!1;b instanceof Function&&
b()}});break;case "combined":this.element.style.display="block";var g=f.host.width(),h=f.host.height();this.element.style.minWidth="0px";this.element.style.minHeight="0px";this.element.style.opacity=0;this.element.style.width="0px";this.element.style.height="0px";f._animationInProgress=!0;this.host.animate({opacity:1,width:g+"px",height:h+"px"},{duration:e,complete:function(){f._animationInProgress=!1;f._performLayout();b instanceof Function&&b()}})}this.isModal&&(c(this._modalBackground).show(),
this._fixWindowZIndex("modal-show"));var l=this;this._visible||(150<e&&"none"!=this.animationType?setTimeout(function(){!l._contentInitialized&&l.initContent&&(l.initContent(),l._contentInitialized=!0);l._raiseEvent(7);l._raiseEvent(9)},e-150):(!l._contentInitialized&&l.initContent&&(l.initContent(),l._contentInitialized=!0),this._raiseEvent(7),l._raiseEvent(9)));this._visible=!0;"combined"!==f.animationType&&this._performLayout();this.autoFocus&&(l._isTouchDevice||l._content[0].focus(),setTimeout(function(){l._isTouchDevice||
l._content[0].focus()},100))},_getTabbables:function(){var d;d=c.jqx.browser.msie&&9>c.jqx.browser.version?this._content.find("*"):this._content[0].querySelectorAll("*");var e=[];c.each(d,function(){var d=this.getAttribute("tabindex"),g=null===d;if(d=g||0<=d)g=!g,d=this.nodeName.toLowerCase(),"area"===d?(g=this.parentNode,d=g.name,this.href&&d&&"map"===g.nodeName.toLowerCase()?(g=c("img[usemap=#"+d+"]")[0],d=!!g&&b(g)):d=!1):d=(/input|select|textarea|button|object/.test(d)?!this.disabled:"a"==d?this.href||
g:g)&&b(this);d&&(e[e.length]=this)});return e},move:function(b,e,f,g){var h=0,l=0,q,r;b=parseInt(b,10);e=parseInt(e,10);c.jqx.browser.msie&&(c(window).width()>c(document).width()&&!this.dragArea&&(l=this._SCROLL_WIDTH),c(window).height()<c(document).height()&&document.documentElement.clientWidth>document.documentElement.scrollWidth&&!this.dragArea&&(h=this._SCROLL_WIDTH));h=this._validateCoordinates(b,e,l,h);if(parseInt(this.host.css("left"),10)!==h.x||parseInt(this.host.css("top"),10)!==h.y)f&&
(f=c.jqx.position(f),q=f.left,r=f.top),void 0===q&&(q=b),void 0===r&&(r=e),!1!==g&&this._raiseEvent(2,h.x,h.y,q,r);this.element.style.left=h.x+"px";this.element.style.top=h.y+"px";this._moved=!0},_toPx:function(b){return"number"===typeof b?b+"px":b}})})(jqxBaseFramework);
(function(c){var b=function(b){return{resizeConfig:function(){this.resizeTarget=null;this.resizeIndicatorSize=5;this.resizeTargetChildren=null;this.resizeArea=this.isResizing=!1;this.minWidth=1;this.maxWidth=100;this.minHeight=1;this.maxHeight=100;this.resizeParent=null;this.enableResize=!0;this._resizeEvents=["resizing","resized","resize"];this._resizeMouseDown=!1;this._resizeCurrentMode=null;this._mouseResizePosition={};this._resizeMethods=null;this._SCROLL_WIDTH=21},_resizeExceptions:{invalidTarget:"Invalid target!",
invalidMinHeight:"Invalid minimal height!",invalidMaxHeight:"Invalid maximum height!",invalidMinWidth:"Invalid minimum width!",invalidMaxWidth:"Invalid maximum width!",invalidIndicatorSize:"Invalid indicator size!",invalidSize:"Invalid size!"},removeResize:function(){if(this.resizeTarget){var e=b(this.resizeTarget.children(".jqx-resize"));e.detach();var c=e.children();this._removeResizeEventListeners();for(var g=0;g<c.length;g+=1)b(c[g]).detach(),this.resizeTarget.append(c[g]);e.remove()}this._resizeDirection=
null},initResize:function(e){this.resizeConfig();this.resizeTarget=b(e.target);this.resizeIndicatorSize=e.indicatorSize||10;this.maxWidth=e.maxWidth||100;this.minWidth=e.minWidth||1;this.maxHeight=e.maxHeight||100;this.minHeight=e.minHeight||1;this.resizeParent=e.resizeParent;this._parseResizeParentProperties();this._validateResizeProperties();this._validateResizeTargetDimensions();this._getChildren(this.resizeTarget.maxWidth,this.resizeTarget.minWidth,this.resizeTarget.maxHeight,this.resizeTarget.minHeight,
e.alsoResize);this._refreshResize();this._cursorBackup=this.resizeTarget.css("cursor");"auto"===this._cursorBackup&&(this._cursorBackup="default")},_validateResizeTargetDimensions:function(){this.resizeTarget.maxWidth=this.maxWidth;this.resizeTarget.minWidth=3*this.resizeIndicatorSize>this.minWidth?3*this.resizeIndicatorSize:this.minWidth;this.resizeTarget.maxHeight=this.maxHeight;this.resizeTarget.minHeight=3*this.resizeIndicatorSize>this.minHeight?3*this.resizeIndicatorSize:this.minHeight},_parseResizeParentProperties:function(){this.resizeParent&&
(this.resizeParent.left=parseInt(this.resizeParent.left,10),this.resizeParent.top=parseInt(this.resizeParent.top,10),this.resizeParent.width=parseInt(this.resizeParent.width,10),this.resizeParent.height=parseInt(this.resizeParent.height,10))},_getChildren:function(e,c,g,h,l){this.resizeTargetChildren=b(l);this.resizeTargetChildren=this.resizeTargetChildren.toArray();for(e=this.resizeTargetChildren.length;e;)--e,this.resizeTargetChildren[e]=b(this.resizeTargetChildren[e])},_refreshResize:function(){this._renderResize();
this._performResizeLayout();this._removeResizeEventListeners();this._addResizeEventHandlers()},_renderResize:function(){if(!(void 0!==this._resizeWrapper&&0<b(this._resizeWrapper).parents().length)){var e=document.createElement("div");e.className="jqx-resize jqx-rc-all";e.style.zIndex=8E3;e.appendChild(this._header[0]);e.appendChild(this._content[0]);this.resizeTarget[0].appendChild(e);this._resizeWrapper=e}},_performResizeLayout:function(){this._resizeWrapper.style.height=this.resizeTarget.height()+
"px";this._resizeWrapper.style.width=this.resizeTarget.width()+"px"},_removeResizeEventListeners:function(){var e=this.resizeTarget.attr("id");this.removeHandler(this._resizeWrapper,"mousemove.resize"+e);this.removeHandler(this._resizeWrapper,"mousedown.resize"+e);this.removeHandler(b(document),"mousemove.resize"+e);this.removeHandler(b(document),"mouseup.resize"+e)},_addResizeEventHandlers:function(){var e=this.resizeTarget.attr("id"),c=this;c._isTouchDevice?(this.addHandler(this._resizeWrapper,
"touchmove.resize."+e,function(b){c._resizeCursorChangeHandler(c,b)}),this.addHandler(this._resizeWrapper,"touchstart.resize."+e,function(b){c._resizeCursorChangeHandler(c,b);c._resizeMouseDownHandler(c,b)}),this.addHandler(b(document),"touchmove.resize."+e,function(b){return c._resizeHandler(c,b)}),this.addHandler(b(document),"touchend.resize."+e,function(b){c._stopResizing(c,b)})):(this.addHandler(this._resizeWrapper,"mousemove.resize."+e,function(b){c._resizeCursorChangeHandler(c,b)}),this.addHandler(this._resizeWrapper,
"mousedown.resize."+e,function(b){c._resizeMouseDownHandler(c,b)}),this.addHandler(b(document),"mousemove.resize."+e,function(b){return c._resizeHandler(c,b)}),this.addHandler(b(document),"mouseup.resize."+e,function(b){c._stopResizing(c,b)}));try{if(""!==document.referrer||window.frameElement)e=function(b){c._stopResizing(c,b)},window.top.document.addEventListener?window.top.document.addEventListener("mouseup",e,!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",e)}catch(g){}},
_stopResizing:function(b){b.enableResize&&(b.isResizing&&b._raiseResizeEvent(1),b._resizeMouseDown=!1,b.isResizing=!1,b._resizeDirection=null,b.resizeTarget&&b.resizeTarget.removeClass("jqx-disableselect"));"undefined"==b._cursorBackup&&(b._cursorBackup="default");b._resizeWrapper&&(b._resizeWrapper.style.cursor=b._cursorBackup)},_resizeHandler:function(e,c){if(e.enableResize&&!e.collapsed){if(e.isResizing&&e._resizeDirection){0===c.which&&b.jqx.browser.msie&&9>b.jqx.browser.version&&e._stopResizing(c);
if(e._isTouchDevice){var g=b.jqx.position(c);e._performResize(g.left,g.top);return!1}e._performResize(c.pageX,c.pageY);return!1}return e._isTouchDevice?(g=b.jqx.position(c),e._resizeCaptureCursor(g.left,g.top)):e._resizeCaptureCursor(c.pageX,c.pageY)}},_resizeCaptureCursor:function(b,d){if(this._resizeMouseDown&&!this.isResizing&&this._resizeDirection&&(this._isTouchDevice||b+3<this._mouseResizePosition.x||b-3>this._mouseResizePosition.x||d+3<this._mouseResizePosition.y||d-3>this._mouseResizePosition.y))return this._changeCursor(b-
parseInt(this.resizeTarget.css("left"),10),d-parseInt(this.resizeTarget.css("top"),10)),this._mouseResizePosition={x:b,y:d},this._prepareResizeMethods(this._resizeDirection),this._resizeBackupData(),this.isResizing=!0,this.resizeTarget.addClass("jqx-disableselect"),!1},_resizeBackupData:function(){this.resizeTarget.lastWidth=this.resizeTarget.width();this.resizeTarget.lastHeight=this.resizeTarget.height();this.resizeTarget.x=parseInt(this.resizeTarget.css("left"),10);this.resizeTarget.y=parseInt(this.resizeTarget.css("top"),
10);this._resizeBackupChildrenSize()},_resizeBackupChildrenSize:function(){for(var b=this.resizeTargetChildren.length,d;b;)--b,d=this.resizeTargetChildren[b],this.resizeTargetChildren[b].lastWidth=d.width(),this.resizeTargetChildren[b].lastHeight=d.height()},_performResize:function(b,d){var c=b-this._mouseResizePosition.x,h=d-this._mouseResizePosition.y;this._resizeDirection&&this._resize(this.resizeTarget,c,h)},_resizeCursorChangeHandler:function(e,c){if(e.enableResize&&!e.collapsed&&!e.isResizing)if(e._isTouchDevice){var g=
b.jqx.position(c);e._changeCursor(g.left-parseInt(e.resizeTarget.css("left"),10),g.top-parseInt(e.resizeTarget.css("top"),10))}else e._changeCursor(c.pageX-parseInt(e.resizeTarget.css("left"),10),c.pageY-parseInt(e.resizeTarget.css("top"),10))},_resizeMouseDownHandler:function(e,c){if(e.enableResize&&null!==e._resizeDirection){e._resizeMouseDown=!0;if(e._isTouchDevice){var g=b.jqx.position(c);e._mouseResizePosition.x=g.left;e._mouseResizePosition.y=g.top}else e._mouseResizePosition.x=c.pageX,e._mouseResizePosition.y=
c.pageY;c.preventDefault()}},_validateResizeProperties:function(){try{if(!this.resizeTarget||1!==this.resizeTarget.length)throw Error(this._resizeExceptions.invalidTarget);if(0>this.minHeight||isNaN(parseInt(this.minHeight,10)))throw Error(this._resizeExceptions.invalidMinHeight);if(0>=this.maxHeight||isNaN(parseInt(this.maxHeight,10)))throw Error(this._resizeExceptions.invalidMaxHeight);if(0>this.minWidth||isNaN(parseInt(this.minWidth,10)))throw Error(this._resizeExceptions.invalidMinWidth);if(0>
this.maxWidth||isNaN(parseInt(this.maxWidth,10)))throw Error(this._resizeExceptions.invalidMaxWidth);if(0>this.resizeIndicatorSize||isNaN(parseInt(this.resizeIndicatorSize,10)))throw Error(this._resizeExceptions.invalidIndicatorSize);if(this.minHeight>this.maxHeight||this.minWidth>this.maxWidth)throw Error(this._resizeExceptions.invalidSize);}catch(b){throw Error(b);}},_changeCursor:function(b,d){this.isResizing||this._resizeMouseDown||(this.resizeArea=!0,b<=this.resizeIndicatorSize&&0<=b&&d<=this.resizeIndicatorSize&&
0<d?(this._resizeWrapper.style.cursor="nw-resize",this._resizeDirection="topleft"):d<=this.resizeIndicatorSize&&0<d&&b>=this.resizeTarget.width()-this.resizeIndicatorSize?(this._resizeWrapper.style.cursor="ne-resize",this._resizeDirection="topright"):d>=this.resizeTarget.height()-this.resizeIndicatorSize&&d<this.resizeTarget.height()&&b<=this.resizeIndicatorSize&&0<=b?(this._resizeWrapper.style.cursor="sw-resize",this._resizeDirection="bottomleft"):d>=this.resizeTarget.height()-this.resizeIndicatorSize&&
d<this.resizeTarget.height()&&b>=this.resizeTarget.width()-this.resizeIndicatorSize&&b<this.resizeTarget.width()?(this._resizeWrapper.style.cursor="se-resize",this._resizeDirection="bottomright"):b<=this.resizeIndicatorSize&&0<=b?(this._resizeWrapper.style.cursor="e-resize",this._resizeDirection="left"):d<=this.resizeIndicatorSize&&0<d?(this._resizeWrapper.style.cursor="n-resize",this._resizeDirection="top"):d>=this.resizeTarget.height()-this.resizeIndicatorSize&&d<this.resizeTarget.height()?(this._resizeWrapper.style.cursor=
"n-resize",this._resizeDirection="bottom"):b>=this.resizeTarget.width()-this.resizeIndicatorSize&&b<this.resizeTarget.width()?(this._resizeWrapper.style.cursor="e-resize",this._resizeDirection="right"):(this._resizeWrapper.style.cursor=this._cursorBackup,this._resizeDirection=null,this.resizeArea=!1))},_prepareResizeMethods:function(b){this._resizeMethods=[];0<=b.indexOf("left")&&this._resizeMethods.push(this._resizeLeft);0<=b.indexOf("top")&&this._resizeMethods.push(this._resizeTop);0<=b.indexOf("right")&&
this._resizeMethods.push(this._resizeRight);0<=b.indexOf("bottom")&&this._resizeMethods.push(this._resizeBottom)},_validateResize:function(b,d,c,h,l){return"horizontal"===c||"both"===c?this._validateWidth(b,h,l):"vertical"===c||"both"===c?this._validateHeight(d,h,l):{result:!1,fix:0}},_getParent:function(){return null!==this.resizeParent&&"undefined"!==this.resizeParent&&this.resizeParent.height&&this.resizeParent.width&&this.resizeParent.top&&this.resizeParent.left?this.resizeParent:{left:0,top:0,
width:b(document).width(),height:b(document).height()}},_validateHeight:function(e,c,g){var h=0,l=this._getParent();b(window).width()>b(document).width()&&b.jqx.browser.msie&&l.height===b(document).height()&&(h=this._SCROLL_WIDTH);return"bottom"===g&&e+c.position().top+h+2>l.height+l.top?{fix:l.height-c.position().top-h-2+l.top,result:!1}:"top"===g&&c.lastHeight-e+c.y<l.top?{fix:e+(c.lastHeight-e+c.y)-l.top,result:!1}:e<c.minHeight?{fix:c.minHeight,result:!1}:e>c.maxHeight?{fix:c.maxHeight,result:!1}:
{result:!0,fix:e}},_validateWidth:function(e,c,g){var h=0,l=this._getParent();b(window).height()<b(document).height()&&b.jqx.browser.msie&&document.documentElement.clientWidth>=document.documentElement.scrollWidth&&l.width===b(document).width()&&(h=this._SCROLL_WIDTH);return"right"===g&&e+c.position().left+h+2>l.width+l.left?{fix:l.width-c.position().left-h-2+l.left,result:!1}:"left"===g&&c.lastWidth-e+c.x<l.left?{fix:e+(c.lastWidth-e+c.x)-l.left,result:!1}:e<c.minWidth?{fix:c.minWidth,result:!1}:
e>c.maxWidth?{fix:c.maxWidth,result:!1}:{result:!0,fix:e}},_resize:function(b,d,c){for(var h=this._resizeMethods.length,l=0;l<h;l++)if(this._resizeMethods[l]instanceof Function)this._resizeMethods[l]({element:b,x:d,y:c,self:this});this._performResizeLayout()},resize:function(b,d){if(this.resizable){var c=b-this.host.width(),h=d-this.host.height(),l="right";0!==h&&(l="bottom");this._resizeDirection=l;this._prepareResizeMethods(this._resizeDirection);this._resizeBackupData();this.isResizing=!0;this._resize(this.resizeTarget,
c,h);this.isResizing=!1}},_setResizeChildrenSize:function(b,d){for(var c=this.resizeTargetChildren.length;c;)if(c--,"width"===d){var h=this.resizeTargetChildren[c].lastWidth-(this.resizeTarget.lastWidth-b);h<this.resizeTarget.maxWidth&&0<h&&this.resizeTargetChildren[c].width(h)}else h=this.resizeTargetChildren[c].lastHeight-(this.resizeTarget.lastHeight-b),h<this.resizeTarget.maxHeight&&0<h&&this.resizeTargetChildren[c].height(h)},_resizeRight:function(e){var c=e.element.lastWidth+e.x,g=e.self._validateResize(c,
0,"horizontal",e.element,"right");g.result||(c=g.fix);e.element.width()!==c&&(e.self._setResizeChildrenSize(c,"width"),e.element.width(c),0<=e.self.width.toString().indexOf("%")&&(g=b(document.body).width()/100,e.element[0].style.width=1/g*c+"%",e.self._setChildrenLayout()),e.self._raiseResizeEvent(0));return c},_resizeLeft:function(e){var c=e.element.lastWidth-e.x,g=e.self._validateResize(c,0,"horizontal",e.element,"left"),h=e.element.x+e.x;if(g.result)return e.element.width()!==c&&(e.self._setResizeChildrenSize(c,
"width"),e.element.width(c),0<=e.self.width.toString().indexOf("%")&&(g=b(document.body).width()/100,e.element[0].style.width=1/g*c+"%",e.self._setChildrenLayout()),e.element[0].style.left=e.self._toPx(h),e.self._raiseResizeEvent(0)),c},_resizeBottom:function(e){var c=e.element.lastHeight+e.y,g=e.self._validateResize(0,c,"vertical",e.element,"bottom");g.result||(c=g.fix);e.element.height()!==c&&(e.self._setResizeChildrenSize(c,"height"),e.element.height(c),0<=e.self.height.toString().indexOf("%")&&
(g=b(document.body).height()/100,e.element[0].style.height=1/g*c+"%",e.self._setChildrenLayout()),e.self._raiseResizeEvent(0));return c},_resizeTop:function(e){var c=e.element.lastHeight-e.y,g=e.self._validateResize(0,c,"vertical",e.element,"top"),h=e.element.y+e.y;if(g.result)return e.element.height()!==c&&(e.self._setResizeChildrenSize(c,"height"),e.element.height(c),0<=e.self.height.toString().indexOf("%")&&(g=b(document.body).height()/100,e.element[0].style.height=1/g*c+"%",e.self._setChildrenLayout()),
e.element[0].style.top=e.self._toPx(h),e.self._raiseResizeEvent(0)),c},_raiseResizeEvent:function(e){var c=this._resizeEvents[e],g=b.Event(c),h={};h.width=parseInt(this.resizeTarget[0].style.width,10);h.height=parseInt(this.resizeTarget[0].style.height,10);g.args=h;0===e&&(c=this._resizeEvents[2],e=b.Event(c),e.args=h,this.resizeTarget.trigger(e));return this.resizeTarget.trigger(g)}}}(jqxBaseFramework);c.extend(c.jqx._jqxWindow.prototype,b)})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxInput","",{});c.extend(c.jqx._jqxInput.prototype,{defineInstance:function(){var b={disabled:!1,filter:this._filter,sort:this._sort,highlight:this._highlight,dropDownWidth:null,renderer:this._renderer,opened:!1,$popup:document.createElement("ul"),source:[],roundedCorners:!0,searchMode:"default",placeHolder:"",width:null,height:null,value:"",rtl:!1,hint:!0,displayMember:"",valueMember:"",events:["select","open","close","change"],popupZIndex:1E3,items:8,minLength:1,maxLength:null};
if(this===c.jqx._jqxInput.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(){if("none"===this.host.css("display")||!1===document.body.contains(this.element))this._initiallyHidden=!0;this._popupHelper=c(this.$popup);this.render()},render:function(){var b=this;this.input=this.element;if(b.isMaterialized()&&this.input instanceof HTMLInputElement){var d=this.host.children();c.each(d,function(e){var f="jqx-input-group-addon";c(this).removeClass(b.toThemeProperty("jqx-rc-all"));
0===e&&(f+=" jqx-rc-l");e===d.length-1&&(f+=" jqx-rc-r");this!==b.element&&(f+=" jqx-fill-state-normal");this.className+=" "+b.toThemeProperty(f)});var e=c("<div></div>");e.addClass(b.toThemeProperty("jqx-input-group"));this.host.after(e);var f=this.element,g=this.host.data();e.append(f);var h=c("<label></label");this.hint&&(h[0].innerHTML=this.placeHolder);h.addClass(b.toThemeProperty("jqx-input-label"));e.append(h);var l=c("<span></span>");e.append(l);l.addClass(b.toThemeProperty("jqx-input-bar"));
e[0].id=this.element.id;this.element.removeAttribute("id");e[0].style.cssText=this.element.style.cssText;b.input=b.element;this.input instanceof HTMLInputElement||(this.input=this.host.find("input"),0<this.input.length&&(this.input=this.input[0]),c(this.input).addClass(this.toThemeProperty("jqx-input-widget")));this.label=h;this.bar=l;this.element.style.cssText="";this.host=e;this.element=e[0];this.host.data(g);b=this;b.template&&(b.bar.addClass(b.toThemeProperty("jqx-"+b.template)),b.label.addClass(b.toThemeProperty("jqx-"+
b.template)));0<d.length&&(b._hasAddons=!0)}else if("textarea"===this.element.nodeName.toLowerCase())this.element.style.overflow="auto";else if("div"===this.element.nodeName.toLowerCase()){this.baseHost=this.element;var f=b.element.getElementsByTagName("input"),q=!1;c.each(f,function(){var b=this.type;if(null==b||"text"===b||"textarea"===b)return f=c(this),q=!0,!1});if(!q)throw Error("jqxInput: Missing Text Input in the Input Group");0<f.length&&(this.baseHost=c(this.element),b.baseElement=b.element,
g=this.host.data(),this.host=f,this.element=f[0],b.input=f[0],this.host.data(g),b.baseElement.className+=" "+b.toThemeProperty("jqx-widget jqx-rc-all jqx-input-group"),d=this.baseHost.children(),c.each(d,function(e){var f="jqx-input-group-addon";c(this).removeClass(b.toThemeProperty("jqx-rc-all"));0===e&&(f+=" jqx-rc-l");e===d.length-1&&(f+=" jqx-rc-r");this!==b.element&&(f+=" jqx-fill-state-normal");this.className+=" "+b.toThemeProperty(f)}))}this.addHandlers();this.rtl&&(b.element.className+=" "+
b.toThemeProperty("jqx-rtl"));b.element.setAttribute("role","textbox");c.jqx.aria(this,"aria-autocomplete","both");c.jqx.aria(this,"aria-disabled",this.disabled);c.jqx.aria(this,"aria-readonly",!1);c.jqx.aria(this,"aria-multiline",!1);this.source&&this.source.length&&c.jqx.aria(this,"aria-haspopup",!0);""!==this.value&&(this.input.value=this.value);this._oldsource=this.source;this._updateSource()},_updateSource:function(){var b=this,d=function(d){if(void 0===d)return null;if("string"===typeof d||
d instanceof String)return{label:d,value:d};if("string"!==typeof d&&!1===d instanceof String){var e="",c="";""!==b.displayMember&&void 0!==b.displayMember&&d[b.displayMember]&&(e=d[b.displayMember]);""!==b.valueMember&&void 0!==b.valueMember&&(c=d[b.valueMember]);""===e&&(e=d.label);""===c&&(c=d.value);return{label:e,value:c}}return d},e=function(b){for(var e=[],c=0;c<b.length;c++)e[c]=d(b[c]);return e};if(this.source&&this.source._source){this.adapter=this.source;if(null!=this.adapter._source.localdata)this.adapter.unbindBindingUpdate(this.element.id),
this.adapter.bindBindingUpdate(this.element.id,function(){b.source=e(b.adapter.records)});else{var f={};this.adapter._options.data?c.extend(b.adapter._options.data,f):(this.source._source.data&&c.extend(f,this.source._source.data),this.adapter._options.data=f);this.adapter.unbindDownloadComplete(this.element.id);this.adapter.bindDownloadComplete(this.element.id,function(){b.source=e(b.adapter.records)})}this.source.dataBind()}else c.isFunction(this.source)||(this.source=e(this.source))},_refreshClasses:function(b){b=
b?"addClass":"removeClass";var d="jqx-widget-content jqx-input-widget jqx-input jqx-widget",e="jqx-popup jqx-input-popup jqx-menu jqx-menu-vertical jqx-menu-dropdown jqx-widget jqx-widget-content";c.jqx.browser.msie&&(e+=" jqx-noshadow");this.roundedCorners&&(d+=" jqx-rc-all",e+=" jqx-rc-all");this.disabled?d+=" jqx-fill-state-disabled":this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled"));this.host[b](this.toThemeProperty(d));this._popupHelper[b](this.toThemeProperty(e))},selectAll:function(){var b=
this.host;!1===b[0]instanceof HTMLInputElement&&(b=c(this.input));setTimeout(function(){if("selectionStart"in b[0])b[0].focus(),b[0].setSelectionRange(0,b[0].value.length);else{var d=b[0].createTextRange();d.collapse(!0);d.moveEnd("character",b[0].value.length);d.moveStart("character",0);d.select()}},10)},selectLast:function(){var b=this.host;!1===b[0]instanceof HTMLInputElement&&(b=c(that.input));this.selectStart(b[0].value.length)},selectFirst:function(){this.selectStart(0)},selectStart:function(b){var d=
this.host;!1===d[0]instanceof HTMLInputElement&&(d=c(this.input));setTimeout(function(){if("selectionStart"in d[0])d[0].focus(),d[0].setSelectionRange(b,b);else{var e=d[0].createTextRange();e.collapse(!0);e.moveEnd("character",b);e.moveStart("character",b);e.select()}},10)},focus:function(){try{var b=this;b.element.focus();setTimeout(function(){b.element.focus()},25)}catch(d){}},resize:function(b,d){this.width=b;this.height=d;this.refresh()},refresh:function(){this._refreshClasses(!1);this._refreshClasses(!0);
if(this.baseHost){null!=this.width&&-1!=this.width.toString().indexOf("px")?this.baseElement.style.width=parseInt(this.width)+"px":void 0==this.width||isNaN(this.width)||(this.baseElement.style.width=this.width+"px");null!=this.height&&-1!=this.height.toString().indexOf("px")?this.baseElement.style.height=parseInt(this.height)+"px":void 0==this.height||isNaN(this.height)||(this.baseElement.style.height=this.height+"px");var b=this,d=c.jqx.browser.msie&&9>c.jqx.browser.version,e=0;c.each(this.baseHost.children(),
function(){this.style.height="100%";this!==b.element&&(e+=c(this).outerWidth())});b._addonsWidth=e;if(d){var f=Math.max(0,b.baseElement.offsetHeight-2);b.element.style.width=Math.max(0,b.baseElement.offsetWidth-e-1)+"px";b.element.style.minHeight=f+"px";b.element.style.lineHeight=f+"px"}else b.element.style.width="calc(100% - "+e+"px)";c.jqx.utilities.resize(b.baseHost,function(){if(d&&"string"===typeof b.width&&-1!==b.width.indexOf("%")&&!b._initiallyHidden)b.element.style.width=b.baseElement.offsetWidth-
b._addonsWidth-1+"px";else if(b._initiallyHidden){b._addonsWidth=b._getAddonsWidth();if(d){b.element.style.width=b.baseElement.offsetWidth-b._addonsWidth-1+"px";var e=b.baseElement.offsetHeight-2;b.element.style.minHeight=e+"px";b.element.style.lineHeight=e+"px"}else b.element.style.width="calc(100% - "+b._addonsWidth+"px)";b._initiallyHidden=!1}})}else null!=this.width&&-1!=this.width.toString().indexOf("px")?this.element.style.width=parseInt(this.width)+"px":void 0==this.width||isNaN(this.width)?
this.element.style.width=this.width:this.element.style.width=this.width+"px",null!=this.height&&-1!=this.height.toString().indexOf("px")?this.element.style.height=parseInt(this.height)+"px":void 0==this.height||isNaN(this.height)?this.element.style.height=this.height:this.element.style.height=this.height+"px",this._hasAddons&&(this._addonsWidth=35,this.input.style.width="calc(100% - "+this._addonsWidth+"px)");this.disabled?this.element.setAttribute("disabled",!0):this.element.removeAttribute("disabled");
this.maxLength&&this.element.setAttribute("maxlength",this.maxLength);this.element.getAttribute("placeholder")||this._refreshPlaceHolder()},_refreshPlaceHolder:function(){this.isMaterialized()&&this.hint||("placeholder"in this.input&&!(c.jqx.browser.msie&&9>c.jqx.browser.version)?this.input.setAttribute("placeHolder",this.placeHolder):""===this.input.value&&(this.input.value=this.placeHolder));this.hint&&(""!==this.input.value?this.element.setAttribute("hint",!0):this.element.removeAttribute("hint"),
this.label&&(this.label.innerHTML=this.placeHolder))},destroy:function(){this.removeHandlers();this.baseHost?this.baseHost.remove():this.host.remove();this.$popup&&this._popupHelper.remove()},propertiesChangedHandler:function(b,d,e){e.width&&e.height&&2===Object.keys(e).length&&b.refresh()},propertyChangedHandler:function(b,d,e,f){if("width"===d&&f!==e)b.baseHost?(b.baseElement.style.width=b._toPx(f),c.jqx.browser.msie&&9>c.jqx.browser.version&&(b.element.style.width=b.baseElement.offsetWidth-b._addonsWidth-
1+"px")):b.element.style.width=b._toPx(f);else if("placeHolder"===d)"placeholder"in b.element&&!(c.jqx.browser.msie&&9>c.jqx.browser.version)||b.input.value!==e||(b.input.value=""),b._refreshPlaceHolder();else if(!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2===Object.keys(b.batchUpdate).length))if("theme"===d&&c.jqx.utilities.setTheme(e,f,b.host),"opened"===d)f?b.open():b.close();else{"source"===d&&(b._oldsource=f,b._updateSource());if("displayMember"===d||"valueMember"===d)b.source=
b._oldsource,b._updateSource();"disabled"===d&&c.jqx.aria(b,"aria-disabled",b.disabled);"value"===d&&(b.input.value=f,b._refreshPlaceHolder());b.refresh()}},select:function(b,d,e){d=this._find("jqx-fill-state-pressed",this._popupHelper);b=d.getAttribute("data-value");d=d.getAttribute("data-name");this.input.value=this.renderer(d,this.input.value);this.selectedItem={label:d,value:b};this.element.setAttribute("data-value",b);this.element.setAttribute("data-label",d);this._raiseEvent("0",{item:{label:d,
value:b},label:d,value:b});this._raiseEvent("3",{type:e,item:{label:d,value:b},label:d,value:b});this.value=d;return this.close()},val:function(b){if(0===arguments.length||null!=b&&"object"===typeof b&&!b.label&&!b.value)return""!==this.displayMember&&""!==this.valueMember&&this.selectedItem?""===this.input.value?"":this.selectedItem:this.input.value;if(b&&b.label)return this.selectedItem={label:b.label,value:b.value},this.element.setAttribute("data-value",b.value),this.element.setAttribute("data-label",
b.label),this.value=b,this.input.value=b.label,this.input&&(this.input.value=b.label),this.input.value;this.value=b;this.input.value=b;this.element.setAttribute("data-value",b);this.element.setAttribute("data-label",b);b&&b.label?this._raiseEvent("3",{type:null,item:{label:b.label,value:b.value},label:b.label,value:b.value}):this._raiseEvent("3",{type:null,item:{label:b,value:b},label:b,value:b});this._refreshPlaceHolder();return this.input.value},_raiseEvent:function(b,d){void 0===d&&(d={owner:null});
var e=this.events[b];d.owner=this;e=new c.Event(e);e.owner=this;e.args=d;e.preventDefault&&e.preventDefault();return this.host.trigger(e)},_renderer:function(b){return b},open:function(){if(!c.jqx.isHidden(this.host)){var b=c.extend({},this.host.coord(!0),{height:this.element.offsetHeight});if(this.$popup.parentNode!==document.body){var d=this.element.id+"_popup";this.$popup.id=d;c.jqx.aria(this,"aria-owns",d);document.body.appendChild(this.$popup)}this.$popup.style.position="absolute";this.$popup.style.zIndex=
this.popupZIndex;this.$popup.style.top=this._toPx(b.top+b.height);this.$popup.style.left=this._toPx(b.left);this.$popup.style.display="block";var e=0,b=this._popupHelper.children();c.each(b,function(){e+=c(this).outerHeight()+1});this.$popup.style.height=this._toPx(e);this.opened=!0;this._raiseEvent("1",{popup:this.$popup});c.jqx.aria(this,"aria-expanded",!0);return this}},close:function(){this.$popup.style.display="none";this.opened=!1;this._raiseEvent("2",{popup:this.$popup});c.jqx.aria(this,"aria-expanded",
!1);this._refreshPlaceHolder();return this},suggest:function(){var b;this.query=this.input.value;return!this.query||this.query.length<this.minLength?this.opened?this.close():this:(b=c.isFunction(this.source)?this.source(this.query,c.proxy(this.load,this)):this.source)?this.load(b):this},load:function(b){for(var d=[],e=0;e<b.length;e++){var c=b[e];this.filter(c)&&d.push(c)}d=this.sort(d);return d.length?this._render(d.slice(0,this.items)).open():this.opened?this.close():this},_filter:function(b){var d=
this.query,e=b;null!=b.label?e=b.label:this.displayMember&&(e=b[this.displayMember]);switch(this.searchMode){case "none":break;default:return c.jqx.string.containsIgnoreCase(e,d);case "contains":return c.jqx.string.contains(e,d);case "equals":return c.jqx.string.equals(e,d);case "equalsignorecase":return c.jqx.string.equalsIgnoreCase(e,d);case "startswith":return c.jqx.string.startsWith(e,d);case "startswithignorecase":return c.jqx.string.startsWithIgnoreCase(e,d);case "endswith":return c.jqx.string.endsWith(e,
d);case "endswithignorecase":return c.jqx.string.endsWithIgnoreCase(e,d)}},_sort:function(b){for(var d=[],e=[],c=[],g=0;g<b.length;g++){var h=b[g],l=h;h.label?l=h.label:this.displayMember&&(l=h[this.displayMember]);0===l.toString().toLowerCase().indexOf(this.query.toString().toLowerCase())?d.push(h):0<=l.toString().indexOf(this.query)?e.push(h):0<=l.toString().toLowerCase().indexOf(this.query.toString().toLowerCase())&&c.push(h)}return d.concat(e,c)},_highlight:function(b){var d=this.query,d=d.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,
"\\$&");return b.replace(new RegExp("("+d+")","ig"),function(b,d){return"<b>"+d+"</b>"})},_render:function(b){var d=this,e=d._popupHelper.children();if(0<e.length)for(var f=0;f<e.length;f++)c(e[f]).remove();var g=function(b,e){var c=b,f=document.createElement("li"),g=document.createElement("a"),v,y;g.setAttribute("href","#");f.appendChild(g);void 0!==b.value&&null!==b.value?(v=void 0!==b.label&&null!==b.label?b.label:b.value,y=b.value):void 0!==b.label&&null!==b.label?y=v=b.label:void 0!==d.displayMember&&
""!==d.displayMember?(v=b[d.displayMember],y=b[d.valueMember]):y=v=b;f.setAttribute("data-value",y);f.setAttribute("data-name",v);b.label?c=b.label:d.displayMember&&(c=b[d.displayMember]);g.innerHTML=d.highlight(c);c="";d.rtl&&(c=" jqx-rtl");0===e&&(c+=" jqx-fill-state-pressed");f.className=d.toThemeProperty("jqx-item jqx-menu-item jqx-rc-all"+c);d.$popup.appendChild(f);d.addHandler(f,"mouseenter",function(b){d.mouseenter(b)})};(function(b){for(var d=0;d<b.length;d++)g(b[d],d)})(b);this.$popup.style.width=
this.dropDownWidth?d._toPx(d.dropDownWidth):d._toPx(d.element.offsetWidth-6);return this},next:function(){var b=this._find("jqx-fill-state-pressed",this._popupHelper),d=b.nextSibling;c(b).removeClass(this.toThemeProperty("jqx-fill-state-pressed"));d||(d=this.$popup.firstChild);d.className+=" "+this.toThemeProperty("jqx-fill-state-pressed")},prev:function(){var b=this._find("jqx-fill-state-pressed",this._popupHelper),d=b.previousSibling;c(b).removeClass(this.toThemeProperty("jqx-fill-state-pressed"));
d||(d=this.$popup.lastChild);d.className+=" "+this.toThemeProperty("jqx-fill-state-pressed")},addHandlers:function(){var b=this,d=".jqxInput"+b.element.id;b.addHandler(b.host,"focus"+d,function(){b.onFocus()});b.addHandler(b.host,"blur"+d,function(){b.onBlur()});b.addHandler(b.host,"change"+d,function(d){if(!d.args){d.stopPropagation();d.preventDefault();var c=b.val();c&&c.label?(d=c.label,c=c.val):d=c;b._raiseEvent("3",{type:"keyboard",item:{label:d,value:c},label:d,value:c});b.value=d;b._refreshPlaceHolder()}});
b.addHandler(b.host,"keypress"+d,function(d){b.keypress(d)});b.addHandler(b.host,"keyup"+d,function(d){b.keyup(d)});b.addHandler(b.host,"keydown"+d,function(d){b.keydown(d)});b.addHandler(b.$popup,"mousedown"+d,function(d){b.click(d)})},removeHandlers:function(){var b=".jqxInput"+this.element.id;this.removeHandler(this.host,"change"+b);this.removeHandler(this.host,"focus"+b);this.removeHandler(this.host,"blur"+b);this.removeHandler(this.host,"keypress"+b);this.removeHandler(this.host,"keyup"+b);this.removeHandler(this.host,
"keydown"+b);this.removeHandler(this.$popup,"mousedown"+b)},move:function(b){if(this.opened){switch(b.keyCode){case 9:case 13:case 27:b.preventDefault();break;case 38:b.shiftKey||(b.preventDefault(),this.prev());break;case 40:b.shiftKey||(b.preventDefault(),this.next())}b.stopPropagation()}},keydown:function(b){this.suppressKeyPressRepeat=-1!==[40,38,9,13,27].indexOf(b.keyCode);this.move(b)},keypress:function(b){this.suppressKeyPressRepeat||this.move(b)},keyup:function(b){switch(b.keyCode){case 40:case 38:case 16:case 17:case 18:break;
case 9:case 13:if(!this.opened)return;this.select(b,this,"keyboard");break;case 27:if(!this.opened)return;this.close();break;default:var d=this;this.timer&&clearTimeout(this.timer);this.timer=setTimeout(function(){d.suggest()},300)}b.stopPropagation();b.preventDefault()},clear:function(){this.val("")},onBlur:function(){var b=this;setTimeout(function(){b.close()},150);b.host.removeClass(b.toThemeProperty("jqx-fill-state-focus"));b._refreshPlaceHolder()},onFocus:function(){this.element.className+=" "+
this.toThemeProperty("jqx-fill-state-focus");this._refreshPlaceHolder()},click:function(b){b.stopPropagation();b.preventDefault();this.select(b,this,"mouse")},mouseenter:function(b){c(this._find("jqx-fill-state-pressed",this._popupHelper)).removeClass(this.toThemeProperty("jqx-fill-state-pressed"));b.currentTarget.className+=" "+this.toThemeProperty("jqx-fill-state-pressed")},_toPx:function(b){return"number"===typeof b?b+"px":b},_find:function(b,d){for(var e=d.children(),c=0;c<e.length;c++){var g=
e[c];if(-1!==g.className.indexOf(b))return g}},_getAddonsWidth:function(){for(var b=this.baseHost.children(),d=0,e=0;e<b.length;e++)b[e]!==this.element&&(d+=c(b[e]).outerWidth());return d}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxNumberInput","",{});c.extend(c.jqx._jqxNumberInput.prototype,{defineInstance:function(){var b={value:0,decimal:0,min:-99999999,max:99999999,width:200,validationMessage:"Invalid value",height:25,textAlign:"right",readOnly:!1,promptChar:"_",decimalDigits:2,decimalSeparator:".",groupSeparator:",",groupSize:3,symbol:"",symbolPosition:"left",digits:8,negative:!1,negativeSymbol:"-",disabled:!1,inputMode:"advanced",spinButtons:!1,spinButtonsWidth:18,spinButtonsStep:1,autoValidate:!0,
spinMode:"advanced",enableMouseWheel:!0,touchMode:"auto",allowNull:!0,placeHolder:"",changeType:null,template:"",rtl:!1,hint:!0,events:"valueChanged textchanged mousedown mouseup keydown keyup keypress change".split(" "),aria:{"aria-valuenow":{name:"decimal",type:"number"},"aria-valuemin":{name:"min",type:"number"},"aria-valuemax":{name:"max",type:"number"},"aria-disabled":{name:"disabled",type:"boolean"}},invalidArgumentExceptions:["invalid argument exception"]};if(this===c.jqx._jqxNumberInput.prototype)return b;
c.extend(!0,this,b);return b},createInstance:function(b){""===this.promptChar&&(this.promptChar=" ");b=this.host.attr("value");void 0!=b&&(this.decimal=b);0===this.decimal&&(null!=this.value?this.decimal=this.value:null===this.value&&0!==this.decimal&&(this.value=this.decimal));this._createFromInput("jqxNumberInput");this.render()},_updateHint:function(){var b=this;b.hint&&b.isMaterialized()&&setTimeout(function(){0===b.numberInput[0].value.length?(b.element.removeAttribute("hint"),b.label[0].innerHTML=
b.placeHolder):b.element.setAttribute("hint",!0)})},_createFromInput:function(b){if("input"==this.element.nodeName.toLowerCase()){this.field=this.element;this.field.className&&(this._className=this.field.className);var d={title:this.field.title};this.field.value&&(this.decimal=parseFloat(this.field.value));if(this.field.getAttribute("min")){var e=this.field.getAttribute("min");this.min=parseFloat(e)}this.field.getAttribute("step")&&(e=this.field.getAttribute("step"),this.spinButtonsStep=parseFloat(e));
this.field.getAttribute("max")&&(e=this.field.getAttribute("max"),this.max=parseFloat(e));d.id=this.field.id.length?this.field.id.replace(/[^\w]/g,"_")+"_"+b:c.jqx.utilities.createId()+"_"+b;b=c("<div></div>",d);b[0].style.cssText=this.field.style.cssText;this.width||(this.width=c(this.field).width());this.height||(this.height=c(this.field).outerHeight());c(this.field).hide().after(b);e=this.host.data();this.host=b;this.host.data(e);this.element=b[0];this.element.id=this.field.id;this.field.id=d.id;
this._className&&(this.host.addClass(this._className),c(this.field).removeClass(this._className));this.field.tabIndex&&(d=this.field.tabIndex,this.field.tabIndex=-1,this.element.tabIndex=d)}},_doTouchHandling:function(){var b=this.savedValue;this.parsing||(this.parsing=!0);if(this.parsing){this.numberInput.val()&&0==this.numberInput.val().indexOf("-")?this.setvalue("negative",!0):this.setvalue("negative",!1);for(var d=this.numberInput.val(),e=0;e<d.length-1;e++){var c=d.substring(e,e+1);if(isNaN(parseFloat(c))&&
-1===this.symbol.toString().indexOf(c)&&"%"!=c&&"$"!=c&&"."!=c&&","!=c&&"-"!=c){this.numberInput[0].value=b;this.parsing=!1;return}}this.ValueString=this.GetValueString(this.numberInput.val(),this.decimalSeparator,""!=this.decimalSeparator);this._parseDecimalInSimpleMode();this.decimal=this.ValueString;this.getvalue("negative")&&(this.decimal="-"+this.ValueString);this.parsing=!1}},render:function(){this.host.attr({role:"spinbutton"});this.host.attr("data-role","input");c.jqx.aria(this);c.jqx.aria(this,
"aria-multiline",!1);var b=this;(this.officeMode||this.theme&&-1!=this.theme.indexOf("office"))&&18==this.spinButtonsWidth&&(this.spinButtonsWidth=15);if(c.jqx.mobile.isTouchDevice()||!0===this.touchMode)this.inputMode="textbox",this.spinMode="simple";""==this.decimalSeparator&&(this.decimalSeparator=" ");this.host.addClass(this.toThemeProperty("jqx-input"));this.host.addClass(this.toThemeProperty("jqx-rc-all"));this.host.addClass(this.toThemeProperty("jqx-widget"));this.host.addClass(this.toThemeProperty("jqx-widget-content"));
this.host.addClass(this.toThemeProperty("jqx-numberinput"));this.spinButtons?this._spinButtons():(this.numberInput=c("<input style='border:none;' autocomplete='off' type='textarea'/>").appendTo(this.host),this.numberInput.addClass(this.toThemeProperty("jqx-input-content")),this.numberInput.addClass(this.toThemeProperty("jqx-widget-content")));this.isMaterialized()||this.numberInput.attr("placeholder",this.placeHolder);var d=this.host.attr("name");d&&this.numberInput.attr("name",d);this.host.attr("tabindex")&&
(this.numberInput.attr("tabindex",this.host.attr("tabindex")),this.host.removeAttr("tabindex"));if(c.jqx.mobile.isTouchDevice()||!0===this.touchMode||"textbox"==this.inputMode)b=this,b.savedValue="",this.addHandler(this.numberInput,"focus",function(){b.savedValue=b.numberInput[0].value}),this.addHandler(this.numberInput,"change",function(){b._doTouchHandling()});c.data(this.host[0],"jqxNumberInput").jqxNumberInput=this;b=this;0<this.host.parents("form").length&&this.addHandler(this.host.parents("form"),
"reset",function(){setTimeout(function(){b.setDecimal(0)},10)});this.propertyChangeMap.disabled=function(b,d,c,f){f?(b.numberInput.addClass(e.toThemeProperty("jqx-input-disabled")),b.numberInput.attr("disabled",!0)):(b.host.removeClass(e.toThemeProperty("jqx-input-disabled")),b.numberInput.attr("disabled",!1));b.spinButtons&&b.host.jqxRepeatButton&&(b.upbutton.jqxRepeatButton({disabled:f}),b.downbutton.jqxRepeatButton({disabled:f}))};this.disabled&&(this.numberInput.addClass(this.toThemeProperty("jqx-input-disabled")),
this.numberInput.attr("disabled",!0),this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled")));this.selectedText="";this.decimalSeparatorPosition=-1;var e=this;this.oldValue=this._value();this.items=[];var d=this.value,f=this.decimal;this._initializeLiterals();this._render();this.setDecimal(null!==d?f:null);b=this;setTimeout(function(){},100);this._addHandlers();c.jqx.utilities.resize(this.host,function(){b._render()})},refresh:function(b){b||this._render()},wheel:function(b,d){if(d.enableMouseWheel){d.changeType=
"mouse";var e=0;b||(b=window.event);b.originalEvent&&b.originalEvent.wheelDelta&&(b.wheelDelta=b.originalEvent.wheelDelta);b.wheelDelta?e=b.wheelDelta/120:b.detail&&(e=-b.detail/3);if(e)return e=d._handleDelta(e),b.preventDefault&&b.preventDefault(),null!=b.originalEvent&&(b.originalEvent.mouseHandled=!0),void 0!=b.stopPropagation&&b.stopPropagation(),e?(e=!1,b.returnValue=e):!1;b.preventDefault&&b.preventDefault();b.returnValue=!1}},_handleDelta:function(b){0>b?this.spinDown():this.spinUp();return!0},
_addHandlers:function(){var b=this;this.addHandler(this.numberInput,"paste",function(d){var f=b._selection();d.preventDefault();d.originalEvent.clipboardData?content=(d.originalEvent||d).clipboardData.getData("text/plain"):window.clipboardData&&(content=window.clipboardData.getData("Text"));this.selectedText=content;c.data(document.body,"jqxSelection",this.selectedText);"simple"!=b.inputMode?b._pasteSelectedText():b.val(content);setTimeout(function(){b._setSelectionStart(f.start)})});this.addHandler(this.numberInput,
"mousedown",function(d){return b._raiseEvent(2,d)});this._mousewheelfunc=this._mousewheelfunc||function(d){if(!b.editcell)return b.wheel(d,b),!1};this.removeHandler(this.host,"mousewheel",this._mousewheelfunc);this.addHandler(this.host,"mousewheel",this._mousewheelfunc);var d="";this.addHandler(this.numberInput,"focus",function(e){c.data(b.numberInput,"selectionstart",b._selection().start);b.host.addClass(b.toThemeProperty("jqx-fill-state-focus"));b.spincontainer&&b.spincontainer.addClass(b.toThemeProperty("jqx-numberinput-focus"));
d=b.numberInput.val();b._savedValue=b.decimal});this.addHandler(this.numberInput,"blur",function(e){"simple"==b.inputMode&&b._exitSimpleInputMode(e,b,!1,d);if(b.autoValidate){var f=parseFloat(b.decimal);b.getvalue("negative")&&0<b.decimal&&(f=-parseFloat(b.decimal));f>b.max&&(b._disableSetSelection=!0,b.setDecimal(b.max),b._disableSetSelection=!1);f<b.min&&(b._disableSetSelection=!0,b.setDecimal(b.min),b._disableSetSelection=!1)}b.host.removeClass(b.toThemeProperty("jqx-fill-state-focus"));b.spincontainer&&
b.spincontainer.removeClass(b.toThemeProperty("jqx-numberinput-focus"));b.numberInput.val()!=d&&(b._raiseEvent(7,e),c.jqx.aria(b,"aria-valuenow",b.decimal),b.element.value=b.decimal);return!0});this.addHandler(this.numberInput,"mouseup",function(d){return b._raiseEvent(3,d)});this.addHandler(this.numberInput,"keydown",function(d){b.changeType="keyboard";return b._raiseEvent(4,d)});this.addHandler(this.numberInput,"keyup",function(d){return b._raiseEvent(5,d)});this.addHandler(this.numberInput,"keypress",
function(d){return b._raiseEvent(6,d)})},focus:function(){try{this.numberInput.focus()}catch(b){}},_removeHandlers:function(){this.removeHandler(this.numberInput,"mousedown");c.jqx.mobile.isOperaMiniMobileBrowser()&&this.removeHandler(c(document),"click."+this.element.id,this._exitSimpleInputMode,this);this.removeHandler(this.numberInput,"paste");this.removeHandler(this.numberInput,"focus");this.removeHandler(this.numberInput,"blur");this.removeHandler(this.numberInput,"mouseup");this.removeHandler(this.numberInput,
"keydown");this.removeHandler(this.numberInput,"keyup");this.removeHandler(this.numberInput,"keypress")},_spinButtons:function(){if(this.host.jqxRepeatButton){this.numberInput?this.numberInput.css("float","left"):(this.numberInput=c("<input autocomplete='off' style='border: none; position: relative; float: left;' type='textarea'/>"),this.numberInput.appendTo(this.host),this.numberInput.addClass(this.toThemeProperty("jqx-input-content")),this.numberInput.addClass(this.toThemeProperty("jqx-widget-content")));
this.spincontainer&&(this.upbutton&&this.upbutton.jqxRepeatButton("destroy"),this.downbutton&&this.downbutton.jqxRepeatButton("destroy"),this.spincontainer.remove());this.spincontainer=c('<div style="float: right; height: 100%; overflow: hidden; position: relative;"></div>');this.rtl&&(this.spincontainer.css("float","right"),this.numberInput.css("float","right"),this.spincontainer.css("left","-1px"));this.host.append(this.spincontainer);this.upbutton=c('<div style="overflow: hidden; padding: 0px; margin-left: -1px; position: relative;"><div></div></div>');
this.spincontainer.append(this.upbutton);this.upbutton.jqxRepeatButton({overrideTheme:!0,disabled:this.disabled,roundedCorners:"top-right"});this.downbutton=c('<div style="overflow: hidden; padding: 0px; margin-left: -1px; position: relative;"><div></div></div>');this.spincontainer.append(this.downbutton);this.downbutton.jqxRepeatButton({overrideTheme:!0,disabled:this.disabled,roundedCorners:"bottom-right"});this.template&&(this.upbutton.addClass(this.toThemeProperty("jqx-"+this.template)),this.downbutton.addClass(this.toThemeProperty("jqx-"+
this.template)));var b=this;this.downbutton.addClass(this.toThemeProperty("jqx-fill-state-normal jqx-action-button"));this.upbutton.addClass(this.toThemeProperty("jqx-fill-state-normal jqx-action-button"));this.upbutton.addClass(this.toThemeProperty("jqx-rc-tr"));this.downbutton.addClass(this.toThemeProperty("jqx-rc-br"));this.addHandler(this.downbutton,"mouseup",function(d){b.disabled||(b.downbutton.removeClass(b.toThemeProperty("jqx-fill-state-pressed")),b._downArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-down-selected")))});
this.addHandler(this.upbutton,"mouseup",function(d){b.disabled||(b.upbutton.removeClass(b.toThemeProperty("jqx-fill-state-pressed")),b._upArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-up-selected")))});this.removeHandler(c(document),"mouseup."+this.element.id);this.addHandler(c(document),"mouseup."+this.element.id,function(d){b.upbutton.removeClass(b.toThemeProperty("jqx-fill-state-pressed"));b._upArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-up-selected"));b.downbutton.removeClass(b.toThemeProperty("jqx-fill-state-pressed"));
b._downArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-down-selected"))});this.addHandler(this.downbutton,"mousedown",function(d){if(!b.disabled)return c.jqx.browser.msie&&9>c.jqx.browser.version&&(b._inputSelection=b._selection()),b.downbutton.addClass(b.toThemeProperty("jqx-fill-state-pressed")),b._downArrow.addClass(b.toThemeProperty("jqx-icon-arrow-down-selected")),d.preventDefault(),d.stopPropagation(),!1});this.addHandler(this.upbutton,"mousedown",function(d){if(!b.disabled)return c.jqx.browser.msie&&
9>c.jqx.browser.version&&(b._inputSelection=b._selection()),b.upbutton.addClass(b.toThemeProperty("jqx-fill-state-pressed")),b._upArrow.addClass(b.toThemeProperty("jqx-icon-arrow-up-selected")),d.preventDefault(),d.stopPropagation(),!1});this.addHandler(this.upbutton,"mouseenter",function(d){b.upbutton.addClass(b.toThemeProperty("jqx-fill-state-hover"));b._upArrow.addClass(b.toThemeProperty("jqx-icon-arrow-up-hover"))});this.addHandler(this.upbutton,"mouseleave",function(d){b.upbutton.removeClass(b.toThemeProperty("jqx-fill-state-hover"));
b._upArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-up-hover"))});this.addHandler(this.downbutton,"mouseenter",function(d){b.downbutton.addClass(b.toThemeProperty("jqx-fill-state-hover"));b._downArrow.addClass(b.toThemeProperty("jqx-icon-arrow-down-hover"))});this.addHandler(this.downbutton,"mouseleave",function(d){b.downbutton.removeClass(b.toThemeProperty("jqx-fill-state-hover"));b._downArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-down-hover"))});this.upbutton.css("border-width","0px");
this.downbutton.css("border-width","0px");this.disabled?(this.upbutton[0].disabled=!0,this.downbutton[0].disabled=!0):(this.upbutton[0].disabled=!1,this.downbutton[0].disabled=!1);this.spincontainer.addClass(this.toThemeProperty("jqx-input"));this.spincontainer.addClass(this.toThemeProperty("jqx-rc-r"));this.spincontainer.css("border-width","0px");this.rtl?this.spincontainer.css("border-right-width","1px"):this.spincontainer.css("border-left-width","1px");this._upArrow=this.upbutton.find("div");this._downArrow=
this.downbutton.find("div");this._upArrow.addClass(this.toThemeProperty("jqx-icon-arrow-up"));this._downArrow.addClass(this.toThemeProperty("jqx-icon-arrow-down"));this._upArrow.addClass(this.toThemeProperty("jqx-input-icon"));this._downArrow.addClass(this.toThemeProperty("jqx-input-icon"));b=this;this._upArrow.hover(function(){b.disabled||b._upArrow.addClass(b.toThemeProperty("jqx-icon-arrow-up-hover"))},function(){b._upArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-up-hover"))});this._downArrow.hover(function(){b.disabled||
b._downArrow.addClass(b.toThemeProperty("jqx-icon-arrow-down-hover"))},function(){b._downArrow.removeClass(b.toThemeProperty("jqx-icon-arrow-down-hover"))});var d=c.jqx.mobile.isTouchDevice(),e="click";d&&(e=c.jqx.mobile.getTouchEventName("touchstart"));d&&(this.addHandler(this.downbutton,"click",function(d){b.spinDown()}),this.addHandler(this.upbutton,"click",function(d){b.spinUp()}));this.addHandler(this.downbutton,e,function(e){d?(e.preventDefault(),e.stopPropagation()):(0==b._selection().start&&
b._setSelectionStart(b.numberInput.val().length),c.jqx.browser.msie&&9>c.jqx.browser.version&&b._setSelectionStart(b._inputSelection.start));b.spinDown();return!1});this.addHandler(this.upbutton,e,function(e){d?(e.preventDefault(),e.stopPropagation()):(0==b._selection().start&&b._setSelectionStart(b.numberInput.val().length),c.jqx.browser.msie&&9>c.jqx.browser.version&&b._setSelectionStart(b._inputSelection.start));b.spinUp();return!1})}else throw Error("jqxNumberInput: Missing reference to jqxbuttons.js.");
},spinDown:function(){var b=this.decimal;if("none"!=this.spinMode)if(null==this.decimal)this.setDecimal(0);else{var d=this.getvalue("negative"),e=d?-1:0;(c.jqx.mobile.isTouchDevice()||"textbox"==this.inputMode)&&this._doTouchHandling();if(!this.disabled){var f=this._selection(),g=this.decimal,h=this.getDecimal();if(h<this.min)this.setDecimal(this.min),this._setSelectionStart(f.start),this.spinDown();else if(h>this.max)this.setDecimal(this.max),this._setSelectionStart(f.start),this.spinDown();else{0>
this.spinButtonsStep&&(this.spinButtonsStep=1);var l=parseInt(this.decimal)-this.spinButtonsStep,l=l.toString().length,q=e+l<=this.digits;if("advanced"!=this.spinMode){if(h-this.spinButtonsStep>=this.min&&q){l=1;for(q=0;q<this.decimalDigits;q++)l*=10;h=l*h-l*this.spinButtonsStep;h=this._parseDecimalValueToEditorValue(h/l);this.setDecimal(h)}}else{d=this._getspindecimal();this._getSeparatorPosition();h=parseFloat(d.decimal);0>this.spinButtonsStep&&(this.spinButtonsStep=1);var l=parseInt(h)-this.spinButtonsStep,
l=l.toString().length,q=e+l<=this.digits,l=1,r=d.decimal.indexOf(".");if(-1!=r){for(var t=d.decimal.length-r-1,l=1,q=0;q<t;q++)l*=10;h-=new Number(this.spinButtonsStep/l);h=h.toFixed(t);r=h.toString().indexOf(".");-1==r&&(h=h.toString()+".");t=h.toString()+d.afterdecimal;t=new Number(t);t=t.toFixed(this.decimalDigits);t>=this.min&&(t=this._parseDecimalValueToEditorValue(t),this.setDecimal(t))}else h-this.spinButtonsStep>=this.min&&q&&(h=l*h-l*this.spinButtonsStep,t=(h/l).toString()+d.afterdecimal,
t>=this.min&&(t=this._parseDecimalValueToEditorValue(t),this.setDecimal(t)))}void 0==t||"simple"!=this.inputMode?(this._setSelectionStart(f.start),this.savedValue=this.numberInput[0].value):(t=this.decimal.toString(),d=this.getvalue("negative"),0==e&&d?this._setSelectionStart(f.start+1):void 0==t||void 0!=g&&g.toString().length!=t.length?d?this._setSelectionStart(f.start+1):this._setSelectionStart(f.start-1):this._setSelectionStart(f.start));b!=this.decimal&&(c.jqx.mobile.isTouchDevice()&&this._raiseEvent(0,
{}),this._raiseEvent(7,{}));c.jqx.aria(self,"aria-valuenow",this.decimal)}}}},_getspindecimal:function(){var b=this._selection(),d="";this._getSeparatorPosition();var e=this._getVisibleItems(),c=this._getHiddenPrefixCount(),g=this.numberInput.val();this.numberInput.val().length==b.start&&0==b.length&&(this._setSelection(b.start,b.start+1),b=this._selection());var h="advanced"!=this.inputMode,b=b.start;0===b&&b++;1===b&&"left"===this.symbolPosition&&""!==this.symbol&&(b+=this.symbol.length);for(var l=
0;l<b;l++)if(h){var q=g.substring(l,l+1),r=!isNaN(parseInt(q));r&&(d+=q);q==this.decimalSeparator&&(d+=q)}else e[l].canEdit&&e[l].character!=this.promptChar?d+=e[l].character:e[l].canEdit||-1==this.decimalSeparatorPosition||e[l]!=e[this.decimalSeparatorPosition-c]||(0==d.length&&(d="0"),d+=e[l].character);for(var t="",l=b;l<e.length;l++)h?(q=g.substring(l,l+1),(r=!isNaN(parseInt(q)))&&(t+=q),q==this.decimalSeparator&&(t+=q)):e[l].canEdit&&e[l].character!=this.promptChar?t+=e[l].character:e[l].canEdit||
-1==this.decimalSeparatorPosition||e[l]!=e[this.decimalSeparatorPosition-c]||(t+=e[l].character);return{decimal:this.getvalue("negative")?"-"+this._parseDecimalValue(d).toString():this._parseDecimalValue(d).toString(),afterdecimal:this._parseDecimalValue(t)}},_parseDecimalValue:function(b){if("."!=this.decimalSeparator){var d=b.toString().indexOf(this.decimalSeparator);if(0<=d)return b.toString().substring(0,d)+"."+b.toString().substring(d+1)}return b},_parseDecimalValueToEditorValue:function(b){if("."!=
this.decimalSeparator){var d=b.toString().indexOf(".");if(0<=d)return b.toString().substring(0,d)+this.decimalSeparator+b.toString().substring(d+1)}return b},spinUp:function(){var b=this.decimal;if("none"!=this.spinMode)if(null==this.decimal)this.setDecimal(0);else{(c.jqx.mobile.isTouchDevice()||"textbox"==this.inputMode)&&this._doTouchHandling();var d=this.getvalue("negative"),e=d?-1:0;if(!this.disabled){var f=this._selection(),g=this.decimal,h=this.getDecimal();if(h<this.min)this.setDecimal(this.min),
this._setSelectionStart(f.start),this.spinUp();else if(h>this.max)this.setDecimal(this.max),this._setSelectionStart(f.start),this.spinUp();else{0>this.spinButtonsStep&&(this.spinButtonsStep=1);var l=parseInt(this.decimal)+this.spinButtonsStep,l=l.toString().length,q=e+l<=this.digits;if("advanced"!=this.spinMode){if(h+this.spinButtonsStep<=this.max&&q){l=1;for(d=0;d<this.decimalDigits;d++)l*=10;h=l*h+l*this.spinButtonsStep;h=this._parseDecimalValueToEditorValue(h/l);this.setDecimal(h)}}else{var r=
this._getspindecimal();this._getSeparatorPosition();h=parseFloat(r.decimal);0>this.spinButtonsStep&&(this.spinButtonsStep=1);var l=parseInt(h)+this.spinButtonsStep,l=l.toString().length,q=e+l<=this.digits,l=1,t=r.decimal.indexOf(".");if(-1!=t){for(var v=r.decimal.length-t-1,l=1,d=0;d<v;d++)l*=10;h+=new Number(this.spinButtonsStep/l);h=h.toFixed(v);t=h.toString().indexOf(".");-1==t&&(h=h.toString()+".");v=h.toString()+r.afterdecimal;v=new Number(v);v=v.toFixed(this.decimalDigits);h=(new Number(v)).toFixed(this.decimalDigits);
h<=this.max?(v=this._parseDecimalValueToEditorValue(v),this.setDecimal(v)):v=void 0}else h+this.spinButtonsStep<=this.max&&q&&(h=l*h+l*this.spinButtonsStep,v=(h/l).toString()+r.afterdecimal,h=(new Number(v)).toFixed(this.decimalDigits),h<=this.max?(v=this._parseDecimalValueToEditorValue(v),d&&-1==v.indexOf("-")&&"-0"!=r.decimal&&(v="-"+v),this.setDecimal(v)):v=void 0)}void 0==v||"simple"!=this.inputMode?(this._setSelectionStart(f.start),this.savedValue=this.numberInput[0].value):(v=this.decimal.toString(),
d=this.getvalue("negative"),-1!=e||d?void 0==v||void 0!=g&&g.toString().length!=v.length?d?this._setSelectionStart(f.start):this._setSelectionStart(1+f.start):this._setSelectionStart(f.start):this._setSelectionStart(-1+f.start));b!=this.decimal&&(c.jqx.mobile.isTouchDevice()&&this._raiseEvent(0,{}),this._raiseEvent(7,{}));c.jqx.aria(self,"aria-valuenow",this.decimal)}}}},_exitSimpleInputMode:function(b,d,e,f){void 0==d&&(d=b.data);if(null!=d){if(void 0==e){if(null!=b.target&&null!=d.element&&(void 0!=
b.target.id&&0<b.target.id.toString().length&&0<d.host.find("#"+b.target.id).length||b.target==d.element))return;f=d.host.offset();e=f.left;f=f.top;var g=d.host.width(),h=d.host.height();b=c(b.target).offset();if(b.left>=e&&b.left<=e+g&&b.top>=f&&b.top<=f+h)return}c.jqx.mobile.isOperaMiniBrowser()&&d.numberInput.attr("readonly",!0);if(!d.disabled&&!d.readOnly&&null!=c.data(d.numberInput,"simpleInputMode"))return c.data(d.numberInput,"simpleInputMode",null),this._parseDecimalInSimpleMode(),!1}},_getDecimalInSimpleMode:function(){var b=
this.decimal;if("."!=this.decimalSeparator){var d=b.toString().indexOf(this.decimalSeparator);0<d&&(b=b.toString().substring(0,d)+"."+b.toString().substring(d+1))}return b},_parseDecimalInSimpleMode:function(b){var d=this.getvalue("negative"),e=this.ValueString;void 0==e&&(e=this.GetValueString(this.numberInput.val(),this.decimalSeparator,""!=this.decimalSeparator));if("."!=this.decimalSeparator){var c=e.toString().indexOf(".");0<c&&(e=e.toString().substring(0,c)+this.decimalSeparator+e.toString().substring(c+
1))}d=d?"-":"";"left"==this.symbolPosition&&(d+=this.symbol);e=e.toString();0<=e.indexOf("-")&&(e=e.substring(e.indexOf("-")+1));d+=e;"right"==this.symbolPosition&&(d+=this.symbol);0!=b&&this.numberInput.val(d)},_enterSimpleInputMode:function(b,d){void 0==d&&(d=b.data);var e=this._selection();if(null!=d){var f=d.getvalue("negative"),g=d.decimal;f&&0<g&&(g=-g);d.numberInput.val(g);c.data(d.numberInput,"simpleInputMode",!0);c.jqx.mobile.isOperaMiniBrowser()&&d.numberInput.attr("readonly",!1);this._parseDecimalInSimpleMode();
this._setSelectionStart(e.start)}},setvalue:function(b,d){void 0!==this[b]&&("decimal"==b?this._setDecimal(d):(this[b]=d,this.propertyChangedHandler(this,b,d,d)))},getvalue:function(b){return"decimal"==b&&void 0!=this.negative&&1==this.negative?this.decimal.toString().indexOf(",")?-Math.abs(this.decimal.toString().replace(/,/,".")):-Math.abs(this[b]):b in this?this[b]:null},_getString:function(){for(var b="",d=0;d<this.items.length;d++)b+=this.items[d].character;return b},_literal:function(b,d,e,
c){return{character:b,regex:d,canEdit:e,isSeparator:c}},_initializeLiterals:function(){if("textbox"!=this.inputMode){for(var b=0,d=this.negativeSymbol.length,e=0;e<d;e++){var c=this.negativeSymbol.substring(e,e+1),g="",h=!1,c=this.negative?this._literal(c,g,h,!1):this._literal("",g,h,!1);this.items[b]=c;b++}d=this.symbol.length;if("left"==this.symbolPosition)for(e=0;e<d;e++)c=this.symbol.substring(e,e+1),g="",h=!1,c=this._literal(c,g,h,!1),this.items[b]=c,b++;var l=this.digits%this.groupSize;0==l&&
(l=this.groupSize);for(e=0;e<this.digits;e++)c=this.promptChar,g="\\d",h=!0,c=this._literal(c,g,h,!1),this.items[b]=c,b++,e<this.digits-1&&void 0!=this.groupSeparator&&0<this.groupSeparator.length?(l--,0==l&&(l=this.groupSize,c=this._literal(this.groupSeparator,"",!1,!1),this.items[b]=c,b++)):e==this.digits-1&&(c.character=0);this.decimalSeparatorPosition=-1;if(void 0!=this.decimalDigits&&0<this.decimalDigits)for(c=this.decimalSeparator,0==c.length&&(c="."),c=this._literal(c,"",!1,!0),this.items[b]=
c,this.decimalSeparatorPosition=b,b++,e=0;e<this.decimalDigits;e++)g="\\d",l=this._literal(0,g,!0,!1),this.items[b]=l,b++;if("right"==this.symbolPosition)for(e=0;e<d;e++)c=this.symbol.substring(e,e+1),g="",h=!1,c=this._literal(c,g,h),this.items[b]=c,b++}},_match:function(b,d){return(new RegExp(d,"i")).test(b)},_raiseEvent:function(b,d){var e=this.events[b],f={owner:this};if("none"==this.host.css("display"))return!0;var g=d.charCode?d.charCode:d.keyCode?d.keyCode:0,h=!0,l=this.readOnly;if((3==b||2==
b)&&!this.disabled)if("simple"!=this.inputMode&&"textbox"!=this.inputMode)this._handleMouse(d);else return!0;if(0==b){var q=this.getvalue("decimal");this.max<q||this.min>q?this.host.addClass(this.toThemeProperty("jqx-input-invalid")):(this.host.removeClass(this.toThemeProperty("jqx-input-invalid")),this.host.addClass(this.toThemeProperty("jqx-input")),this.host.addClass(this.toThemeProperty("jqx-rc-all")))}q=new c.Event(e);q.owner=this;f.value=this.getvalue("decimal");f.text=this.numberInput.val();
q.args=f;7==b&&(f.type=this.changeType,this.changeType=null);void 0!=e&&4!=b&&5!=b&&6!=b&&(h=this.host.trigger(q));if("textbox"==this.inputMode)return h;if("simple"!=this.inputMode)if(4==b){if(l||this.disabled)return!1;h=this._handleKeyDown(d,g)}else if(5==b){if(l||this.disabled)h=!1}else{if(6==b){if(l||this.disabled)return!1;h=this._handleKeyPress(d,g)}}else if(4==b||5==b||6==b){if(c.jqx.mobile.isTouchDevice()||!0===this.touchMode)return!0;if(l||this.disabled)return!1;e=String.fromCharCode(g);parseInt(e);
e=!0;d.ctrlKey||d.shiftKey||d.metaKey||65<=g&&90>=g&&(e=!1);if(6==b&&void 0!=c.jqx.browser.opera&&8==g)return!1;if(e){4==b&&(e=this._handleSimpleKeyDown(d,g));107==g&&(h=this.getvalue("negative"))&&(this.setvalue("negative",!1),this.decimal=this.ValueString,this._parseDecimalInSimpleMode(),this._setSelectionStart(r.start+1),this._raiseEvent(0,this.value),this._raiseEvent(1,this.numberInput.val()));if(189==g||45==g||109==g||173==g){var r=this._selection();4==b&&(h=this.getvalue("negative"),0==h?this.setvalue("negative",
!0):this.setvalue("negative",!1),this.decimal=this.ValueString,this._parseDecimalInSimpleMode(),h?this._setSelectionStart(r.start-1):this._setSelectionStart(r.start+1),e=!1,this._raiseEvent(0,this.value),this._raiseEvent(1,this.numberInput.val()))}f=f.ctrlKey||f.metaKey;if(!c.jqx.browser.msie&&(f&&99==g||f&&67==g||f&&122==g||f&&90==g||f&&118==g||f&&86==g||d.shiftKey&&45==g))return(c.jqx.browser.webkit||c.jqx.browser.chrome)&&this._handleSimpleKeyDown(d,g),67==g?!0:!1;if(f&&97==g||f&&65==g)return!0;
if(6==b&&e)return this._isSpecialKey(g)}return e}return h},GetSelectionInValue:function(b,d,e,c){var g=0;for(i=0;i<d.length&&!(i>=b);i++){var h=d.substring(i,i+1);(!isNaN(parseInt(h))||c&&d.substring(i,i+1)==e)&&g++}return g},GetSelectionLengthInValue:function(b,d,e,c){var g=0;for(i=0;i<e.length&&!(i>=b+d);i++){var h=e.substring(i,i+1),h=!isNaN(parseInt(h));(0<d&&i>=b&&h||i>=b&&e[i].toString()==c)&&g++}return g},GetInsertTypeByPositionInValue:function(b,d,e,c){var g="before";e=this.GetValueString(e,
d,c);d=this.GetDigitsToSeparator(0,e,d);b>d&&(g="after");return g},RemoveRange:function(b,d,e,c,g,h){var l=this.digits,q=d,r=0;this._selection();c=this.decimalSeparator;var t=""!=c;if(0==q&&this.ValueString.length<this.decimalPossibleChars-1)return r;var v=this.GetSeparatorPositionInText(c,e);g||(v=this.GetSeparatorPositionInText(c,e));0>v&&!t&&1<e.length&&(v=e.length);-1==v&&(v=e.length);2>d&&1==h&&this.ValueString.length-this.decimalDigits-(t?1:0)==l&&b+d<v&&q++;d="";for(h=0;h<e.length;h++)h<b||
h>=b+q?d+=e.substring(h,h+1):(l=e.substring(h,h+1),l==c?d+=c:(l=e.substring(h,h+1),this.symbol&&""!=this.symbol&&0<=this.symbol.indexOf(l)||(h>v?d+="0":(l=e.substring(h,h+1),isNaN(parseInt(l))||r++))));0==d.length&&(d="0");g?this.numberInput.val(d):this.ValueString=d;e=d.substring(0,1);e==c&&isNaN(parseInt(e))&&(d="0"+d);this.decimal=this.ValueString=this.GetValueString(d,c,t);this._parseDecimalInSimpleMode();this._setSelectionStart(b);return r},InsertDigit:function(b,d){"number"!=typeof this.digits&&
(this.digits=parseInt(this.digits));"number"!=typeof this.decimalDigits&&(this.decimalDigits=parseInt(this.decimalDigits));var e=1+this.digits,c=this._selection(),g=this.getvalue("negative"),h=!1;0==c.start&&""!=this.symbol&&"left"==this.symbolPosition&&(this._setSelectionStart(c.start+1),c=this._selection(),h=!0);if(g&&h||g&&!h&&0==c.start)this._setSelectionStart(c.start+1),c=this._selection();var l=this.numberInput.val().substring(c.start,c.start+1),q=this.numberInput.val(),h=this.decimalSeparator,
r=""!=h&&0<this.decimalDigits;if(l==this.symbol&&"right"==this.symbolPosition)if(0==this.decimalDigits){if(this.ValueString=this.GetValueString(q,h,r),this.ValueString.length>=e)return}else return;this.ValueString=this.GetValueString(q,h,r);""==this.ValueString&&(this.ValueString=(new Number(0)).toFixed(this.decimalDigits));l=this.ValueString;0<this.decimalDigits&&d>=l.length&&(d=l.length-1);var t="";d<l.length&&(t=l.substring(d,d+1));var v=!1;"after"==this.GetInsertTypeByPositionInValue(d,h,q,r)&&
(v=!0);t!=h&&this.ValueString.length-this.decimalDigits-(r?1:0)>=e-1&&(v=!0);"0"===t&&1===this.ValueString.length&&0===this.decimalDigits&&(v=!0);q=r?1:0;if(!(!v&&this.ValueString&&this.ValueString.length>=this.digits+this.decimalDigits+q)){if(v&&t!=h){e=l.substring(0,d);if(e.length==l.length&&this.ValueString.length>=this.digits+this.decimalDigits+q)return;q=b;r="";d+1<l.length&&(r=l.substring(d+1));this.ValueString=e+q+r}else e=l.substring(0,d),q=b,r=l.substring(d),e=e+q+r,"0"==l.substring(0,1)&&
l.substring(1,2)==h&&(e=q+l.substring(1),t==h&&(this._setSelectionStart(c.start-1),c=this._selection())),this.ValueString=e;this.decimal=g?-this.ValueString:this.ValueString;this._parseDecimalInSimpleMode();this._setSelectionStart(c.start+1);this.value=this.decimal;this._raiseEvent(0,this.value);this._raiseEvent(1,this.numberInput.val())}},GetStringToSeparator:function(b,d,e){var c=this.GetSeparatorPositionInText(d,b);b=b.subString(0,c);return this.GetValueString(b,d,e)},GetSeparatorPositionInText:function(b,
d){var e=-1;for(i=0;i<d.length;i++)if(d.substring(i,i+1)==b){e=i;break}return e},GetValueString:function(b,d,e){e="";for(var c=0;c<b.length;c++){var g=b.substring(c,c+1);isNaN(parseInt(g))||(e+=g);g==d&&(e+=d)}return e},Backspace:function(){var b=this._selection(),d=this._selection(),e=this.numberInput.val();if(0!=b.start||0!=b.length)this.isBackSpace=!0,e=e.substring[b.start,b.start+1],isNaN(parseInt(e)),0<b.start&&0==b.length&&(this._setSelectionStart(b.start-1),this._selection()),this.Delete(),
this._setSelectionStart(d.start-1),this.isBackSpace=!1},Delete:function(b){var d=this._selection(),e=this.numberInput.val();0===d.start&&"-"==e.substring(0,1)&&(this.setvalue("negative",!1),d=this._selection(),e=this.numberInput.val());b=d.start;var c=d.length,c=Math.max(c,1);this.ValueString=this.GetValueString(e,this.decimalSeparator,""!=this.decimalSeparator);b>this.ValueString.indexOf(this.decimalSeparator)&&0<this.decimalDigits&&b++;e=0;this.symbol&&("left"==this.symbolPosition&&e--,this.negative&&
e--);this.RemoveRange(d.start+e,c,this.ValueString,".",!1);d=this.ValueString.substring(0,1);isNaN(parseInt(d))&&(this.ValueString="0"+this.ValueString);this.decimal=this.ValueString;this._parseDecimalInSimpleMode();this._setSelectionStart(b);this.value=this.decimal;this._raiseEvent(0,this.value);this._raiseEvent(1,this.numberInput.val())},insertsimple:function(b){var d=this._selection(),e=this.numberInput.val();if(!(d.start==e.length&&null!=this.decimal&&0<this.decimalDigits)){var c=this.decimalSeparator;
this.ValueString=this.GetValueString(e,c,""!=c);var g=this.GetSelectionInValue(d.start,e,c,""!=c),e=this.GetSelectionLengthInValue(d.start,d.length,e,c);this.GetDigitsToSeparator(0,this.ValueString,c);0<this.decimalDigits&&g>=this.ValueString.length&&g--;""==this.ValueString?(this.ValueString=(new Number(0)).toFixed(this.decimalDigits),this.ValueString=this.ValueString.replace(".",c),this.RemoveRange(d.start,e,this.ValueString,c,!1,!0),this.InsertDigit(b,0,d)):(this.RemoveRange(d.start,e,this.ValueString,
c,!1,!0),this.InsertDigit(b,g,d))}},GetDigitsToSeparator:function(b,d,e){void 0==e&&(e=".");if(0>d.indexOf(e))return d.length;for(i=0;i<d.length;i++)if(d.substring(i,i+1)==e){b=i;break}return b},_handleSimpleKeyDown:function(b,d){var e=this._selection(),f=b.ctrlKey||b.metaKey;if((8==d||46==d)&&f)return this.setDecimal(null),!1;0<=e.start&&e.start<this.items.length&&(f=String.fromCharCode(d));27===d&&(this.setDecimal(this._savedValue),f=this.GetSeparatorPositionInText(this.decimalSeparator,this.numberInput.val()),
-1!=f&&this._setSelectionStart(f),b.preventDefault());if(this.rtl&&37==d){var g=(f=b.shiftKey)?1:0;f?this._setSelection(e.start+1-g,e.start+e.length+1):this._setSelection(e.start+1-g,e.start+1);return!1}if(this.rtl&&39==d)return(f=b.shiftKey)?this._setSelection(e.start-1,e.length+(f?1:0)+e.start-1):this._setSelection(e.start-1,e.start-1),!1;if(8==d)return this.Backspace(),!1;if(190==d||110==d)return f=this.GetSeparatorPositionInText(this.decimalSeparator,this.numberInput.val()),-1!=f&&this._setSelectionStart(f+
1),!1;if(188==d){g=this.numberInput.val();for(f=e.start;f<g.length;f++)if(g[f]==this.groupSeparator){this._setSelectionStart(1+f);break}return!1}if((f=b.ctrlKey||b.metaKey)&&99==d||f&&67==d){var e=this._selection(),g="",h=this.numberInput.val();if(0<e.start||0<e.length)for(f=e.start;f<e.end;f++)g+=h.substring(f,f+1);c.data(document.body,"jqxSelection",g);if(c.jqx.browser.msie)window.clipboardData.setData("Text",g);else{var l=this,q=c('<textarea style="position: absolute; left: -1000px; top: -1000px;"/>');
q.val(g);c("body").append(q);q.select();setTimeout(function(){document.designMode="off";q.select();q.remove();l.focus()},100)}this.savedText=g;return!0}if(f&&122==d||f&&90==d)return!1;if(f&&118==d||f&&86==d||b.shiftKey&&45==d)return c.jqx.browser.msie&&!this.savedText&&(this.savedText=window.clipboardData.getData("Text")),null!=this.savedText&&0<this.savedText.length?this.val(this.savedText):this.val(c.data(document.body,"jqxSelection")),!1;f=String.fromCharCode(d);e=parseInt(f);96<=d&&105>=d&&(e=
d-96,d-=48);if(!isNaN(e))return l=this,this.insertsimple(e),!1;if(46==d)return this.Delete(),!1;if(38==d)return this.spinUp(),!1;if(40==d)return this.spinDown(),!1;e=this._isSpecialKey(d);return c.jqx.browser.mozilla?e:!0},_getEditRange:function(){var b=0,d=0;for(i=0;i<this.items.length;i++)if(this.items[i].canEdit){b=i;break}for(i=this.items.length-1;0<=i;i--)if(this.items[i].canEdit){d=i;break}return{start:b,end:d}},_getVisibleItems:function(){var b=[],d=0;for(i=0;i<this.items.length;i++)0<this.items[i].character.toString().length&&
(b[d]=this.items[i],d++);return b},_hasEmptyVisibleItems:function(){var b=this._getVisibleItems();for(i=0;i<b.length;i++)if(b[i].canEdit&&b[i].character==this.promptChar)return!0;return!1},_getFirstVisibleNonEmptyIndex:function(){var b=this._getVisibleItems();for(i=0;i<b.length;i++)if(b[i].canEdit&&b[i].character!=this.promptChar)return i},_handleMouse:function(b,d){var e=this._selection();if(1>=e.length){var c=this._getFirstVisibleNonEmptyIndex();e.start<c&&this._setSelectionStart(c)}},_insertKey:function(b){this.numberInput[0].focus();
var d=String.fromCharCode(b);b=parseInt(d);if(!isNaN(b)){var e=0;for(i=0;i<this.items.length;i++)0==this.items[i].character.length&&e++;var f=this._selection(),g=this;if(0<=f.start&&f.start<=this.items.length){var h=!1;b=this._getFirstVisibleNonEmptyIndex();f.start<b&&0==f.length&&(!isNaN(d)||" "==d)&&(this._setSelectionStart(b),f=this._selection());this._getFirstEditableItemIndex();var l=this._getLastEditableItemIndex(),q=this._getVisibleItems();c.each(q,function(b,c){if(!(f.start>b&&b!=q.length-
1)){var v=q[b];b>l&&(v=q[l]);if(!isNaN(d)&&" "!=d&&""!=d&&v&&v.canEdit){var y=g._getSeparatorPosition();if(g._match(d,v.regex)){if(!h&&0<f.length){for(j=f.start+e;j<f.end+e;j++)g.items[j].canEdit&&(g.items[j].character=j>y?"0":g.promptChar);g._getString();h=!0}var y=g._getSeparatorPosition(),A=g._hasEmptyVisibleItems();null==g.decimal&&(f.start=y-1,0>f.start&&(f.start=0),f.end=f.start);if(f.start<=y&&A){v=b;-1==g.decimalSeparatorPosition&&f.start==y&&(v=b+1);null==g.decimal&&(v=f.start);A="";for(p=
0;p<v;p++)q[p].canEdit&&q[p].character!=g.promptChar&&(A+=q[p].character);var A=A+d,w=1>g.decimal?1:0;f.start==y&&-1!=g.decimalSeparatorPosition&&(A+=g.decimalSeparator,w=0);for(p=v+w;p<q.length;p++)q[p].character==g.decimalSeparator&&q[p].isSeparator?A+=q[p].character:q[p].canEdit&&q[p].character!=g.promptChar&&(A+=q[p].character);"."!=g.decimalSeparator&&(A=g._parseDecimalValue(A));A=parseFloat(A).toString();A=new Number(A);A=A.toFixed(g.decimalDigits);"."!=g.decimalSeparator&&(A=g._parseDecimalValueToEditorValue(A));
g.setvalue("decimal",A);g._getString();f.end<y?g._setSelectionStart(f.end+w):g._setSelectionStart(f.end);1<=f.length&&g._setSelectionStart(f.end);f.length==g.numberInput.val().length&&(y=g._moveCaretToDecimalSeparator(),g._setSelectionStart(y-(0<=g.decimalSeparatorPosition?1:0)))}else if(f.start<y||f.start>y){if(g.numberInput.val().length==f.start&&-1!=g.decimalSeparatorPosition||g.numberInput.val().length==f.start&&-1==g.decimalSeparatorPosition&&!A)return!1;A="";w=!1;for(p=0;p<b;p++)q[p].canEdit&&
q[p].character!=g.promptChar&&(A+=q[p].character),q[p].character==g.decimalSeparator&&q[p].isSeparator&&(A+=q[p].character,w=!0);A+=d;w||f.start!=y-1||(A+=g.decimalSeparator,w=!0);for(p=b+1;p<q.length;p++)!w&&q[p].character==g.decimalSeparator&&q[p].isSeparator?A+=q[p].character:q[p].canEdit&&q[p].character!=g.promptChar&&(A+=q[p].character);g.setvalue("decimal",A);y=g._getString();if(0>g.decimalSeparatorPosition&&v==q[l])return g._setSelectionStart(b),!1;v=y.indexOf(g.symbol);A=g.getvalue("negative")?
1:0;v<=A&&(v=y.length);f.start<v?g._setSelectionStart(b+1):g._setSelectionStart(b);f.length==g.numberInput.val().length&&(y=g._moveCaretToDecimalSeparator(),g._setSelectionStart(y-1))}return!1}}}})}}},_handleKeyPress:function(b,d){var e=this._selection(),f=b.ctrlKey||b.metaKey;if(f&&97==d||f&&65==d)return!0;if(8==d)return 0<e.start&&this._setSelectionStart(e.start),!1;if(46==d)return e.start<this.items.length&&this._setSelectionStart(e.start),!1;c.jqx.browser.mozilla||45!=d&&173!=d&&109!=d&&189!=
d||(0==this.getvalue("negative")?this.setvalue("negative",!0):this.setvalue("negative",!1));c.jqx.browser.msie&&this._insertKey(d);return this._isSpecialKey(d)},_deleteSelectedText:function(){var b=this._selection(),d="",e=this._getSeparatorPosition(),c=this._getVisibleItems(),g=this._getHiddenPrefixCount();this.numberInput.val().length==b.start&&0==b.length&&(this._setSelection(b.start,b.start+1),b=this._selection());for(i=0;i<b.start;i++)c[i].canEdit&&c[i].character!=this.promptChar?d+=c[i].character:
c[i].canEdit||-1==this.decimalSeparatorPosition||c[i]!=c[this.decimalSeparatorPosition-g]||(0==d.length&&(d="0"),d+=c[i].character);for(i=b.start;i<b.end;i++)i>e&&-1!=this.decimalSeparatorPosition?c[i].canEdit&&c[i].character!=this.promptChar&&(d+="0"):c[i].canEdit||-1==this.decimalSeparatorPosition||c[i]!=c[this.decimalSeparatorPosition-g]||(0==d.length&&(d="0"),d+=c[i].character);for(i=b.end;i<c.length;i++)c[i].canEdit&&c[i].character!=this.promptChar?d+=c[i].character:c[i].canEdit||-1==this.decimalSeparatorPosition||
c[i]!=c[this.decimalSeparatorPosition-g]||(0==d.length&&(d="0"),d+=c[i].character);this.setvalue("decimal",d);return 0<b.length},_restoreInitialState:function(){var b=parseInt(this.decimalDigits);0<b&&(b+=2);for(k=this.items.length-1;k>this.items.length-1-b&&this.items[k];k--)this.items[k].canEdit&&this.items[k].character==this.promptChar&&(this.items[k].character=0)},clear:function(){this.setDecimal(0)},clearDecimal:function(){if("textbox"==this.inputMode)this.numberInput.val();else{for(var b=0;b<
this.items.length;b++)this.items[b].canEdit&&(this.items[b].character=this.promptChar);this._restoreInitialState()}},_saveSelectedText:function(){var b=this._selection(),d="",e=this._getVisibleItems();if(0<b.start||0<b.length)for(i=b.start;i<b.end;i++)e[i].canEdit&&e[i].character!=this.promptChar?d+=e[i].character:e[i].isSeparator&&(d+=e[i].character);c.jqx.browser.msie&&window.clipboardData.setData("Text",d);return d},_pasteSelectedText:function(){this._selection();this.selectedText=c.data(document.body,
"jqxSelection");if(window.clipboardData){var b=window.clipboardData.getData("Text");if(b!=this.selectedText&&0<b.length&&(this.selectedText=window.clipboardData.getData("Text"),null==this.selectedText||void 0==this.selectedText))return}this._getVisibleItems();if(null!=this.selectedText)for(b=0;b<this.selectedText.length;b++){var d=parseInt(this.selectedText[b]);isNaN(d)||this._insertKey(48+d)}},_getHiddenPrefixCount:function(){var b=0;this.negative||b++;if("left"==this.symbolPosition)for(i=0;i<this.symbol.length;i++)""==
this.symbol.substring(i,i+1)&&b++;return b},_getEditableItem:function(){var b=this._selection();for(i=0;i<this.items.length;i++)if(i<b.start&&this.items[i].canEdit&&this.items[i].character!=this.promptChar)return this.items[i];return null},_getEditableItems:function(){var b=[],d=0;for(i=0;i<this.items.length;i++)this.items[i].canEdit&&(b[d]=this.items[i],d++);return b},_getValidSelectionStart:function(b){for(i=this.items.length-1;0<=i;i--)if(this.items[i].canEdit&&this.items[i].character!=this.promptChar)return i;
return-1},_getEditableItemIndex:function(b){b=this._selection();var d=this._getHiddenPrefixCount(),e=this._getVisibleItems(),c=b.start,g=-1;for(i=0;i<c;i++)i<e.length&&e[i].canEdit&&(g=i+d);if(-1==g&&0<b.length)for(c=b.end,i=0;i<c;i++)if(i<e.length&&e[i].canEdit){g=i+d;break}return g},_getEditableItemByIndex:function(b){for(k=0;k<this.items.length;k++)if(k>b&&this.items[k].canEdit&&this.items[k].character!=this.promptChar)return k;return-1},_getFirstEditableItemIndex:function(){var b=this._getVisibleItems();
for(m=0;m<b.length;m++)if(b[m].character!=this.promptChar&&b[m].canEdit&&"0"!=b[m].character)return m;return-1},_getLastEditableItemIndex:function(){var b=this._getVisibleItems();for(m=b.length-1;0<=m;m--)if(b[m].character!=this.promptChar&&b[m].canEdit)return m;return-1},_moveCaretToDecimalSeparator:function(){for(i=this.items.length-1;0<=i;i--)if(this.items[i].character==this.decimalSeparator&&this.items[i].isSeparator)return this.negative?this._setSelectionStart(i+1):this._setSelectionStart(i),
i;return this.numberInput.val().length},_handleBackspace:function(){var b=this._selection(),d=this._getHiddenPrefixCount(),e=this._getEditableItemIndex()-d,c=this._getFirstVisibleNonEmptyIndex(),d=!1;this.negative&&(d=!0,c>=e+1||0==b.start)&&(this.setvalue("negative",!1),0==b.length&&(this._setSelectionStart(b.start-1),b=this._selection()));if(0<=e){if(0==b.length&&-1!=e&&this._setSelection(e,e+1),(e=b.start>this._getSeparatorPosition()+1&&0<this.decimalSeparatorPosition)&&(b=this._selection()),this._deleteSelectedText(),
1>b.length||e?this._setSelectionStart(b.start):1<=b.length&&this._setSelectionStart(b.end),b.length==this.numberInput.val().length||d)b=this._moveCaretToDecimalSeparator(),this._setSelectionStart(b-1)}else this._setSelectionStart(b.start)},_handleKeyDown:function(b,d){var e=this._selection(),f=b.ctrlKey||b.metaKey;if((8==d||46==d)&&f)return this.setDecimal(null),!1;if(this.rtl&&37==d){var g=(f=b.shiftKey)?1:0;f?this._setSelection(e.start+1-g,e.start+e.length+1):this._setSelection(e.start+1-g,e.start+
1);return!1}if(this.rtl&&39==d)return(f=b.shiftKey)?this._setSelection(e.start-1,e.length+(f?1:0)+e.start-1):this._setSelection(e.start-1,e.start-1),!1;if(f&&97==d||f&&65==d)return!0;if(f&&120==d||f&&88==d)return this.selectedText=this._saveSelectedText(b),c.data(document.body,"jqxSelection",this.selectedText),this._handleBackspace(),!1;if(f&&99==d||f&&67==d)return this.selectedText=this._saveSelectedText(b),c.data(document.body,"jqxSelection",this.selectedText),!1;if(f&&122==d||f&&90==d)return!1;
if(f&&118==d||f&&86==d||b.shiftKey&&45==d)return this._pasteSelectedText(),!1;0<=e.start&&e.start<this.items.length&&String.fromCharCode(d);if(8==d)return this._handleBackspace(),!1;if(190==d||110==d)return this._moveCaretToDecimalSeparator(),!1;if(188==d){f=this.numberInput.val();for(i=e.start;i<f.length;i++)if(f[i]==this.groupSeparator){this._setSelectionStart(1+i);break}return!1}if(null==c.jqx.browser.msie&&(f=String.fromCharCode(d),f=parseInt(f),96<=d&&105>=d&&(f=d-96,d-=48),!isNaN(f)))return this._insertKey(d),
!1;if(46==d){f=this._getVisibleItems();if(e.start<f.length){g=0==f[e.start].canEdit?2:1;if(0==e.start&&this.negative&&(this.setvalue("negative",!1),0==e.length&&this._setSelectionStart(0),e=this._selection(),0==e.length))return!1;0==e.length&&this._setSelection(e.start+g,e.start+g+e.length);this._handleBackspace();1>new Number(this.decimal)||e.start>this._getSeparatorPosition()?this._setSelectionStart(e.end+g):e.start+1<this.decimalSeparatorPosition&&this._setSelectionStart(e.end+g)}return!1}if(38==
d)return this.spinUp(),!1;if(40==d)return this.spinDown(),!1;27===d&&(this.setDecimal(this._savedValue),this._setSelectionStart(e.end),b.preventDefault());e=this._isSpecialKey(d);!c.jqx.browser.mozilla||45!=d&&173!=d&&109!=d&&189!=d||(0==this.getvalue("negative")?this.setvalue("negative",!0):this.setvalue("negative",!1));return c.jqx.browser.mozilla?e:!0},_isSpecialKey:function(b){return 8!=b&&9!=b&&13!=b&&35!=b&&36!=b&&37!=b&&39!=b&&27!=b&&46!=b?!1:!0},_selection:function(){try{if("selectionStart"in
this.numberInput[0]){var b=this.numberInput[0],d=b.selectionEnd-b.selectionStart;return{start:b.selectionStart,end:b.selectionEnd,length:d,text:b.value}}var e=document.selection.createRange();if(null==e)return{start:0,end:b.value.length,length:0};var c=this.numberInput[0].createTextRange(),g=c.duplicate();c.moveToBookmark(e.getBookmark());g.setEndPoint("EndToStart",c);d=e.text.length;return{start:g.text.length,end:g.text.length+e.text.length,length:d,text:e.text}}catch(h){return{start:0,end:0,length:0}}},
selectAll:function(){var b=this.numberInput;setTimeout(function(){if("selectionStart"in b[0])b[0].focus(),b[0].setSelectionRange(0,b[0].value.length);else{var d=b[0].createTextRange();d.collapse(!0);d.moveEnd("character",b[0].value.length);d.moveStart("character",0);d.select()}},10)},_setSelection:function(b,d){if(1!=this._disableSetSelection&&!c.jqx.mobile.isTouchDevice()&&1!=this.touchMode)try{if("selectionStart"in this.numberInput[0])this.numberInput[0].focus(),this.numberInput[0].setSelectionRange(b,
d);else{var e=this.numberInput[0].createTextRange();e.collapse(!0);e.moveEnd("character",d);e.moveStart("character",b);e.select()}}catch(f){}},_setSelectionStart:function(b){this._setSelection(b,b);c.data(this.numberInput,"selectionstart",b)},resize:function(b,d){this.width=b;this.height=d;this._render(!1)},_render:function(b){var d=parseInt(this.host.css("border-left-width")),e=parseInt(this.host.css("border-left-width")),f=parseInt(this.host.css("border-left-width")),g=parseInt(this.host.css("border-left-width"));
this.numberInput.css("padding-top","0px");this.numberInput.css("padding-bottom","0px");var h=window.getComputedStyle(this.element),l=2*parseInt(h.borderLeftWidth);if("border-box"===h.boxSizing||isNaN(l))l=0;null!=this.width&&-1!=this.width.toString().indexOf("px")?this.element.style.width=parseInt(this.width)-l+"px":void 0==this.width||isNaN(this.width)||(this.element.style.width=parseInt(this.width)-l+"px");null!=this.height&&-1!=this.height.toString().indexOf("px")?this.element.style.height=parseInt(this.height)-
l+"px":void 0==this.height||isNaN(this.height)||(this.element.style.height=parseInt(this.height)-l+"px");h=this.host.width();l=this.host.height();this.numberInput.css({"border-left-width":0,"border-right-width":0,"border-bottom-width":0,"border-top-width":0});isNaN(f)&&(f=1);isNaN(e);isNaN(g);isNaN(d);this.numberInput.css("text-align",this.textAlign);d=this.numberInput.css("font-size");""==d&&(d=13);this.numberInput.css("height",parseInt(d)+4+"px");this.numberInput.css("width",h-2);f=l-2*f-parseInt(d)-
2;isNaN(f)&&(f=0);0>f&&(f=0);this.spinButtons&&this.spincontainer&&(h-=parseInt(this.spinButtonsWidth-2),c.jqx.mobile.isTouchDevice()||!0===this.touchMode?(this.spincontainer.width(2*this.spinButtonsWidth),h-=this.spinButtonsWidth,this.upbutton.height("100%"),this.downbutton.height("100%"),this.downbutton.css("float","left"),this.upbutton.css("float","right"),this.upbutton.width(this.spinButtonsWidth),this.downbutton.width(1+this.spinButtonsWidth)):(this.spincontainer.width(this.spinButtonsWidth),
this.upbutton.width(this.spinButtonsWidth+2),this.downbutton.width(this.spinButtonsWidth+2),this.upbutton.height("50%"),this.downbutton.height("50%"),this.spincontainer.width(this.spinButtonsWidth)),this._upArrow.height("100%"),this._downArrow.height("100%"),this.numberInput.css("width",h-6),this.numberInput.css("margin-right","2px"));d=f/2;c.jqx.browser.msie&&8>c.jqx.browser.version&&(d=f/4);this.numberInput.css("padding-left","0px");this.numberInput.css("padding-right","0px");this.numberInput.css("padding-top",
Math.round(d)+"px");this.numberInput.css("padding-bottom",Math.round(d)+"px");if(void 0==b||1==b)this.numberInput.val(this._getString()),"advanced"!=this.inputMode&&this._parseDecimalInSimpleMode();this._addBarAndLabel(this.numberInput);this._updateHint()},_addBarAndLabel:function(b){if(null===this.bar&&null===this.label){var d=c("<label></label");this.hint&&(d[0].innerHTML=this.placeHolder);d.addClass(this.toThemeProperty("jqx-input-label"));b.after(d);this.label=d;d=c("<span></span>");b.after(d);
d.addClass(this.toThemeProperty("jqx-input-bar"));this.spinButtons?d.css("top",this.host.height()):d.css("top","0px");this.bar=d;this.template&&(this.bar.addClass(this.toThemeProperty("jqx-"+this.template)),this.label.addClass(this.toThemeProperty("jqx-"+this.template)))}},destroy:function(){this._removeHandlers();this.host.remove()},inputValue:function(b){if(void 0===b)return this._value();this.propertyChangedHandler(this,"value",this._value,b);this._refreshValue();return this},_value:function(){return this.numberInput.val()},
val:function(b){if(void 0!==b&&"object"!=typeof b||null===b)if(null===b)this.setDecimal(null);else{b=b.toString();-1<b.indexOf(this.symbol)&&(b=b.replace(this.symbol,""));b=b.replace(this.decimalSeparator,".");var d=this.groupSeparator,e=b;if(""!=d){for(b=e.indexOf(d);-1!=b;)e=e.replace(d,""),b=e.indexOf(d);b=e}d="";for(e=0;e<b.length;e++){var c=b.substring(e,e+1);"-"===c&&(d+="-");"."===c&&(d+=".");null!=c.match(/^[0-9]+$/)&&(d+=c)}b=d.replace(/ /g,"");b=new Number(b);this.setDecimal(b)}else return this.getDecimal()},
getDecimal:function(){if(null==this.decimal)return null;"simple"==this.inputMode&&(this._parseDecimalInSimpleMode(!1),this.decimal=this._getDecimalInSimpleMode(this.decimal));return""==this.decimal?0:this.getvalue("negative")&&0<this.decimal?-parseFloat(this.decimal):parseFloat(this.decimal)},setDecimal:function(b){var d=b;if("."!=this.decimalSeparator){if(null!==b){var e=b;if("number"!=typeof b){b=b.toString();var c=b.indexOf(".");if(-1!=c){var g=b.substring(0,c);b=b.substring(c+1);e=g+"."+b;-1!=
g.indexOf("-")&&(g=g.substring(1));b="advanced"!=this.inputMode?g+"."+b:g+this.decimalSeparator+b}else c=b.indexOf(this.decimalSeparator),-1!=c&&(g=b.substring(0,c),b=b.substring(c+1),e=g+"."+b,-1!=g.indexOf("-")&&(g=g.substring(1)),b="advanced"!=this.inputMode?g+"."+b:g+this.decimalSeparator+b)}0>e?this.setvalue("negative",!0):this.setvalue("negative",!1)}this._setDecimal(b)}else 0>b?this.setvalue("negative",!0):this.setvalue("negative",!1),null===b?this._setDecimal(b):this._setDecimal(Math.abs(b));
null==d&&this.numberInput.val("");this._updateHint()},_setDecimal:function(b){this.allowNull||null!=b||(b=this.decimal=0);if(null==b)this.value=this.decimal=null,this.clearDecimal(),this._refreshValue(),this.value=this.decimal=null,this.ValueString="";else{-1!=b.toString().indexOf("e")&&(b=(new Number(b)).toFixed(this.decimalDigits).toString());this.clearDecimal();var d=b.toString(),e="",c="",g=!0;0==d.length&&(d="0");for(var h=0;h<d.length;h++){if("number"==typeof b){if("."==d.substring(h,h+1)){g=
!1;continue}}else if(d.substring(h,h+1)==this.decimalSeparator){g=!1;continue}g?e+=d.substring(h,h+1):c+=d.substring(h,h+1)}0<e.length&&(e=parseFloat(e).toString());h=this.digits;h<e.length&&(e=e.substr(0,h));d=0;g=this._getSeparatorPosition();h=this._getHiddenPrefixCount();for(h=g+=h;0<=h;h--)h<this.items.length&&this.items[h].canEdit&&d<e.length&&(this.items[h].character=e.substring(e.length-d-1,e.length-d),d++);d=0;for(h=g;h<this.items.length;h++)this.items[h].canEdit&&d<c.length&&(this.items[h].character=
c.substring(d,d+1),d++);this._refreshValue();"."!=this.decimalSeparator&&(e=b.toString().indexOf(this.decimalSeparator),0<e&&(b=b.toString().substring(0,e)+"."+b.toString().substring(e+1)));this.ValueString=(new Number(b)).toFixed(this.decimalDigits);"advanced"!=this.inputMode&&(this._parseDecimalInSimpleMode(),this._raiseEvent(1,this.ValueString));"textbox"==this.inputMode&&(this.decimal=this.ValueString,this.getvalue("negative")&&(this.decimal="-"+this.ValueString));b=this.val();b<this.min||b>this.max?
this.host.addClass("jqx-input-invalid"):this.host.removeClass("jqx-input-invalid");this._updateHint()}},_getSeparatorPosition:function(){var b=this._getHiddenPrefixCount();return 0<this.decimalSeparatorPosition?this.decimalSeparatorPosition-b:this.items.length-b},_setTheme:function(){this.host.removeClass();this.host.addClass(this.toThemeProperty("jqx-input"));this.host.addClass(this.toThemeProperty("jqx-rc-all"));this.host.addClass(this.toThemeProperty("jqx-widget"));this.host.addClass(this.toThemeProperty("jqx-widget-content"));
this.host.addClass(this.toThemeProperty("jqx-numberinput"));this.spinButtons&&(this.downbutton.removeClass(),this.upbutton.removeClass(),this.downbutton.addClass(this.toThemeProperty("jqx-scrollbar-button-state-normal")),this.upbutton.addClass(this.toThemeProperty("jqx-scrollbar-button-state-normal")),this._upArrow.removeClass(),this._downArrow.removeClass(),this._upArrow.addClass(this.toThemeProperty("jqx-icon-arrow-up")),this._downArrow.addClass(this.toThemeProperty("jqx-icon-arrow-down")));this.numberInput.removeClass();
this.numberInput.addClass(this.toThemeProperty("jqx-input-content"))},propertiesChangedHandler:function(b,d,e){e&&e.width&&e.height&&2==Object.keys(e).length&&b._render()},propertyChangedHandler:function(b,d,e,f){if(!(b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length)){"template"==d&&(b.upbutton.removeClass(b.toThemeProperty("jqx-"+b.template)),b.downbutton.removeClass(b.toThemeProperty("jqx-"+b.template)),b.upbutton.addClass(b.toThemeProperty("jqx-"+b.template)),
b.downbutton.addClass(b.toThemeProperty("jqx-"+b.template)));if(("digits"==d||"groupSize"==d||"decimalDigits"==d)&&0>f)throw new Exception(this.invalidArgumentExceptions[0]);"placeHolder"==d&&(b.isMaterialized()?b.hint&&(b.label[0].innerHTML=b.placeHolder):b.numberInput.attr("placeholder",b.placeHolder));"theme"===d&&c.jqx.utilities.setTheme(e,f,b.host);"digits"==d&&f!=e&&(b.digits=parseInt(f));if("min"==d||"max"==d)c.jqx.aria(b,"aria-value"+d,f.toString()),b._refreshValue();"decimalDigits"==d&&f!=
e&&(b.decimalDigits=parseInt(f));if("decimalSeparator"==d||"digits"==d||"symbol"==d||"symbolPosition"==d||"groupSize"==d||"groupSeparator"==d||"decimalDigits"==d||"negativeSymbol"==d){var g=b.decimal;"decimalSeparator"==d&&""==f&&(f=" ");e!=f&&(b._selection(),b.items=[],b._initializeLiterals(),b.value=b._getString(),b._refreshValue(),b._setDecimal(g))}"rtl"==d&&(b.rtl?(b.spincontainer&&(b.spincontainer.css("float","right"),b.spincontainer.css("border-right-width","1px")),b.numberInput.css("float",
"right")):(b.spincontainer&&(b.spincontainer.css("float","right"),b.spincontainer.css("border-right-width","1px")),b.numberInput.css("float","left")));"spinButtons"==d&&(b.spincontainer?(f?b.spincontainer.css("display","block"):b.spincontainer.css("display","none"),b._render()):b._spinButtons());"touchMode"===d&&(b.inputMode="textbox",b.spinMode="simple",b.render());"negative"==d&&"advanced"==b.inputMode&&(e=b._selection(),f?(b.items[0].character=b.negativeSymbol[0],g=1):(b.items[0].character="",
g=-1),b._refreshValue(),b.isInitialized&&b._setSelection(e.start+g,e.end+g));"decimal"==d&&(b.value=f,b.setDecimal(f));"value"===d&&(b.value=f,b.setDecimal(f),b._raiseEvent(1,f));"textAlign"==d&&(b.textAlign=f,b._render());"disabled"==d&&(b.numberInput.attr("disabled",f),b.disabled?b.host.addClass(b.toThemeProperty("jqx-fill-state-disabled")):b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")),c.jqx.aria(b,"aria-disabled",f.toString()));"readOnly"==d&&(b.readOnly=f);if("promptChar"==
d){for(i=0;i<b.items.length;i++)b.items[i].character==b.promptChar&&(b.items[i].character=f);b.promptChar=f}"width"==d?(b.width=f,b._render()):"height"==d&&(b.height=f,b._render())}},_value:function(){return this.value},_refreshValue:function(){var b;if("textbox"!==this.inputMode){b=this.value=this._getString();for(var d="",e=0;e<this.items.length;e++){var c=this.items[e];c.canEdit&&c.character!=this.promptChar&&(d+=c.character);e==this.decimalSeparatorPosition&&(d+=".")}this.decimal=d;d=!1;this.oldValue!==
b&&(this.oldValue=b,this._raiseEvent(0,b),d=!0);"simple"!=this.inputMode&&(this.numberInput.val(b),d&&this._raiseEvent(1,b));null==b&&this.numberInput.val("")}}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxPasswordInput","",{});c.extend(c.jqx._jqxPasswordInput.prototype,{defineInstance:function(){var b={width:null,height:null,disabled:!1,rtl:!1,placeHolder:null,showStrength:!1,showStrengthPosition:"right",maxLength:null,minLength:null,showPasswordIcon:!0,strengthTypeRenderer:null,passwordStrength:null,changeType:null,hint:!0,localization:{passwordStrengthString:"Password strength",tooShort:"Too short",weak:"Weak",fair:"Fair",good:"Good",strong:"Strong",showPasswordString:"Show Password"},
strengthColors:{tooShort:"rgb(170, 0, 51)",weak:"rgb(170, 0, 51)",fair:"rgb(255, 204, 51)",good:"rgb(45, 152, 243)",strong:"rgb(118, 194, 97)"}};if(this===c.jqx._jqxPasswordInput.prototype)return b;c.extend(!0,this,b);return b},createInstance:function(){this._inDOM=document.body.contains(this.element);this.render()},render:function(){var b=this,d=c.jqx.browser.version;this._browserCheck="msie"!=c.jqx.browser.browser||"7.0"!=d&&"8.0"!=d;this.widgetID=b.element.id;if("password"!=this.element.getAttribute("type"))throw"Invalid input type. Please set the type attribute of the input element to password.";
this.input=this.element;if(b.isMaterialized()){d=c("<div></div>");d.addClass(b.toThemeProperty("jqx-input-group"));this.host.after(d);var e=this.element,f=this.host.data();d.append(e);e=c("<label></label");this.hint&&(e[0].innerHTML=this.placeHolder);e.addClass(b.toThemeProperty("jqx-input-label"));d.append(e);var g=c("<span></span>");d.append(g);g.addClass(b.toThemeProperty("jqx-input-bar"));d[0].id=this.element.id;this.element.removeAttribute("id");d[0].style.cssText=this.element.style.cssText;
b.input=b.element;this.element.style.cssText="";this.bar=g;this.label=e;this.host=d;this.element=d[0];this.host.data(f);b=this;b.template&&(b.bar.addClass(b.toThemeProperty("jqx-"+b.template)),b.label.addClass(b.toThemeProperty("jqx-"+b.template)))}b._hidden=!0;b._setTheme();b._setAttributes();b._showPassword();b._showStrength();c.jqx.utilities.resize(this.host,function(){if(!b._inDOM){var d=b.element.parentNode;b.element.nextSibling?d.insertBefore(b.icon,b.element.nextSibling):d.appendChild(b.icon);
b._inDOM=!0}else if(b.element===document.activeElement||b.isMaterialized())b._positionIcon(),b.showStrength&&b.host.jqxTooltip("close")})},refresh:function(b){b||(this.removeHandler(this.host,"change.passwordinput"+this.widgetID),this.removeHandler(this.host,"focus.passwordinput"+this.widgetID),this.removeHandler(this.host,"blur.passwordinput"+this.widgetID),this.removeHandler(this.host,"click.passwordinput"+this.widgetID),this.removeHandler(this.host,"keyup.passwordinput"+this.widgetID),this.removeHandler(this.icon,
"mousedown.passwordinput"+this.widgetID),this.removeHandler(c(document),"mouseup.passwordinput"+this.widgetID),this.removeHandler(c(document),"mousedown.passwordinput"+this.widgetID),this._setAttributes(),this._setTheme(),this._showPassword(),this._showStrength())},val:function(b){var d=this.input.value,e="placeholder"in this.input;if(c.isEmptyObject(b)&&""!==b)return e||d!==this.placeHolder||(d=""),d;if(!e||b!==d){if(!e){if(""===b){d!==this.placeHolder&&(this.input.value=this.placeHolder,this.input.setAttribute("type",
"text"));return}this.input.setAttribute("type","password")}this.input.value=b;!0===this.showStrength&&this._evaluateStrength()}},propertyChangedHandler:function(b,d,e,f){"theme"===d?c.jqx.utilities.setTheme(e,f,b.host):"disabled"==d?b.disabled?(b.element.setAttribute("disabled","disabled"),b.element.className+=" "+b.toThemeProperty("jqx-fill-state-disabled")):(b.host.removeAttr("disabled"),b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled"))):"placeHolder"==d?this._browserCheck&&("placeholder"in
this.element?b.element.setAttribute("placeholder",b.placeHolder):""===b.input.value?(b.input.setAttribute("type","text"),b.input.value=f):b.input.value==e&&(b.input.value=f)):this.refresh()},resize:function(b,d){this.width=b;this.height=d;null!=this.width&&-1!=this.width.toString().indexOf("px")?this.element.style.width=this.width:void 0==this.width||isNaN(this.width)||(this.element.style.width=this.width+"px");null!=this.height&&-1!=this.height.toString().indexOf("px")?this.element.style.height=
this.height:void 0==this.height||isNaN(this.height)||(this.element.style.height=this.height+"px")},_setAttributes:function(){var b=this,d=b.element;null!=this.width&&-1!=this.width.toString().indexOf("px")?this.element.style.width=this.width:void 0==this.width||isNaN(this.width)||(this.element.style.width=this.width+"px");null!=this.height&&-1!=this.height.toString().indexOf("px")?this.element.style.height=this.height:void 0==this.height||isNaN(this.height)||(this.element.style.height=this.height+
"px");null!=this.height&&-1!=this.height.toString().indexOf("%")&&(this.element.style.height=this.height);null!=this.width&&-1!=this.width.toString().indexOf("%")&&(this.element.style.width=this.width);b.maxLength&&d.setAttribute("maxlength",b.maxLength);b.minLength&&d.setAttribute("minLength",b.minLength);b.placeHolder&&b._browserCheck&&("placeholder"in b.element?d.setAttribute("placeholder",b.placeHolder):""===d.value&&(d.setAttribute("type","text"),d.value=b.placeHolder));b.disabled?(d.setAttribute("disabled",
"disabled"),d.className+=" "+this.toThemeProperty("jqx-fill-state-disabled")):(d.removeAttribute("disabled"),b.host.removeClass(b.toThemeProperty("jqx-fill-state-disabled")));var e=!1;b.addHandler(d,"change.passwordinput"+b.widgetID,function(d){e||(d.preventDefault(),d.stopPropagation(),e=!0,b._raiseEvent(),e=!1);b._refreshPlaceHolder()});b.addHandler(d,"click.passwordinput"+b.widgetID,function(){b.showPasswordIcon&&b.icon&&(b.icon.style.display="inline",b._positionIcon())});b.interval=null;b.addHandler(d,
"keydown.passwordinput"+b.widgetID,function(){b.changeType="keyboard";if(b.showPasswordIcon&&b.icon){b.interval&&clearInterval(b.interval);var d=0;b.interval=setInterval(function(){"none"!=b.icon.style.display?(b._positionIcon(),d++,5<d&&clearInterval(b.interval)):clearInterval(b.interval)},100)}});b.addHandler(d,"focus.passwordinput"+b.widgetID,function(){b._focused=!0;d.className+=" "+b.toThemeProperty("jqx-fill-state-focus");!b.placeHolder||!b._browserCheck||"placeholder"in b.element||d.value!=
b.placeHolder||(d.value="",b._hidden&&d.setAttribute("type","password"));0<b.val().length&&b.showStrength&&b.host.jqxTooltip("content")&&b.host.jqxTooltip("open");b.showPasswordIcon&&b.icon&&(b.icon.style.display="inline",b._positionIcon())});b.addHandler(d,"blur.passwordinput"+b.widgetID,function(){b._focused=!1;b.host.removeClass(b.toThemeProperty("jqx-fill-state-focus"));!b.placeHolder||!b._browserCheck||"placeholder"in b.input||""!==d.value||(b.input.value=b.placeHolder,b.input.setAttribute("type",
"text"));b.showPasswordIcon&&b._browserCheck&&(!1===b.rtl?b.host.removeClass(b.toThemeProperty("jqx-passwordinput-password-icon-ltr")):b.host.removeClass(b.toThemeProperty("jqx-passwordinput-password-icon-rtl")));b.showStrength&&b.host.jqxTooltip("close");b.showPasswordIcon&&b.icon&&(b.icon.style.display="none")})},_refreshPlaceHolder:function(){this.isMaterialized()||("placeholder"in this.input&&!(c.jqx.browser.msie&&9>c.jqx.browser.version)?this.input.setAttribute("placeHolder",this.placeHolder):
""===this.input.value&&(this.input.value=this.placeHolder));""!==this.input.value?this.element.setAttribute("hint",!0):this.element.removeAttribute("hint");this.label&&(this.label.innerHTML=this.placeHolder)},destroy:function(){this.host.jqxTooltip&&this.host.jqxTooltip("destroy");this.host.remove()},_setTheme:function(){var b="jqx-widget jqx-widget-content jqx-input jqx-input-widget jqx-rc-all";this.rtl?(b+=" jqx-rtl",this.element.style.direction="rtl"):(this.host.removeClass(this.toThemeProperty("jqx-rtl")),
this.element.style.direction="ltr");this.element.className+=" "+this.toThemeProperty(b)},_showPassword:function(){if(this.showPasswordIcon&&this._browserCheck){var b=this,d=document.createElement("span"),e=".passwordinput"+b.widgetID;d.setAttribute("tabindex",-1);d.setAttribute("hasfocus",!1);d.setAttribute("title",b.localization.showPasswordString);d.style.position="absolute";d.style.display="none";d.className=b.toThemeProperty("jqx-passwordinput-password-icon");var f=b.element.parentNode;f&&(b.element.nextSibling?
f.insertBefore(d,b.element.nextSibling):f.appendChild(d));b.icon=d;b._positionIcon();var g=function(){b.element.setAttribute("type","password");b.input&&b.input.setAttribute("type","password");b._hidden=!0},h=function(){!1===b._hidden?g():b._hidden&&(b.element.setAttribute("type","text"),b.input&&b.input.setAttribute("type","text"),b._hidden=!1)};c.jqx.mobile.isTouchDevice()?b.addHandler(b.icon,"mousedown"+e,function(){h();return!1}):(b.addHandler(b.icon,"mousedown"+e,function(){h();return!1}),b.addHandler(c(document),
"mouseup"+e,function(){g();return!1}),b.addHandler(c(document),"mousedown"+e,function(){b._focused&&g()}))}},_positionIcon:function(){var b=this.host.offset(),d=this.element.offsetWidth,e=this.element.offsetHeight,f=c(this.icon);this.rtl?f.offset({top:parseInt(b.top+e/2-5,10),left:b.left+2}):f.offset({top:parseInt(b.top+e/2-5,10),left:b.left+d-18})},_showStrength:function(){if(this.showStrength)if(this.host.jqxTooltip){var b=this.widgetID+"Strength",d=b+"Value",b=b+"Indicator",e;this.strengthTypeRenderer?
(e=this.input.value,"placeholder"in this.input||!this._browserCheck||e!=this.placeHolder||(e=""),this._countCharacters(),e=this.strengthTypeRenderer(e,{letters:this.letters,numbers:this.numbers,specialKeys:this.specials},this.localization.tooShort)):e='<div style="width: 220px;"><div><span style="font-weight: bold;">'+this.localization.passwordStrengthString+': </span><span id="'+d+'"></span></div><div id="'+b+'"></div></div>';this.host.jqxTooltip({theme:this.theme,position:this.showStrengthPosition,
content:e,trigger:"none",autoHide:!1,rtl:this.rtl});this.strengthTypeRenderer||(b=document.getElementById(b),document.getElementById(d).innerHTML=this.localization.tooShort,b.className+=" jqx-passwordinput-password-strength-inicator",b.style.backgroundColor=this.strengthColors.tooShort,b.style["float"]=!1===this.rtl?"left":"right");this._checkStrength()}else throw Error("jqxPasswordInput: Missing reference to jqxtooltip.js");},_checkStrength:function(){var b=this;b.addHandler(b.host,"keyup.passwordinput"+
b.widgetID,function(){b._evaluateStrength()})},_raiseEvent:function(){var b=new c.Event("change");b.args={type:this.changeType};this.changeType=null;b.owner=this;return this.host.trigger(b)},_evaluateStrength:function(){var b=this.input.value,d=b.length;this._countCharacters();0<d&&this.showStrength&&(this.host.jqxTooltip("opened")||this.host.jqxTooltip("open"));var e=this.letters+this.numbers+2*this.specials+this.letters*this.numbers/2+d,f;f=8>d?this.localization.tooShort:20>e?this.localization.weak:
30>e?this.localization.fair:40>e?this.localization.good:this.localization.strong;var g;if(this.strengthTypeRenderer)g=this.strengthTypeRenderer(b,{letters:this.letters,numbers:this.numbers,specialKeys:this.specials},f),this.host.jqxTooltip({content:g});else{this.passwordStrength&&(g=this.passwordStrength(b,{letters:this.letters,numbers:this.numbers,specialKeys:this.specials},f),c.each(this.localization,function(){if(g==this)return f=g,!1}));document.getElementById(this.widgetID+"StrengthValue").innerHTML=
f;var b=document.getElementById(this.widgetID+"StrengthIndicator"),h,l;switch(f){case this.localization.tooShort:h="20%";l=this.strengthColors.tooShort;break;case this.localization.weak:h="40%";l=this.strengthColors.weak;break;case this.localization.fair:h="60%";l=this.strengthColors.fair;break;case this.localization.good:h="80%";l=this.strengthColors.good;break;case this.localization.strong:h="100%",l=this.strengthColors.strong}b.style.width=h;b.style.backgroundColor=l}},_countCharacters:function(){this.specials=
this.numbers=this.letters=0;for(var b=this.input.value,d=b.length,e=0;e<d;e++){var c=b.charAt(e),g=b.charCodeAt(e);64<g&&91>g||96<g&&123>g||127<g&&155>g||159<g&&166>g?this.letters+=1:!1===isNaN(c)?this.numbers+=1:-1!="<>@!#$%^&*()_+[]{}?:;|'\"\\,./~`-=".indexOf(c)&&(this.specials+=1)}},_toPx:function(b){return"number"===typeof b?b+"px":b}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxProgressBar","",{});c.extend(c.jqx._jqxProgressBar.prototype,{defineInstance:function(){var b={colorRanges:[],value:0,oldValue:null,max:100,min:0,orientation:"horizontal",layout:"normal",width:null,height:null,showText:!1,animationDuration:300,disabled:!1,rtl:!1,renderText:null,template:"",aria:{"aria-valuenow":{name:"value",type:"number"},"aria-disabled":{name:"disabled",type:"boolean"}},events:["valueChanged","invalidValue","complete","change"]};if(this===c.jqx._jqxProgressBar.prototype)return b;
c.extend(!0,this,b);return b},createInstance:function(b){var d=this;this.host.addClass(this.toThemeProperty("jqx-progressbar"));this.host.addClass(this.toThemeProperty("jqx-widget"));this.host.addClass(this.toThemeProperty("jqx-widget-content"));this.host.addClass(this.toThemeProperty("jqx-rc-all"));c.jqx.aria(this);if(null==this.width||-1==this.width.toString().indexOf("px"))void 0==this.width||isNaN(this.width);this.host.width(this.width);if(null==this.height||-1==this.height.toString().indexOf("px"))void 0==
this.height||isNaN(this.height);this.host.height(this.height);this.valueDiv=c("<div></div>").appendTo(this.element);this._addRanges();this.valueDiv.addClass(this.toThemeProperty("jqx-fill-state-pressed"));this.template&&this.valueDiv.addClass(this.toThemeProperty("jqx-"+this.template));this.feedbackElementHost=c("<div style='left: 0px; top: 0px; width: 100%; height: 100%; position: absolute;'></div>").appendTo(this.host);this.feedbackElement=c("<span class='text'></span>").appendTo(this.feedbackElementHost);
this.feedbackElement.addClass(this.toThemeProperty("jqx-progressbar-text"));this.oldValue=this._value();this.refresh();c.jqx.utilities.resize(this.host,function(){d.refresh()})},_addRanges:function(){if(0!=this.colorRanges.length)for(var b="vertical"==this.orientation,d=this.colorRanges,e=d.length,c=0;c<e;c++)this._createColorElements(d[c].stop,d[c].color,b,e-c,c)},_refreshColorElements:function(){for(var b=this.host.outerWidth(),d=this.host.outerHeight(),e="vertical"==this.orientation,c=0;c<this.colorRanges.length;c++){var g=
this.colorRanges[c].element;if(!g){this.host.find(".jqx-progressbar-range").remove();this._addRanges();break}var h=this.colorRanges[c].stop;h>Math.min(this.max,this.value)&&(h=Math.min(this.max,this.value));h=100*(h-this.min)/(this.max-this.min);size=e?d*h/100:b*h/100;size+="px";e?(g.css("height",size),"reverse"==this.layout?g.css("bottom",0):g.css("top",0)):(g.css("width",size),(this.rtl||"reverse"==this.layout)&&g.css("right","0px"))}},_createColorElements:function(b,d,e,f,g){b>Math.min(this.max,
this.value)&&(b=Math.min(this.max,this.value));b=100*b/this.max;this.host.width();this.host.height();b=e?this.host.outerHeight()*b/100:this.host.outerWidth()*b/100;b+="px";var h=c(this.valueDiv).parent()[0];h.style.position="relative";e?(e=c("<div/>"),e.attr("class","jqx-progressbar-range"),e.css("width","100%"),e.css("height",b),e.css("background-color",d),e.css("position","absolute"),e.css("z-index",f),"reverse"==this.layout?e.css("bottom",0):e.css("top",0)):(e=c("<div/>"),e.attr("class","jqx-progressbar-range"),
e.css("width",b),e.css("height","100%"),e.css("background-color",d),e.css("position","absolute"),e.css("z-index",f),e.css("top","0px"),this.rtl&&e.css("right","0px"));e.appendTo(h);this.colorRanges[g].element=e},resize:function(b,d){this.width=b;this.height=d;this.refresh()},destroy:function(){this.host.removeClass();this.valueDiv.removeClass();this.valueDiv.remove();this.feedbackElement.remove()},_raiseevent:function(b,d,e){if(void 0!=this.isInitialized&&1==this.isInitialized)return b=new c.Event(this.events[b]),
b.previousValue=d,b.currentValue=e,b.owner=this,this.host.trigger(b)},actualValue:function(b){if(void 0===b)return this._value();c.jqx.aria(this,"aria-valuenow",b);c.jqx.setvalueraiseevent(this,"value",b);return this._value()},val:function(b){return 0==arguments.length||"object"==typeof b?this.actualValue():this.actualValue(b)},propertiesChangedHandler:function(b,d,e){e&&e.width&&e.height&&2==Object.keys(e).length&&(b.host.width(e.width),b.host.height(e.height),b.refresh())},propertyChangedHandler:function(b,
d,e,f){!this.isInitialized||e==f||b.batchUpdate&&b.batchUpdate.width&&b.batchUpdate.height&&2==Object.keys(b.batchUpdate).length||("colorRanges"==d&&(b.host.find(".jqx-progressbar-range").remove(),b._addRanges()),"min"==d&&b.value<f?b.value=f:"max"==d&&b.value>f&&(b.value=f),"value"===d&&void 0!=this.value&&(this.value=f,this.oldValue=e,c.jqx.aria(b,"aria-valuenow",f),(f<this.min||f>this.max)&&this._raiseevent(1,e,f),this.refresh()),"theme"==d&&c.jqx.utilities.setTheme(e,f,b.host),"renderText"==d||
"orientation"==d||"layout"==d||"showText"==d||"min"==d||"max"==d?this.refresh():"width"==d&&void 0!=this.width?void 0==this.width||isNaN(this.width)||(this.host.width(this.width),this.refresh()):"height"!=d||void 0==this.height||void 0==this.height||isNaN(this.height)||(this.host.height(this.height),this.refresh()),"disabled"==d&&this.refresh())},_value:function(){var b=this.value;"number"!==typeof b&&(b=parseInt(b),b=isNaN(b)?0:b);return Math.min(this.max,Math.max(this.min,b))},_percentage:function(){return 100*
(this._value()-this.min)/(this.max-this.min)},_textwidth:function(b){b=c("<span>"+b+"</span>");c(this.host).append(b);var d=b.width();b.remove();return d},_textheight:function(b){b=c("<span>"+b+"</span>");c(this.host).append(b);var d=b.height();b.remove();return d},_initialRender:!0,refresh:function(b){if(!0!==b){var d=this.actualValue(),e=this._percentage();if(this.disabled)this.host.addClass(this.toThemeProperty("jqx-progressbar-disabled")),this.host.addClass(this.toThemeProperty("jqx-fill-state-disabled"));
else if(this.host.removeClass(this.toThemeProperty("jqx-progressbar-disabled")),this.host.removeClass(this.toThemeProperty("jqx-fill-state-disabled")),c(this.element.children[0]).show(),!isNaN(d)&&!isNaN(e)){this.oldValue!==d&&(this._raiseevent(0,this.oldValue,d),this._raiseevent(3,this.oldValue,d),this.oldValue=d);var f=this.oldValue,g=this.host.outerHeight(),h=this.host.outerWidth();null!=this.width&&(h=parseInt(this.width));null!=this.height&&(g=parseInt(this.height));this._refreshColorElements();
b=parseInt(this.host.outerWidth())/2;parseInt(this.host.outerHeight());isNaN(e)&&(e=0);this.valueDiv.removeClass(this.toThemeProperty("jqx-progressbar-value-vertical jqx-progressbar-value"));"horizontal"==this.orientation?(this.valueDiv.width(0),this.valueDiv[0].style.height="100%",this.valueDiv.addClass(this.toThemeProperty("jqx-progressbar-value"))):(this.valueDiv[0].style.width="100%",this.valueDiv.height(0),this.valueDiv.addClass(this.toThemeProperty("jqx-progressbar-value-vertical")));var l=
this;try{var q=this.element.children[0];c(q)[0].style.position="relative";if("horizontal"==this.orientation){c(q).toggle(d>=this.min);h=this.host.outerWidth()*e/100;g=0;if("reverse"==this.layout||this.rtl)this._initialRender&&(c(q)[0].style.left=this.host.width()+"px",c(q)[0].style.width=0),g=this.host.outerWidth()-h;c(q).stop();c(q).animate({width:h,left:g+"px"},this.animationDuration,function(){l._value()===l.max&&l._raiseevent(2,f,l.max)})}else c(q).toggle(d>=this.min),g=this.host.height()*e/100,
h=0,"reverse"==this.layout&&(this._initialRender&&(c(q)[0].style.top=this.host.height()+"px",c(q)[0].style.height=0),h=this.host.height()-g),c(q).stop(),c(q).animate({height:g,top:h+"px"},this.animationDuration,function(){var b=l._percentage();isNaN(b)&&(b=0);b.toFixed(0)==l.min&&(c(q).hide(),l._value()===l.max&&l._raiseevent(2,f,l.max))})}catch(r){}this._initialRender=!1;this.feedbackElement.html(e.toFixed(0)+"%").toggle(1==this.showText);this.renderText&&this.feedbackElement.html(this.renderText(e.toFixed(0)+
"%",e));this.feedbackElement.css("position","absolute");this.feedbackElement.css("top","50%");this.feedbackElement.css("left","0");0<this.colorRanges.length&&this.feedbackElement.css("z-index",this.colorRanges.length+1);e=this.feedbackElement.height();g=this.feedbackElement.width();b=Math.floor(b-parseInt(g)/2);this.feedbackElement.css({left:b,"margin-top":-parseInt(e)/2+"px"})}}}})})(jqxBaseFramework);
(function(c){c.jqx.jqxWidget("jqxValidator","",{});c.extend(c.jqx._jqxValidator.prototype,{defineInstance:function(){var b={rules:null,scroll:!0,focus:!0,scrollDuration:300,scrollCallback:null,position:"right",arrow:!0,animation:"fade",animationDuration:150,closeOnClick:!0,onError:null,onSuccess:null,ownerElement:null,_events:["validationError","validationSuccess"],hintPositionOffset:5,_inputHint:[],rtl:!1,hintType:"tooltip"};if(this===c.jqx._jqxValidator.prototype)return b;c.extend(!0,this,b);return b},
createInstance:function(){"label"==this.hintType&&150==this.animationDuration&&(this.animationDuration=0);this._configureInputs();this._removeEventListeners();this._addEventListeners()},destroy:function(){this._removeEventListeners();this.hide()},validate:function(b){var d=!0,e,f=Infinity,g,h,l,q=[];this.updatePosition();for(var r=this,t=0,v=0;v<this.rules.length;v+=1)"function"===typeof this.rules[v].rule&&t++;this.positions=[];for(v=0;v<this.rules.length;v+=1)if(c(this.rules[v].input),"function"===
typeof this.rules[v].rule?this._validateRule(this.rules[v],function(y,w){e=y;if(0==e){d=!1;c(w.input);l=c(w.input);q.push(l);var z=l.offset();z&&(g=z.top,f>g&&(f=g,h=l))}t--;0==t&&"function"===typeof b&&(r._handleValidation(d,f,h,q),b&&b(d))}):e=this._validateRule(this.rules[v]),0==e){d=!1;l=c(this.rules[v].input);q.push(l);var y=l.offset();y&&(g=y.top,f>g&&(f=g,h=l))}if(0==t)return this._handleValidation(d,f,h,q),d},validateInput:function(b){b=this._getRulesForInput(b);for(var d=!0,e=0;e<b.length;e+=
1)this._validateRule(b[e])||(d=!1);return d},hideHint:function(b){b=this._getRulesForInput(b);for(var d=0;d<b.length;d+=1)this._hideHintByRule(b[d])},hide:function(){for(var b=0;b<this.rules.length;b+=1)this._hideHintByRule(this.rules[b])},updatePosition:function(){var b;this.positions=[];for(var d=0;d<this.rules.length;d+=1)b=this.rules[d],b.hint&&this._hintLayout(b.hint,c(b.input),b.position,b)},_getRulesForInput:function(b){for(var d=[],e=0;e<this.rules.length;e+=1)this.rules[e].input===b&&d.push(this.rules[e]);
return d},_validateRule:function(b,d){var e=c(b.input),f,g=!0,h=this,l=function(g){g?(h._hideHintByRule(b),d&&d(!0,b)):(g=h.animation,h.animation=null,b.hint&&h._hideHintByRule(b),"none"==c(e).css("display")?h._hideHintByRule(b):0==c(e).parents().length?h._hideHintByRule(b):(f=b.hintRender.apply(h,[b.message,e]),h._hintLayout(f,e,b.position,b),h._showHint(f),b.hint=f,h._removeLowPriorityHints(b),d&&d(!1,b),h.animation=g))},q=!1;"function"===typeof b.rule&&(q=b.rule.call(this,e,l),1==q&&d&&d(!0,b));
"function"===typeof b.rule&&0==q?("function"!==typeof b.hintRender||b.hint||this._higherPriorityActive(b)||!e.is(":visible")||(f=b.hintRender.apply(this,[b.message,e]),this._removeLowPriorityHints(b),this._hintLayout(f,e,b.position,b),this._showHint(f),b.hint=f),g=!1,d&&d(!1,b)):this._hideHintByRule(b);return g},_hideHintByRule:function(b){var d=c(b.input),e=this,f,g=function(){if("label"==e.hintType){if("top"==e.position||"left"==e.position){if(d.prev().hasClass(".jqx-validator-error-label"))return}else if(d.next().hasClass(".jqx-validator-error-label"))return;
"input"!=d[0].nodeName.toLowerCase()?0<d.find("input").length?(0<d.find(".jqx-input").length?d.find(".jqx-input").removeClass(e.toThemeProperty("jqx-validator-error-element")):0<d.find(".jqx-text-area").length?d.find(".jqx-text-area").removeClass(e.toThemeProperty("jqx-validator-error-element")):d.is(".jqx-checkbox")&&d.find(".jqx-checkbox-default").removeClass(e.toThemeProperty("jqx-validator-error-element")),d.is(".jqx-radiobutton")?d.find(".jqx-radiobutton-default").removeClass(e.toThemeProperty("jqx-validator-error-element")):
d.removeClass(e.toThemeProperty("jqx-validator-error-element"))):d.removeClass(e.toThemeProperty("jqx-validator-error-element")):d.removeClass(e.toThemeProperty("jqx-validator-error-element"))}};if(b){if(f=b.hint)this.positions&&this.positions[Math.round(f.offset().top)+"_"+Math.round(f.offset().left)]&&(this.positions[Math.round(f.offset().top)+"_"+Math.round(f.offset().left)]=null),"fade"===this.animation?f.fadeOut(this.animationDuration,function(){f.remove();g()}):(f.remove(),g());b.hint=null}},
_handleValidation:function(b,d,e,c){if(b){if(this._raiseEvent(1),"function"===typeof this.onSuccess)this.onSuccess()}else if(this._scrollHandler(d),this.focus&&e.focus(),this._raiseEvent(0,{invalidInputs:c}),"function"===typeof this.onError)this.onError(c)},_scrollHandler:function(b){if(this.scroll){var d=this;c("html,body").animate({scrollTop:b},this.scrollDuration,function(){"function"===typeof d.scrollCallback&&d.scrollCallback.call(d)})}},_higherPriorityActive:function(b){for(var d=!1,e,c=this.rules.length-
1;0<=c;--c){e=this.rules[c];if(d&&e.input===b.input&&e.hint)return!0;e===b&&(d=!0)}return!1},_removeLowPriorityHints:function(b){for(var d=!1,e,c=0;c<this.rules.length;c+=1)e=this.rules[c],d&&e.input===b.input&&this._hideHintByRule(e),e===b&&(d=!0)},_getHintRuleByInput:function(b){for(var d,e=0;e<this.rules.length;e+=1)if(d=this.rules[e],c(d.input)[0]===b[0]&&d.hint)return d;return null},_removeEventListeners:function(){for(var b,d,e=0;e<this.rules.length;e+=1){b=this.rules[e];d=b.action.split(",");
b=c(b.input);for(var f=0;f<d.length;f+=1)this.removeHandler(b,c.trim(d[f])+".jqx-validator")}},_addEventListeners:function(){var b,d;if(0<this.host.parents(".jqx-window").length){var e=this,f=function(){e.updatePosition()};b=this.host.parents(".jqx-window");this.addHandler(b,"closed",function(){e.hide()});this.addHandler(b,"moved",f);this.addHandler(b,"moving",f);this.addHandler(b,"resized",f);this.addHandler(b,"resizing",f);this.addHandler(c(document.parentWindow),"scroll",function(){e.scroll&&f()})}for(var g=
0;g<this.rules.length;g+=1)b=this.rules[g],d=c(b.input),this._addListenerTo(d,b)},_addListenerTo:function(b,d){var e=this,f=d.action.split(","),g=!1;this._isjQWidget(b)&&(g=!0);for(var h=0;h<f.length;h+=1){var l=c.trim(f[h]);!g||"blur"!=l&&"focus"!=l||b&&"input"!=b[0].nodeName.toLowerCase()&&(b=b.find("input"));this.addHandler(b,l+".jqx-validator",function(b){e._validateRule(d)})}},_configureInputs:function(){this.rules=this.rules||[];for(var b=0;b<this.rules.length;b+=1)this._handleInput(b)},_handleInput:function(b){b=
this.rules[b];b.position||(b.position=this.position);b.message||(b.message="Validation Failed!");b.action||(b.action="blur");b.hintRender||(b.hintRender=this._hintRender);b.rule?this._handleRule(b):b.rule=null},_handleRule:function(b){var d=b.rule,e,c,g=!1;"string"===typeof d?(0<=d.indexOf("=")&&(d=d.split("="),c=d[1].split(","),d=d[0]),(e=this["_"+d])?b.rule=function(b,d){return e.apply(this,[b].concat(c))}:g=!0):"function"!==typeof d?g=!0:b.rule=d;if(g)throw Error("Wrong parameter!");},_required:function(b){switch(this._getType(b)){case "jqx-input-inner":if(0<
b.find("input").length)return""!==c.trim(b.find("input").val());break;case "textarea":case "password":case "jqx-input":case "jqx-text-area":case "text":var d=c.data(b[0]);return d.jqxMaskedInput?(d=b.jqxMaskedInput("promptChar"),(b=b.jqxMaskedInput("value"))&&0>b.indexOf(d)):d.jqxNumberInput?""!==b.jqxNumberInput("inputValue"):d.jqxDateTimeInput?!0:""!==c.trim(b.val());case "checkbox":return b.is(":checked");case "radio":return b.is(":checked");case "jqx-check-box":case "jqx-radio-button":return b[0].val();
case "jqxCheckBox":case "jqxcheckbox":case "jqxradiobutton":case "jqxRadioButton":b=b.find("input").val();if(!0===b||1===b||"true"===b)return!0;break;case "div":if(b.is(".jqx-checkbox"))return b.jqxCheckBox("checked");if(b.is(".jqx-radiobutton"))return b.jqxRadioButton("checked")}return!1},_notNumber:function(b){return this._validateText(b,function(b){return""==b?!0:!/\d/.test(b)})},_startWithLetter:function(b){return this._validateText(b,function(b){return""==b?!0:!/\d/.test(b.substring(0,1))})},
_number:function(b){return this._validateText(b,function(b){if(""==b)return!0;b=new Number(b);return!isNaN(b)&&isFinite(b)})},_phone:function(b){return this._validateText(b,function(b){return""==b?!0:/^\(\d{3}\)(\d){3}-(\d){4}$/.test(b)})},_length:function(b,d,e){return this._minLength(b,d)&&this._maxLength(b,e)},_maxLength:function(b,d){d=parseInt(d,10);return this._validateText(b,function(b){return b.length<=d})},_minLength:function(b,d){d=parseInt(d,10);return this._validateText(b,function(b){return b.length>=
d})},_email:function(b){return this._validateText(b,function(b){return""==b?!0:/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(b)})},_zipCode:function(b){return this._validateText(b,function(b){return""==b?!0:/^(^\d{5}$)|(^\d{5}-\d{4}$)|(\d{3}-\d{2}-\d{4})$/.test(b)})},_ssn:function(b){return this._validateText(b,function(b){return""==b?!0:/\d{3}-\d{2}-\d{4}/.test(b)})},_validateText:function(b,
d){var e;return this._isTextInput(b)?(e=this._isjQWidget(b)?0<b.find("input").length?b.find("input").val():b.val():b.val(),d(e)):!1},_isjQWidget:function(b){var d=c.data(b[0]);return d.jqxMaskedInput||d.jqxNumberInput||d.jqxDateTimeInput||0<=b[0].tagName.toLowerCase().indexOf("jqx")||0<=b[0].tagName.toLowerCase().indexOf("jqx-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-password-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-complex-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-formatted-input")||
0<=b[0].tagName.toLowerCase().indexOf("jqx-masked-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-date-time-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-number-input")||0<=b[0].tagName.toLowerCase().indexOf("jqx-check-box")||0<=b[0].tagName.toLowerCase().indexOf("jqx-radio-button")||0<=b[0].tagName.toLowerCase().indexOf("jqxcheckbox")||0<=b[0].tagName.toLowerCase().indexOf("angular")?!0:!1},_isTextInput:function(b){var d=this._getType(b);return"text"===d||"textarea"===d||"password"===d||
"jqx-input-inner"===d||b.is(".jqx-input")||b.is(".jqx-text-area")},_getType:function(b){if(b[0]){var d=b[0].tagName.toLowerCase();return"textarea"===d?"textarea":b.is(".jqx-input")?"jqx-input":b.is(".jqx-text-area")?"jqx-text-area":0<b.find(".jqx-input").length?"jqx-input-inner":"input"===d?b=c(b).attr("type")?c(b).attr("type").toLowerCase():"text":"jqx-password-input"===d?"password":"jqx-check-box"===d?"jqx-check-box":"jqx-radio-button"===d?"jqx-radio-button":d}},_hintRender:function(b,d){if("label"==
this.hintType){var e=c('<label class="'+this.toThemeProperty("jqx-validator-error-label")+'"></label>');e.html(b);var f=!1;0<d.parent().find(".jqx-input-label").length&&(e=d.parent().find(".jqx-input-label"),d.data().jqxWidget.hint&&(e.html(b),e.addClass(this.toThemeProperty("jqx-validator-error-label")),d.data().jqxWidget.host.attr("hint",!0)),this.hasHint=f=!0);var g=this;this.closeOnClick&&e.click(function(){g.hideHint(d.selector)});f||("left"==this.position||"top"==this.position?e.insertBefore(c(d)):
e.insertAfter(c(d)));return e}var e=c('<div class="'+this.toThemeProperty("jqx-validator-hint")+' jqx-rc-all"></div>'),h=this;e.html(b);this.closeOnClick&&e.click(function(){h.hideHint(d.selector)});null==this.ownerElement?e.appendTo(document.body):this.ownerElement.innerHTML?e.appendTo(c(this.ownerElement)):e.appendTo(this.ownerElement);return e},_hintLayout:function(b,d,e,f){if(this._hintRender===f.hintRender)if(f=this._getPosition(d,e,b,f),"label"==this.hintType){f="2px";if("left"==this.position||
"top"==this.position)f="-2px";"input"!=d[0].nodeName.toLowerCase()&&"textarea"!=d[0].nodeName.toLowerCase()?(0<d.find(".jqx-text-area").length&&d.find(".jqx-text-area").addClass(this.toThemeProperty("jqx-validator-error-element")),0<d.find("input").length&&(0<d.find(".jqx-input").length?d.find(".jqx-input").addClass(this.toThemeProperty("jqx-validator-error-element")):0<d.find(".jqx-text-area").length?d.find(".jqx-text-area").addClass(this.toThemeProperty("jqx-validator-error-element")):d.is(".jqx-checkbox")&&
d.find(".jqx-checkbox-default").addClass(this.toThemeProperty("jqx-validator-error-element")),d.is(".jqx-radiobutton")?d.find(".jqx-radiobutton-default").addClass(this.toThemeProperty("jqx-validator-error-element")):d.addClass(this.toThemeProperty("jqx-validator-error-element")))):d.addClass(this.toThemeProperty("jqx-validator-error-element"));var g=c("<span></span>");g.addClass(this.toThemeProperty("jqx-validator-hint"));g.html(b.text());g.appendTo(c(document.body));var h=g.outerWidth();g.remove();
this.hasHint||(b.css({position:"relative",left:c(d).css("margin-left"),width:c(d).width(),top:f}),"center"==e&&(b.css("width",h),b.css("left","0px"),b.css("margin-left","auto"),b.css("margin-right","auto")))}else b.css({position:"absolute",left:f.left,top:f.top}),this.arrow&&this._addArrow(d,b,e,f)},_showHint:function(b){b&&"fade"===this.animation&&(b.fadeOut(0),b.fadeIn(this.animationDuration))},_getPosition:function(b,d,e,f){var g=b.offset(),h=b.outerWidth(),l=b.outerHeight();this.rtl&&0<=d.indexOf("left")&&
(d="right");this.rtl&&0<=d.indexOf("right")&&(d="left");null!=this.ownerElement&&(g={left:0,top:0},g.top=parseInt(g.top)+b.position().top,g.left=parseInt(g.left)+b.position().left);f&&f.hintPositionRelativeElement&&(f=c(f.hintPositionRelativeElement),g=f.offset(),h=f.width(),l=f.height());f=0<=d.indexOf("top")?g.top-l:0<=d.indexOf("bottom")?g.top+e.outerHeight()+this.hintPositionOffset+5:g.top;e=0<=d.indexOf("center")?g.left+this.hintPositionOffset+(h-e.outerWidth())/2:0<=d.indexOf("left")?g.left-
e.outerWidth()-this.hintPositionOffset:0<=d.indexOf("right")?g.left+h+this.hintPositionOffset:g.left+this.hintPositionOffset;0<=d.indexOf(":")&&(d=d.split(":")[1].split(","),e+=parseInt(d[0],10),f+=parseInt(d[1],10));this.positions||(this.positions=[]);this.positions[Math.round(f)+"_"+Math.round(e)]&&this.positions[Math.round(f)+"_"+Math.round(e)].top==f&&(f+=b.outerHeight());this.positions[Math.round(f)+"_"+Math.round(e)]={left:e,top:f};return{left:e,top:f}},_addArrow:function(b,d,e,f){b=c('<div class="'+
this.toThemeProperty("jqx-validator-hint-arrow")+'"></div>');var g,h;this.rtl&&0<=e.indexOf("left")&&(e="right");this.rtl&&0<=e.indexOf("right")&&(e="left");d.children(".jqx-validator-hint-arrow").remove();d.append(b);h=b.outerHeight();f=b.outerWidth();var l=d.outerHeight();d=d.outerWidth();this._addImage(b);h=0<=e.indexOf("top")?l-h:0<=e.indexOf("bottom")?-h:(l-h)/2-h/2;0<=e.indexOf("center")?g=(d-f)/2:0<=e.indexOf("left")?g=d-f/2-1:0<=e.indexOf("right")&&(g=-f/2);if(0<=e.indexOf("topright")||0<=
e.indexOf("bottomright"))g=0;if(0<=e.indexOf("topleft")||0<=e.indexOf("bottomleft"))g=d-f;b.css({position:"absolute",left:g,top:h})},_addImage:function(b){var d=b.css("background-image"),d=d.replace('url("',""),d=d.replace('")',""),d=d.replace("url(",""),d=d.replace(")","");b.css("background-image","none");b.append('<img src="'+d+'" alt="Arrow" style="position: relative; top: 0px; left: 0px; width: '+b.width()+"px; height: "+b.height()+'px;" />')},_raiseEvent:function(b,d){var e=c.Event(this._events[b]);
e.args=d;return this.host.trigger(e)},propertyChangedHandler:function(b,d,e,c){"rules"===d&&(this._configureInputs(),this._removeEventListeners(),this._addEventListeners())}})})(jqxBaseFramework);
var saveAs=saveAs||function(c){if(!("undefined"===typeof c||"undefined"!==typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=c.document.createElementNS("http://www.w3.org/1999/xhtml","a"),d="download"in b,e=/constructor/i.test(c.HTMLElement),f=/CriOS\/[\d]+/.test(navigator.userAgent),g=function(b){(c.setImmediate||c.setTimeout)(function(){throw b;},0)},h=function(b){setTimeout(function(){"string"===typeof b?(c.URL||c.webkitURL||c).revokeObjectURL(b):b.remove()},4E4)},l=function(b){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(b.type)?
new Blob([String.fromCharCode(65279),b],{type:b.type}):b},q=function(q,r,y){y||(q=l(q));var A=this,w="application/octet-stream"===q.type,z,C=function(){for(var b=["writestart","progress","write","writeend"],b=[].concat(b),d=b.length;d--;){var e=A["on"+b[d]];if("function"===typeof e)try{e.call(A,A)}catch(c){g(c)}}};y=function(){if((f||w&&e)&&c.FileReader){var b=new FileReader;b.onloadend=function(){var d=f?b.result:b.result.replace(/^data:[^;]*;/,"data:attachment/file;");c.open(d,"_blank")||(c.location.href=
d);A.readyState=A.DONE;C()};b.readAsDataURL(q);A.readyState=A.INIT}else z||(z=(c.URL||c.webkitURL||c).createObjectURL(q)),w?c.location.href=z:c.open(z,"_blank")||(c.location.href=z),A.readyState=A.DONE,C(),h(z)};A.readyState=A.INIT;d?(z=(c.URL||c.webkitURL||c).createObjectURL(q),setTimeout(function(){b.href=z;b.download=r;var d=new MouseEvent("click");b.dispatchEvent(d);C();h(z);A.readyState=A.DONE})):y()},r=q.prototype;if("undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob)return function(b,
d,e){d=d||b.name||"download";e||(b=l(b));return navigator.msSaveOrOpenBlob(b,d)};r.abort=function(){};r.readyState=r.INIT=0;r.WRITING=1;r.DONE=2;r.error=r.onwritestart=r.onprogress=r.onwrite=r.onabort=r.onerror=r.onwriteend=null;return function(b,d,e){return new q(b,d||b.name||"download",e)}}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content);
"undefined"!==typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!==typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs});"use strict";var CBStatIconField=function(c){jsGrid.Field.call(this,c)};CBStatIconField.prototype=new jsGrid.Field({css:"jsg-icon",align:"center",itemTemplate:genTemplate("statIcon")});jsGrid.fields.staticon=CBStatIconField;var CBResIconField=function(c){jsGrid.Field.call(this,c)};
CBResIconField.prototype=new jsGrid.Field({css:"jsg-icon",align:"center",itemTemplate:genTemplate("resIcon")});jsGrid.fields.resicon=CBResIconField;function genTemplate(c){return function(b,d){return b?String.formatEx('<span data-{0}="'+d.id+'"><img src="'+("/Common/Media/Ribbons/Reader/Status/"+b+"16.png")+'"height="16"></span>',c):String.formatEx('<span data-{0}="'+d.id+'"></span>',c)}}
(function(c){"object"===typeof exports&&"undefined"!==typeof module?module.exports=c():"function"===typeof define&&define.amd?define([],c):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).localforage=c()})(function(){return function b(d,e,f){function g(l,r){if(!e[l]){if(!d[l]){var t="function"==typeof require&&require;if(!r&&t)return t(l,!0);if(h)return h(l,!0);t=Error("Cannot find module '"+l+"'");throw t.code="MODULE_NOT_FOUND",t;}t=e[l]=
{exports:{}};d[l][0].call(t.exports,function(b){var e=d[l][1][b];return g(e?e:b)},t,t.exports,b,d,e,f)}return e[l].exports}for(var h="function"==typeof require&&require,l=0;l<f.length;l++)g(f[l]);return g}({1:[function(b,d,e){(function(b){function e(){v=!0;for(var b,d,f=y.length;f;){d=y;y=[];for(b=-1;++b<f;)d[b]();f=y.length}v=!1}var h=b.MutationObserver||b.WebKitMutationObserver,l;if(h){var q=0,h=new h(e),r=b.document.createTextNode("");h.observe(r,{characterData:!0});l=function(){r.data=q=++q%2}}else if(b.setImmediate||
"undefined"===typeof b.MessageChannel)l="document"in b&&"onreadystatechange"in b.document.createElement("script")?function(){var d=b.document.createElement("script");d.onreadystatechange=function(){e();d.onreadystatechange=null;d.parentNode.removeChild(d);d=null};b.document.documentElement.appendChild(d)}:function(){setTimeout(e,0)};else{var t=new b.MessageChannel;t.port1.onmessage=e;l=function(){t.port2.postMessage(0)}}var v,y=[];d.exports=function(b){1!==y.push(b)||v||l()}}).call(this,"undefined"!==
typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],2:[function(b,d,e){function f(){}function g(b){if("function"!==typeof b)throw new TypeError("resolver must be a function");this.state=z;this.queue=[];this.outcome=void 0;b!==f&&r(this,b)}function h(b,d,e){this.promise=b;"function"===typeof d&&(this.onFulfilled=d,this.callFulfilled=this.otherCallFulfilled);"function"===typeof e&&(this.onRejected=e,this.callRejected=this.otherCallRejected)}function l(b,d,
e){v(function(){var f;try{f=d(e)}catch(g){return y.reject(b,g)}f===b?y.reject(b,new TypeError("Cannot resolve promise with itself")):y.resolve(b,f)})}function q(b){var d=b&&b.then;if(b&&"object"===typeof b&&"function"===typeof d)return function(){d.apply(b,arguments)}}function r(b,d){function e(d){g||(g=!0,y.reject(b,d))}function f(d){g||(g=!0,y.resolve(b,d))}var g=!1,h=t(function(){d(f,e)});"error"===h.status&&e(h.value)}function t(b,d){var e={};try{e.value=b(d),e.status="success"}catch(f){e.status=
"error",e.value=f}return e}var v=b(1),y={},A=["REJECTED"],w=["FULFILLED"],z=["PENDING"];d.exports=e=g;g.prototype["catch"]=function(b){return this.then(null,b)};g.prototype.then=function(b,d){if("function"!==typeof b&&this.state===w||"function"!==typeof d&&this.state===A)return this;var e=new this.constructor(f);this.state!==z?l(e,this.state===w?b:d,this.outcome):this.queue.push(new h(e,b,d));return e};h.prototype.callFulfilled=function(b){y.resolve(this.promise,b)};h.prototype.otherCallFulfilled=
function(b){l(this.promise,this.onFulfilled,b)};h.prototype.callRejected=function(b){y.reject(this.promise,b)};h.prototype.otherCallRejected=function(b){l(this.promise,this.onRejected,b)};y.resolve=function(b,d){var e=t(q,d);if("error"===e.status)return y.reject(b,e.value);if(e=e.value)r(b,e);else{b.state=w;b.outcome=d;for(var e=-1,f=b.queue.length;++e<f;)b.queue[e].callFulfilled(d)}return b};y.reject=function(b,d){b.state=A;b.outcome=d;for(var e=-1,f=b.queue.length;++e<f;)b.queue[e].callRejected(d);
return b};e.resolve=function(b){return b instanceof this?b:y.resolve(new this(f),b)};e.reject=function(b){var d=new this(f);return y.reject(d,b)};e.all=function(b){function d(b,f){e.resolve(b).then(function(b){l[f]=b;++q!==g||h||(h=!0,y.resolve(z,l))},function(b){h||(h=!0,y.reject(z,b))})}var e=this;if("[object Array]"!==Object.prototype.toString.call(b))return this.reject(new TypeError("must be an array"));var g=b.length,h=!1;if(!g)return this.resolve([]);for(var l=Array(g),q=0,w=-1,z=new this(f);++w<
g;)d(b[w],w);return z};e.race=function(b){function d(b){e.resolve(b).then(function(b){h||(h=!0,y.resolve(q,b))},function(b){h||(h=!0,y.reject(q,b))})}var e=this;if("[object Array]"!==Object.prototype.toString.call(b))return this.reject(new TypeError("must be an array"));var g=b.length,h=!1;if(!g)return this.resolve([]);for(var l=-1,q=new this(f);++l<g;)d(b[l]);return q}},{1:1}],3:[function(b,d,e){d="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:
{};"function"!==typeof d.Promise&&(d.Promise=b(2))},{2:2}],4:[function(b,d,e){function f(b,d){b=b||[];d=d||{};try{return new Blob(b,d)}catch(e){if("TypeError"!==e.name)throw e;for(var f=new ("undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),g=0;g<b.length;g+=1)f.append(b[g]);return f.getBlob(d.type)}}function g(b,d){d&&b.then(function(b){d(null,b)},function(b){d(b)})}function h(b,d,e){"function"===
typeof d&&b.then(d);if("function"===typeof e)b["catch"](e)}function l(b){"string"!==typeof b&&(console.warn(b+" used as a key, but it is not a string."),b=String(b));return b}function q(){if(arguments.length&&"function"===typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function r(b){return(new H(function(d){var e=b.transaction("local-forage-detect-blob-support","readwrite"),g=f([""]);e.objectStore("local-forage-detect-blob-support").put(g,"key");e.onabort=function(b){b.preventDefault();
b.stopPropagation();d(!1)};e.oncomplete=function(){var b=navigator.userAgent.match(/Chrome\/(\d+)/),e=navigator.userAgent.match(/Edge\//);d(e||!b||43<=parseInt(b[1],10))}}))["catch"](function(){return!1})}function t(b){return"boolean"===typeof J?H.resolve(J):r(b).then(function(b){return J=b})}function v(b){b=P[b.name];var d={};d.promise=new H(function(b,e){d.resolve=b;d.reject=e});b.deferredOperations.push(d);b.dbReady=b.dbReady?b.dbReady.then(function(){return d.promise}):d.promise}function y(b){if(b=
P[b.name].deferredOperations.pop())return b.resolve(),b.promise}function A(b,d){var e=P[b.name].deferredOperations.pop();if(e)return e.reject(d),e.promise}function w(b,d){return new H(function(e,f){if(b.db)if(d)v(b),b.db.close();else return e(b.db);var g=[b.name];d&&g.push(b.version);var h=R.open.apply(R,g);d&&(h.onupgradeneeded=function(d){var e=h.result;try{e.createObjectStore(b.storeName),1>=d.oldVersion&&e.createObjectStore("local-forage-detect-blob-support")}catch(f){if("ConstraintError"===f.name)console.warn('The database "'+
b.name+'" has been upgraded from version '+d.oldVersion+" to version "+d.newVersion+', but the storage "'+b.storeName+'" already exists.');else throw f;}});h.onerror=function(b){b.preventDefault();f(h.error)};h.onsuccess=function(){e(h.result);y(b)}})}function z(b,d){if(!b.db)return!0;var e=!b.db.objectStoreNames.contains(b.storeName),f=b.version>b.db.version;b.version<b.db.version&&(b.version!==d&&console.warn('The database "'+b.name+"\" can't be downgraded from version "+b.db.version+" to version "+
b.version+"."),b.version=b.db.version);return f||e?(e&&(e=b.db.version+1,e>b.version&&(b.version=e)),!0):!1}function C(b){return new H(function(d,e){var f=new FileReader;f.onerror=e;f.onloadend=function(e){e=btoa(e.target.result||"");d({__local_forage_encoded_blob:!0,data:e,type:b.type})};f.readAsBinaryString(b)})}function D(b){for(var d=atob(b.data),e=d.length,g=new ArrayBuffer(e),h=new Uint8Array(g),l=0;l<e;l++)h[l]=d.charCodeAt(l);return f([g],{type:b.type})}function E(b){var d=this,e=d._initReady().then(function(){var b=
P[d._dbInfo.name];if(b&&b.dbReady)return b.dbReady});h(e,b,b);return e}function F(b){v(b);for(var d=P[b.name].forages,e=0;e<d.length;e++){var f=d[e];f._dbInfo.db&&(f._dbInfo.db.close(),f._dbInfo.db=null)}return w(b,!1).then(function(e){for(var f=0;f<d.length;f++)d[f]._dbInfo.db=e;b.db=e}).then(function(){if(z(b))return w(b,!0)})["catch"](function(d){A(b,d);throw d;})}function G(b,d,e,f){void 0===f&&(f=1);try{var g=b.db.transaction(b.storeName,d);e(null,g)}catch(h){if(0<f&&(!b.db||"InvalidStateError"===
h.name||"NotFoundError"===h.name))return H.resolve().then(function(){if(!b.db||"NotFoundError"===h.name&&!b.db.objectStoreNames.contains(b.storeName)&&b.version<=b.db.version)return b.db&&(b.version=b.db.version+1),w(b,!0)}).then(function(){return F(b).then(function(){G(b,d,e,f-1)})})["catch"](e);e(h)}}function I(b){var d=.75*b.length,e=b.length,f=0,g,h,l,q;"="===b[b.length-1]&&(d--,"="===b[b.length-2]&&d--);for(var w=new ArrayBuffer(d),z=new Uint8Array(w),d=0;d<e;d+=4)g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d]),
h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d+1]),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d+2]),q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[d+3]),z[f++]=g<<2|h>>4,z[f++]=(h&15)<<4|l>>2,z[f++]=(l&3)<<6|q&63;return w}function M(b){b=new Uint8Array(b);var d="",e;for(e=0;e<b.length;e+=3)d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[e]>>2],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(b[e]&
3)<<4|b[e+1]>>4],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(b[e+1]&15)<<2|b[e+2]>>6],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b[e+2]&63];2===b.length%3?d=d.substring(0,d.length-1)+"=":1===b.length%3&&(d=d.substring(0,d.length-2)+"==");return d}function O(b,d,e,f){b.executeSql("CREATE TABLE IF NOT EXISTS "+d.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],e,f)}function K(b,d,e,f,g,h){b.executeSql(e,f,g,function(b,l){l.code===l.SYNTAX_ERR?
b.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[name],function(b,q){q.rows.length?h(b,l):O(b,d,function(){b.executeSql(e,f,g,h)},h)},h):h(b,l)},h)}function Q(b,d,e,f){var h=this;b=l(b);var q=new H(function(g,l){h.ready().then(function(){void 0===d&&(d=null);var q=d,w=h._dbInfo;w.serializer.serialize(d,function(d,z){z?l(z):w.db.transaction(function(e){K(e,w,"INSERT OR REPLACE INTO "+w.storeName+" (key, value) VALUES (?, ?)",[b,d],function(){g(q)},function(b,d){l(d)})},
function(d){d.code===d.QUOTA_ERR&&(0<f?g(Q.apply(h,[b,q,e,f-1])):l(d))})})})["catch"](l)});g(q,e);return q}function U(b){return new H(function(d,e){b.transaction(function(f){f.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(e,f){for(var g=[],h=0;h<f.rows.length;h++)g.push(f.rows.item(h).name);d({db:b,storeNames:g})},function(b,d){e(d)})},function(b){e(b)})})}function X(b,d){var e=b.name+"/";b.storeName!==d.storeName&&(e+=b.storeName+
"/");return e}function N(b,d){b[d]=function(){var e=arguments;return b.ready().then(function(){return b[d].apply(b,e)})}}function V(){for(var b=1;b<arguments.length;b++){var d=arguments[b];if(d)for(var e in d)d.hasOwnProperty(e)&&(ka(d[e])?arguments[0][e]=d[e].slice():arguments[0][e]=d[e])}return arguments[0]}$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var T="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(b){return typeof b}:function(b){$jscomp.initSymbol();
$jscomp.initSymbol();$jscomp.initSymbol();return b&&"function"===typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b},R=function(){if("undefined"!==typeof indexedDB)return indexedDB;if("undefined"!==typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!==typeof mozIndexedDB)return mozIndexedDB;if("undefined"!==typeof OIndexedDB)return OIndexedDB;if("undefined"!==typeof msIndexedDB)return msIndexedDB}();"undefined"===typeof Promise&&b(3);var H=Promise,J,P,L=Object.prototype.toString;
b={_driver:"asyncStorage",_initStorage:function(b){function d(){return H.resolve()}var e=this,f={db:null};if(b)for(var g in b)f[g]=b[g];P||(P={});var h=P[f.name];h||(h={forages:[],db:null,dbReady:null,deferredOperations:[]},P[f.name]=h);h.forages.push(e);e._initReady||(e._initReady=e.ready,e.ready=E);b=[];for(g=0;g<h.forages.length;g++){var l=h.forages[g];l!==e&&b.push(l._initReady()["catch"](d))}var q=h.forages.slice(0);return H.all(b).then(function(){f.db=h.db;return w(f,!1)}).then(function(b){f.db=
b;return z(f,e._defaultConfig.version)?w(f,!0):b}).then(function(b){f.db=h.db=b;e._dbInfo=f;for(b=0;b<q.length;b++){var d=q[b];d!==e&&(d._dbInfo.db=f.db,d._dbInfo.version=f.version)}})},_support:function(){try{if(!R)return!1;var b="undefined"!==typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),d="function"===typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!b||d)&&"undefined"!==
typeof indexedDB&&"undefined"!==typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(b,d){var e=this,f=new H(function(d,f){e.ready().then(function(){G(e._dbInfo,"readonly",function(g,h){if(g)return f(g);try{var l=h.objectStore(e._dbInfo.storeName).openCursor(),q=1;l.onsuccess=function(){var e=l.result;if(e){var f=e.value;f&&f.__local_forage_encoded_blob&&(f=D(f));f=b(f,e.key,q++);if(void 0!==f)d(f);else e["continue"]()}else d()};l.onerror=function(){f(l.error)}}catch(w){f(w)}})})["catch"](f)});
g(f,d);return f},getItem:function(b,d){var e=this;b=l(b);var f=new H(function(d,f){e.ready().then(function(){G(e._dbInfo,"readonly",function(g,h){if(g)return f(g);try{var l=h.objectStore(e._dbInfo.storeName).get(b);l.onsuccess=function(){var b=l.result;void 0===b&&(b=null);b&&b.__local_forage_encoded_blob&&(b=D(b));d(b)};l.onerror=function(){f(l.error)}}catch(q){f(q)}})})["catch"](f)});g(f,d);return f},setItem:function(b,d,e){var f=this;b=l(b);var h=new H(function(e,g){var h;f.ready().then(function(){h=
f._dbInfo;return"[object Blob]"===L.call(d)?t(h.db).then(function(b){return b?d:C(d)}):d}).then(function(d){G(f._dbInfo,"readwrite",function(h,l){if(h)return g(h);try{var q=l.objectStore(f._dbInfo.storeName).put(d,b);null===d&&(d=void 0);l.oncomplete=function(){void 0===d&&(d=null);e(d)};l.onabort=l.onerror=function(){g(q.error?q.error:q.transaction.error)}}catch(w){g(w)}})})["catch"](g)});g(h,e);return h},removeItem:function(b,d){var e=this;b=l(b);var f=new H(function(d,f){e.ready().then(function(){G(e._dbInfo,
"readwrite",function(g,h){if(g)return f(g);try{var l=h.objectStore(e._dbInfo.storeName)["delete"](b);h.oncomplete=function(){d()};h.onerror=function(){f(l.error)};h.onabort=function(){f(l.error?l.error:l.transaction.error)}}catch(q){f(q)}})})["catch"](f)});g(f,d);return f},clear:function(b){var d=this,e=new H(function(b,e){d.ready().then(function(){G(d._dbInfo,"readwrite",function(f,g){if(f)return e(f);try{var h=g.objectStore(d._dbInfo.storeName).clear();g.oncomplete=function(){b()};g.onabort=g.onerror=
function(){e(h.error?h.error:h.transaction.error)}}catch(l){e(l)}})})["catch"](e)});g(e,b);return e},length:function(b){var d=this,e=new H(function(b,e){d.ready().then(function(){G(d._dbInfo,"readonly",function(f,g){if(f)return e(f);try{var h=g.objectStore(d._dbInfo.storeName).count();h.onsuccess=function(){b(h.result)};h.onerror=function(){e(h.error)}}catch(l){e(l)}})})["catch"](e)});g(e,b);return e},key:function(b,d){var e=this,f=new H(function(d,f){if(0>b)d(null);else e.ready().then(function(){G(e._dbInfo,
"readonly",function(g,h){if(g)return f(g);try{var l=!1,q=h.objectStore(e._dbInfo.storeName).openCursor();q.onsuccess=function(){var e=q.result;e?0===b?d(e.key):l?d(e.key):(l=!0,e.advance(b)):d(null)};q.onerror=function(){f(q.error)}}catch(w){f(w)}})})["catch"](f)});g(f,d);return f},keys:function(b){var d=this,e=new H(function(b,e){d.ready().then(function(){G(d._dbInfo,"readonly",function(f,g){if(f)return e(f);try{var h=g.objectStore(d._dbInfo.storeName).openCursor(),l=[];h.onsuccess=function(){var d=
h.result;d?(l.push(d.key),d["continue"]()):b(l)};h.onerror=function(){e(h.error)}}catch(q){e(q)}})})["catch"](e)});g(e,b);return e},dropInstance:function(b,d){d=q.apply(this,arguments);var e=this.config();b="function"!==typeof b&&b||{};b.name||(b.name=b.name||e.name,b.storeName=b.storeName||e.storeName);b.name?(e=b.name===e.name&&this._dbInfo.db?H.resolve(this._dbInfo.db):w(b,!1),e=b.storeName?e.then(function(d){if(d.objectStoreNames.contains(b.storeName)){var e=d.version+1;v(b);var f=P[b.name].forages;
for(d=0;d<f.length;d++){var g=f[d];g._dbInfo.db&&(g._dbInfo.db.close(),g._dbInfo.db=null,g._dbInfo.version=e)}return(new H(function(d,f){var g=R.open(b.name,e);g.onerror=f;g.onupgradeneeded=function(){g.result.deleteObjectStore(b.storeName)};g.onsuccess=function(){d(g.result)}})).then(function(b){for(var d=0;d<f.length;d++){var e=f[d];e._dbInfo.db=b;y(e._dbInfo)}})["catch"](function(d){(A(b,d)||H.resolve())["catch"](function(){});throw d;})}}):e.then(function(){v(b);for(var d=P[b.name].forages,e=
0;e<d.length;e++){var f=d[e];f._dbInfo.db&&(f._dbInfo.db.close(),f._dbInfo.db=null)}return(new H(function(d,e){var f=R.deleteDatabase(b.name);f.onerror=f.onblocked=e;f.onsuccess=d})).then(function(){for(var b=0;b<d.length;b++)y(f._dbInfo)})["catch"](function(d){(A(b,d)||H.resolve())["catch"](function(){});throw d;})})):e=H.reject("Invalid arguments");g(e,d);return e}};var Y=/^~~local_forage_type~([^~]+)~/,aa=Object.prototype.toString,ba={serialize:function(b,d){var e="";b&&(e=aa.call(b));if(b&&("[object ArrayBuffer]"===
e||b.buffer&&"[object ArrayBuffer]"===aa.call(b.buffer))){var f,g="__lfsc__:";b instanceof ArrayBuffer?(f=b,g+="arbf"):(f=b.buffer,"[object Int8Array]"===e?g+="si08":"[object Uint8Array]"===e?g+="ui08":"[object Uint8ClampedArray]"===e?g+="uic8":"[object Int16Array]"===e?g+="si16":"[object Uint16Array]"===e?g+="ur16":"[object Int32Array]"===e?g+="si32":"[object Uint32Array]"===e?g+="ui32":"[object Float32Array]"===e?g+="fl32":"[object Float64Array]"===e?g+="fl64":d(Error("Failed to get type for BinaryArray")));
d(g+M(f))}else if("[object Blob]"===e)e=new FileReader,e.onload=function(){var e="~~local_forage_type~"+b.type+"~"+M(this.result);d("__lfsc__:blob"+e)},e.readAsArrayBuffer(b);else try{d(JSON.stringify(b))}catch(h){console.error("Couldn't convert value into a JSON string: ",b),d(null,h)}},deserialize:function(b){if("__lfsc__:"!==b.substring(0,9))return JSON.parse(b);var d=b.substring(13);b=b.substring(9,13);var e;if("blob"===b&&Y.test(d)){var g=d.match(Y);e=g[1];d=d.substring(g[0].length)}d=I(d);switch(b){case "arbf":return d;
case "blob":return f([d],{type:e});case "si08":return new Int8Array(d);case "ui08":return new Uint8Array(d);case "uic8":return new Uint8ClampedArray(d);case "si16":return new Int16Array(d);case "ur16":return new Uint16Array(d);case "si32":return new Int32Array(d);case "ui32":return new Uint32Array(d);case "fl32":return new Float32Array(d);case "fl64":return new Float64Array(d);default:throw Error("Unkown type: "+b);}},stringToBuffer:I,bufferToString:M};e={_driver:"webSQLStorage",_initStorage:function(b){var d=
this,e={db:null};if(b)for(var f in b)e[f]="string"!==typeof b[f]?b[f].toString():b[f];b=new H(function(b,f){try{e.db=openDatabase(e.name,String(e.version),e.description,e.size)}catch(g){return f(g)}e.db.transaction(function(g){O(g,e,function(){d._dbInfo=e;b()},function(b,d){f(d)})},f)});e.serializer=ba;return b},_support:"function"===typeof openDatabase,iterate:function(b,d){var e=this,f=new H(function(d,f){e.ready().then(function(){var g=e._dbInfo;g.db.transaction(function(e){K(e,g,"SELECT * FROM "+
g.storeName,[],function(e,f){for(var h=f.rows,l=h.length,q=0;q<l;q++){var w=h.item(q),z=w.value;z&&(z=g.serializer.deserialize(z));z=b(z,w.key,q+1);if(void 0!==z){d(z);return}}d()},function(b,d){f(d)})})})["catch"](f)});g(f,d);return f},getItem:function(b,d){var e=this;b=l(b);var f=new H(function(d,f){e.ready().then(function(){var g=e._dbInfo;g.db.transaction(function(e){K(e,g,"SELECT * FROM "+g.storeName+" WHERE key = ? LIMIT 1",[b],function(b,e){var f=e.rows.length?e.rows.item(0).value:null;f&&
(f=g.serializer.deserialize(f));d(f)},function(b,d){f(d)})})})["catch"](f)});g(f,d);return f},setItem:function(b,d,e){return Q.apply(this,[b,d,e,1])},removeItem:function(b,d){var e=this;b=l(b);var f=new H(function(d,f){e.ready().then(function(){var g=e._dbInfo;g.db.transaction(function(e){K(e,g,"DELETE FROM "+g.storeName+" WHERE key = ?",[b],function(){d()},function(b,d){f(d)})})})["catch"](f)});g(f,d);return f},clear:function(b){var d=this,e=new H(function(b,e){d.ready().then(function(){var f=d._dbInfo;
f.db.transaction(function(d){K(d,f,"DELETE FROM "+f.storeName,[],function(){b()},function(b,d){e(d)})})})["catch"](e)});g(e,b);return e},length:function(b){var d=this,e=new H(function(b,e){d.ready().then(function(){var f=d._dbInfo;f.db.transaction(function(d){K(d,f,"SELECT COUNT(key) as c FROM "+f.storeName,[],function(d,e){var f=e.rows.item(0).c;b(f)},function(b,d){e(d)})})})["catch"](e)});g(e,b);return e},key:function(b,d){var e=this,f=new H(function(d,f){e.ready().then(function(){var g=e._dbInfo;
g.db.transaction(function(e){K(e,g,"SELECT key FROM "+g.storeName+" WHERE id = ? LIMIT 1",[b+1],function(b,e){var f=e.rows.length?e.rows.item(0).key:null;d(f)},function(b,d){f(d)})})})["catch"](f)});g(f,d);return f},keys:function(b){var d=this,e=new H(function(b,e){d.ready().then(function(){var f=d._dbInfo;f.db.transaction(function(d){K(d,f,"SELECT key FROM "+f.storeName,[],function(d,e){for(var f=[],g=0;g<e.rows.length;g++)f.push(e.rows.item(g).key);b(f)},function(b,d){e(d)})})})["catch"](e)});g(e,
b);return e},dropInstance:function(b,d){d=q.apply(this,arguments);var e=this.config();b="function"!==typeof b&&b||{};b.name||(b.name=b.name||e.name,b.storeName=b.storeName||e.storeName);var f=this,h;h=b.name?(new H(function(d){var g;g=b.name===e.name?f._dbInfo.db:openDatabase(b.name,"","",0);b.storeName?d({db:g,storeNames:[b.storeName]}):d(U(g))})).then(function(b){return new H(function(d,e){b.db.transaction(function(f){function g(b){return new H(function(d,e){f.executeSql("DROP TABLE IF EXISTS "+
b,[],function(){d()},function(b,d){e(d)})})}for(var h=[],l=0,q=b.storeNames.length;l<q;l++)h.push(g(b.storeNames[l]));H.all(h).then(function(){d()})["catch"](function(b){e(b)})},function(b){e(b)})})}):H.reject("Invalid arguments");g(h,d);return h}};var ca;try{ca="undefined"!==typeof localStorage&&"setItem"in localStorage&&"function"===typeof localStorage.setItem}catch(W){ca=!1}var ka=Array.isArray||function(b){return"[object Array]"===Object.prototype.toString.call(b)},fa={},ha={},B={INDEXEDDB:b,
WEBSQL:e,LOCALSTORAGE:{_driver:"localStorageWrapper",_initStorage:function(b){var d={};if(b)for(var e in b)d[e]=b[e];d.keyPrefix=X(b,this._defaultConfig);var f;try{localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),f=!1}catch(g){f=!0}if(f&&!(0<localStorage.length))return H.reject();this._dbInfo=d;d.serializer=ba;return H.resolve()},_support:ca,iterate:function(b,d){var e=this,f=e.ready().then(function(){for(var d=e._dbInfo,f=d.keyPrefix,g=f.length,
h=localStorage.length,l=1,q=0;q<h;q++){var w=localStorage.key(q);if(0===w.indexOf(f)){var z=localStorage.getItem(w);z&&(z=d.serializer.deserialize(z));z=b(z,w.substring(g),l++);if(void 0!==z)return z}}});g(f,d);return f},getItem:function(b,d){var e=this;b=l(b);var f=e.ready().then(function(){var d=e._dbInfo,f=localStorage.getItem(d.keyPrefix+b);f&&(f=d.serializer.deserialize(f));return f});g(f,d);return f},setItem:function(b,d,e){var f=this;b=l(b);var h=f.ready().then(function(){void 0===d&&(d=null);
var e=d;return new H(function(g,h){var l=f._dbInfo;l.serializer.serialize(d,function(d,f){if(f)h(f);else try{localStorage.setItem(l.keyPrefix+b,d),g(e)}catch(q){"QuotaExceededError"!==q.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==q.name||h(q),h(q)}})})});g(h,e);return h},removeItem:function(b,d){var e=this;b=l(b);var f=e.ready().then(function(){localStorage.removeItem(e._dbInfo.keyPrefix+b)});g(f,d);return f},clear:function(b){var d=this,e=d.ready().then(function(){for(var b=d._dbInfo.keyPrefix,e=localStorage.length-
1;0<=e;e--){var f=localStorage.key(e);0===f.indexOf(b)&&localStorage.removeItem(f)}});g(e,b);return e},length:function(b){var d=this.keys().then(function(b){return b.length});g(d,b);return d},key:function(b,d){var e=this,f=e.ready().then(function(){var d=e._dbInfo,f;try{f=localStorage.key(b)}catch(g){f=null}f&&(f=f.substring(d.keyPrefix.length));return f});g(f,d);return f},keys:function(b){var d=this,e=d.ready().then(function(){for(var b=d._dbInfo,e=localStorage.length,f=[],g=0;g<e;g++){var h=localStorage.key(g);
0===h.indexOf(b.keyPrefix)&&f.push(h.substring(b.keyPrefix.length))}return f});g(e,b);return e},dropInstance:function(b,d){d=q.apply(this,arguments);b="function"!==typeof b&&b||{};if(!b.name){var e=this.config();b.name=b.name||e.name;b.storeName=b.storeName||e.storeName}var f=this,e=b.name?(new H(function(d){b.storeName?d(X(b,f._defaultConfig)):d(b.name+"/")})).then(function(b){for(var d=localStorage.length-1;0<=d;d--){var e=localStorage.key(d);0===e.indexOf(b)&&localStorage.removeItem(e)}}):H.reject("Invalid arguments");
g(e,d);return e}}};ca=[B.INDEXEDDB._driver,B.WEBSQL._driver,B.LOCALSTORAGE._driver];var da=["dropInstance"],S="clear getItem iterate key keys length removeItem setItem".split(" ").concat(da),ja={description:"",driver:ca.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};ca=new (function(){function b(d){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");for(var e in B)if(B.hasOwnProperty(e)){var f=B[e],g=f._driver;this[e]=g;fa[g]||this.defineDriver(f)}this._defaultConfig=
V({},ja);this._config=V({},this._defaultConfig,d);this._initDriver=this._driverSet=null;this._ready=!1;this._dbInfo=null;this._wrapLibraryMethodsWithReady();this.setDriver(this._config.driver)["catch"](function(){})}b.prototype.config=function(b){if("object"===("undefined"===typeof b?"undefined":T(b))){if(this._ready)return Error("Can't call config() after localforage has been used.");for(var d in b){"storeName"===d&&(b[d]=b[d].replace(/\W/g,"_"));if("version"===d&&"number"!==typeof b[d])return Error("Database version must be a number.");
this._config[d]=b[d]}return"driver"in b&&b.driver?this.setDriver(this._config.driver):!0}return"string"===typeof b?this._config[b]:this._config};b.prototype.defineDriver=function(b,d,e){var f=new H(function(d,e){try{var f=b._driver,h=Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(b._driver){for(var l=S.concat("_initStorage"),q=0,w=l.length;q<w;q++){var z=l[q];if((0>da.indexOf(z)||b[z])&&"function"!==typeof b[z]){e(h);return}}(function(){for(var d=
function(b){return function(){var d=H.reject(Error("Method "+b+" is not implemented by the current driver"));g(d,arguments[arguments.length-1]);return d}},e=0,f=da.length;e<f;e++){var h=da[e];b[h]||(b[h]=d(h))}})();h=function(e){fa[f]&&console.info("Redefining LocalForage driver: "+f);fa[f]=b;ha[f]=e;d()};"_support"in b?b._support&&"function"===typeof b._support?b._support().then(h,e):h(!!b._support):h(!0)}else e(h)}catch(r){e(r)}});h(f,d,e);return f};b.prototype.driver=function(){return this._driver||
null};b.prototype.getDriver=function(b,d,e){b=fa[b]?H.resolve(fa[b]):H.reject(Error("Driver not found."));h(b,d,e);return b};b.prototype.getSerializer=function(b){var d=H.resolve(ba);h(d,b);return d};b.prototype.ready=function(b){var d=this,e=d._driverSet.then(function(){null===d._ready&&(d._ready=d._initDriver());return d._ready});h(e,b,b);return e};b.prototype.setDriver=function(b,d,e){function f(){q._config.driver=q.driver()}function g(b){q._extend(b);f();q._ready=q._initStorage(q._config);return q._ready}
function l(b){return function(){function d(){for(;e<b.length;){var h=b[e];e++;q._dbInfo=null;q._ready=null;return q.getDriver(h).then(g)["catch"](d)}f();q._driverSet=H.reject(Error("No available storage method found."));return q._driverSet}var e=0;return d()}}var q=this;ka(b)||(b=[b]);var w=this._getSupportedDrivers(b);this._driverSet=(null!==this._driverSet?this._driverSet["catch"](function(){return H.resolve()}):H.resolve()).then(function(){var b=w[0];q._dbInfo=null;q._ready=null;return q.getDriver(b).then(function(b){q._driver=
b._driver;f();q._wrapLibraryMethodsWithReady();q._initDriver=l(w)})})["catch"](function(){f();q._driverSet=H.reject(Error("No available storage method found."));return q._driverSet});h(this._driverSet,d,e);return this._driverSet};b.prototype.supports=function(b){return!!ha[b]};b.prototype._extend=function(b){V(this,b)};b.prototype._getSupportedDrivers=function(b){for(var d=[],e=0,f=b.length;e<f;e++){var g=b[e];this.supports(g)&&d.push(g)}return d};b.prototype._wrapLibraryMethodsWithReady=function(){for(var b=
0,d=S.length;b<d;b++)N(this,S[b])};b.prototype.createInstance=function(d){return new b(d)};return b}());d.exports=ca},{3:3}]},{},[4])(4)});"use strict";function CBDebug(){}CBDebug.assert=function(c,b){if(!c)if(b||(b="ASSERT FAILURE"),"undefined"!==typeof console&&console.assert)console.assert(c,b),alert(b),CB.LOG(b);else throw b;};CBDebug.call=function(c,b){for(var d=arguments,e=[],f=2;f<d.length;++f)e.push(d[f]);b.apply(c,e)};
CBDebug.profile=function(c){"undefined"!==typeof console&&console.profile&&console.profile(c)};CBDebug.profileEnd=function(){"undefined"!==typeof console&&console.profileEnd&&console.profileEnd()};function ASSERT(c){CBDebug.assert(c,c)}"use strict";
var CB={namespace:function(c){c=c.split(".");var b=CB;"CB"===c[0]&&(c=c.slice(1));for(var d=0;d<c.length;d+=1)"undefined"===typeof b[c[d]]&&(b[c[d]]={}),b=b[c[d]]},inherit:function(c,b){var d=c.prototype;c.prototype=new b;for(var e in d)d.hasOwnProperty(e)&&(c.prototype[e]=d[e]);c.superClass=b;c.prototype.superClass=b.prototype;return c},mixin:function(c,b){for(var d in b)b.hasOwnProperty(d)&&(c.prototype[d]=b[d])},mixObject:function(c,b){for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d])},partial:function(c,
b){return ObjUtil.copyTo(b,c,!0)},protect:function(c,b){Object.defineProperty(c,b,{writable:!1})},property:function(c,b,d,e){Object.defineProperty(c,b,{get:d,set:e})},classProperty:function(c,b,d,e){Object.defineProperty(c.prototype,b,{get:d,set:e})},StringTools:{trimChar:function(c,b){c.charAt(0)==b&&(c=c.slice(1,c.length-1));2<c.length&&c.charAt(c.length-1)==b&&(c=c.slice(0,c.length-1));return c}}};function Char(){}Char.IsDigit=function(c){return"9">=c&&"0"<=c};
Char.IsLetter=function(c){return"z">=c&&"a"<=c||"Z">=c&&"A"<=c};Char.IsUpperCaseLetter=function(c){return"Z">=c&&"A"<=c};Char.IsLetterOrDigit=function(c){return Char.IsLetter(c)||Char.IsDigit(c)};Char.IsWhiteSpace=function(c){return"\r"===c||"\n"===c||" "===c||"\t"===c};Char.getIsChar=function(c){return function(b){return b===c}};Char.getIsNotChar=function(c){return function(b){return b!==c}};function StringIterator(c){this.m_str=c;this.m_len=c.length}StringIterator.prototype.m_str=null;
StringIterator.prototype.m_inx=-1;StringIterator.g_hasIndex=function(){return!0}();
StringIterator.g_hasIndex?(StringIterator.prototype.Current=function(){return this.m_str[this.m_inx]},StringIterator.prototype.Peek=function(){return this.m_inx>=this.m_len-1?0:this.m_str[this.m_inx+1]},StringIterator.prototype.Next=function(){++this.m_inx;return this.m_inx===this.m_len?0:this.m_str[this.m_inx]}):(StringIterator.prototype.Current=function(){return this.m_str.charAt(this.m_inx)},StringIterator.prototype.Peek=function(){return this.m_inx>=this.m_len-1?0:this.m_str.charAt(this.m_inx+
1)},StringIterator.prototype.Next=function(){++this.m_inx;return this.m_inx===this.m_len?0:this.m_str.charAt(this.m_inx)});StringIterator.prototype.CurrentString=function(c){return this.SubString(this.m_inx,c)};StringIterator.prototype.NextString=function(c){return this.SubString(this.m_inx+1,c)};StringIterator.prototype.SubString=function(c,b){var d=this.m_len-c;if(!b||b>d)b=d;return this.m_str.substring(c,c+b)};StringIterator.prototype.getPosition=function(){return this.m_inx};
StringIterator.prototype.setPosition=function(c){this.m_inx=c};StringIterator.prototype.skip=function(c){this.m_inx+=c};StringIterator.prototype.isEOF=function(){return this.m_inx===this.m_len};StringIterator.prototype.AcceptWhile=function(c,b){var d="";if(b){var e=this.Current();if(!c(e))return d;d=e}for(e=this.Next();0!==e&&c(e);e=this.Next())d+=e;return d};StringIterator.prototype.AcceptUntil=function(c,b){return this.AcceptWhile(NOT(c),b)};
StringIterator.prototype.AcceptStr=function(c,b){var d=c.length;return(b?this.CurrentString(d):this.NextString(d))===c?(b||++d,this.skip(d),!0):!1};StringIterator.prototype.AcceptChar=function(c,b){if(b){if(this.Current()===c)return this.skip(1),!0}else if(this.Peek()===c)return this.skip(2),!0;return!1};StringIterator.prototype.skipWhile=function(c,b){if(!b||c(this.Current()))for(var d=this.Next();0!==d&&c(d);d=this.Next());};StringIterator.prototype.skipUntil=function(c){return this.skipWhite(NOT(c))};
String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")});String.quote||(String.prototype.quote=function(){return'"'+this.replace(/\\/g,"\\\\").replace(RegExp('"',"g"),'\\"')+'"'});String.startsWith||(String.prototype.startsWith=function(c){return this.indexOf?0===this.indexOf(c):!1});String.capitalize||(String.capitalize=function(){return this.length?this[0].toUpperCase()+this.substring(1,this.length).toLowerCase():this});"use strict";
function StringBuilder(){var c=null,b=null,d=0,e="";this.appendFormat=function(){var b=String.formatEx.apply("",arguments);this.append(b)};this.append=function(f){e+=f;2800<e.length&&(null===c?c=b=[]:(f=b,b=[],f[1]=b),b[0]=e,e="",++d)};this.toString=function(){if(0==d)return e;for(;1<d;){for(var f=c,g=[],h=g,l=0;"undefined"!=typeof f;)"undefined"==typeof h[0]?(h[0]=f[0],++l):("undefined"!=typeof f[0]&&(h[0]+=f[0]),h[1]=[],h=h[1]),f=f[1];c=g;b=h;d=l}return c[0]+e}}
(function(){function c(b){try{for(var c="",g=d.lastIndex=0;;){var h=d.exec(b);if(!h)break;var l=h.index;if(l>g){var q=b.substring(g,l).quote();c&&(c+="+");c+=q}var r=h[1],t=parseInt(r),v;v="nz(";v=isNaN(t)?v+("(_a."+r+")"):v+("(_a["+(t+1)+"])");v+=")";c&&(c+="+");c+=v;g=d.lastIndex}if(b.length>g){var y=b.substring(g).quote();c&&(c+="+");c+=y}var A="var nz = function(_v){if(_v === undefined || _v === null)return ''; return _v.toString()};return "+c+";"}catch(w){CB.LogException("_prepFormat",w)}return new Function("_a",
A)}var b={},d=/{(\w+(\.\w+)*(\[\d+\])?)}/g;String.formatEx||(String.formatEx=function(d){try{var f=b[d];f||(f=c(d),b[d]=f);var g=arguments;2===arguments.length&&"object"===typeof arguments[1]&&0>d.indexOf("{0}")&&(g=arguments[1])}catch(h){CB.LogException("formatEx",h)}return f(g)});String.f=String.formatEx;String.vformatEx||(String.vformatEx=function(b,d){return c(b)(d)})})();
CB.Levenshtein={getDistance:function(c,b,d,e,f){d=d||1;e=e||1;f=f||1;if(0===c.length)return b.length;if(0===b.length)return c.length;var g=[],h;for(h=0;h<=b.length;h++)g[h]=[h];var l;for(l=0;l<=c.length;l++)g[0][l]=l;for(h=1;h<=b.length;h++)for(l=1;l<=c.length;l++)b.charAt(h-1)==c.charAt(l-1)?g[h][l]=g[h-1][l-1]:g[h][l]=Math.min(g[h-1][l-1]+d,Math.min(g[h][l-1]+e,g[h-1][l]+f));return g[b.length][c.length]}};"use strict";
CB.Form=function(){var c=function(b){this.config=b;this.inpH=26;this.buttonW=90;this.buttonH=30;this.theme="chessbase"};c.prototype.show=function(){$(this.nestDiv).css("display","block")};c.prototype.hide=function(){$(this.nestDiv).css("display","none")};c.prototype.isVisible=function(){return!$(this.nestDiv).is(":hidden")};c.prototype.create=function(b,d){$("#"+this.config.id).remove();this.nestDiv=$(String.f("<div id='{0}'></div>",this.config.id));this._createHtml(this.nestDiv);$(b).append(this.nestDiv);
$(this.nestDiv).jqxWindow({width:this.config.width||400,height:this.config.height||400,isModal:this.config.modal,theme:this.theme,resizable:!1,autoOpen:!1,showCloseButton:!1});$(this.nestDiv).jqxWindow({initContent:function(){$("#btnCancel").jqxButton({width:this.buttonW,height:this.buttonH,theme:this.theme});$("#btnOk").jqxButton({width:this.buttonW,height:this.buttonH,theme:this.theme});this.config.focusField&&$("#"+this.config.focusField).jqxInput("focus");$(this.nestDiv).keyup(function(b){13==
b.keyCode&&$("#btnOk").click()})}.bind(this)});$(this.nestDiv).jqxWindow("cancelButton",$("#btnCancel"));$(this.nestDiv).jqxWindow("open");this.validator&&this.validator(this.nestDiv);$("#btnOk").click(function(b){b=!0;this.validator&&(b=$(this.nestDiv).jqxValidator("validate"));b&&(b=this._extractResults(),$(this.nestDiv).jqxWindow("hide"),$(this.nestDiv).remove(),this.config.okHandler&&this.config.okHandler(b))}.bind(this));$("#btnCancel").click(function(b){$(this.nestDiv).jqxWindow("hide");$(this.nestDiv).remove();
this.config.cancelHandler&&this.config.cancelHandler()}.bind(this));this.config.accountButton&&($("#btnAccount").jqxButton({width:this.buttonW,height:this.buttonH,theme:this.theme}),$("#btnAccount").on("click",function(b){V15.panelMgr.openRegisterPage()}));this.config.pasteButton&&($("#btnPaste").jqxButton({width:this.buttonW,height:this.buttonH,theme:this.theme}),$("#btnPaste").on("click",function(b){CB.System.isElectron()&&"undefined"!==typeof electronBridge&&(b=electronBridge.readFromClipboard().trim(),
34<=b.length&&($("#idSerial0").val(b.substr(0,5)),$("#idSerial1").val(b.substr(6,5)),$("#idSerial2").val(b.substr(12,5)),$("#idSerial3").val(b.substr(18,5)),$("#idSerial4").val(b.substr(24,5)),$("#idSerial5").val(b.substr(30))))}))};c.prototype.closeDialog=function(){$(this.nestDiv).jqxWindow("hide");$(this.nestDiv).remove()};c.prototype._extractResults=function(){var b={};this.config.fields.forEach(function(d){switch(d.type){case "number":case "password":case "string":case "stringmultiline":b[d.id]=
$("#"+d.id).val();break;case "serial":for(var e="",c=0;6>c;c++)e+=$("#"+d.id+c).val();b[d.id]=e;break;case "checkbox":b[d.id]=$("#"+d.id).jqxCheckBox("checked")}}.bind(this));return b};c.prototype._getButtonConfig=function(){return{imgHeight:32,imgWidth:32,theme:"chessbase"}};c.prototype._createHtml=function(b){var d=$("<div>"+this.config.title+"</div>");b.append(d);var d=$(String.f("<div></div>")),e=$("<table class='cbJqxFormTable'></table>");d.append(e);this.config.fields.forEach(function(b){var d=
$("<tr></tr>");switch(b.type){case "separator":d.append($("<td colspan='2'><div class='cbJqxFormSeparator'/></td>"));break;case "progress":var c=$(String.f("<td align='right' class='cbJqxFormCaption'>{0}</td>",b.caption));d.append(c);var c=$("<td align='left'></td>"),f=$(String.f("<div id='{0}'></div>",b.id));c.append(f);f.jqxProgressBar({width:300,height:this.config.checkBoxH||this.inpH,value:0});d.append(c);f.jqxProgressBar("animationDuration",0);f.jqxProgressBar("theme","shinyblack");f.jqxProgressBar("value",
0);f.jqxProgressBar("colorRanges",[{stop:0,color:"#A00000"},{stop:100,color:"#00FF00"}]);this.progressBar=f;break;case "number":c=$(String.f("<td align='right' class='cbJqxFormCaption'>{0}</td>",b.caption));d.append(c);c=$("<td align='left'></td>");f=$(String.f("<input id='{0}'/>",b.id));c.append(f);f.jqxNumberInput({width:this.config.numInpW||60,height:this.config.inpH||this.inpH,min:b.min||0,max:b.max||999999999,theme:this.theme,decimalDigits:0,digits:2,inputMode:"simple",spinButtons:b.spin});b.val&&
f.jqxNumberInput("val",b.val);d.append(c);break;case "string":c=$(String.f("<td align='right'>{0}</td>",b.caption));d.append(c);c=$("<td align='left'></td>");f=$(String.f("<input id='{0}'/>",b.id));c.append(f);f.jqxInput({width:this.config.strInpW||200,height:this.config.inpH||this.inpH,maxLength:this.config.maxLength||128,theme:this.theme});b.val&&f.jqxInput("val",b.val);d.append(c);break;case "serial":c=$(String.f("<td align='right'>{0}</td>",b.caption));d.append(c);for(var c=$("<td align='left'></td>"),
g=0;6>g;g++){var f=$(String.f("<input id='{0}' style='text-transform: uppercase;' />",b.id+g)),v=5;5===g&&(v=4);c.append(f);f.jqxInput({width:80,height:this.config.inpH||this.inpH,minLength:v,maxLength:5,theme:this.theme});b.val&&34<=b.val.length&&(5>g?f.jqxInput("val",b.val.substr(6*g,5)):f.jqxInput("val",b.val.substr(6*g)));5!=g&&c.append("-")}d.append(c);break;case "stringmultiline":c=$(String.f("<td align='right'>{0}</td>",b.caption));d.append(c);c=$("<td align='center'></td>");f=$(String.f("<textarea id='{0}' rows='{1}' cols='{2}' maxlength='{3}'/>",
b.id,b.rows,b.cols,b.maxLength));$(f).addClass("jqx-input jqx-widget jqx-widget-content");this.theme&&$(f).addClass(String.f("jqx-input-{0} jqx-widget-{0} jqx-widget-content-{0}",this.theme));c.append(f);b.val&&f.jqxInput("val",b.val);d.append(c);break;case "password":c=$(String.f("<td align='right'>{0}</td>",b.caption));d.append(c);c=$("<td align='left'></td>");f=$(String.f("<input id='{0}' type='password' />",b.id));c.append(f);f.jqxPasswordInput({width:this.config.strInpW||200,height:this.config.inpH||
this.inpH,maxLength:128,theme:this.theme,placeHolder:"Enter password"});d.append(c);break;case "checkbox":c=$(String.f("<td align='right' class='cbJqxFormCaption'>{0}</td>",b.caption)),d.append(c),c=$("<td align='left'></td>"),f=$(String.f("<div id='{0}'></div>",b.id)),c.append(f),f.jqxCheckBox({width:this.config.checkBoxW||120,height:this.config.checkBoxH||this.inpH,theme:this.theme,checked:b.checked}),d.append(c)}e.append(d)}.bind(this));var c=$("<tr></tr>");e.append($("<tr><td></td></tr>"));c.append($("<td align='right'></td>"));
if(this.config.pasteButton){var g=$("<tr></tr>");g.append($("<td colspan='2' align='left' style='padding-top: 16px'><input type='button' id='btnPaste' value='Paste' /></td>"));e.append(g)}this.progressBar||c.append($(String.f('<td style="padding-top: 10px;" align="right"><input style="margin-right: 5px;" type="button" id="btnOk" value="OK" /><input id="btnCancel" type="button" value="{0}" /></td>',lm.CANCEL)));e.append(c);this.config.accountButton&&(e.append($("<tr><td></td></tr>")),c=$("<tr></tr>"),
c.append($("<td colspan='2' align='left' style='padding-top: 16px'><input type='button' id='btnAccount' value='Register' /></td>")),e.append(c));b.append(d)};c.prototype._getImgSrc=function(b){var d=V15.config.getRibbonPath();this.config.iconPath&&(d+=this.config.iconPath+"/");d=d+b+(this.config.iconHeight||32);return d+".png"};c.inputString=function(b,d,e,c,g,h){(new CB.Form({id:"inputString",title:b,width:300,height:180,modal:!0,okHandler:g,cancelHandler:h,fields:[{caption:d,type:"string",id:"idInput",
strInpW:160,maxLength:c,val:e}]})).create()};return c}();CB.LOG=function(){return function(c){}}();"use strict";CB.namespace("CB.Localization");var glLoc,lm;
CB.Localization=function(){return function(c){this.locObjects=[].concat(c);lm=this.locObjects[0];for(c=1;c<this.locObjects.length;c++){var b=this.locObjects[c],d;for(d in b)b.hasOwnProperty(d)&&(lm[d]=b[d])}d=ObjUtil.clone(CB.V1);d.arrStrPieces[CB.Piece.W_KING]=d.arrStrPieces[CB.Piece.B_KING]=lm.NOTATION_KING;d.arrStrPieces[CB.Piece.W_QUEEN]=d.arrStrPieces[CB.Piece.B_QUEEN]=lm.NOTATION_QUEEN;d.arrStrPieces[CB.Piece.W_ROOK]=d.arrStrPieces[CB.Piece.B_ROOK]=lm.NOTATION_ROOK;d.arrStrPieces[CB.Piece.W_BISHOP]=
d.arrStrPieces[CB.Piece.B_BISHOP]=lm.NOTATION_BISHOP;d.arrStrPieces[CB.Piece.W_KNIGHT]=d.arrStrPieces[CB.Piece.B_KNIGHT]=lm.NOTATION_KNIGHT;d.arrStrPieces[CB.Piece.W_PAWN]=d.arrStrPieces[CB.Piece.B_PAWN]="";lm.NOTA_LOCALIZATION=d}}();"use strict";CB.namespace("CB.Loc.Chess.ENG");
CB.Loc.Chess.ENG={LOGIN:"Log in",LOGOUT:"Log out",ACCOUNT:"My Account",BOARDS:"Boards",RECONNECT:"Reconnect",RESIGN:"Resign",CLOSE_BOARD:"Close Board",OFFER_DRAW:"Offer Draw",ACCEPT_DRAW:"Accept Draw",ACCEPTED_DRAW:"{0} accepted a draw.",OFFERS_DRAW:"{0} offers a draw.",ACCEPTS_DRAW:"{0} accepts a draw.",RESIGNS:"{0} resigns.",TESTING_CONN:"Testing Connection to Server",CONNECTING:"Connecting to server, please wait...",RECONNECTED_OK:"Reconnected OK",NAME:"Name",NATION:"Country",RANK:"Rank",WHITE:"White",
BLACK:"Black",ELO_WHITE:"Elo White",ELO_BLACK:"Elo Black",RESULT:"Result",TIME_CONTROL:"Time Control",TOURNAMENT:"Tournament",GAMES:"Games",CHAT:"Chat",CHAT_PARTNER_GONE:"Your chat partner is gone.",CONNECTION:"Connection",MAP:"Map",KING:"King",QUEEN:"Queen",ROOK:"Rook",BISHOP:"Bishop",KNIGHT:"Knight",PAWN:"Pawn",TYPE_CHAT_HERE:"Type Chat Here",TYPE_HERE_TO_CHAT_WITH:"Type Here To Chat With",GUEST:"Guest",CONFIRM:"Confirm",CANCEL:"Cancel",CLOCK:"Clock",TIME:"Time",GAIN_PER_MOVE:"Gain per Move",CLOSE:"Close",
ADD:"Add",REMOVE:"Remove",NOTATION:"Notation",BOARD_FRITZ:"Fritz",BOARD_CRYSTALS:"Crystals",BOARD_USCF:"USCF",BOARD_OLDSTYLE:"OldStyle",BOARD_HABSBURG:"Habsburg",BOARD_FRITZ_AND_CHESTER:"Fritz & Chesster",PLAY_BLITZ:"Play Blitz",NEW_GAME:"New Game",TAKE_BACK:"Take Back",MAKE_MOVE:"Make Move",FLIP_BOARD:"Flip Board",COPY:"Copy",SEARCH_BOARD:"Search Board",YEAR:"Year",BOOK:"Book",LIVE_BOOK:"Live Book",MOVE:"Move",NR_GAMES:"Nr Games",SCORE:"Score",LAST_PLAYED:"Last Played",ELO_AVG:"Elo Avg.",VISITS:"Visits",
LOADING_STATISTICS:"Loading statistics",LETS_CHECK:"Let's Check",EVAL:"Eval",VARIATION:"Variation",DEPTH:"Depth",ENGINE:"Engine",ENTER_YOUR_SEARCH_TEXT:"Enter your search text...",RETRIEVING_GAMES:"Retrieving games",PLAYER_DETAILS:"Player details",PLAYER_INFORMATION:"Player information",FIRST_NAME:"First Name",LAST_NAME:"Last Name",YEAR_OF_BIRTH:"Year of Birth",TREND:"Trend",RATING:"Rating",SEND_FEEDBACK:"Send Feedback",YOUR_COMMENT:"Your Comment",YOUR_EMAIL_ADDRESS:"Your E-mail Address",SEND:"Send",
BROWSER_DOESNT_SUPPORT_3D:"Browser does not support 3d boards",BOARD3D_FRITZ:"Fritz",BOARD3D_MODERN:"Modern",BOARD3D_ROOM:"Room",BOARD3D_BALLOON:"Balloon",BOARD3D_METAL:"Metal",BOARD3D_SILVER:"Silver",BOARD3D_FUTURE:"Future",BOARD3D_MARBLE:"Marble",WELCOME:"Welcome",MATERIAL:"Material",ANALYSIS:"Analysis",ANALYSIS_ENGINE:"Engine",ENG_SEARCH_INFO_FMT:"Depth {0}/{1}, Speed = {2}kPos/s, Time = {3}s",PASTE:"Paste",PW_INVALID:"<bold>User/Password invalid, please try again</bold>",PLEASE_LOGIN:"Please log in with your ChessBase (Playchess) account:",
ACCOUNTNAME:"Name",PASSWORD:"Password",CREATE_ACCOUNT:"Create Account",LOGIN_GUEST:"Guest",PLEASE_LOGIN_SHORT:"Please Log In",LOADING_ENGINE:"Loading Engine...",LOADING_LIVE_GAMES:"Loading Live Games ...",INVITING_OTHER_PLAYERS:"Inviting other players to a game of {0} ({1})",OTHER_TOOLS:"More Apps",DATABASES:"Databases",OPEN_DATABASE:"Open Database",CREATE_DATABASE:"Create Database",DELETE_DATABASE:"Delete Database",DELETE:"Delete",CLEAN_UP:"Clean Up",MY_DATABASES:"My Databases",DATABASES_SHARED_WITH_ME:"Databases shared with me",
SELECT_DATABASE_FOR_USER:"Select Database For '{0}'",OPEN_PGN:"Open PGN",SAVE:"Save",SAVE_AND_REPLACE_GAMES:"Save and replace games",SAVE_AS_NEW:"Save As New",EDIT_GAME:"Edit Game",DATABASE_FUNCTIONS:"Open, create and delete databases",TEXT_BEFORE:"Text Before",TEXT_AFTER:"Text",START_LINE:"Start Line",PROMOTE_LINE:"Promote Line",DELETE_LINE:"Delete Line",CUT_LINE:"Cut Line",OPEN_PGN_TIP:"Open a PGN file from your computer",TEXT_BEFORE_TIP:"Add a text annotation before this move",TEXT_AFTER_TIP:"Add a text annotation after this move",
START_LINE_TIP:"Retract current move and start a line",PROMOTE_LINE_TIP:"Promote the currently selected line",DELETE_LINE_TIP:"Delete the selected line",CUT_LINE_TIP:"Cut off the following moves",STAY_LOGGED_IN:"Stay Logged In",FORGOT_PASSWORD:"Forgot Password",CHANGE_PASSWORD:"Change Password",OLD_PASSWORD:"Old Password",NEW_PASSWORD:"New Password",CONFIRM_PASSWORD:"Confirm Password",MENU_PLAYCHESS_TOOL:"Play & Watch",MENU_DATABASE_TOOL:"Live Database",MENU_MYGAMES_TOOL:"My Own Games",MENU_FRITZ_TOOL:"Chess Program Fritz",
MENU_FRITZ_CHESSTER_TOOL:"Chess For Kids",MENU_TACTICS_TOOL:"Tactics Training",LANGUAGE:"Language",LOGIN_CREATE_LINK:"Click here to create an account",LOGIN_PLEASE_LOGIN:"Please Log In",LOGIN_ACCOUNT_FREE:"Creating an account is free. The account is valid for all other ChessBase Web Tools and for play.chessbase.com.",LOGIN_WELCOME:"Welcome, {0}",MANAGE_FRIENDS:"Manage friends",INVITE_FRIEND:"Invite a friend",PING:"Ping",NOTATION_KING:"K",NOTATION_QUEEN:"Q",NOTATION_KNIGHT:"N",NOTATION_BISHOP:"B",
NOTATION_ROOK:"R",NOTATION_PAWN:"P",GENERAL_INVITE:'Thank you for using the <span style="font-weight:bold">{0}</span>.',MYGAMES_INVITE:'Thank you for using <span style="font-weight:bold">ChessBase MyGames</span>, your personal chess database in the web.',MYGAMES_FUNCTIONALITY:"Please login with your ChessBase Account to create and access your cloud chess databases. You can also use the cloud databases with ChessBase 13.",ECO:"ECO",BACK:"Back",NEXT_MOVE:"Next Move",PREV_MOVE:"Previous Move",NEXT_GAME:"Next Game",
PREV_GAME:"Previous Game",MENU_VIDEO_TOOL:"Training Videos",MENU_OPENINGS_TOOL:"Manage Openings",REQUESTING_MOVES:"Requesting Moves",FRESH_POSITION:"Fresh Position",EMBED:"Embed",HELP:"Help",TOGGLE_3D_2D:"Toggle 2D/3D Board",BOARD3D_BLACKWHITE:"Black white",MATE:"Mate",STALEMATE:"Stalemate",SETUP_POSITION:"Setup Position",WHITE_MATES:"White mates",WHITE_CLEARLY_WINNING:"White is clearly winning",WHITE_WINNING:"White is winning",WHITE_DECISIVE:"White has a decisive advantage",WHITE_CLEARLY_BETTER:"White is clearly better",
WHITE_BETTER:"White is better",WHITE_SLIGHTLY:"White is slightly better",WHITE_EDGE:"White is minimally better",BLACK_MATES:"Black mates",BLACK_CLEARLY_WINNING:"Black is clearly winning",BLACK_WINNING:"Black is winning",BLACK_DECISIVE:"Black has a decisive advantage",BLACK_CLEARLY_BETTER:"Black is clearly better",BLACK_BETTER:"Black is better",BLACK_SLIGHTLY:"Black is slightly better",BLACK_EDGE:"Black is minimally better",EQUAL_POS:"The position is equal",PREMIUM_ONLY:"Premium Only",BOARD3D_CHARACTER:"Avatar",
CALC_TRAINING:"Assisted Calculation",TTIP_CALC_TRAINING:"Calculate variations with Fritz' assistance before you continue the game here.",CALC_INFO:"Enter moves blindly. Click in the notation to add variations anywhere. Right-click unveils current position. Click 'Assisted Calculation' to resume your game.",CALCULATING:"Calculating...",WOOD:"Wood",TRAINING_SOLUTION:"Show Solution",TRAINING_HELP:"Get Help",TRAINING_QUESTION:"Find the correct move",UNANNOTATE:"Unannotate",MORE_LINES:"More Lines",LESS_LINES:"Less Lines",
CALCULATE_THREAT:"Calculate Threat",START_RADIO:"Start",PAUSE_RADIO:"Pause",CURRENTLY_NO_LIVE_BROADCAST:"At the moment there\u2019s no live broadcast",CONNECTED_TO_SERVER:"Connected to server: {0}",INITIALIZING:"Initializing",INSERT_DIAGRAM:"Insert Diagram",BOARD:"Board",LOADING_BOARD:"Loading board, just a second...",LIKE:"Like",DB_NOGAMES_FOUND:"No games found for this position and search string.",YOUR_KING_ACC:"your king",YOUR_QUEEN_ACC:"your queen",YOUR_KNIGHT_ACC:"your knight",YOUR_BISHOP_ACC:"your bishop",
YOUR_ROOK_ACC:"your rook",YOUR_PAWN_ACC:"your pawn",MOVE_IMP:"Move"};"use strict";CB.namespace("CB.Loc.Chess.GER");
CB.Loc.Chess.GER={LOGIN:"Anmelden",LOGOUT:"Abmelden",ACCOUNT:"Mein Konto",BOARDS:"Bretter",RECONNECT:"Verbinden",RESIGN:"Aufgeben",CLOSE_BOARD:"Brett schlie\u00dfen",OFFER_DRAW:"Remis bieten",ACCEPT_DRAW:"Remis akzeptieren",ACCEPTED_DRAW:"{0} hat das Remis angenommen.",OFFERS_DRAW:"{0} bietet Remis.",ACCEPTS_DRAW:"{0} nimmt Remis an.",RESIGNS:"{0} gibt auf.",TESTING_CONN:"Test Verbindung zum Server",CONNECTING:"Verbindung wird aufgebaut, einen Moment...",RECONNECTED_OK:"Verbindung wiederhergestellt",
NAME:"Name",NATION:"Land",RANK:"Rang",WHITE:"Weiss",BLACK:"Schwarz",ELO_WHITE:"Elo Weiss",ELO_BLACK:"Elo Schwarz",RESULT:"Ergebnis",TIME_CONTROL:"Bedenkzeit",TOURNAMENT:"Turnier",GAMES:"Partien",CHAT:"Chat",CHAT_PARTNER_GONE:"Ihr Chat Partner ist gegangen.",CONNECTION:"Verbindung",MAP:"Karte",KING:"K\u00f6nig",QUEEN:"Dame",ROOK:"Turm",BISHOP:"L\u00e4ufer",KNIGHT:"Springer",PAWN:"Bauer",TYPE_CHAT_HERE:"Chat hier eingeben",TYPE_HERE_TO_CHAT_WITH:"Hier tippen f\u00fcr Chat an",GUEST:"Gast",CONFIRM:"Best\u00e4tigen",
CANCEL:"Abbruch",CLOCK:"Uhr",TIME:"Time",GAIN_PER_MOVE:"Gain per Move",CLOSE:"Close",ADD:"Add",REMOVE:"Remove",NOTATION:"Notation",BOARD_FRITZ:"Fritz",BOARD_CRYSTALS:"Crystals",BOARD_USCF:"USCF",BOARD_OLDSTYLE:"OldStyle",BOARD_HABSBURG:"Habsburg",BOARD_FRITZ_AND_CHESTER:"Fritz & Fertig",PLAY_BLITZ:"Blitzpartie",NEW_GAME:"Neue Partie",TAKE_BACK:"Zug zur\u00fcck",MAKE_MOVE:"Zug vor",FLIP_BOARD:"Brett drehen",COPY:"Kopieren",SEARCH_BOARD:"Brett suchen",YEAR:"Jahr",BOOK:"Buch",LIVE_BOOK:"Live Buch",MOVE:"Zug",
NR_GAMES:"Nr Games",SCORE:"Score",LAST_PLAYED:"Zuletzt gespielt",ELO_AVG:"Elo Avg.",VISITS:"Besuche",LOADING_STATISTICS:"L\u00e4dt Statistiken",LETS_CHECK:"Let's Check",EVAL:"Eval",VARIATION:"Variation",DEPTH:"Tiefe",ENGINE:"Engine",ENTER_YOUR_SEARCH_TEXT:"Suchtext hier eingeben...",RETRIEVING_GAMES:"Lade Partien",PLAYER_DETAILS:"Spieler Details",PLAYER_INFORMATION:"Spieler Information",FIRST_NAME:"Vorname",LAST_NAME:"Nachname",YEAR_OF_BIRTH:"Geburtsjahr",TREND:"Trend",RATING:"Rating",SEND_FEEDBACK:"Feedback senden",
YOUR_COMMENT:"Ihr Hinweis",YOUR_EMAIL_ADDRESS:"Ihre E-Mail-Adresse",SEND:"Absenden",BROWSER_DOESNT_SUPPORT_3D:"Ihr Browser unterst\u00fctzt noch kein 3D",BOARD3D_FRITZ:"Fritz",BOARD3D_MODERN:"Modern",BOARD3D_ROOM:"Room",BOARD3D_BALLOON:"Balloon",BOARD3D_METAL:"Metal",BOARD3D_SILVER:"Silver",BOARD3D_FUTURE:"Future",BOARD3D_MARBLE:"Marble",WELCOME:"Willkommen",MATERIAL:"Material",ANALYSIS:"Analyse",ANALYSIS_ENGINE:"Engine",ENG_SEARCH_INFO_FMT:"Tiefe {0}/{1}, {2}Tsd Pos/s, Zeit = {3}s",PASTE:"Einf\u00fcgen",
PW_INVALID:'Account <em>"{0}"</em> oder Passwort nicht erkannt.',PLEASE_LOGIN:"Anmelden mit ChessBase (Playchess) Konto:",ACCOUNTNAME:"Name",PASSWORD:"Passwort",CREATE_ACCOUNT:"Konto neu anlegen",LOGIN_GUEST:"Gast",PLEASE_LOGIN_SHORT:"Bitte anmelden",LOADING_ENGINE:"Lade Engine...",LOADING_LIVE_GAMES:"Lade Live Partien ...",INVITING_OTHER_PLAYERS:"Inviting other players to a game of {0} ({1})",OTHER_TOOLS:"Weitere Apps",DATABASES:"Datenbanken",OPEN_DATABASE:"Datenbank \u00f6ffnen",CREATE_DATABASE:"Neue Datenbank",
DELETE_DATABASE:"Datenbank l\u00f6schen",DELETE:"L\u00f6schen",CLEAN_UP:"Aufr\u00e4umen",MY_DATABASES:"Meine Datenbanken",DATABASES_SHARED_WITH_ME:"Mit mir geteilt",SELECT_DATABASE_FOR_USER:"Datenbankauswahl f\u00fcr '{0}'",OPEN_PGN:"PGN \u00d6ffnen",SAVE:"Speichern",SAVE_AND_REPLACE_GAMES:"Partien speichern und ersetzen",SAVE_AS_NEW:"Neue Version speichern",EDIT_GAME:"Kenndaten setzen",DATABASE_FUNCTIONS:"Datenbanken \u00f6ffnen, anlegen und l\u00f6schen",TEXT_BEFORE:"Text vor Zug",TEXT_AFTER:"Text",
START_LINE:"Variante",PROMOTE_LINE:"Aufwerten",DELETE_LINE:"L\u00f6schen",CUT_LINE:"Schneiden",OPEN_PGN_TIP:"PGN-Datei von Ihrem Computer \u00f6ffnen",TEXT_BEFORE_TIP:"Textkommentar vor diesem Zug",TEXT_AFTER_TIP:"Textkommentar nach diesem Zug",START_LINE_TIP:"Zug zur\u00fccknehmen und Variante starten",PROMOTE_LINE_TIP:"Ausgew\u00e4hlte Variante wird Hauptvariante",DELETE_LINE_TIP:"Ausgew\u00e4hlte Variante l\u00f6schen",CUT_LINE_TIP:"Nachfolgende Z\u00fcge wegschneiden",STAY_LOGGED_IN:"Angemeldet bleiben",
FORGOT_PASSWORD:"Passwort vergessen",CHANGE_PASSWORD:"Passwort \u00e4ndern",OLD_PASSWORD:"Altes Passwort",NEW_PASSWORD:"Neues Passwort",CONFIRM_PASSWORD:"Passwort best\u00e4tigen",MENU_PLAYCHESS_TOOL:"Spielen & Zuschauen",MENU_DATABASE_TOOL:"Live Datenbank",MENU_MYGAMES_TOOL:"Meine Partien",MENU_FRITZ_TOOL:"Schachprogramm Fritz",MENU_FRITZ_CHESSTER_TOOL:"Fritz & Fertig f\u00fcr Kinder",MENU_TACTICS_TOOL:"Taktiktraining",LANGUAGE:"Sprache",LOGIN_CREATE_LINK:"Hier klicken, um Account anzulegen",LOGIN_PLEASE_LOGIN:"Bitte anmelden",
LOGIN_ACCOUNT_FREE:"Ein ChessBase Account ist kostenlos und gilt f\u00fcr alle ChessBase Web Tools und f\u00fcr www.schach.de.",LOGIN_WELCOME:"Willkommen, {0}",MANAGE_FRIENDS:"Freunde verwalten",INVITE_FRIEND:"Einen Freund einladen",PING:"Ping",NOTATION_KING:"K",NOTATION_QUEEN:"D",NOTATION_KNIGHT:"S",NOTATION_BISHOP:"L",NOTATION_ROOK:"T",NOTATION_PAWN:"",GENERAL_INVITE:'Danke f\u00fcr den Einsatz von <span style="font-weight:bold">{0}</span>.',MYGAMES_INVITE:'Danke f\u00fcr den Einsatz von <span style="font-weight:bold">ChessBase MyGames</span>, ihrer pers\u00f6nlichen Schachdatenbank im Web.',
MYGAMES_FUNCTIONALITY:"Mit Ihrem ChessBase Account k\u00f6nnen Sie Clouddatenbanken f\u00fcr Schachpartien anlegen und verwalten. Diese Clouddatenbanken stehen auch unter ChessBase 13 zur Verf\u00fcgung.",ECO:"ECO",BACK:"Zur\u00fcck",NEXT_MOVE:"Next Move",PREV_MOVE:"Previous Move",NEXT_GAME:"Next Game",PREV_GAME:"Previous Game",MENU_VIDEO_TOOL:"Videotraining",MENU_OPENINGS_TOOL:"Er\u00f6ffnungen verwalten",REQUESTING_MOVES:"Z\u00fcge anfordern",FRESH_POSITION:"Frische Stellung",EMBED:"Teilen",HELP:"Hilfe",
TOGGLE_3D_2D:"2D/3D Brett umschalten",BOARD3D_BLACKWHITE:"Schwarzweiss",MATE:"Matt",STALEMATE:"Patt",SETUP_POSITION:"Stellung aufbauen",WHITE_MATES:"Weiss setzt Matt",WHITE_CLEARLY_WINNING:"Weiss steht v\u00f6llig auf Gewinn",WHITE_WINNING:"Weiss steht auf Gewinn",WHITE_DECISIVE:"Weiss hat gro\u00dfen Vorteil",WHITE_CLEARLY_BETTER:"Weiss steht deutlich besser",WHITE_BETTER:"Weiss steht besser",WHITE_SLIGHTLY:"Weiss steht etwas besser",WHITE_EDGE:"Weiss steht minimal besser",BLACK_MATES:"Schwarz setzt Matt",
BLACK_CLEARLY_WINNING:"Schwarz steht v\u00f6llig auf Gewinn",BLACK_WINNING:"Schwarz steht auf Gewinn",BLACK_DECISIVE:"Schwarz hat gro\u00dfen Vorteil",BLACK_CLEARLY_BETTER:"Schwarz steht deutlich besser",BLACK_BETTER:"Schwarz steht besser",BLACK_SLIGHTLY:"Schwarz steht etwas besser",BLACK_EDGE:"Schwarz steht minimal besser",EQUAL_POS:"Die Stellung ist ausgeglichen",PREMIUM_ONLY:"Nur bei Premium",BOARD3D_CHARACTER:"Avatar",CALC_TRAINING:"Rechentraining",TTIP_CALC_TRAINING:"Berechnen Sie beliebige (gepr\u00fcfte) Varianten bevor Sie die Partie hier fortsetzen.",
CALC_INFO:"F\u00fchren Sie Z\u00fcge blind aus. Klicken Sie in die Notation, um Varianten hinzuzuf\u00fcgen. Rechtsklick zeigt wahre Stellung. Klick auf 'Rechentraining' setzt die Partie fort.",TRAINING_SOLUTION:"L\u00f6sung zeigen",TRAINING_HELP:"Hilfestellung",TRAINING_QUESTION:"Finde den richtigen Zug",UNANNOTATE:"Entkommentieren",MORE_LINES:"Mehr Varianten",LESS_LINES:"Weniger Varianten",CALCULATE_THREAT:"Drohung berechnen",START_RADIO:"Start",PAUSE_RADIO:"Pause",CURRENTLY_NO_LIVE_BROADCAST:"Im Augenblick l\u00e4uft keine Live\u00fcbertragung",
CONNECTED_TO_SERVER:"Verbunden: {0}",INITIALIZING:"Initialisiere",INSERT_DIAGRAM:"Diagramm einf\u00fcgen",BOARD:"Brett",LOADING_BOARD:"Brett wird geladen, eine Sekunde...",LIKE:"Like",DB_NOGAMES_FOUND:"Keine Partien mit diesem Suchtext und diesem Brett.",YOUR_KING_ACC:"Deinen K\u00f6nig",YOUR_QUEEN_ACC:"Deine Dame",YOUR_ROOK_ACC:"Deinen Turm",YOUR_BISHOP_ACC:"Deinen L\u00e4ufer",YOUR_KNIGHT_ACC:"Deinen Springer",YOUR_PAWN_ACC:"Deinen Bauern",MOVE_IMP:"Ziehe"};CB.Loc.Chess.DEU=CB.Loc.Chess.GER;"use strict";
CB.namespace("CB.Loc.Chess.ESP");
CB.Loc.Chess.ESP={LOGIN:"Conectar",LOGOUT:"Cerrar sesi\u00f3n",ACCOUNT:"Mi cuenta",BOARDS:"Tablero",RECONNECT:"Reconectar",RESIGN:"Rendirse",CLOSE_BOARD:"Cerrar tablero",OFFER_DRAW:"Ofrecer tablas",ACCEPT_DRAW:"Aceptar tablas",ACCEPTED_DRAW:"{0} acept\u00f3 tablas.",OFFERS_DRAW:"{0} ofrece tablas.",ACCEPTS_DRAW:"{0} acepta tablas.",RESIGNS:"{0} se rinde.",TESTING_CONN:"Probando la conexi\u00f3n con el servidor",CONNECTING:"Conectando con el servidor, por favor espere...",RECONNECTED_OK:"Reconectado",
NAME:"Nombre",NATION:"Pa\u00eds",RANK:"Rango",WHITE:"Blancas",BLACK:"Negras",ELO_WHITE:"Elo blancas",ELO_BLACK:"Elo negras",RESULT:"Resultado",TIME_CONTROL:"Control de tiempo",TOURNAMENT:"Torneo",GAMES:"Partidas",CHAT:"Charla",CHAT_PARTNER_GONE:"Su interlocutor se ha ido.",CONNECTION:"Conexi\u00f3n",MAP:"Mapa",KING:"Rey",QUEEN:"Dama",ROOK:"Torre",BISHOP:"Alfil",KNIGHT:"Caballo",PAWN:"Pe\u00f3n",TYPE_CHAT_HERE:"Escriba aqu\u00ed la charla",TYPE_HERE_TO_CHAT_WITH:"Escriba aqu\u00ed con quien quiere charlar",
GUEST:"Invitado",CONFIRM:"Confirmar",CANCEL:"Cancelar",CLOCK:"Reloj",TIME:"Tiempo",GAIN_PER_MOVE:"Incr. por mov.",CLOSE:"Cerrar",ADD:"A\u00f1adir",REMOVE:"Quitar",NOTATION:"Notaci\u00f3n",BOARD_FRITZ:"Fritz",BOARD_CRYSTALS:"Crystals",BOARD_USCF:"USCF",BOARD_OLDSTYLE:"OldStyle",BOARD_HABSBURG:"Habsburg",BOARD_FRITZ_AND_CHESTER:"Fritz & Chesster",PLAY_BLITZ:"Jugar blitz",NEW_GAME:"Nueva partida",TAKE_BACK:"Retroceder",MAKE_MOVE:"Jugar",FLIP_BOARD:"Girar tablero",COPY:"Copiar",SEARCH_BOARD:"Buscar tablero",
YEAR:"A\u00f1o",BOOK:"Libro",LIVE_BOOK:"Live Book",MOVE:"Jugada",NR_GAMES:"Partidas",SCORE:"Marcador",LAST_PLAYED:"\u00daltima vez",ELO_AVG:"Elo medio",VISITS:"Visitas",LOADING_STATISTICS:"Cargando estad\u00edsticas",LETS_CHECK:"Let's Check",EVAL:"Eval.",VARIATION:"Variante",DEPTH:"Prof.",ENGINE:"M\u00f3dulo",ENTER_YOUR_SEARCH_TEXT:"Escriba el texto a buscar...",RETRIEVING_GAMES:"Obtener partidas",PLAYER_DETAILS:"Datos del jugador",PLAYER_INFORMATION:"Informaci\u00f3n del jugador",FIRST_NAME:"Nombre",
LAST_NAME:"Apellidos",YEAR_OF_BIRTH:"Nacido en",TREND:"Tendencia",RATING:"Elo",SEND_FEEDBACK:"Enviar comentario",YOUR_COMMENT:"Su comentario",YOUR_EMAIL_ADDRESS:"Su e-mail",SEND:"Enviado",BROWSER_DOESNT_SUPPORT_3D:"El navegador no admite tableros 3D",BOARD3D_FRITZ:"Fritz",BOARD3D_MODERN:"Moderno",BOARD3D_ROOM:"Habitaci\u00f3n",BOARD3D_BALLOON:"Globos",BOARD3D_METAL:"Metal",BOARD3D_SILVER:"Plata",BOARD3D_FUTURE:"Futuro",BOARD3D_MARBLE:"M\u00e1rmol",WELCOME:"Bienvenido",MATERIAL:"Material",ANALYSIS:"An\u00e1lisis",
ANALYSIS_ENGINE:"M\u00f3dulo",ENG_SEARCH_INFO_FMT:"Prof {0}/{1}, {2}kPos/s, tiempo = {3}s",PASTE:"Pegar",PW_INVALID:"Usuario/Contrase\u00f1a no v\u00e1lido. Por favor, vuelva a intentarlo",PLEASE_LOGIN:"Por favor conecte con su cuenta ChessBase (Playchess):",ACCOUNTNAME:"Nombre",PASSWORD:"Contrase\u00f1a",CREATE_ACCOUNT:"Crear cuenta",LOGIN_GUEST:"Invitado",PLEASE_LOGIN_SHORT:"Por favor, identif\u00edquese",LOADING_ENGINE:"Cargando m\u00f3dulo...",LOADING_LIVE_GAMES:"Cargando partidas en directo...",
INVITING_OTHER_PLAYERS:"Invitando a otros jugadores a una partida de {0} ({1})",OTHER_TOOLS:"M\u00e1s herramientas",DATABASES:"Bases de datos",OPEN_DATABASE:"Abrir base",CREATE_DATABASE:"Crear base",DELETE_DATABASE:"Borrar base",DELETE:"Borrar",CLEAN_UP:"Limpiar",MY_DATABASES:"Mis bases",DATABASES_SHARED_WITH_ME:"Bases compartidas conmigo",SELECT_DATABASE_FOR_USER:"Seleccionar base para '{0}'",OPEN_PGN:"Abrir PGN",SAVE:"Guardar",SAVE_AND_REPLACE_GAMES:"Guardar y reemplazar partidas",SAVE_AS_NEW:"Guardar como nueva",
EDIT_GAME:"Editar partida",DATABASE_FUNCTIONS:"Abrir, crear y y borrar bases",TEXT_BEFORE:"Texto antes",TEXT_AFTER:"Texto despu\u00e9s",START_LINE:"Iniciar l\u00ednea",PROMOTE_LINE:"Promocionar l\u00ednea",DELETE_LINE:"Borrar l\u00ednea",CUT_LINE:"Cortar l\u00ednea",OPEN_PGN_TIP:"Abrir un archivo PGN de su equipo",TEXT_BEFORE_TIP:"A\u00f1adir comentario en forma de texto antes de esta jugada",TEXT_AFTER_TIP:" A\u00f1adir comentario en forma de texto tras esta jugada",START_LINE_TIP:"Retroceder la jugada y comenzar una variante",
PROMOTE_LINE_TIP:"Subir de nivel la variante seleccionada",DELETE_LINE_TIP:"Borrar la variante seleccionada",CUT_LINE_TIP:"Truncar la variante",STAY_LOGGED_IN:"Seguir conectado",FORGOT_PASSWORD:"Contrase\u00f1a olvidada",CHANGE_PASSWORD:"Cambiar contrase\u00f1a",OLD_PASSWORD:"Contrase\u00f1a antigua",NEW_PASSWORD:"Contrase\u00f1a nueva",CONFIRM_PASSWORD:"Confirmar contrase\u00f1a",MENU_PLAYCHESS_TOOL:"Playchess",MENU_DATABASE_TOOL:"Live Database",MENU_MYGAMES_TOOL:"My Games Cloud",MENU_FRITZ_TOOL:"Fritz Online",
MENU_FRITZ_CHESSTER_TOOL:"Chess For Kids",MENU_TACTICS_TOOL:"Tactics Training",LANGUAGE:"Idioma",LOGIN_CREATE_LINK:"Haga clic aqu\u00ed para crear una cuenta",LOGIN_PLEASE_LOGIN:"Por favor identif\u00edquese",LOGIN_ACCOUNT_FREE:"La creaci\u00f3n de una cuenta es gratis. La cuenta vale para todas las dem\u00e1s herramientas web de ChessBase y para jugar en www.playchess.com.",LOGIN_WELCOME:"Bienvenido {0}",MANAGE_FRIENDS:"Gestionar amigos",INVITE_FRIEND:"Invitar a un amigo",PING:"Ping",NOTATION_KING:"R",
NOTATION_QUEEN:"D",NOTATION_KNIGHT:"C",NOTATION_BISHOP:"A",NOTATION_ROOK:"T",NOTATION_PAWN:"P",GENERAL_INVITE:"Gracias por usar {0}.",MYGAMES_INVITE:"Gracias por usar ChessBase MyGames, su base de datos de ajedrez personal en la web.",MYGAMES_FUNCTIONALITY:"Por favor con\u00e9ctese con su cuenta ChessBase para tener acceso a sus bases de datos en la nube. Tambi\u00e9n puede usar las bases de datos en la nube con ChessBase 13.",ECO:"ECO",BACK:"Volver",NEXT_MOVE:"Siguiente jug.",PREV_MOVE:"Anterior jug.",
NEXT_GAME:"Siguiente part.",PREV_GAME:"Anterior part.",MENU_VIDEO_TOOL:"V\u00eddeos de entrenamiento",MENU_OPENINGS_TOOL:"Gestionar aperturas",REQUESTING_MOVES:"Requesting Moves",FRESH_POSITION:"Fresh Position",EMBED:"Embed",HELP:"Help",TOGGLE_3D_2D:"Toggle 2D/3D Board",BOARD3D_BLACKWHITE:"Black white",MATE:"Mate",STALEMATE:"Ahogado",SETUP_POSITION:"Armar posici\u00f3n",WHITE_MATES:"Las blancas dan mate",WHITE_CLEARLY_WINNING:"Las blancas tienen clara ventaja ganadora",WHITE_WINNING:"Las blancas tienen ventaja ganadora",
WHITE_DECISIVE:"Las blancas tienen ventaja decisiva",WHITE_CLEARLY_BETTER:"Las blancas est\u00e1n claramente mejor",WHITE_BETTER:"Las blancas est\u00e1n mejor",WHITE_SLIGHTLY:"Las blancas est\u00e1n un poco mejor",WHITE_EDGE:"Las blancas tienen una ventaja m\u00ednima",BLACK_MATES:"Las negras dan mate",BLACK_CLEARLY_WINNING:"Las negras tienen clara ventaja ganadora",BLACK_WINNING:"Las negras tienen ventaja ganadora",BLACK_DECISIVE:"Las negras tienen ventaja decisiva",BLACK_CLEARLY_BETTER:"Las negras est\u00e1n claramente mejor",
BLACK_BETTER:"Las negras est\u00e1n mejor",BLACK_SLIGHTLY:"Las negras est\u00e1n un poco mejor",BLACK_EDGE:"Las negras tienen una ventaja m\u00ednima",EQUAL_POS:"La posici\u00f3n est\u00e1 igualada",PREMIUM_ONLY:"S\u00f3lo premium",BOARD3D_CHARACTER:"Avatar",CALC_TRAINING:"Entrenar c\u00e1lculo",TTIP_CALC_TRAINING:"Calcular variantes con la ayuda de Fritz antes de continuar la partida aqu\u00ed.",CALC_INFO:"Ejecute jugadas a la ciega. Haga clic en la notaci\u00f3n para a\u00f1adir variantes. Haga clic en 'Entrenar c\u00e1lculo' para reanudar la partida.",
CALCULATING:"Calculando...",WOOD:"Madera",TRAINING_SOLUTION:"Ver soluci\u00f3n",TRAINING_HELP:"Ayuda",TRAINING_QUESTION:"Encontrar la jugada correcta",UNANNOTATE:"Desanotar",MORE_LINES:"M\u00e1s l\u00edneas",LESS_LINES:"Menos l\u00edneas",CALCULATE_THREAT:"Calcular amenaza",START_RADIO:"Start",PAUSE_RADIO:"Pause",CURRENTLY_NO_LIVE_BROADCAST:"En ese momento, no hay una transmisi\u00f3n",CONNECTED_TO_SERVER:"Connected to server: {0}",INITIALIZING:"Initializing",INSERT_DIAGRAM:"Insert Diagram",BOARD:"Tablero",
LOADING_BOARD:"Loading board, just a second...",LIKE:"Like",KING_ACC:"King",QUEEN_ACC:"Queen",KNIGHT_ACC:"Knight",BISHOP_ACC:"Bishop",ROOK_ACC:"Rook",PAWN_ACC:"Pawn"};"use strict";CB.namespace("CB.Loc.Reader.ENG");
CB.Loc.Reader.ENG={PRODUCT_IS_ACTIVATED:"Product is activated",PRODUCT_KEY_CONTAINS_5_BLOCKS:"A product key should contain 5 blocks of 5 characters",DOWNLOADING_FILES:"Downloading files",PLEASE_ACTIVATE_THIS_PRODUCT:"Please activate this product",SERVER_IS_IN_MAINTENANCE:"Server in Maintenance",PRODUCT_KEY_ALREADY_USED_BEFORE:"Product key Already used",PRODUCT_KEY_IS_DISABLED:"Product key disabled",PRODUCT_KEY_IS_INVALID:"Product key invalid",PRODUCT_KEY_ALREADY_ACTIVATED:"Product key is already activated",
PRODUCT_KEY_NOT_VALID_FOR_THIS_PRODUCT:"Product key not valid for this product",DEACTIVATE_THIS_PRODUCT:"Deactivate this product",PRODUCT_IS_DEACTIVATED:"Product is deactivated",LAST_BLOCK_SHOULD_CONTAIN_DATA:"Last block should contain 'DATA'",YOUR_SYSTEMS_CONFIGURATION_HAS_CHANGED:"Your Systems configuration has changed",SEND_YOUR_FEEDBACK:"Send your feedback"};"use strict";CB.namespace("CB.Loc.Reader.GER");
CB.Loc.Reader.GER={PRODUCT_IS_ACTIVATED:"Product is activated",PRODUCT_KEY_CONTAINS_5_BLOCKS:"A product key should contain 5 blocks of 5 characters",DOWNLOADING_FILES:"Downloading files",PLEASE_ACTIVATE_THIS_PRODUCT:"Please activate this product",SERVER_IS_IN_MAINTENANCE:"Server in Maintenance",PRODUCT_KEY_ALREADY_USED_BEFORE:"Product key Already used",PRODUCT_KEY_IS_DISABLED:"Product key disabled",PRODUCT_KEY_IS_INVALID:"Product key invalid",PRODUCT_KEY_ALREADY_ACTIVATED:"Product key is already activated",
PRODUCT_KEY_NOT_VALID_FOR_THIS_PRODUCT:"Product key not valid for this product",DEACTIVATE_THIS_PRODUCT:"Deactivate this product",PRODUCT_IS_DEACTIVATED:"Product is deactivated",LAST_BLOCK_SHOULD_CONTAIN_DATA:"Last block should contain 'DATA'",YOUR_SYSTEMS_CONFIGURATION_HAS_CHANGED:"Your Systems configuration has changed",SEND_YOUR_FEEDBACK:"Send your feedback"};"use strict";CB.namespace("CB.Loc.Reader.ESP");
CB.Loc.Reader.ESP={PRODUCT_IS_ACTIVATED:"Product is activated",PRODUCT_KEY_CONTAINS_5_BLOCKS:"A product key should contain 5 blocks of 5 characters",DOWNLOADING_FILES:"Downloading files",PLEASE_ACTIVATE_THIS_PRODUCT:"Please activate this product",SERVER_IS_IN_MAINTENANCE:"Server in Maintenance",PRODUCT_KEY_ALREADY_USED_BEFORE:"Product key Already used",PRODUCT_KEY_IS_DISABLED:"Product key disabled",PRODUCT_KEY_IS_INVALID:"Product key invalid",PRODUCT_KEY_ALREADY_ACTIVATED:"Product key is already activated",
PRODUCT_KEY_NOT_VALID_FOR_THIS_PRODUCT:"Product key not valid for this product",DEACTIVATE_THIS_PRODUCT:"Deactivate this product",PRODUCT_IS_DEACTIVATED:"Product is deactivated",LAST_BLOCK_SHOULD_CONTAIN_DATA:"Last block should contain 'DATA'",YOUR_SYSTEMS_CONFIGURATION_HAS_CHANGED:"Your Systems configuration has changed",SEND_YOUR_FEEDBACK:"Send your feedback"};
var LZString=function(){function c(b,e){if(!d[b]){d[b]={};for(var c=0;c<b.length;c++)d[b][b.charAt(c)]=c}return d[b][e]}var b=String.fromCharCode,d={},e={compressToBase64:function(b){if(null==b)return"";b=e._compress(b,6,function(b){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)});switch(b.length%4){default:case 0:return b;case 1:return b+"===";case 2:return b+"==";case 3:return b+"="}},decompressFromBase64:function(b){return null==b?"":""==b?null:e._decompress(b.length,
32,function(d){return c("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b.charAt(d))})},compressToUTF16:function(d){return null==d?"":e._compress(d,15,function(d){return b(d+32)})+" "},decompressFromUTF16:function(b){return null==b?"":""==b?null:e._decompress(b.length,16384,function(d){return b.charCodeAt(d)-32})},compressToUint8Array:function(b){b=e.compress(b);for(var d=new Uint8Array(2*b.length),c=0,l=b.length;c<l;c++){var q=b.charCodeAt(c);d[2*c]=q>>>8;d[2*c+1]=q%256}return d},
decompressFromUint8Array:function(d){if(null===d||void 0===d)return e.decompress(d);for(var c=Array(d.length/2),h=0,l=c.length;h<l;h++)c[h]=256*d[2*h]+d[2*h+1];var q=[];c.forEach(function(d){q.push(b(d))});return e.decompress(q.join(""))},compressToEncodedURIComponent:function(b){return null==b?"":e._compress(b,6,function(b){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(b)})},decompressFromEncodedURIComponent:function(b){if(null==b)return"";if(""==b)return null;
b=b.replace(/ /g,"+");return e._decompress(b.length,32,function(d){return c("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",b.charAt(d))})},compress:function(d){return e._compress(d,16,function(d){return b(d)})},_compress:function(b,d,e){if(null==b)return"";var c,q,r={},t={},v,y,A="",w=2,z=3,C=2,D=[],E=0,F=0,G;for(G=0;G<b.length;G+=1)if(v=b.charAt(G),Object.prototype.hasOwnProperty.call(r,v)||(r[v]=z++,t[v]=!0),y=A+v,Object.prototype.hasOwnProperty.call(r,y))A=y;else{if(Object.prototype.hasOwnProperty.call(t,
A)){if(256>A.charCodeAt(0)){for(c=0;c<C;c++)E<<=1,F==d-1?(F=0,D.push(e(E)),E=0):F++;q=A.charCodeAt(0);for(c=0;8>c;c++)E=E<<1|q&1,F==d-1?(F=0,D.push(e(E)),E=0):F++,q>>=1}else{q=1;for(c=0;c<C;c++)E=E<<1|q,F==d-1?(F=0,D.push(e(E)),E=0):F++,q=0;q=A.charCodeAt(0);for(c=0;16>c;c++)E=E<<1|q&1,F==d-1?(F=0,D.push(e(E)),E=0):F++,q>>=1}w--;0==w&&(w=Math.pow(2,C),C++);delete t[A]}else for(q=r[A],c=0;c<C;c++)E=E<<1|q&1,F==d-1?(F=0,D.push(e(E)),E=0):F++,q>>=1;w--;0==w&&(w=Math.pow(2,C),C++);r[y]=z++;A=String(v)}if(""!==
A){if(Object.prototype.hasOwnProperty.call(t,A)){if(256>A.charCodeAt(0)){for(c=0;c<C;c++)E<<=1,F==d-1?(F=0,D.push(e(E)),E=0):F++;q=A.charCodeAt(0);for(c=0;8>c;c++)E=E<<1|q&1,F==d-1?(F=0,D.push(e(E)),E=0):F++,q>>=1}else{q=1;for(c=0;c<C;c++)E=E<<1|q,F==d-1?(F=0,D.push(e(E)),E=0):F++,q=0;q=A.charCodeAt(0);for(c=0;16>c;c++)E=E<<1|q&1,F==d-1?(F=0,D.push(e(E)),E=0):F++,q>>=1}w--;0==w&&(w=Math.pow(2,C),C++);delete t[A]}else for(q=r[A],c=0;c<C;c++)E=E<<1|q&1,F==d-1?(F=0,D.push(e(E)),E=0):F++,q>>=1;w--;0==
w&&C++}q=2;for(c=0;c<C;c++)E=E<<1|q&1,F==d-1?(F=0,D.push(e(E)),E=0):F++,q>>=1;for(;;)if(E<<=1,F==d-1){D.push(e(E));break}else F++;return D.join("")},decompress:function(b){return null==b?"":""==b?null:e._decompress(b.length,32768,function(d){return b.charCodeAt(d)})},_decompress:function(d,e,c){var l=[],q=4,r=4,t=3,v,y=[],A,w,z,C,D,E=c(0),F=e,G=1;for(A=0;3>A;A+=1)l[A]=A;w=0;C=Math.pow(2,2);for(D=1;D!=C;)z=E&F,F>>=1,0==F&&(F=e,E=c(G++)),w|=(0<z?1:0)*D,D<<=1;switch(w){case 0:w=0;C=Math.pow(2,8);for(D=
1;D!=C;)z=E&F,F>>=1,0==F&&(F=e,E=c(G++)),w|=(0<z?1:0)*D,D<<=1;v=b(w);break;case 1:w=0;C=Math.pow(2,16);for(D=1;D!=C;)z=E&F,F>>=1,0==F&&(F=e,E=c(G++)),w|=(0<z?1:0)*D,D<<=1;v=b(w);break;case 2:return""}A=l[3]=v;for(y.push(v);;){if(G>d)return"";w=0;C=Math.pow(2,t);for(D=1;D!=C;)z=E&F,F>>=1,0==F&&(F=e,E=c(G++)),w|=(0<z?1:0)*D,D<<=1;switch(v=w){case 0:w=0;C=Math.pow(2,8);for(D=1;D!=C;)z=E&F,F>>=1,0==F&&(F=e,E=c(G++)),w|=(0<z?1:0)*D,D<<=1;l[r++]=b(w);v=r-1;q--;break;case 1:w=0;C=Math.pow(2,16);for(D=1;D!=
C;)z=E&F,F>>=1,0==F&&(F=e,E=c(G++)),w|=(0<z?1:0)*D,D<<=1;l[r++]=b(w);v=r-1;q--;break;case 2:return y.join("")}0==q&&(q=Math.pow(2,t),t++);if(l[v])v=l[v];else if(v===r)v=A+A.charAt(0);else return null;y.push(v);l[r++]=A+v.charAt(0);q--;A=v;0==q&&(q=Math.pow(2,t),t++)}}};return e}();
"function"===typeof define&&define.amd?define(function(){return LZString}):"undefined"!==typeof module&&null!=module?module.exports=LZString:"undefined"!==typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",function(){return LZString});function getCtxFunction(c,b){return function(){return b.apply(c,arguments)}}Function.prototype.bind||(Function.prototype.bind=function(c){return getCtxFunction(c,this)});
var Ve={initInstForListeners:function(c){c.addListener=Ve.addListener;c.removeListener=Ve.removeListener;c.fireEvent=Ve.fireEvent;c.getListeners=Ve.getListeners;c.enableEvents=Ve.enableEvents;c.eventsEnabled=!0;c.idLstnr=0},initForListeners:function(c){Ve.initInstForListeners(c.prototype)},enableEvents:function(c){this.eventsEnabled=c},getListeners:function(c){c="m_lstOn"+c;var b=this[c];b||(b={},this[c]=b);return b},addListener:function(c,b){this.getListeners(c)[++this.idLstnr]=b;return this.idLstnr},
removeListener:function(c,b){delete this.getListeners(c)[b]},fireEvent:function(c,b){if(this.eventsEnabled){var d=this.getListeners(c),e;for(e in d)d.hasOwnProperty(e)&&d[e].apply(this,b)}},addInstEvent:function(c,b,d){c[String.formatEx("addOn{0}Listener",b)]=function(d){return this.addListener(b,d)};c[String.formatEx("removeOn{0}Listener",b)]=function(d){this.removeListener(b,d)};c[String.formatEx("fireOn{0}",b)]=function(){if(this[String.formatEx("fireOn{0}",b)].delayed)this[String.formatEx("fireOn{0}",
b)].needFire=!0;else try{var e=arguments||[];d&&(e=d.call(this));this.fireEvent(b,e)}catch(c){CB.LogException("fire-"+b,c)}};c.removeAllListeners=function(){for(var b in this)this.hasOwnProperty(b)&&0==b.search("m_lstOn")&&delete b};c[String.formatEx("delayfireOn{0}",b)]=function(d){d=d||100;this[String.formatEx("fireOn{0}",b)].delayed=!0;var c=this;window.setTimeout(function(){c[String.formatEx("continuefireOn{0}",b)]()},d)};c[String.formatEx("continuefireOn{0}",b)]=function(){this[String.formatEx("fireOn{0}",
b)].delayed=!1;if(this[String.formatEx("fireOn{0}",b)].needFire)try{this[String.formatEx("fireOn{0}",b)]()}catch(d){CB.LogException("delfire-"+b,d)}this[String.formatEx("fireOn{0}",b)].needFire=!1}},addEvent:function(c,b,d){Ve.addInstEvent(c.prototype,b,d)}};function HashTable(c,b){c&&(this.funcHash=c);b&&(this.funcEq=b);this.impl={}}HashTable.prototype.impl={};HashTable.prototype.funcHash=function(c){return ObjUtil.hashCode(c)};HashTable.prototype.funcEq=function(c,b){return c===b};
HashTable.prototype.getItem=function(c){var b=this.funcHash(c);if(b=this.impl[b]){var d=function(b){return this.funcEq(b.key,c)}.bind(this),b=b.filter(d);if(null!=b&&0<b.length)return b[0].value}};HashTable.prototype.setItem=function(c,b){var d=this.funcHash(c),e=this.impl[d];e||(e=[],this.impl[d]=e);for(var d=0,f=e.length;d<f;++d){var g=e[d];if(this.funcEq(g.key,c)){g.value=b;return}}e.push({key:c,value:b})};
HashTable.prototype.removeItem=function(c){var b=this.funcHash(c),d=this.impl[b];if(d){var e=function(b){return!this.funcEq(b.key,c)}.bind(this),d=d.filter(e);this.impl[b]=d}};HashTable.prototype.clear=function(){this.impl={}};"use strict";
var ObjUtil={clone:function(c,b){b||(b=new HashTable);var d=b.getItem(c);if(d)return d;c.clone?d=c.clone(b):(d=ObjUtil.isArray(c)?[]:new c.constructor,b.setItem(c,d),ObjUtil.copyTo(c,d,!1,b));b.setItem(c,d);return d},clone2:function(c){return ObjUtil.copyTo2(c,new c.constructor)},cloneNoFunc:function(c){c=JSON.stringify(c);return JSON.parse(c)},copyTo:function(c,b,d,e){for(var f in c)if(!(d&&f in b)){var g=c[f],h=g;null!=g&&"object"===typeof g&&(h=ObjUtil.clone(g,e));b[f]=h}c.toString!==b.toString&&
(b.toString=c.toString);return b},copyTo2:function(c,b){for(var d in c){var e=c[d],f=e;null!=e&&"object"===typeof e&&(f=ObjUtil.clone2(e));b[d]=f}return b}};function _CMP(c,b){if(void 0===c!==(void 0===b))return!1;if(void 0===c&&void 0===b)return!0;if(null===c!==(null===b))return!1;if(null===c&&null===b)return!0;var d=typeof c,e=typeof b;return"object"===d!==("object"===e)?!1:"object"===d&&"object"===e?ObjUtil.equals(c,b):c==b}
ObjUtil.equals=function(c,b){if(c.equals)return c.equals(b);for(var d in c)if(!_CMP(c[d],b[d]))return!1;return!0};ObjUtil.isEmpty=function(c){return!Object.keys(c).length};ObjUtil.isFunction=function(c){return!!(c&&c.constructor&&c.call&&c.apply)};ObjUtil.isArray=function(c){return"[object Array]"===Object.prototype.toString.call(c)};function djb2(c){for(var b=5381,d,e=0;e<c.length;++e)d=c.charCodeAt(e)&255,b=4294967295&(b<<5)+b+d;return b}
function StringHash(c){return djb2(typeof c+c.constructor.toString())}ObjUtil.hashCode=function(c){return c.hashCode?c.hashCode():"object"===typeof c?StringHash(c):djb2(c.toString())};function EnumToString(c,b){for(var d in c)if(c[d]===b)return d;return""}function StringToEnum(c,b){if(b in c)return c[b]}function StringToEnumFlags(c,b){for(var d=b.split("|"),e=0,f=0,g=d.length;f<g;++f){var h=StringToEnum(c,d[f]);h&&(e|=h)}return e}
function evalObj(c){var b={},d;for(d in c){var e=c[d];b[d]=e;"string"===typeof e&&(0>e.indexOf("{")||(b[d]=eval("("+e+")")))}return b}function minusToCamel(c){for(var b=c.indexOf("-");0<=b;b=c.indexOf("-")){var d=c.substring(0,b);c=c.substring(b+1);0<c.length&&(c=c.charAt(0).toUpperCase()+(1<c.length?c.substring(1):""));c=d+c}return c}function NOT(c){return function(){return!c.apply(this,arguments)}}function TRUE(){return function(){return!0}}function FALSE(){return function(){return!1}}
function EqualsFilter(c){return function(b,d,e){return ObjUtil.equals(b,c)}}"use strict";Array.prototype.find||(Array.prototype.find=function(c){if("function"!==typeof c)throw new TypeError("predicate must be a function");for(var b=Object(this),d=b.length>>>0,e,f=0;f<d;f++)if(f in b&&(e=b[f],c.call(this,e,f,b)))return e});Array.prototype.all||(Array.prototype.all=function(c){return!this.some(function(b,d,e){return!c(b,d,e)})});
Array.prototype.findIndex||(Array.prototype.findIndex=function(c){if("function"!==typeof c)throw new TypeError("predicate must be a function");for(var b=Object(this),d=b.length>>>0,e,f=0;f<d;f++)if(f in b&&(e=b[f],c.call(this,e,f,b)))return f;return-1});
Array.prototype.pickRandom||(Array.prototype.pickRandom=function(c){if("function"!==typeof c)throw new TypeError("predicate must be a function");for(var b=Object(this),d=b.length>>>0,e,f=void 0,g=0,h=0;h<d;h++)h in b&&(g+=c.call(this,b[h],h,b));for(var l=Math.random()*g,h=g=0;h<d;h++)if(h in b&&(e=b[h],g+=c.call(this,e,h,b),g>=l)){f=e;break}return f});"use strict";
CB.Handlers=function(){var c=function(b){this.scope=b;this.handlers=[]};c.prototype.count=function(){return this.handlers.length};c.prototype.add=function(b){this.handlers.push(b);return this.handlers.length-1};c.prototype.remove=function(b){null!=b&&void 0!==this.handlers[b]&&delete this.handlers[b]};c.prototype.execute=function(){for(var b=0;b<this.handlers.length;b++)if(void 0!==this.handlers[b])this.handlers[b](this.scope)};c.prototype.empty=function(){for(var b=0;b<this.handlers.length;b++)if(void 0!==
this.handlers[b])return!1;return!0};return c}();"use strict";CB.namespace("CB.strUtil");CB.strUtil.encodeUTF8=function(c){return unescape(encodeURIComponent(c))};CB.strUtil.decodeUTF8=function(c){return CB.strUtil.utf8ArrayToStr(c)};CB.strUtil.test=function(){var c=CB.strUtil.encodeUTF8("Rh\u00f4ne");return CB.strUtil.mayBeUtf8(c)};
CB.strUtil.utf8ArrayToStr=function(c){var b,d,e,f,g,h;b="";e=c.length;for(d=0;d<e;)switch(f=c[d++].charCodeAt(0),f>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(f);break;case 12:case 13:d<e&&(g=c[d++].charCodeAt(0));b+=String.fromCharCode((f&31)<<6|g&63);break;case 14:d<e&&(g=c[d++].charCodeAt(0)),d<e&&(h=c[d++].charCodeAt(0)),b+=String.fromCharCode((f&15)<<12|(g&63)<<6|(h&63)<<0)}return b};
CB.strUtil.mayBeUtf8=function(c){for(var b=!1,d=0;d<c.length&&!b;d++){var e=c.charCodeAt(d);if(e&128)if(194<=e&&223>=e&&128<=c.charCodeAt(d+1)&&191>=c.charCodeAt(d+1))d+=2,b=!0;else if(224==e&&160<=c.charCodeAt(d+1)&&191>=c.charCodeAt(d+1)&&128<=c.charCodeAt(d+2)&&191>=c.charCodeAt(d+2)||(225<=e&&236>=e||238==e||239==e)&&128<=c.charCodeAt(d+1)&&191>=c.charCodeAt(d+1)&&128<=c.charCodeAt(d+2)&&191>=c.charCodeAt(d+2)||237==e&&128<=c.charCodeAt(d+1)&&159>=c.charCodeAt(d+1)&&128<=c.charCodeAt(d+2)&&191>=
c.charCodeAt(d+2))d+=3,b=!0;else if(240==e&&144<=c.charCodeAt(d+1)&&191>=c.charCodeAt(d+1)&&128<=c.charCodeAt(d+2)&&191>=c.charCodeAt(d+2)&&128<=c.charCodeAt(d+3)&&191>=c.charCodeAt(d+3)||241<=e&&243>=e&&128<=c.charCodeAt(d+1)&&191>=c.charCodeAt(d+1)&&128<=c.charCodeAt(d+2)&&191>=c.charCodeAt(d+2)&&128<=c.charCodeAt(d+3)&&191>=c.charCodeAt(d+3)||244==e&&128<=c.charCodeAt(d+1)&&143>=c.charCodeAt(d+1)&&128<=c.charCodeAt(d+2)&&191>=c.charCodeAt(d+2)&&128<=c.charCodeAt(d+3)&&191>=c.charCodeAt(d+3))d+=
4,b=!0}return b};CB.strUtil.hasASCIIgreater127=function(c){for(var b=0;b<c.length;b++)if(c.charCodeAt(b)&128)return!0;return!1};CB.strUtil.codeURLParameter=function(c){return CB.strUtil.base64.encode(c)};CB.strUtil.decodeURLParameter=function(c){return CB.strUtil.base64.decode(c)};
CB.strUtil.base64={base64s:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",encode:function(c){if("function"===typeof btoa)return btoa(c);for(var b=this.base64s,d,e,f=0,g="";c.length>=f+3;)d=(c.charCodeAt(f++)&255)<<16|(c.charCodeAt(f++)&255)<<8|c.charCodeAt(f++)&255,g+=b.charAt((d&16515072)>>18)+b.charAt((d&258048)>>12)+b.charAt((d&4032)>>6)+b.charAt(d&63);0<c.length-f&&3>c.length-f&&(e=!!(c.length-f-1),d=(c.charCodeAt(f++)&255)<<16|(e?(c.charCodeAt(f)&255)<<8:0),g+=b.charAt((d&
16515072)>>18)+b.charAt((d&258048)>>12)+(e?b.charAt((d&4032)>>6):"=")+"=");return g},decode:function(c){if("function"===typeof atob)return atob(c);var b=this.base64s,d,e="",f;for(f=0;f<c.length;f+=4)d=(b.indexOf(c.charAt(f))&255)<<18|(b.indexOf(c.charAt(f+1))&255)<<12|(b.indexOf(c.charAt(f+2))&255)<<6|b.indexOf(c.charAt(f+3))&255,e+=String.fromCharCode((d&16711680)>>16,(d&65280)>>8,d&255);return 61===c.charCodeAt(f-2)?e.substring(0,e.length-2):61===c.charCodeAt(f-1)?e.substring(0,e.length-1):e},decodeToBinary:function(c){this.lookup=
new Uint8Array(256);for(var b=0;b<this.base64s.length;b++)this.lookup[this.base64s.charCodeAt(b)]=b;var b=.75*c.length,d=c.length,e=0,f,g,h,l;"="===c[c.length-1]&&(b--,"="===c[c.length-2]&&b--);for(var q=new ArrayBuffer(b),r=new Uint8Array(q),b=0;b<d;b+=4)f=this.lookup[c.charCodeAt(b)],g=this.lookup[c.charCodeAt(b+1)],h=this.lookup[c.charCodeAt(b+2)],l=this.lookup[c.charCodeAt(b+3)],r[e++]=f<<2|g>>4,r[e++]=(g&15)<<4|h>>2,r[e++]=(h&3)<<6|l&63;return q}};
CB.strUtil.getURLParam=function(c){c=c.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");c=(new RegExp("[\\?&]"+c+"=([^&#]*)")).exec(window.location.href);if(null===c)return"";c=c[1];c.length&&"/"==c.charAt(c.length-1)&&(c=c.slice(0,c.length-1));return c};CB.strUtil.shortenURL=function(c){if(c){var b=c.toLowerCase();b.replace(/</g,"(");b.replace(/>/g,")");b&&15<b.length&&(-1!=c.search("http://")&&(b=b.slice(7)),-1!=c.search("https://")&&(b=b.slice(8)),c=b.indexOf("/"),0<c&&(b=b.slice(0,c)));return b}return""};
CB.strUtil.trimQuotes=function(c){c=c.replace("%22",'"');c=c.replace("%27","'");if('"'==c.charAt(0)||"'"==c.charAt(0))c=c.slice(1,c.length-1);return c};CB.strUtil.escapeHtmlEntities=function(c){return c.replace(/[\u00A0-\u2666<>\&]/g,function(b){return"&#"+b.charCodeAt(0)+";"})};var decodeHtmlEntity=function(c){},encodeHtmlEntity=function(c){};CB.strUtil.htmlEncode=function(c){return c.replace(/[\u00A0-\u2666<>\&]/g,function(b){return"&#"+b.charCodeAt(0)+";"})};
CB.strUtil.htmlDecode=function(c){return c.replace(/&#(\d+);/g,function(b,d){return String.fromCharCode(d)})};CB.strUtil.tryConvertCyrillicAscii=function(c){for(var b=0,d="",e=0;e<c.length;e++){var f=c.charCodeAt(e);if(255<f)return c;127<f&&b++;d+=String.fromCharCode(this.conv1252[f])}return b>.7*c.length?d:c};
CB.strUtil.conv1252=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,1026,1027,8218,1107,8222,8230,8224,8225,8364,8240,1033,8249,1034,1036,1035,1039,1106,8216,8217,8220,8221,
8226,8211,8212,8482,1113,8250,1114,1116,1115,1119,160,1038,1118,1032,164,1168,166,167,1025,169,1028,171,172,173,174,1031,176,177,1030,1110,1169,181,182,183,1105,8470,1108,187,1112,1029,1109,1111,1040,1041,1042,1043,1044,1045,1046,1047,1048,1049,1050,1051,1052,1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,1065,1066,1067,1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,1080,1081,1082,1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1093,1094,1095,1096,1097,1098,1099,1100,1101,
1102,1103];
(function(c,b){c.JSONP=function(b,e,f,g){b=b||"";e=e||{};f=f||"";g=g||function(){};var h=function(b){var d=[],e;for(e in b)b.hasOwnProperty(e)&&d.push(e);return d};if("object"==typeof e){for(var l="",h=h(e),q=0;q<h.length;q++)l+=encodeURIComponent(h[q])+"="+encodeURIComponent(e[h[q]]),q!=h.length-1&&(l+="&");b+="?"+l}else"function"==typeof e&&(g=f=e);"function"==typeof f&&(g=f,f="callback");Date.now||(Date.now=function(){return(new Date).getTime()});e=Date.now();var r="jsonp"+Math.round(e+1000001*
Math.random());c[r]=function(b){g(b);delete c[r]};b=-1===b.indexOf("?")?b+"?":b+"&";e=document.createElement("script");e.setAttribute("src",b+f+"="+r);document.getElementsByTagName("head")[0].appendChild(e)}})(window);function byteswap_ushort(c){var b=new ArrayBuffer(2),b=new DataView(b);b.setUInt16(0,c);c=b.GetUint8();b.SetUint8(0,b.GetUint8(1));b.SetUint8(1,c);return b.GetUint16(0)}
function byteswap_ulong(c){var b=new ArrayBuffer(4),b=new DataView(b);b.setUInt32(0,c);c=new ArrayBuffer(4);c=new DataView(c);for(var d=0;4>d;d++)c.setUint8(d,b.getUint8(3-d));return c.GetUint32(0)}function byteswap_uint64(c){var b=new ArrayBuffer(8),b=new DataView(b);b.setUInt64(0,c);c=new ArrayBuffer(8);c=new DataView(c);for(var d=0;8>d;d++)c.setUint8(d,b.getUint8(7-d));return c.GetUint64(0)}
function getInternetExplorerVersion(){return 0<=navigator.userAgent.indexOf("MSIE ")||navigator.userAgent.match(/Trident.*rv\:11\./)?11:-1}function idiv(c,b){return(c-c%b)/b}function isNumber(c){return!isNaN(parseInt(c,10))}CB.setFlag=function(c,b,d){if("number"!=typeof b)throw Error("CB.setFlag: number expected for bits");void 0===c.flags&&(c.flags=0);c.flags=d?c.flags|b:c.flags&~b};CB.isFlag=function(c,b){return 0!=(c&b)};CB.namespace("CB.TimeTools");CB.TimeTools={};
CB.TimeTools.getCBTimeOfCentiSecs=function(c){c=new Date(10*c);return c.getUTCHours()<<24|c.getUTCMinutes()<<16|c.getUTCSeconds()<<8|c.getUTCMilliseconds()/10};"use strict";CB=CB||{};
CB.Timer=function(){var c=function(b){this.handler=b;this.active=!1};c.prototype.launch=function(b){this.runOnce(0,b)};c.prototype.runOnce=function(b,d){if(this.inHandler)this.fnAfterHandler=function(){this.runOnce(b,d)}.bind(this);else{if("undefined"==typeof b||null==b)b=5E3;d&&(this.handler=d);this.stop();this.isPeriodic=!1;this.active=!0;this.timeout=b;this.timer=window.setTimeout(this.timeoutHandler.bind(this),this.timeout);this.tick=new CB.Tick}};c.prototype.runPeriodic=function(b,d){d&&(this.handler=
d);this.stop();this.active=this.isPeriodic=!0;this.timeout=b||5E3;this.timer=window.setInterval(this.timeoutHandler.bind(this),this.timeout);this.tick=new CB.Tick};c.prototype.restart=function(){this.active&&(this.stop(),this.active=!0,this.timer=this.isPeriodic?window.setInterval(this.timeoutHandler.bind(this),this.timeout):window.setTimeout(this.timeoutHandler.bind(this),this.timeout),this.tick=new CB.Tick)};c.prototype.getExpiredMS=function(){return this.tick?this.tick.getExpiredMS():0};c.prototype.stop=
function(){this.isPeriodic?window.clearInterval(this.timer):window.clearTimeout(this.timer);this.active=!1};c.prototype.isActive=function(){return this.active};c.prototype.timeoutHandler=function(){this.inHandler=!0;this.handler&&this.handler();this.inHandler=!1;this.active=this.isPeriodic;this.fnAfterHandler&&(this.fnAfterHandler(),delete this.fnAfterHandler)};c.prototype.getTimeoutMs=function(){return this.timeout?this.timeout:0};c.busyWait=function(b){for(b+=(new Date).getTime();new Date<b;);};
c.launch=function(b,d){d=d||100;(new CB.Timer).runOnce(d,b)};return c}();CB.hasHiResTimer=window.performance&&window.performance.now;
CB.Tick=function(){var c=function(){this.start()};c.prototype.start=function(){this.ticker=CB.hasHiResTimer?window.performance.now():(new Date).valueOf()};c.prototype.getExpired=function(){return CB.hasHiResTimer?Math.round(100*(window.performance.now()-this.ticker))/100:(new Date).valueOf()-this.ticker};c.prototype.logTime=function(b){var d="";b&&(d=b+": ");d+=this.getExpired()+"ms";this.start();return d};c.prototype.getExpiredMS=function(){return Math.round(this.getExpired())};return c}();
CB.getTick=function(){return CB.hasHiResTimer?Math.round(window.performance.now()):(new Date).valueOf()};CB.getHiResTick=function(){return CB.hasHiResTimer?window.performance.now():(new Date).valueOf()};
CB.TimeSpan=function(){var c=function(b){this.autoRestart=void 0!==b?b:!0;this.start()};c.prototype.start=function(){this.tick=(new Date).valueOf()};c.prototype.isElapsed=function(b){return this.getElapsedMilliSecs()>1E3*b?(this.autoRestart&&this.start(),!0):!1};c.prototype.getElapsedMilliSecs=function(){return(new Date).valueOf()-this.tick};return c}();
CB.Vr=function(){var c=function(){};c.prototype.exec=function(b,d){this.timer&&this.timer.stop();this.timer=new CB.Timer(b);this.milliSecs=d;this.timer.runOnce(d)};c.prototype.isActive=function(){return this.timer&&this.timer.isActive()};c.prototype.stop=function(){this.timer&&this.timer.stop()};c.prototype.restart=function(){this.isActive()&&(this.timer.stop(),this.timer.runOnce(this.milliSecs||1E3))};return c}();"use strict";
CB.Date=function(){var c=function(b,d,e){b&&(this.year=b);d&&(this.month=d);e&&(this.day=e)};c.prototype.year=0;c.prototype.month=0;c.prototype.day=0;c.prototype.toString=function(){return String.formatEx("{day}.{month}.{year}",this)};c.g_regexPGN=/(?:(\d{4})|\?{4})\.(?:(\d{2})|\?{2})\.(?:(\d{2})|\?{2})/;c.fromPGNString=function(b){return(b=c.g_regexPGN.exec(b))?new c(Number(b[1]),Number(b[2]),Number(b[3])):new c};c.prototype.constructFromNum=function(b){this.year=b>>9;this.month=b>>5&15;this.day=
b&31};c.prototype.setToday=function(){var b=new Date;this.year=b.getFullYear();this.month=b.getMonth()+1;this.day=b.getDate()};c.today=function(){var b=new CB.Date;b.setToday();return b};c.prototype.getNum=function(){return this.year<<9|this.month<<5|this.day};c.prototype.fromDataBuf=function(b){b=b.V10();this.constructFromNum(b)};c.prototype.Vz=function(b){b.Vx(this.year<<9|this.month<<5|this.day)};c.prototype.toLocaleString=function(){var b="";this.year&&(b=this.year.toString(),this.month&&(b=this.month.toString()+
"."+b,10>this.month&&(b="0"+b),this.day&&(b=this.day.toString()+"."+b,10>this.day&&(b="0"+b))));return b};c.prototype.toPGNString=function(){var b="";if(this.year){b=this.year.toString();if(this.month){var d=this.month.toString();10>this.month&&(d="0"+d);b+="."+d}else b+=".??";this.day?(d=this.day.toString(),10>this.day&&(d="0"+d),b+="."+d):b+=".??"}return b};c.prototype.getDay=function(){return this.day};c.prototype.setDay=function(b){this.day=b};c.prototype.getMonth=function(){return this.month};
c.prototype.setMonth=function(b){this.month=b};c.prototype.getYear=function(){return this.year};c.prototype.setYear=function(b){this.year=b};c.getThisYear=function(){var b=new CB.Date;b.setToday();return b.getYear()};return c}();"use strict";CB.Time=function(){var c=function(b){this.time=b};c.prototype.time=0;return c}();CB.DateAndTime=function(){var c=function(){this.timeVal=0};c.prototype.Vz=function(b){b.Vt(this.timeVal)};c.prototype.fromDataBuf=function(b){b.Vy(this.timeVal)};return c}();
function CBGuid(){this.uint16Data3=this.uint16Data2=this.uint32Data1=0;this.uint8Data4=[0,0,0,0,0,0,0,0]}
CBGuid.prototype={fromRandom:function(c){var b=0;if(void 0!==c)for(var d=0;d<c.length;d++)b+=c.charCodeAt(d);this.uint32Data1=Math.floor(4294967296*Math.random()+b);this.uint16Data2=Math.floor(65536*Math.random()+b);this.uint16Data3=Math.floor(65536*Math.random()+b);for(d=0;8>d;d++)this.uint8Data4[d]=Math.floor(256*Math.random()+b)},toString:function(){for(var c=this.uint32Data1.toString(16)+"-"+this.uint16Data2.toString(16)+"-"+this.uint16Data3.toString(16)+"-",b=0;2>b;b++)c+=this.uint8Data4[b].toString(16);
c+="-";for(b=2;8>b;b++)c+=this.uint8Data4[b].toString(16);return c},Vz:function(c){c.Vh(this.uint32Data1);c.Vi(this.uint16Data2);c.Vi(this.uint16Data3);for(var b=0;8>b;b++)c.writeUint8(this.uint8Data4[b])},fromDataBuf:function(c){this.uint32Data1=c.Vw();this.uint16Data2=c.Vi();this.uint16Data3=c.Vi();for(var b=0;8>b;b++)this.uint8Data4[b]=c.readUint8()}};"use strict";
CB.NAT={NONE:0,AFG:1,ALB:2,ALG:3,AND:4,ANG:5,ANT:6,ARG:7,ARM:8,AUS:9,AUT:10,AZE:11,BAH:12,BHN:13,BAN:14,BAR:15,BLR:16,BEL:17,BLZ:18,BER:19,BOL:20,BIH:21,BOT:22,BRA:23,IVB:24,BRN:25,BUL:26,BUR:27,CAN:28,CHI:29,CHN:30,COL:31,CRI:32,CRO:33,CUB:34,CYP:35,CZE:36,DEN:37,DJI:38,DOM:39,ECU:40,EGY:41,ENG:42,ESP:43,EST:44,ETH:45,FAI:46,FIJ:47,FIN:48,FRA:49,MKD:50,GAM:51,GEO:52,GER:53,GHA:54,GRE:55,GUA:56,GCI:57,GUY:58,HAI:59,HON:60,HKG:61,HUN:62,ISL:63,IND:64,INA:65,IRI:66,IRQ:67,ISR:68,IRL:69,ITA:70,IVO:71,
JAM:72,JPN:73,JCI:74,JOR:75,KAZ:76,KEN:77,KOR:78,KYR:79,KUW:80,LAT:81,LBN:82,LBY:83,LIE:84,LTU:85,LUX:86,MAC:87,MAD:88,MAS:89,MLI:90,MLT:91,MAU:92,MRI:93,MEX:94,MDA:95,MNC:96,MON:97,MAR:98,MOZ:99,MYA:100,NAM:101,NEP:102,NED:103,AHO:104,NZL:105,NCA:106,NGR:107,NOR:108,PAK:109,PLE:110,PAN:111,PNG:112,PAR:113,PER:114,PHI:115,POL:116,POR:117,PUR:118,QAT:119,ROU:120,RUS:121,ESA:122,SMR:123,SCO:124,SEN:125,SEY:126,SIN:127,SVK:128,SLO:129,RSA:130,SRI:131,SUD:132,SUR:133,SWE:134,SUI:135,SYR:136,TJK:137,TAN:138,
THA:139,TRI:140,TUN:141,TUR:142,TKM:143,UGA:144,UKR:145,UAE:146,USA:147,URU:148,URS:149,UZB:150,VEN:151,VIE:152,ISV:153,WLS:154,YEM:155,YUG:156,ZAM:157,ZIM:158,ZRE:159,DDR:160,CSR:161,CAM:162,CHD:163,KAP:164,KBA:165,COM:166,CON:167,NKO:168,LAO:169,LES:170,MWI:171,MDV:172,MSH:173,OMN:174,NAU:175,MIC:176,NIG:177,SAU:178,TOG:179,TON:180,VAN:181,VAT:182,TUV:183,SWA:184,SIE:185,SLU:186,PAP:187,SVI:188,SAM:189,SKI:190,SAL:191,GE2:192,ZAR:193,RWA:194,LBR:195,NET:196,TPE:197,ASU:198,AGG:199,ARN:200,BNN:201,
BTN:202,BRI:203,CMB:204,CAY:205,CAR:206,CIB:207,CIA:208,COA:209,CIN:210,ELG:211,ERI:212,FGB:213,FRG:214,FRP:215,GAB:216,GGB:217,GRA:218,GRL:219,FGA:220,GMA:221,GUI:222,GUB:223,IOM:224,JMY:225,MFR:226,MYF:227,MSG:228,NCF:229,NNN:230,NNA:231,NMI:232,OTM:233,PAL:234,PIG:235,RUF:236,SAO:237,SOM:238,SVN:239,HGB:240,PGB:241,TKI:242,TCI:243,WFR:244,NIR:245,ISS:246,GBR:247,SAA:248,MNE:249,SRB:250,CAT:251,BAS:252,KOS:253,NUM:254};
CB.Nation=function(){var c=[];c[CB.NAT.NONE]="United Nations";c[CB.NAT.AFG]="Afghanistan";c[CB.NAT.ALB]="Albania";c[CB.NAT.ALG]="Algeria";c[CB.NAT.ASU]="American samoa";c[CB.NAT.AND]="Andorra";c[CB.NAT.ANG]="Angola";c[CB.NAT.AGG]="Anguilla";c[CB.NAT.ANT]="Antigua and Barbuda";c[CB.NAT.ARG]="Argentina";c[CB.NAT.ARM]="Armenia";c[CB.NAT.ARN]="Aruba";c[CB.NAT.AUS]="Australia";c[CB.NAT.AUT]="Austria";c[CB.NAT.AZE]="Azerbaijan";c[CB.NAT.BAH]="Bahamas";c[CB.NAT.BHN]="Bahrain";c[CB.NAT.BAN]="Bangladesh";
c[CB.NAT.BAR]="Barbados";c[CB.NAT.BAS]="Basque Country";c[CB.NAT.BLR]="Belarus";c[CB.NAT.BEL]="Belgium";c[CB.NAT.BLZ]="Belize";c[CB.NAT.BNN]="Benin";c[CB.NAT.BER]="Bermuda";c[CB.NAT.BTN]="Bhutan";c[CB.NAT.BOL]="Bolivia";c[CB.NAT.BIH]="Bosnia and Herzegovina";c[CB.NAT.BOT]="Botswana";c[CB.NAT.BRA]="Brazil";c[CB.NAT.IVB]="Virgin Islands British";c[CB.NAT.ISV]="Virgin Islands US";c[CB.NAT.BRN]="Brunei";c[CB.NAT.BUL]="Bulgaria";c[CB.NAT.BUR]="Burkina faso";c[CB.NAT.BRI]="Burundi";c[CB.NAT.CMB]="Cambodja";
c[CB.NAT.CAM]="Cameroon";c[CB.NAT.CAN]="Canada";c[CB.NAT.KAP]="Cape verde";c[CB.NAT.CAY]="Cayman Islands";c[CB.NAT.CAR]="Central African Republic";c[CB.NAT.CAT]="Catalonia";c[CB.NAT.CHD]="Chad";c[CB.NAT.CIB]="Jersey";c[CB.NAT.CHI]="Chile";c[CB.NAT.CHN]="China";c[CB.NAT.CIA]="Christmas";c[CB.NAT.COA]="Cocos (Keeling)";c[CB.NAT.COL]="Colombia";c[CB.NAT.COM]="Comoros";c[CB.NAT.CON]="Congo-Brazzaville";c[CB.NAT.CIN]="Cook Islands";c[CB.NAT.CRI]="Costa Rica";c[CB.NAT.CRO]="Croatia";c[CB.NAT.CUB]="Cuba";
c[CB.NAT.CYP]="Cyprus";c[CB.NAT.CZE]="Czech Republic";c[CB.NAT.DEN]="Denmark";c[CB.NAT.DJI]="Djibouti";c[CB.NAT.DOM]="Dominican Republic";c[CB.NAT.ECU]="Ecuador";c[CB.NAT.ELG]="Equatorial Guinea";c[CB.NAT.EGY]="Egypt";c[CB.NAT.ENG]="England";c[CB.NAT.ERI]="Eritrea";c[CB.NAT.ESP]="Spain";c[CB.NAT.EST]="Estonia";c[CB.NAT.ETH]="Ethiopia";c[CB.NAT.FGB]="England";c[CB.NAT.FAI]="Faroes";c[CB.NAT.FIJ]="Fiji";c[CB.NAT.FIN]="Finland";c[CB.NAT.FRA]="France";c[CB.NAT.FRG]="Guyana";c[CB.NAT.FRP]="Tahiti(French Polinesia)";
c[CB.NAT.MKD]="Macedonia";c[CB.NAT.GAB]="Gabon";c[CB.NAT.GAM]="Gambia";c[CB.NAT.GEO]="Georgia";c[CB.NAT.GER]="Germany";c[CB.NAT.SAA]="Germany";c[CB.NAT.DDR]="Germany";c[CB.NAT.GE2]="Germany";c[CB.NAT.GHA]="Ghana";c[CB.NAT.GGB]="Gibraltar";c[CB.NAT.GRE]="Greece";c[CB.NAT.GRA]="Grenada";c[CB.NAT.GRL]="Greenland";c[CB.NAT.FGA]="Guadeloupe";c[CB.NAT.GMA]="Guam";c[CB.NAT.GUA]="Guatemala";c[CB.NAT.GUI]="Guinea";c[CB.NAT.GUB]="Guinea-Bissau";c[CB.NAT.GCI]="Guernsey";c[CB.NAT.GUY]="Guyana";c[CB.NAT.HAI]=
"Haiti";c[CB.NAT.HON]="Honduras";c[CB.NAT.HKG]="Hong Kong";c[CB.NAT.HUN]="Hungary";c[CB.NAT.ISL]="Iceland";c[CB.NAT.IND]="India";c[CB.NAT.INA]="Indonesia";c[CB.NAT.IRI]="Iran";c[CB.NAT.IRQ]="Iraq";c[CB.NAT.IOM]="Isle of MAN";c[CB.NAT.ISR]="Israel";c[CB.NAT.IRL]="Ireland";c[CB.NAT.ITA]="Italy";c[CB.NAT.IVO]="Cote d'Ivoire";c[CB.NAT.JAM]="Jamaica";c[CB.NAT.JMY]="Svalbard and Jan Mayen";c[CB.NAT.JPN]="Japan";c[CB.NAT.JCI]="Jersey";c[CB.NAT.JOR]="Jordan";c[CB.NAT.KAZ]="Kazakhstan";c[CB.NAT.KEN]="Kenya";
c[CB.NAT.KBA]="Kiribati";c[CB.NAT.KOR]="South Korea";c[CB.NAT.KYR]="Kyrgyzstan";c[CB.NAT.KUW]="Kuwait";c[CB.NAT.LAO]="Laos";c[CB.NAT.LAT]="Latvia";c[CB.NAT.LBN]="Lebanon";c[CB.NAT.LES]="Lesotho";c[CB.NAT.LBR]="Liberia";c[CB.NAT.LBY]="Libya";c[CB.NAT.LIE]="Liechtenstein";c[CB.NAT.LTU]="Lithuania";c[CB.NAT.LUX]="Luxembourg";c[CB.NAT.MAC]="Macao";c[CB.NAT.MAD]="Madagascar";c[CB.NAT.MAS]="Malaysia";c[CB.NAT.MLI]="Mali";c[CB.NAT.MLT]="Malta";c[CB.NAT.MWI]="Malawi";c[CB.NAT.MFR]="Martinique";c[CB.NAT.MAU]=
"Mauritania";c[CB.NAT.MRI]="Mauritius";c[CB.NAT.MYF]="Mayotte";c[CB.NAT.MEX]="Mexico";c[CB.NAT.MIC]="Micronesia";c[CB.NAT.MDA]="Moldova";c[CB.NAT.MNC]="Monaco";c[CB.NAT.MON]="Mongolia";c[CB.NAT.MSG]="Montserrat";c[CB.NAT.MAR]="Morocco";c[CB.NAT.MOZ]="Mozambique";c[CB.NAT.MYA]="Myanmar(Burma)";c[CB.NAT.NAM]="Namibia";c[CB.NAT.NEP]="Nepal";c[CB.NAT.NED]="Netherlands";c[CB.NAT.AHO]="Netherlands Antilles";c[CB.NAT.NCF]="New caledonia";c[CB.NAT.NET]="United Nations";c[CB.NAT.NZL]="New zealand";c[CB.NAT.NCA]=
"Nicaragua";c[CB.NAT.NGR]="Nigeria";c[CB.NAT.NNN]="Niue";c[CB.NAT.NNA]="Norfolk";c[CB.NAT.NMI]="Northern Mariana";c[CB.NAT.NOR]="Norway";c[CB.NAT.OTM]="Timor-Leste";c[CB.NAT.PAK]="Pakistan";c[CB.NAT.PAL]="Palau";c[CB.NAT.PLE]="Palestine";c[CB.NAT.PAN]="Panama";c[CB.NAT.PNG]="Papua new GUINEA";c[CB.NAT.PAR]="Paraguay";c[CB.NAT.PER]="Peru";c[CB.NAT.PHI]="Philippines";c[CB.NAT.PIG]="Pitcairn";c[CB.NAT.POL]="Poland";c[CB.NAT.POR]="Portugal";c[CB.NAT.PUR]="Puerto rico";c[CB.NAT.QAT]="Qatar";c[CB.NAT.RUF]=
"Reunion";c[CB.NAT.ROU]="Romania";c[CB.NAT.URS]="Russian Federation";c[CB.NAT.RUS]="Russian Federation";c[CB.NAT.ZAR]="Russian Federation";c[CB.NAT.ESA]="El Salvador";c[CB.NAT.SMR]="San Marino";c[CB.NAT.SAO]="Sao Tome and PRINCIPE";c[CB.NAT.SCO]="Scotland";c[CB.NAT.SEN]="Senegal";c[CB.NAT.YUG]="Serbia(Yugoslavia)";c[CB.NAT.SRB]="Serbia(Yugoslavia)";c[CB.NAT.SEY]="Seychelles";c[CB.NAT.SIN]="Singapore";c[CB.NAT.SVK]="Slovakia";c[CB.NAT.SLO]="Slovenia";c[CB.NAT.SOM]="Somalia";c[CB.NAT.RSA]="South africa";
c[CB.NAT.SRI]="Sri lanka";c[CB.NAT.SUD]="Sudan";c[CB.NAT.SUR]="Suriname";c[CB.NAT.SVN]="Svalbard and Jan Mayen";c[CB.NAT.SWE]="Sweden";c[CB.NAT.SUI]="Switzerland";c[CB.NAT.SYR]="Syria";c[CB.NAT.HGB]="Saint Helena";c[CB.NAT.PGB]="Saint Pierre and Miquelon";c[CB.NAT.TJK]="Tajikistan";c[CB.NAT.TAN]="Tanzania";c[CB.NAT.THA]="Thailand";c[CB.NAT.TKI]="Tokelau";c[CB.NAT.TRI]="Trinidad and Tobago";c[CB.NAT.TUN]="Tunisia";c[CB.NAT.TCI]="Turks and Caicos Islands";c[CB.NAT.TUR]="Turkey";c[CB.NAT.TKM]="Turkmenistan";
c[CB.NAT.UGA]="Uganda";c[CB.NAT.UKR]="Ukraine";c[CB.NAT.UAE]="United Arab Emirates";c[CB.NAT.USA]="United States of America";c[CB.NAT.URU]="Uruguay";c[CB.NAT.UZB]="Uzbekistan";c[CB.NAT.VEN]="Venezuela";c[CB.NAT.VIE]="Viet Nam";c[CB.NAT.WLS]="Wales";c[CB.NAT.WFR]="Wallis and Futuna";c[CB.NAT.YEM]="Yemen";c[CB.NAT.ZAM]="Zambia";c[CB.NAT.ZIM]="Zimbabwe";c[CB.NAT.ZRE]="Congo-Kinshasa(Zaire)";c[CB.NAT.NKO]="North korea";c[CB.NAT.MDV]="Maldives";c[CB.NAT.MSH]="Marshall Islands";c[CB.NAT.OMN]="Oman";c[CB.NAT.NAU]=
"Nauru";c[CB.NAT.NIG]="Niger";c[CB.NAT.SAU]="Saudi Arabia";c[CB.NAT.TOG]="Togo";c[CB.NAT.TON]="Tonga";c[CB.NAT.VAN]="Vanuatu";c[CB.NAT.VAT]="Vatican City";c[CB.NAT.TUV]="Tuvalu";c[CB.NAT.SWA]="Swaziland";c[CB.NAT.SIE]="Sierra Leone";c[CB.NAT.SLU]="Saint Lucia";c[CB.NAT.PAP]="Papua New Guinea";c[CB.NAT.SVI]="St Vincent and The Grenadines";c[CB.NAT.SAM]="Samoa";c[CB.NAT.SKI]="St Kitts and NEVIS";c[CB.NAT.SAL]="Solomon islands";c[CB.NAT.RWA]="Rwanda";c[CB.NAT.TPE]="Taiwan";c[CB.NAT.NIR]="Northern Ireland";
c[CB.NAT.GBR]="United Kingdom(Great Britain)";c[CB.NAT.KOS]="Kosovo";var b=[],d=function(d){this.n=d;void 0===this.n&&(this.n=CB.NAT.NONE);if(0==b.length){d=0;for(var f in CB.NAT)CB.NAT.hasOwnProperty(f)&&(b[d]=f,d+=1);for(f=0;f<b.length;f++){var g=c[f];void 0===g&&(g=c[0]);d=b[f];1<d.length&&(g=window.escape(g),g=" background-image: url( "+CB.getCommonPath()+"media/flags/flags16/"+g+".png ) !important;",CB.CSS.addRules(".cls-"+d,g+"background-repeat:no-repeat; background-position:center center;"))}}};
d.prototype.getStrCode=function(){return b[this.n]};d.prototype.getStrFlag=function(){return c[this.n]?c[this.n]:c[CB.NAT.NONE]};return d}();"use strict";
CB.System={getStrOS:function(){this.strOS||(this.getiOSVersion()&&(this.strOS="iOS"+this.getiOSVersion()),this.getAndroidVersion()&&(this.strOS="Andr"+this.getAndroidVersion()),this.isWindows()&&(this.strOS="Win"),this.isLinux()&&(this.strOS="Ux"),this.isMac()&&(this.strOS="Mac"),this.strOS=navigator.platform);return this.strOS},getOSChar:function(){var c="X";this.isWindows()?c="W":this.isMac()?c="M":this.isIPhone()||this.isIPad()?c="I":this.isAndroid()?c="A":this.isLinux()&&(c="L");return c},getStrSysInfo:function(){return this.getStrOS()+
" "+String.f("{0}/{1}/{2}, cpus={3}",window.innerWidth,window.innerHeight,window.devicePixelRatio,this.getNCpus())},isCordova:function(){return"cordova"===CB.strUtil.getURLParam("client")||!!window.cordova},isMobile:function(){4;return/Kindle|Silk|KFAPW|KFARWI|KFASWI|KFFOWI|KFJW|KFMEWI|KFOT|KFSAW|KFSOWI|KFTBW|KFTHW|KFTT|WFFOWI/i.test(navigator.userAgent)?!0:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|bada|Opera Mini/i.test(navigator.userAgent)},isDesktop:function(){return!CB.System.isMobile()&&
1400<screen.width&&900<=screen.height},isElectron:function(){return-1<navigator.userAgent.toLowerCase().indexOf(" electron/")},requestFullScreen:function(){var c=document.documentElement;c.requestFullscreen?c.requestFullscreen():c.webkitrequestFullscreen?c.webkitrequestFullscreen():c.mozrequestFullscreen?c.mozrequestFullscreen():c.msrequestFullscreen&&c.msrequestFullscreen()},isFullScreen:function(){return document.fullscreen||document.webkitIsFullScreen||document.mozFullScreen||(screen.availHeight||
screen.height-30)<=window.innerHeight},isAtLeastTablet:function(){7;return 1E3<=screen.width&&760<=screen.height||1E3<=screen.height},isIPhone:function(){return/iPhone/i.test(navigator.userAgent)||/iPod/i.test(navigator.userAgent)},isIPad:function(){return/iPad/i.test(navigator.userAgent)},getiOSVersion:function(){return parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1},
isWindows:function(){return/Win32/i.test(navigator.platform)},isLinux:function(){return/Linux/i.test(navigator.platform)},isMac:function(){return/Mac/i.test(navigator.platform)},isTouchDevice:function(){void 0===this.isTouchChecked&&(this.isTouchChecked=this.isMobile()||"ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints);return this.isTouchChecked},runsInIFrame:function(){try{return window.self!==window.top&&-1==document.referrer.search(/google/i)&&-1==document.referrer.search(/bing/i)}catch(c){return!0}},
getWindowPos:function(){if(void 0!==window.screenLeft)return new CB.Point(window.screenLeft,window.screenTop);if(void 0!==window.screenX)return new CB.Point(window.screenX,window.screenY)},getWindowSize:function(){var c=window,b=document,d=b.documentElement,b=b.getElementsByTagName("body")[0];return new CB.Size(c.innerWidth||d.clientWidth||b.clientWidth,c.innerHeight||d.clientHeight||b.clientHeight)},getTimeZone:function(){return String(String(new Date).split("(")[1]).split(")")[0]},isHighResScreen:function(){return 1400<=
screen.width&&900<=screen.height},isPortraitScreen:function(c){return screen.width*(c||1)<screen.height},getLanguage:function(){return navigator.language},getSystemLanguage:function(){return navigator.systemLanguage||window.navigator.language},getWindowsCodePage:function(){if(document.inputEncoding)switch(document.inputEncoding){default:return 1252;case "ISO-8859-11":return 874;case "Windows-31J":return 932;case "ISO-8859-2":return 1250;case "ISO-8859-5":return 1251;case "ISO-8859-1":return 1252;
case "ISO-8859-7":return 1253;case "ISO-8859-9":return 1254;case "ISO-8859-8":return 1255;case "ISO-8859-6":return 1256;case "ISO-8859-13":return 1257}else return 1252},getInternetExplorerVersion:function(){var c=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(c=parseFloat(RegExp.$1));return c},useExtJSTouchCSS:function(){return this.isMobile()||this.isTouchDevice()},isBrowserOk:function(){return void 0!==Function.prototype.bind&&
"undefined"!==typeof console&&"WebSocket"in window?11<=this.getIEVersion()?!0:this.isAndroidBrowser()&&4.2>=this.getAndroidVersion()||this.isSafariOnWindows()&&535>this.getSafariVersion()&&!this.isChrome()?!1:!0:!1},isHTTPS:function(){return document.location&&document.location.protocol?"http:"!=document.location.protocol:window.location&&window.location.protocol?"http:"!=window.location.protocol:!1},getIEVersion:function(){var c=window.navigator.userAgent,b=c.indexOf("MSIE ");if(0<b)return parseInt(c.substring(b+
5,c.indexOf(".",b)),10);if(0<c.indexOf("Trident/"))return b=c.indexOf("rv:"),parseInt(c.substring(b+3,c.indexOf(".",b)),10);b=c.indexOf("Edge/");if(0<b)return parseInt(c.substring(b+5,c.indexOf(".",b)),10)},getFirefoxVersion:function(){var c=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return c?parseInt(c[1]):0},isNonCrossDomainIE:function(){var c=this.getIEVersion();return c?12>c:!1},canRunWebAssembly:function(){return"object"===typeof WebAssembly},isActivexEnabled:function(){var c=null;
try{c=!!new ActiveXObject("htmlfile")}catch(b){c=!1}return c},isWebKit:function(){return null!=window.webkitURL},isChrome:function(){return-1!=navigator.userAgent.indexOf("Chrome")},isSafari:function(){return-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&-1==navigator.userAgent.indexOf("CriOS")},isFirefox:function(){return-1!=navigator.userAgent.indexOf("Firefox")},isIE:function(){return 0<this.getIEVersion()},isOldIE:function(){return 0<this.getIEVersion()&&
12>this.getIEVersion()},browserIsSafeForEngine:function(c){var b=this.getIEVersion(),d=this.getFirefoxVersion(),e=parseFloat(this.getSafariVersion()),b=this.isChrome()||11<=b||54<=d||600<e||CB.System.canRunWebAssembly();return b=CB.System.getNCpus()?b&&CB.System.getNCpus()>=(c||6):b&&!CB.System.isMobile()},isAndroidBrowser:function(){return 0<=navigator.userAgent.indexOf("Android")&&-1==navigator.userAgent.indexOf("Chrome")},isAndroid:function(){return 0<this.getAndroidVersion()},isSafariOnWindows:function(){return 0<=
navigator.userAgent.indexOf("Windows")&&0<=navigator.userAgent.indexOf("Safari")},getSafariVersion:function(){var c=navigator.userAgent;return 0<=c.indexOf("Safari")?parseFloat(c.slice(c.indexOf("Safari")+7)):0},copyToClipboard:function(c){if(navigator.clipboard)navigator.clipboard.writeText(c);else{var b=document.createElement("textarea");b.value=c;document.body.appendChild(b);b.focus();b.select();try{document.execCommand("copy")}catch(d){}document.body.removeChild(b)}},getAndroidVersion:function(){var c=
navigator.userAgent;return 0<=c.indexOf("Android")?parseFloat(c.slice(c.indexOf("Android")+8)):0},isWebGlCapable:function(c){if(window.WebGLRenderingContext)for(var b=document.createElement("canvas"),d=["webgl","experimental-webgl","moz-webgl","webkit-3d"],e=!1,f=0;4>f;f++)try{if((e=b.getContext(d[f]))&&"function"==typeof e.getParameter)return c?{name:d[f],gl:e}:!0}catch(g){}return!1},runsOnChessBaseDomain:function(){return-1!=document.URL.search(/chessbase.com/i)&&-1==document.URL.search(/cloudserver/i)||
-1!=document.URL.search(/playchess.com/i)||-1!=document.URL.search(/schach.de/i)},runsOnChessBaseCom:function(){return-1!=document.URL.search(/chessbase.com/i)},runsOnLiveChessBaseCom:function(){return-1!=document.URL.search(/live.chessbase.com/i)||-1!=document.URL.search(/acc.chessbase.com/i)},runsOnVideosChessBaseCom:function(){return-1!=document.URL.search(/videos.chessbase.com/i)||-1!=document.URL.search(/videostest.chessbase.com/i)},getDevicePixelRatio:function(){return window.devicePixelRatio},
overrideDeviceZoom:function(c){this.overriddenDeviceZoom=c},pixToZoom:function(c){return this.overriddenDeviceZoom?c/this.overriddenDeviceZoom:window.devicePixelRatio?c/window.devicePixelRatio:c},zoomToPix:function(c){return this.overriddenDeviceZoom?c*this.overriddenDeviceZoom:window.devicePixelRatio?c*window.devicePixelRatio:c},getNCpus:function(){return window.navigator.hardwareConcurrency?window.navigator.hardwareConcurrency:0},getDeviceMemory:function(){return navigator.deviceMemory?navigator.deviceMemory:
0},getHardwareId:function(){return this.getDeviceMemory()+navigator.platform+this.getNCpus()+this.getSystemLanguage()+this.getTimeZone()+screen.width+this.getDevicePixelRatio()+screen.height},browser:{detect:function(){return{browser:this.search(this.data.browser),version:this.search(navigator.userAgent)||this.search(navigator.appVersion),os:this.search(this.data.os)}},search:function(c){if("object"===typeof c)for(var b=0;b<c.length;b++){var d=c[b].string,e=c[b].prop;this.version_string=c[b].versionSearch||
c[b].identity;if(d){if(-1!=d.indexOf(c[b].subString))return c[b].identity}else if(e)return c[b].identity}else if(b=c.indexOf(this.version_string),-1!=b)return parseFloat(c.substr(b+this.version_string.length+1))},data:{browser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",
versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},
{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}};"use strict";
CB.Language={ENG:0,DEU:1,GER:1,FRA:2,ESP:3,ITA:4,NED:5,POR:6,DEF:7,SLO:8,SWE:9,BAS:10,SVK:11,POL:12,CZE:13,CAT:14,TRK:15,MGY:16,RUS:17,GRK:18,ROM:19,CHN:20,UN:21,NOR:22,HEB:23,UKR:24,VIE:25,ARA:26,SER:27,LIT:28,BRA:29,FAR:30,CRO:31,GAL:32,HIN:33,getStrUserLanguage:function(){return void 0!==navigator.languages&&navigator.languages.length?navigator.languages[0]:void 0!==navigator.language?navigator.language:void 0!==navigator.userLanguage?navigator.userLanguage:"en-en"},getStrUserLanguageTwoChars:function(){return this.getStrUserLanguage().slice(0,
2)},getUserLanguageId:function(){var c=CB.Language.getStrUserLanguage();return this.getLanguageIdOfParam(c)},getLanguageIdOfParam:function(c){return-1<c.indexOf("de")?this.DEU:-1<c.indexOf("es")?this.ESP:-1<c.indexOf("nl")?this.NED:-1<c.indexOf("fr")?this.FRA:-1<c.indexOf("it")?this.ITA:-1<c.indexOf("sl")?this.SLO:-1<c.indexOf("sv")?this.SWE:-1<c.indexOf("ro")?this.ROM:-1<c.indexOf("zh")?this.CHN:-1<c.indexOf("ru")?this.RUS:-1<c.indexOf("no")?this.NOR:-1<c.indexOf("pl")?this.POL:-1<c.indexOf("he")?
this.HEB:-1<c.indexOf("ca")?this.CAT:-1<c.indexOf("tr")?this.TRK:-1<c.indexOf("sl")?this.SLO:-1<c.indexOf("el")?this.GRK:-1<c.indexOf("uk")?this.UKR:-1<c.indexOf("vi")?this.VIE:-1<c.indexOf("ar")?this.ARA:-1<c.indexOf("sr")?this.SER:-1<c.indexOf("lt")?this.LIT:-1<c.indexOf("pt-br")||-1<c.indexOf("pt")?this.BRA:-1<c.indexOf("fa")?this.FAR:-1<c.indexOf("ga")?this.GAL:-1<c.indexOf("hr")?this.CRO:-1<c.indexOf("hi")?this.HIN:-1<c.indexOf("cs")?this.CZE:this.ENG},getParamOfLanguageId:function(c){switch(c){default:case CB.Language.ENG:return"en";
case CB.Language.DEU:return"de";case CB.Language.ESP:return"es";case CB.Language.NED:return"nl";case CB.Language.FRA:return"fr";case CB.Language.ITA:return"it";case CB.Language.POR:return"pt";case CB.Language.SLO:return"sl";case CB.Language.SWE:return"sv";case CB.Language.ROM:return"ro";case CB.Language.CHN:return"zh";case CB.Language.RUS:return"ru";case CB.Language.NOR:return"no";case CB.Language.POL:return"pl";case CB.Language.HEB:return"he";case CB.Language.CAT:return"ca";case CB.Language.TRK:return"tr";
case CB.Language.SLO:return"sl";case CB.Language.GRK:return"el";case CB.Language.UKR:return"uk";case CB.Language.VIE:return"vi";case CB.Language.ARA:return"ar";case CB.Language.SER:return"sr";case CB.Language.LIT:return"lt";case CB.Language.BRA:return"pt";case CB.Language.FAR:return"fa";case CB.Language.CRO:return"hr";case CB.Language.GAL:return"ga";case CB.Language.HIN:return"hi";case CB.Language.CZE:return"cs"}},getHelpParamOfLanguageId:function(c){switch(c){default:case CB.Language.ENG:return"en";
case CB.Language.DEU:return"de";case CB.Language.ESP:return"es";case CB.Language.FRA:return"fr";case CB.Language.NED:return"nl";case CB.Language.ITA:return"it"}},getRibbonFlagName:function(c){switch(c){default:case CB.Language.ENG:return"en-us"==this.getStrUserLanguage()?"us":"gb";case CB.Language.DEU:return"de-at"==this.getStrUserLanguage()?"at":"de";case CB.Language.ESP:return"es";case CB.Language.NED:return"nl";case CB.Language.ROM:return"ro";case CB.Language.CHN:switch(this.getStrUserLanguage()){default:case "zh-cn":return"cn";
case "zh-tw":return"tw";case "zh-sg":return"si";case "zh-hk":return"hk"}case CB.Language.FRA:return"fr";case CB.Language.RUS:return"ru";case CB.Language.NOR:return"no";case CB.Language.ITA:return"it";case CB.Language.POL:return"pl";case CB.Language.UN:return"_United_Nations";case CB.Language.HEB:return"il";case CB.Language.CAT:return"_Catalonia";case CB.Language.TRK:return"tr";case CB.Language.SLO:return"si";case CB.Language.GRK:return"gr";case CB.Language.UKR:return"ua";case CB.Language.VIE:return"vn";
case CB.Language.ARA:return"sa";case CB.Language.SER:return"rs";case CB.Language.LIT:return"lt";case CB.Language.BRA:return"br";case CB.Language.FAR:return"ir";case CB.Language.CRO:return"hr";case CB.Language.GAL:return"ie";case CB.Language.HIN:return"in";case CB.Language.CZE:return"cz"}}};
CB.Language.getInternalName=function(c){switch(c){default:case CB.Language.ENG:return"ENG";case CB.Language.DEU:case CB.Language.GER:return"GER";case CB.Language.ESP:return"ESP";case CB.Language.NED:return"NED";case CB.Language.ROM:return"ROM";case CB.Language.CHN:return"CHN";case CB.Language.FRA:return"FRA";case CB.Language.RUS:return"RUS";case CB.Language.NOR:return"NOR";case CB.Language.POL:return"POL";case CB.Language.ITA:return"ITA";case CB.Language.HEB:return"HEB";case CB.Language.CAT:return"CAT";
case CB.Language.TRK:return"TRK";case CB.Language.SLO:return"SLO";case CB.Language.UN:return"UN";case CB.Language.GRK:return"EL";case CB.Language.UKR:return"UKR";case CB.Language.VIE:return"VIE";case CB.Language.ARA:return"ARA";case CB.Language.SER:return"SER";case CB.Language.LIT:return"LIT";case CB.Language.BRA:return"BRA";case CB.Language.FAR:return"FAR";case CB.Language.CRO:return"CRO";case CB.Language.GAL:return"GAL";case CB.Language.HIN:return"HIN";case CB.Language.CZE:return"CZE"}};
CB.Language.getNativeLangName=function(c){switch(c){default:case CB.Language.ENG:return"English";case CB.Language.DEU:return"Deutsch";case CB.Language.ESP:return"Espa\u00f1ol";case CB.Language.NED:return"Nederlands";case CB.Language.ROM:return"Rom\u00e2n";case CB.Language.CHN:return"\u4e2d\u6587";case CB.Language.FRA:return"Fran\u00e7ais";case CB.Language.RUS:return"\u0420\u0443\u0441\u0441\u043a\u0438\u0439";case CB.Language.NOR:return"Norsk";case CB.Language.POL:return"Polski";case CB.Language.ITA:return"Italiano";
case CB.Language.HEB:return"\u05e2\u05d1\u05e8\u05d9\u05ea";case CB.Language.CAT:return"Catal\u00e0";case CB.Language.TRK:return"T\u00fcrk\u00e7e";case CB.Language.SLO:return"Slovenski";case CB.Language.GRK:return"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac";case CB.Language.UKR:return"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430";case CB.Language.VIE:return"Ti\u1ebfng Vi\u1ec7t";case CB.Language.ARA:return"\u0627\u0644\u0639\u0631\u0628\u064a\u0629";case CB.Language.SER:return"Srbski";
case CB.Language.LIT:return"Lietuvi\u0173";case CB.Language.BRA:return"Portugu\u00eas";case CB.Language.FAR:return"\u0641\u0627\u0631\u0633\u06cc";case CB.Language.CRO:return"Hrvatski";case CB.Language.GAL:return"Gaeilge";case CB.Language.HIN:return"\u0939\u093f\u0928\u094d\u0926\u0940";case CB.Language.CZE:return"\u010ce\u0161tina"}};CB.Language.getNativeLangNames=function(c){var b=[];c.forEach(function(d){b.push(this.getNativeLangName(d))}.bind(this));return b};
CB.Language.getFlagNames=function(c){var b=[];c.forEach(function(d){b.push(this.getRibbonFlagName(d))}.bind(this));return b};"use strict";
CB.GeoCoordinates=function(){var c=function(b,e){this.fLat=b;this.fLong=e;this.nNation=this.fHeight=0},b=function(b){return Math.PI/180*b};c.prototype={isValid:function(){return 0!=this.fLat||0!=this.fLong},toString:function(){return""},fromDataBuf:function(b){this.fLat=b.readFloat32();this.fLong=b.readFloat32();this.nNation=b.V10()},Vz:function(b){b.writeFloat32(this.fLat);b.writeFloat32(this.fLong);b.Vx(this.nNation)},getSphericDist:function(d){return this.fLat==d.fLat&&this.fLong==d.fLong?0:6378*
Math.acos(Math.sin(b(this.fLat))*Math.sin(b(d.fLat))+Math.cos(b(this.fLat))*Math.cos(b(d.fLat))*Math.cos(b(d.fLong-this.fLong)))},getAzimuthDirection:function(d){return-Math.atan2(Math.sin(b(this.fLong-d.fLong))*Math.cos(b(this.fLat)),Math.cos(b(this.fLat))*Math.sin(b(d.fLat))-Math.sin(b(this.fLat))*Math.cos(b(d.fLat))*Math.cos(b(this.fLong-d.fLong)))},getNewPoint:function(d,e){var c=d/6378,g=Math.acos(Math.cos(c)*Math.cos(b(90-this.fLat))+Math.sin(b(90-this.fLat))*Math.sin(c)*Math.cos(b(e))),c=Math.asin(Math.sin(c)*
Math.sin(b(e))/Math.sin(g));return new CB.GeoCoordinates(90-g/(Math.PI/180),c/(Math.PI/180)+this.fLon)},fromBrowser:function(){navigator.geolocation.getCurrentPosition(function(b){this.fLat=b.coords.latitude;this.fLong=b.coords.longitude;this.fHeight=b.coords.altitude},function(b){},{enableHighAccuracy:!1,timeout:2E4,maximumAge:"Infinite"})}};return c}();"NOMINIFY=w,h,topLeft";"use strict";
CB.Point=function(){var c=function(b,d){"object"==typeof b&&"undefined"==typeof d?void 0!=b.clientX?this.set(b.clientX,b.clientY):b.touches&&b.touches.length?this.set(b.touches[0].pageX,b.touches[0].pageY):void 0!=b.pageX&&this.set(b.pageX,b.pageY):this.set(b,d)};c.prototype.set=function(b,d){this.x=b;this.y=d};c.prototype.add=function(b){return new CB.Point(this.x+b.x,this.y+b.y)};c.prototype.subtract=function(b){return new CB.Point(this.x-b.x,this.y-b.y)};c.prototype.getDist=function(b){b=this.subtract(b);
return Math.sqrt(b.x*b.x+b.y*b.y)};c.prototype.getVecLen=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};c.prototype.toInt=function(){this.x=Math.floor(this.x+.5);this.y=Math.floor(this.y+.5)};c.prototype.cloneIntPoint=function(){var b=new c(this.x,this.y);b.toInt();return b};c.prototype.toString=function(){return"("+this.x+","+this.y+")"};c.prototype.getX=function(){return this.x};c.prototype.getY=function(){return this.y};return c}();
CB.Size=function(){var c=function(b,d){this.w=b;this.h=d};c.prototype.toString=function(){return"w="+this.w+", h="+this.h};c.prototype.centerInSize=function(b){return new CB.Point((b.w-this.w)/2,(b.h-this.h)/2)};return c}();
CB.Rect=function(){var c=function(b,d,e,c){this.left=b||0;this.top=d||0;this.right=e||0;this.bottom=c||0};Object.defineProperty(c.prototype,"w",{get:function(){return this.getSize().w},set:function(b){this.right=this.left+b-1},enumerable:!0});Object.defineProperty(c.prototype,"h",{get:function(){return this.getSize().h},set:function(b){this.bottom=this.top+b-1},enumerable:!0});Object.defineProperty(c.prototype,"topLeft",{get:function(){return new CB.Point(this.left,this.top)},set:function(b){var d=
this.w,e=this.h;this.left=b.x;this.top=b.y;this.w=d;this.h=e},enumerable:!0});c.prototype.fromRect=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};c.prototype.fromPosSize=function(b,d){this.left=b.x;this.top=b.y;this.right=b.x+d.w-1;this.bottom=b.y+d.h-1};c.prototype.fromClientRect=function(b){this.left=b.left;this.top=b.top;this.right=b.right;this.bottom=b.bottom};c.prototype.fromTwoPoints=function(b,d,e,c){this.left=Math.min(b,e);this.right=Math.max(b,e);this.top=
Math.min(d,c);this.bottom=Math.max(d,c)};c.prototype.toString=function(){return"l="+this.left+", t="+this.top+" "+this.getSize().toString()};c.prototype.getPos=function(){return new CB.Point(this.left,this.top)};c.prototype.getTopLeft=function(){return new CB.Point(this.left,this.top)};c.prototype.getTopRight=function(){return new CB.Point(this.right,this.top)};c.prototype.getBottomRight=function(){return new CB.Point(this.right,this.bottom)};c.prototype.getBottomLeft=function(){return new CB.Point(this.left,
this.bottom)};c.prototype.getSize=function(){return new CB.Size(this.right-this.left+1,this.bottom-this.top+1)};c.prototype.getUnion=function(b){return new CB.Rect(Math.min(Math.min(this.left,b.left),Math.min(this.right,b.right)),Math.min(Math.min(this.top,b.top),Math.min(this.bottom,b.bottom)),Math.max(Math.max(this.left,b.left),Math.max(this.right,b.right)),Math.max(Math.max(this.top,b.top),Math.max(this.bottom,b.bottom)))};c.prototype.getCutAtBoundary=function(b){var d=new CB.Rect(this.left,this.top,
this.right,this.bottom);if(d.left<b.left||d.left>=b.right)d.left=b.left;if(d.right>b.right||d.right<=b.left)d.right=b.right;if(d.top<b.top||d.top>=b.bottom)d.top=b.top;if(d.bottom>b.bottom||d.bottom<=b.top)d.bottom=b.bottom;return d};c.prototype.isInside=function(b,d){return b>=this.left&&b<=this.right&&d>=this.top&&d<=this.bottom};c.prototype.getPath=function(){var b=new CB.Path;b.push(this.getTopLeft());b.push(this.getTopRight());b.push(this.getBottomRight());b.push(this.getBottomLeft());return b};
c.prototype.move=function(b,d){this.left+=b;this.top+=d;this.right+=b;this.bottom+=d};c.prototype.shrink=function(b,d){this.left+=b;this.right-=b;this.top+=d;this.bottom-=d};c.prototype.expand=function(b,d){this.shrink(-b,-d)};return c}();
CB.Vector=function(){var c=function(b,d,e){this.set(b,d,e)};c.prototype.set=function(b,d,e){this.x=b;this.y=d;this.z=e};c.prototype.add=function(b){return new CB.Vec(this.x+b.x,this.y+b.y,this.z+b.z)};c.prototype.subtract=function(b){return new CB.Point(this.x-b.x,this.y-b.y,this.z-b.z)};c.prototype.getLength=function(){return void 0!==this.z?Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z):Math.sqrt(this.x*this.x+this.y*this.y)};c.prototype.negate=function(){this.x=-this.x;this.y=-this.y;void 0!==
this.z&&(this.z=-this.z)};c.prototype.toString=function(){return void 0!==this.z?"("+this.x+","+this.y+","+this.z+")":"("+this.x+","+this.y+")"};return c}();
CB.Path=function(){var c=function(){this.subPaths=[]};c.prototype.toString=function(){for(var b="Pth:",d=0;d<this.subPaths.length;d++)b+="s=",this.subPaths[d].forEach(function(d,c,g){b+=d.toString();g<c.length-1&&(b+=",")});return b};c.prototype.push=function(b){0===this.subPaths.length&&this.subPaths.push([]);this.subPaths[this.subPaths.length-1].push(b)};c.prototype.exec=function(b){b.beginPath();for(var d=0;d<this.subPaths.length;d++)1<this.subPaths[d].length&&this.execPoly(b,this.subPaths[d]);
b.closePath()};c.prototype.execPoly=function(b,d){b.moveTo(d[0].x,d[0].y);for(var e=1;e<d.length;e++)b.lineTo(d[e].x,d[e].y)};c.prototype.curve=function(b){for(var d=0;d<this.subPaths.length;d++)3<this.subPaths[d].length&&(b.beginPath(),this.execCurve(b,this.subPaths[d]),b.closePath())};c.prototype.execCurve=function(b,d){b.moveTo(d[0].x,d[0].y);var e;for(e=1;e<d.length-2;e++)b.quadraticCurveTo(d[e].x,d[e].y,(d[e].x+d[e+1].x)/2,(d[e].y+d[e+1].y)/2);b.quadraticCurveTo(d[e].x,d[e].y,d[e+1].x,d[e+1].y)};
c.prototype.reverse=function(){this.subPaths.length&&this.subPaths[this.subPaths.length-1].reverse()};c.prototype.append=function(b){this.subPaths=this.subPaths.concat(b.subPaths)};return c}();
CB.CanvasTools={clipRect:function(c,b){b.getPath().exec(c);c.clip()},clipRectFrame:function(c,b,d){b=b.getPath();d=d.getPath();d.reverse();b.append(d);this.clipPath(c,b)},drawRect:function(c,b,d){d&&(c.strokeStyle=d);b.getPath().exec(c);c.stroke()},fillRect:function(c,b){b.getPath().exec(c);c.fill()},clipPath:function(c,b){b.exec(c);c.clip()},drawLine:function(c,b,d,e,f){c.beginPath();c.moveTo(b,d);c.lineTo(e,f);c.stroke()},drawRoundedRect:function(c,b,d,e,f,g){e<2*g&&(g=e/2);f<2*g&&(g=f/2);c.beginPath();
c.moveTo(b+g,d);c.arcTo(b+e,d,b+e,d+f,g);c.arcTo(b+e,d+f,b,d+f,g);c.arcTo(b,d+f,b,d,g);c.arcTo(b,d,b+e,d,g);c.stroke()},saveImage:function(c,b,d,e){(c=CB.CanvasTools.imgToBlob(c,d,e))&&window.saveAs(c,b)},imgToBlob:function(c,b,d){var e=document.createElement("canvas");e.width=b;e.height=d;c.data&&c.data.length?e.getContext("2d").putImageData(c,0,0):e.getContext("2d").drawImage(c,0,0);return CB.CanvasTools.dataURItoBlob(e.toDataURL())},dataURItoBlob:function(c){var b=atob(c.split(",")[1]);c=c.split(",")[0].split(":")[1].split(";")[0];
for(var d=new ArrayBuffer(b.length),e=new Uint8Array(d),f=0;f<b.length;f++)e[f]=b.charCodeAt(f);if(window.Blob)return new Blob([d],{type:c})}};CB.Color=function(){var c=function(b,d,e,c){this.red=b;this.green=d;this.blue=e;this.alpha=void 0!==c?c:1};c.prototype.toString=function(){return"rgba( "+Math.round(this.red)+", "+Math.round(this.green)+", "+Math.round(this.blue)+", "+this.alpha+" )"};return c}();
CB.HSLColor=function(){var c=function(b,d,e,c){this.hue=b;this.saturation=d;this.lightness=e;this.alpha=c||1};c.prototype.toString=function(){return 1>this.alpha?"hsla( "+Math.round(this.hue)+", "+Math.round(this.saturation)+"%, "+Math.round(this.lightness)+"%, "+this.alpha+" )":"hsl( "+Math.round(this.hue)+", "+Math.round(this.saturation)+"%, "+Math.round(this.lightness)+"% )"};c.RED=0;c.YELLOW=60;c.GREEN=120;c.CYAN=180;c.BLUE=240;c.MAGENTA=300;return c}();"use strict";
CB.Bitmap=function(){var c=function(){this.loaded=!1;this.height=this.width=0;this.url="";this.callOnLoaded=function(){}};c.prototype.isValid=function(){return 0<this.width&&0<this.height};c.prototype.fromUrl=function(b){b?(this.image=new Image,V15&&V15.config.externalCommonPath&&(0>b.search("data:image/png;base64")||!CB.System.isSafari())&&(this.image.crossOrigin="Anonymous"),this.image.addEventListener("load",c.prototype.onLoaded.bind(this)),this.image.addEventListener("error",c.prototype.onError.bind(this)),
this.url=b,this.image.src=b):CB.LogException("bmp._fromUrl","no url")};c.createFromDB=function(b,d){var e=new CB.Bitmap;b.getItem(d,function(b,c){var h=!1;if(c&&!b){var l=(window.URL||window.webkitURL).createObjectURL(c);l?(e.fromUrl(l),e.urlToRevoke=l,h=!0):CB.LogException("Bitmap::fromDB","imgURL null")}h||e.fromUrl(d)});return e};c.prototype.getPattern=function(b){if("undefined"!=typeof this.image&&this.loaded)return b.createPattern(this.image,"repeat")};c.prototype.copyFromCtx=function(b,d,e,
c,g){try{this.imageData=b.getImageData(d,e,c,g),this.loaded=!0,this.width=c,this.height=g}catch(h){console.log(h)}};c.prototype.copyScaledFromCtx=function(b,d,e,c,g,h,l){try{void 0===this.canvas&&(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")),this.canvas.width=c,this.canvas.height=g,0<d+c&&0<e+g&&this.context&&b&&(this.context.drawImage(b.canvas,d,e,h,l,0,0,c,g),this.imageData=this.context.getImageData(0,0,c,g)),this.loaded=!0,this.width=c,this.height=g}catch(q){console.log(q)}};
c.prototype.draw=function(b,d,e,c,g,h,l,q,r){if(isNaN(d)||isNaN(e)){var t=this.url.substring(0,30);CB.LogException("BmpDraw","NaN + "+t+Error().stack)}else if(t=Function.prototype.call.bind(Array.prototype.slice),this.loaded)try{if(void 0!==this.imageData){var v=t(arguments);v.splice(0,1,this.imageData);b.putImageData.apply(b,v)}else void 0!==this.image&&(v=t(arguments),v.splice(0,1,this.image),b.drawImage.apply(b,v))}catch(y){CB.LogException("BMP draw",y)}};c.prototype.drawStretched=function(b,d,
e,c,g){this.loaded&&(void 0!==this.imageData?b.putImageData(this.imageData,d,e,c,g):void 0!==this.image&&b.drawImage(this.image,d,e,c,g))};c.prototype.drawTiled=function(b,d,e,c,g){this.loaded&&(void 0!==this.imageData?this.tile(b,this.imageData,b.putImageData,d,e,c,g):void 0!==this.image&&this.tile(b,this.image,b.drawImage,d,e,c,g))};c.prototype.tile=function(b,d,e,c,g,h,l){if(isNaN(c)||isNaN(g))CB.LogException("Tile","NaN + "+u+Error().stack);else{new CB.Rect(c,g,c+h,g+l);for(var q=g,r=c;q<g+l;){for(;r<
c+h;){var t=this.width,v=this.height;r+t>c+h&&(t=c+h-r);q+v>g+l&&(v=g+l-q);try{e.call(b,d,0,0,t,v,r,q,t,v)}catch(y){CB.LOG("Bitmap Exception: "+y+", "+this.url,"LogException"),CB.LogException("BMP tile: ",y)}r+=this.width}r=c;q+=this.height}}};c.prototype.isValid=function(){return this.loaded};c.prototype.onLoaded=function(){this.loaded=!0;this.width=this.image.width;this.height=this.image.height;this.callOnLoaded();this.urlToRevoke&&(window.URL||window.webkitURL).revokeObjectURL(this.urlToRevoke)};
c.prototype.onError=function(){5};return c}();"use strict";CB.namespace("CB.Sprite");
CB.Sprite=function(){var c=function(){this.bitmap=new CB.Bitmap;this.backSave=new CB.Bitmap;this.hotY=this.hotX=this.backX=this.backY=-1;this.pos=new CB.Point(0,0);this.lastPos=new CB.Point(0,0);this.isVisible=this.loaded=!1;this.h=this.w=0};c.prototype.toString=function(){return this.pos.toString()};c.prototype.fromUrl=function(b){this.bitmap.callOnLoaded=this.onLoaded.bind(this);this.bitmap.fromUrl(b)};c.prototype.copyFromCtx=function(b,d,e){this.bitmap.copyFromCtx(b,d,e);this.onLoaded()};c.prototype.fromUrlSized=
function(b,d){this.bitmap.callOnLoaded=function(){var b=document.createElement("canvas");b&&(b=b.getContext("2d"))&&(this.bitmap.drawStretched(b,0,0,d,d),this.bitmap.copyFromCtx(b,0,0,d,d),this.onLoaded())}.bind(this);this.bitmap.fromUrl(b)};c.prototype.onLoaded=function(){this.w=this.bitmap.width;this.h=this.bitmap.height;this.hotX=Math.floor(this.w/2);this.hotY=Math.floor(this.h/2);this.loaded=!0};c.prototype.moveTo=function(b,d){if(this.bitmap.loaded){this.lastPos=this.pos;var e=d.cloneIntPoint();
this.pos=e;this.backSave.isValid()&&this.backSave.draw(b,this.backX-this.hotX,this.backY-this.hotY);this.externalBG&&(this.backSave=new CB.Bitmap,this.externalBG=!1);this.backSave.copyFromCtx(b,e.x-this.hotX,e.y-this.hotY,this.w,this.h);this.backX=e.x;this.backY=e.y;this.drawWithShadow(b,e.x-this.hotX,e.y-this.hotY);this.isVisible=!0}};c.prototype.setBackground=function(b){b&&(this.externalBG=!0,this.backSave=b,this.backX=this.pos.x,this.backY=this.pos.y)};c.prototype.hasBackground=function(){return this.backSave.loaded||
this.externalBG};c.prototype.hide=function(b){this.backSave.isValid()&&this.isVisible&&(this.backSave.draw(b,this.backX-this.hotX,this.backY-this.hotY),this.isVisible=!1)};c.prototype.saveBeforeMove=function(b,d){var e=d.cloneIntPoint();this.externalBG&&(this.backSave=new CB.Bitmap,this.externalBG=!1);this.backSave.copyFromCtx(b,e.x-this.hotX,e.y-this.hotY,this.w,this.h);this.backX=e.x;this.backY=e.y};c.prototype.moveToNoSave=function(b,d){if(this.bitmap.loaded){this.lastPos=this.pos;var e=d.cloneIntPoint();
this.pos=e;this.drawWithShadow(b,e.x-this.hotX,e.y-this.hotY);this.isVisible=!0}};c.prototype.show=function(b){this.backSave.isValid()&&this.hotX&&(this.backSave.draw(b,this.backX-this.hotX,this.backY-this.hotY),this.externalBG&&(this.backSave=new CB.Bitmap,this.externalBG=!1),this.backSave.copyFromCtx(b,this.backX-this.hotX,this.backY-this.hotY,this.w,this.h),CB.LOG("Sprite.Show: "+(this.backX-this.hotX).toString()+", "+(this.backY-this.hotY).toString(),"","board"),this.drawWithShadow(b,this.backX-
this.hotX,this.backY-this.hotY),this.isVisible=!0)};c.prototype.saveBackground=function(b){this.externalBG&&(this.backSave=new CB.Bitmap,this.externalBG=!1);this.backSave.copyFromCtx(b,this.backX-this.hotX,this.backY-this.hotY,this.w,this.h)};c.prototype.drawWithShadow=function(b,d,e){b.save();if(37<this.bitmap.width&&!this.noShadow){var c=Math.min(3,Math.round(Math.sqrt(this.bitmap.width/30)));b.shadowOffsetX=c;b.shadowOffsetY=c;b.shadowBlur=1*c;b.shadowColor="rgba( 40, 18, 10, 0.24 )"}this.bitmap.draw(b,
d,e);b.restore()};c.prototype.deleteBackground=function(){this.externalBG=!1;this.backSave=new CB.Bitmap;this.backY=this.backX=-1};c.prototype.setClickArea=function(b){this.clickArea=b};c.prototype.getMoveClipRect=function(){return new CB.Rect(Math.min(this.pos.x,this.lastPos.x)-this.hotX,Math.min(this.pos.y,this.lastPos.y)-this.hotY,Math.max(this.pos.x,this.lastPos.x)+this.hotX,Math.max(this.pos.y,this.lastPos.y)+this.hotY)};return c}();
CB.Animation=function(){var c=function(b){this.cbcanvas=b;this.STARTING_FPS=30;this.gameTime=this.lastTime=0;this.startTime=this.getTimeNow();this.fps=0;this.jobs=[];this.callInAnimation=[]};c.prototype.kill=function(){window.cancelAnimationFrame(this.requestFrame);this.callInAnimation=[];this.inAnimation=!1;if(this.jobs.length){CB.LOG("Kill Animation, Jobs="+this.jobs.length,"LogRed","Board");for(var b=0;b<this.jobs.length;b++)this.jobs[b].deleteBackground();this.jobs=[];return!0}return!1};c.prototype.startMultiAnimation=
function(b,d,e){this.forceFinish=!1;this.lastTime=this.avFPSCnt=this.avFPS=0;this.startTime=this.getTimeNow();this.clipArea=e;this.callInAnimation.push(function(){this.mergeJobs(b,d)}.bind(this));this.requestFrame=window.requestAnimationFrame(function(b){this.doMultiAnimationStep(b)}.bind(this));this.inAnimation=!0};c.prototype.doMultiAnimationStep=function(b){this.callOnBeforeEveryStep&&this.callOnBeforeEveryStep();var d=10,e=1;void 0===b&&(b=new Date);this.tick(b);for(b=0;b<this.callInAnimation.length;b++)this.callInAnimation[b]();
this.callInAnimation=[];this.avFPSCnt+=1;this.avFPS+=this.fps;2<this.avFPSCnt&&(d=Math.floor(this.avFPS/this.avFPSCnt),40>d&&(e=1<d?Math.floor(40/d+.5):40));this.forceFinish?e=50:2<e&&CB.LOG("Joining anim Steps: "+e+", fps="+d,"LogRed");var c=this.cbcanvas.bufferCtx,g=!0;for(b=0;b<this.jobs.length;b++)this.jobs[b].shouldHideInThisStep()&&this.jobs[b].hide(c);for(b=0;b<this.jobs.length;b++)this.jobs[b].isImmobileInThisStep()&&!this.jobs[b].getsInvisibleAtEnd()&&this.jobs[b].moveToNoSave(c,this.jobs[b].currPos);
for(b=0;b<this.jobs.length;b++)this.jobs[b].isStillMoving()&&(this.jobs[b].hasReachedEndPos()?this.jobs[b].currPos=this.jobs[b].ptTo:this.jobs[b].displace(e),this.jobs[b].saveBeforeMove(c,this.jobs[b].currPos));for(b=0;b<this.jobs.length;b++)this.jobs[b].isStillMoving()&&(this.jobs[b].moveToNoSave(c,this.jobs[b].currPos),this.cbcanvas.joinClipRect(this.jobs[b].getMoveClipRect())),this.jobs[b].prepNextStep(e)||(g=!1);this.clipArea&&this.cbcanvas.cutClipRect(this.clipArea);this.callOnAfterEveryStep&&
this.callOnAfterEveryStep();this.cbcanvas._drawDoubleBufferClipped();this.reorgJobs();g?(this.inAnimation=!1,this.callOnAnimFinished&&this.callOnAnimFinished(),this.jobs=[]):this.requestFrame=window.requestAnimationFrame(function(b){this.doMultiAnimationStep(b)}.bind(this));g||(3<this.avFPSCnt?this.currFPS=d:delete this.currFPS)};c.prototype.quickFinish=function(){window.cancelAnimationFrame(this.requestFrame);this.forceFinish=!0;this.requestFrame=window.requestAnimationFrame(function(b){this.doMultiAnimationStep(b)}.bind(this))};
c.prototype.hideAll=function(){this.jobs.forEach(function(b){b.shouldHideInThisStep()&&b.hide(this.cbcanvas.bufferCtx)}.bind(this))};c.prototype.showAll=function(){this.jobs.forEach(function(b){b.shouldHideInThisStep()&&b.show(this.cbcanvas.bufferCtx)}.bind(this))};c.prototype.reorgJobs=function(){for(var b=[],d=0;d<this.jobs.length;d++)this.jobs[d].canDelete()||b.push(this.jobs[d]);this.jobs=b};c.prototype.mergeJobs=function(b,d){for(var e=this.cbcanvas.bufferCtx,c=0;c<this.jobs.length;c++)this.jobs[c].hide(e);
for(c=0;c<b.length;c++)b[c].hide(e);for(c=0;c<this.jobs.length;c++)-1==this.jobs[c].sqTo&&this.jobs[c].moveTo(e,this.jobs[c].ptTo);for(c=0;c<this.jobs.length;c++)-1!=this.jobs[c].sqTo&&this.jobs[c].moveTo(e,this.jobs[c].ptTo);var g=0<this.jobs.length;this.jobs=[];for(c=0;c<b.length;c++)b[c].startAnimation(e,d),b[c].deleteBackground(),b[c].moveTo(e,b[c].ptFrom),this.jobs.push(b[c]);return g};c.prototype.tick=function(b){this.updateFrameRate(b);this.gameTime=this.getTimeNow()-this.startTime;this.lastTime=
b};c.prototype.updateFrameRate=function(b){0==this.lastTime&&(this.lastTime=this.startTime);this.fps=0===this.lastTime||this.lastTime==b?this.STARTING_FPS:1E3/(b-this.lastTime)};c.prototype.getTimeNow=function(){return(new Date).getTime()};return c}();"use strict";
CB.DataBuffer=function(){var c=function(){this.nSize=this.nPos=0;this.buffer=new ArrayBuffer(188);this.viewBuf=new DataView(this.buffer);this.nSizeMarker=[];this.nMarkedSize=[]};c.prototype.clear=function(){this.nSize=this.nPos=0;this.nSizeMarker=[];this.nMarkedSize=[]};c.prototype.rewind=function(){this.nPos=0;this.nSizeMarker=[];this.nMarkedSize=[]};c.prototype.getPos=function(){return this.nPos};c.prototype.setPos=function(b){if(b<=this.nSize&&b<=this.buffer.byteLength)this.nPos=b;else throw"Error: SetPos exceeds DataBuffer size";
};c.prototype.getSize=function(){return this.nSize};c.prototype.setSize=function(b){if(b>=this.buffer.byteLength)throw"DBuf setSize illegal";this.nSize=b};c.prototype.getWriteSize=function(){return this.nSize+4};c.prototype.writeToDataView=function(b,d){b.setInt32(d,this.nSize);this._swapBytes(b,d,4);d+=4;for(var e=0;e<this.nSize;e++)b.setUint8(e+d,this.viewBuf.getUint8(e))};c.prototype.readFromDataView=function(b,d){this._swapBytes(b,d,4);var e=b.getInt32(d);if(35E4>e&&0<=e){this._checkAlloc(e);
d+=4;for(var c=0;c<e;c++){var g=b.getUint8(c+d);this.viewBuf.setUint8(c,g)}this._incSize(e)}};c.prototype.Vn=function(b){b=CB.strUtil.encodeUTF8(b);this.V8(b)};c.prototype.V8=function(b){this._checkAlloc(b.length+4);this.Vx(b.length);for(var d=0;d<b.length;d++){var e=b.charCodeAt(d);this.viewBuf.setUint8(this.nPos+d,e)}this._incSize(b.length)};c.prototype.Vq=function(b){var d=this.V10();if(d<=b&&25E4>d){b="";for(var e=0;e<d;e++){var c=this.viewBuf.getUint8(this.nPos+e);b+=String.fromCharCode(c)}b=
CB.strUtil.decodeUTF8(b);this.nPos+=d}else throw Error("Data Error: Read String");return b};c.prototype.V5=function(b){this._checkAlloc(b.length+4);this.Vx(b.length);for(var d=0;d<b.length;d++){var e=b.charCodeAt(d);this.viewBuf.setUint8(this.nPos+d,e)}this._incSize(b.length)};c.prototype.V6=function(b){var d="",e=this.V10();if(e<=b&&25E4>e){for(b=0;b<e;b++)var c=this.viewBuf.getUint8(this.nPos+b),d=d+String.fromCharCode(c);this.nPos+=e}else throw Error(String.f("Data Error: Read String, Len={0}, maxLen={1}",
e,b));return d};c.prototype.writeByteLenASCIIString=function(b){this._checkAlloc(b.length+2);this.writeUint8(b.length+1);for(var d=0;d<b.length;d++){var e=b.charCodeAt(d);this.viewBuf.setUint8(this.nPos+d,e)}this.viewBuf.setUint8(this.nPos+b.length,0);this._incSize(b.length+1)};c.prototype.readByteLenASCIIString=function(b){var d="",e=this.readUint8();0<e&&--e;if(1E3>e){for(var c=0;c<e;c++)var g=this.viewBuf.getUint8(this.nPos+c),d=d+String.fromCharCode(g);if(e<=b)this.nPos+=e+1;else throw Error(String.f("Data Error: Read ByteLenString, len={0}, maxLen={1}",
e,b));}else throw Error(String.f("Data Error: Read ByteLenString > 1000, len={0}",e));return d};c.prototype.readSizedString=function(b){var d="";if(25E4>b){for(var e=0;e<b;e++)var c=this.viewBuf.getUint8(this.nPos+e),d=d+String.fromCharCode(c);this.nPos+=b}else throw Error("Data Error: Read SizedString, max="+b);return d};c.prototype.writeSizedString=function(b){var d=b.length;this._checkAlloc(d);for(var e=0;e<d;e++){var c=b.charCodeAt(e);this.viewBuf.setUint8(this.nPos+e,c)}this._incSize(d)};c.prototype.readSizedUTF8String=
function(b){var d;if(25E4>b){d="";for(var e=0;e<b;e++){var c=this.viewBuf.getUint8(this.nPos+e);d+=String.fromCharCode(c)}d=CB.strUtil.decodeUTF8(d);this.nPos+=b}else throw Error("Data Error: Read UTF8String, len="+b);return d};c.prototype.readByteArray=function(b){for(var d=[],e=0;e<b&&this.nPos+e<this.nSize;e++)d.push(this.viewBuf.getUint8(this.nPos+e));this.nPos+=b;return d};c.prototype.writeByteArray=function(b,d){for(var e=0;e<b.length&&e<d;e++)this.writeByte(b[e])};c.prototype.writeDataBuffer=
function(b){this.Vx(b.getSize());this._checkAlloc(b.getSize());for(var d=0;d<b.getSize();d++)this.viewBuf.setUint8(this.nPos+d,b.viewBuf.getUint8(d));this._incSize(b.getSize())};c.prototype.readDataBuffer=function(){var b=new CB.DataBuffer,d=this.V10();b._checkAlloc(d);for(var e=0;e<d;e++)b.viewBuf.setUint8(e,this.viewBuf.getUint8(this.nPos+e));this.nPos+=d;b._incSize(d);b.nPos=0;return b};c.prototype.writeData=function(b){this._checkAlloc(b.getSize());for(var d=0;d<b.getSize();d++)this.viewBuf.setUint8(this.nPos+
d,b.viewBuf.getUint8(d));this._incSize(b.getSize())};c.prototype.V13=function(b){if(void 0===b)throw Error("V13, value undefined");this._checkAlloc(1);b?this.viewBuf.setUint8(this.nPos,1):this.viewBuf.setUint8(this.nPos,0);this._incSize(1)};c.prototype.V14=function(b){b=this.viewBuf.getUint8(this.nPos);this.nPos+=1;return 0!=b};c.prototype.writeUint8=function(b){if(void 0===b)throw Error("writeUint8, value undefined");this._checkAlloc(1);this.viewBuf.setUint8(this.nPos,b);this._incSize(1)};c.prototype.readUint8=
function(){var b=this.viewBuf.getUint8(this.nPos);this.nPos+=1;return b};c.prototype.readByte=c.prototype.readUint8;c.prototype.writeByte=c.prototype.writeUint8;c.prototype.Vv=function(b){if(void 0===b)throw Error("Vv, value undefined");this._checkAlloc(2);this.viewBuf.setInt16(this.nPos,b);this._swapBytes(this.viewBuf,this.nPos,2);this._incSize(2)};c.prototype.V11=function(){var b=0;this.nPos<=this.viewBuf.byteLength-2&&(this._swapBytes(this.viewBuf,this.nPos,2),b=this.viewBuf.getInt16(this.nPos),
this._swapBytes(this.viewBuf,this.nPos,2),this.nPos+=2);return b};c.prototype.readShort=c.prototype.V11;c.prototype.writeShort=c.prototype.Vv;c.prototype.Vi=function(b){if(void 0===b)throw Error("Vi, value undefined");this._checkAlloc(2);this.viewBuf.setUint16(this.nPos,b);this._swapBytes(this.viewBuf,this.nPos,2);this._incSize(2)};c.prototype.Vu=function(){var b=0;this.nPos<=this.viewBuf.byteLength-2&&(this._swapBytes(this.viewBuf,this.nPos,2),b=this.viewBuf.getUint16(this.nPos),this._swapBytes(this.viewBuf,
this.nPos,2),this.nPos+=2);return b};c.prototype.Vx=function(b){if(void 0===b)throw Error("Vx, value undefined");this._checkAlloc(4);this.viewBuf.setInt32(this.nPos,b);this._swapBytes(this.viewBuf,this.nPos,4);this._incSize(4)};c.prototype.writeFakeInt64=function(b){this.Vx(b);this.Vx(0)};c.prototype.readFakeInt64=function(){var b=this.V10();this.V10();return b};c.prototype.V10=function(){var b=0;this.nPos<=this.viewBuf.byteLength-4&&(this._swapBytes(this.viewBuf,this.nPos,4),b=this.viewBuf.getInt32(this.nPos),
this._swapBytes(this.viewBuf,this.nPos,4),this.nPos+=4);return b};c.prototype.writeInt=c.prototype.Vx;c.prototype.readInt=c.prototype.V10;c.prototype.Vh=function(b){this._checkAlloc(4);this.viewBuf.setUint32(this.nPos,b);this._swapBytes(this.viewBuf,this.nPos,4);this._incSize(4)};c.prototype.Vw=function(){var b=0;this.nPos<=this.viewBuf.byteLength-4&&(this._swapBytes(this.viewBuf,this.nPos,4),b=this.viewBuf.getUint32(this.nPos),this._swapBytes(this.viewBuf,this.nPos,4),this.nPos+=4);return b};c.prototype.Vg=
function(b){b=b.getYear()<<9|b.getMonth()<<5|b.getDay();this.Vh(b)};c.prototype.Vs=function(){var b=new CB.Date,d=this.Vw();b.setYear(d>>9);b.setMonth(d>>5&15);b.setDay(d&31);return b};c.prototype.readCBTime=function(){var b=this.Vw();return new CB.Time(b)};c.prototype.Vt=function(b){if(void 0===b)throw Error("Vt, value undefined");var d=Math.floor(b/4294967296);this.Vx(b-d);this.Vx(d)};c.prototype.readUint64=function(){if(this.nPos<=this.viewBuf.byteLength-8){this._swapBytes(this.viewBuf,this.nPos,
8);var b=this.viewBuf.getUint32(this.nPos);this.nPos+=4;var d=this.viewBuf.getUint32(this.nPos);this.nPos+=4;return 4294967296*b+d}return 0};c.prototype.Vy=function(){if(this.nPos<=this.viewBuf.byteLength-8){this._swapBytes(this.viewBuf,this.nPos,8);var b=this.viewBuf.getInt32(this.nPos);this.nPos+=4;var d=this.viewBuf.getUint32(this.nPos);this.nPos+=4;return 4294967296*b+d}return 0};c.prototype.writeFloat32=function(b){this._checkAlloc(4);this.viewBuf.setFloat32(this.nPos,b);this._swapBytes(this.viewBuf,
this.nPos,4);this._incSize(4)};c.prototype.readFloat32=function(){this._swapBytes(this.viewBuf,this.nPos,4);var b=this.viewBuf.getFloat32(this.nPos);this.nPos+=4;return b};c.prototype.writeFloat64=function(b){this._checkAlloc(8);this.viewBuf.setFloat64(this.nPos,b);this._swapBytes(this.viewBuf,this.nPos,8);this._incSize(8)};c.prototype.readFloat64=function(){this._swapBytes(this.viewBuf,this.nPos,8);var b=this.viewBuf.getFloat64(this.nPos);this.nPos+=8;return b};c.prototype.exportAsCompressedString=
function(){for(var b=this.getSize(),d=[],e=0;e<b;e++){var c=this.viewBuf.getUint8(e);d[e]=c}return CB.BinToString.ByteArrayToString(d,b)};c.prototype.constructFromString=function(b,d){this.clear();if(d){var e=[],c=CB.BinToString.StringToByteArray(e,b);if(0<c)for(var g=0;g<c;g++)this.writeByte(e[g])}else for(e=0,10<b.length&&(e=parseInt(b.substr(0,10),10)),0>e&&(e=0),c=0;c<e;c++)g=b.substr(10+2*c,2),g=parseInt(g,16),this.writeByte(g)};c.prototype.constructFromBase64=function(b){this.clear();b=CB.strUtil.base64.decodeToBinary(b);
for(var d=new Uint8Array(b),e=0;e<b.byteLength;e++)this.writeByte(d[e]);this.writeByteArray(b,b.byteLength);this.rewind()};c.prototype.readBEInt32=function(){var b=this.readUint8(),d=this.readUint8(),e=this.readUint8(),c=this.readUint8();return b<<24|d<<16|e<<8|c};c.prototype.writeBEInt32=function(b){if(void 0===b)throw Error("Vx, value undefined");this._checkAlloc(4);this.viewBuf.setInt32(this.nPos,b);this._incSize(4)};c.prototype.readBEInt24=function(){var b=this.readUint8(),d=this.readUint8(),
e=this.readUint8();return b<<16|d<<8|e};c.prototype.readBEInt16=function(){var b=this.readUint8(),d=this.readUint8();return 256*b+d};c.prototype.writeBEInt24=function(b){var d=b>>8,e=b&255;this.writeUint8(b>>16);this.writeUint8(d);this.writeUint8(e)};c.prototype.writeBEInt16=function(b){var d=b&255;this.writeUint8(b>>8);this.writeUint8(d)};c.prototype.writeArray=function(b){var d=b.length;this.Vx(d);for(var e=0;e<d;++e)b[e].write(this)};c.prototype.writeArrayShort=function(b){var d=b.length;this.Vv(d);
for(var e=0;e<d;++e)b[e].write(this)};c.prototype.readArray=function(b,d){var e=this.V10();65534<e&&CBDebug.assert(65535>e);b.length=e;for(var c=0;c<e;++c){var g=d(this);b[c]=g}};c.prototype.readArrayShort=function(b,d){var e=this.V11();b.length=e;for(var c=0;c<e;++c){var g=d(this);b[c]=g}};c.prototype.beginSizedWrite=function(){this.nSizeMarker.push(this.getPos());this.Vx(0)};c.prototype.endSizedWrite=function(){var b=this.getPos();if(0<this.nSizeMarker.length){this.setPos(this.nSizeMarker[this.nSizeMarker.length-
1]);var d=this.nSize;this.Vx(b-this.nSizeMarker[this.nSizeMarker.length-1]-4);this.nSize=d;this.setPos(b);this.nSizeMarker.pop()}else throw Error("DB::EndWrite");};c.prototype.beginSizedRead=function(){this.nSizeMarker.push(this.getPos());this.nMarkedSize.push(this.V10())};c.prototype.endSizedRead=function(){if(0<this.nSizeMarker.length&&0<this.nMarkedSize.length){var b=this.getPos()-this.nSizeMarker[this.nSizeMarker.length-1]-4;this.skip(this.nMarkedSize[this.nMarkedSize.length-1]-b);this.nSizeMarker.pop();
this.nMarkedSize.pop()}else throw Error("DB::EndRead");};c.prototype.skipSizedRead=function(){var b=this.V10();this.skip(b)};c.prototype.skip=function(b){this.nPos+b<=this.nSize&&(this.nPos+=b)};c.prototype.writeAtPrevPos=function(b,d){var e=this.getPos();this.setPos(b);d();this.setPos(e)};c.prototype._checkAlloc=function(b){if(this.nPos+b>=this.buffer.byteLength||this.nSize+b>=this.buffer.byteLength){var d=Math.max(this.nPos,this.nSize),e=8*Math.floor(3*(d+b)/16+1);if(e<b+d)throw"DataBuffer Size";
b=new ArrayBuffer(e);d=new DataView(b);for(e=0;e<this.buffer.byteLength/4;e++)d.setUint32(4*e,this.viewBuf.getUint32(4*e));this.buffer=b;this.viewBuf=d}};c.prototype._incSize=function(b){if(this.nPos+b>=this.buffer.byteLength)throw"DataBuffer overrun";this.nPos+=b;this.nSize+=b;if(this.nSize>=this.buffer.byteLength)throw"DataBuffer Size Limit exc.";};c.prototype._swapBytes=function(b,d,e){for(var c=[],g=0;g<e;g++)c.push(b.getUint8(d+g));for(g=0;g<e;g++)b.setUint8(d+g,c[e-g-1])};return c}();
function createReadFactory(c){return function(b){var d=new c;d.read(b);return d}}function createReadFactory2(c){return function(b){var d=new c;d.read2(b);return d}}"use strict";
CB.Set=function(){var c=function(b){this.bag=[];var d;if(0<arguments.length)for(d=0;d<b.length;d++)this.insert(b[d])};c.prototype.clear=function(){this.bag=[]};c.prototype.search=function(b,d){for(var e=this.bag.length,c,g=2==arguments.length?d:0;g<e;){c=g+Math.floor((e-g)/2);if(this.bag[c].setEquals(b))return c;b.setGreater(this.bag[c])?g=c+1:e=c}return g};c.prototype.insert=function(b){var d=this.search(b);void 0!==this.bag[d]&&this.bag[d].setEquals(b)||this.bag.splice(d,0,b)};c.prototype.contains=
function(b){var d=this.search(b);return void 0!==this.bag[d]?this.bag[d].setEquals(b):!1};c.prototype.get=function(b){var d=this.search(b);if(void 0!==this.bag[d]&&this.bag[d].setEquals(b))return this.bag[d]};c.prototype.size=function(){return this.bag.length};c.prototype.getElements=function(){return this.bag};c.prototype.equals=function(b){if(this.size()!=b.size())return!1;var d;for(d=0;d<this.bag.length;d++)if(!this.bag[d].setEquals(b.bag[d]))return!1;return!0};c.prototype.save=function(b,d){var e=
new CB.Storage;e.save(b+"_len",this.bag.length);for(var c=0;c<this.bag.length;c++)d&&!d(this.bag[c])||e.save(b+"_o"+c,this.bag[c])};c.prototype.load=function(b,d){var e=new CB.Storage,c=e.load(b+"_len");if(c)for(var g=0,h=0;h<c;h++){var l=e.load(b+"_o"+h);d?(l=d(l))&&(this.bag[g++]=l):this.bag[g++]=l}};return c}();
CB.NativeSet=function(){var c=function(b){this.bag=[];var d;if(0<arguments.length)for(d=0;d<b.length;d++)this.insert(b[d])};c.prototype.clear=function(){this.bag=[]};c.prototype.search=function(b,d){for(var e=this.bag.length,c,g=2==arguments.length?d:0;g<e;){c=g+Math.floor((e-g)/2);if(this.bag[c]==b)return c;b>this.bag[c]?g=c+1:e=c}return g};c.prototype.insert=function(b){var d=this.search(b);void 0!==this.bag[d]&&this.bag[d]==b||this.bag.splice(d,0,b)};c.prototype.contains=function(b){var d=this.search(b);
return void 0!==this.bag[d]?this.bag[d]==b:!1};c.prototype.get=function(b){var d=this.search(b);if(void 0!==this.bag[d]&&this.bag[d]==b)return this.bag[d]};c.prototype.size=function(){return this.bag.length};c.prototype.getElements=function(){return this.bag};c.prototype.equals=function(b){if(this.size()!=b.size())return!1;var d;for(d=0;d<this.bag.length;d++)if(this.bag[d]!=b.bag[d])return!1;return!0};c.prototype.save=function(b,d){var e=new CB.Storage;e.save(b+"_len",this.bag.length);for(var c=0;c<
this.bag.length;c++)d&&!d(this.bag[c])||e.save(b+"_o"+c,this.bag[c])};c.prototype.load=function(b,d){var e=new CB.Storage,c=e.load(b+"_len");if(c)for(var g=0,h=0;h<c;h++){var l=e.load(b+"_o"+h);d?(l=d(l))&&(this.bag[g++]=l):this.bag[g++]=l}};return c}();"use strict";CB.namespace("CB.VectorSender");
CB.VectorSender=function(){var c=function(b){this.sendFn=b;this.sendBuffers={};this.endOfVec={}};c.staticIdVector=0;c.staticIdBunch=0;c.prototype.receiveVector=function(b,d,e,c){var g={vec:[],overhead:new CB.DataBuffer},h=b.getBuf().Vw();b.getBuf().Vw();var l=b.getBuf().Vw();b.getBuf().Vw();g.overhead=b.getBuf().readDataBuffer();if(0<l){for(var q=b.getBuf().V10(),r=0;r<q&&3E4>r;r++){var t=c(b.getBuf());g.vec.push(t)}d=new CB.WebSockMessage(d);d.setUserType(e);d.getBuf().Vh(h);d.getBuf().Vh(0);d.getBuf().Vh(l);
d.getBuf().Vh(0);d.getBuf().Vx(q);d.address(b.getIdReceiver(),b.Vj());this.sendFn(d)}return g};c.prototype.sendVector=function(b,d,e,f,g,h,l,q){var r=++c.staticIdVector,t=++c.staticIdBunch,v=0;do{var y=new CB.DataBuffer;y.Vx(r);y.Vx(0);y.Vx(t);y.Vx(0);y.writeDataBuffer(l);var A=0,w=y.getPos();y.Vx(A);if(e.length){var z;do{var C=y.getSize(),D=y.getPos();q(y,e[v]);(z=y.getSize()<f)||0==A?(A++,v++):(y.setPos(D),y.setSize(C))}while(z&&v<e.length);z=y.getPos();y.setPos(w);y.Vx(A);y.setPos(z)}this.sendBuffers[t]=
{sender:b,receiver:d,buf:y,idBunch:t,idVec:r,msgType:g,userType:h,nSent:0};t++}while(v<e.length);this.endOfVec[r]={idVec:r,data:{msgType:g,userType:h,overHead:l}};this.sendNextBunch(b,d,r)};c.prototype.sendNextBunch=function(b,d,e){var c=!1,g;for(g in this.sendBuffers)if(this.sendBuffers.hasOwnProperty(g)){var h=this.sendBuffers[g],c=c||h.idVec==e;if(0==e||h.idVec==e){0==h.nSent%10&&(g=new CB.WebSockMessage(h.msgType),g.setUserType(h.userType),g.getBuf().writeData(h.buf),g.address(b,d),this.sendFn(g),
CB.LOG("Send Bunch = "+h.idBunch+", vec="+h.idVec+", sent="+h.nSent,"LogGreen"));h.nSent++;break}}!c&&(c=this.endOfVec[e])&&(g=new CB.WebSockMessage(c.data.msgType),g.setUserType(c.data.userType),g.getBuf().writeFakeInt64(e),g.getBuf().writeFakeInt64(0),g.getBuf().writeDataBuffer(c.data.overHead),g.address(b,d),this.sendFn(g),delete this.endOfVec[e])};c.prototype.handleConfirmBunch=function(b){var d=b.getBuf().readFakeInt64(),e=b.getBuf().readFakeInt64(),c=b.getBuf().V10();this.sendBuffers[e]?CB.LOG("Confirm Bunch = "+
e+", idVec="+d+", nItems="+c,"LogGreen"):CB.LOG("Confirm Bunch not found: "+e+", idVec="+d,"LogError");delete this.sendBuffers[e];this.sendNextBunch(b.getIdReceiver(),b.Vj(),d);return c};return c}();"use strict";CB.Side={NONE:-1,WHITE:0,BLACK:1,SIDE_OFFSET:3};CB.Side.SIDE_MASK=8;CB.Side.other=function(c){return c^CB.Side.BLACK};CB.Side.fromString=function(c){return"w"===c?CB.Side.WHITE:CB.Side.BLACK};CB.Side.toString=function(c){return c===CB.Side.WHITE?"w":"b"};
CB.Piece={NONE:0,KING:1,QUEEN:2,KNIGHT:3,BISHOP:4,ROOK:5,PAWN:6,W_KING:1,W_QUEEN:2,W_KNIGHT:3,W_BISHOP:4,W_ROOK:5,W_PAWN:6,B_KING:9,B_QUEEN:10,B_KNIGHT:11,B_BISHOP:12,B_ROOK:13,B_PAWN:14,COLOUR:8,WHITE:0,BLACK:8,JOKER:7};CB.Piece.PIECE_MASK=7;CB.Piece.SIDE_MASK=8;CB.Piece.nominal=function(c){return c&CB.Piece.PIECE_MASK};CB.Piece.side=function(c){return(c&CB.Side.SIDE_MASK)/8};CB.Piece.changeSide=function(c){return c^CB.Side.SIDE_MASK};CB.Piece.make=function(c,b){return c|8*b};
CB.Piece.g_arrPieces=" KQNBRP  kqnbrp".split("");CB.Piece.toString=function(c){return CB.Piece.g_arrPieces[c]};CB.Piece.fromString=function(c){c=CB.Piece.g_arrPieces.indexOf(c);return 0>c?CB.Piece.NONE:c};CB.Piece.getNameAccusative=function(c){switch(c){case CB.Piece.KING:return lm.KING_ACC;case CB.Piece.QUEEN:return lm.QUEEN_ACC;case CB.Piece.KNIGHT:return lm.KNIGHT_ACC;case CB.Piece.BISHOP:return lm.BISHOP_ACC;case CB.Piece.ROOK:return lm.ROOK_ACC;case CB.Piece.PAWN:return lm.PAWN_ACC}};
CB.CastleRights={NONE:0,W_000:1,W_00:2,B_000:4,B_00:8};CB.CastleRights.W_ALL=CB.CastleRights.W_00|CB.CastleRights.W_000;CB.CastleRights.B_ALL=CB.CastleRights.B_00|CB.CastleRights.B_000;CB.CastleRights.ALL=CB.CastleRights.W_ALL|CB.CastleRights.B_ALL;CB.CastleRights.toString=function(c){if(c===CB.CastleRights.NONE)return"-";var b="";c&CB.CastleRights.W_00&&(b+="K");c&CB.CastleRights.W_000&&(b+="Q");c&CB.CastleRights.B_00&&(b+="k");c&CB.CastleRights.B_000&&(b+="q");return b};
CB.CastleRights.fromString=function(c){var b=CB.CastleRights.NONE;c=new StringIterator(c);for(var d=c.Next();0!==d;d=c.Next())switch(d){case "K":b|=CB.CastleRights.W_00;break;case "Q":b|=CB.CastleRights.W_000;break;case "k":b|=CB.CastleRights.B_00;break;case "q":b|=CB.CastleRights.B_000}return b};
CB.Square={ROW_OFFSET:0,ROW_MASK:7,COL_OFFSET:3,COL_MASK:56,A1:0,A2:1,A3:2,A4:3,A5:4,A6:5,A7:6,A8:7,B1:8,B2:9,B3:10,B4:11,B5:12,B6:13,B7:14,B8:15,C1:16,C2:17,C3:18,C4:19,C5:20,C6:21,C7:22,C8:23,D1:24,D2:25,D3:26,D4:27,D5:28,D6:29,D7:30,D8:31,E1:32,E2:33,E3:34,E4:35,E5:36,E6:37,E7:38,E8:39,F1:40,F2:41,F3:42,F4:43,F5:44,F6:45,F7:46,F8:47,G1:48,G2:49,G3:50,G4:51,G5:52,G6:53,G7:54,G8:55,H1:56,H2:57,H3:58,H4:59,H5:60,H6:61,H7:62,H8:63,C_A:0,C_B:1,C_C:2,C_D:3,C_E:4,C_F:5,C_G:6,C_H:7,R_1:0,R_2:1,R_3:2,R_4:3,
R_5:4,R_6:5,R_7:6,R_8:7};CB.Sq=CB.Square;CB.Square.g_arrSquareStrs="a1 a2 a3 a4 a5 a6 a7 a8 b1 b2 b3 b4 b5 b6 b7 b8 c1 c2 c3 c4 c5 c6 c7 c8 d1 d2 d3 d4 d5 d6 d7 d8 e1 e2 e3 e4 e5 e6 e7 e8 f1 f2 f3 f4 f5 f6 f7 f8 g1 g2 g3 g4 g5 g6 g7 g8 h1 h2 h3 h4 h5 h6 h7 h8".split(" ");CB.Square.toString=function(c){return this.g_arrSquareStrs[c]};CB.Square.getStr=CB.Square.toString;CB.Square.getStrXY=function(c,b){return CB.Square.getStr(CB.Square.get64(c,b))};
CB.Square.colToString=function(c){return String.fromCharCode("a".charCodeAt()+c)};CB.Square.rowToString=function(c){return c+1};CB.Square.colFromString=function(c){return c.charCodeAt(0)-"a".charCodeAt()};CB.Square.rowFromString=function(c){return c.charCodeAt(0)-"1".charCodeAt()};CB.Square.fromString=function(c){if(c&&2===c.length){var b=CB.Square.colFromString(c.charAt(0));c=CB.Square.rowFromString(c.charAt(1));return CB.Square.I(b,c)}};CB.Square.R=function(c){return(c&CB.Square.ROW_MASK)>>CB.Square.ROW_OFFSET};
CB.Square.C=function(c){return(c&CB.Square.COL_MASK)>>CB.Square.COL_OFFSET};CB.Square.F=function(c){return(c&CB.Square.COL_MASK)>>CB.Square.COL_OFFSET};CB.Square.getRank=CB.Square.R;CB.Square.getFile=CB.Square.C;CB.Square.DIST=function(c,b){var d=CB.Square.R(c)-CB.Square.R(b),e=CB.Square.C(c)-CB.Square.C(b);return Math.sqrt(d*d+e*e)};CB.Square.I=function(c,b){return 8*c+b};CB.Square.get64=CB.Square.I;CB.Square.isLegal=function(c,b){return c<=CB.Square.C_H&&c>=CB.Square.C_A&&b<=CB.Square.R_8&&b>=CB.Square.R_1};
CB.Square.isDark=function(c){var b=CB.Square.C(c);c=CB.Square.R(c);return!((b+c)%2)};CB.Square.isLight=function(c){return!CB.Square.isDark(c)};CB.Square.isCenterFile=function(c){return CB.Square.F(c)==CB.Square.C_D||CB.Square.F(c)==CB.Square.C_E};CB.Square.isCenterRank=function(c){return CB.Square.R(c)==CB.Square.R_4||CB.Square.R(c)==CB.Square.R_5};CB.Square.isCenterSquare=function(c){return CB.Square.isCenterFile(c)&&CB.Square.isCenterRank(c)};
CB.Square.getDist=function(c,b){var d=CB.Square.getFile(c)-CB.Square.getFile(b),e=CB.Square.getRank(c)-CB.Square.getRank(b);return Math.sqrt(d*d+e*e)};CB.Square.getFileDist=function(c,b){return CB.Square.getFile(c)-CB.Square.getFile(b)};CB.Square.getPromRow=function(c){return c===CB.Side.WHITE?CB.Square.R_8:CB.Square.R_1};"use strict";
CB.Board=function(){var c=function(b){this.sqs=[];for(var d=0;64>d;d++)this.sqs.push(0);b&&this.setup()};c.SIZE=64;c.prototype.setup=function(){this.sqs=[CB.Piece.W_ROOK,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_ROOK,CB.Piece.W_KNIGHT,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_KNIGHT,CB.Piece.W_BISHOP,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_BISHOP,CB.Piece.W_QUEEN,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_QUEEN,CB.Piece.W_KING,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,
CB.Piece.B_KING,CB.Piece.W_BISHOP,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_BISHOP,CB.Piece.W_KNIGHT,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_KNIGHT,CB.Piece.W_ROOK,CB.Piece.W_PAWN,0,0,0,0,CB.Piece.B_PAWN,CB.Piece.B_ROOK]};c.prototype.clear=function(){this.sqs.forEach(function(b,d,e){e[d]=0})};c.prototype.fromPosStr=function(b){for(var d=CB.Side.WHITE,e=CB.Piece.KING,c=0;c<b.length;c++)switch(b[c]){case "K":e=CB.Piece.KING;break;case "Q":e=CB.Piece.QUEEN;break;case "R":e=CB.Piece.ROOK;
break;case "B":e=CB.Piece.BISHOP;break;case "N":e=CB.Piece.KNIGHT;break;case "P":e=CB.Piece.PAWN;break;case "a":case "b":case "c":case "d":case "e":case "f":case "g":case "h":var g=b.charCodeAt(c),h=b.charCodeAt(c+1);49<=h&&56>=h?this.sqs[(g-97<<3)+h-49]=e|d:98==g&&(d=CB.Side.SIDE_MASK);break;case "w":d=CB.Side.WHITE}};c.prototype.copyFrom=function(b){for(var d=0;d<b.length;d++)this.sqs[d]=b[d]};c.prototype.copyTo=function(b){for(var d=0;64>d;d++)b[d]=this.sqs[d]};c.prototype.set=function(b,d){this.sqs[b]=
d};c.prototype.get=function(b){return this.sqs[b]};c.prototype.change=function(b,d){this.sqs[d]=this.sqs[b];this.sqs[b]=0};c.prototype.promo=function(b,d,e){this.sqs[d]=e;this.sqs[b]=0};c.prototype.enPassant=function(b,d,e){this.sqs[d]=this.sqs[b];this.sqs[b]=0;this.sqs[e]=0};c.prototype.writeToDataBuffer=function(b){for(var d=0;64>d;d++)b.writeByte(this.sqs[d])};c.prototype.toDebugStrs=function(){for(var b=[],d=7;0<=d;d--){for(var e="",c=0;8>c;c++)var g=this.get(8*c+d),e=g?e+CB.Piece.g_arrPieces[g]:
CB.Square.isDark(8*c+d)?e+".":e+" ";b.push(e)}return b};c.prototype.findSamePieceClosestSquare=function(b,d,e,c){for(d=0;64>d;d++)if((void 0===c||!c[d])&&e[d]==b)return d;return-1};c.prototype.test=function(){var b=new CB.Board;b.setup();b.toDebugStrs().forEach(function(b){CB.LOG(b)})};return c}();"use strict";
CB.Undo=function(){var c=function(b,d){void 0!==b?(this.cr=b.cr,this.ep=b.ep,this.mvd=b.board[d.from],this.vct=b.board[d.to]):(this.cr=CB.CastleRights.NONE,this.ep=0,this.mvd=this.vct=CB.Piece.NONE);void 0!==d&&(this.fldVct=d.to);this.from2=this.to2=0};c.prototype.setEP=function(b,d){this.fldVct=d;this.vct=b};c.prototype.setCastle=function(b,d){this.from2=b;this.to2=d};return c}();"use strict";
CB.Move=function(){var c=function(b,d,e){this.to=this.from=0;this.prom=CB.Piece.NONE;b&&(this.from=b);d&&(this.to=d);e&&(this.prom=e)};c.g_mvW00=new c(CB.Square.E1,CB.Square.G1);c.g_mvW000=new c(CB.Square.E1,CB.Square.C1);c.g_mvB00=new c(CB.Square.E8,CB.Square.G8);c.g_mvB000=new c(CB.Square.E8,CB.Square.C8);c.prototype.isACheck=!1;c.prototype.isAMate=!1;c.prototype.needCol=!1;c.prototype.needRow=!1;c.prototype.mvd=CB.Piece.NONE;c.prototype.vct=CB.Piece.NONE;Object.defineProperty(c.prototype,"piece",
{get:function(){return this.mvd},set:function(b){this.mvd=b},enumerable:!0});Object.defineProperty(c.prototype,"capt",{get:function(){return this.vct},set:function(b){this.vct=b},enumerable:!0});c.prototype.shortCastling=!1;c.prototype.longCastling=!1;c.prototype.isNullMove=function(){return this.from===this.to&&!this.from};c.prototype.isCastling=function(){return this.isShortCastling()||this.isLongCastling()};c.prototype.equals=function(b){return this.from===b.from&&this.to===b.to&&this.prom===b.prom};
c.prototype.isValid=function(){return this.from!=this.to};c.prototype._isShortCastling=function(){return this.equals(CB.Move.g_mvW00)&&this.mvd===CB.Piece.W_KING||this.equals(CB.Move.g_mvB00)&&this.mvd===CB.Piece.B_KING};c.prototype.isShortCastling=function(){return this.shortCastling};c.prototype._isLongCastling=function(){return this.equals(CB.Move.g_mvW000)&&this.mvd===CB.Piece.W_KING||this.equals(CB.Move.g_mvB000)&&this.mvd===CB.Piece.B_KING};c.prototype.isLongCastling=function(){return this.longCastling};
c.prototype.setIsCastling=function(){this.shortCastling=this._isShortCastling();this.longCastling=this._isLongCastling()};c.prototype.subLines=null;c.prototype.annos=null;c.prototype.isCheck=function(){return this.isACheck};c.prototype.setCheck=function(b){this.isACheck=b};c.prototype.isMate=function(){return this.isAMate};c.prototype.setMate=function(b){this.isAMate=b};c.prototype.isTake=function(){return this.vct!=CB.Piece.NONE};c.prototype.getMoved=function(){return this.mvd};c.prototype.setMoved=
function(b){this.mvd=b};c.prototype.getVictim=function(){return this.vct};c.prototype.setVictim=function(b){this.vct=b};c.prototype.getPiece=c.prototype.getMoved;c.prototype.isProm=function(){return this.prom!=CB.Piece.NONE};c.prototype.isPawn=function(){return this.mvd&&(this.mvd&7)==CB.Piece.PAWN};c.prototype.getSide=function(){return CB.Piece.side(this.mvd)};c.prototype.isNeedCol=function(){return this.needCol};c.prototype.setNeedCol=function(b){this.needCol=b};c.prototype.isNeedRow=function(){return this.needRow};
c.prototype.setNeedRow=function(b){this.needRow=b};c.prototype.getTreeMoveCount=function(){var b=1;this.subLines&&(b=this.subLines.reduce(function(b,e){return b+e.getTreeMoveCount()},b));return b};c.prototype.indexOfLine=function(b){return this.subLines?this.subLines.indexOf(b):-1};c.prototype.findLine=function(b){if(this.subLines)for(var d=0;d<this.subLines.length;++d){var e=this.subLines[d];if(e[0].equals(b))return e}return null};c.prototype.removeLine=function(b){this.subLines&&(b=this.subLines.indexOf(b),
0>b||this.subLines.splice(b,1))};c.prototype.removeLines=function(){this.subLines=null};c.prototype.getLine=function(b){return this.subLines[b]};c.prototype.getSubLines=function(){return this.subLines};c.prototype.getSubLinesCount=function(){return this.subLines?this.subLines.length:0};c.prototype.hasLines=function(){return null!=this.subLines&&0<this.subLines.length};c.prototype.newLine=function(b,d){this.subLines||(this.subLines=[]);var e=new CB.MoveLine(b,d);this.subLines.push(e);return e};c.prototype.addLine=
function(b){this.subLines||(this.subLines=[]);this.subLines.push(b)};c.prototype.insertLine=function(b,d){this.subLines||(this.subLines=[]);this.subLines.splice(b,0,d)};c.prototype.swapLines=function(b,d){if(this.subLines){var e=this.subLines[b];this.subLines[b]=this.subLines[d];this.subLines[d]=e}};c.prototype.write=function(b){if(this.prom){var d=this.to|this.prom-CB.Piece.QUEEN<<6;b.writeByte(this.from|64);b.writeByte(d)}else b.writeByte(this.from),b.writeByte(this.to);this.writeAnnos(b);this.writeSubLines(b)};
c.prototype.write2=function(b){if(this.prom){var d=this.to|this.prom-CB.Piece.QUEEN<<6;b.writeByte(this.from|64);b.writeByte(d)}else b.writeByte(this.from),b.writeByte(this.to);d=0;this.annos&&this.annos.count()&&(d|=1);this.getSubLinesCount()&&(d|=2);b.writeUint8(d);d&1&&this.writeAnnos2(b);d&2&&this.writeSubLines2(b)};c.prototype.read=function(b){this.from=b.readByte();this.to=b.readByte();64==(this.from&192)&&(this.prom=CB.Piece.QUEEN+(this.to>>6));this.from&=63;this.to&=63;this.readAnnos(b);this.readSubLines(b)};
c.prototype.read2=function(b){this.from=b.readByte();this.to=b.readByte();64==(this.from&192)&&(this.prom=CB.Piece.QUEEN+(this.to>>6));this.from&=63;this.to&=63;var d=b.readByte();d&1&&this.readAnnos2(b);d&2&&this.readSubLines2(b)};c.prototype.readAnnos=function(b){this.annos=CB.Annotation.readFactory(b)};c.prototype.readAnnos2=function(b){this.annos=CB.Annotation.readFactory2(b)};c.prototype.writeAnnos=function(b){CB.Annotation.write(b,this.annos)};c.prototype.writeAnnos2=function(b){CB.Annotation.write2(b,
this.annos)};c.prototype.readSubLines=function(b){var d=b.readByte();if(127>=d){this.subLines=Array(d);for(var e=0;e<d;++e)this.subLines[e]=CB.MoveLine.readFactory(b)}};c.prototype.readSubLines2=function(b){var d=b.readByte();if(127>=d){this.subLines=Array(d);for(var e=0;e<d;++e)this.subLines[e]=CB.MoveLine.readFactory2(b)}};c.prototype.writeSubLines=function(b){var d=this.getSubLinesCount();b.writeByte(d);if(d)for(var e=0;e<d;++e)this.subLines[e].write(b)};c.prototype.writeSubLines2=function(b){var d=
this.getSubLinesCount();b.writeByte(d);if(d)for(var e=0;e<d;++e)this.subLines[e].write2(b)};c.readFactory=createReadFactory(c);c.readFactory2=createReadFactory2(c);c.prototype.moveLinesTo=function(b){b.subLines=this.subLines;this.subLines=null};c.prototype.toString=function(){var b=CB.Square.toString(this.from)+CB.Square.toString(this.to);this.prom!=CB.Piece.NONE&&(b+=CB.Piece.toString(this.prom).toLowerCase());return b};c.g_regex=/^[a-h][1-8][a-h][1-8]([NBRQ])?$/i;c.isValidString=function(b){return c.g_regex.test(b)};
c.fromString=function(b){var d=b.substring(0,2),e=b.substring(2,4),d=CB.Square.fromString(d),e=CB.Square.fromString(e),c=void 0;4<b.length&&(b=b.charAt(4),c=CB.Piece.nominal(CB.Piece.fromString(b)));return new CB.Move(d,e,c)};c.prototype.toJSON=function(){return{from:CB.Square.toString(this.from),to:CB.Square.toString(this.to),prom:"  Q N B R  ".split(" ")[this.prom%8]}};c.prototype.fromJSON=function(b){this.from=CB.Square.fromString(b.from);this.to=CB.Square.fromString(b.to);b=" KQNBR".search(RegExp(b.prom,
"i"));this.prom=0<b?b:0;return{from:CB.Square.toString(this.from),to:CB.Square.toString(this.to),prom:"  Q N B R  ".split(" ")[this.prom%8]}};c.prototype.setSubParentData=function(b,d,e){if(this.subLines)for(var c=0;c<this.subLines.length;++c){var g=this.subLines[c];g.setParentMoveIndex(d);g.setParentLine(b);e&&g.setSubParentData(!0)}};c.prototype.getAnno=function(){return this.annos};c.prototype.hasAnno=function(){return null!=this.annos};c.prototype.setAnnoItem=function(b,d){this.annos||(this.annos=
new CB.Annotation);this.annos.setItem(b,d)};c.prototype.setAnno=function(b){this.annos=b};c.prototype.getAnnoItem=function(b){return this.annos?this.annos.getItem(b):null};c.prototype.deleteAnnoItem=function(b){this.annos&&this.annos.deleteItem(b)};c.prototype.resetAnno=function(){this.annos=null};c.prototype.unAnnotate=function(){this.resetAnno();this.removeLines()};c.prototype.getBaggage=function(){return this.baggage};c.prototype.setBaggage=function(b){this.baggage=b};c.prototype.forAllMoves=function(b){b(this);
if(this.subLines)for(var d=0;d<this.subLines.length;d++)this.subLines[d].forAllMoves(b)};return c}();"use strict";
CB.MoveRecord=function(){var c=function(b,d,e,c){this.from=b||0;this.to=d||0;this.type=e||0;this.prom=c||0};c.prototype.initFromMove=function(b){b&&(this.from=b.from,this.to=b.to,this.prom=b.prom,this.type=void 0!==b.type?b.type:0)};c.prototype.toString=function(){return CB.Square.toString(this.from)+"-"+CB.Square.toString(this.to)+", ty="+this.type};c.prototype.fromDataBuf=function(b){this.from=b.readUint8();this.to=b.readUint8();this.type=b.readUint8();this.prom=b.readUint8()};c.prototype.Vz=function(b){b.writeUint8(this.from);
b.writeUint8(this.to);b.writeUint8(this.type);b.writeUint8(this.prom)};return c}();"use strict";
CB.MoveLine=function(){var c=function(b,d){this.parent=null;this.inxMvParent=0;b&&(this.parent=b,this.inxMvParent=d)};c.prototype=[];c.prototype.isMainLine=function(){return!this.parent};c.prototype.setMainLine=function(){this.parent=null;this.inxMvParent=0};c.prototype.getParentLine=function(){return this.parent};c.prototype.setParentLine=function(b){this.parent=b};c.prototype.getParentMoveIndex=function(){return this.inxMvParent};c.prototype.setParentMoveIndex=function(b){this.inxMvParent=b};c.prototype.getTreeMoveCount=
function(){return this.reduce(function(b,d){return b+d.getTreeMoveCount()},0)};c.prototype.setSubParentData=function(b){this.forEach(function(d,e){d.setSubParentData(this,e,b)}.bind(this))};c.prototype.swapMoves=function(b,d){var e=[b,this.length-b];if(d)for(var c=0,g=d.length;c<g;++c)e.push(d[c]);e=this.splice.apply(this,e);this.setSubParentData();e=[0,d.length].concat(e);d.splice.apply(d,e);d.setSubParentData();d.setParentLine(this);return d};c.prototype.selfTest=function(b,d,e){CBDebug.assert(this.inxMvParent===
e);CBDebug.assert(!d||null!=this.getParentMove()&&0<=this.getParentMove().indexOfLine(this));b=ObjUtil.clone(b);e=0;for(var c=this.length;e<c;++e){var g=this[e];if(g.hasLines()){CBDebug.assert(!d||e);for(var h=g.getSubLines(),l=0;l<h.length;++l)h[l].selfTest(ObjUtil.clone(b),this,e)}b.makeMove(g)}};c.prototype.getParentMove=function(){return this.parent?this.parent[this.inxMvParent]:null};c.prototype.toString=function(){return this.join(" ")};c.readFactory=createReadFactory(c);c.readFactory2=createReadFactory2(c);
c.prototype.read=function(b){b.readArray(this,CB.Move.readFactory);this.setSubParentData();this.shiftTrainingAnnosBack()};c.prototype.read2=function(b){var d=b.readUint8();d&128&&(d=(d<<8|b.readUint8())&32767);if(0<d){if(2048<d)return!1;if(0<d){this.length=d;for(var e=0;e<d;e++){var c=new CB.Move;c.read2(b);this[e]=c}}}else if(0>d)return!1;this.setSubParentData();this.shiftTrainingAnnosBack()};c.prototype.write=function(b){this.shiftTrainingAnnosFwd();b.writeArray(this)};c.prototype.write2=function(b){this.shiftTrainingAnnosFwd();
2048>=this.length&&(this.length&-128&&b.writeUint8(this.length<<8|128),b.writeUint8(this.length&255));for(var d=0;d<this.length;d++)this[d].write2(b)};c.prototype.hasLines=function(){return this.some(function(b){return b.hasLines()})};c.prototype.shiftTrainingAnnosBack=function(){for(var b=1;b<this.length;b++)if(this[b].hasAnno()&&this[b].getAnno().hasTraining()){var d=this[b].getAnno().getTraining();this[b].getAnno().setTraining(null);this[b-1].setAnnoItem(CB.AnnoType.TRAINING,d)}};c.prototype.shiftTrainingAnnosFwd=
function(){for(var b=this.length-2;0<=b;b--)if(this[b].hasAnno()&&this[b].getAnno().hasTraining()){var d=this[b].getAnno().getTraining();this[b].getAnno().setTraining(null);this[b+1].setAnnoItem(CB.AnnoType.TRAINING,d)}};c.prototype.isAnnotated=function(){return this.some(function(b){return b.hasLines()||b.hasAnno()})};c.prototype.setAnno=function(b){this.anno=b};c.prototype.getAnno=function(b){return this.anno};c.prototype.setAnnoItem=function(b,d){this.anno||(this.anno=new CB.Annotation);this.anno.setItem(b,
d)};c.prototype.hasAnno=function(){return void 0!==this.anno};c.prototype.unAnnotate=function(){this.forEach(function(b){b.unAnnotate()})};c.prototype.forAllMoves=function(b){this.forEach(function(d){d.forAllMoves(b)})};c.prototype.removeLines=function(){this.forEach(function(b){b.removeLines()})};return c}();"use strict";
CB.LineStackItem=function(){var c=function(b,d){this.line=void 0!=b?b:null;this.mvsToGo=void 0!=d?d:0};c.prototype.getLine=function(){return this.line};c.prototype.getMovesToGo=function(){return this.mvsToGo};c.prototype.setMovesToGo=function(b){this.mvsToGo=b};c.prototype.incMovesToGo=function(){++this.mvsToGo};c.prototype.decMovesToGo=function(){--this.mvsToGo};c.prototype.isLineEnd=function(){return this.line.length===this.mvsToGo};c.prototype.isLineStart=function(){return 0===this.mvsToGo};c.prototype.pushMove=
function(b){this.line.length=this.mvsToGo;this.line.push(b);++this.mvsToGo};c.prototype.deleteRemaining=function(){this.line.length=this.mvsToGo};c.prototype.deletePrevious=function(){this.line.splice(0,this.mvsToGo-1);this.mvsToGo=1;this.line.setSubParentData();this.line.setMainLine();return this.line};c.prototype.shallowClone=function(){return new c(this.line,this.mvsToGo)};return c}();
CB.LineStack=function(){var c=function(b,d){b&&(d||(d=0),this.push(new CB.LineStackItem(b,d)))};c.prototype=[];c.prototype.Top=function(){return this[this.length-1]};c.prototype.shallowClone=function(){var b=new CB.LineStack;b.length=this.length;for(var d=0,e=this.length;d<e;++d)b[d]=this[d].shallowClone();return b};c.prototype.deleteRemaining=function(){this.Top()&&this.Top().deleteRemaining()};c.prototype.deletePrevious=function(){var b=this.Top(),d=b.deletePrevious();this.length=0;this.push(b);
return d};c.prototype.gotoPrev=function(){var b=this.Top();b&&(b.decMovesToGo(),1<this.length&&0===b.getMovesToGo()&&this.pop())};c.prototype.promoteLine=function(){var b=this.Top();if(b){var d=b.getLine(),e=b.getMovesToGo(),b=d.getParentLine(),c=d.getParentMoveIndex(),g=b[c],h=g.indexOfLine(d);g.removeLine(d);var l=d[0];g.moveLinesTo(l);b.swapMoves(c,d);l.insertLine(h,d);e+=c;this.pop();b=this.Top();b.setMovesToGo(e)}};c.prototype.getSimplePath=function(){for(var b=[],d=null,e=0,c=this.length;e<
c;++e){var g=this[e],h=g.getLine(),g=g.getMovesToGo(),l=0;d&&(l=d.indexOfLine(h));b.push({inxLine:l,mvsToGo:g});d=h[g]}return b};c.prototype.selfTest=function(){for(var b=null,d=0,e=0,c=this.length;e<c;++e){var g=this[e],h=g.getLine(),g=g.getMovesToGo();CBDebug.assert(h.getParentLine()===b);CBDebug.assert(h.getParentMoveIndex()===d);CBDebug.assert(!b||0<=h.getParentMove().indexOfLine(h));b=h;d=g}};return c}();"use strict";
CB.Position=function(){function c(b,d){this.piece=b;this.field=d}function b(b,d){return function(c){return c===b||d&&c===d}}var d=function(b){this.initFields();b?b.length&&("w"==b.charAt(0)?this.initString(b):this.initFEN(b)):this.initStartPos()};d.NOEP=-1;d.prototype.copy=function(b){for(var d=0;d<this.board.length;++d)this.board[d]=b.board[d];this.sd=b.sd;this.ep=b.ep;this.cr=b.cr;this.lastKillOrPawn=b;this.numPly=b.numPly};d.prototype.equals=function(b){if(!b||this.sd!=b.sd||this.ep!=b.ep||this.cr!=
b.cr)return!1;for(var d=0;d<this.board.length;++d)if(this.board[d]!==b.board[d])return!1;return!0};d.prototype.plyToMvNum=function(b,d){return idiv(b,2)+1};d.mvToPlyNum=function(b,d){return 2*(b-1)+d};d.prototype.getMoveNum=function(){return this.plyToMvNum(this.numPly,this.sd)};d.prototype.setMoveNum=function(b){this.numPly=d.mvToPlyNum(b,this.sd)};d.prototype.getPlyNum=function(){return this.numPly};d.prototype.initStartPos=function(){this.sd=CB.Side.WHITE;for(var b=CB.Square.C_A;b<=CB.Square.C_H;++b)this.board[CB.Square.I(b,
CB.Square.R_2)]=CB.Piece.W_PAWN,this.board[CB.Square.I(b,CB.Square.R_7)]=CB.Piece.B_PAWN;this.board[CB.Square.A1]=this.board[CB.Square.H1]=CB.Piece.W_ROOK;this.board[CB.Square.B1]=this.board[CB.Square.G1]=CB.Piece.W_KNIGHT;this.board[CB.Square.C1]=this.board[CB.Square.F1]=CB.Piece.W_BISHOP;this.board[CB.Square.D1]=CB.Piece.W_QUEEN;this.board[CB.Square.E1]=CB.Piece.W_KING;this.board[CB.Square.A8]=this.board[CB.Square.H8]=CB.Piece.B_ROOK;this.board[CB.Square.B8]=this.board[CB.Square.G8]=CB.Piece.B_KNIGHT;
this.board[CB.Square.C8]=this.board[CB.Square.F8]=CB.Piece.B_BISHOP;this.board[CB.Square.D8]=CB.Piece.B_QUEEN;this.board[CB.Square.E8]=CB.Piece.B_KING;this.cr=CB.CastleRights.ALL;this.numPly=this.lastKillOrPawn=0};d.prototype.boardEquals=function(b){for(var d=0;64>d;d++)if(this.board[d]!=b[d])return!1;return!0};d.prototype.initFEN=function(b){b=new StringIterator(b);var c=CB.Square.R_8,g=CB.Square.C_A,h;for(h=b.Next();0!==h&&!Char.IsWhiteSpace(h);h=b.Next())if("/"===h)--c,g=CB.Square.C_A;else if(Char.IsDigit(h))g+=
Number(h);else{var l=CB.Square.I(g,c);h=CB.Piece.fromString(h);CBDebug.assert(h!==CB.Piece.NONE);this.board[l]=h;g++}b.isEOF()||(b.skipWhile(Char.IsWhiteSpace),b.isEOF()||(this.sd=CB.Side.fromString(b.Current()),b.skipWhile(Char.IsWhiteSpace),b.isEOF()||(c=b.AcceptUntil(Char.IsWhiteSpace,!0),this.cr=CB.CastleRights.fromString(c),b.isEOF()||(b.skipWhile(Char.IsWhiteSpace),c=b.AcceptUntil(Char.IsWhiteSpace,!0),"-"===c?this.ep=d.NOEP:(c=CB.Square.fromString(c),this.ep=CB.Square.C(c)),this.numPly=d.mvToPlyNum(1,
this.sd),b.isEOF()||(b.skipWhile(Char.IsWhiteSpace),b.isEOF()||(c=b.AcceptUntil(Char.IsWhiteSpace,!0),this.lastKillOrPawn=Number(c),b.isEOF()||(b.skipWhile(Char.IsWhiteSpace),b.isEOF()||(b=b.AcceptUntil(Char.IsWhiteSpace,!0),(b=Number(b))||(b=1),this.numPly=d.mvToPlyNum(b,this.sd)))))))))};d.prototype.initString=function(b){this.initEmpty();for(var d=b.length,c=!1,h=0;h<d;h++)if(("b"==b[h]||"s"==b[h])&&"K"==b[h+1]){c="s"==b[h];break}for(var l=0,q=0,h=0;h<d;h++)switch(b[h]){case "K":l=CB.Piece.KING;
break;case "D":case "Q":l=CB.Piece.QUEEN;break;case "T":case "R":l=CB.Piece.ROOK;break;case "L":l=CB.Piece.BISHOP;break;case "B":l=c?CB.Piece.PAWN:CB.Piece.BISHOP;break;case "S":case "N":l=CB.Piece.KNIGHT;break;case "P":l=CB.Piece.PAWN;break;case "a":case "b":case "c":case "d":case "e":case "f":case "g":case "h":48<b.charCodeAt(h+1)&&57>b.charCodeAt(h+1)?this.board[(b.charCodeAt(h)-97<<3)+b.charCodeAt(h+1)-49]=l|q:"b"!=b[h]||c||(q=CB.Piece.BLACK);break;case "s":c&&(q=CB.Piece.BLACK);break;case "w":q=
CB.Piece.WHITE;break;case ":":this.parseAttributes(b.slice(h+1)),h=d}0==this.cr&&(this.board[CB.Square.E1]==CB.Piece.W_KING&&(this.board[CB.Square.H1]==CB.Piece.W_ROOK?this.cr|=CB.CastleRights.W_00:this.board[CB.Square.A1]==CB.Piece.W_ROOK&&(this.cr|=CB.CastleRights.W_000)),this.board[CB.Square.E8]==CB.Piece.B_KING&&(this.board[CB.Square.H8]==CB.Piece.B_ROOK?this.cr|=CB.CastleRights.B_00:this.board[CB.Square.A8]==CB.Piece.B_ROOK&&(this.cr|=CB.CastleRights.B_000)))};d.prototype.parseAttributes=function(b){CB.LOG(b);
"b"==b[0]&&(this.sd=CB.Side.BLACK)};d.prototype.canMakeNullMove=function(){return!this.isCheck()};d.prototype.makeNullMove=function(){return this.makeMove(new CB.Move(0,0))};d.prototype.unmakeNullMove=function(){return this.unmakeMove(new CB.Move(0,0))};d.prototype.makeMove=function(b){if(b){var c=new CB.Undo(this,b);++this.numPly;this.sd=CB.Side.other(this.sd);var g=this.ep;this.ep=d.NOEP;if(b.isNullMove())return c;var h=this.board[b.from],l=this.board[b.to];this.board[b.to]=this.board[b.from];this.board[b.from]=
CB.Piece.NONE;var q=CB.Square.R(b.from),r=CB.Square.R(b.to),t=CB.Square.C(b.from),v=CB.Square.C(b.to);CB.Piece.nominal(h)===CB.Piece.PAWN&&(v!==t&&v===g&&l===CB.Piece.NONE&&(l=CB.Piece.changeSide(h),g=CB.Square.I(v,q),this.board[g]=CB.Piece.NONE,c.setEP(l,g)),b.prom!==CB.Piece.NONE&&(l=CB.Piece.make(b.prom,CB.Piece.side(h)),this.board[b.to]=l),2===Math.abs(q-r)&&(this.ep=t));CB.Piece.nominal(h)===CB.Piece.KING&&2===Math.abs(v-t)&&(v===CB.Square.C_G?(h=CB.Square.I(CB.Square.C_H,q),q=CB.Square.I(CB.Square.C_F,
q)):(h=CB.Square.I(CB.Square.C_A,q),q=CB.Square.I(CB.Square.C_D,q)),this.board[q]=this.board[h],this.board[h]=CB.Piece.NONE,c.setCastle(h,q));if(this.cr){if(this.cr&CB.CastleRights.W_ALL)if(b.from===CB.Square.E1)this.cr&=~CB.CastleRights.W_ALL;else if(b.from===CB.Square.A1||b.to===CB.Square.A1)this.cr&=~CB.CastleRights.W_000;else if(b.from===CB.Square.H1||b.to===CB.Square.H1)this.cr&=~CB.CastleRights.W_00;if(this.cr&CB.CastleRights.B_ALL)if(b.from===CB.Square.E8)this.cr&=~CB.CastleRights.B_ALL;else if(b.from===
CB.Square.A8||b.to===CB.Square.A8)this.cr&=~CB.CastleRights.B_000;else if(b.from===CB.Square.H8||b.to===CB.Square.H8)this.cr&=~CB.CastleRights.B_00}return c}};d.prototype.unmakeMove=function(b,d){!b.isNullMove()&&(this.board[b.from]=d.mvd,this.board[b.to]=CB.Piece.NONE,this.board[d.fldVct]=d.vct,d.to2||d.from2)&&(this.board[d.from2]=this.board[d.to2],this.board[d.to2]=CB.Piece.NONE);this.cr=d.cr;this.ep=d.ep;--this.numPly;this.sd=CB.Side.other(this.sd)};d.prototype.V7=function(){var b=this.generateSemiLegals();
return this.filterLegals(b)};d.prototype.generateSemiLegals=function(b){for(var d=[],c=0;c<this.board.length;++c){var h=this.board[c];h!==CB.Piece.NONE&&(b&&h!==b||CB.Piece.side(h)===this.sd&&this._generateSemiLegalsFrom(c,h,d))}return d};d.prototype.generateSemiLegalsFrom=function(b,d){d||(d=this.board[b]);var c=[];this._generateSemiLegalsFrom(b,d,c);return c};d.prototype.V7From=function(b,d){var c=this.generateSemiLegalsFrom(b,d);return this.filterLegals(c)};d.prototype._generateSemiLegalsFrom=
function(b,d,c){switch(d){case CB.Piece.W_PAWN:case CB.Piece.B_PAWN:this.generatePawn(d,b,c);break;case CB.Piece.W_KNIGHT:case CB.Piece.B_KNIGHT:this.generateKnight(d,b,c);break;case CB.Piece.W_BISHOP:case CB.Piece.B_BISHOP:this.generateBishop(d,b,c);break;case CB.Piece.W_ROOK:case CB.Piece.B_ROOK:this.generateRook(d,b,c);break;case CB.Piece.W_QUEEN:case CB.Piece.B_QUEEN:this.generateQueen(d,b,c);break;case CB.Piece.W_KING:case CB.Piece.B_KING:this.generateKing(d,b,c)}};d.prototype.generateSemiLegalsTo=
function(b,d){return this.generateSemiLegals(d).filter(function(d){return d.to===b})};d.g_arrKnightMvs=[[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]];d.g_arrKingMvs=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]];d.g_arrBishopMvs=[[1,1],[-1,1],[-1,-1],[1,-1]];d.g_arrRookMvs=[[1,0],[0,1],[-1,0],[0,-1]];d.prototype.generateKnight=function(b,c,g){this.generate(b,c,d.g_arrKnightMvs,!1,g)};d.prototype.generateKing=function(b,c,g){this.generate(b,c,d.g_arrKingMvs,!1,g);if(b===CB.Piece.W_KING){if(!(this.cr&
CB.CastleRights.W_ALL)||this.isAttacked(CB.Square.E1,CB.Side.BLACK))return;this.cr&CB.CastleRights.W_00&&this.board[CB.Square.F1]===CB.Piece.NONE&&this.board[CB.Square.G1]===CB.Piece.NONE&&(this.isAttacked(CB.Square.F1,CB.Side.BLACK)||this.isAttacked(CB.Square.G1,CB.Side.BLACK)||g.push(CB.Move.g_mvW00));this.cr&CB.CastleRights.W_000&&this.board[CB.Square.D1]===CB.Piece.NONE&&this.board[CB.Square.C1]===CB.Piece.NONE&&this.board[CB.Square.B1]===CB.Piece.NONE&&(this.isAttacked(CB.Square.D1,CB.Side.BLACK)||
this.isAttacked(CB.Square.C1,CB.Side.BLACK)||g.push(CB.Move.g_mvW000))}b===CB.Piece.B_KING&&this.cr&CB.CastleRights.B_ALL&&!this.isAttacked(CB.Square.E8,CB.Side.WHITE)&&(this.cr&CB.CastleRights.B_00&&this.board[CB.Square.F8]===CB.Piece.NONE&&this.board[CB.Square.G8]===CB.Piece.NONE&&(this.isAttacked(CB.Square.F8,CB.Side.WHITE)||this.isAttacked(CB.Square.G8,CB.Side.WHITE)||g.push(CB.Move.g_mvB00)),this.cr&CB.CastleRights.B_000&&this.board[CB.Square.D8]===CB.Piece.NONE&&this.board[CB.Square.C8]===CB.Piece.NONE&&
this.board[CB.Square.B8]===CB.Piece.NONE&&(this.isAttacked(CB.Square.D8,CB.Side.WHITE)||this.isAttacked(CB.Square.C8,CB.Side.WHITE)||g.push(CB.Move.g_mvB000)))};d.prototype.generateRook=function(b,c,g){this.generate(b,c,d.g_arrRookMvs,!0,g)};d.prototype.generateBishop=function(b,c,g){this.generate(b,c,d.g_arrBishopMvs,!0,g)};d.prototype.generateQueen=function(b,d,c){this.generateRook(b,d,c);this.generateBishop(b,d,c)};d.prototype.generatePawn=function(b,d,c){var h=b===CB.Piece.W_PAWN?1:-1,l=b===CB.Piece.W_PAWN?
CB.Square.R_8:CB.Square.R_1,q=CB.Square.C(d),r=CB.Square.R(d),t=CB.Piece.side(b),v=r+h,y=CB.Square.I(q,v),l=v===l;this.board[y]===CB.Piece.NONE&&(l?(c.push(new CB.Move(d,y,CB.Piece.QUEEN)),c.push(new CB.Move(d,y,CB.Piece.ROOK)),c.push(new CB.Move(d,y,CB.Piece.BISHOP)),c.push(new CB.Move(d,y,CB.Piece.KNIGHT))):(y=new CB.Move(d,y),c.push(y)),b===CB.Piece.W_PAWN&&r===CB.Square.R_2||b===CB.Piece.B_PAWN&&r===CB.Square.R_7)&&(y=CB.Square.I(q,r+2*h),this.board[y]===CB.Piece.NONE&&(y=new CB.Move(d,y),c.push(y)));
for(y=-1;1>=y;y+=2){var A=q+y,v=r+h;if(CB.Square.isLegal(A,v)){var v=CB.Square.I(A,v),w=this.board[v];if(w!==CB.Piece.NONE&&CB.Piece.side(w)!==t)if(l)c.push(new CB.Move(d,v,CB.Piece.QUEEN)),c.push(new CB.Move(d,v,CB.Piece.ROOK)),c.push(new CB.Move(d,v,CB.Piece.BISHOP)),c.push(new CB.Move(d,v,CB.Piece.KNIGHT));else{var z=new CB.Move(d,v);c.push(z)}w===CB.Piece.NONE&&A===this.ep&&(w=t===CB.Side.WHITE?CB.Square.R_5:CB.Square.R_4,A=CB.Square.I(A,w),A=this.board[A],r===w&&A===CB.Piece.changeSide(b)&&(v=
new CB.Move(d,v),c.push(v)))}}};d.prototype.generate=function(b,d,c,h,l){b=CB.Piece.side(b);for(var q=CB.Square.R(d),r=CB.Square.C(d),t=0,v=c.length;t<v;++t){var y=c[t],A=r,w=q,z=h;do{A+=y[0];w+=y[1];if(!CB.Square.isLegal(A,w))break;var C=CB.Square.I(A,w),D=this.board[C];if(D!==CB.Piece.NONE)if(CB.Piece.side(D)===b)break;else z=!1;C=new CB.Move(d,C);l.push(C)}while(z)}};d.prototype.filterLegals=function(b){var d=this;return b.filter(function(b){return!d.isSuicideMove(b)})};d.prototype.isProm=function(b,
d){var c=this.sd;return this.board[b]==CB.Piece.make(CB.Piece.PAWN,c)&&CB.Square.R(d)==CB.Square.getPromRow(c)};d.prototype.isLegalFromTo=function(b,d){var c=new CB.Move(b,d);this.isProm(b,d)&&(c.prom=CB.Piece.QUEEN);return this.isLegalMove(c)};d.prototype.isLegalMove=function(b){return null!=b&&(b.isNullMove()||this.isSemiLegalMove(b))&&!this.isSuicideMove(b)};d.prototype.isSemiLegalMove=function(b){if(null==b)return!1;var d=b.from,c=b.to;if(d===c)return!1;var h=this.board[d];if(h===CB.Piece.NONE||
CB.Piece.side(h)!==this.sd)return!1;c=this.board[c];return c!==CB.Piece.NONE&&CB.Piece.side(h)===CB.Piece.side(c)?!1:this.generateSemiLegalsFrom(d,h).some(b.equals.bind(b))};d.prototype.isSuicideMove=function(b){var d=this.makeMove(b),c=this.isSuicidePos();this.unmakeMove(b,d);return c};d.prototype.initFields=function(){this.board=Array(CB.Board.SIZE);this.initEmpty()};d.prototype.initEmpty=function(){for(var b=0;64>b;b++)this.board[b]=CB.Piece.NONE;this.sd=CB.Side.WHITE;this.cr=0;this.ep=d.NOEP;
this.numPly=this.lastKillOrPawn=0};d.prototype.toNormalizedFEN=function(){for(var b="",c=CB.Square.R_8;c>=CB.Square.R_1;--c){for(var g=0,h=CB.Square.C_A;h<=CB.Square.C_H;++h){var l=CB.Square.I(h,c),l=this.board[l];l===CB.Piece.NONE?++g:(0<g&&(b+=g),g=0,b+=CB.Piece.toString(l))}0<g&&(b+=g);c>CB.Square.R_1&&(b+="/")}b=b+" "+CB.Side.toString(this.sd);b=b+" "+CB.CastleRights.toString(this.cr);b+=" ";this.ep===d.NOEP?b+="-":(c=this.getEPField(),b+=CB.Square.toString(c));return b};d.prototype.toFEN=function(){var b=
this.toNormalizedFEN(),b=b+" 0 ",d=this.getMoveNum();return b+d};d.prototype.toString=d.prototype.toFEN;d.prototype.toDescriptiveString=function(){for(var b=" KQNBRP".split(""),d="",c=[],h=[],l=0;16>l;l++)c.push([0,0,0,0,0,0,0,0,0,0]),h[l]=0;for(l=0;64>l;l++){var q=this.board[l]&15;q&&16>h[q]&&(c[q][h[q]++]=l)}d+="w";for(l=1;7>l;l++)if(0<h[l]){1<l&&(d+=",");for(var q=b[l],d=d+String(q),r=0;r<h[l];r++)q=c[l][r],d+=CB.Square.toString(q),r<h[l]-1&&(d+=",")}d+="/b";for(l=9;15>l;l++)if(0<h[l])for(9<l&&
(d+=","),q=b[l&7],d+=String(q),r=0;r<h[l];r++)q=c[l][r],d+=CB.Square.toString(q),r<h[l]-1&&(d+=",");return d};d.prototype.getPiece=function(b){return this.board[b]};d.prototype.getPieces=function(){for(var b=[],d=0;d<this.board.length;++d){var g=this.board[d];g!==CB.Piece.NONE&&(g=new c(g,d),b.push(g))}return b};d.prototype.countPieces=function(b){for(var d=0,c=0;c<this.board.length;++c)this.board[c]==b&&d++;return d};d.prototype.countAllPieces=function(b){for(var d=0,c=0;c<this.board.length;++c)this.board[c]&&
0!=(this.board[c]&CB.Piece.SIDE_MASK)==b&&d++;return d};c.prototype.toString=function(){var b=CB.Piece.nominal(this.piece);return CB.Piece.toString(b)+CB.Square.toString(this.field)};c.prototype.equals=function(b){return this.piece===b.piece&&this.field===b.field};d.prototype.getSideToMove=function(){return this.sd};d.prototype.isWTM=function(){return this.sd===CB.Side.WHITE};d.prototype.isBTM=function(){return this.sd===CB.Side.BLACK};d.prototype.setBTM=function(b){this.sd=b?CB.Side.BLACK:CB.Side.WHITE};
d.prototype.getBTM=d.prototype.isBTM;d.prototype.setCastleRights=function(b){this.cr=b};d.prototype.getEPFile=function(){return this.ep===d.NOEP?-1:this.ep%8};d.prototype.getCPPEPFile=function(){return this.ep===d.NOEP?0:this.ep%8+1};d.prototype.setCPPEPFile=function(b){this.ep=0>=b?d.NOEP:b-1};d.prototype.getEPField=function(){return this.ep===d.NOEP?-1:CB.Square.I(this.ep,this.sd===CB.Side.WHITE?CB.Square.R_6:CB.Square.R_3)};d.prototype.getEPCol=function(){return this.ep};d.prototype.getEPVictimField=
function(){return this.ep===d.NOEP?-1:CB.Square.I(this.ep,this.sd===CB.Side.WHITE?CB.Square.R_5:CB.Square.R_4)};d.prototype.getCastleRights=function(){return this.cr};d.prototype.getPossibleCastleRights=function(){var b=0;this.board[CB.Square.E1]===CB.Piece.W_KING&&(this.board[CB.Square.A1]===CB.Piece.W_ROOK&&(b|=CB.CastleRights.W_000),this.board[CB.Square.H1]===CB.Piece.W_ROOK&&(b|=CB.CastleRights.W_00));this.board[CB.Square.E8]===CB.Piece.B_KING&&(this.board[CB.Square.A8]===CB.Piece.B_ROOK&&(b|=
CB.CastleRights.B_000),this.board[CB.Square.H8]===CB.Piece.B_ROOK&&(b|=CB.CastleRights.B_00));return b};d.prototype.getPossibleEP=function(){for(var b=[],d=this.sd==CB.Side.WHITE?CB.Square.R_5:CB.Square.R_4,c=CB.Piece.make(CB.Piece.PAWN,this.sd),h=CB.Piece.changeSide(c),l=CB.Square.C_A;l<=CB.Square.C_H;++l){var q=CB.Square.I(l,d);this.board[q]===h&&(l>CB.Square.C_A&&this.board[CB.Square.I(l-1,d)]===c||l<CB.Square.C_H&&this.board[CB.Square.I(l+1,d)]===c)&&b.push(l)}return b};d.prototype.isAttacked=
function(b,d){return 0<this.getAttacksTo(b,d).length};d.prototype.getAttacksTo=function(b,d){var c=[];this._getAttacksTo(b,d,c);return c};d.prototype._getAttacksTo=function(b,d,c){this.getPawnAttacksTo(b,d,c);this.getKnightAttacksTo(b,d,c);this.getKingAttacksTo(b,d,c);this.getRangedAttacksTo(b,d,c)};d.prototype.getKnightAttacksTo=function(e,c,g){this.getAttacks(e,c,d.g_arrKnightMvs,b(CB.Piece.make(CB.Piece.KNIGHT,c)),!1,g)};d.prototype.getKingAttacksTo=function(e,c,g){this.getAttacks(e,c,d.g_arrKingMvs,
b(CB.Piece.make(CB.Piece.KING,c)),!1,g)};d.prototype.getQueenAttacksTo=function(e,c,g){this.getAttacks(e,c,d.g_arrBishopMvs,b(CB.Piece.make(CB.Piece.QUEEN,c)),!0,g);this.getAttacks(e,c,d.g_arrRookMvs,b(CB.Piece.make(CB.Piece.QUEEN,c)),!0,g)};d.prototype.getPawnMovesTo=function(b,d,c){if(this.board[b]===CB.Piece.NONE){var h=CB.Square.R(b),l=CB.Square.C(b);if(d!==CB.Side.WHITE||h!==CB.Square.R_1&&h!==CB.Square.R_2)if(d!==CB.Side.BLACK||h!==CB.Square.R_8&&h!==CB.Square.R_7){var q=d===CB.Side.WHITE?-1:
1;b=CB.Piece.make(CB.Piece.PAWN,d);d=d===CB.Side.WHITE?CB.Square.R_4:CB.Square.R_5;var r=CB.Square.I(l,h+q);this.board[r]===b?c.push(r):h===d&&this.board[r]===CB.Piece.NONE&&(h=CB.Square.I(l,h+2*q),this.board[h]===b&&c.push(h))}}};d.prototype.getBishopAttacksTo=function(e,c,g){this.getAttacks(e,c,d.g_arrBishopMvs,b(CB.Piece.make(CB.Piece.BISHOP,c)),!0,g)};d.prototype.getRookAttacksTo=function(e,c,g){this.getAttacks(e,c,d.g_arrRookMvs,b(CB.Piece.make(CB.Piece.ROOK,c)),!0,g)};d.prototype.getRangedAttacksTo=
function(e,c,g){this.getAttacks(e,c,d.g_arrRookMvs,b(CB.Piece.make(CB.Piece.ROOK,c),CB.Piece.make(CB.Piece.QUEEN,c)),!0,g);this.getAttacks(e,c,d.g_arrBishopMvs,b(CB.Piece.make(CB.Piece.BISHOP,c),CB.Piece.make(CB.Piece.QUEEN,c)),!0,g)};d.g_arrWhPawnAttks=[[1,1],[-1,1]];d.g_arrBlPawnAttks=[[1,-1],[-1,-1]];d.prototype.getPawnAttacksTo=function(e,c,g){c===CB.Side.WHITE?this.getAttacks(e,c,d.g_arrWhPawnAttks,b(CB.Piece.W_PAWN),!1,g):this.getAttacks(e,c,d.g_arrBlPawnAttks,b(CB.Piece.B_PAWN),!1,g)};d.prototype.getAttacks=
function(b,d,c,h,l,q){var r=CB.Square.R(b);b=CB.Square.C(b);for(var t=0,v=c.length;t<v;++t){var y=c[t],A=b,w=r,z=l;do{A-=y[0];w-=y[1];if(!CB.Square.isLegal(A,w))break;var C=CB.Square.I(A,w),D=this.board[C];if(D!==CB.Piece.NONE){if(CB.Piece.side(D)!==d)break;else z=!1;h(D)&&q.push(C)}}while(z)}};d.prototype.getKingsPos=function(b){b=CB.Piece.make(CB.Piece.KING,b);return this.board.indexOf(b)};d.prototype.getPiecePos=function(b,d){var c=CB.Piece.make(b,d);return this.board.indexOf(c)};d.prototype.isCheck=
function(){var b=this.getKingsPos(this.sd),d=CB.Side.other(this.sd);return this.isAttacked(b,d)};d.prototype.isSuicidePos=function(){var b=CB.Side.other(this.sd),b=this.getKingsPos(b);return this.isAttacked(b,this.sd)};d.prototype.isMate=function(){return this.isCheck()?!this.hasLegals():!1};d.prototype.isStaleMate=function(){return this.isCheck()?!1:!this.hasLegals()};d.prototype.swapSide=function(){return this.isCheck()||this.isMate()||this.isStaleMate()?!1:(this.makeMove(new CB.Move),!0)};d.prototype.hasLegals=
function(){return 0<this.V7().length};d.prototype.getVictim=function(b){var d=this.board[b.to];return d!==CB.Piece.NONE?d:CB.Piece.nominal(this.board[b.from])===CB.Piece.PAWN&&CB.Square.C(b.from)!==CB.Square.C(b.to)?(b=CB.Square.I(CB.Square.C(b.to),CB.Square.R(b.from)),this.board[b]):CB.Piece.NONE};d.prototype.isTake=function(b){return tgis.getVictim(b)!==CB.Piece.NONE};d.prototype.calcNeed=function(b){var d=b.from,c=this.board[d],h={needCol:!1,needRow:!1},l=CB.Piece.nominal(c);if(l===CB.Piece.PAWN||
l===CB.Piece.KING)return h;for(var q=[],r=0;r<CB.Board.SIZE;++r)this.board[r]===c&&r!==d&&q.push(r);if(!q.length||l===CB.Piece.BISHOP&&q.every(function(b){return CB.Square.isDark(b)!==CB.Square.isDark(d)}))return h;for(var r=l=!0,t=!1,v=0,y=q.length;v<y;++v){var A=q[v];this.generateSemiLegalsFrom(A,c).some(function(d){return d.to===b.to})&&(t=!0,l&=CB.Square.C(A)!==CB.Square.C(d),r&=CB.Square.R(A)!==CB.Square.R(d))}t&&(h.needCol=l||!r,h.needRow=!l);return h};d.prototype.preCalcCtx=function(b){this.preSetMinCtx(b);
if(!b.isNullMove()){var d=this.calcNeed(b);b.setNeedCol(d.needCol);b.setNeedRow(d.needRow)}};d.prototype.preSetMinCtx=function(b){if(b.isNullMove())b.setMoved(CB.Piece.make(CB.Piece.PAWN,this.sd)),b.setVictim(CB.Piece.NONE);else{b.setMoved(this.board[b.from]);var d=this.getVictim(b);b.setVictim(d);b.setIsCastling()}};d.prototype.postCalcCtx=function(b,d){if(b.isNullMove())b.setCheck(!1);else{var c=this.isCheck();b.setCheck(c);c&&d&&b.setMate(!this.hasLegals())}};d.prototype.read=function(b){this.board=
b.readByteArray(CB.Board.SIZE);this.sd=b.readInt();this.ep=b.readByte()-1;this.cr=b.readByte();this.numPly=0};d.prototype.write=function(b){b.writeByteArray(this.board,CB.Board.SIZE);b.writeInt(this.sd);b.writeByte(this.ep+1);b.writeByte(this.cr)};d.prototype.copyTo=function(b){b.sd=this.sd;b.ep=this.ep;b.cr=this.cr;for(var d=0;64>d;d++)b.board[d]=this.board[d]};d.packBoard=function(b){for(var d=Array(32),c=0,h=d.length;c<h;++c)d[c]=b[2*c]|b[2*c+1]<<4;return d};d.unpackBoard=function(b){for(var d=
Array(2*b.length),c=0,h=b.length;c<h;++c)d[2*c]=b[c]&15,d[2*c+1]=b[c]>>4;return d};d.prototype.fillSquaresOfSide=function(b,d){for(var c=0;c<this.board.length;c++)CB.Piece.side(this.board[c])==d&&(b[c]=this.board[c])};d.prototype.setEquals=function(b){for(var d=0;d<this.board.length;d++)if(this.board[d]!=b.board[d])return!1;return this.sd!=b.sd||this.ep!=b.ep||this.cr!=b.cr?!1:!0};d.prototype.setGreater=function(b){for(var d=0;d<this.board.length;d++)if(this.board[d]!=b.board[d])return this.board[d]>
b.board[d];return this.sd!=b.sd?this.sd>b.sd:this.ep!=b.ep?this.ep>b.ep:this.cr!=b.cr?this.cr>b.cr:!1};d.prototype.dump=function(b){var d=new CB.Board;d.copyFrom(this.board);d.toDebugStrs().forEach(void 0!==b?b:function(b){CB.LOG(b)});d="s="+this.sd+", ep="+this.ep+", cr="+this.cr;void 0!==b?b(d):CB.LOG(d)};d.prototype.isLegal=function(){var b=this.getPieces();if(32<b.length||2>b.length)return!1;for(var d=Array(CB.Piece.B_PAWN+1),c=0;c<d.length;++c)d[c]=0;for(c=0;c<b.length;++c){var h=b[c];++d[h.piece];
if(CB.Piece.nominal(h.piece)===CB.Piece.PAWN&&(h=CB.Square.R(h.field),h==CB.Square.R_1||h==CB.Square.R_8))return!1}return 1!==d[CB.Piece.W_KING]||1!==d[CB.Piece.B_KING]||8<d[CB.Piece.W_PAWN]||8<d[CB.Piece.B_PAWN]?!1:!0};d.prototype.isBoardEqual=function(b){if(b.length!=this.board.length)return!1;for(var d=0;d<this.board.length;d++)if(this.board[d]!=b[d])return!1;return!0};d.prototype.findSquaresOfPiece=function(b){for(var d=[],c=0;c<this.board.length;c++)this.board[c]==b&&d.push(c);return d};return d}();
"use strict";
CB.Annotation=function(){var c=function(){};c.prototype={};c.DIAG_CHAR="[#]";c.prototype.toString=function(){var b="",d;for(d in this)this.hasOwnProperty(d)&&(b+=this[d].toString());return b};c.prototype._read=function(b,d){for(var e=0;e<d;++e){var c=b.readShort(),g=AnnoRec.readHeader(b);CBDebug.assert(g.len===c,"LEN OK");g.len-=AnnoRec.ANNO_HEAD_SIZE;(c=AnnoFactory.factory(g.type))?(c.read(g.len,b),this.setItem(g.type,c)):b.skip(g.len)}return this};c.prototype._read2=function(b,d){this._read(b,d);
return this};c.prototype.write=function(b){var d=0,e;for(e in this)this.hasOwnProperty(e)&&d++;b.writeShort(d);for(e in this)this.hasOwnProperty(e)&&this[e].write(b,e)};c.prototype.write2=function(b){var d=[],e;for(e in this)this.hasOwnProperty(e)&&d.push(e);var c=b.getPos();b.writeByte(0);var g=0;for(e=0;e<d.length;e++)this[d[e]].write&&(this[d[e]].write(b,d[e]),g++);d=b.getPos();b.setPos(c);b.writeByte(g);b.setPos(d)};c.write=function(b,d){d?d.write(b):b.writeShort(0)};c.write2=function(b,d){d?
d.write2(b):b.writeByte(0)};c.prototype.read=function(b){var d=b.readShort();this._read(b,d)};c.prototype.read2=function(b){var d=b.readByte();d&&this._read2(b,d)};c.prototype.fromDataBuf=c.prototype.read;c.prototype.Vz=c.prototype.write;c.readFactory=function(b){var d=b.readShort();return d?(new CB.Annotation)._read(b,d):null};c.readFactory2=function(b){var d=b.readUint8();return d?(new CB.Annotation)._read2(b,d):null};c.prototype.empty=function(){for(var b in this)if(this.hasOwnProperty(b))return!1;
return!0};c.prototype.count=function(){var b=0,d;for(d in this)this.hasOwnProperty(d)&&b++;return b};c.prototype.setItem=function(b,d){this[b]=d};c.prototype.hasItem=function(b){return!!this[b]};c.prototype.getItem=function(b){return this[b]};c.prototype.deleteItem=function(b){delete this[b]};c.prototype.addPreText=function(b){this[CB.AnnoType.PRETEXT]=new CB.TextAnno(b)};c.prototype.addPostText=function(b){this[CB.AnnoType.POSTTEXT]&&this[CB.AnnoType.POSTTEXT].m_str.length?this[CB.AnnoType.POSTTEXT].addText(" "+
b):this[CB.AnnoType.POSTTEXT]=new CB.TextAnno(b)};c.prototype.hasDiagram=function(){if(this[CB.AnnoType.POSTTEXT]&&this[CB.AnnoType.POSTTEXT].m_str.length)return-1!=this[CB.AnnoType.POSTTEXT].m_str.search("[#]")};c.prototype.toggleDiagram=function(){this[CB.AnnoType.POSTTEXT]&&this[CB.AnnoType.POSTTEXT].m_str.length?-1!=this[CB.AnnoType.POSTTEXT].m_str.search("[#]")?(this[CB.AnnoType.POSTTEXT].m_str=this[CB.AnnoType.POSTTEXT].m_str.replace("[#]",""),this[CB.AnnoType.POSTTEXT].m_str.length||delete this[CB.AnnoType.POSTTEXT]):
this[CB.AnnoType.POSTTEXT].m_str+="[#]":this[CB.AnnoType.POSTTEXT]=new CB.TextAnno("[#]")};c.prototype.removeDiagram=function(){};c.prototype.hasPreText=function(){return this.hasItem(CB.AnnoType.PRETEXT)};c.prototype.getPreText=function(){if(this.hasPreText())return this[CB.AnnoType.PRETEXT].getString()};c.prototype.getPostText=function(){if(this.hasPostText())return this[CB.AnnoType.POSTTEXT].getString()};c.prototype.hasPostText=function(){return this.hasItem(CB.AnnoType.POSTTEXT)};c.prototype.addSymbol=
function(b){this[CB.AnnoType.SYMBOL]||(this[CB.AnnoType.SYMBOL]=new CB.SymbolsAnno);this[CB.AnnoType.SYMBOL].addSymbol(b)};c.prototype.hasSymbol=function(){return void 0!==this[CB.AnnoType.SYMBOL]};c.prototype.getSymbol=function(){return this[CB.AnnoType.SYMBOL]};c.prototype.hasColSquares=function(){return this.hasItem(CB.AnnoType.SQUARE_LIST)};c.prototype.hasArrows=function(){return this.hasItem(CB.AnnoType.ARROW_LIST)};c.prototype.hasTraining=function(){return this.hasItem(CB.AnnoType.TRAINING)};
c.prototype.getTraining=function(){return this[CB.AnnoType.TRAINING]};c.prototype.setTraining=function(b){b?this[CB.AnnoType.TRAINING]=b:delete this[CB.AnnoType.TRAINING]};return c}();"use strict";
CB.GameResultEnum={GAME_UNFINISHED:-1,BLACK_WINS:0,DRAW:1,WHITE_WINS:2,LINE:3,UNDEFINED_RESULT:3,UNDEFINED:3,isFinished:function(c){return c>=this.BLACK_WINS&&c<=this.WHITE_WINS},toString:function(c){switch(c){case this.GAME_UNFINISHED:return lm.IN_PROGRESS;case this.WHITE_WINS:return"1\u20130";case this.BLACK_WINS:return"0\u20131";case this.DRAW:return"\u00bd\u2013\u00bd";case this.UNDEFINED_RESULT:return"";default:return""}},fromString:function(c){switch(c){case "\u00bd\u2013\u00bd":case "1/2-1/2":case "1/2":return this.DRAW;
case "1\u20130":case "1-0":return this.WHITE_WINS;case "0\u20131":case "0-1":return this.BLACK_WINS}}};
CB.GameResult=function(){var c=function(b){this.n=b};c.prototype.isFinished=function(){return CB.GameResultEnum.isFinished(this.n)};c.prototype.toString=function(){return CB.GameResultEnum.toString(this.n)};c.prototype.toPGNString=function(){switch(this.n){default:return"*";case CB.GameResultEnum.WHITE_WINS:return"1-0";case CB.GameResultEnum.BLACK_WINS:return"0-1";case CB.GameResultEnum.DRAW:return"1/2-1/2"}};return c}();
CB.GameHeader=function(){var c=function(){this.white=new CB.PlayerData;this.black=new CB.PlayerData;this.event=new CB.EventData;this.player=[this.white,this.black];this.result=CB.GameResultEnum.LINE;this.clockParams=null};c.prototype.annotator="";c.prototype.round=0;c.prototype.subRound=0;c.prototype.board=0;c.prototype.eco="";c.prototype.result=CB.GameResultEnum.LINE;c.prototype.eloWh=0;c.prototype.eloBl=0;c.prototype.date=new CB.Date;c.prototype.clockParams=null;c.prototype.getStrPlayers=function(b,
d){var e=this.white.getListStr(d||0),c=this.black.getListStr(d||0);c&&c.length&&(b?(0<this.eloWh&&(e+=" ("+this.eloWh+")"),e=e+" - "+c,0<this.eloBl&&(e+=" ("+this.eloBl+")")):e=e+"-"+c);return e};c.prototype.toString=function(){var b=this.event.toString(),d=this.date.toLocaleString(),e=this.getStrPlayers(!0,999);b&&(e+=", "+b);d&&(e+=" "+d);return e};c.prototype.getWhite=function(){return this.white.toString()};c.prototype.getClockParams=function(){return this.clockParams};c.prototype.setClockParams=
function(b){this.clockParams=b};c.prototype.setWhite=function(b){this.white.init(b)};c.prototype.getBlack=function(){return this.black.toString()};c.prototype.setBlack=function(b){this.black.init(b)};c.prototype.getECO=function(){return this.eco};c.prototype.setECO=function(b){this.eco=b};c.prototype.getEvent=function(){return this.event.event};c.prototype.setEvent=function(b){this.event.event=b};c.prototype.getAnnotator=function(){return this.annotator};c.prototype.setAnnotator=function(b){this.annotator=
b};c.prototype.getSite=function(){return this.event.site};c.prototype.setSite=function(b){this.event.site=b};c.prototype.isDefined=function(){return this.getWhite()||this.getBlack()};c.prototype.getResult=function(){return this.result};c.prototype.getCBResult=function(){return new CB.GameResult(this.result)};c.prototype.setResult=function(b){var d=this.result;this.result="undefined"!=typeof b?b:CB.GameResultEnum.LINE;return d};c.prototype.setRoundStr=function(b){b&&(b=b.split("."),this.round=parseInt(b[0],
10),1<b.length&&(this.subRound=parseInt(b[1],10)))};c.prototype.getRoundStr=function(){var b="";this.round&&(b=""+this.round,this.subRound&&(b=b+"."+this.subRound));return b};c.prototype.getEloWhite=function(){return this.eloWh};c.prototype.setEloWhite=function(b){this.eloWh=b};c.prototype.getEloBlack=function(){return this.eloBl};c.prototype.setEloBlack=function(b){this.eloBl=b};c.prototype.getMaxElo=function(){return Math.max(this.eloWh,this.eloBl)};c.prototype.setDateStr=function(b){this.date=
CB.Date.fromPGNString(b)};c.prototype.getLocaleDateStr=function(){return this.date.toLocaleString()};c.prototype.getDateStr=function(){return this.date.toPGNString()};c.prototype.setDeleted=function(b){this.flags=(this.deleted=b)?this.flags|1:this.flags&-2};c.prototype.read=function(b){this.white=CB.PlayerData.readFactory(b);this.black=CB.PlayerData.readFactory(b);try{this.event=CB.EventData.readFactory(b);CB.SourceData.readFactory(b);this.annotator=CB.AnnotatorData.readFactory(b).name;this.eloWh=
b.readShort();this.eloBl=b.readShort();this.nEco=b.Vu();this.eco=CB.GameHeader.ECOtoString(this.nEco);this.result=CB.GameHeader.readResult(b);this.date=new CB.Date;var d=b.readInt();this.date.constructFromNum(d);this.plyCount=b.readShort();this.round=b.readByte();this.subRound=b.readByte();b.readInt();b.readInt();b.skipSizedRead()}catch(e){return console.log(e),!1}return!0};c.prototype.compactFromDataBuf=function(b){b.beginSizedRead();this.eType=b.V11();this.nGame=b.V10();this.white=CB.PlayerData.readFactory(b);
this.black=CB.PlayerData.readFactory(b);this.event=CB.EventData.readFactory(b);this.eloWh=b.V11();this.eloBl=b.V11();this.result=CB.GameHeader.readResult(b);this.date=new CB.Date;this.date.fromDataBuf(b);this.plyCount=b.V11();this.round=b.readByte();this.subRound=b.readByte();b.Vw();b.Vw();this.nEco=b.Vu();this.eco=CB.GameHeader.ECOtoString(this.nEco);this.flags=b.Vu();this.deleted=!!(this.flags&1);b.endSizedRead()};c.prototype.compactToDataBuf=function(b){b.beginSizedWrite();void 0!==this.eType?
b.Vv(this.eType):b.Vv(1);void 0!==this.nGame?b.Vx(this.nGame):b.Vx(0);this.white.write(b);this.black.write(b);this.event.write(b);b.writeShort(this.eloWh);b.writeShort(this.eloBl);c.writeResult(this.result,b);void 0===this.date&&(this.date=new CB.Date(0));this.date.Vz(b);this.plyCount?b.Vv(this.plyCount):b.Vv(0);b.writeByte(this.round);b.writeByte(this.subRound);b.Vh(0);b.Vh(0);this.nEco?b.Vi(this.nEco):b.Vi(0);void 0===this.flags&&(this.flags=0);this.deleted&&(this.flags|=1);b.Vi(this.flags);b.endSizedWrite()};
c.prototype.write=function(b){this.white.write(b);this.black.write(b);this.event.write(b);(new CB.SourceData).write(b);(new CB.AnnotatorData(this.annotator)).write(b);b.writeShort(this.eloWh);b.writeShort(this.eloBl);b.writeShort(0);c.writeResult(this.result,b);b.writeInt(0);this.plyCount?b.writeShort(this.plyCount):b.writeShort(0);b.writeByte(this.round);b.writeByte(this.subRound);b.writeInt(0);b.writeInt(0);b.beginSizedWrite();b.endSizedWrite()};c.readResult=function(b){var d=b.readByte();b.readByte();
b.readByte();return d};c.writeResult=function(b,d){d.writeByte(b);d.writeByte(0);d.writeByte(0)};c.ECOtoString=function(b){var d,e;d=b>>7;if(0<d&&500>=d){if(d--,e=String.fromCharCode("A".charCodeAt()+d/100)[0],d%=100,e+=String.fromCharCode("0".charCodeAt()+d/10)[0],e+=String.fromCharCode("0".charCodeAt()+d%10)[0],d=b&127)e+="/",100<=d?e+="99":(e+=String.fromCharCode("0".charCodeAt()+d/10)[0],e+=String.fromCharCode("0".charCodeAt()+d%10)[0])}else e="";return e};c.prototype.toJson=function(){return{gameNo:this.nGame,
white:this.white.getListStr(1),black:this.black.getListStr(1),event:this.event.event,date:this.date.getYear(),result:CB.GameResultEnum.toString(this.result),elow:this.eloWh,elob:this.eloBl,eco:this.eco,round:this.round,subRound:this.subRound,plyCount:this.plyCount,flags:this.flags}};c.prototype.matchesFilterVal=function(b){return-1!=this.white.last.search(b)||-1!=this.black.last.search(b)||-1!=this.event.site.search(b)||-1!=this.event.event.search(b)?!0:!1};return c}();
CB.PlayerData=function(){var c=function(b,d){this.first=b?b:"";this.last=d?d:""};c.prototype.toString=function(){return this.first&&this.first.length&&this.last&&this.last.length?String.formatEx("{last}, {first}",this):this.last||this.first};c.prototype.getListStr=function(b){return b&&this.first&&this.last&&this.first.length&&this.last.length?this.last+","+this.first.substr(0,b):this.last||this.first};c.g_splitOnComma=!0;c.g_splitOnSpace=!1;c.prototype.init=function(b){if(c.g_splitOnComma){var d=
b.split(",");if(2===d.length){this.first=d[1].trim();this.last=d[0].trim();return}}if(c.g_splitOnSpace&&(d=b.split(" "),1<d.length)){this.first=d[0];this.last=d.slice(1).join(" ");return}this.last=b;this.first=""};c.create=function(b){var d=new c;d.init(b);return d};c.prototype.read=function(b){this.last=b.readByteLenASCIIString(50);this.first=b.readByteLenASCIIString(50);this.last=this.last.trim();this.first=this.first.trim()};c.readFactory=createReadFactory(c);c.prototype.write=function(b){b.writeByteLenASCIIString(this.last);
b.writeByteLenASCIIString(this.first)};return c}();
CB.EventData=function(){var c=function(){this.event=this.site="";this.rounds=this.flags=this.category=this.nation=this.type=this.dt=0};c.prototype.read=function(b){this.site=b.readByteLenASCIIString(100);this.event=b.readByteLenASCIIString(100);this.dt=b.readInt();this.type=b.readShort();this.nation=b.readShort();this.category=b.readByte();this.flags=b.readByte();this.rounds=b.readShort()};c.readFactory=createReadFactory(c);c.prototype.write=function(b){b.writeByteLenASCIIString(this.site);b.writeByteLenASCIIString(this.event);
b.writeInt(this.dt);b.writeShort(this.type);b.writeShort(this.nation);b.writeByte(this.category);b.writeByte(this.flags);b.writeShort(this.rounds)};c.prototype.toString=function(){var b=this.event;this.site&&this.event&&this.site!=this.event&&(b+=" ");this.site!=this.event&&(b+=this.site);return b};return c}();
CB.SourceData=function(){var c=function(){this.publisher=this.source="";this.quality=this.version=this.verdt=this.pubdt=0};c.prototype.read=function(b){this.source=b.readByteLenASCIIString(100);this.publisher=b.readByteLenASCIIString(100);this.pubdt=b.readInt();this.verdt=b.readInt();this.version=b.readByte();this.quality=b.readByte()};c.readFactory=createReadFactory(c);c.prototype.write=function(b){b.writeByteLenASCIIString(this.source);b.writeByteLenASCIIString(this.publisher);b.writeInt(this.pubdt);
b.writeInt(this.verdt);b.writeByte(this.version);b.writeByte(this.quality)};return c}();
CB.TeamData=function(){var c=function(){this.team="";this.nation=this.seasoned=this.num=0};c.prototype.toString=function(){return this.num?String.formatEx("{team} {num}",this):this.team};c.prototype.read=function(b){this.team=b.readByteLenASCIIString(100);this.num=b.readShort();this.seasoned=b.readByte();this.nation=b.readByte()};c.readFactory=createReadFactory(c);c.prototype.write=function(b){b.writeByteLenASCIIString(this.team);b.writeShort(this.num);b.writeByte(this.seasoned);b.writeByte(this.nation)};
return c}();CB.AnnotatorData=function(){var c=function(b){this.name="";b&&(this.name=b)};c.prototype.toString=function(){return this.name};c.prototype.read=function(b){this.name=b.readByteLenASCIIString(100)};c.readFactory=createReadFactory(c);c.prototype.write=function(b){b.writeByteLenASCIIString(this.name)};return c}();"use strict";CB.MoveEnterType={CANCEL:-1,TYPE_MASK:-64,LINE_MASK:63,QUERY:64,OVERWRITE_MAIN:128,OVERWRITE_LINE:256,NEWLINE:512,INSERT_MAIN:1024,NEWMAINLINE:2048,INSERT_LINE:4096};
CB.Game=function(){var c=function(b,d){b||(b=new CB.Position);this.start=b;d||(d=new CB.MoveLine);this.mainLine=d;this.stk=new CB.LineStack(this.mainLine);this.hdr=new CB.GameHeader;this.initPost()};c.prototype.start=null;c.prototype.cur=null;c.prototype.mainLine=null;c.prototype.stk=null;c.prototype.hdr=null;c.prototype.init=function(b,d){c.call(this,b,d);this.fireOnChanged();this.fireOnHeaderChanged()};c.prototype.initPost=function(){this.cur=ObjUtil.clone(this.start);c.initLine(this.start,this.mainLine)};
c.prototype.assign=function(b,d){this.start=b.start;this.cur=b.cur;this.mainLine=b.mainLine;this.stk=b.stk;this.hdr=b.hdr;this.replaceGameNo=b.replaceGameNo;this.replaceDBId=b.replaceDBId;d||(this.fireOnResetGame(),this.fireOnCurPosChanged(),this.fireOnChanged(),this.fireOnHeaderChanged())};c.prototype.getMoves=function(){return this.mainLine};c.prototype.setMoves=function(b){this.mainLine=b};c.prototype.getMainLine=c.prototype.getMoves;c.prototype.getCurPos=function(){return this.cur};c.prototype.getStartPos=
function(){return this.start};c.prototype.isNormalInit=function(){var b=new CB.Position;return ObjUtil.equals(this.start,b)};c.prototype.getNextMove=function(){var b=this.stk.Top();if(b){if(b.isLineEnd())return null;var d=b.getLine(),b=b.getMovesToGo();return d[b]}return null};c.prototype.getLastMove=function(){if(this.stk){var b=this.stk.Top();if(!b||b.isLineStart())return null;var d=b.getLine();if(d)return b=b.getMovesToGo(),d[b-1]}return null};c.prototype.getPreviousMove=c.prototype.getLastMove;
c.initLine=function(b,d){for(var e=ObjUtil.clone(b),f=0,g=d.length;f<g;++f){var h=d[f];e.preCalcCtx(h);if(h.hasLines())for(var l=h.getSubLines(),q=0,r=l.length;q<r;++q)c.initLine(e,l[q]);e.makeMove(h);e.postCalcCtx(h,f===d.length-1)}};c.prototype.reset=function(){c.apply(this);this.fireOnResetGame();this.fireOnCurPosChanged();this.fireOnChanged();this.fireOnHeaderChanged()};c.prototype.setResult=function(b){this.hdr.setResult(b);this.fireOnChanged();this.fireOnHeaderChanged()};c.prototype.getResult=
function(){return this.hdr.getResult()};c.prototype.getTopItem=function(){return this.stk.Top()};c.prototype.getTopLine=function(){if(this.stk.Top())return this.stk.Top().getLine()};c.prototype.getTopMovesToGo=function(){if(this.stk.Top())return this.stk.Top().getMovesToGo()};c.prototype.isLineEnd=function(){return this.stk.Top()?this.stk.Top().isLineEnd():!1};c.prototype.isOnMainLine=function(){return 1===this.stk.length};c.prototype.isGameStart=function(){return 1===this.stk.length&&this.stk[0].isLineStart()};
c.prototype.isGameEnd=function(){return 1===this.stk.length&&this.stk[0].isLineEnd()};c.prototype.getStackPos=function(b){for(var d=ObjUtil.clone(this.start),e=0,c=b.length;e<c;++e)for(var g=b[e],h=g.getLine(),g=g.getMovesToGo(),l=0;l<g;++l)d.makeMove(h[l]);return d};c.prototype.getLinePos=function(b,d){var e=c.getStackForLine(b,d);return this.getStackPos(e)};c.prototype.setStack=function(b){this.stk=b;0<this.stk.length&&(this.mainLine=this.stk[0].line);this.cur=this.getStackPos(this.stk)};c.prototype.getSimplePath=
function(){return this.stk.getSimplePath()};c.prototype.getHeader=function(){return this.hdr};c.prototype.setHeader=function(b){this.hdr=b};c.prototype.getGameNo=function(){return this.hdr.nGame};c.prototype.requiresPremiumForDownload=function(){var b=0;this.forAllMoves(function(d){b++});return b>2*this.getMainLine().length?5<this.hdr.annotator.length:!1};c.prototype.selfTest=function(){CBDebug.call(this.stk,this.stk.selfTest);CBDebug.call(this.mainLine,this.mainLine.selfTest,this.start,null,0)};
c.prototype.getLineCnt=function(b){return this.stk.length};c.prototype.isOnLastMove=function(){return this.getMoveIndex()==this.mainLine.length};c.prototype.getPlyNum=function(){return this.getCurPos().getPlyNum()};c.prototype.getMoveNo=c.prototype.getPlyNum;c.prototype.getMoveCount=function(){return this.mainLine.length};c.prototype.getMoveBaggage=function(){return this.getLastMove()?this.getLastMove().getBaggage():this.baggage};c.prototype.setMoveBaggage=function(b){this.getLastMove()?this.getLastMove().setBaggage(b):
this.baggage=b;this.fireOnChanged()};c.prototype.getAnno=function(b){if(this.getLastMove())return this.getLastMove().getAnnoItem(b);if(this.mainLine.anno)return this.mainLine.anno.getItem(b)};c.prototype.setAnno=function(b,d){this.getLastMove()&&(this.getLastMove().setAnnoItem(b,d),this.fireOnChanged())};c.prototype.setAnnoBeforeFirstMove=function(b,d,e){this.mainLine.anno||(this.mainLine.anno=new CB.Annotation);this.mainLine.anno.setItem(b,d);e||this.fireOnChanged()};c.prototype.getOrCreateCurrAnno=
function(){if(this.getPreviousMove())return this.getPreviousMove().hasAnno()||this.getPreviousMove().setAnno(new CB.Annotation),this.getPreviousMove().getAnno();this.getMoves().hasAnno()||this.getMoves().setAnno(new CB.Annotation);return this.getMoves().getAnno()};c.prototype.updateFromExtern=function(){this.fireOnChanged();this.fireOnCurPosChanged()};c.prototype.updateHeaderFromExtern=function(){this.fireOnHeaderChanged()};c.prototype.deleteAnnosInCurLine=function(b,d){for(var e=this.getCurLine(),
c=0;c<e.length;c++)e[c]&&(b?e[c].deleteAnnoItem(b):e[c].setAnno(null));d||this.fireOnChanged()};c.prototype.deleteAnno=function(b,d){this.getLastMove()&&(this.getLastMove().deleteAnnoItem(b),d||this.fireOnAnnoChanged())};c.prototype.getEvaluationProfile=function(){if(this.mainLine.anno&&this.mainLine.anno[CB.AnnoType.EVAL_PROFILE])return this.mainLine.anno[CB.AnnoType.EVAL_PROFILE];var b=this.getCurLine();if(b.length&&b[0].annos)return b[0].annos[CB.AnnoType.EVAL_PROFILE]};c.prototype.initEvaluationProfile=
function(b){this.mainLine.anno||(this.mainLine.anno=new CB.Annotation);b=b||new CB.EvalProfileAnno;return this.mainLine.anno[CB.AnnoType.EVAL_PROFILE]=b};c.prototype.deleteEvaluationProfile=function(){this.mainLine.anno&&delete this.mainLine.anno[CB.AnnoType.EVAL_PROFILE]};c.prototype.toString=function(){for(var b=new CB.NotationGenerator(CB.V1),d=this.hdr.toString(),d=d+"\r\n",e=0;e<this.mainLine.length;e++){var c=b.getMoveNota(this.mainLine[e]),g=b.getStrMoveNumInLine(e,this.getStartPos().getPlyNum()),
d=d+(g+c);e<this.mainLine.length-1&&(d+=" ")}return d+=" "+this.hdr.getCBResult().toString()};c.prototype.onSync=function(b){if(V15.panelMgr&&V15.panelMgr.onSync)V15.panelMgr.onSync(b)};c.createTestGame=function(){return new CB.Game};c.prototype.delayChangedEvents=function(b){this.delayfireOnCurPosChanged(b);this.delayfireOnChanged(b);this.delayfireOnHeaderChanged(b);this.delayfireOnAnnoChanged(b)};c.prototype.continueChangedEvents=function(){this.continuefireOnCurPosChanged();this.continuefireOnChanged();
this.continuefireOnHeaderChanged();this.continuefireOnAnnoChanged()};Ve.initForListeners(c);Ve.addEvent(c,"CurPosChanged",function(){return[this,this.getCurPos()]});Ve.addEvent(c,"Navigate",function(){return[this]});Ve.addEvent(c,"Move",function(){return[this,this.getLastMove()]});Ve.addEvent(c,"Changed");Ve.addEvent(c,"HeaderChanged");Ve.addEvent(c,"AnnoChanged");Ve.addEvent(c,"ResetGame");Ve.addEvent(c,"GameEnd",function(){return[this,this.getResult()]});Ve.addEvent(c,"ClickInNotation");Ve.addEvent(c,
"NotaDoubleClick");Ve.addEvent(c,"Eval");return c}();
(function(c){c.prototype.jump=function(b){b=this.getMoveIndex()+b;1>b&&(b=1);b>this.mainLine.length&&(b=this.mainLine.length);this.gotoIndex(b);this.fireOnNavigate();this.fireOnCurPosChanged()};c.prototype.gotoFirst=function(){this.gotoIndex(0)};c.prototype.gotoLast=function(){this.gotoIndex(this.mainLine.length)};c.prototype.gotoIndex=function(b,e){var f=c.getStackForIndex(this.mainLine,b);this.gotoStack(f,e)};c.prototype.gotoLine=function(b,e){var f=c.getStackForLine(b,e);this.gotoStack(f)};c.prototype.gotoSimplePath=
function(b){for(var e=this.mainLine,c=new CB.LineStack,g=0,h=b.length;g<h;++g){var l=b[g],q=new CB.LineStackItem(e,l.mvsToGo);c.push(q);g<h-1&&(e=e[l.mvsToGo].getLine(l.inxLine))}this.gotoStack(c)};c.prototype.triggerOnClickInNotation=function(){this.fireOnClickInNotation()};c.prototype.gotoNext=function(){if(!this.isLineEnd()){var b=this.getNextMove();this.cur.makeMove(b);(b=this.getTopItem())&&b.incMovesToGo();this.fireOnCurPosChanged();this.fireOnNavigate()}};c.prototype.gotoPrev=function(b){if(!this.isGameStart()){var e=
this.stk;e.gotoPrev();this.gotoStack(e,b)}};c.prototype.gotoPrevClone=function(){if(!this.isGameStart()){var b=ObjUtil.clone(this.stk);b.gotoPrev();this.gotoStack(b)}};c.prototype.gotoStart=function(){this.gotoIndex(1);this.fireOnCurPosChanged();this.fireOnNavigate()};c.prototype.gotoEnd=function(){this.gotoIndex(this.mainLine.length);this.fireOnCurPosChanged();this.fireOnNavigate()};c.prototype.gotoStack=function(b,e){this.setStack(b);e||(this.fireOnCurPosChanged(),this.fireOnNavigate())};c.prototype.gotoMove=
function(b,e){var c=this.getNextMove();return c?b.equals(c)?(b.mvd=c.mvd,this.gotoNext(),e&&this.fireOnMove(),!0):(c=c.findLine(b))?(this.gotoLine(c,1),e&&this.fireOnMove(),!0):!1:!1};c.prototype.beginLineNextMove=function(b){var e=this.getNextMove();if(!e||!e.hasLines()||b>=e.getSubLines().length)return!1;b=e.getSubLines()[b][0];return this.gotoMove(b)?b:!1};c.prototype.endLine=function(){if(1<this.stk.length){var b=this.stk[this.stk.length-2],e=b.getLine();this.gotoLine(e,b.mvsToGo);return this.getMoveIndex()}};
c.prototype.getMoveOffs=function(){return this.cur.numPly-this.start.numPly};c.prototype.getMoveIndex=function(){var b=0;if(0<this.stk.length)for(var b=this.stk[this.stk.length-1],e=b.getLine(),b=b.getMovesToGo(),c=this.stk.length-2;0<=c;--c){var g=this.stk[c].getLine(),h=e.getParentMoveIndex(),l=g[h],q=l.indexOfLine(e);CBDebug.assert(0<=q,"inxPrevLine >= 0");for(e=0;e<q;++e)b+=l.getLine(e).getTreeMoveCount();h+=1;for(l=g.length;h<l;++h)if(q=g[h],q.hasLines())for(var e=0,r=q.getSubLinesCount();e<
r;++e)b+=q.getLine(e).getTreeMoveCount();b+=g.length;e=g}return b};c.getStackForLine=function(b,e){for(var c=[];null!=b;e=b.getParentMoveIndex(),b=b.getParentLine()){var g=new CB.LineStackItem(b,e);c.push(g)}for(var h=new CB.LineStack;0<c.length;)g=c.pop(),h.push(g);return h};c.getStackForIndex=function(d,e){var c={complete:!1,inxMv:e},g=new CB.LineStack;b.call(this,d,c,g);return g};var b=function(d,e,c){var g=d.length;if(e.inxMv<=g)return c.push(new CB.LineStackItem(d,e.inxMv)),e.complete=!0;e.inxMv-=
g;for(g=d.length-1;0<=g;--g){var h=d[g];if(h.hasLines()){c.push(new CB.LineStackItem(d,g));for(var l=0,q=h.getSubLinesCount();l<q;++l){var r=h.getLine(l);b(r,e,c);if(e.complete)return!0}c.pop()}}return!1}})(CB.Game);
(function(c){function b(b){this.cur.preCalcCtx(b);var d=this.cur.makeMove(b);this.cur.postCalcCtx(b,!0);return d}function d(b){return e.call(this,b,function(b,d){b.length=d+1})}function e(d,e){var c=b.call(this,d);c||CB.LogException("MoveInMain, no undo",d);var f=this.stk.Top();if(f){var g=f.getLine(),h=f.getMovesToGo();g[h]=d;e(g,h);f.setMovesToGo(h+1)}d.undo=c;this.fireOnMove(d);this.fireOnCurPosChanged();return c}function f(b){return e.call(this,b,function(b,d){r(this.cur,b,d+1)}.bind(this))}function g(d,
e,c){var f=b.call(this,d),g=this.stk.Top(),h=g.getMovesToGo();e=g.getLine()[h].getLine(e);e[0]=d;c(e);d=new CB.LineStackItem(e,1);this.stk.push(d);this.fireOnMove();this.fireOnCurPosChanged();return f}function h(b,d){return g.call(this,b,d,function(b){b.length=1})}function l(b,d){var e=function(b){r(this.cur,b,1)}.bind(this);return g.call(this,b,d,e)}function q(d){var e=b.call(this,d),c=this.stk.Top();if(c){var f=c.getLine(),g=c.getMovesToGo();g<f.length?(c=f[g].newLine(f,g),c=new CB.LineStackItem(c,
0),c.pushMove(d),this.stk.push(c)):c.pushMove(d);this.fireOnMove();this.fireOnCurPosChanged();return e}}function r(b,d,e){e=e||0;for(b=ObjUtil.clone(b);e<d.length;++e){var c=d[e];if(!b.isLegalMove(c))break;if(c.hasLines())for(var f=c.getSubLinesCount()-1;0<=f;--f){var g=c.getLine(f);r(b,g);0===g.length&&c.removeLine(f)}b.makeMove(c)}d.length=e}c.prototype.storeOnce=function(){this.storeState={start:ObjUtil.clone(this.start),cur:ObjUtil.clone(this.cur),mainLine:ObjUtil.clone(this.mainLine),stk:ObjUtil.clone(this.stk)}};
c.prototype.restoreOnce=function(){this.storeState&&(this.start=ObjUtil.clone(this.storeState.start),this.cur=ObjUtil.clone(this.storeState.cur),this.mainLine=ObjUtil.clone(this.storeState.mainLine),this.stk=ObjUtil.clone(this.storeState.stk))};c.prototype.storeOnce2=function(){this.storeState={start:ObjUtil.clone2(this.start),cur:ObjUtil.clone2(this.cur),mainLine:ObjUtil.clone2(this.mainLine),stk:ObjUtil.clone2(this.stk)}};c.prototype.restoreOnce2=function(){this.storeState&&(this.start=ObjUtil.clone2(this.storeState.start),
this.cur=ObjUtil.clone2(this.storeState.cur),this.mainLine=ObjUtil.clone2(this.storeState.mainLine),this.stk=ObjUtil.clone2(this.storeState.stk))};c.prototype.beginLine=function(b){q.call(this,b)};c.prototype.makeMove=function(b,e){0<=e&&63>=e&&(e=CB.MoveEnterType.NEWLINE);if(this.gotoMove(b))return!0;var c=null,g=e&CB.MoveEnterType.TYPE_MASK,w=e&CB.MoveEnterType.LINE_MASK;switch(g){case CB.MoveEnterType.CANCEL&CB.MoveEnterType.TYPE_MASK:case CB.MoveEnterType.CANCEL:break;case CB.MoveEnterType.NEWMAINLINE:c=
q.call(this,b);this.promoteLine();break;case CB.MoveEnterType.NEWLINE:c=q.call(this,b);break;case CB.MoveEnterType.INSERT_MAIN:c=f.call(this,b);break;default:case CB.MoveEnterType.OVERWRITE_MAIN:c=d.call(this,b);break;case CB.MoveEnterType.OVERWRITE_LINE:c=h.call(this,b,w);break;case CB.MoveEnterType.INSERT_LINE:c=l.call(this,b,w)}if(c)return b.undo=c,!0;CB.LogException("No Undo","Type="+g+", mv="+b);return!1}})(CB.Game);"use strict";
(function(c){function b(b){CBDebug.call(this,this.selfTest);if(!this.isOnMainLine()){var e=this.getTopLine(),c=e.getParentMove(),g=c.getSubLinesCount();g&&1!==g&&(e=c.indexOfLine(e),b=e+b,0>b||b>=g||(c.swapLines(e,b),CBDebug.call(this,this.selfTest),this.fireOnChanged()))}}c.prototype.promoteLine=function(){if(this.isOnMainLine())return!1;CBDebug.call(this,this.selfTest);this.stk.promoteLine();CBDebug.call(this,this.selfTest);this.fireOnChanged();return!0};c.prototype.upLine=function(){b.call(this,
-1)};c.prototype.downLine=function(){b.call(this,1)};c.prototype.deleteLine=function(){if(!this.isOnMainLine()){CBDebug.call(this,this.selfTest);var b=this.stk.shallowClone(),e=this.getTopLine();e.getParentMove().removeLine(e);b.pop();this.setStack(b);CBDebug.call(this,this.selfTest);this.fireOnCurPosChanged();this.fireOnChanged()}};c.prototype.deleteRemaining=function(b){this.stk.deleteRemaining();b||this.fireOnChanged()};c.prototype.deletePrevious=function(){if(0!=this.getCurLine().length){var b=
this.stk.shallowClone();b.gotoPrev();b=this.getStackPos(b);this.mainLine=this.stk.deletePrevious();this.start=b;this.fireOnChanged()}};c.prototype.unAnnotate=function(){this.mainLine.unAnnotate();var b=new CB.LineStack(this.mainLine,0);this.setStack(b);this.fireOnChanged();this.fireOnCurPosChanged()};c.prototype.startLine=function(){this.gotoPrev()};c.prototype.forAllMoves=function(b){this.mainLine.forAllMoves(b)}})(CB.Game);
(function(c){function b(b){for(var e=[],c=0,g=this.stk.length;c<g;++c){var h=this.stk[c],l=h.getLine(),h=h.getMovesToGo();b||c!=g-1||(h=l.length);h&&(e=e.concat(l.slice(0,h)))}return e}c.prototype.getCurLine=function(){return b.call(this,!1)};c.prototype.getCurLineCut=function(){return b.call(this,!0)};c.prototype.getLineStartMoveNo=function(){for(var b=0,e=0;e<this.stk.length-1;e++)b+=this.stk[e].getMovesToGo();return b};c.prototype.getCurLineIndex=function(){for(var b=0,e=0,c=this.stk.length;e<
c;++e)b+=this.stk[e].getMovesToGo();return b};c.prototype.setCurLineIndex=function(b){for(var e=new LineStack,c=0,g=this.stk.length;c<g;++c){var h=this.stk[c],l=h.getMovesToGo();if(c<g-1&&l<b)e.push(h),b-=l;else{c=h.getLine();l=b;b=new CB.LineStackItem(c,l);e.push(b);break}}this.gotoStack(e)}})(CB.Game);
(function(c){function b(b){var d=new CB.Position,d=ObjUtil.equals(this.start,d);b.V13(d);d||(this.start.write(b),b.writeShort(0),b.writeShort(this.start.getMoveNum()),b.V13(d))}function d(b){var d=b.V14();!d&&(this.start.read(b),b.readShort(),d=b.readShort(),this.start.setMoveNum(d),d=b.V14())&&(this.start=new CB.Position)}function e(b){d.call(this,b);var e=new CB.Annotation;e.read2(b);this.mainLine.read2(b);e.empty()||this.mainLine.setAnno(e)}c.prototype.fromBuf64=function(b){var d=new CB.DataBuffer;
d.constructFromBase64(b);b=new CB.Game;var e=new CB.GameHeader;e.compactFromDataBuf(d);d.V10();b.readGameOnly2(d);b.setHeader(e);this.assign(b)};c.prototype.write=function(d){var e=this.getMoveIndex();d.writeInt(e);d.writeInt(0);this.hdr.write(d);b.call(this,d);(new CB.Annotation).write(d);this.mainLine.write(d);d.beginSizedWrite();d.endSizedWrite()};c.prototype.read=function(b){var e=b.readInt();b.readInt();this.hdr.read(b);d.call(this,b);var c=new CB.Annotation;c.read(b);this.mainLine.read(b);c.empty()||
this.mainLine.setAnno(c);b.beginSizedRead();b.endSizedRead();this.initPost();CBDebug.call(this,this.selfTest);this.fireOnChanged();this.gotoIndex(e)};c.prototype.read2=function(b){var d=!1;this.hdr.read(b)&&(e.call(this,b),d=!0);this.initPost();return d};c.prototype.read3=function(b){var d=b.readInt();b.readInt();this.hdr.read(b);e.call(this,b);b.beginSizedWrite();b.endSizedWrite();this.initPost();CBDebug.call(this,this.selfTest);this.fireOnChanged();this.fireOnHeaderChanged();this.gotoIndex(d)};
c.prototype.readGameOnly2=function(b){e.call(this,b);this.initPost()};c.prototype.writeGameOnly2=function(d){b.call(this,d);d.writeUint8(0);this.mainLine.write2(d)};c.prototype.fromDataBuf=c.prototype.read;c.prototype.Vz=c.prototype.write})(CB.Game);"use strict";CB.V1={arrStrPieces:[],strTakes:"x",strCheck:"+",strMate:"#",strProm:"",str00:"0-0",str000:"0-0-0",strNullMove:"--",bOmitPawnTakes:!1};CB.V1.arrStrPieces[CB.Piece.W_KING]=CB.V1.arrStrPieces[CB.Piece.B_KING]="K";
CB.V1.arrStrPieces[CB.Piece.W_QUEEN]=CB.V1.arrStrPieces[CB.Piece.B_QUEEN]="Q";CB.V1.arrStrPieces[CB.Piece.W_ROOK]=CB.V1.arrStrPieces[CB.Piece.B_ROOK]="R";CB.V1.arrStrPieces[CB.Piece.W_BISHOP]=CB.V1.arrStrPieces[CB.Piece.B_BISHOP]="B";CB.V1.arrStrPieces[CB.Piece.W_KNIGHT]=CB.V1.arrStrPieces[CB.Piece.B_KNIGHT]="N";CB.V1.arrStrPieces[CB.Piece.W_PAWN]=CB.V1.arrStrPieces[CB.Piece.B_PAWN]="";
CB.NotationGenerator=function(){var c=function(b){this.m_loc=b||CB.V1};c.prototype.getLocalization=function(){return this.m_loc};c.prototype.getLineNota=function(b,d,e){var c=0;e&&(c=e);b=b.getMoveNum();for(e="";c<d.length;++c){var g=d[c],h=g.getMoved(),h=CB.Piece.side(h)===CB.Side.WHITE;e+=this.getMoveNota(g,h||!c?b:0)+" ";h||++b}return e};c.prototype.genLineNotaFromEnd=function(b,d){var e=b.getMainLine().length,e=e-d;0>e&&(e=0);for(var e=Math.floor(e/2)+1,c=[],g=Math.max(0,b.getMoveNo()-d),h=g;h<
b.getMainLine().length;++h){var l=b.getMainLine()[h],q=l.getMoved(),q=CB.Piece.side(q)===CB.Side.WHITE;c.push(this.getMoveNota(l,q||h==g?e:0));q||++e}return c};c.prototype.getNota=function(b,d){var e=Math.floor(d.getCurPos().getMoveNum()/2+1);d.getCurPos().preCalcCtx(b);return this.getMoveNota(b,e)};c.prototype.getMoveNota=function(b,d){var e="",c=b.getMoved();d&&(e=""+d+".",CB.Piece.side(c)===CB.Side.BLACK&&(e+=".."));b.isNullMove()?e+=this.m_loc.strNullMove:b.isShortCastling()?e+=this.m_loc.str00:
b.isLongCastling()?e+=this.m_loc.str000:(e=1>c||15<c?e+("[pcMvd="+c+"]"):e+this.m_loc.arrStrPieces[c],b.isNeedCol()&&(e+=CB.Square.colToString(CB.Square.C(b.from))),b.isNeedRow()&&(e+=CB.Square.rowToString(CB.Square.R(b.from))),b.isTake()&&(c===CB.Piece.W_PAWN||c===CB.Piece.B_PAWN?(e+=CB.Square.colToString(CB.Square.C(b.from)),this.m_loc.bOmitPawnTakes||(e+=this.m_loc.strTakes)):e+=this.m_loc.strTakes),e+=CB.Square.toString(b.to),b.prom&&(e+=this.m_loc.strProm,e+=this.m_loc.arrStrPieces[b.prom]));
b.isMate()?e+=this.m_loc.strMate:b.isCheck()&&(e+=this.m_loc.strCheck);return e};c.prototype.getStrMoveNumInLine=function(b,d,e){var c=CB.Position.prototype.plyToMvNum(b+d),g="";if(0==(b+d&1)||0==b)g=c.toString()+".",e?0==(b+d&1)&&(g+=".."):0!=(b+d&1)&&(g+="..");return g};c.Localizations={};c.Localizations.invariant=CB.V1;return c}();var NotationLocalizations=CB.NotationGenerator.Localizations;"use strict";CB.SessionActionEnum={};
CB.SessionAction=function(){var c=function(){};c.prototype.init=function(b,d,e){this.id=-1;this.idGame=b;this.gameAction=d;this.controlMove=e;this.tickCount=new Date};c.prototype.getSockMsg=function(b){var d=new CB.WebSockMessage(USER);d.setUserType(b);this.Vz(d.getBuf());return d};c.prototype.fromDataBuf=function(b){this.id=b.V10();this.tickCount=b.V10();this.idGame=b.V10();this.controlMove=new CB.MoveRecord;this.controlMove.fromDataBuf(b);this.reserved1=b.V10();this.reserved2=b.V10();this.gameAction=
new CB.GameAction;this.gameAction.fromDataBuf(b)};c.prototype.Vz=function(b){b.Vx(this.id);b.Vx(this.tickCount);b.Vx(this.idGame);this.controlMove.Vz(b);b.Vx(this.reserved1||0);b.Vx(this.reserved2||0);this.gameAction.Vz(b)};c.prototype.isAnEarlierMove=function(b){if(this.gameAction.type==CB.GameActionEnum.MOVEDATA){var d=this.gameAction.moveData;if(this.gameAction.moveData.moveNo<b.getPlyNum()&&(d=new CB.Move(d.move[0],d.move[1],d.move[2]),b.getMoves()[this.gameAction.moveData.moveNo].equals(d)&&
(0==this.gameAction.moveData.moveNo||b.getMoves()[this.gameAction.moveData.moveNo-1].equals(this.controlMove))))return!0}return!1};c.prototype.isPlayingMove=function(){return this.gameAction.type==CB.GameActionEnum.MOVEDATA};c.prototype.toString=function(){return"gameId="+this.idGame.toString(10)+" "+this.gameAction.toString()};return c}();"use strict";
CB.Attack={isPawnFork:function(c,b){var d=ObjUtil.clone(c),e=d.board[b.from];if((e&CB.Piece.PIECE_MASK)==CB.Piece.PAWN){d.makeMove(b);d.sd=CB.Side.other(d.sd);var f=[];d.generatePawn(e,b.to,f);if(2<=f.length){var g=0;f.forEach(function(b){(b=d.board[b.to])&&(b&CB.Piece.PIECE_MASK)!=CB.Piece.PAWN&&g++});return 2==g}}return!1},sumMaterial:function(c,b){var d=0,e=[0,0,900,325,325,450,100];c.board.forEach(function(c){c&&CB.Piece.side(c)==b&&(d+=e[CB.Piece.nominal(c)])});return d}};"use strict";
CB.AllowedColor={NONE:0,WHITE_ONLY:1,BLACK_ONLY:2,BOTH_COLORS:3,detFromOpponentSide:function(c){return c==CB.Side.BLACK?CB.AllowedColor.WHITE_ONLY:CB.AllowedColor.BLACK_ONLY}};
CB.MoveEntry=function(){var c=function(b){this.board=b;this.fnToMove=function(){return null};this.withPreMove=!0;this.preMoves=[]};c.prototype.onMove=function(){var b=this.getMySide();null!==b&&b===this.getCurPos().getSideToMove()&&this.processPreMove()};c.prototype.getLastPreMoveToSq=function(){if(this.preMoves.length)return this.preMoves[this.preMoves.length-1].to};c.prototype.onSquareClicked=function(b){};c.prototype.clearPreMoves=function(){CB.LOG("Clear PreMoves","LogBold");this.preMoves=[];
this.getBoardWin().undoAttributes()};c.prototype.getPreMoveHsla=function(b){switch(b%7){case 0:return"hsla( 120, 90%, 40%, 0.9 )";case 1:return"hsla( 120, 00%, 100%, 0.9 )";case 2:return"hsla( 5, 90%, 70%, 0.9 )";case 3:return"hsla( 180, 90%, 50%, 0.9 )";case 4:return"hsla( 180, 00%, 40%, 0.9 )";case 5:return"hsla( 0, 0%, 5%, 0.9 )";case 6:return"hsla( 270, 70%, 60%, 0.9 )"}};c.prototype.renderPreMoves=function(){try{for(var b=[],e=0;e<this.preMoves.length;e++){var c=this.preMoves[e],g=this.getPreMoveHsla(e);
b.push(new CB.BoardArrow(c.from,c.to,g))}b.length&&this.getBoardWin().queueBoardAttributes(b,{eraseQueue:!1,renderNow:!0,requestAnimInRender:!0})}catch(h){CB.LogException("ME::rp")}};c.prototype.clearPreMoves=function(){this.preMoves=[]};c.prototype.boardWinMoveEntered=function(b,e,c){try{if(this.colorOk()&&this.squareHasColorToMove(b)){var g=new CB.Move(b,e,c&7);this.fireOnStopClock();this.fireOnMoveEntered(g);return!0}if(this.withPreMove){var h=new CB.Move(b,e,c&7),l=!1;this.preMoves.forEach(function(c){c.from==
b&&c.to==e&&(l=!0)});l||(this.preMoves.push(h),CB.LOG("PreMove entered: "+h+", tot="+this.preMoves.length))}}catch(q){CB.LogException("MvE::Entd",q)}return!1};c.prototype.squareHasColorToMove=function(b){return CB.Piece.side(this.getCurPos().getPiece(b))==this.getCurPos().getSideToMove()};c.prototype.clearAttributesOnMouseDown=function(b){try{var e=!0;if(this.withPreMove){var c=this.getCurPos().getPiece(b);c&&CB.Piece.side(c)!=this.getCurPos().getSideToMove()&&CB.Piece.side(c)===this.getMySide()&&
(e=!1);b==this.getLastPreMoveToSq()&&(e=!1)}e&&this.board.undoAttributes(!0)}catch(g){CB.LogException("ME::clr",g)}};var b=!1;c.prototype.processPreMove=function(){if(b)return!1;b=!0;var d=!1;if(this.preMoves.length){var e=this.preMoves.shift();this.getCurPos().isLegalFromTo(e.from,e.to)&&this.getCurPos().getSideToMove()==this.getMySide()?(CB.LOG("Exec Legal PreMove: "+e,"LogBold"),this.fireOnStopClock(),new CB.Timer.launch(function(){this.fireOnMoveEntered(e)}.bind(this)),d=!0,this.renderPreMoves()):
(CB.LOG("PreMove illegal: "+e,"LogRed"),this.clearPreMoves())}b=!1;return d};c.prototype.fillSingleClickMove=function(b,e){var c={ok:!1,from:-1};try{if(b.get(e)==CB.Piece.NONE){var g=this.getCurPos().V7(),g=g.filter(function(b){return b.to==e});if(c.ok=1==g.length&&this.isSingleClickColorOk())c.from=g[0].from}}catch(h){CB.LogException("ME:FS",h)}return c};c.prototype.isLegalOrPremove=function(b,e,c){return this.colorOk(b.get(e),e)?this.getCurPos().isLegalFromTo(e,c)||this.isPremove(b,e,c):!1};c.prototype.isLegal=
function(b,e,c){return this.canMoveForCurSide()?this.getCurPos().isLegalFromTo(e,c):!1};c.prototype.isMyPiece=function(b){return!!(this.getBoardWin().board.get(b)&CB.Piece.SIDE_MASK)==this.getCurPos().isBTM()&&0<this.getBoardWin().board.get(b)};c.prototype.isOpponentPiece=function(b){return!!(this.getBoardWin().board.get(b)&CB.Piece.SIDE_MASK)!=this.getCurPos().isBTM()&&0<this.getBoardWin().board.get(b)};c.prototype.tryTwoClickMove=function(b,e){var c=this.getBoardWin().board;if(this.colorOk(c.get(b),
b)&&this.getCurPos().isLegalFromTo(b,e)){c=0;if(this.getBoardWin().isWhitePromoPawn(b)||this.getBoardWin().isBlackPromoPawn(b))c=CB.Piece.QUEEN;return this.boardWinMoveEntered(b,e,c)}return!1};c.prototype.colorOk=function(b,e){switch(this.getAllowedColor()){case CB.AllowedColor.BOTH_COLORS:return!0;case CB.AllowedColor.WHITE_ONLY:return this.getCurPos().isWTM()||this.colorOkInPremove(b,CB.Side.WHITE,e);case CB.AllowedColor.BLACK_ONLY:return this.getCurPos().isBTM()||this.colorOkInPremove(b,CB.Side.BLACK,
e);default:return!1}};c.prototype.colorOkInPremove=function(b,e,c){return this.withPreMove&&(this.preMovesLeadTo(c)||b&&CB.Piece.side(b)==e)?!0:!1};c.prototype.canMoveForCurSide=function(){switch(this.getAllowedColor()){case CB.AllowedColor.BOTH_COLORS:return!0;case CB.AllowedColor.WHITE_ONLY:return this.getCurPos().isWTM();case CB.AllowedColor.BLACK_ONLY:return this.getCurPos().isBTM();default:return!1}};c.prototype.isSingleClickColorOk=function(){switch(this.getAllowedColor()){case CB.AllowedColor.WHITE_ONLY:return this.getCurPos().isWTM();
case CB.AllowedColor.BLACK_ONLY:return this.getCurPos().isBTM();default:case CB.AllowedColor.BOTH_COLORS:return!0}};c.prototype.onPosInput=function(b){};c.prototype.allowBothColors=function(){this.setMySide(null)};c.prototype.isPremove=function(b,e,c){return 0<=e&&0<=c&&63>=e&&63>c?this.preMovesLeadTo(e)?!0:(b=b.get(e))&&this.withPreMove&&this.getCurPos().isBTM()==(CB.Piece.side(b)==CB.Side.WHITE):!1};c.prototype.isLegalFromTo=function(b,e){return this.getCurPos().isLegalFromTo(b,e)};c.prototype.preMovesLeadTo=
function(b){if(this.withPreMove)for(var e=0;e<this.preMoves.length;e++)if(this.preMoves[e].to==b)return!0;return!1};c.prototype.isPremovePromoPawn=function(b,e){if(-1==b)return!1;for(var c=this.preMoves.length-1;0<=c;c--)if(this.preMoves[c].to==b){var g=this.getCurPos().board[this.preMoves[0].from];if((g&CB.Piece.PIECE_MASK)==CB.Piece.PAWN&&CB.Piece.side(g)==e)return 6==CB.Square.getRank(b)||1==CB.Square.getRank(b)}return!1};c.prototype.mayEnPassant=function(b,e){return this.isLegalFromTo(b,e)?this.getCurPos().getEPCol()==
CB.Square.getFile(e):!1};c.prototype.test=function(){};c.prototype.getGame=function(){return this.board.getGame()};c.prototype.getCurPos=function(){return this.getGame().getCurPos()};c.prototype.getBoardWin=function(){return this.board};c.prototype.getMySide=function(){return this.fnToMove()};c.prototype.setMySide=function(b){ObjUtil.isFunction(b)?this.fnToMove=b:this.fnToMove=function(){return b}};c.prototype.getAllowedColor=function(){switch(this.getMySide()){case CB.Side.WHITE:return CB.AllowedColor.WHITE_ONLY;
case CB.Side.BLACK:return CB.AllowedColor.BLACK_ONLY;default:return CB.AllowedColor.BOTH_COLORS}};c.prototype.mayEnterBackwards=function(b,e){if(0<=e&&64>e){var c=b.get(e);return this.getCurPos().isBTM()==(CB.Piece.side(c)==CB.Side.BLACK)}};Ve.initForListeners(c);Ve.addEvent(c,"MoveEntered");Ve.addEvent(c,"StopClock");return c}();"use strict";
CB.GameKernel=function(){var c=1,b=function(b,e){this.game=e||new CB.Game;CB.protect(this,"game");this.setGameListeners();this.legalMoves=[];this.viewLink=b;this.isPostAnnoEdit=!0;this.uniqueId=c++;this.audioInst=new CB.ChessAudioInstance;this.audioInst.setGame(this.game);this.fnInitGame=function(b){b.reset();if(PGN&&V15&&V15.urlParams&&V15.urlParams.pgn){var d=PGN.parseGame(V15.urlParams.pgn);b.assign(d)}else V15&&V15.urlParams&&V15.urlParams.buf64?(CB.strUtil.getURLParam("buf64"),d=new CB.Game,
d.fromBuf64(V15.urlParams.buf64),b.assign(d)):V15&&V15.urlParams&&V15.urlParams.hasStartPos&&V15.urlParams.hasStartPos()?(V15.urlParams.fen?d=new CB.Position(V15.urlParams.fen):V15.urlParams.pos&&(d=new CB.Position,d.initString(V15.urlParams.pos)),d.isLegal()&&b.assign(new CB.Game(d))):this.playFromPgnGame&&!this.playFromPgnGame.isNormalInit()&&b.assign(new CB.Game(this.playFromPgnGame.getStartPos()))}};b.prototype.destroy=function(){this.setBoardWin(null);this.audioInst.setGame(null);this.removeGameListeners();
this.releaseCommandHandlers();this.Vk&&this.Vk.destroy()};b.prototype.setAllowedColor=function(b){this.boardWin&&(this.boardWin.moveEntry.allowedColor=b)};b.prototype.linkCommandHandlers=function(){this.commandHandlerId=V15.commands.registerCommandHandler(this);this.keyDownHandlerId=V15.commands.registerkeyDownHandler(this)};b.prototype.releaseCommandHandlers=function(){V15.commands.unregisterCommandHandler(this.commandHandlerId);V15.commands.unregisterkeyDownHandler(this.keyDownHandlerId)};b.prototype.createControl=
function(b,e,c,g){this.animateBoard=!0;var h="undefined"===typeof this.boardArea;this.boardArea=new CB.BoardArea(b,e,c,g);var l=(g?g.fnBoardFactory:null)||this.fnBoardFactory;l?b=l(b,e,c,"ByKernel",g):(b=new CB.BoardControl(b,e,c,"ByKernel",g),g&&g.mixin&&CB.mixObject(b,g.mixin));!g||!g.addTitle||V15.panelMgr.hasLogo&&V15.panelMgr.hasLogo()||b.addTitle(null,g.noClock);this.setBoardWin(b);this.Vk.createGUIElements(this.boardWin);this.boardArea.addBoard(this.boardWin);h&&this.initGame();this.boardWin.addStyleListener();
this.releaseCommandHandlers();this.linkCommandHandlers();return this.boardArea};b.prototype.createControl3D=function(b,e,c){this.animateBoard=V15.animatedBoard();this.boardArea=new CB.BoardArea3D(b,e,c);b=new CB.BoardControl3D(b,e,c,"FritzBoard",this.on3DLoaded.bind(this));this.setBoardWin(b);this.Vk.createGUIElements(this.boardWin);this.boardArea.addBoard(this.boardWin);this.boardWin.addStyleListener();this.releaseCommandHandlers();this.linkCommandHandlers();return this.boardArea};b.prototype.on3DLoaded=
function(){this.boardWin&&this.boardWin.setGame(this.game)};b.prototype.enableAudio=function(b){this.audioInst&&this.audioInst.enable(b)};b.prototype.setBlackIsBottom=function(b){this.boardWin&&this.boardWin.setBlackIsBottom(b)};b.prototype.setBoardWin=function(b){this.boardWin&&this.boardWin.moveEntry.removeOnMoveEnteredListener(this.idOnMoveEntered);if(this.boardWin=b)this.boardWin.moveEntry&&(this.boardWin.moveEntry.setMySide&&this.boardWin.moveEntry.setMySide(this.getMySide.bind(this)),this.boardWin.moveEntry.addOnMoveEnteredListener&&
(this.idOnMoveEntered=this.boardWin.moveEntry.addOnMoveEnteredListener(this.reactToEnteredMove.bind(this)))),this.boardWin.setGame(this.game),this.idGame&&(this.boardWin.idGame=this.idGame)};b.prototype.createNotaElement=function(b,e,c){this.notation=CB.NotaElement.factory(b,e,null);this.notation.setGame(this.game);return this.notation};b.prototype.suppressNotationFromMoves=function(b){this.notation&&this.notation.suppressNotationFromMoves(b)};b.prototype.onPanelsReady=function(){this.Vk.onPanelsReady()};
b.prototype.setPlayingMode=function(b){this.modeState=this.modeState||{};this.Vk&&this.Vk.saveState(this.modeState);this.boardWin&&this.Vk&&(this.Vk.destroyGUIElements(this.boardWin),this.Vk.destroy());this.Vk=b;this.boardWin&&(this.Vk.createGUIElements(this.boardWin),this.Vk.onPanelsReady(),this.Vk&&this.Vk.loadState(this.modeState),this.Vk.updateGamePos());this.boardArea&&this.boardArea.forceResize();this.Vk.getFnLoadSearchResult&&(this.loadSearchResultGame=this.Vk.getFnLoadSearchResult())};b.gMapTimeControls=
null;b.getTimeControl=function(d){b.initTimeControls();return b.gMapTimeControls[d]};b.initTimeControls=function(){b.gMapTimeControls||(b.gMapTimeControls={},b.gMapTimeControls[V15.Vo.LEVEL_BLITZ_3_0]={clockParams:new CB.ClockParams(3,0)},b.gMapTimeControls[V15.Vo.LEVEL_BLITZ_4_0]={clockParams:new CB.ClockParams(4,0)},b.gMapTimeControls[V15.Vo.LEVEL_BLITZ_5_0]={clockParams:new CB.ClockParams(5,0)},b.gMapTimeControls[V15.Vo.LEVEL_BLITZ_3_2]={clockParams:new CB.ClockParams(3,2)},b.gMapTimeControls[V15.Vo.LEVEL_BLITZ_5_5]=
{clockParams:new CB.ClockParams(5,5)},b.gMapTimeControls[V15.Vo.LEVEL_1_SECOND]={fixedTime:1E3},b.gMapTimeControls[V15.Vo.LEVEL_5_SECONDS]={fixedTime:5E3},b.gMapTimeControls[V15.Vo.LEVEL_15_SECONDS]={fixedTime:15E3},b.gMapTimeControls[V15.Vo.LEVEL_40_SECONDS]={fixedTime:4E4})};b.prototype.execCommand=function(b){try{switch(b){case V15.Vo.NEW_GAME:this.newGame();break;case V15.Vo.SETUP_POSITION:this.togglePosInputMode(this.Vk.posLegalChecker);break;case V15.Vo.TAKEBACK:this.Vk.mayNavigate()&&this.game.gotoPrev();
break;case V15.Vo.EXECMOVE:this.Vk.mayNavigate()&&this.game.gotoNext();break;case V15.Vo.START_LINE:this.startLine();break;case V15.Vo.FLIP_BOARD:this.boardWin&&this.boardWin.flipBoard();break;case V15.Vo.PROMOTE_LINE:this.Vk.onPromoteLine()&&this.game.promoteLine();break;case V15.Vo.DELETE_LINE:this.Vk.onDeleteLine()&&this.game.deleteLine();break;case V15.Vo.CUT_LINE:this.Vk.onCutLine()&&this.game.deleteRemaining();break;case V15.Vo.DELETE_PREVIOUS_MOVES:this.Vk.onDeletePrevious()&&this.game.deletePrevious();
break;case V15.Vo.ADD_POST_TEXT:this._editAnno(!0);break;case V15.Vo.ADD_PRE_TEXT:this._editAnno(!1);break;case V15.Vo.INSERT_DIAGRAM:this.Vk.onInsertDiagram()&&this.insertDiagram();break;case V15.Vo.ENGINE_PLUS_LINE:this.changeEngineLines(1);break;case V15.Vo.ENGINE_MINUS_LINE:this.changeEngineLines(-1);break;case V15.Vo.OPEN_CMS:this.openCMS();break;case V15.Vo.PLAYERDB_TEST:this.Vk.test();break;case V15.Vo.GAME_COPYTOCLIPBOARD:this.copyGameToClipboard();break;case V15.Vo.GAME_PASTEFROMCLIPBOARD:this.pasteGameFromClipboard();
break;case V15.Vo.MARK_GOOD:this.Vk.onAnnotate()&&this.addSymbol(CB.AnnoMarkType.GOOD);break;case V15.Vo.MARK_BAD:this.Vk.onAnnotate()&&this.addSymbol(CB.AnnoMarkType.BAD);break;case V15.Vo.MARK_VERYGOOD:this.Vk.onAnnotate()&&this.addSymbol(CB.AnnoMarkType.VERY_GOOD);break;case V15.Vo.MARK_VERYBAD:this.Vk.onAnnotate()&&this.addSymbol(CB.AnnoMarkType.VERY_BAD);break;case V15.Vo.MARK_INTERESTING:this.Vk.onAnnotate()&&this.addSymbol(CB.AnnoMarkType.INTERESTING);break;case V15.Vo.MARK_DUBIOUS:this.Vk.onAnnotate()&&
this.addSymbol(CB.AnnoMarkType.DUBIOUS);break;case V15.Vo.WHITE_WINS:this.Vk.onEval(CB.AnnoEvalType.WHITE_WINS)&&this.addSymbol(CB.AnnoEvalType.WHITE_WINS);break;case V15.Vo.WHITE_BETTER:this.Vk.onEval(CB.AnnoEvalType.WHITE_BETTER)&&this.addSymbol(CB.AnnoEvalType.WHITE_BETTER);break;case V15.Vo.WHITE_SLIGHTLY:this.Vk.onEval(CB.AnnoEvalType.WHITE_SLIGHTLY_BETTER)&&this.addSymbol(CB.AnnoEvalType.WHITE_SLIGHTLY_BETTER);break;case V15.Vo.EQUAL:this.Vk.onEval(CB.AnnoEvalType.EQUAL)&&this.addSymbol(CB.AnnoEvalType.EQUAL);
break;case V15.Vo.UNCLEAR:this.Vk.onEval(CB.AnnoEvalType.UNCLEAR)&&this.addSymbol(CB.AnnoEvalType.UNCLEAR);break;case V15.Vo.BLACK_WINS:this.Vk.onEval(CB.AnnoEvalType.BLACK_WINS)&&this.addSymbol(CB.AnnoEvalType.BLACK_WINS);break;case V15.Vo.BLACK_BETTER:this.Vk.onEval(CB.AnnoEvalType.BLACK_BETTER)&&this.addSymbol(CB.AnnoEvalType.BLACK_BETTER);break;case V15.Vo.BLACK_SLIGHTLY:this.Vk.onEval(CB.AnnoEvalType.BLACK_SLIGHTLY_BETTER)&&this.addSymbol(CB.AnnoEvalType.BLACK_SLIGHTLY_BETTER);break;case V15.Vo.COMPENSATION:this.Vk.onEval(CB.AnnoEvalType.COMPENSATION)&&
this.addSymbol(CB.AnnoEvalType.COMPENSATION)}}catch(e){b=V15.Vo.toNumString(b),CB.LogException(b,e)}};b.prototype.onKeyDown=function(b){var e=this.Vk.onKeyDown(b);if(!e&&b&&b.getKey)switch(this.breakLoop=e=!0,b.getKey()){default:e=!1;break;case b.A:b.ctrlKey?this._editAnno(!0):e=!1;break;case b.F:b.ctrlKey?this.execCommand(CB.CommandIds.FLIP_BOARD):e=!1;break;case b.N:b.ctrlKey?this.execCommand(CB.CommandIds.NEW_GAME):e=!1;break;case b.LEFT:this.Vk.mayNavigate()&&this.game.gotoPrev();break;case b.RIGHT:this.handleCursorRight();
break;case b.HOME:this.Vk.mayNavigate()&&this.game.gotoStart();break;case b.END:this.handleEnd();break;case b.PAGE_DOWN:this.handlePageDown();break;case b.PAGE_UP:this.Vk.mayNavigate()&&this.game.jump(-20);break;case b.SPACE:this.Vk.mayNavigate()&&(e=this.execCommand(CB.CommandIds.ENGINE_MOVE_NOW));break;case b.F2:b.altKey?this.execCommand(CB.CommandIds.TOGGLE_ANALYSIS_ENGINE):e=!1}return e};b.prototype.onFileSelect=function(b,e){return!1};b.prototype.handleCursorRight=function(){this.Vk.mayGotoNext()&&
this.game.gotoNext()};b.prototype.handleEnd=function(){this.Vk.mayGotoEnd()&&this.game.gotoEnd()};b.prototype.handlePageDown=function(){this.Vk.mayPageDown()&&this.game.jump(20)};b.prototype.togglePosInputMode=function(b){V15.isPremium()?this.posInput?this.endPosInputMode():this.startPosInputMode(b):V15.panelMgr.showBoardMessage(lm.PREMIUM_ONLY,3E3)};b.prototype.doTest=function(){var b=new CB.Position("8/7k/P7/8/K7/8/8/8 w - - 0 1"),b=new CB.Game(b);this.game.assign(b)};b.prototype.startPosInputMode=
function(b){this.boardWin&&(this.boardWin.destroyTitle(),this.posInput=new CB.PosInputControl(this.boardWin.cbcanvas,this.boardWin.width,this.boardWin.height,"posInput",function(b){(new CB.Timer(function(){this.endPosInputMode(b)}.bind(this))).launch()}.bind(this),b,{}),this.boardArea.setPosInput(this.posInput),this.posInput.createButtons(),this.posInput.setPosition(this.getCurPos()),this.boardArea.calcGeometry())};b.prototype.endPosInputMode=function(b){if(this.posInput){var e=new CB.Game(this.posInput.createPosition());
this.boardArea.removePosInput(this.boardWin);this.posInput.destroy();delete this.posInput;this.Vk.createGUIElements(this.boardWin);b||this.game.assign(e);this.Vk.onPosInput(e.getCurPos());this.boardWin.moveEntry.onPosInput(e.getCurPos());this.setBlackIsBottom(e.getCurPos().getBTM())}};b.prototype.setPGN=function(b){b&&(this.game.assign(PGN.parseGame(b)),this.game.gotoFirst())};b.prototype.initGame=function(){this.fnInitGame(this.game,this);this.Vk.newGame(!1)};b.prototype.newGame=function(){this.boardWin&&
(this.boardWin.prepareFullRedraw(),this.boardWin.destroyMessage(),this.boardWin.clearBoardAttributes(),this.boardWin.moveEntry.clearPreMoves());this.Vk.resetGame(this.game);this.Vk.newGame(!0)};b.prototype.setGameListeners=function(){this.game&&(this.idNavListener=this.game.addOnNavigateListener(this._onGameNavigate.bind(this)),this.idMoveListener=this.game.addOnMoveListener(this._onGameMove.bind(this)),this.idChangeListener=this.game.addOnChangedListener(this._onGameChanged.bind(this)),this.idHeaderListener=
this.game.addOnHeaderChangedListener(this._onHeaderChanged.bind(this)),this.idCurPosListener=this.game.addOnCurPosChangedListener(this._onGameCurPosChanged.bind(this)),this.idResetGameListener=this.game.addOnResetGameListener(this._onResetGame.bind(this)),this.idClickInNotationListener=this.game.addOnClickInNotationListener(this._onClickInNotation.bind(this)))};b.prototype.removeGameListeners=function(){this.game.removeOnNavigateListener(this.idNavListener);this.game.removeOnMoveListener(this.idMoveListener);
this.game.removeOnChangedListener(this.idChangeListener);this.game.removeOnHeaderChangedListener(this.idHeaderListener);this.game.removeOnCurPosChangedListener(this.idCurPosListener);this.game.removeOnResetGameListener(this.idResetGameListener);this.game.removeOnClickInNotationListener(this.idClickOnNotationListener)};b.prototype.getGameClickHandler=function(){return this.onDBGameClicked.bind(this)};b.prototype.onDBGameClicked=function(b,e){b.loadGameAsync(this.gameLoadedCallback.bind(this),e)};b.prototype.gameLoadedCallback=
function(b){void 0!==b&&(this.loadSearchResultGame?this.loadSearchResultGame(b):(this.game.assign(b),this.game.gotoFirst(),this.loadSearchResultGame))};b.prototype.stepRandomGame=function(b){1E4>b&&this.makeRandomMove()&&!this.breakLoop&&setTimeout(function(){this.stepRandomGame(b+1)}.bind(this),5)};b.prototype.stepRetractAll=function(b){0<this.game.getMoveIndex()&&!this.breakLoop&&(this.game.gotoPrev(),setTimeout(function(){this.stepRetractAll()}.bind(this),5))};b.prototype.makeRandomMove=function(){if(0==
this.legalMoves.length)return!1;this.game.makeMove(this.legalMoves[Math.floor(Math.random()*this.legalMoves.length)]);return!0};b.prototype.getMySide=function(){if(this.Vk)return this.Vk.getMySide()};b.prototype.setMySide=function(b){this.Vk&&this.Vk.setMySide(b)};b.prototype.onReload=function(b){};b.prototype.reactToEnteredMove=function(b){try{if(this.game.getCurPos().isLegalMove(b)&&!this.Vk.reactToEnteredMove(b)){if(this.Vk.onEnteredMove(b)){if(this.game.gotoMove(b))return;var e=this.Vk.getMoveEnterType();
this.nextMoveEnterType&&(e=this.nextMoveEnterType,this.nextMoveEnterType=null);var c=function(b,d){d!=CB.MoveEnterType.CANCEL&&(this.game.makeMove(b,d),this.checkIfTechnicalGameEnd())}.bind(this);e==CB.MoveEnterType.QUERY?(e=function(b,d,e,q){c(e,d)},CB.Forms&&CB.Forms.showMoveForm(this.game,this.game.getCurPos(),b,null,e)):c(b,e)}else this.game.fireOnCurPosChanged();this.Vk.onAfterMoveEntry(b)}}catch(g){CB.LogException("GK:ReactTo",g)}};b.prototype.markLastMove=function(b,e){this.boardWin&&this.boardWin.markLastMove(b||
!this.animateBoard,e)};b.prototype.markSquare=function(b,e){this.boardWin&&this.boardWin.markSquare(b,e)};b.prototype.drawArrow=function(b,e,c){this.boardWin&&this.boardWin.drawArrow(b,e,c)};b.prototype.execAndAnimCurrMove=function(b){if(this.boardWin){var e=this.boardWin.animSteps.forMove;CB.System.isMobile()?this.boardWin.animSteps.forMove=b||4:this.boardWin.animSteps.forMove=b||10}this.game.gotoNext();this.boardWin&&(this.boardWin.animSteps.forMove=e)};b.prototype.retractAndAnimCurrMove=function(b){if(this.boardWin){var e=
this.boardWin.animSteps.forMove;CB.System.isMobile()?this.boardWin.animSteps.forMove=b||2.5:this.boardWin.animSteps.forMove=b||6}this.game.gotoPrev();this.boardWin&&(this.boardWin.animSteps.forMove=e)};b.prototype.makeAndAnimMove=function(b,e){this.moveWithAnimation(function(){this.game.makeMove(b,CB.MoveEnterType.OVERWRITE_MAIN)}.bind(this),e)};b.prototype.moveWithAnimation=function(b,e){var c=this.boardWin.animSteps.forMove;CB.System.isMobile()?this.boardWin.animSteps.forMove=e||4:this.boardWin.animSteps.forMove=
e||10;b();this.boardWin.animSteps.forMove=c;this.boardWin.callOnAnimFinished=function(){this.boardWin.redraw();this.boardWin.callOnAnimFinished=null}.bind(this)};b.prototype.setResult=function(b,e){this.game.setResult(b);this.Vk.onResult(b,e)};b.prototype.checkIfTechnicalGameEnd=function(){if(!this.isFinished()){var b={drawType:0},e=this.checkTechnicalResult(b);if(e!=CB.GameResultEnum.UNDEFINED){this.Vk.suppressTechnicalResult||this.setResult(e,CB.ResultFlags.TECHNICAL);if(this.onTechnicalGameEnd)this.onTechnicalGameEnd(e,
b);return!0}}return!1};b.prototype.isFinished=function(){return this.game.hdr.getCBResult().isFinished()};b.prototype.isBTM=function(){return this.game.getCurPos().isBTM()};b.prototype.checkTechnicalResult=function(d){return b.staticCheckTechnicalResult(this.game,d)};b.staticCheckTechnicalResult=function(b,e){var c=(new CB.DrawChecker).checkGame(b),g=CB.GameResultEnum.UNDEFINED;switch(c){case CB.DrawType.STALEMATE:case CB.DrawType.MATERIAL:g=CB.GameResultEnum.DRAW;break;case CB.DrawType.MATE:g=b.getCurPos().isBTM()?
CB.GameResultEnum.WHITE_WINS:CB.GameResultEnum.BLACK_WINS;break;case CB.DrawType.THREE_TIMES:case CB.DrawType.FIFTY_MOVES:g=CB.GameResultEnum.DRAW}e&&(e.drawType=c);return g};b.prototype._onGameNavigate=function(){this.Vk.onGameNavigate()};b.prototype._onGameMove=function(){this.Vk.onGameMove()};b.prototype._onGameCurPosChanged=function(){this.Vk.updateGamePos();this._updateAnnoField()};b.prototype._onGameChanged=function(b){this.Vk.updateGamePos(b);this._updateAnnoField()};b.prototype._onHeaderChanged=
function(b){this.Vk.updateHeader()};b.prototype._onResetGame=function(){this.Vk.onResetGame();this.boardWin&&(this.boardWin.nextCurPosNoAnim=!0)};b.prototype._onClickInNotation=function(){this.Vk.onClickInNotation()};b.prototype._editAnno=function(b){this.viewLink&&(this.isPostAnnoEdit==b?this.viewLink.toggleAnnoField():this.viewLink.openAnnoField(),this.isPostAnnoEdit=b,this.viewLink.isAnnoFieldOpen()&&(this.game.getAnno(this.isPostAnnoEdit?CB.AnnoType.POSTTEXT:CB.AnnoType.PRETEXT),this._updateAnnoField()))};
b.prototype.changeEngineLines=function(b){this.Vk.changeEngineLines(b)};b.prototype.onAnnoEnter=function(b,e){null!=b&&(this.Vk.onTextAnno(b,this.isPostAnnoEdit)&&(b.length?this.game.setAnno(this.isPostAnnoEdit?CB.AnnoType.POSTTEXT:CB.AnnoType.PRETEXT,new CB.TextAnno(b)):this.game.deleteAnno(this.isPostAnnoEdit?CB.AnnoType.POSTTEXT:CB.AnnoType.PRETEXT)),this.viewLink&&setTimeout(this.viewLink.closeAnnoField.bind(this.viewLink)))};b.prototype._updateAnnoField=function(){if(this.viewLink&&this.viewLink.isAnnoFieldOpen&&
this.viewLink.isAnnoFieldOpen()){var b=this.game.getAnno(this.isPostAnnoEdit?CB.AnnoType.POSTTEXT:CB.AnnoType.PRETEXT);b?this.viewLink.setAnnoFieldText(b.getString()):this.viewLink.setAnnoFieldText("")}};b.prototype.addTextAnno=function(b){b&&b.length&&(this.game.getOrCreateCurrAnno().addPostText(b),this.game.fireOnChanged())};b.prototype.insertDiagram=function(){var b=this.game.getOrCreateCurrAnno();b.toggleDiagram();this.Vk.onTextAnno(b.getPostText()||"",!0)&&this.game.fireOnChanged()};b.prototype.deleteAnno=
function(b){this.game.deleteAnno(b)};b.prototype.addSymbol=function(b){this.game.getOrCreateCurrAnno().addSymbol(b);this.game.fireOnAnnoChanged()};b.prototype.removeSymbol=function(b){this.game.getOrCreateCurrAnno().addSymbol(b);this.game.fireOnAnnoChanged()};b.prototype.hasTimeAnnos=function(){for(var b=0;b<this.game.getMoves().length-1;b++){var e=this.game.getMoves()[b].getAnno();if(void 0===e||null===e||void 0===e.getItem(CB.AnnoType.TIME))return!1}return 2<this.game.getMoves().length};b.prototype.addTimeAnno=
function(b){b&&this.game.getOrCreateCurrAnno().setItem(CB.AnnoType.TIME,b)};b.prototype.addDiagram=function(){this.addTextAnno(CB.Annotation.DIAG_CHAR)};b.prototype.hasTraining=function(){for(var b=0;b<this.game.getMoves().length-1;b++){var e=this.game.getMoves()[b].getAnno();if(e&&e.getItem(CB.AnnoType.TRAINING))return!0}return!1};b.prototype.gotoFirstTrainingPosition=function(){for(var b=0;b<this.game.getMoves().length-1;b++){var e=this.game.getMoves()[b].getAnno();if(e){e.getItem(CB.AnnoType.TRAINING)&&
this.game.gotoIndex(b+1);break}if(this.game.getMoves()[b].hasLines())break}};b.prototype.getMoveNo=function(){return this.game.getMoveNo()};b.prototype.execEngineMove=function(b){this.game.makeMove(b);this.markLastMove(!1);this.checkIfTechnicalGameEnd()};b.prototype.setIdGame=function(b){this.idGame=b;this.boardWin&&(this.boardWin.idGame=b)};b.prototype.getCurPos=function(){return this.game.getCurPos()};b.prototype.executeGameAction=function(b,e){var c=new CB.DataBuffer,g=!0;"TEXT"==b&&(g=!1);c.constructFromString(e,
g);c.rewind();g=new CB.GameAction;g.fromDataBuf(c);g.isSetBoardOrientation()&&this.boardWin&&this.boardWin.setBlackIsBottom(1==g.nVal,!0);g.fillExecutedMove();c=this.game.getHeader().getWhite();g._doExecute(this.game);g=this.game.getHeader().getWhite();this.game.updateFromExtern();0!=c.localeCompare(g)&&this.game.updateHeaderFromExtern()};b.prototype.copyGameToClipboard=function(){this.toClipboard(this.game.toString())};b.prototype.toClipboard=function(b){if(window.clipboardData&&clipboardData.setData){if(this.boardWin){this.boardWin.addMessage("You may now paste this game as text everywhere.",
!0);var e=this.boardWin;(new CB.Timer).runOnce(3E3,function(){e.destroyMessage()})}clipboardData.setData("Text",b)}};b.prototype.pasteGameFromClipboard=function(){if(window.clipboardData&&clipboardData.getData){var b=clipboardData.getData("Text");this.setPGN(b)}0<V15.Vf.userName.length&&(new CB.ActivityManager(V15.Vf.userName,V15.Vf.password)).getActivity(CB.ACTIVITYTYPE.ACTIVITY_CLIPBOARD_GAME,this.pastGameHandler.bind(this))};b.prototype.pastGameHandler=function(b,e){0!=b&&(this.setPGN(e),this.game.updateFromExtern())};
b.prototype.startLine=function(){this.game.gotoPrev();this.nextMoveEnterType=CB.MoveEnterType.NEWLINE};return b}();"use strict";
CB.GameActionEnum={NOACTION:0,NEWGAME:1,SETGAME:2,GOTOMOVEINDEX:3,SETMOVE:4,MOVEDATA:5,SETANNOTATION:6,DELETELINE:7,PROMOTELINE:8,DELETEPREVIOUS:9,DELETEREMAINING:10,UNANNOTATE:11,ADDANNOTEXT:12,WEBORIGIN:13,SYNC:14,SETGAME2:15,SETGAMEMOVES:16,SETGAMEHEADER:17,SETBOARDORIENTATION:18,toString:function(c){for(var b in this)if(this[b]==c)return"GameAction: "+b;return"Unknown GameAction: "+c}};
CB.GameAction=function(){var c=function(){this.type=CB.GameActionEnum.NOACTION;this.nVal=0};c.prototype.fromDataBuf=function(b){this.type=b.V10();this.nVal=b.V10();switch(this.type){case CB.GameActionEnum.SETMOVE:this.moveRecord=new CB.MoveRecord;this.moveRecord.fromDataBuf(b);break;case CB.GameActionEnum.MOVEDATA:this.moveData=new CB.MoveData;this.moveData.fromDataBuf(b);break;case CB.GameActionEnum.SETGAME:this.setGame=new CB.Game;this.setGame.fromDataBuf(b);break;case CB.GameActionEnum.SETANNOTATION:case CB.GameActionEnum.ADDANNOTEXT:this.anno=
new CB.Annotation;this.anno.fromDataBuf(b);break;case CB.GameActionEnum.SETGAME2:this.setGame=new CB.Game;this.setGame.read3(b);break;case CB.GameActionEnum.SETGAMEMOVES:this.moves=new CB.Moves;this.moves.fromDataBuf2(rBuf,rBuf.ReadInt());break;case CB.GameActionEnum.SETGAMEHEADER:this.header=new CB.Header,this.header.ReadFromDataBuffer(rBuf,0)}};c.prototype.Vz=function(b){b.Vx(this.type);b.Vx(this.nVal);switch(this.type){case CB.GameActionEnum.SETMOVE:this.moveRecord.Vz(b);break;case CB.GameActionEnum.MOVEDATA:this.moveData.Vz(b);
break;case CB.GameActionEnum.SETGAME:this.setGame.Vz(b);break;case CB.GameActionEnum.SETANNOTATION:case CB.GameActionEnum.ADDANNOTEXT:this.anno.Vz(b)}};c.prototype.setMoveData=function(b){this.type=CB.GameActionEnum.MOVEDATA;this.moveData=b};c.prototype.addText=function(b){this.anno=new CB.Annotation;this.anno.addPostText(b);this.type=CB.GameActionEnum.ADDANNOTEXT};c.prototype.isMove=function(){return this.type==CB.GameActionEnum.MOVEDATA||this.type==CB.GameActionEnum.SETMOVE};c.prototype.isMoveData=
function(){return this.type==CB.GameActionEnum.MOVEDATA};c.prototype.isGame=function(){return this.type==CB.GameActionEnum.SETGAME};c.prototype.isSetBoardOrientation=function(){return this.type==CB.GameActionEnum.SETBOARDORIENTATION};c.prototype.isAnno=function(){return this.type==CB.GameActionEnum.ADDANNOTEXT||this.type==CB.GameActionEnum.SETANNOTATION};c.prototype.getTimeCentiSecs=function(){if(this.moveData)return this.moveData.centiSecs};c.prototype.fillExecutedMove=function(){if(this.type==CB.GameActionEnum.SETMOVE)return new CB.Move(this.moveRecord.from,
this.moveRecord.to,this.moveRecord.prom);if(this.type==CB.GameActionEnum.MOVEDATA)return new CB.Move(this.moveData.move[0],this.moveData.move[1],this.moveData.move[2],this.moveData.type)};c.prototype.execute=function(b,d){var e=!0;d&&this.shouldCheckControlMoveBefore()&&(e=this.isControlMoveOk(b,d));e&&(e=this._doExecute(b));e&&d&&this.shouldCheckControlMoveAfter()&&(e=this.isControlMoveOk(b,d));return e};c.prototype.toString=function(){var b=CB.GameActionEnum.toString(this.type);switch(this.type){default:return b;
case CB.GameActionEnum.MOVEDATA:return"MoveData="+this.moveData;case CB.GameActionEnum.SETANNOTATION:return"SetAnno="+this.anno;case CB.GameActionEnum.ADDANNOTEXT:return"AddAnno="+this.anno;case CB.GameActionEnum.SETMOVE:return"SetMove="+this.nVal}};c.prototype._doExecute=function(b){var d=!0;switch(this.type){case CB.GameActionEnum.NEWGAME:b.reset();break;case CB.GameActionEnum.GOTOMOVEINDEX:b.gotoIndex(this.nVal);(d=this.nVal===b.getMoveIndex())||CB.LOG("GotoMoveIndex not ok");break;case CB.GameActionEnum.SETMOVE:var e=
new CB.Move(this.moveRecord.from,this.moveRecord.to,this.moveRecord.prom);this.isValidMove(e,b.getCurPos())?(d=this.nVal,d===CB.MoveEnterType.QUERY&&b.getPlyNum()<b.getMoves().length&&(d=CB.MoveEnterType.OVERWRITE_MAIN),d=b.makeMove(e,d)):d=!1;break;case CB.GameActionEnum.MOVEDATA:d=this.executeMoveData(this.moveData,b);break;case CB.GameActionEnum.SETGAME2:case CB.GameActionEnum.SETGAME:b.assign(this.setGame);d=!0;break;case CB.GameActionEnum.SETANNOTATION:this.nVal||0==b.getMoveOffs()?b.getMoves().setAnno(this.anno):
(e=b.getPreviousMove())&&e.setAnno(this.anno);b.fireOnChanged();break;case CB.GameActionEnum.DELETELINE:b.deleteLine();break;case CB.GameActionEnum.PROMOTELINE:b.promoteLine();break;case CB.GameActionEnum.DELETEPREVIOUS:b.deletePrevious();break;case CB.GameActionEnum.DELETEREMAINING:b.deleteRemaining();break;case CB.GameActionEnum.UNANNOTATE:b.unAnnotate();break;case CB.GameActionEnum.ADDANNOTEXT:(e=this.nVal||0==b.getMoveOffs()?b.getMoves().getAnno():b.getPreviousMove().getAnno())||(e=new CB.Annotation);
this.anno.hasPreText()?e.addPreText(this.anno.getPreText()):this.anno.hasPostText()&&e.addPostText(this.anno.getPostText());this.nVal||0==b.getMoveOffs()?b.getMoves().setAnno(e):b.getPreviousMove().setAnno(e);b.fireOnChanged();break;case CB.GameActionEnum.SYNC:b.onSync(this.nVal);break;case CB.GameActionEnum.SETGAMEMOVES:b.setMoves(this.moves);break;case CB.GameActionEnum.SETGAMEHEADER:b.setHeader(this.header),b.fireOnChanged()}return d};c.prototype.shouldCheckControlMoveBefore=function(){return this.type==
CB.GameActionEnum.SETMOVE||this.type==CB.GameActionEnum.MOVEDATA||this.type==CB.GameActionEnum.SETANNOTATION||this.type==CB.GameActionEnum.ADDANNOTEXT||this.type==CB.GameActionEnum.PROMOTELINE||this.type==CB.GameActionEnum.DELETEREMAINING};c.prototype.shouldCheckControlMoveAfter=function(){return this.type==CB.GameActionEnum.GOTOMOVEINDEX||this.type==CB.GameActionEnum.DELETEPREVIOUS||this.type==CB.GameActionEnum.DELETELINE};c.prototype.isControlMoveOk=function(b,d){return 0==b.getMoveOffs()||b.getPreviousMove()&&
b.getPreviousMove().equals(d)};c.prototype.changesMoves=function(){return this.type==CB.GameActionEnum.SETMOVE||this.type==CB.GameActionEnum.MOVEDATA||this.type==CB.GameActionEnum.NEWGAME||this.type==CB.GameActionEnum.DELETELINE||this.type==CB.GameActionEnum.PROMOTELINE||this.type==CB.GameActionEnum.DELETEPREVIOUS||this.type==CB.GameActionEnum.DELETEREMAINING};c.prototype.executeMoveData=function(b,d){var e=!1;try{var c=new CB.Move(b.move[0],b.move[1],b.move[2]);this.isValidMove(c,d.getCurPos())&&
(d.enableEvents(!1),d.makeMove(c,CB.MoveEnterType.OVERWRITE_MAIN),d.getOrCreateCurrAnno().setItem(CB.AnnoType.TIME,new CB.TimeAnno(CB.TimeTools.getCBTimeOfCentiSecs(b.centiSecs))),d.enableEvents(!0),d.fireOnMove(),d.fireOnCurPosChanged(),e=!0)}catch(g){CB.LogException("GA::ExecMoveData",g)}return e};c.prototype.isValidMove=function(b,d){return d.isLegalMove(b)};return c}();"use strict";
CB.ScriptCommand=function(){var c=function(){this.time=0;this.action=this.type=""};c.prototype.fromString=function(b,d){for(var e="",c=0,g=0,h=0,l=0,q=0;q<b.length;q++)":"==b[q]?(0==c?g=parseInt(e,10):1==c?h=parseInt(e,10):2==c&&(l=parseInt(e,10)),e="",c++):e+=b[q];this.time=l+60*h+3600*g;q=d.search(":");-1!=q&&(this.type=d.substring(0,q),this.action=d.substring(q+1))};return c}();"use strict";
CB.DrawType={NOT_DECIDED:0,MATE:1,STALEMATE:2,MATERIAL:3,THREE_TIMES:4,FIFTY_MOVES:5,MOVES_290:6,DRAW:7,WHITE_WINS:8,BLACK_WINS:9,TWO_TIMES:10};
CB.DrawChecker=function(){var c=function(){};c.prototype.checkGame=function(b){var d=this.checkPos(b.getCurPos());if(d!=CB.DrawType.NOT_DECIDED)return d;if(5<=b.getPlyNum()){for(var d=b.getCurPos().getCastleRights(),e=b.getMoves().length,c=Math.max(0,e-5),g=e-1;g>=c;g--){var h=b.getMoves()[g];if(h){if(!h.undo&&h.isValid()&&g<b.getPlyNum()-1){for(c=h=0;c<g;c++)b.getMoves()[c].undo&&h++;break}if(h.isTake()||h.isProm()||h.isPawn())return CB.DrawType.NOT_DECIDED}else return CB.DrawType.NOT_DECIDED}for(var c=
b.getCurPos().getEPCol(),l=b.getPlyNum()-100,q=1,r=ObjUtil.clone(b.getCurPos()),g=e;0<g;--g){h=b.getMoves()[--g];if(!h||!h.undo)break;if(h.isTake()||h.isProm()||h.isPawn())break;if(b.getCurPos().getEPCol()!=c)break;if(g<=l)return CB.DrawType.FIFTY_MOVES;r.unmakeMove(h,h.undo);if(q&&d!=r.getCastleRights()&&(q=0,0>=l))break;if(0<g){h=b.getMoves()[--g];if(h.isTake()||h.isProm()||h.isPawn())break;if(b.getCurPos().getEPCol()!=c)break;if(g<=l)return CB.DrawType.FIFTY_MOVES;if(!h.undo)break;r.unmakeMove(h,
h.undo);if(q){if(d!=r.getCastleRights()&&(q=0,0>=l))break;if(c==r.getEPCol()&&r.boardEquals(b.getCurPos().board)&&(q++,3<=q))return CB.DrawType.THREE_TIMES}}}}return CB.DrawType.NOT_DECIDED};c.prototype.checkPos=function(b){if(!b.hasLegals())return b.isCheck()?CB.DrawType.MATE:CB.DrawType.STALEMATE;for(var d=[0,0,0,0,0,0,0,0],e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=0,g=0,h=0;64>h;h++)d[b.board[h]&7]++,e[b.board[h]&15]++,(b.board[h]&7)==CB.Piece.BISHOP&&(b.board[h]&8?g=(h&1)==(h>>3&1)?g|1:g|2:c=(h&1)==
(h>>3&1)?c|1:c|2);return d[CB.Piece.QUEEN]||d[CB.Piece.ROOK]||d[CB.Piece.PAWN]||!(!d[CB.Piece.BISHOP]&&1>=d[CB.Piece.KNIGHT]||!d[CB.Piece.KNIGHT]&&(1>=d[CB.Piece.BISHOP]||3>c&&3>g&&(!c||!g||c==g)))?CB.DrawType.NOT_DECIDED:CB.DrawType.MATERIAL};c.prototype.canWin=function(b,d){var e=!1;try{for(var c=b.board,g=d==CB.Side.WHITE?0:CB.Side.SIDE_MASK,h=[],l=0;16>l;l++)h[l]=0;for(l=0;64>l;l++)h[c[l]&15]++,c[l]&&(c[l]&CB.Side.SIDE_MASK)==g&&(c[l]&CB.Piece.PIECE_MASK)!=CB.Piece.KING&&(e=!0);if(e&!h[CB.Piece.W_PAWN]&&
!h[CB.Piece.B_PAWN]){var q=d==CB.Side.WHITE?CB.Piece.WHITE:CB.Piece.BLACK;if(!(h[q|CB.Piece.QUEEN]||h[q|CB.Piece.ROOK]||1!=h[q|CB.Piece.BISHOP]+h[q|CB.Piece.KNIGHT]||h[CB.Piece.COLOUR-q|CB.Piece.BISHOP]||h[CB.Piece.COLOUR-q|CB.Piece.KNIGHT]))if(h[q|CB.Piece.BISHOP]){if(h[CB.Piece.COLOUR-q|CB.Piece.QUEEN]||h[CB.Piece.COLOUR-q|CB.Piece.ROOK])e=!1}else h[q|CB.Piece.KNIGHT]&&h[CB.Piece.COLOUR-q|CB.Piece.QUEEN]&&!h[CB.Piece.COLOUR-q|CB.Piece.ROOK]&&(e=!1)}}catch(r){e=!0,CB.LogException("CanWin",r)}return e};
c.getStrDrawType=function(b){switch(b){default:case CB.DrawType.MATE:return"Mate";case CB.DrawType.STALEMATE:return"Stalemate";case CB.DrawType.MATERIAL:return"No Material";case CB.DrawType.THREE_TIMES:return"Threefold Rep";case CB.DrawType.FIFTY_MOVES:return"50 Moves Rule";case CB.DrawType.MOVES_290:return"290 Moves";case CB.DrawType.DRAW:return"Draw";case CB.DrawType.WHITE_WINS:return"WWin";case CB.DrawType.BLACK_WINS:return"BWin";case CB.DrawType.TWO_TIMES:return"Twofold Rep"}};return c}();"use strict";
CB.BaseClock=function(){var c=0,b=function(b){this.clockLink=b;this.updateTimer=new CB.Timer(this.update.bind(this));this.isBlack=!1;this.id=++c};b.prototype.onTimeOverstepped=function(b){this.clockLink.showTimeOverstepped(b)};b.prototype.setNoClock=function(){this.clockLink.setText("---",!1);this.clockLink.setText("---",!0)};b.prototype.start=function(){};b.prototype.stop=function(){};b.prototype.isRunning=function(){return!1};b.prototype.setToMove=function(b){this.isBlack=b};b.prototype.onMove=
function(b){this.setToMove(b);this.start()};b.prototype.initFromGame=function(b){};b.prototype.onTimeOverstepped=function(b){this.clockLink.showTimeOverstepped(b)};b.prototype.update=function(){};return b}();"use strict";CB.namespace("CB.CMSIManager");
CB.CMSIManager=function(){var c=function(b,d){this.kernel=b;this.cmsFiles=[]};c.prototype.addFile=function(b){this.cmsFiles.push(b)};c.prototype.GetIntelligentFileName=function(b,d,e,c,g){b=(new Position(b)).toFen();return extractFileNameFromFen(b)+"x"+String(d)+"y"+String(e)+"v"+c+"u"+g};c.prototype.extractFileNameFromFen=function(b){for(var d=0;d<b.length;d++)"/"==b[d]&&(b="z");return b};c.prototype.extractFenFromFileName=function(b){b=b.replace(/z/g,"/");var d=b.search("x");return-1!=d?b.substr(0,
d):""};c.prototype.extractMoveFromFileName=function(b){var d=b.search("x"),e=b.search("y"),c=b.search("v"),g=0,h=0;-1!=d&&-1!=e&&-1!=c&&c>e&&e>d&&(g=b.substr(d+1,e-d-1),b=b.substr(e+1,c-e-1),g=parseInt(g),h=parseInt(b));return new CB.Move(g,h,0,0)};c.prototype.extractStateFromFileName=function(b){var d=0,e=b.search("v"),c=b.search("u");-1!=e&&-1!=c&&c>e&&(b=b.substr(e+1,c-e-1),d=parseInt(b));return d};c.prototype.extractPointsFromFileName=function(b){var d=0,e=b.search("u");-1!=e&&(b=b.substr(e+1),
d=parseInt(b));return d};c.prototype.getPositionFromFileName=function(b){b=this.extractFenFromFileName(b);return b.length?new CB.Position(b):null};c.prototype.belongsToPosition=function(b,d){var e=this.getPositionFromFileName(d);if(e)for(var e=e.toFEN(),c=b.toFEN(),g=0,h=0;h<c.length&&!(e.length<h)&&e[h]==c[h];h++)if(" "==c[h]&&(g++,3==g))return!0;return!1};c.prototype.getNextFileName=function(b){var d=b.substr(b.length-3,3);d++;for(var e=0;e<this.cmsFiles.length;e++)if(d==this.cmsFiles[e].substr(this.cmsFiles[e].length-
3,3))return this.cmsFiles[e];return b};c.prototype.getPreviousFileName=function(b){var d=b.substr(b.length-3,3);d--;0>d&&(d=0);for(var e=0;e<this.cmsFiles.length;e++)if(d==this.cmsFiles[e].substr(this.cmsFiles[e].length-3,3))return this.cmsFiles[e];return b};c.prototype.getFile=function(b){for(var d=0;d<this.cmsFiles.length;d++)if(-1!=this.cmsFiles[d].indexOf(b))return this.cmsFiles[d];return""};c.prototype.collectFiles=function(b){for(var d=[],e=0;e<this.cmsFiles.length;e++)this.belongsToPosition(b,
this.cmsFiles[e])&&d.push(this.cmsFiles[e]);return d};return c}();"use strict";
CB.ClockParams=function(){var c=function(b,d){this.startMins=void 0!==b?b:0;this.incSecs=d||0;1>this.startMins&&0==this.incSecs&&(this.startMins=1);this.flags=this.addSecs=this.addMins=0};c.POOL_BLITZ=1;c.prototype.fromDataBuf=function(b){this.startMins=b.V10()&65535;this.incSecs=b.V10()&65535;this.addMins=b.V11();this.addSecs=b.V11();this.flags=b.V10()};c.prototype.Vz=function(b){b.Vx(this.startMins&65535);b.Vx(this.incSecs&65535);b.Vv(this.addMins);b.Vv(this.addSecs);b.Vx(this.flags)};c.prototype.toString=
function(){return this.startMins+"m + "+this.incSecs+"s"};c.prototype.canBePoolBlitz=function(){return 0==this.addMins&&0==this.addSecs&&0==this.incSecs&&(1==this.startMins||3==this.startMins||5==this.startMins)};c.createFromSeekParams=function(b){var d=new CB.ClockParams(3,0);b&&(b=b.split(","),b.length&&(d.startMins=b[0],0==d.startMins&&(d.startMins=5),1<b.length&&(d.incSecs=b[1])));return d};c.prototype.getSortVal=function(){return 40*this.startMins+this.incSecs};c.prototype.calcRatingType=function(){return 900<
this.getAvGameTimeSeconds()?CB.Server.EloRating.SLOW:180<=this.getAvGameTimeSeconds()?CB.Server.EloRating.BLITZ:CB.Server.EloRating.BULLET};c.prototype.getGameTypeName=function(){switch(this.calcRatingType()){case CB.Server.EloRating.BULLET:return"Bullet";case CB.Server.EloRating.BLITZ:return"Blitz";case CB.Server.EloRating.SLOW:return"Slow"}};c.prototype.getAvGameTimeSeconds=function(){return 60*this.startMins+40*this.incSecs};c.prototype.isBlitz=function(){return this.calcRatingType()==CB.Server.EloRating.BLITZ};
c.prototype.isBullet=function(){return this.calcRatingType()==CB.Server.EloRating.BULLET};c.prototype.isSlow=function(){return this.calcRatingType()==CB.Server.EloRating.SLOW};c.prototype.getStartSecs=function(){return 60*this.startMins};return c}();"use strict";CB.TimeTrouble={SLIGHTLY_BEHIND:-1,BEHIND:-2,CLEARLY_BEHIND:-3,LOSING_ON_TIME:-4,ABOUT_EVEN:0,SLIGHTLY_AHEAD:1,AHEAD:2,CLEARLY_AHEAD:3};
CB.ChessClock=function(){var c=1,b=function(b,e,f){CB.ChessClock.superClass.call(this,b);this.fnTimeout=e;this.fnWarnClock=f;this.result=CB.GameResultEnum.GAME_UNFINISHED;this.runsForward=!1;this.centiSecsBlack=this.centiSecsWhite=0;this.uniqueId=c++;this._isRunning=!1;this.mySide=null;this.warned=[]};CB.inherit(b,CB.BaseClock);b.prototype.getWTimeMilli=function(){return 10*this.centiSecsWhite};b.prototype.getBTimeMilli=function(){return 10*this.centiSecsBlack};b.prototype.destroy=function(){};b.prototype.reinit=
function(){this.setClockParams(this.clockParams)};b.prototype.setClockParams=function(b){this.warned=[!1,!1];this.result=CB.GameResultEnum.GAME_UNFINISHED;b?(this.clockParams=b,this.centiSecsWhite=6E3*this.clockParams.startMins,this.centiSecsBlack=6E3*this.clockParams.startMins,0==this.clockParams.startMins&&(this.centiSecsBlack=this.centiSecsWhite=1E3),this.clockLink.showRestTime(new Date(10*this.centiSecsWhite),!1),this.clockLink.showRestTime(new Date(10*this.centiSecsBlack),!0),this.clockLink.setDisplayHours(3E3<
this.clockParams.getAvGameTimeSeconds())):(this.setNoClock(),delete this.clockParams);delete this.startTime;delete this.expiredAtStop};b.prototype.setRunsForward=function(b){this.runsForward=b;this.clockLink.setRunsForward(b)};b.prototype.initFromGame=function(b){this.stop();if(this.clockParams){for(var e=6E3*this.clockParams.startMins,c=6E3*this.clockParams.startMins,g=this.runsForward?-1:1,h=0;h<b.getPlyNum();h++)if(h<b.getMoves().length){var l=b.getMoves()[h].getAnno();l&&(l=l.getItem(CB.AnnoType.TIME))&&
(h&1?(c-=g*l.getTimeIn100th(),c+=g*this.clockParams.incSecs*100):(e-=g*l.getTimeIn100th(),e+=g*this.clockParams.incSecs*100))}this.centiSecsWhite=e;this.centiSecsBlack=c;this.takeStartTime();this.isBlack=0!=(b.getMoves().length&1);this.clockLink.setToMove(this.isBlack);this.showTimes(e,c);b.isOnLastMove()&&(b.hdr.getCBResult().isFinished()?this.clockLink.showResult(b.hdr.getResult()):this.start())}};b.prototype.onResult=function(b){this.isFinished()||(this.result=b,this.stop(),this.clockLink.showResult(b),
CB.LOG("Clock On result: "+this.result,"LogBold"))};b.prototype.unfinish=function(){this.result=CB.GameResultEnum.GAME_UNFINISHED};b.prototype.isFinished=function(){return this.result>=CB.GameResultEnum.BLACK_WINS&&this.result<=CB.GameResultEnum.LINE};b.prototype.setToMove=function(b){CB.LOG("Clock, setToMove, black= "+b);this.clockParams&&!this.isFinished()&&((this.isBlack=b)?this.centiSecsBlack+=100*this.clockParams.incSecs:this.centiSecsWhite+=100*this.clockParams.incSecs,this.takeStartTime(),
this.clockLink.setToMove(b))};b.prototype.isRunning=function(){return this._isRunning};b.prototype.start=function(){this._isRunning||!this.clockParams||this.isFinished()||(this._isRunning=!0,this.takeStartTime(),this.showTimes(this.centiSecsWhite,this.centiSecsBlack),this.updateTimer.runOnce(1E3),delete this.expiredAtStop)};b.prototype.stop=function(){if(this._isRunning&&(this.updateTimer.stop(),this.startTime)){this._isRunning=!1;var b=(CB.getTick()-this.startTime+5)/10;this.expiredAtStop=b;this.isFinished()||
this.setExpired(b,this.isBlack)}};b.prototype.takeStartTime=function(){this.startTime=CB.getTick();this.restTimeAtStart=this.isBlack?this.centiSecsBlack:this.centiSecsWhite};b.prototype.getRestCentiSecs=function(b){return b?this.centiSecsBlack:this.centiSecsWhite};b.prototype.showTimes=function(b,e){0<=b?this.clockLink.showRestTime(new Date(10*b),!1):this.clockLink.showRestTime(-1,!1);0<=e?this.clockLink.showRestTime(new Date(10*e),!0):this.clockLink.showRestTime(-1,!0)};b.prototype.setExpired=function(b,
e){if(this.clockParams){this.clockLink.showCurrTime(new Date(10*b),e);var c;this.clockLink.showCurrTime(new Date(10*b),e);c=this.runsForward?e?this.centiSecsBlack=this.restTimeAtStart+b:this.centiSecsWhite=this.restTimeAtStart+b:e?this.centiSecsBlack=this.restTimeAtStart-b:this.centiSecsWhite=this.restTimeAtStart-b;0>c?this.clockLink.showRestTime(-1,e):this.clockLink.showRestTime(new Date(10*c),e,this.getTimeTroubleIndex());return c}};b.prototype.changeCurrMoveElapsedTime=function(b){if(this.clockParams&&
!this.isFinished()){var e=(CB.getTick()-this.startTime+5)/10;this.startTime=CB.getTick()-10*b;this.restTimeAtStart-=b-e;this.updateTimer.stop();this.expiredAtStop=b;this.setExpired(b,this.isBlack);this.update()}};b.prototype.reset=function(){this.setClockParams(new CB.ClockParams(0,0))};b.prototype.getExpired=function(){return this.expiredAtStop?this.expiredAtStop:this.startTime?(CB.getTick()-this.startTime+5)/10:0};b.prototype.getStrRestTimes=function(){var d=b.getTimeString(new Date(10*this.centiSecsWhite)),
e=b.getTimeString(new Date(10*this.centiSecsBlack)),c="";0<=this.centiSecsWhite&&(c=String.f("{0}={1}",lm.WHITE,d));d="";0<=this.centiSecsBlack&&(d=String.f("{0}={1}",lm.BLACK,e));(e=c)&&d&&(e+=", ");return e+d};b.prototype.createTimeAnno=function(){return new CB.TimeAnno(CB.TimeTools.getCBTimeOfCentiSecs(this.getExpired()))};b.prototype.setText=function(b,e){this.clockLink.setText(b,e)};b.prototype.update=function(){var b=(CB.getTick()-this.startTime+5)/10,e=this.setExpired(b,this.isBlack);if(0<
e){this.clockLink.setDisplayCentiSecs(1E3>e);var c=1E3;1E3>e&&(c=100);this.updateTimer.runOnce(c);15<b/100&&b>e/3&&this.fnWarnClock&&!this.warned[this.isBlack?1:0]&&(this.fnWarnClock(this.isBlack),this.warned[this.isBlack?1:0]=!0)}else CB.LOG("Clock Timeout: "+this.uniqueId,"LogBold"),this.fnTimeout&&!this.isFinished()&&(this.clockLink.setText("TIME",this.isBlack),this.fnTimeout())};b.prototype.getTimeTroubleIndex=function(){if(null!=this.mySide){var b,c;this.isBlack?(b=this.centiSecsBlack,c=this.centiSecsWhite):
(b=this.centiSecsWhite,c=this.centiSecsBlack);return Math.abs(b-c)<.1*Math.abs(b)&&2E3<b?CB.TimeTrouble.ABOUT_EVEN:b>c?b>1.2*c?b>2*c?CB.TimeTrouble.CLEARLY_AHEAD:CB.TimeTrouble.AHEAD:CB.TimeTrouble.SLIGHTLY_AHEAD:b<.7*c?b<.5*c?b<.3*c&&1E3>b?CB.TimeTrouble.LOSING_ON_TIME:CB.TimeTrouble.CLEARLY_BEHIND:CB.TimeTrouble.BEHIND:CB.TimeTrouble.SLIGHTLY_BEHIND}return 0};b.getTimeString=function(b,c,f){0>b&&(b=new Date(0));var g="";c&&(g=b.getUTCHours()+":");1E4>b.valueOf()&&!f?(c=b.getUTCSeconds(),b=Math.floor(b.getUTCMilliseconds()/
100),g=c+"."+b+"s"):(c=b.getUTCMinutes(),1==c.toString().length&&0<c&&(c="0"+c),g+=c,c=Math.floor(b.getUTCSeconds()),1==c.toString().length&&(c="0"+c),g+=":"+c);return g};return b}();"use strict";CB=CB||{};
CB.AbstractPlayingMode=function(){var c=function(){};c.prototype.destroy=function(){};c.prototype.deleteClock=function(){};c.prototype.onTimeOverstepped=function(b){};c.prototype.onAnnotate=function(){this.saved=!1;return!0};c.prototype.onTextAnno=function(b,d){this.saved=!1;return!0};c.prototype.onInsertDiagram=function(){this.saved=!1;return!0};c.onEval=function(b){this.saved=!1;return!0};c.prototype.onPromoteLine=function(){this.saved=!1;return!0};c.prototype.onDeletePrevious=function(){this.saved=
!1;return!0};c.prototype.onCutLine=function(){this.saved=!1;return!0};c.prototype.onDeleteLine=function(){this.saved=!1;return!0};c.prototype.onBeforeUnload=function(){};c.prototype.getMoveEnterType=function(){return CB.MoveEnterType.OVERWRITE_MAIN};c.prototype.mayNavigate=function(){return!0};c.prototype.mayGotoNext=function(){return!0};c.prototype.mayGotoEnd=function(){return!0};c.prototype.mayPageDown=function(){return!0};c.prototype.mayLoadGames=function(){return!0};c.prototype.onKeyDown=function(b){return!1};
c.prototype.isAnalysis=function(){return!1};c.prototype.setAnalysis=function(b){};c.prototype.engineMoveNow=function(){return!1};c.prototype.onResetGame=function(){};c.prototype.beforeGameLoad=function(){this.saveAndReset();this.saved=!1};c.prototype.afterGameLoad=function(){};c.prototype.updateHeader=function(){};c.prototype.saveAndReset=function(){this.saveToCloud(!0);this.cntUpdates=0};c.prototype.onExit=function(){this.saveToCloud()};c.prototype.onEntry=function(){};c.prototype.shouldAnimatePosChange=
function(){6;return CB.System.runsOnChessBaseDomain()||!CB.System.isNonCrossDomainIE()};c.prototype.saveToCloud=function(b){return V15.cloudMgr&&V15.cloudMgr.isConnected()&&!this.saved&&this.shouldSave(b)&&(6<this.kernel.game.getMoves().length||!this.kernel.game.isNormalInit())?(V15.cloudMgr.saveGameToClipboard(this.kernel.game),this.saved=!0):!1};c.prototype.shouldSave=function(){return!0};c.prototype.updateGamePos=function(){};c.prototype.onGameMove=function(){};c.prototype.onGameNavigate=function(){};
c.prototype.onClickInNotation=function(){};c.prototype.toggleAnalysis=function(){};c.prototype.onPosInput=function(b){};c.prototype.onEnteredMove=function(b){return!0};c.prototype.onAfterMoveEntry=function(b){};c.prototype.onResult=function(b){};c.prototype.updateClockFromGame=function(){};c.prototype.startClock=function(){};c.prototype.stopClock=function(){};c.prototype.getAllowedColor=function(){return CB.AllowedColor.BOTH_COLORS};c.prototype.setLegals=function(b){};c.prototype.getMySide=function(){return null};
c.prototype.setMySide=function(b){};c.prototype.userClosesBoard=function(){};c.prototype.setTimeControl=function(b){};c.prototype.setManualClock=function(){};c.prototype.setChessClock=function(){};c.prototype.resetGame=function(b){b.reset()};c.prototype.newGame=function(){};c.prototype.onPanelsReady=function(){};c.prototype.createGUIElements=function(b){};c.prototype.destroyGUIElements=function(b){};c.prototype.saveState=function(b){};c.prototype.loadState=function(b){};c.prototype.posLegalChecker=
function(b){return b.isLegal()};c.prototype.reactToEnteredMove=function(b){return!1};c.prototype.blockLiveBookUpdate=function(b){};c.prototype.getFnLoadSearchResult=function(){return CB.CloudPlayingModeMixin?CB.CloudPlayingModeMixin.getFnLoadSearchResult():null};return c}();"use strict";CB=CB||{};
CB.PlayingMode=function(){var c=function(b){CB.PlayingMode.superClass.call(this);this.kernel=b;this.isAutoplay=!1};CB.inherit(c,CB.AbstractPlayingMode);c.prototype.loadGame=function(b){this.beforeGameLoad();this.kernel.game.assign(b);this.afterGameLoad()};c.prototype.destroy=function(){this.deleteClock()};c.prototype.deleteClock=function(){this.clock=null;this.manualClock&&(this.manualClock.stop(),delete this.manualClock);this.chessClock&&(this.chessClock.stop(),delete this.chessClock)};c.prototype.onTimeOverstepped=
function(b){if(this.clock)this.clock.onTimeOverstepped(b)};c.prototype.onEnteredMove=function(b){this.clock&&this.clock.stop();return!0};c.prototype.isAnalysis=function(){return!0};c.prototype.initAnalysisEngine=function(b){try{"undefined"!==typeof V15&&!V15.analysisEngine&&CB.System.isDesktop()&&V15.config.useAnalysisEngines&&CB.AnalysisEngine&&(V15.analysisEngine=new CB.AnalysisEngine(b))}catch(d){CB.LogException("PM:initAnalysisEngine",d)}};c.prototype.initThreatEngine=function(b){try{this.threatEngine=
new CB.EngineWrapper(0,"/Common/Chess/Engine/Enginemin.js",null,this),CB.System.isElectron()||this.threatEngine.load()}catch(d){CB.LogException("PM:initThreatEngine",d)}};c.prototype.onEnginePV=function(b,d){};c.prototype.onEngineMove=function(b,d){};c.prototype.getMoveEnterType=function(){return this.kernel.game.isLineEnd()?CB.MoveEnterType.NEWLINE:V15.allowMoveEntryDialog()?CB.MoveEnterType.QUERY:this.isAnalysis()?CB.MoveEnterType.NEWLINE:CB.MoveEnterType.OVERWRITE_MAIN};c.prototype.onResult=function(b){if(this.clock)this.clock.onResult(b)};
c.prototype.updateClockFromGame=function(){this.clock&&this.clock.initFromGame(this.kernel.game)};c.prototype.startClock=function(){this.clock&&this.clock.start()};c.prototype.stopClock=function(){this.clock&&this.clock.stop()};c.prototype.getAllowedColor=function(){return CB.AllowedColor.BOTH_COLORS};c.prototype.onGameNavigate=function(){this.updateClockFromGame()};c.prototype.setManualClock=function(b,d,c){delete this.chessClock;this.kernel.boardWin&&this.kernel.boardWin.getClockDisplay()&&(this.clock&&
this.clock.stop(),this.manualClock=new CB.ManualClock(this.kernel.boardWin.getClockDisplay()),this.manualClock.setTime(b,d,c),this.manualClock.onResult(this.kernel.game.hdr.getResult()),this.clock=this.manualClock)};c.prototype.updateHeader=function(){if(this.manualClock)this.manualClock.onResult(this.kernel.game.hdr.getResult())};c.prototype.setChessClock=function(b){delete this.manualClock;this.kernel.boardWin&&this.kernel.boardWin.hasClock()&&(this.chessClock=new CB.ChessClock(this.kernel.boardWin.getClockDisplay()),
this.chessClock.setClockParams(b),b&&this.chessClock.initFromGame(this.kernel.game),this.clock=this.chessClock)};c.prototype.linkBoardHints=function(b){b.fnMarkSquaresOnButtonDown=this.getMarkedSquaresOnButtonDown.bind(this)};c.prototype.unlinkBoardHints=function(){this.kernel.boardWin&&(this.kernel.boardWin.fnMarkSquaresOnButtonDown=null)};c.prototype.getMarkedSquaresOnButtonDown=function(b){return this.genLegalSquareHints(b)};c.prototype.getLegalSqClr=function(){return"hsla( 0, 0%, 50%, 0.25 )"};
c.prototype.genLegalSquareHints=function(b){var d=[];this.kernel.game.getCurPos().V7().forEach(function(c){c.from==b&&d.push({sq:c.to,clr:this.getLegalSqClr()})}.bind(this));return d};c.prototype.setIsAutoplay=function(b){this.isAutoplay=b};return c}();CB.ResultFlags={TECHNICAL:2,MY_TIME:4,RESIGN:8,OPP_RESIGN:16};"use strict";CB=CB||{};
CB.EngineHostMode=function(){var c=function(b,d){CB.PlayingMode.call(this,b);this.szPool=d||0;this.engines=[];this.nEngines=0;this.panEng=null};CB.inherit(c,CB.PlayingMode);c.prototype.loadEngineInstance=function(b,d,c){return new CB.EngineInstance(b,this.szPool,d,c)};c.prototype.changeEngineLines=function(b){var d=this.engines[0],c=d.getMultiPV(),c=Math.max(c+b,1);this.stopAll();d.setMultiPV(c);this.goAll()};c.prototype.loadEngine=function(b){this.nEngines<b+1&&(this.nEngines=b+1);if(V15.panelMgr.openEnginePanel){var d=
this.panEng=V15.panelMgr.openEnginePanel(b);if(d&&!this.engines[b]){var c=this.engines[b]=this.loadEngineInstance(V15.config.getEngineUrl()[b],b);d.setEngine(c);d.setAnalysis&&d.setAnalysis(this.isAnalysis());this.addOnBestMove(c);c.setTag(b)}}};c.prototype.isEngineLoaded=function(b){return!!this.engines[b]};c.prototype.unloadEngine=function(b){this.engines[b]&&(this.engines[b].exit(),delete this.engines[b])};c.prototype.onBestMove=function(b,d){this.kernel.game.getCurPos().isLegalMove(d.move)&&this.kernel.execEngineMove(d.move)};
c.prototype.addOnBestMove=function(b){this.idOnBestMove||(this.idOnBestMove=b.addOnBestMoveListener(this.onBestMove.bind(this)))};c.prototype.removeOnBestMove=function(b){b.removeOnBestMoveListener(this.idOnBestMove);this.idOnBestMove=null};c.prototype.destroy=function(){this.stopAll();this.engines.forEach(function(b){b&&b.dispose()})};c.prototype.goAll=function(){this.engines.forEach(function(b){b&&b.go(this.kernel.game)}.bind(this))};c.prototype.stopAll=function(){this.engines.forEach(function(b){b&&
b.stop()})};c.prototype.newGame=function(){this.stopAll();this.engines.forEach(function(b){b&&b.newGame()})};c.prototype.setEngineOff=c.prototype.stopAll;c.prototype.toggleHandicap=function(){this.setHandicap(!this.isHandicap())};c.prototype.setHandicap=function(b){};c.prototype.isHandicap=function(){return!1};c.prototype.getHandicap=function(){return 0};c.prototype.saveState=function(b){};c.prototype.loadState=function(b){};return c}();"use strict";
CB.MiniPlayMode=function(){var c={engineName:"Fritz"},b=function(d,e,h,l){h=h||{};this.nPlugin=l;this.options=ObjUtil.copyTo(c,h,!0);b.superClass.call(this,d);this.kernel=d;this.engineSide=null;this.engineAnswers=!0;this.engineTimeouter=new CB.Timer;this.clickHintTimer=new CB.Timer;this.animTimer=new CB.Timer;this.engUrl="https://pgn.chessbase.com/common/chess/engine/enginemin.js";this.engine=[];this.engine[0]=new CB.EngineWrapper(0,this.engUrl,null,this);this.engine[0].load();this.parseThinkTime(e.play||
"700");this.suppressTechnicalResult=!0;this.hintMove=this.eval=null;this.saved=!1;this.clearBoardMsgTimer=new CB.Timer(this.clearBoardMsg.bind(this));this.execEngineMoveTimer=new CB.Timer;this.dataset=e;this.parseDataSet(e);this.engineStartTick=new CB.Tick;this.hintCnt=0};CB.inherit(b,CB.PlayingMode);b.prototype.destroy=function(){this.superClass.destroy.call(this);this.unlinkButtonDownHints();this.clickHintTimer&&this.clickHintTimer.stop();V15.analysisEngine&&(V15.analysisEngine.dispose(),V15.analysisEngine.unlinkPlayingMode(this))};
b.prototype.onEnginePV=function(b,d){d&&(this.eval=d.eval,this.engineSide===CB.Side.BLACK&&(this.eval=-this.eval),d.pv&&2<=d.pv.moves.length&&(this.hintMove=new CB.Move,this.hintMove.fromJSON(d.pv.moves[1])));if(this.options.idDOMEngOut&&d.pv.moves.length){var c=new CB.Move;c.fromJSON(d.pv.moves[0]);c=(new CB.NotationGenerator).getNota(c,this.kernel);$("#"+this.options.idDOMEngOut).text(c+" / "+d.maxDepth)}};b.prototype.onEngineMove=function(b,d){this.shouldShowBusyCursor()&&this.kernel.boardWin.setBusy(!1);
var c=Math.max(0,1E3-this.engineStartTick.getExpiredMS());this.execEngineMoveTimer.runOnce(c,function(){this.execEngineMove(d)}.bind(this))};b.prototype.execEngineMove=function(b){var d=new CB.Move;d.fromJSON(b.move);this.kernel.game.getCurPos().isLegalMove(d)&&(this.kernel.execEngineMove(d),V15.analysisEngine&&V15.analysisEngine.engineGo(this.kernel),this.eval=b.eval,this.engineSide===CB.Side.BLACK&&(this.eval=-this.eval),this.checkEvalGoal())};b.prototype.getMoveEnterType=function(){return CB.MoveEnterType.OVERWRITE};
b.prototype.onEntry=function(){};b.prototype.createGUIElements=function(b){this.boardWin=b;this.superClass.createGUIElements.call(this,b);this.kernel.onTechnicalGameEnd=this.onTechnicalGameEnd.bind(this);V15.analysisEngine?V15.analysisEngine.linkPlayingMode(this):this.linkButtonDownHints();this.dataset.solved&&this.addCheckMark();this.dataset.level&&this.addLevelMark(this.dataset.level);this.hasClickGoal()&&(this.boardWin.clickHandler=this.boardSquareClickHandler.bind(this))};b.prototype.boardSquareClickHandler=
function(b){for(var d=0;d<this.goals.length;d++){var c=this.goals[d];if(c.isClickGoal()){var e=c.checkClick(b);if(null!=this.onGoalMetResult(c,e))break}}};b.prototype.linkButtonDownHints=function(){this.clickHintTimer||(this.clickHintTimer=new CB.Timer);this.kernel.boardWin.fnMarkSquaresOnButtonDown=this.getMarkedSquaresOnButtonDown.bind(this);this.startClickHintTimer&&(this.kernel.boardWin.fnSquareClick=this.startClickHintTimer.bind(this));this.kernel.boardWin.fnSquareChangeInMouseMove=function(){this.clickHintTimer.stop()}.bind(this);
this.kernel.boardWin.fnSquareRelease=function(){this.clickHintTimer.stop()}.bind(this)};b.prototype.unlinkButtonDownHints=function(){this.kernel.boardWin.fnSquareClick=null;this.kernel.boardWin.fnMarkSquaresOnButtonDown=null};b.prototype.destroyGUIElements=function(b){this.superClass.destroyGUIElements.call(this,b)};b.prototype.restart=function(){this.goals&&this.goals.forEach(function(b){b.isClickGoal&&b.sqsVisited&&this.removeVisitedSquareMarks(b.sqsVisited)}.bind(this));var b=this.dataset.moves;
b?(new CB.Position,this.kernel.game.assign(CB.PGN.parseGame(b)),this.kernel.game.gotoLast()):this.kernel.game.gotoFirst();this.hintMove=this.eval=null;this.kernel.boardWin.allowInput=!0;this.kernel.boardWin.destroyMessage();this.kernel.boardWin.destroySideIcon()};b.prototype.parseDataSet=function(b){this.parseGoals(b);this.parseVisualizations(b);this.parsePieceSquareTables(b);this.id=b.posid||"noid"};CB.Goal=function(){var b=function(){this.control="stop";this.reset()};b.prototype.reset=function(){this.countMet=
0;this.feedBackDone=!1;this.sqsVisited=[]};b.prototype.isDone=function(){var b=this.getCountNeeded();return 0<b?this.countMet>=b:0<this.countMet};b.prototype.isMet=function(b,d){switch(this.command){default:return!1;case "piece":return this.checkPiece(b);case "move":return this.checkMove(b);case "firstmove":return this.checkFirstMove(b);case "journey":return this.checkJourney(b);case "mate":return this.checkForMate(b);case "stalemate":return this.checkForStaleMate(b);case "threefold":return this.checkForThreefold(b);
case "check":return this.checkForCheck(b);case "notcheck":return this.checkForNotCheck(b);case "result":return this.checkForResult(b);case "countmoves":return this.checkCountMoves(b)}};b.prototype.isMateGoal=function(){return"mate"==this.command};b.prototype.isCheckGoal=function(){return"check"==this.command};b.prototype.isResultGoal=function(){return"result"==this.command||"mate"==this.command||"stalemate"==this.command};b.prototype.isClickGoal=function(){return"click"==this.command};b.prototype.checkClick=
function(b){var d,c=this.params[0].match(/[a-h?][1-8?](,[a-h?][1-8?])*/);if(c&&c.length)for(var c=c[0].split(","),e=0;e<c.length;e++){var f=c[e];if(f.match(/\?/)){var t=-1,v=-1;"?"!=f.charAt(0)&&(t=CB.Square.colFromString(f.substr(0,1)));"?"!=f.charAt(1)&&(v=CB.Square.rowFromString(f.substr(1,1)));if(!(-1!=t&&CB.Square.getFile(b)!=t||-1!=v&&CB.Square.getRank(b)!=v||-1!=this.sqsVisited.indexOf(CB.Square.toString(b)))){this.sqsVisited.push(CB.Square.toString(b));d=this.sqsVisited.length<c.length?this.sqsVisited.length.toString()+
"/"+c.length.toString():!0;break}}else if(CB.Square.fromString(f)==b&&-1==this.sqsVisited.indexOf(f)){this.sqsVisited.push(f);d=this.sqsVisited.length<c.length?this.sqsVisited.length.toString()+"/"+c.length.toString():!0;break}}return d};b.prototype.isEvalGoal=function(){return"eval"==this.command};b.prototype.isSuccessGoal=function(){return this.control.match(/success/i)||this.control.match(/count/i)};b.prototype.getCountNeeded=function(){var b=this.control.match(/count=([0-9])+/i);return b&&b.length?
parseInt(b[1]):-1};b.prototype.getIcon=function(){var b=this.control.match(/-([a-z0-9]+)/i);if(b&&1<b.length)return CB.getCommonPath()+"Media/Emojis/"+b[1]+".png"};b.prototype.isStopAfterGoal=function(){if(this.control.match(/go/i))return!1;if(this.control.match(/stop/i)||this.control.match(/success/i))return!0;var b=this.getCountNeeded();if(0<b)return this.countMet>=b};b.prototype.checkPiece=function(b){if(this.params){var d=this.params[0];if(d.match(/[wb][KQBRNP?]/g)){var c=" KQNBRP?".split("").indexOf(this.params[0].charAt(1));
if(1<=c){"b"==d.charAt(0)&&(c|=CB.Piece.SIDE_MASK);var e=d.match(/[a-h?][1-8?]/g);if(e&&1==e.length&&"b?"!=e[0]){var f=d.substr(2,2),e=CB.Square.fromString(f);if(f.match(/\?/))for(d=e=-1,"?"!=f.charAt(0)&&(e=CB.Square.colFromString(f.substr(0,1))),"?"!=f.charAt(1)&&(d=CB.Square.rowFromString(f.substr(1,1))),f=0;64>f;f++){if(-1==e||CB.Square.getFile(f)==e)if(-1==d||CB.Square.getRank(f)==d){var t=b.getCurPos().board[f];if(t==c||this.isJokerPieceOk(c,t))return!0}}else return b.getCurPos().board[e]==
c}else if(e=d.match(/(x|!x)([KQNBRP])/))if(d=CB.Piece.fromString(e[2].charAt(0)),b=b.getLastMove(),"x"==e[1]&&(b.vct&CB.Piece.PIECE_MASK)==d&&(b.mvd==c||this.isJokerPieceOk(c,b.mvd))||"!x"==e[1]&&(b.vct&CB.Piece.PIECE_MASK)!=d&&(b.mvd==c||this.isJokerPieceOk(c,b.mvd)))return!0}}}};b.prototype.isJokerPieceOk=function(b,d){return(b&CB.Piece.PIECE_MASK)==CB.Piece.JOKER&&(d&CB.Piece.SIDE_MASK)==(b&CB.Piece.SIDE_MASK)};b.prototype.checkJourney=function(b){var d,c=this.params[0];if(c.match(/[wb][KQBRNP]/g)){var e=
" KQNBRP".split("").indexOf(this.params[0].charAt(1));if(1<=e){"b"==c.charAt(0)&&(e|=CB.Piece.SIDE_MASK);var f=b.getLastMove();if(f&&b.getCurPos().board[f.to]!=e)return;if((c=c.match(/[a-h?][1-8?](,[a-h?][1-8?])*/))&&c.length)for(c=c[0].split(","),f=0;f<c.length;f++){var t=c[f];if(t.match(/\?/)){var v=-1,y=-1;"?"!=t.charAt(0)&&(v=CB.Square.colFromString(t.substr(0,1)));"?"!=t.charAt(1)&&(y=CB.Square.rowFromString(t.substr(1,1)));for(t=0;64>t;t++)if(!(-1!=v&&CB.Square.getFile(t)!=v||-1!=y&&CB.Square.getRank(t)!=
y||b.getCurPos().board[t]!=e||-1!=this.sqsVisited.indexOf(CB.Square.toString(t))))return this.sqsVisited.push(CB.Square.toString(t)),d=this.sqsVisited.length<c.length?this.sqsVisited.length.toString()+"/"+c.length.toString():!0}else if(v=CB.Square.fromString(t),b.getCurPos().board[v]==e&&-1==this.sqsVisited.indexOf(t)){this.sqsVisited.push(t);d=this.sqsVisited.length<c.length?this.sqsVisited.length.toString()+"/"+c.length.toString():!0;break}}}}return d};b.prototype.checkFirstMove=function(b){return 1==
b.getMainLine().length&&this.checkMove(b)};b.prototype.checkMove=function(b){if(this.params){var d=this.params[0];if(d.match(/[wb][KQBRNP]/g)){var c=" KQNBRP".split("").indexOf(this.params[0].charAt(1));if(1<=c&&("b"==d.charAt(0)&&(c|=CB.Piece.SIDE_MASK),(d=d.match(/([a-h][1-8])[-]?([a-h][1-8])/))&&3==d.length)){var e=b.getPreviousMove();if(e&&e.from==CB.Square.fromString(d[1])&&e.to==CB.Square.fromString(d[2])&&b.getCurPos().board[e.to]==c)return!0}}}};b.prototype.checkForMate=function(b){var d=
this.params[0];if(d.match(/[wb]/)&&b.getCurPos().isMate()&&("w"==d.charAt(0)&&!b.getCurPos().getBTM()||"b"==d.charAt(0)&&b.getCurPos().getBTM()))return!0};b.prototype.checkForStaleMate=function(b){var d=this.params[0];if(d.match(/[wb]/)&&b.getCurPos().isStaleMate()&&("w"==d.charAt(0)&&!b.getCurPos().getBTM()||"b"==d.charAt(0)&&b.getCurPos().getBTM()))return!0};b.prototype.checkForThreefold=function(b){return(new CB.DrawChecker).checkGame(b)==CB.DrawType.THREE_TIMES};b.prototype.checkForCheck=function(b){if(b.getCurPos().isCheck())return!0};
b.prototype.checkForNotCheck=function(b){if(!b.getCurPos().isCheck())return!0};b.prototype.checkForResult=function(b){switch(this.params[0]){case "1":case "draw":if(CB.GameKernel.staticCheckTechnicalResult(b,{})==CB.GameResultEnum.DRAW)return!0}return!1};b.prototype.checkCountMoves=function(b){var d=parseInt(this.params[0]);if(d)return b.getMainLine().length>=2*d};b.prototype.checkForEval=function(b){if(null!=b)switch(this.params[0]){case "draw":case "equal":case "1":return 60>Math.abs(b);case "whitewins":case "win":case "2":return 200<
b;case "blackwins":case "loss":case "0":return-200>b;case "blackbetter":return-70>b;case "whitebetter":return 70<b;case "equalorwhitebetter":return-50<b;case "equalorblackbetter":return 50>b;case "whitemates":return 1E5<b;case "blackmates":return-1E5>b;case "whitenotmate":return-1E5<b;case "blacknotmate":return 1E5>b}};b.splitParams=function(b){var d=[],c=b.match(/\[([\S]+)\]/);c&&0<c.length?(d.push(b.substr(0,c.index)+c[0]),b=b.substr(c.index+c[0].length),b.split(",").forEach(function(b){b&&d.push(b)})):
d=b.split(",");return d};return b}();b.prototype.parseGoals=function(b){this.goals=[];(b=b.goals)&&b.split(";").forEach(function(b){var d=b.split(":");b=new CB.Goal;b.command=d[0].trim();1<d.length&&(d=d[1].split("/"),d.length&&(b.params=CB.Goal.splitParams(d[0]),1<d.length&&(b.control=d[1]),2<d.length&&(b.msg=d[2]),3<d.length&&(b.reply=d[3])));this.goals.push(b)}.bind(this))};b.prototype.hasResultGoal=function(){var b=!1;this.goals&&this.goals.forEach(function(d){d.isResultGoal()&&(b=!0)});return b};
b.prototype.hasClickGoal=function(){var b=!1;this.goals&&this.goals.forEach(function(d){d.isClickGoal()&&(b=!0)});return b};b.prototype.checkGoals=function(){var b=null;if(this.goals)for(var d=0;d<this.goals.length;d++){var b=this.goals[d],c=b.isMet(this.kernel.game),b=this.onGoalMetResult(b,c);if(null!=b)break}return b};b.prototype.onGoalMetResult=function(b,d){var c=CB.getCommonPath()+"Media/Ribbons/Reader/Check24.png",e=null;if(!b.isDone()&&d){if(!b.feedBackDone)if("string"==typeof d)this.showGoalMsg(d,
1600,c),b.sqsVisited&&(b.isClickGoal()?this.addVisitedSquareMarks(b.sqsVisited):this.removeVisitedSquareMarks(b.sqsVisited));else{b.countMet++;var e=b.getCountNeeded(),q=b.msg||"Excellent, you reached your goal!";if(0>=e||b.countMet>=e){if(this.showGoalMsg(q,4500,b.getIcon()),b.feedBackDone=!0,b.isSuccessGoal())this.onGoalReached()}else this.showGoalMsg(b.countMet.toString()+"/"+e.toString()+"...",1500,c);b.sqsVisited&&b.isClickGoal()&&this.addVisitedSquareMarks(b.sqsVisited);if(this.isStopAfterGoal=
b.isStopAfterGoal())this.kernel.boardWin.allowInput=!1}e=b}return e};b.prototype.showGoalMsg=function(b,d,c){b=this.replaceVariables(b);var e=b.split("$"),q;1<e.length&&(b=e[0],q=e[1]);this.clearBoardMsgTimer.stop();e=-1;q&&(e=q.match(/([wb][KQBRNP])/g),null!=e?(q="w"==e[0][0]?0:1,e=this.kernel.getCurPos().getPiecePos(CB.Piece.fromString(e[0][1]),q)):e=CB.Square.fromString(q));this.boardWin.addBubble(b,e,320,c);d&&this.clearBoardMsgTimer.runOnce(d)};b.prototype.replaceVariables=function(b){return b.replace("{NMoves}",
Math.floor(this.kernel.game.getMoveNo()/2+1).toString())};b.prototype.onGoalReached=function(){this.stampCheckOk();if(window.playchessUser&&!this.postedSuccess){var b=this.id+"-"+this.kernel.game.getMoveNo();V15.resultPostBack.postSolved(window.playchessUser,b,1)}this.postedSuccess||CB.SendEvent("Goal",this.id);this.postedSuccess=!0};b.prototype.stampCheckOk=function(){this.animTimer.runOnce(300,function(){if(V15.chessAudio)V15.chessAudio.onWellDone();this.boardWin.destroySideIcon();this.addCheckMark()}.bind(this))};
b.prototype.addCheckMark=function(){this.boardWin.addSideIcon({url:CB.getCommonPath()+"Media/Ribbons/Reader/Check48.png",cssClass:"cbBoardCheckMark",boardFract:12})};b.prototype.addLevelMark=function(b){this.boardWin.addSideIcon({url:CB.getCommonPath()+"Media/Ribbons/Reader/LevelHard64.png",cssClass:"cbBoardCheckMark",boardFract:12})};b.prototype.clearBoardMsg=function(){this.boardWin.destroyMessage()};b.prototype.showDiagramHelp=function(b){this.kernel.boardWin&&(0<this.kernel.game.getMainLine().length||
!b||this.hintCnt?(this.kernel.boardWin.clearAll(),this.markHint()):b&&(b=CB.DiagramAnimationController.parseDiagramHelp(b),this.boardWin&&this.boardWin.addBubble(b.text,b.sq,400,b.icon),b.attrs&&this.boardWin&&this.boardWin.addAttributes(b.attrs),this.hintCnt++),this.launchClearHints())};b.prototype.showChoiceFeedback=function(b){b=CB.DiagramAnimationController.parseChoiceFeedback(b);this.boardWin&&this.boardWin.addAttributes(b);this.launchClearHints()};b.prototype.launchClearHints=function(){this.clearHintsTimer&&
this.clearHintsTimer.stop();this.clearHintsTimer=new CB.Timer(function(){this.kernel.boardWin.clearAll()}.bind(this));this.clearHintsTimer.runOnce(4E3)};b.prototype.onHintMove=function(b){var d=CB.Hints.gen(this.kernel.game,b);if(this.hintCnt<d.length){if(d.length){for(var c=[],e=[],q=this.hintCnt;q<d.length&&q<this.hintCnt+1;q++)switch(d[q]){case CB.HintTypes.FROM:this.kernel.markSquare(b.from,"hsla( 120, 70%, 60%, 0.8 )");e.push(new CB.BoardColouredSquare(b.from,"hsla( 120, 70%, 60%, 0.8 )",!0));
break;case CB.HintTypes.TO:e.push(new CB.BoardColouredSquare(b.to,"hsla( 120, 70%, 60%, 0.8 )",!0));break;case CB.HintTypes.PIECE:this.kernel.game.getCurPos().findSquaresOfPiece(this.kernel.game.getCurPos().board[b.from]).forEach(function(b){this.kernel.markSquare(b,"hsla( 130, 50%, 40%, 0.3 )")}.bind(this));break;case CB.HintTypes.CAPTURE:c.push("Capture something!");break;case CB.HintTypes.CHECK:c.push("Give a check!")}c.length&&(b=c.join(", "),this.boardWin.addBubble(b,-1,320,CB.getCommonPath()+
"Media/Emojis/lightbulb.png"));e.length&&this.boardWin.addAttributes(e)}this.hintCnt++}else this.boardWin.drawArrow(b.from,b.to,"hsla( 120, 70%, 60%, 0.8 )",9,!1,[4,6]),this.hintCnt=0};b.prototype.parseVisualizations=function(b){this.visuals=[];b=b.visuals;var d;b&&b.split(";").forEach(function(b){b=b.split(":");var c={command:b[0]};1<b.length&&(c.params=b[1]);this.visuals.push(c);"threat"==c.command&&(d=!0)}.bind(this));d&&this.initThreatEngine()};b.prototype.markVisualizations=function(){if(this.visuals&&
this.kernel.game.getPreviousMove()){var b=[];this.visuals.forEach(function(d){switch(d.command){case "check":this.kernel.getCurPos().isCheck()&&this.visualizeCheck(b,"hsla( 240, 70%, 60%, 0.7 )");break;case "mate":this.kernel.getCurPos().isMate()&&this.visualizeMate(b,"hsla( 240, 70%, 60%, 0.7 )");break;case "opposition":this.markOpposition(b);break;case "pawnsquare":this.markPawnSquare(b);break;case "threat":this.markThreat()}}.bind(this));if(b.length&&this.kernel.game){var d=this.kernel.game.getMoveBaggage()||
{};d.attributes=b;this.kernel.game.setMoveBaggage(d)}}};b.prototype.visualizeCheck=function(b,d){if(this.kernel.game.getPreviousMove()){var c=this.kernel.getCurPos(),e=c.getKingsPos(c.getSideToMove());c.getAttacksTo(e,CB.Side.other(c.getSideToMove())).forEach(function(c){b.push(new CB.BoardArrow(c,e,d,8,[2,7]))})}};b.prototype.visualizeMate=function(b){var d=this.kernel.game.getPreviousMove();if(d){var c=this.kernel.getCurPos().getKingsPos(this.kernel.getCurPos().getSideToMove());b.push(new CB.BoardColouredSquare(c,
"black"));d=this.kernel.game.getPreviousMove();b.push(new CB.BoardArrow(d.to,c,"hsla( 0, 75%, 50%, 0.8 )",8,[2,7]))}};b.prototype.markOpposition=function(b){if(CB.ChessKnowledge.isEndgame(this.kernel.getCurPos())){var d=this.kernel.game.getPreviousMove();if(d&&(d.mvd&CB.Piece.PIECE_MASK)==CB.Piece.KING){var c=this.kernel.getCurPos().getKingsPos(this.kernel.getCurPos().getSideToMove()),e=this.kernel.getCurPos().getKingsPos(CB.Side.other(this.kernel.getCurPos().getSideToMove()));if(c=CB.ChessKnowledge.getOpposition(c,
e))c.forEach(function(d){0==this.kernel.getCurPos().board[d]&&b.push(new CB.BoardColouredSquare(d,"hsla( 10, 85%, 60%, 0.8 )"))}.bind(this)),b.push(new CB.BoardColouredSquare(d.to,CB.DiagramAnimationController.translateSquareColor("green",d.to)))}}};b.prototype.markPawnSquare=function(){};b.prototype.markThreat=function(){if(!this.isStopAfterGoal){var b=ObjUtil.clone(this.kernel.getCurPos());b.isCheck()||(b.sd=CB.Side.other(b.sd),this.threatEngine&&(this.threatEngine.sendNewPos(b),this.threatEngine.search(300)))}};
b.prototype.initThreatEngine=function(){var b=this;this.threatEngine=new CB.EngineWrapper(2,this.engUrl,null,{onEnginePV:function(b,d){},onEngineMove:function(d,c){var e=new CB.Move;e.fromJSON(c.move);b.onThreatMove(e)}});this.threatEngine.load()};b.prototype.markHint=function(){if(this.hintMove)this.onHintMove(this.hintMove);else this.hintEngine||this.initHintEngine(),this.hintEngine.sendNewPos(this.kernel.getCurPos()),this.hintEngine.search(500)};b.prototype.initHintEngine=function(){var b=this;
this.hintEngine=new CB.EngineWrapper(2,this.engUrl,null,{onEnginePV:function(b,d){},onEngineMove:function(d,c){var e=new CB.Move;e.fromJSON(c.move);b.onHintMove(e)}});this.hintEngine.load()};b.prototype.onThreatMove=function(b){this.boardWin.drawArrow(b.from,b.to,"hsla( 0, 80%, 50%, 0.75 )",9,!0,[5,5])};b.prototype.addVisitedSquareMarks=function(b){b.forEach(function(b){b=CB.Square.fromString(b);b=new CB.BoardColouredSquare(b,CB.DiagramAnimationController.translateSquareColor("blue",b),!0);this.boardWin.permanentAttributes.push(b)}.bind(this));
this.boardWin.renderQueuedAttributes(!0)};b.prototype.removeVisitedSquareMarks=function(b){b.forEach(function(b){b=CB.Square.fromString(b);for(var d=0;d<this.boardWin.permanentAttributes.length;d++)this.boardWin.permanentAttributes[d].sq==b&&(this.boardWin.permanentAttributes.splice(d,1),d--)}.bind(this));this.boardWin.renderQueuedAttributes(!0)};b.prototype.checkResultGoal=function(){this.goals&&this.goals.forEach(function(b){if(b.isResultGoal()&&b.isMet(this.kernel.game))this.onGoalMet(b)}.bind(this))};
b.prototype.checkEvalGoal=function(){this.goals&&null!=this.eval&&this.goals.forEach(function(b){!b.isDone()&&b.isEvalGoal()&&b.checkForEval(this.eval)&&(b.countMet++,this.onGoalMet(b))}.bind(this))};b.prototype.onGoalMet=function(b){b.msg&&this.showGoalMsg(b.msg,0,b.getIcon());this.isStopAfterGoal=b.isStopAfterGoal();if(b.isSuccessGoal())this.onGoalReached()};b.prototype.parsePieceSquareTables=function(b){var d=[];(b=b.pst)&&b.split(";").forEach(function(b){b=b.split(":");if(1<b.length){var c=b[0].match(/([wb][KQBRNP])/g);
if(c&&1==c.length){var e={piece:c[0]},f=[];b[1].split(",").forEach(function(b){var d=b.match(/([a-h][1-8])=(-*[\d]+)/);if(d&&3==d.length)f.push({sq:CB.Square.fromString(d[1]),val:parseInt(d[2])});else if(b.match(/ahead/i))for(b="b"==e.piece.charAt(0),d=0;64>d;d++){var c=d&7;f.push({sq:d,val:b?100*(49-c*c):100*c*c})}});e.vals=f;d.push(e)}}});this.pieceSquareTables=d};b.prototype.onGameNavigate=function(){this.superClass.onGameNavigate.call(this);this.kernel.game.setResult(CB.GameResultEnum.UNDEFINED_RESULT);
this.goals&&this.goals.forEach(function(b){b.reset()});this.engineSide=null;this.isStopAfterGoal=!1;this.kernel.boardWin.allowInput=!0;this.options.idDOMEngOut&&$("#"+this.options.idDOMEngOut).text("")};b.prototype.resetGame=function(b){V15.hasUrlGame()?this.kernel.fnInitGame(b):b.reset()};b.prototype.newGame=function(b){this.superClass.newGame.call(this);var d=this.kernel.game;d.gotoLast();this.engineAnswers=!0;d.isNormalInit()&&0==d.getMainLine().length?this.engineSide=CB.Side.other(this.kernel.boardWin.getSideToShow()):
d.isNormalInit()||0!=d.getMainLine().length?this.engineSide=null:(this.engineSide=CB.Side.other(d.getCurPos().getSideToMove()),this.kernel.getCurPos().isMate()||this.kernel.getCurPos().isStaleMate()||this.kernel.boardWin.setBlackIsBottom(this.engineSide==CB.Side.WHITE));if(!CB.System.runsInIFrame()&&b)V15.chessAudio.onNewGame();null!=this.engineSide&&d.getCurPos().getSideToMove()!=this.engineSide&&V15.analysisEngine&&V15.analysisEngine.engineGo(this.kernel);this.boardWin.redraw()};b.prototype.setHeaderData=
function(){var b=this.kernel.game.getHeader(),d=this.getUserName();this.engineSide==CB.Side.WHITE?(b.setWhite(this.options.engineName),b.setBlack(d)):(b.setWhite(d),b.setBlack(this.options.engineName))};b.prototype.getUserName=function(){var b=V15.Vf.userName;V15.isLoggedIn()&&b||(b=lm.GUEST);return b};b.prototype.levelToGameHeader=function(){this.kernel.game.hdr.event.event=this.getLevelStr();this.kernel.game.fireOnHeaderChanged()};b.prototype.getLevelStr=function(){return"Mini Play"};b.prototype.getAllowedColor=
function(){return CB.AllowedColor.detFromOpponentSide(this.engineSide)};b.prototype.getMySide=function(){return null==this.engineSide?null:CB.Side.other(this.engineSide)};b.prototype.isAnalysis=function(){return!1};b.prototype.setAnalysis=function(b){throw Error("Cannot set analysis on playing mode");};b.prototype.setTimeControl=function(b){};b.WAIT_FOR_BEST_TIMEOUT=300;b.prototype.engineMoveNow=function(){};b.prototype.onEnteredMove=function(b){this.saved=!1;this.clickHintTimer.stop();try{V15.analysisEngine&&
V15.analysisEngine.engineStop(),this.ponderHint=null,this.kernel.game.deleteRemaining(!0),null===this.engineSide&&(this.engineSide=CB.Side.other(this.kernel.getCurPos().getSideToMove()),this.setHeaderData()),this.kernel.boardWin.setBlackIsBottom(this.engineSide!==CB.Side.BLACK),this.superClass.onEnteredMove.call(this,b),this.kernel.game.hdr.setResult(CB.GameResultEnum.LINE)!=CB.GameResultEnum.LINE&&this.kernel.game.fireOnHeaderChanged()}catch(d){CB.LogException("AgEng::onEntrd",d)}return!0};b.prototype.startSearch=
function(){this.kernel.getCurPos().isLegal()&&(null===this.engineSide&&(this.engineSide=this.kernel.getCurPos().getSideToMove()),this.kernel.getCurPos().getSideToMove()!=this.engineSide||this.isStopAfterGoal||(this.engineStartTick=new CB.Tick,this.engineGo(0)))};b.prototype.engineGo=function(b){this.shouldShowBusyCursor()&&this.kernel.boardWin.setBusy(!0);this.ponderHint=null;this.engine[b].sendNewGame(this.kernel.game,this.pieceSquareTables);this.engine[b].search(this.thinkTime,this.plyDepth)};b.prototype.parseThinkTime=
function(b){this.thinkTime=1E3;var d=b.match(/(\d+)ply/);d?this.plyDepth=d[1]:b.match(/\d+/)&&(this.thinkTime=parseInt(b))};b.prototype.checkLiveBook=function(){};b.prototype.shouldShowBusyCursor=function(){return!1};b.prototype.onGameMove=function(){this.clearBoardAlways&&(this.kernel.boardWin.clearBoardAttributes(),this.kernel.boardWin.clearBaggageAttributes(),V15.panelMgr.currPluginIsAnimatedDiagram()&&this.kernel.boardWin.clearPermanentAttributes());V15.panelMgr.onUserMove(this.nPlugin);this.execEngineMoveTimer.stop();
this.superClass.onGameMove.call(this);if(this.kernel.getCurPos().isLegal()&&this.engineAnswers){if(this.clock){CBDebug.assert(this.clock,"CLOCK NOT SET");this.clock.stop();var b=this.clock.createTimeAnno();this.kernel.addTimeAnno(b)}var d=this.checkGoals();this.markVisualizations();if(this.kernel.game.getCurPos().hasLegals())if(b=0,d&&d.reply&&null!=(b=d.reply.match(/([a-h][1-8])([a-h][1-8])([QBRN]*)/))){var d=CB.Square.fromString(b[1]),b=CB.Square.fromString(b[2]),c=new CB.Move(d,b);(new CB.Timer(function(){this.execEngineMoveTimer.runOnce(1E3,
function(){this.kernel.game.getCurPos().isLegalMove(c)?this.kernel.execEngineMove(c):alert("Forced Reply illegal")}.bind(this))}.bind(this))).runOnce(10)}else this.startSearch()}};b.prototype.onResetGame=function(){};var d=new CB.Vr;b.prototype.updateGamePos=function(){this.hintCnt=0;this.execEngineMoveTimer.stop();d.exec(function(){}.bind(this),200)};b.prototype.onTechnicalGameEnd=function(b,d){if(b!=CB.GameResultEnum.DRAW||!d||d.drawType!=CB.DrawType.MATERIAL||this.kernel.getCurPos().isStaleMate()){var c=
CB.GameResultEnum.toString(b);this.hasResultGoal()?this.checkResultGoal():(this.kernel.getCurPos().isMate()?c+=" ("+lm.MATE+")":this.kernel.getCurPos().isStaleMate()&&(c+=" ("+lm.STALEMATE+"!)"),this.boardWin&&(this.boardWin.addBubble(c,-1,250),this.clearBoardMsgTimer.stop()))}};b.prototype.onResign=function(){var b=String.formatEx(lm.RESIGNS,"Fritz");V15.panelMgr.showBoardMessage(b,7E3);var d=this.engineSide==CB.Side.BLACK?CB.GameResultEnum.WHITE_WINS:CB.GameResultEnum.BLACK_WINS;this.kernel.addTextAnno(b);
this.kernel.setResult(d)};b.prototype.onLosingLine=function(b,d){var c=d.getEval()-b.getEval();300<c&&this.kernel.addSymbol(CB.AnnoMarkType.VERY_BAD);200<c&&this.kernel.addSymbol(CB.AnnoMarkType.BAD);100<c&&this.kernel.addSymbol(CB.AnnoMarkType.DUBIOUS)};b.prototype.userResigns=function(){if(!CB.GameResultEnum.isFinished(this.kernel.game.getResult())){var b=this.engineSide==CB.Side.WHITE?CB.GameResultEnum.WHITE_WINS:CB.GameResultEnum.BLACK_WINS;this.kernel.addTextAnno(String.formatEx(lm.RESIGNS,this.getUserName()));
this.kernel.setResult(b)}};b.prototype.onAnalysisLine=function(b,d,c){};var e=new CB.HSLColor(100,60,45,.7);b.prototype.getMarkedSquaresOnButtonDown=function(b,d){return this.kernel.getCurPos().getSideToMove()==this.engineSide?[]:d&&!this.clickHintTimer.isActive()?this.getTargetSquareHints(b):this.genLegalSquareHints(b)};b.prototype.genLegalSquareHints=function(b){var d=[];this.kernel.game.getCurPos().V7().forEach(function(c){c.from==b&&d.push({sq:c.to,clr:e})});return d};b.prototype.startClickHintTimer=
function(b){this.clickHintTimer.runOnce(600,function(){var d=this.getTargetSquareHints(b);this.kernel.boardWin.markSquares(d)}.bind(this))};b.prototype.getTargetSquareHints=function(b){if(this.kernel.getCurPos().getSideToMove()==this.engineSide)return[];var d=[];this.lbInfo&&this.lbInfo.moves.forEach(function(c){c.move.from==b&&70<c.getNGames()&&d.push({sq:c.move.to,clr:new CB.HSLColor(CB.HSLColor.BLUE,80,60,.8)})}.bind(this));V15.analysisEngine&&V15.analysisEngine.getHintSquaresOnButtonDown(b).forEach(function(b){for(var c=
!1,e=0;!c&&e<d.length;e++)d[e].sq==b.sq&&(c=!0);c||d.push(b)});return d};return b}();
CB.SimpleEngineModeMixin=function(){return{toggleEngine:function(){if(this.isEngineLoaded(0))return this.unloadEngine(0),!1;this.loadEngine(0);this.updateGamePos();return!0},incNMultiVars:function(c){this.nMultiVars+=c;1>this.nMultiVars&&(this.nMultiVars=1);64<this.nMultiVars&&(this.nMultiVars=64)},goAll:function(){this.isInThreat=!1;this.engines.forEach(function(c){c.setMultiPV(this.nMultiVars);c&&(c.go(this.kernel.game,{infinite:!0}),c.fireOnThreat(!1))}.bind(this))},toggleThreat:function(){if(this.isInThreat)this.goAll();
else{var c=ObjUtil.clone(this.kernel.game.cur);if(c.swapSide()){this.isInThreat=!0;var b=new CB.Game(c);this.engines.forEach(function(d){d.setMultiPV(this.nMultiVars);d&&(d.go(b,{infinite:!0}),d.fireOnThreat(!0))}.bind(this))}}},toggleAnalysisThreat:function(){if(V15.analysisEngine)if(this.isInThreat)V15.analysisEngine.engineGo(this.kernel),V15.analysisEngine.engine.fireOnThreat(!1);else{var c=ObjUtil.clone(this.kernel.game.cur);c.swapSide()&&(this.isInThreat=!0,c=new CB.Game(c),V15.analysisEngine.engine.setMultiPV(1),
V15.analysisEngine.engine.go(c,{infinite:!0}),V15.analysisEngine.engine.fireOnThreat(!0))}}}}();"use strict";
CB.AnalysisMode=function(){var c=function e(b,c,h){e.superClass.call(this,b,CB.AnalysisMode.POOL_SIZE);this.kernel=b;this.maxEngine=c||1;this.currEngine=0;this.active=!0;this.liveBookTimer=new CB.Timer(this.liveBookTimeout.bind(this));this.posInfoTimer=new CB.Timer(this.posInfoTimerHdl.bind(this));"undefined"!=typeof V15&&!V15.analysisEngine&&CB.System.isDesktop()&&V15.config.useAnalysisEngines&&CB.AnalysisEngine&&CB.System.browserIsSafeForEngine()&&(V15.analysisEngine=new CB.AnalysisEngine);this.nMultiVars=
1;this.clickHintTimeout=h?h.hintTimeout||500:500;this.fnCheckLiveBook=h&&h.liveBookSilent?this.checkLiveBook.bind(this):this.checkLiveBookWithPanel.bind(this);this.nBookTimeouts=0};CB.inherit(c,CB.EngineHostMode);CB.SimpleEngineModeMixin&&CB.mixin(c,CB.SimpleEngineModeMixin);c.POOL_SIZE=0;c.prototype.destroy=function(){V15.analysisEngine&&V15.analysisEngine.unlinkPlayingMode(this);this.superClass.destroy.call(this);V15.commands.fireChecked(CB.CommandIds.TOGGLE_ANALYSIS_ENGINE,!1)};c.prototype.onPanelsReady=
function(){for(var b=0;b<this.maxEngine;b++)this.loadEngine(b);V15.commands.fireChecked(CB.CommandIds.TOGGLE_ANALYSIS_ENGINE,!0);this.panEng&&(this.idOnEngMove=this.panEng.addOnMoveEnteredListener(this.kernel.reactToEnteredMove.bind(this.kernel)))};c.prototype.createGUIElements=function(b){this.superClass.createGUIElements.call(this,b);b.shouldAnimatePosChange=this.shouldAnimatePosChange.bind(this);CB.System.isMobile()&&(b.animSteps={forMove:.3,forPosition:.2});V15.analysisEngine&&V15.analysisEngine.linkPlayingMode(this)};
c.prototype.onResetGame=function(){this.nBookTimeouts=0};c.prototype.onEnteredMove=function(b){return this.fnAcceptMove?this.fnAcceptMove(b):!0};c.prototype.onExit=function(){this.superClass.onExit.call(this);V15.analysisEngine&&(V15.analysisEngine.engineStop(),V15.analysisEngine.clearLines())};c.prototype.onAfterMoveEntry=function(b){if(this.fnAfterMove)return this.fnAfterMove(b)};c.prototype.setEngineOff=function(){this.active=!1;this.superClass.setEngineOff.call(this)};c.prototype.isAnalysis=function(){return!0};
c.prototype.setAnalysis=function(b){clearTimeout(this.timer);this.active=b;V15.commands.fireChecked(CB.CommandIds.TOGGLE_ANALYSIS_ENGINE,b);for(var c=0;c<this.nEngines;++c)b||void 0===this.engines[c]||this.engines[c].abort();b&&this.updateGamePos()};c.prototype.setTimeControl=function(b){throw Error("Cannot set search time on analysis playing mode");};c.prototype.toggleAnalysis=function(){this.setAnalysis(!0);for(var b=0;b<this.maxEngines;++b)this.loadEngine(b);this.updateGamePos()};c.prototype.pendingMoveNow=
!1;c.prototype.engineMoveNow=function(){};c.ENGINE_DELAY=100;var b=new CB.Vr;c.prototype.gateUpdate=new CB.Vr;c.prototype.updateGamePos=function(){this.kernel==V15.panelMgr.getKernel()&&(this.stopAll(),V15.analysisEngine&&(V15.analysisEngine.engineStop(),V15.analysisEngine.clearLines()),this.isAutoplay||(b.exec(function(){this.active&&this.kernel.game.getCurPos().hasLegals()&&this.goAll()}.bind(this),c.ENGINE_DELAY),this.gateUpdate.exec(function(){this.fnCheckLiveBook();V15.analysisEngine&&V15.analysisEngine.engineGo(this.kernel)}.bind(this),
400)))};c.prototype.checkLiveBookWithPanel=function(){V15.aTBLobby&&V15.aTBLobby.isLoggedIn()&&(CB.LOG("AlMode checkLivePan: "+this.kernel.game.hdr.toString()+" marker="+this.kernel.forceUpdateMarker,"LogGreen","anal"),this.updatePos&&this.updatePos.equals(this.kernel.game.getCurPos())&&!this.kernel.forceTBUpdate||(this.updatePos=ObjUtil.clone(this.kernel.game.getCurPos()),V15.panelMgr.tbBook&&(V15.panelMgr.tbBook.clear("Requesting moves..."),V15.panelMgr.tbBook.isVisible()&&V15.aTBLobby.requestAllMoves(this.kernel.game.getCurPos(),
!1,!1,this.kernel.ticket),this.idLBListener||(this.idLBListener=V15.aTBLobby.addOnLiveBookListener(this.liveBookListener.bind(this))),this.idTBListener||(this.idTBListener=V15.aTBLobby.addOnTBDataListener(this.tbDataListener.bind(this))),this.liveBookTimer.runOnce(5E3),V15.aTBLobby.requestPosInfo(this.kernel.game.getCurPos()),this.posInfoTimer.isActive||this.posInfoTimer.runOnce(15E3)),this.kernel.forceTBUpdate=!1))};c.prototype.checkLiveBook=function(){this.shouldAccessLiveBook()?(CB.LOG("AlMode CheckLive: "+
this.kernel.game.hdr.toString()+" marker="+this.kernel.forceUpdateMarker,"LogGreen","anal"),this.updatePos&&this.updatePos.equals(this.kernel.game.getCurPos())&&!this.kernel.forceTBUpdate||(this.updatePos=ObjUtil.clone(this.kernel.game.getCurPos()),V15.aTBLobby.requestAllMoves(this.kernel.game.getCurPos(),!1,!1,this.kernel.ticket),this.idLBListener||(this.idLBListener=V15.aTBLobby.addOnLiveBookListener(this.liveBookListener.bind(this))),this.idTBListener||(this.idTBListener=V15.aTBLobby.addOnTBDataListener(this.tbDataListener.bind(this))),
this.liveBookTimer.runOnce(5E3),this.kernel.forceTBUpdate=!1)):V15.aTBLobby.fireOnLiveBookDisplay({ticket:this.kernel.ticket,moves:[]})};c.prototype.shouldAccessLiveBook=function(){var b=this.kernel.getCurPos();return 6<b.getPieces().length&&16>b.getPieces().length?!1:V15.aTBLobby&&V15.aTBLobby.isLoggedIn()&&(6>this.nBookTimeouts||10>this.kernel.game.getMoveNo())&&(60>this.kernel.game.getMoveNo()||6>=b.getPieces().length||2550<this.kernel.game.hdr.getMaxElo())};c.prototype.liveBookListener=function(b){V15.aTBLobby.fireOnLiveBookDisplay(b);
this.liveBookTimer.stop();this.nBookTimeouts=0};c.prototype.tbDataListener=function(){};c.prototype.liveBookTimeout=function(){V15.panelMgr.tbBook&&V15.panelMgr.tbBook.setEmptyText(lm.FRESH_POSITION);this.nBookTimeouts++};c.prototype.posInfoTimerHdl=function(){V15.aTBLobby&&V15.aTBLobby.hasIdReceived&&V15.panelMgr.tbBook&&V15.aTBLobby.requestPosInfo(this.kernel.game.getCurPos())};c.prototype._engAnalysisTimeoutHdl=function(){this.active&&this.kernel.game.getCurPos().hasLegals()&&this.goAll()};c.prototype.getMoveEnterType=
function(){return this.fnGetMoveEnterType?this.fnGetMoveEnterType():CB.MoveEnterType.NEWLINE};c.prototype.getMarkedSquaresOnButtonDown=function(b,c){return!c||this.clickHintTimer&&this.clickHintTimer.isActive()?this.genLegalSquareHints(b):this.getTargetSquareHints(b)};c.prototype.startClickHintTimer=function(b){this.kernel.game.getMoveOffs()<this.startMoveNo||(this.clickHintTimer||(this.clickHintTimer=new CB.Timer),this.clickHintTimer.runOnce(this.clickHintTimeout,function(){var c=this.getTargetSquareHints(b);
this.kernel.boardWin.markSquares(c)}.bind(this)))};c.prototype.getLegalSqClr=function(){return"hsla( 0, 0%, 55%, 0.50 )"};c.prototype.getTargetSquareHints=function(b){var c=[];if(CB.Piece.side(this.kernel.getCurPos().board[b])!=this.kernel.getCurPos().getSideToMove())return c;V15.analysisEngine&&(b=V15.analysisEngine.getHintSquaresOnButtonDown(b),b.forEach(function(b){for(var e=!1,l=0;!e&&l<c.length;l++)c[l].sq==b.sq&&(e=!0);e||c.push(b)}),0!=b.length||V15.analysisEngine.running||V15.analysisEngine.engineGo(this.kernel));
return c};c.prototype.onAnalysisLine=function(b,c,g){this.kernel.game.hasTBEval||(this.kernel.getCurPos().getBTM()&&(c=-c),this.kernel.game.fireOnEval(b,c,g))};c.prototype.toggleEngine=function(){if(this.isEngineLoaded(0))return this.unloadEngine(0),!1;this.loadEngine(0);this.updateGamePos();return!0};return c}();"use strict";
CB.AnnoType={POSTTEXT:2,SYMBOL:3,SQUARE_LIST:4,ARROW_LIST:5,DIAGRAM:6,TIME:7,DATE:8,TRAINING:9,BIGMAX:16,AUDIO:16,PICTURE:17,VIDEO:18,GAME_QUOTATION:19,PAWN_STRUCT:20,PIECE_PATH:21,MIDDLEGAME_CLASS:22,ENDGAME_CLASS:23,CRITICAL_POS:24,CORR:25,STREAM:26,CHESS_VARIANT:27,MAX:32,CAPTION:32,FRITZ_EVAL:33,MOVE_MEDAL:34,COLOR:35,TIME_CONTROL:36,SYNC:37,EVAL_PROFILE:38,AUDIO_STREAM:127,GENERIC:127,ANNO_BITS:127,PRE_BIT:128,toString:function(c){for(var b in this)if(this[b]==c)return"AnnoType: "+b;return"Unknown AnnoType: "+
c}};CB.AnnoMarkType={NONE:0,GOOD:1,BAD:2,VERY_GOOD:3,VERY_BAD:4,INTERESTING:5,DUBIOUS:6,ONLY_MOVE:8,ZUGZWANG:22,MYMOVE:165,IMPORTANT:166,WHITE:167,BLACK:168,BOTH:169};CB.AnnoEvalType={NONE:0,EQUAL:11,UNCLEAR:13,BLACK_SLIGHTLY_BETTER:15,BLACK_BETTER:17,BLACK_WINS:19,WHITE_WINS:18,WHITE_BETTER:16,WHITE_SLIGHTLY_BETTER:14,COMPENSATION:44,COUNTERPLAY:132,INITIATIVE:36,ATTACK:40,ZEITNOT:138,DEVELOPMENT:32,NOVELTY:146};CB.TextType={TT_ANSI:0,TT_RTF:1,TT_HTML:2,TT_TOKEN:3,TT_JSON:4};
CB.AnnoType.PRETEXT=CB.AnnoType.PRE_BIT|CB.AnnoType.POSTTEXT;CB.AnnoType.PRE_SQUARE_LIST=CB.AnnoType.PRE_BIT|CB.AnnoType.SQUARE_LIST;CB.AnnoType.PRE_ARROW_LIST=CB.AnnoType.PRE_BIT|CB.AnnoType.ARROW_LIST;CB.Medal={BESTGAME:1,TOURN_DECISIVE:2,SAMPLE_OPENING:4,IMPORTANT_NOVELTY:8,PAWNSTRUCTURE:16,STRATEGY:32,TACTICS:64,ATTACK:128,DEFENSE:256,SACRIFICE:512,MATERIAL:1024,PIECEPLAY:2048,ENDGAME:4096,TACTICAL_BLUNDER:8192,STRATEGICAL_BLUNDER:16384,USER:32768};
var AnnoFactory={factory:function(c){return c in this?new this[c]:null}};function AnnoRec(){}AnnoRec.readHeader=function(c){return{inxMv:c.readBEInt24(),type:c.readByte(),len:c.readBEInt16()}};AnnoRec.writeHeader=function(c,b,d,e){c.writeBEInt24(b);c.writeByte(d);c.writeBEInt16(e)};AnnoRec.ANNO_HEAD_SIZE=6;
CB.TextAnno=function(){var c=function(b){this.textType=CB.TextType.TT_ANSI;this.m_str=b?b:""};c.prototype.getString=function(){return this.m_str};c.prototype.setString=function(b){this.m_str=b};c.prototype.toString=function(){return this.m_str};c.prototype.addText=function(b){this.m_str+=b};c.prototype.write=function(b,d){var c=AnnoRec.ANNO_HEAD_SIZE+2+this.m_str.length;b.Vi(c);AnnoRec.writeHeader(b,0,d,c);b.writeByte(this.textType||CB.TextType.TT_ANSI);b.writeByte(0);b.writeSizedString(this.m_str)};
c.prototype.read=function(b,d){this.textType=d.readByte();d.readByte();this.m_str=d.readSizedString(b-2);CB.strUtil.mayBeUtf8(this.m_str)&&(this.m_str=CB.strUtil.decodeUTF8(this.m_str))};return c}();AnnoFactory[CB.AnnoType.POSTTEXT]=CB.TextAnno;AnnoFactory[CB.AnnoType.PRETEXT]=CB.TextAnno;
CB.SymbolsAnno=function(){var c=function(){};c.prototype=[];c.prototype.toString=function(){return"syms"};c.prototype.isExclusiveMark=function(b){return 1<=b&&6>=b};c.prototype.isExclusiveEval=function(b){return 11<=b&&19>=b||44==b};c.prototype.addSymbol=function(b){for(var d=0;d<this.length;d++)if(this.isExclusiveMark(this[d])&&this.isExclusiveMark(b)||this.isExclusiveEval(this[d])&&this.isExclusiveEval(b)){b!=this[d]&&this.push(b);this.splice(d,1);return}for(d=0;d<this.length;d++)if(b==this[d]){this.splice(d,
1);return}this.push(b)};c.prototype.hasExclusiveEval=function(b){for(var d=0;d<this.length;d++)if(b==this[d]&&this.isExclusiveEval(b))return!0;return!1};c.prototype.getEval=function(){for(var b=0;b<this.length;b++)if(this.isExclusiveEval(this[b]))return this[b];return 0};c.prototype.removeMyMoveMark=function(){for(var b=0;b<this.length;b++)if(this[b]===CB.AnnoMarkType.MYMOVE){this.splice(b,1);break}};c.prototype.write=function(b){var d=AnnoRec.ANNO_HEAD_SIZE+this.length;b.Vi(d);AnnoRec.writeHeader(b,
0,CB.AnnoType.SYMBOL,d);for(d=0;d<this.length;d++)b.writeByte(this[d])};c.prototype.read=function(b,d){for(var c=0;c<b;++c)this.push(d.readByte())};return c}();AnnoFactory[CB.AnnoType.SYMBOL]=CB.SymbolsAnno;CB.BoardColor={NONE:0,GREEN:1,YELLOW:2,RED:3,TRANSYELLOW:4};CB.BoardColor.fromChar=function(c){switch(c){case "R":return CB.BoardColor.RED;case "Y":return CB.BoardColor.YELLOW;case "G":return CB.BoardColor.GREEN;default:return CB.BoardColor.NONE}};
CB.BoardColor.fromString=function(c){switch(c){case "R":case "LR":return CB.BoardColor.RED;case "Y":return CB.BoardColor.YELLOW;case "LG":case "G":return CB.BoardColor.GREEN;default:return CB.BoardColor.GREEN}};CB.BoardColor.toChar=function(c){switch(c){case CB.BoardColor.RED:return"R";case CB.BoardColor.YELLOW:return"Y";case CB.BoardColor.GREEN:return"G"}return""};
CB.ColSq=function(){function c(b,d){this.field=b;this.color=d}c.STRING_LEN=3;c.prototype.init=function(b){this.color=CB.BoardColor.GREEN;this.field=CB.Square.A1;4==b.length?(this.color=CB.BoardColor.fromString(b.substring(0,2)),this.field=CB.Square.fromString(b.substring(2,4))):3==b.length&&(this.color=CB.BoardColor.fromChar(b[0]),this.field=CB.Square.fromString(b.substring(1)))};c.readFactory=createReadFactory(c);c.prototype.read=function(b){this.color=b.readByte();this.field=b.readByte();this.color--;
this.field--};c.prototype.write=function(b){b.writeByte(this.color+1);b.writeByte(this.field+1)};c.prototype.toString=function(){return CB.BoardColor.toChar(this.color)+CB.Square.toString(this.field)};c.prototype.getColour=function(){switch(this.color){case CB.BoardColor.GREEN:return"hsla( 120, 65%, 50%, 0.75 )";case CB.BoardColor.YELLOW:return"hsla( 60, 65%, 50%, 0.8 )";case CB.BoardColor.RED:return"hsla( 0, 65%, 50%, 0.75 )"}};return c}();
CB.ColSqAnno=function(){var c=function(){};c.prototype=[];c.prototype.read=function(b,d){for(var c=0;c<b/2;c++){var f=new CB.ColSq(0,0);f.read(d);this.push(f)}};c.prototype.write=function(b){var d=AnnoRec.ANNO_HEAD_SIZE+2*this.length;b.Vi(d);AnnoRec.writeHeader(b,0,CB.AnnoType.SQUARE_LIST,d);for(d=0;d<this.length;d++)this[d].write(b)};c.prototype.toString=function(b){b||(b=",");return this.join(b)};return c}();AnnoFactory[CB.AnnoType.SQUARE_LIST]=CB.ColSqAnno;
CB.ColArrow=function(){var c=function(b,d,c){this.from=b;this.to=d;this.color=c};c.STRING_LEN=5;c.prototype.init=function(b){this.from=CB.Square.fromString(b.substring(1,3));this.to=CB.Square.fromString(b.substring(3,5));this.color=CB.BoardColor.fromChar(b[0])};c.readFactory=createReadFactory(c);c.prototype.read=function(b){this.color=b.readByte();this.from=b.readByte();this.to=b.readByte();this.color--;this.from--;this.to--};c.prototype.write=function(b){b.writeByte(this.color+1);b.writeByte(this.from+
1);b.writeByte(this.to+1)};c.prototype.toString=function(){return CB.BoardColor.toChar(this.color)};c.prototype.getColour=function(){switch(this.color){case CB.BoardColor.GREEN:return"hsla( 120, 70%, 50%, 0.90 )";case CB.BoardColor.YELLOW:return"hsla( 50, 75%, 65%, 0.90 )";case CB.BoardColor.RED:return"hsla( 1, 85%, 45%, 0.90 )"}};return c}();
CB.ColArrowAnno=function(){var c=function(){};c.prototype=[];c.prototype.read=function(b,d){for(var c=0;c<b/3;c++){var f=new CB.ColArrow;f.read(d);this.push(f)}};c.prototype.write=function(b){var d=AnnoRec.ANNO_HEAD_SIZE+3*this.length;b.Vi(d);AnnoRec.writeHeader(b,0,CB.AnnoType.ARROW_LIST,d);for(d=0;d<this.length;d++)this[d].write(b)};c.prototype.toString=function(b){b||(b=",");return this.join(b)};return c}();AnnoFactory[CB.AnnoType.ARROW_LIST]=CB.ColArrowAnno;AnnoFactory[CB.AnnoType.DIAGRAM]=CB.TextAnno;
CB.EvalAnno=function(){var c=function(b,d){b&&(this.eval=b);d&&(this.depth=d)};c.prototype.eval=0;c.prototype.depth=0;c.prototype.toString=function(){return this.eval+"/"+this.depth};c.prototype.read=function(b,d){this.eval=d.V11();this.type=d.V11();this.depth=d.V11()};return c}();AnnoFactory[CB.AnnoType.FRITZ_EVAL]=CB.EvalAnno;
CB.TimeAnno=function(){var c=function(b){this.time=b||0};c.prototype.getString=function(){var b=this.time>>24,d=this.time>>16&255,c=this.time>>8&255,f=this.time&255,g="";0<b&&(g=b+":");0<d&&(10>d&&0<g.length&&(g+="0"),g+=d+":");10>c&&0<g.length&&(g+="0");0==d&&0==b&&10>c?(g+=c,b=Math.floor(f/10),0<b&&(g+="."+b)):(b=Math.round(c+f/50),60==b&&(b=59),g+=b);return g};c.prototype.fromCentiSecs=function(b){this.time=CB.TimeTools.getCBTimeOfCentiSecs(b)};c.prototype.toString=function(){return"Time: "+Math.round(this.getTimeIn100th()/
100)+"s"};c.prototype.read=function(b,d){this.time=d.readBEInt32()};c.prototype.write=function(b){var d=AnnoRec.ANNO_HEAD_SIZE+4;b.Vi(d);AnnoRec.writeHeader(b,0,CB.AnnoType.TIME,d);b.writeBEInt32(this.time)};c.prototype.getTimeIn100th=function(){return 36E4*(this.time>>24)+6E3*(this.time>>16&255)+100*(this.time>>8&255)+(this.time&255)};return c}();AnnoFactory[CB.AnnoType.TIME]=CB.TimeAnno;
CB.TimeControlAnno=function(){var c=function(){};c.prototype.toString=function(){return"TC=NOTIMPL"};c.prototype.read=function(b,d){for(var c=0;c<b;c++)d.readByte()};return c}();AnnoFactory[CB.AnnoType.TIME_CONTROL]=CB.TimeControlAnno;
CB.SyncAnno=function(){var c=function(){this.data=[]};c.prototype.toString=function(){return"Sync"};c.prototype.read=function(b,d){for(var c=0;c<b;c++)this.data[c]=d.readByte()};c.prototype.write=function(b){var d=AnnoRec.ANNO_HEAD_SIZE+4;b.Vi(d);AnnoRec.writeHeader(b,0,CB.AnnoType.SYNC,d);for(var c=0,d=this.data.length;c<d;++c)b.writeByte(this.data[c])};return c}();AnnoFactory[CB.AnnoType.SYNC]=CB.SyncAnno;
CB.MoveMedalAnno=function(){var c=function(b){this.medal=b};c.prototype.toString=function(){return"Medal-"+this.medal};c.prototype.getString=function(){return this.toString()};c.prototype.getOneMedal=function(){return this.medal&CB.Medal.SACRIFICE?CB.Medal.SACRIFICE:this.medal&CB.Medal.ENDGAME?CB.Medal.ENDGAME:this.medal&CB.Medal.STRATEGY?CB.Medal.STRATEGY:this.medal&CB.Medal.TACTICAL_BLUNDER?CB.Medal.TACTICAL_BLUNDER:this.medal};c.prototype.read=function(b,d){this.medal=d.Vw()};c.prototype.write=
function(b){var d=AnnoRec.ANNO_HEAD_SIZE+4;b.Vi(d);AnnoRec.writeHeader(b,0,CB.AnnoType.MOVE_MEDAL,d);b.Vh(this.medal)};return c}();AnnoFactory[CB.AnnoType.MOVE_MEDAL]=CB.MoveMedalAnno;
CB.EvalProfileAnno=function(){var c=function(b,d,c){this.first=b||0;this.last=d||0;this.evalArr=c||[];this.min=32767;this.max=-32767;this.detMinMax()};c.EV_INVALID=32767;c.prototype.detMinMax=function(){for(var b=0;b<this.evalArr.length;b++)this.evalArr[b]!=c.EV_INVALID&&(this.evalArr[b]>this.max&&(this.max=this.evalArr[b]),this.evalArr[b]<this.min&&(this.min=this.evalArr[b]))};c.prototype.range=function(){return Math.max(1,this.max-this.min)};c.prototype.toString=function(){return"MoveMedal"};c.prototype.isValid=
function(){return this.last>this.first};c.prototype.read=function(b,d){this.evalArr=[];this.last=this.first=0;var e=d.readBEInt16();if(600>e){for(var f=0;f<e;f++){var g=new ArrayBuffer(4),h=new DataView(g);h.setInt8(0,d.readByte());h.setInt8(1,d.readByte());h.setInt8(2,d.readByte());h.setInt8(3,d.readByte());g=h.getInt16(2);h.getInt8(1);h=h.getInt8(0);-1==h?this.evalArr.push(c.EV_INVALID):(1==h&&(g=0>g?-3E4+g:3E4-g),this.evalArr.push(g))}this.last=e-1}this.detMinMax()};c.readFactory=createReadFactory(c);
c.prototype.write=function(b){var d=AnnoRec.ANNO_HEAD_SIZE+2+4*this.evalArr.length;b.Vi(d);AnnoRec.writeHeader(b,0,CB.AnnoType.EVAL_PROFILE,d);b.writeBEInt16(this.evalArr.length);for(d=0;d<this.evalArr.length;d++){var e=new ArrayBuffer(4),e=new DataView(e);this.evalArr[d]==c.EV_INVALID?(e.setInt8(0,255),e.setInt16(2,0)):(e.setInt8(0,0),e.setInt16(2,this.evalArr[d]));e.setInt8(1,0);b.writeBEInt32(e.getInt32(0))}};return c}();AnnoFactory[CB.AnnoType.EVAL_PROFILE]=CB.EvalProfileAnno;
CB.TrainingAnno=function(){var c=function(b){this.move=b;this.solved=!1;this.nHelpClicked=0;this.texts={};this.texts.en=={question:"",help:""}},b=["en","de","es","it"],d=[CB.Language.ENG,CB.Language.DEU,CB.Language.ESP,CB.Language.ITA];c.prototype.getQuestion=function(d){if(this.texts[d])return this.texts[d].question;for(d=0;d<b.length;d++)if(this.texts[b[d]])return this.texts[b[d]].question};c.prototype.getHelp=function(d){if(this.texts[d])return this.texts[d].help;for(d=0;d<b.length;d++)if(this.texts[b[d]])return this.texts[b[d]].help};
c.prototype.toString=function(){return"Training"};c.prototype.decodeLocals=function(b){b.Vw();b.Vu();for(var d=b.Vu(),c=0;c<d&&10>c;c++){var h=this.decodeString(b),l=h.ln;l&&(this.texts[l]||(this.texts[l]={}),this.texts[l].question=h.str)}h=b.Vu();for(c=0;c<h&&10>c;c++)this.decodeString(b);d=b.Vu();for(c=0;c<d&&10>c;c++)if(h=this.decodeString(b),l=h.ln)this.texts[l]||(this.texts[l]={}),this.texts[l].help=h.str;h=b.Vu();for(c=0;c<h&&10>c;c++)this.decodeString(b)};c.prototype.readMoveInputItem=function(b){b.Vu();
this.decodeLocals(b);for(var d=b.readByte(),c=0;c<d&&60>c;c++){var h=b.readByte(),l=b.readByte(),q=b.readByte();b.readByte();var r=b.Vu();0==c&&(this.move=new CB.Move(h,l,q));for(h=0;h<r;h++)this.decodeString(b)}};c.prototype.readMultipleChoiceItem=function(b){b.Vu();this.decodeLocals(b);for(var d=b.readByte(),c=0;c<d&&60>c;c++){b.readByte();for(var h=b.Vu(),l=0;l<h;l++)this.decodeString(b);h=b.Vu();for(l=0;l<h;l++)this.decodeString(b)}};c.prototype.read=function(b,d){d.Vu();switch(d.readByte()){case 1:this.readMoveInputItem(d);
break;case 2:this.readMultipleChoiceItem(d)}};c.prototype.write=function(c){var f=new CB.DataBuffer;f.Vi(1);f.writeByte(1);var g=f.getPos();f.Vi(0);f.Vh(300);f.Vi(0);var h=f.getPos();f.Vi(0);for(var l=0,q=0;q<b.length;q++)this.texts[b[q]]&&this.texts[b[q]].question&&(l=this.encodeString(this.texts[b[q]].question,f,l,d[q]));f.writeAtPrevPos(h,function(){f.Vi(l)});f.Vi(0);var r=0,h=f.getPos();f.Vi(0);for(q=0;q<b.length;q++)this.texts[b[q]]&&this.texts[b[q]].help&&(r=this.encodeString(this.texts[b[q]].help,
f,r,d[q]));f.writeAtPrevPos(h,function(){f.Vi(r)});f.Vi(0);f.writeByte(1);f.writeByte(this.move.from);f.writeByte(this.move.to);f.writeByte(this.move.prom);f.writeByte(5);f.Vi(0);var t=f.getPos();f.writeAtPrevPos(g,function(){f.Vi(t)});g=AnnoRec.ANNO_HEAD_SIZE+f.getSize();c.Vi(g);AnnoRec.writeHeader(c,0,CB.AnnoType.TRAINING,g);c.writeData(f)};c.prototype.decodeString=function(b){b.readByte();var d=b.readByte(),c=b.Vu();b=b.readSizedString(c);CB.strUtil.mayBeUtf8(b)&&(b=CB.strUtil.decodeUTF8(b));return{ln:CB.Language.getParamOfLanguageId(d),
str:b}};c.prototype.encodeString=function(b,d,c,h){b&&(d.writeByte(h),d.writeByte(0),d.Vi(b.length),d.writeSizedString(b),c++);return c};return c}();AnnoFactory[CB.AnnoType.TRAINING]=CB.TrainingAnno;"use strict";
CB.SpecialGlyphs={NONE:0,GOOD_MOVE:1,BAD_MOVE:2,VERY_GOOD_MOVE:3,VERY_BAD_MOVE:4,SPECULATIVE_MOVE:5,DUBIOUS_MOVE:6,FORCED_MOVE:7,SINGULAR_MOVE:8,WORST_MOVE:9,DRAWN_POS:10,EQUAL_QUIET_POS:11,EQUAL_ACTIVE_POS:12,UNCLEAR_POS:13,W_SLIGHT_ADV:14,B_SLIGHT_ADV:15,W_MODER_ADV:16,B_MODER_ADV:17,W_DECIS_ADV:18,B_DECIS_ADV:19,W_CRASH_ADV:20,B_CRASH_ADV:21,W_ZUGZW:22,B_ZUGZW:23,W_SLIGHT_SPC:24,B_SLIGHT_SPC:25,W_MODER_SPC:26,B_MODER_SPC:27,W_DECIS_SPC:28,B_DECIS_SPC:29,W_SLIGHT_TEMP:30,B_SLIGHT_TEMP:31,W_MODER_TEMP:32,
B_MODER_TEMP:33,W_DECIS_TEMP:34,B_DECIS_TEMP:35,W_INITIATIVE:36,B_INITIATIVE:37,W_LASTING_INITIATIVE:38,B_LASTING_INITIATIVE:39,W_ATTACK:40,B_ATTACK:41,W_INSUFF_COMP:42,B_INSUFF_COMP:43,W_SUFF_COMP:44,B_SUFF_COMP:45,W_GOOD_COMP:46,B_GOOD_COMP:47,W_SLIGHT_CENTER:48,B_SLIGHT_CENTER:49,W_MODER_CENTER:50,B_MODER_CENTER:51,W_DECIS_CENTER:52,B_DECIS_CENTER:53,W_SLIGHT_KS:54,B_SLIGHT_KS:55,W_MODER_KS:56,B_MODER_KS:57,W_DECIS_KS:58,B_DECIS_KS:59,W_SLIGHT_QS:60,B_SLIGHT_QS:61,W_MODER_QS:62,B_MODER_QS:63,W_DECIS_QS:64,
B_DECIS_QS:65,W_BAD_FRST_RANK:66,B_BAD_FRST_RANK:67,W_GOOD_FRST_RANK:68,B_GOOD_FRST_RANK:69,W_BAD_PROTECTED_KING:70,B_BAD_PROTECTED_KING:71,W_GOOD_PROTECTED_KING:72,B_GOOD_PROTECTED_KING:73,W_BAD_PLACED_KING:74,B_BAD_PLACED_KING:75,W_GOOD_PLACED_KING:76,B_GOOD_PLACED_KING:77,W_VERY_WEAK_PAWNS:78,B_VERY_WEAK_PAWNS:79,W_MODER_WEAK_PAWNS:80,B_MODER_WEAK_PAWNS:81,W_MODER_STRONG_PAWNS:82,B_MODER_STRONG_PAWNS:83,W_VERY_STRONG_PAWNS:84,B_VERY_STRONG_PAWNS:85,W_BAD_KNIGHT:86,B_BAD_KNIGHT:87,W_GOOD_KNIGHT:88,
B_GOOD_KNIGHT:89,W_BAD_BISHOP:90,B_BAD_BISHOP:91,W_GOOD_BISHOP:92,B_GOOD_BISHOP:93,W_BAD_ROOK:94,B_BAD_ROOK:95,W_GOOD_ROOK:96,B_GOOD_ROOK:97,W_BAD_QUEEN:98,B_BAD_QUEEN:99,W_GOOD_QUEEN:100,B_GOOD_QUEEN:101,W_BAD_PIECES:102,B_BAD_PIECES:103,W_GOOD_PIECES:104,B_GOOD_PIECES:105,W_OP_VERY_BAD:106,B_OP_VERY_BAD:107,W_OP_BAD:108,B_OP_BAD:109,W_OP_GOOD:110,B_OP_GOOD:111,W_OP_VERY_GOOD:112,B_OP_VERY_GOOD:113,W_MG_VERY_BAD:114,B_MG_VERY_BAD:115,W_MG_BAD:116,B_MG_BAD:117,W_MG_GOOD:118,B_MG_GOOD:119,W_MG_VERY_GOOD:120,
B_MG_VERY_GOOD:121,W_EG_VERY_BAD:122,B_EG_VERY_BAD:123,W_EG_BAD:124,B_EG_BAD:125,W_EG_GOOD:126,B_EG_GOOD:127,W_EG_VERY_GOOD:128,B_EG_VERY_GOOD:129,W_SLIGHT_COUNTER:130,B_SLIGHT_COUNTER:131,W_MODER_COUNTER:132,B_MODER_COUNTER:133,W_DECIS_COUNTER:134,B_DECIS_COUNTER:135,W_MODER_ZEITNOT:136,B_MODER_ZEITNOT:137,W_SEVERE_ZEITNOT:138,B_SEVERE_ZEITNOT:139,WITH_IDEA:140,AIMED_AGAINST:141,BETTER_IS:142,WORSE_IS:143,EQUAL_IS:144,EDITORS_MARK:145,NOVELTY:146,WEAK_POINT:147,ENDGAME:148,LINE:149,DIAGONAL:150,
W_BISHOP_PAIR:151,B_BISHOP_PAIR:152,OPP_COLOR_BISHOPS:153,SAME_COLOR_BISHOPS:154,W_UNITED_PAWNS:155,B_UNITED_PAWNS:156,W_SEPARATE_PAWNS:157,B_SEPARATE_PAWNS:158,W_DOUBLE_PAWNS:159,B_DOUBLE_PAWNS:160,W_PASSED_PAWNS:161,B_PASSED_PAWNS:162,W_MORE_PAWNS:163,B_MORE_PAWNS:164,MY_MOVE:165,IMPORTANT:166,WHITE:167,BLACK:168,BOTH:169};var Vp={};Vp[CB.SpecialGlyphs.NONE]="";Vp[CB.SpecialGlyphs.GOOD_MOVE]="!";Vp[CB.SpecialGlyphs.BAD_MOVE]="?";Vp[CB.SpecialGlyphs.VERY_GOOD_MOVE]="\u203c";
Vp[CB.SpecialGlyphs.VERY_BAD_MOVE]="??";Vp[CB.SpecialGlyphs.SPECULATIVE_MOVE]="!?";Vp[CB.SpecialGlyphs.DUBIOUS_MOVE]="?!";Vp[CB.SpecialGlyphs.FORCED_MOVE]="!";Vp[CB.SpecialGlyphs.SINGULAR_MOVE]="\ue021";Vp[CB.SpecialGlyphs.WORST_MOVE]="";Vp[CB.SpecialGlyphs.DRAWN_POS]="=";Vp[CB.SpecialGlyphs.EQUAL_QUIET_POS]="=";Vp[CB.SpecialGlyphs.EQUAL_ACTIVE_POS]="=";Vp[CB.SpecialGlyphs.UNCLEAR_POS]="\u221e";Vp[CB.SpecialGlyphs.W_SLIGHT_ADV]="\ue02f";Vp[CB.SpecialGlyphs.B_SLIGHT_ADV]="\ue02e";
Vp[CB.SpecialGlyphs.W_MODER_ADV]="\u00b1";Vp[CB.SpecialGlyphs.B_MODER_ADV]="\ue01a";Vp[CB.SpecialGlyphs.W_DECIS_ADV]="+-";Vp[CB.SpecialGlyphs.B_DECIS_ADV]="-+";Vp[CB.SpecialGlyphs.W_CRASH_ADV]="+-";Vp[CB.SpecialGlyphs.B_CRASH_ADV]="-+";Vp[CB.SpecialGlyphs.W_ZUGZW]="\ue01d";Vp[CB.SpecialGlyphs.B_ZUGZW]="\ue01d";Vp[CB.SpecialGlyphs.W_SLIGHT_SPC]="\ue023";Vp[CB.SpecialGlyphs.B_SLIGHT_SPC]="\ue023";Vp[CB.SpecialGlyphs.W_MODER_SPC]="\ue023";Vp[CB.SpecialGlyphs.B_MODER_SPC]="\ue023";
Vp[CB.SpecialGlyphs.W_DECIS_SPC]="\ue023";Vp[CB.SpecialGlyphs.B_DECIS_SPC]="\ue023";Vp[CB.SpecialGlyphs.W_SLIGHT_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.B_SLIGHT_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.W_MODER_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.B_MODER_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.W_DECIS_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.B_DECIS_TEMP]="\ue02d";Vp[CB.SpecialGlyphs.W_INITIATIVE]="\ue012";Vp[CB.SpecialGlyphs.B_INITIATIVE]="\ue012";Vp[CB.SpecialGlyphs.W_LASTING_INITIATIVE]="\ue012";
Vp[CB.SpecialGlyphs.B_LASTING_INITIATIVE]="\ue012";Vp[CB.SpecialGlyphs.W_ATTACK]="\ue013";Vp[CB.SpecialGlyphs.B_ATTACK]="\ue013";Vp[CB.SpecialGlyphs.W_INSUFF_COMP]="\ue004\ue000";Vp[CB.SpecialGlyphs.B_INSUFF_COMP]="\ue004\ue000";Vp[CB.SpecialGlyphs.W_SUFF_COMP]="\ue000";Vp[CB.SpecialGlyphs.B_SUFF_COMP]="\ue000";Vp[CB.SpecialGlyphs.W_GOOD_COMP]="\ue000";Vp[CB.SpecialGlyphs.B_GOOD_COMP]="\ue000";Vp[CB.SpecialGlyphs.W_SLIGHT_CENTER]="\ue01e";Vp[CB.SpecialGlyphs.B_SLIGHT_CENTER]="\ue01e";
Vp[CB.SpecialGlyphs.W_MODER_CENTER]="\ue01e";Vp[CB.SpecialGlyphs.B_MODER_CENTER]="\ue01e";Vp[CB.SpecialGlyphs.W_DECIS_CENTER]="\ue01e";Vp[CB.SpecialGlyphs.B_DECIS_CENTER]="\ue01e";Vp[CB.SpecialGlyphs.W_SLIGHT_KS]="\ue00f";Vp[CB.SpecialGlyphs.B_SLIGHT_KS]="\ue00f";Vp[CB.SpecialGlyphs.W_MODER_KS]="\ue00f";Vp[CB.SpecialGlyphs.B_MODER_KS]="\ue00f";Vp[CB.SpecialGlyphs.W_DECIS_KS]="\ue00f";Vp[CB.SpecialGlyphs.B_DECIS_KS]="\ue00f";Vp[CB.SpecialGlyphs.W_SLIGHT_QS]="\ue00e";
Vp[CB.SpecialGlyphs.B_SLIGHT_QS]="\ue00e";Vp[CB.SpecialGlyphs.W_MODER_QS]="\ue00e";Vp[CB.SpecialGlyphs.B_MODER_QS]="\ue00e";Vp[CB.SpecialGlyphs.W_DECIS_QS]="\ue00e";Vp[CB.SpecialGlyphs.B_DECIS_QS]="\ue00e";Vp[CB.SpecialGlyphs.W_BAD_FRST_RANK]="\ue010\ue0181";Vp[CB.SpecialGlyphs.B_BAD_FRST_RANK]="\ue010\ue0188";Vp[CB.SpecialGlyphs.W_GOOD_FRST_RANK]="";Vp[CB.SpecialGlyphs.B_GOOD_FRST_RANK]="";Vp[CB.SpecialGlyphs.W_BAD_PROTECTED_KING]="\ue010\ue024";Vp[CB.SpecialGlyphs.B_BAD_PROTECTED_KING]="\ue010\ue024";
Vp[CB.SpecialGlyphs.W_GOOD_PROTECTED_KING]="";Vp[CB.SpecialGlyphs.B_GOOD_PROTECTED_KING]="";Vp[CB.SpecialGlyphs.W_BAD_PLACED_KING]="\ue010\ue024";Vp[CB.SpecialGlyphs.B_BAD_PLACED_KING]="\ue010\ue024";Vp[CB.SpecialGlyphs.W_GOOD_PLACED_KING]="";Vp[CB.SpecialGlyphs.B_GOOD_PLACED_KING]="";Vp[CB.SpecialGlyphs.W_VERY_WEAK_PAWNS]="\ue010\ue029";Vp[CB.SpecialGlyphs.B_VERY_WEAK_PAWNS]="\ue010\ue029";Vp[CB.SpecialGlyphs.W_MODER_WEAK_PAWNS]="\ue010\ue029";Vp[CB.SpecialGlyphs.B_MODER_WEAK_PAWNS]="\ue010\ue029";
Vp[CB.SpecialGlyphs.W_MODER_STRONG_PAWNS]="";Vp[CB.SpecialGlyphs.B_MODER_STRONG_PAWNS]="";Vp[CB.SpecialGlyphs.W_VERY_STRONG_PAWNS]="";Vp[CB.SpecialGlyphs.B_VERY_STRONG_PAWNS]="";Vp[CB.SpecialGlyphs.W_BAD_KNIGHT]="\ue010\ue028";Vp[CB.SpecialGlyphs.B_BAD_KNIGHT]="\ue010\ue028";Vp[CB.SpecialGlyphs.W_GOOD_KNIGHT]="";Vp[CB.SpecialGlyphs.B_GOOD_KNIGHT]="";Vp[CB.SpecialGlyphs.W_BAD_BISHOP]="\ue010\ue027";Vp[CB.SpecialGlyphs.B_BAD_BISHOP]="\ue010\ue027";Vp[CB.SpecialGlyphs.W_GOOD_BISHOP]="";
Vp[CB.SpecialGlyphs.B_GOOD_BISHOP]="";Vp[CB.SpecialGlyphs.W_BAD_ROOK]="\ue010\ue026";Vp[CB.SpecialGlyphs.B_BAD_ROOK]="\ue010\ue026";Vp[CB.SpecialGlyphs.W_GOOD_ROOK]="";Vp[CB.SpecialGlyphs.B_GOOD_ROOK]="";Vp[CB.SpecialGlyphs.W_BAD_QUEEN]="\ue010\ue025";Vp[CB.SpecialGlyphs.B_BAD_QUEEN]="\ue010\ue025";Vp[CB.SpecialGlyphs.W_GOOD_QUEEN]="";Vp[CB.SpecialGlyphs.B_GOOD_QUEEN]="";Vp[CB.SpecialGlyphs.W_BAD_PIECES]="";Vp[CB.SpecialGlyphs.B_BAD_PIECES]="";Vp[CB.SpecialGlyphs.W_GOOD_PIECES]="";
Vp[CB.SpecialGlyphs.B_GOOD_PIECES]="";Vp[CB.SpecialGlyphs.W_OP_VERY_BAD]="";Vp[CB.SpecialGlyphs.B_OP_VERY_BAD]="";Vp[CB.SpecialGlyphs.W_OP_BAD]="";Vp[CB.SpecialGlyphs.B_OP_BAD]="";Vp[CB.SpecialGlyphs.W_OP_GOOD]="";Vp[CB.SpecialGlyphs.B_OP_GOOD]="";Vp[CB.SpecialGlyphs.W_OP_VERY_GOOD]="";Vp[CB.SpecialGlyphs.B_OP_VERY_GOOD]="";Vp[CB.SpecialGlyphs.W_MG_VERY_BAD]="";Vp[CB.SpecialGlyphs.B_MG_VERY_BAD]="";Vp[CB.SpecialGlyphs.W_MG_BAD]="";Vp[CB.SpecialGlyphs.B_MG_BAD]="";Vp[CB.SpecialGlyphs.W_MG_GOOD]="";
Vp[CB.SpecialGlyphs.B_MG_GOOD]="";Vp[CB.SpecialGlyphs.W_MG_VERY_GOOD]="";Vp[CB.SpecialGlyphs.B_MG_VERY_GOOD]="";Vp[CB.SpecialGlyphs.W_EG_VERY_BAD]="\ue010\ue01f";Vp[CB.SpecialGlyphs.B_EG_VERY_BAD]="\ue010\ue01f";Vp[CB.SpecialGlyphs.W_EG_BAD]="\ue010\ue01f";Vp[CB.SpecialGlyphs.B_EG_BAD]="\ue010\ue01f";Vp[CB.SpecialGlyphs.W_EG_GOOD]="";Vp[CB.SpecialGlyphs.B_EG_GOOD]="";Vp[CB.SpecialGlyphs.W_EG_VERY_GOOD]="";Vp[CB.SpecialGlyphs.B_EG_VERY_GOOD]="";Vp[CB.SpecialGlyphs.W_SLIGHT_COUNTER]="\ue017";
Vp[CB.SpecialGlyphs.B_SLIGHT_COUNTER]="\ue017";Vp[CB.SpecialGlyphs.W_MODER_COUNTER]="\ue017";Vp[CB.SpecialGlyphs.B_MODER_COUNTER]="\ue017";Vp[CB.SpecialGlyphs.W_DECIS_COUNTER]="\ue017";Vp[CB.SpecialGlyphs.B_DECIS_COUNTER]="\ue017";Vp[CB.SpecialGlyphs.W_MODER_ZEITNOT]="\ue01c";Vp[CB.SpecialGlyphs.B_MODER_ZEITNOT]="\ue01c";Vp[CB.SpecialGlyphs.W_SEVERE_ZEITNOT]="\ue01c";Vp[CB.SpecialGlyphs.B_SEVERE_ZEITNOT]="\ue01c";Vp[CB.SpecialGlyphs.WITH_IDEA]="\u2206";Vp[CB.SpecialGlyphs.AIMED_AGAINST]="\ue022";
Vp[CB.SpecialGlyphs.BETTER_IS]="\ue020";Vp[CB.SpecialGlyphs.WORSE_IS]="\u2264";Vp[CB.SpecialGlyphs.EQUAL_IS]="=";Vp[CB.SpecialGlyphs.EDITORS_MARK]="RR";Vp[CB.SpecialGlyphs.NOVELTY]="N";Vp[CB.SpecialGlyphs.WEAK_POINT]="\ue010";Vp[CB.SpecialGlyphs.ENDGAME]="\ue01f";Vp[CB.SpecialGlyphs.LINE]="\ue018";Vp[CB.SpecialGlyphs.DIAGONAL]="\ue019";Vp[CB.SpecialGlyphs.W_BISHOP_PAIR]="\ue001";Vp[CB.SpecialGlyphs.B_BISHOP_PAIR]="\ue001";Vp[CB.SpecialGlyphs.OPP_COLOR_BISHOPS]="\ue002";
Vp[CB.SpecialGlyphs.SAME_COLOR_BISHOPS]="\ue003";Vp[CB.SpecialGlyphs.W_UNITED_PAWNS]="\ue02b";Vp[CB.SpecialGlyphs.B_UNITED_PAWNS]="\ue02b";Vp[CB.SpecialGlyphs.W_SEPARATE_PAWNS]="\ue02c";Vp[CB.SpecialGlyphs.B_SEPARATE_PAWNS]="\ue02c";Vp[CB.SpecialGlyphs.W_DOUBLE_PAWNS]="\ue007";Vp[CB.SpecialGlyphs.B_DOUBLE_PAWNS]="\ue007";Vp[CB.SpecialGlyphs.W_PASSED_PAWNS]="\ue008";Vp[CB.SpecialGlyphs.B_PASSED_PAWNS]="\ue008";Vp[CB.SpecialGlyphs.W_MORE_PAWNS]=">";Vp[CB.SpecialGlyphs.B_MORE_PAWNS]=">";
Vp[CB.SpecialGlyphs.MY_MOVE]="*";Vp[CB.SpecialGlyphs.IMPORTANT]="**";Vp[CB.SpecialGlyphs.WHITE]="";Vp[CB.SpecialGlyphs.BLACK]="";Vp[CB.SpecialGlyphs.BOTH]="";var PieceGlyphs={};PieceGlyphs[CB.Piece.PAWN]="\ue029";PieceGlyphs[CB.Piece.KNIGHT]="\ue028";PieceGlyphs[CB.Piece.BISHOP]="\ue027";PieceGlyphs[CB.Piece.ROOK]="\ue026";PieceGlyphs[CB.Piece.QUEEN]="\ue025";PieceGlyphs[CB.Piece.KING]="\ue024";var V2={};V2[CB.Piece.PAWN]="\u2659";V2[CB.Piece.KNIGHT]="\u2658";V2[CB.Piece.BISHOP]="\u2657";
V2[CB.Piece.ROOK]="\u2656";V2[CB.Piece.QUEEN]="\u2655";V2[CB.Piece.KING]="\u2654";Vp.getText=function(c){return Vp[c]};Vp.addTexts=function(c,b){var d={};d[GlyphType.MOVE_GLYPH]=d[GlyphType.PRE_GLYPH]=d[GlyphType.POST_GLYPH]="";for(var e=0,f=b.length;e<f;++e){var g=b[e],h=Vp.getText(g);d[GlyphType.getType(g)]+=h}return d[GlyphType.PRE_GLYPH]+c+d[GlyphType.MOVE_GLYPH]+d[GlyphType.POST_GLYPH]};CB.V4=ObjUtil.clone(CB.V1);CB.V4.arrStrPieces[CB.Piece.W_KING]=CB.V4.arrStrPieces[CB.Piece.B_KING]=PieceGlyphs[CB.Piece.KING];
CB.V4.arrStrPieces[CB.Piece.W_QUEEN]=CB.V4.arrStrPieces[CB.Piece.B_QUEEN]=PieceGlyphs[CB.Piece.QUEEN];CB.V4.arrStrPieces[CB.Piece.W_ROOK]=CB.V4.arrStrPieces[CB.Piece.B_ROOK]=PieceGlyphs[CB.Piece.ROOK];CB.V4.arrStrPieces[CB.Piece.W_BISHOP]=CB.V4.arrStrPieces[CB.Piece.B_BISHOP]=PieceGlyphs[CB.Piece.BISHOP];CB.V4.arrStrPieces[CB.Piece.W_KNIGHT]=CB.V4.arrStrPieces[CB.Piece.B_KNIGHT]=PieceGlyphs[CB.Piece.KNIGHT];CB.V4.arrStrPieces[CB.Piece.W_PAWN]=CB.V4.arrStrPieces[CB.Piece.B_PAWN]="";CB.UnicodeV4=ObjUtil.clone(CB.V1);
CB.UnicodeV4.arrStrPieces[CB.Piece.W_KING]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_KING]=V2[CB.Piece.KING];CB.UnicodeV4.arrStrPieces[CB.Piece.W_QUEEN]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_QUEEN]=V2[CB.Piece.QUEEN];CB.UnicodeV4.arrStrPieces[CB.Piece.W_ROOK]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_ROOK]=V2[CB.Piece.ROOK];CB.UnicodeV4.arrStrPieces[CB.Piece.W_BISHOP]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_BISHOP]=V2[CB.Piece.BISHOP];
CB.UnicodeV4.arrStrPieces[CB.Piece.W_KNIGHT]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_KNIGHT]=V2[CB.Piece.KNIGHT];CB.UnicodeV4.arrStrPieces[CB.Piece.W_PAWN]=CB.UnicodeV4.arrStrPieces[CB.Piece.B_PAWN]="";
var GlyphType={PRE_GLYPH:0,MOVE_GLYPH:1,POST_GLYPH:2,getType:function(c){return c<=CB.SpecialGlyphs.WORST_MOVE||c>=CB.SpecialGlyphs.MY_MOVE&&c<=CB.SpecialGlyphs.BOTH||c===CB.SpecialGlyphs.W_ZUGZW||c===CB.SpecialGlyphs.B_ZUGZW?GlyphType.MOVE_GLYPH:c<=CB.SpecialGlyphs.B_SEVERE_ZEITNOT||c>=CB.SpecialGlyphs.NOVELTY?GlyphType.POST_GLYPH:GlyphType.PRE_GLYPH}};NotationLocalizations.glyphs=CB.V4;NotationLocalizations.uglyphs=CB.UnicodeV4;"use strict";
CB.TokenType={NONE:0,UNKNOWN:1,EOF:2,HEAD_OP:3,HEAD_CL:4,STR_VAR:5,STR_VAL:6,COMMENT:7,VAR_OP:8,VAR_CL:9,RES_STAR:10,RES_1_0:11,RES_0_1:12,RES_1_2:13,BUCK:14,CHECK:15,MATE:16,MOVE:17,ROCHADE:18,NULLMOVE:19,NUM:20,DOT:21,LONG_ROCHADE:22,SHORT_ROCHADE:23,BAD:24,VERY_BAD:25,GOOD:26,VERY_GOOD:27,BAD_GOOD:28,GOOD_BAD:29};function Token(c,b){this.type=c;b&&(this.str=b)}Token.prototype.type=CB.TokenType.UNKNOWN;Token.prototype.str="";
Token.prototype.toString=function(){var c=EnumToString(CB.TokenType,this.type);this.str&&(c+="("+this.str+")");return c};function V9(c){this.m_it=new StringIterator(c);this.m_it.Next()}V9.prototype.m_it=new StringIterator("");V9.prototype.m_inHeader=!1;
V9.prototype.nextToken=function(){this.m_it.skipWhile(Char.IsWhiteSpace,!0);if(this.m_it.isEOF())return new Token(CB.TokenType.EOF);var c=this.m_it.Current();this.m_it.Next();switch(c){case "X":case "#":return new Token(CB.TokenType.MATE);case "+":return new Token(CB.TokenType.CHECK);case "$":return new Token(CB.TokenType.BUCK);case "*":return new Token(CB.TokenType.RES_STAR,c);case "[":return this.m_inHeader=!0,new Token(CB.TokenType.HEAD_OP);case "]":return this.m_inHeader=!1,new Token(CB.TokenType.HEAD_CL);
case "(":return new Token(CB.TokenType.VAR_OP);case ")":return new Token(CB.TokenType.VAR_CL);case ".":return new Token(CB.TokenType.DOT)}if(this.m_inHeader){if(Char.IsLetterOrDigit(c))return c+=this.m_it.AcceptWhile(Char.IsLetterOrDigit,!0),new Token(CB.TokenType.STR_VAR,c);if('"'===c)return c=this.m_it.AcceptUntil(Char.getIsChar("]"),!0),c=c.trim(),'"'===c.charAt(c.length-1)&&(c=c.slice(0,c.length-1)),new Token(CB.TokenType.STR_VAL,c)}if("{"===c)return c=this.m_it.AcceptUntil(Char.getIsChar("}"),
!0),this.m_it.skipWhile(Char.getIsChar("}"),!0),new Token(CB.TokenType.COMMENT,c);if("0"===c){if(this.m_it.AcceptStr("-0-0",!0))return new Token(CB.TokenType.LONG_ROCHADE);if(this.m_it.AcceptStr("-0",!0))return new Token(CB.TokenType.SHORT_ROCHADE);if(this.m_it.AcceptStr("-1",!0))return new Token(CB.TokenType.RES_0_1)}if("O"===c){if(this.m_it.AcceptStr("-O-O",!0))return new Token(CB.TokenType.LONG_ROCHADE);if(this.m_it.AcceptStr("-O",!0))return new Token(CB.TokenType.SHORT_ROCHADE)}if("1"===c){if(this.m_it.AcceptStr("-0",
!0))return new Token(CB.TokenType.RES_1_0);if(this.m_it.AcceptStr("/2-1/2",!0))return new Token(CB.TokenType.RES_1_2)}return Char.IsDigit(c)?(c+=this.m_it.AcceptWhile(Char.IsDigit,!0),new Token(CB.TokenType.NUM,c)):"-"===c&&this.m_it.AcceptChar("-",!0)?new Token(CB.TokenType.NULLMOVE):"?"===c?this.m_it.AcceptChar("?",!0)?new Token(CB.TokenType.VERY_BAD):this.m_it.AcceptChar("!",!0)?new Token(CB.TokenType.BAD_GOOD):new Token(CB.TokenType.BAD):"!"===c?this.m_it.AcceptChar("?",!0)?new Token(CB.TokenType.GOOD_BAD):
this.m_it.AcceptChar("!",!0)?new Token(CB.TokenType.VERY_GOOD):new Token(CB.TokenType.GOOD):V9.isMoveChar(c)?(c+=this.m_it.AcceptWhile(V9.isMoveChar,!0),new Token(CB.TokenType.MOVE,c)):new Token(CB.TokenType.UNKNOWN,c)};V9.isMoveChar=function(c){return"a"<=c&&"h">=c||"1"<=c&&"8">=c||"x"===c||"="===c||Char.IsUpperCaseLetter(c)&&CB.Piece.fromString(c)!==CB.Piece.NONE};
CB.PGNLexer=function(){var c=function(b){this.m_stm=new V9(b);this.m_last=null};c.prototype.peek=function(b){this.m_last||(this.m_last=this.m_stm.nextToken());return b&&b(this.m_last.type)?this.m_last:null};c.getIsType=function(b){return function(d){return d===b}};c.prototype.pop=function(b){if(b=this.peek(b))this.m_last=null;return b};c.prototype.popT=function(b){return this.pop(c.getIsType(b))};c.prototype.peekT=function(b){return this.peek(c.getIsType(b))};return c}();"use strict";
function PGNSubLine(){}PGNSubLine.prototype=[];
CB.PGNMove=function(){var c=function(b){this.m_strMove=null;this.m_isTake=this.m_isNullMove=this.m_isLongCastle=this.m_isShortCastle=this.m_isMate=this.m_isCheck=!1;this.m_prom=this.m_mvd=CB.Piece.NONE;this.m_to=this.m_rowTo=this.m_colTo=this.m_rowFrom=this.m_colFrom=-1;b&&(this.m_strMove=b,this.init(b))};c.g_regex=/^(K|Q|R|N|B)?([a-h]?)([1-8]?)(x?)([a-h])([1-8])(?:=?(K|Q|R|N|B))?$/;c.prototype.init=function(b){c.g_regex.exec(b)&&(this.m_mvd=CB.Piece.fromString(RegExp.$1),this.m_mvd=CB.Piece.nominal(this.m_mvd),
RegExp.$2&&(this.m_colFrom=CB.Square.colFromString(RegExp.$2)),RegExp.$3&&(this.m_rowFrom=CB.Square.rowFromString(RegExp.$3)),RegExp.$4&&(this.m_isTake=!0),RegExp.$5&&(this.m_colTo=CB.Square.colFromString(RegExp.$5)),RegExp.$6&&(this.m_rowTo=CB.Square.rowFromString(RegExp.$6)),RegExp.$7&&(this.m_prom=CB.Piece.fromString(RegExp.$7),this.m_prom=CB.Piece.nominal(this.m_prom)),0>this.m_rowFrom&&this.m_mvd===CB.Piece.NONE&&(this.m_mvd=CB.Piece.PAWN),0<=this.m_colTo&&0<=this.m_rowTo&&(this.m_to=CB.Square.I(this.m_colTo,
this.m_rowTo)))};c.prototype.setNullMove=function(){this.m_isNullMove=!0};c.prototype.isNullMove=function(){return this.m_isNullMove};c.prototype.setLongCastling=function(){this.m_isLongCastle=!0};c.prototype.isLongCastling=function(){return this.m_isLongCastle};c.prototype.setShortCastling=function(){this.m_isShortCastle=!0};c.prototype.isShortCastling=function(){return this.m_isShortCastle};c.prototype.setCheck=function(b){this.m_isCheck=b};c.prototype.setMate=function(b){this.m_isMate=b};c.prototype.isTake=
function(){return this.m_isTake};c.prototype.matches=function(b){var d=b.from;return this.m_to!==b.to||this.m_mvd!==CB.Piece.NONE&&(b=b.getMoved(),CB.Piece.nominal(b)!==this.m_mvd)?!1:this.matchesFrom(d)};c.prototype.matchesFrom=function(b){return 0<=this.m_colFrom&&this.m_colFrom!==CB.Square.C(b)||0<=this.m_rowFrom&&this.m_rowFrom!==CB.Square.R(b)?!1:!0};c.prototype.getMoved=function(){return this.m_mvd};c.prototype.getTo=function(){return this.m_to};c.prototype.getProm=function(){return this.m_prom};
return c}();CB.PGNComment=function(){var c=function(b){this.m_strComment=b};c.prototype.m_strComment="";c.prototype.getComment=function(){return this.m_strComment};return c}();function PGNGlyph(c){this.m_glyph=c}PGNGlyph.prototype.m_glyph=0;PGNGlyph.prototype.getGlyph=function(){return this.m_glyph};function PGNMoveNum(c,b){this.m_num=c;this.m_isBlack=b}function PGNGame(){this.m_hdrs={};this.m_mainLine=new PGNSubLine}PGNGame.prototype.m_hdrs={};PGNGame.prototype.m_mainLine=new PGNSubLine;
PGNGame.prototype.getHeaders=function(){return this.m_hdrs};PGNGame.prototype.getMainLine=function(){return this.m_mainLine};
CB.PGNParser=function(){function c(b){switch(b){case CB.TokenType.BAD:return CB.SpecialGlyphs.BAD_MOVE;case CB.TokenType.BAD_GOOD:return CB.SpecialGlyphs.DUBIOUS_MOVE;case CB.TokenType.GOOD:return CB.SpecialGlyphs.GOOD_MOVE;case CB.TokenType.GOOD_BAD:return CB.SpecialGlyphs.SPECULATIVE_MOVE;case CB.TokenType.VERY_GOOD:return CB.SpecialGlyphs.VERY_GOOD_MOVE;case CB.TokenType.VERY_BAD:return CB.SpecialGlyphs.VERY_BAD_MOVE;default:return CB.SpecialGlyphs.NONE}}function b(b){return c(b)!==CB.SpecialGlyphs.NONE}
var d=function(b){this.m_lexer=b?b:new CB.PGNLexer("")};d.prototype.acceptGame=function(){var b=new PGNGame;return this.acceptHeaders(b.m_hdrs)&&this.acceptGameNotation(b)?b:null};d.prototype.acceptGameNoMoves=function(){var b=new PGNGame;return this.acceptHeaders(b.m_hdrs)?b:null};d.prototype.acceptGameNotation=function(b){this.acceptNotation(b.m_mainLine);var d=this.acceptResult();null!=d&&(b.m_hdrs.result=d);return!0};d.isResultTokenType=function(b){return b===CB.TokenType.RES_0_1||b===CB.TokenType.RES_1_0||
b===CB.TokenType.RES_1_2||b===CB.TokenType.RES_STAR};d.prototype.acceptResult=function(){var b=this.m_lexer.pop(d.isResultTokenType);if(b)switch(b.type){case CB.TokenType.RES_0_1:return CB.GameResultEnum.BLACK_WINS;case CB.TokenType.RES_1_0:return CB.GameResultEnum.WHITE_WINS;case CB.TokenType.RES_1_2:return CB.GameResultEnum.DRAW;case CB.TokenType.RES_STAR:return CB.GameResultEnum.LINE}return null};d.prototype.acceptNotation=function(b){for(var d=this.acceptNotaElem();null!=d;d=this.acceptNotaElem())b.push(d);
return!0};d.prototype.acceptNotaElem=function(){var b=this.acceptMoveNum();return b||(b=this.acceptMove())||(b=this.acceptGlyph())||(b=this.acceptSubLine())?b:(b=this.acceptComment())?b:null};d.prototype.acceptGlyph=function(){if(this.m_lexer.popT(CB.TokenType.BUCK)){var d=this.m_lexer.popT(CB.TokenType.NUM);return new PGNGlyph(Number(d.str))}return(d=this.m_lexer.pop(b))?(d=c(d.type),new PGNGlyph(d)):null};d.prototype.acceptSubLine=function(){if(this.m_lexer.popT(CB.TokenType.VAR_OP)){var b=new PGNSubLine;
this.acceptNotation(b);this.m_lexer.popT(CB.TokenType.VAR_CL);return b}return null};d.prototype.acceptComment=function(){var b=this.m_lexer.popT(CB.TokenType.COMMENT);return b?new CB.PGNComment(b.str):null};d.prototype.acceptMoveNum=function(){var b=this.m_lexer.popT(CB.TokenType.NUM);if(b){for(var d=0;this.m_lexer.popT(CB.TokenType.DOT);)++d;return new PGNMoveNum(Number(b.str),1<d)}return null};d.isMoveTokenType=function(b){return b===CB.TokenType.MOVE||b===CB.TokenType.LONG_ROCHADE||b===CB.TokenType.SHORT_ROCHADE||
b===CB.TokenType.NULLMOVE};d.prototype.acceptMove=function(){var b=this.m_lexer.pop(d.isMoveTokenType);if(b){var c=new CB.PGNMove;switch(b.type){case CB.TokenType.MOVE:c.init(b.str);break;case CB.TokenType.LONG_ROCHADE:c.setLongCastling();break;case CB.TokenType.SHORT_ROCHADE:c.setShortCastling();break;case CB.TokenType.NULLMOVE:c.setNullMove()}if(b.type!==CB.TokenType.NULLMOVE){var b=null!=this.m_lexer.popT(CB.TokenType.CHECK),e=!1;b||(e=null!=this.m_lexer.popT(CB.TokenType.MATE));c.setCheck(b);
c.setMate(e)}return c}return null};d.prototype.acceptHeaders=function(b){for(;this.acceptHeader(b););return!0};d.prototype.acceptHeader=function(b){if(this.m_lexer.popT(CB.TokenType.HEAD_OP)){var d=this.m_lexer.popT(CB.TokenType.STR_VAR),c=this.m_lexer.popT(CB.TokenType.STR_VAL);this.m_lexer.popT(CB.TokenType.HEAD_CL);d=d.str.toLowerCase();b[d]=c.str;return!0}return!1};d.toColSq=function(b){for(var d=new CB.ColSqAnno,c=0,e=b.length;c<e;++c){var q=b[c],r=new CB.ColSq;r.init(q);d.push(r)}return d};
d.toColArrow=function(b){for(var d=new CB.ColArrowAnno,c=0,e=b.length;c<e;++c){var q=b[c],r=new CB.ColArrow;r.init(q);d.push(r)}return d};d.toDiag=function(b){var d="";0<b.length&&(d=b[0]);return new CB.TextAnno(d)};d.toTime=function(b){b=b[0].split(":");b=3600*Number(b[0])+60*Number(b[1])+Number(b[2]);var d=new CB.TimeAnno;d.fromCentiSecs(100*b);return d};d.toEval=function(b){var d=.01*Number(b[0]),c=0;1<b.length&&(c=Number(b[1]));return new CB.EvalAnno(d,c)};d.toTraining=function(b){var d=new CB.TrainingAnno;
if(7<=b.length&&2==b[0].length){d.move=b[4];for(var c=0;c<b.length/7;c++)2==b[7*c].length&&(d.texts[b[7*c].toLowerCase()]={question:b[7*c+1],help:b[7*c+2]})}else d.move=b[3],d.texts.en={question:b[0],help:b[1]};d.fromPGN=!0;return d};d.toEvalProfile=function(b){var d=[];if(3<b.length){for(var c=parseInt(b[0]),e=parseInt(b[1]),q=0;q<e-c+1;q++)d.push(parseInt(b[q+2]));b=new CB.EvalProfileAnno(c,e,d);b.fromPGN=!0;return b}};d.toMedal=function(b){return new CB.MoveMedalAnno(parseInt(b[0]))};var e={cal:{func:d.toColArrow,
type:CB.AnnoType.ARROW_LIST},csl:{func:d.toColSq,type:CB.AnnoType.SQUARE_LIST},dia:{func:d.toDiag,type:CB.AnnoType.DIAGRAM},eval:{func:d.toEval,type:CB.AnnoType.FRITZ_EVAL},emt:{func:d.toTime,type:CB.AnnoType.TIME},tqu:{func:d.toTraining,type:CB.AnnoType.TRAINING},mdl:{func:d.toMedal,type:CB.AnnoType.MOVE_MEDAL},evp:{func:d.toEvalProfile,type:CB.AnnoType.EVAL_PROFILE}};d.g_regexEval=/(-?(?:\d?\d\.\s?\d\d?)|(?:#\d+))\/\s?(\d+)/;d.toAnno=function(b,c){if(0<=c.indexOf("/")){var h=c.replace(/\r/g," "),
h=h.replace(/\n/g," "),h=h.replace(/\s\s/g," "),l=d.g_regexEval.exec(h);if(l){var q=l[1],q=q.replace(/\s/g,"");0!==q.indexOf("#")&&q.indexOf("-#");q=new CB.EvalAnno(eval,Number(l[2]));b.setAnnoItem(CB.AnnoType.FRITZ_EVAL,q);q=l.index;l=l[0].length;c=h.substring(0,q)+h.substring(q+l)}}if(0<=c.indexOf("[%"))for(h=[],c=PGNCommand.process(c,h),q=0,l=h.length;q<l;++q){var r=h[q];if(r.m_cmd in e){var t=e[r.m_cmd],v=t.type;(r=t.func(r.m_args))&&b.setAnnoItem(v,r)}}c&&b.setAnnoItem(CB.AnnoType.POSTTEXT,new CB.TextAnno(c))};
return d}();
CB.PGN=function(){function c(b){return void 0===b?"":"?"===b?"":b}function b(b){return b&&"?"!==b}function d(d){var f=new CB.GameHeader;f.setWhite(c(d.white));f.setBlack(c(d.black));f.setEvent(c(d.event));f.setSite(c(d.site));f.setAnnotator(c(d.annotator));f.setECO(c(d.eco));var g=d.result;"string"===typeof g?f.setResult(CB.GameResultEnum.fromString(g)):f.setResult(g);f.setRoundStr(c(d.round));b(d.whiteelo)&&f.setEloWhite(parseInt(d.whiteelo));b(d.blackelo)&&f.setEloBlack(parseInt(d.blackelo));b(d.date)&&
f.setDateStr(d.date);b(d.timecontrol)&&f.setClockParams(e(d.timecontrol));b(d.plycount)&&(f.plyCount=parseInt(d.plycount)+1>>1);return f}function e(b){return(b=r.exec(b))?new CB.ClockParams(Number(b[1])/60,Number(b[2])):new CB.ClockParams}function f(b){var c=null,e=b.getHeaders();e.fen&&(c=e.fen);e=d(e);c=new CB.Position(c);b=b.getMainLine();b=l(c,b);b=new CB.Game(c,b);b.setHeader(e);return b}function g(b,d){if(b.isLongCastling()){var c=d.isWTM()?CB.Move.g_mvW000:CB.Move.g_mvB000;if(q.trustLegal||
d.isLegalMove(c))return ObjUtil.clone(c)}if(b.isShortCastling()&&(c=d.isWTM()?CB.Move.g_mvW00:CB.Move.g_mvB00,q.trustLegal||d.isLegalMove(c)))return ObjUtil.clone(c);if(b.isNullMove())return new CB.Move;var e=b.getTo(),f=b.getMoved(),g=d.getSideToMove(),h=b.getProm();f!==CB.Piece.PAWN&&(h=CB.Piece.NONE);c=[];switch(f){case CB.Piece.KNIGHT:d.getKnightAttacksTo(e,g,c);break;case CB.Piece.BISHOP:d.getBishopAttacksTo(e,g,c);break;case CB.Piece.ROOK:d.getRookAttacksTo(e,g,c);break;case CB.Piece.QUEEN:d.getQueenAttacksTo(e,
g,c);break;case CB.Piece.KING:d.getKingAttacksTo(e,g,c);break;case CB.Piece.PAWN:b.isTake()?(f=d.getPiece(e),f===CB.Piece.NONE&&e===d.getEPField()&&(f=d.getEPVictimField(),f=d.getPiece(f)),f!==CB.Piece.NONE&&CB.Piece.side(f)!==g&&d.getPawnAttacksTo(e,g,c)):(f=d.getPiece(e),f===CB.Piece.NONE&&d.getPawnMovesTo(e,g,c));break;default:return null}if(!c.length)return null;if(1===c.length&&q.trustLegal)return new CB.Move(c[0],e,h);g=b.matchesFrom.bind(b);c=c.filter(g);if(!c.length)return null;if(1===c.length&&
q.trustLegal)return new CB.Move(c[0],e);c=c.map(function(b){return new CB.Move(b,e)});c=d.filterLegals(c);return c.length?1===c.length?c[0]:null:null}function h(b){for(var d=["\r\n","\n","\r"],c=0,e=d.length;c<e;++c){var f=d[c];if(0<=b.indexOf(f))return f}return null}function l(b,d){for(var c=ObjUtil.clone(b),e=new CB.MoveLine,f=null,h=null,q=null,r=0,t=d.length;r<t;++r){var v=d[r];if(!(v instanceof PGNMoveNum))if(v instanceof CB.PGNMove){v=g(v,c);if(!v)break;f=c.makeMove(v);h=v;e.push(v);q&&(q.m_strComment&&
0==q.m_strComment.indexOf("[%")?CB.PGNParser.toAnno(h,q.getComment()):h.setAnnoItem(CB.AnnoType.PRETEXT,new CB.TextAnno(q.getComment())),q=null)}else if(v instanceof PGNSubLine){if(h){c.unmakeMove(h,f);v=l(c,v);h.addLine(v);var M=e.length-1;v.setParentLine(e);v.setParentMoveIndex(M);c.makeMove(h)}}else v instanceof CB.PGNComment?h?(v=v.getComment(),CB.PGNParser.toAnno(h,v)):q=v:v instanceof PGNGlyph&&h&&((M=h.getAnnoItem(CB.AnnoType.SYMBOL))||(M=new CB.SymbolsAnno),M.push(v.getGlyph()),h.setAnnoItem(CB.AnnoType.SYMBOL,
M))}for(c=0;c<e.length-1;c++)e[c].hasAnno()&&e[c].getAnno().hasTraining()&&(f=e[c].getAnno().getTraining(),h=e[c+1],f.move=new CB.Move(h.from,h.to,h.prom));return e}var q={},r=/^(\d+)(?:\+(\d+))?$/;q.splitGames=function(b){var d=b.indexOf("[");-1==d&&(d=b.indexOf("1."));0<d&&(b=b.slice(d));var d=[],c=h(b);if(null==c)return[b];if("\r\n"===c){var e=b;if(0<=e.indexOf("\r\r")||0<=e.indexOf("\n\n"))b=b.replace(/\r\n/g,"\n"),b=b.replace(/\r/g,"\n"),c="\n"}for(var e=c+c+"[",c=2*c.length,f=0,g=b.indexOf(e,
f);-1!=g&&f<b.length;g=b.indexOf(e,f))f=b.substring(f,g),d.push(f),f=g+c;f<b.length&&(b=b.substring(f),d.push(b));return d};var t=/\[(\w+)\s+\"([\s\S]*?)\"\]/g,v=/^\s*$/;q.repair=function(b){var d=h(b);d||(d="\r\n");for(var c=new StringBuilder,e=t.lastIndex=0,f;f=t.exec(b);){var g=f.index,e=b.substring(e,g);v.test(e)||(c.append(d),c.append(e.trim()),c.append(d),c.append(d));var e=f[1],l=f[2],l=l.replace(/\r/g," "),l=l.replace(/\n/g," ");c.appendFormat('[{0} "{1}"]',e,l);c.append(d);e=g+f[0].length}b=
b.substring(e);v.test(b)||(c.append(d),c.append(b.trim()),c.append(d),c.append(d));return c.toString()};q.trustLegal=!0;q.parseGame=function(b){return b?(b=new CB.PGNLexer(b),(b=(new CB.PGNParser(b)).acceptGame())?f(b):null):new CB.Game};q.parseGameNoMoves=function(b){return b?(b=new CB.PGNLexer(b),(b=(new CB.PGNParser(b)).acceptGameNoMoves())?f(b):null):new CB.Game};q.parseHeader=function(b){b=new CB.PGNLexer(b);var c={};(new CB.PGNParser(b)).acceptHeaders(c);return c?d(c):null};return q}();
var PGN=CB.PGN;function PGNCommand(c,b){c||(c="");b||(b=[]);this.m_cmd=c;this.m_args=b}PGNCommand.prototype.init=function(c,b){this.m_cmd=c;PGNCommand.initArgs(b,this.m_args)};
PGNCommand.initArgs=function(c,b){c=c.replace(/[\n]/g," ");c=c.replace(/[\r]/g,"");var d=/(\".*?\")|([-\w\n]+),|([-:\w\n]+)$/g;d.lastIndex=0;var e;do if(e=d.exec(c)){var f=e[1]||e[2]||e[3];if(f)'"'===f[0]&&(f=f.substring(1),'"'===f[f.length-1]&&(f=f.substring(0,f.length-1))),b.push(f),d.lastIndex===e.index&&++d.lastIndex,e=0<=e.index;else break}else break;while(e)};PGNCommand.g_regexWhole=/\[%(\w+)((?:\"[^\"]*\"|[^\"\]]*)*)\]/;
PGNCommand.process=function(c,b){for(;c;){var d=PGNCommand.g_regexWhole.exec(c);if(d){var e=new PGNCommand,f=d[0];e.init(d[1],d[2]);b.push(e);c=c.substring(0,d.index)+c.substring(d.index+f.length)}else break}return c};"use strict";CB.PGNLocalization=ObjUtil.copyTo(CB.V1,{strProm:"="},!0);
CB.PGNWriter=function(){function c(b,d){b.appendFormat("[%{0}",d);if(arguments.length-2){b.append(" ");for(var c=2;c<arguments.length;++c){var e=arguments[c];2<c&&b.append(",");b.append(e)}}b.appendFormat("]")}function b(d,e,l){for(var q=0;q<e.length;++q){var r=e[q],t=r.getMoved(),v=d,y=l,A=0==q,w=r.getAnno();if(r.hasAnno()){var z=v,C=w[CB.AnnoType.PRETEXT];C&&(z.append("{"),z.append(C.getString()),z.append("} "))}z=r.getMoved();if(A||CB.Piece.side(z)===CB.Side.WHITE)v.append(y),v.append("."),CB.Piece.side(z)===
CB.Side.BLACK&&v.append(".."),v.append(" ");A=f.getMoveNota(r);v.append(A);v.append(" ");if(r.hasAnno()){A=v;if(z=w.getItem(CB.AnnoType.SYMBOL))for(var C=0,D=z.length;C<D;++C)A.appendFormat("${0} ",z[C]);z=w.count();w.hasItem(CB.AnnoType.SYMBOL)&&--z;w.hasItem(CB.AnnoType.PRETEXT)&&--z;if(z){A.append("{");if(C=w[CB.AnnoType.TIME]){var z=A,C=C.getTimeIn100th(),D=Math.floor(C/36E4),C=C-36E4*D,E=Math.floor(C/6E3);c(z,"emt",String.formatEx("{0}:{1}:{2}",D,E,Math.round((C-6E3*E)/100,1)))}(w=w[CB.AnnoType.POSTTEXT])&&
A.append(w.getString());A.append("} ")}}if(r.hasLines())for(A=0;A<r.getSubLinesCount();++A)v.append("("),w=r.getLine(A),b(v,w,y),v.append(")");CB.Piece.side(t)===CB.Side.BLACK&&++l}}function d(b,d,c){b.appendFormat('[{0} "{1}"]',d,c);b.append("\r\n")}var e={},f=new CB.NotationGenerator(CB.PGNLocalization);e.toPGN=function(c){var e=new StringBuilder,f=c.getHeader();d(e,"Event",f.getEvent());d(e,"White",f.getWhite());d(e,"Black",f.getBlack());d(e,"Site",f.getSite());d(e,"Round",f.getRoundStr());d(e,
"Annotator",f.getAnnotator());d(e,"Result",f.getCBResult().toPGNString());d(e,"Date",f.getDateStr());f.getEloWhite()&&d(e,"WhiteElo",f.getEloWhite());f.getEloBlack()&&d(e,"BlackElo",f.getEloBlack());d(e,"PlyCount",c.getMainLine().length);if(!c.isNormalInit()){d(e,"Setup",1);var q=c.getStartPos().toFEN();d(e,"FEN",q)}if(f=f.getClockParams())q=f.getStartSecs().toString(),f.incSecs&&(q+="+"+f.incSecs),d(e,"TimeControl",q);e.append("\r\n");f=1;c.isNormalInit()||(f=c.getStartPos().getMoveNum());b(e,c.getMainLine(),
f);e.append(c.hdr.getCBResult().toPGNString());e.append("\r\n");e.append("\r\n");return e.toString()};e.toUrlPGN=function(b){b=this.toPGN(b);for(var d=['Site "?"','Round "?"','Date "????.??.??"','Result "*"'],c=0;c<d.length;c++)b=b.replace("/["+d[c]+"/]/ig","");b=encodeURI(b);b=b.replace(/\.%20/ig,".");b=b.replace(/%0D%0A/ig,"%20");b=b.replace(/%20%20/ig,"%20");return b=b.replace(/%20%20/ig,"%20")};e.toFEN=function(b){var d=new StringBuilder;b=b.getCurPos().toFEN();d.append(b);return d.toString()};
return e}();"use strict";
CB.Database=function(){var c=function(){this.nGames=0;this.games=[];this.headers=[];this.nUsers=0;this.setStartGameIndex(0);this.setPageSize(200);this.filterText=""};c.prototype.setupListeners=function(b){};c.prototype.incUsers=function(){this.nUsers++};c.prototype.decUsers=function(){this.nUsers--};c.prototype.getNUsers=function(){return this.nUsers};c.prototype.getCopySrcId=function(){};c.prototype.beginUse=function(){this.manager&&this.manager.beginUse(this)};c.prototype.endUse=function(){this.manager&&
this.manager.endUse(this)};c.prototype.importGames=function(b,d){alert("not implemented")};c.prototype.isLoadFromFile=function(){return!0};c.prototype.canSaveTo=function(){return!1};c.prototype.shouldShowLastGame=function(){return!1};c.prototype.getGameCount=function(){return this.nGames};c.prototype.getDisplayTitle=function(){return"Database"};c.prototype.isSortable=function(){return this.isLoadFromFile()};c.prototype.getHeaderJson=function(b){return{gameNo:b,white:"Not available",black:"",event:"",
date:new CB.Date(0),result:"",eco:""}};c.prototype.loadHeadersJsonAsync=function(b,d,c){var f=[];for(CB.LOG("Headers Async: "+d+" - "+c);d<=c&&d<=this.getGameCount();d++){var g=this.getHeaderJson(d);f.push(g)}(new Ext.util.DelayedTask).delay(100,function(){b(f)})};c.prototype.getGame=function(b){return new CB.Game};c.prototype.loadGameAsync=function(b,d){var c=this.getGame(d);(new CB.Timer(function(){b(c)})).runOnce(10)};c.prototype.toggleDeleteMark=function(b){};c.prototype.toggleDeleteMarks=function(b){};
c.prototype.removeDeletedGames=function(){};c.prototype.setSubSet=function(b){this.subSet=b};c.prototype.clearSubSet=function(){delete this.subSet};c.prototype.getSetSize=function(){return this.subSet?this.subSet.length:this.getGameCount()};c.prototype.getGameNoInSet=function(b){return this.subSet&&b<=this.subSet.length&&0<b?this.subSet[b-1]:b};c.prototype.getSetInxOfGameNo=function(b){if(this.subSet)for(var d=0;d<this.subSet.length;d++){if(this.subSet[d]==b)return d+1}else return b};c.prototype.setFilter=
function(b){this.headers.filter(function(b){return void 0!==b}).length!=this.nGames&&this.manager?this.manager&&this.manager.requestFilterSet(this.getCopySrcId(),b):this.filterLocalHeaders(b)};c.prototype.clearFilter=function(){this.clearSubSet()};c.prototype.filterLocalHeaders=function(b){V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.showBusyMask("Searching locally ... ",null,2E4);b=new RegExp(b,"i");CB.LOG(b);CB.LOG(typeof b);for(var d=[],c=1;c<this.headers.length;c++)this.headers[c].matchesFilterVal(b)&&
d.push(this.headers[c].nGame);V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.hideBusyMask();this.setSubSet(d)};c.prototype.sortHeaders=function(b,d){};c.prototype.getPageSize=function(){return this.pageSize};c.prototype.setPageSize=function(b){1>b&&(b=1);this.pageSize=b};c.prototype.getStartGameIndex=function(){return this.startGameIndex};c.prototype.setStartGameIndex=function(b){0>b&&(b=0);this.startGameIndex=b};c.prototype.getEndGameIndex=function(){var b=this.getStartGameIndex()+this.getPageSize();
b>this.getSetSize()&&(b=this.getSetSize());return b};c.prototype.getPagedGamesHeadersJson=function(){for(var b=[],d=this.getStartGameIndex();d<this.getEndGameIndex();d++)if(this.subSet){if(this.subSet[d]<=this.getGameCount()){var c=this.getHeaderJson(this.subSet[d]);b.push(c)}}else c=this.getHeaderJson(d+1),b.push(c);return b};return c}();"use strict";
CB.PgnDatabase=function(){var c=function(b,d){this.pgn="";this.gameStrings=[];this.headers=[];this.games=[];this.loadFinished=!1;this.callbackOnLoaded=d;"string"==typeof b?this._fromText(b):(this._fromFile(b),this.fileName=b.name)};CB.inherit(c,CB.Database);c.prototype.getGameCount=function(){return this.gameStrings.length};c.prototype.getDisplayTitle=function(){return this.fileName};c.prototype.getCopySrcId=function(){return function(b){for(var d=[],c=0;c<b.length;c++){var f=this.getGame(b[c]);d.push(f)}return d}.bind(this)};
c.prototype.getHeaderJson=function(b){if(0>=b)return null;void 0===this.headers[b]&&b<this.gameStrings.length+1&&(this.headers[b]=PGN.parseHeader(this.gameStrings[b-1]));var d=this.headers[b];return d?(d.nGame=b,d.toJson()):this.superClass.getHeaderJson(b)};c.prototype.loadHeadersJsonAsync=function(b,d,c){if(this.loadFinished)this.loadHeadersImpl(b,d,c);else{var f=this.callbackOnLoaded;this.callbackOnLoaded=function(){f&&f(this);this.loadHeadersImpl(b,d,c)}.bind(this)}};c.prototype.loadHeadersImpl=
function(b,d,c){var f=[];for(CB.LOG("Headers Async: "+d+" - "+c);d<=c&&d<=this.getGameCount();d++){var g=this.getHeaderJson(d);f.push(g)}(new Ext.util.DelayedTask).delay(100,function(){b(f)})};c.prototype.getGame=function(b){return b?PGN.parseGame(this.gameStrings[b-1]):new CB.Game};c.prototype.importGames=function(b,d){alert("Sorry, you cannot save into a PGN database.")};c.prototype.toString=function(){for(var b="",d=1;d<=this.getGameCount();d++)var c=this.getGame(d),c=CB.PGNWriter.toPGN(c),b=b+
c;return b};c.prototype._fromText=function(b){this.gameStrings=PGN.splitGames(b);CB.LOG("Found in PGN "+this.gameStrings.length+" games");void 0!==this.callbackOnLoaded&&this.callbackOnLoaded(this);this.loadFinished=!0};c.prototype._fromFile=function(b){if("function"==typeof FileReader){var d=new FileReader;d.onloadend=function(){this._loadDone(d)}.bind(this);d.onerror=function(){this._loadError(d)}.bind(this);d.onprogress=function(){CB.LOG("On Progress")}.bind(this);d.onload=function(){CB.LOG("On Load")}.bind(this);
d.readAsText(b)}};c.prototype._loadDone=function(b){b.result&&(this.gameStrings=PGN.splitGames(b.result),CB.LOG("Found in PGN "+this.gameStrings.length+" games"),void 0!==this.callbackOnLoaded&&this.callbackOnLoaded(this));this.loadFinished=!0};c.prototype._loadError=function(b){alert("Could not load file, sorry");this.loadFinished=!0};c.prototype.loadHeaderIfMissing=function(b){this.headers[b]||(this.headers[b]=PGN.parseHeader(this.gameStrings[b-1]),this.headers[b].nGame=b)};c.prototype.filterLocalHeaders=
function(b){V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.showBusyMask("Searching locally ... ",null,2E4);b=new RegExp(b,"i");for(var d=[],c=1;c<=this.getGameCount();c++)this.loadHeaderIfMissing(c),this.headers[c].matchesFilterVal(b)&&d.push(this.headers[c].nGame);V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.hideBusyMask();this.setSubSet(d)};c.prototype.sortHeaders=function(b,d){V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.showBusyMask("Sorting ... ",null,2E4);for(var c=[],f=0;f<this.getSetSize();f++){var g=
this.subSet?this.subSet[f]:f+1;this.loadHeaderIfMissing(g);c[f]=this.headers[g]}(function(b,d,c){b=b.sort(function(b,e){return c?b[d]>e[d]?1:b[d]<e[d]?-1:0:e[d]>b[d]?1:e[d]<b[d]?-1:0})})(c,b,d);g=[];for(f=0;f<c.length;f++)g.push(c[f].nGame);this.setSubSet(g);V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.hideBusyMask()};return c}();"use strict";CB.StreamingItemType={NONE:0,WMV:1,MP4:2,SMOOTHSTREAMING:4,THUMB:8,META:16,GAMEACTIONS:32,MPEGDASH:64,HLSV3:128,HLSV4:256};
CB.BroadcastStreamingItemEx=function(){var c=function(b,d){this.strUrl=b;this.type=d};c.prototype.fromDataBuf=function(b){this.strUrl=b.Vq(2048);this.type=b.V10()};return c}();"use strict";CB.StreamingDataFlags={NONE:0,LIVE:1};
CB.BroadcastStreamingDataEx=function(){var c=function(){this.items=[]};c.prototype.add=function(b){this.items.push(b)};c.prototype.fromDataBuf=function(b){this.nGameId=b.V10();for(var d=b.V10(),c=0;c<d;c++){var f=new CB.BroadcastStreamingItemEx;f.fromDataBuf(b);this.items.push(f)}this.nFlags=b.V10();this.nCosts=b.V10()};c.prototype.isLive=function(){return this.nFlags&CB.StreamingDataFlags.LIVE};c.prototype.getURL=function(b){for(var d="",c=0;c<this.items.length;c++)b&this.items[c].type&&(d=this.items[c].strUrl);
return d};return c}();"use strict";CB.ChatStreamData=function(){var c=function(){};c.prototype.read=function(b){b.rewind();try{this.strMsg=b.V6(4096)}catch(d){CB.LogException("ChatStreamData Msg Len exception")}this.m_eWeight=b.V11();this.m_eColName=b.V11();this.m_eReserved=b.V11();this.m_eEmosound=b.V11();this.m_nFlags=b.V10();this.m_nTotalReceivers=b.V10();this.m_nChannel=b.V10();this.m_nReserved=b.V10();this.m_strSenderName=b.V6(50)};return c}();"use strict";
var RecorderState={RecordStopped:0,RecordNormal:1,RecordSolution:2,RecordGoodMove:3,RecordOtherMoves:4,RecordOtherMovesNoVideo:5};CB.MediaPlayerType={MediaPlayerUnknown:0,MediaPlayerWMV:1,MediaPlayerFlash:2,MediaPlayerHTML:3,MediaPlayerSL:4,MediaPlayerMPEGDASH:5,MediaPlayerAzure:6};
CB.VideoManager=function(){var c=CB.MediaPlayerType.MediaPlayerUnknown,b=0,d=function(b,d,g,h,l){this.videoUrl="";this.playerInstance=b;this.playerAuthenticated=!1;this.onGameActionHdl=h;this.onEndOfVideoHdl=l;this.gameActions=[];this.chatActions=[];this.el=g;this.gameHeaderStr="";CB.$(this.el).html("<div id='wmpHolder"+b+"' style='height:100%;'><iframe  style='width:100%;height:100%;' src='https://en.chessbase.com/playchess2/events.aspx/video'></iframe></div>");this.baseurl=V15.config.getVideoPortalUris()[0];
c=d;this.determineBrowser()};d.prototype.cleanUp=function(){this.remove("MediaPlayer1")};d.prototype.remove=function(b){(b=document.getElementById(b))&&b.parentNode.removeChild(b)};d.prototype.getPlayerType=function(){return c};d.prototype.detectWMP=function(){};d.prototype.getWidth=function(){if(c==CB.MediaPlayerType.MediaPlayerAzure){var b=amp("azuremediaplayer");if(b)return b.width()}return 0};d.prototype.getHeight=function(){if(c==CB.MediaPlayerType.MediaPlayerAzure){var b=amp("azuremediaplayer");
if(b)return b.height()}return 0};d.prototype.determineBrowser=function(){switch(c){case CB.MediaPlayerType.MediaPlayerAzure:this.prepareAzure();break;case CB.MediaPlayerType.MediaPlayerUnknown:this.prepareLegacy()}};d.prototype.prepareAzure=function(){c==CB.MediaPlayerType.MediaPlayerAzure&&this.setupAzureMediaPlayer()};d.prototype.prepareLegacy=function(){window.chrome&&window.chrome.webstore?this.setupHLS():CB.System.isMobile()?this.setupHTML():!this.isWindows()&&CB.System.isWebKit()?this.setupHTML():
this.isWindows()?CB.System.isActivexEnabled()?(this.detectWMP(),null!=this.P&&this.P.version?this.setupWMV():this.setupHelp()):this.setupHLS():this.setupHTML()};d.prototype.isMp4Client=function(){var b=!1;CB.System.isActivexEnabled()&&(this.detectWMP(),null!=this.P&&this.P.version&&(b=!0));return!b};d.prototype.generateHTMLPlayer=function(b,d,c,h){b=document.getElementById(b);h='<video src="'+h+'" controls autoplay></video>';b&&(b.innerHTML=h);h=document.getElementsByTagName("video")[0];h.addEventListener("loadeddata",
function(){}.bind(this));h.addEventListener("ended",function(){setTimeout(this.callGetNextIdAtEnd.bind(this),500)}.bind(this));return b};d.prototype.generateSLPlayer=function(b,d,c){};d.prototype.onError=function(){alert("onError")};d.prototype.generateHTMLHelp=function(b){if(b=document.getElementById(b))b.innerHTML='For instructions click on the <a href="http://play.chessbase.com/js/apps/playchess/playchesscms.html">link</a>';return b};d.prototype.stop=function(){if(c==CB.MediaPlayerType.MediaPlayerWMV){var b=
document.getElementById("MediaPlayer1");null!=b&&null!=b.controls&&b.controls.stop()}};d.prototype.isWindows=function(){return-1!=navigator.appVersion.indexOf("Win")};d.prototype.autoPlay=function(){var b=CB.strUtil.getURLParam("autoplay"),d=!0;null!=b&&0<b.length&&(d="false"!=b);return d};d.prototype.generateAzureMediaPlayer=function(b,d,c,h){var l=this.autoPlay();this.videoUrl=h;CB.System.runsInIFrame()&&(l=!1);var q=CB.Language.getStrUserLanguage();b=document.getElementById(b);var r=document.getElementById("azuremediaplayer"+
this.playerInstance);if(h&&0<h.length){if(null==r){var t={nativeControlsForTouch:!1,language:q,autoplay:l,controls:!0,width:c,height:d,poster:"",logo:{enabled:!1}};CB.System.isWebKit()&&(t={nativeControlsForTouch:!1,language:q,techOrder:["azureHtml5JS","html5","flashSS","silverlightSS"],controls:!0,autoplay:l,width:c,height:d,poster:"",logo:{enabled:!1}});d="azuremediaplayer"+this.playerInstance;b.innerHTML=l?"<video  webkit-playsinline='true' playsinline='true' id='"+d+"' class='azuremediaplayer amp-default-skin' controls autoplay amp-big-play-centered tabindex='0'> </video>":
"<video  webkit-playsinline='true' playsinline='true' id='"+d+"' class='azuremediaplayer amp-default-skin' controls amp-big-play-centered tabindex='0'> </video>";r=amp("azuremediaplayer"+this.playerInstance,t);amp("azuremediaplayer"+this.playerInstance).src([{src:h,type:"application/vnd.ms-sstr+xml"}]);amp("azuremediaplayer"+this.playerInstance).ready(function(){CB.$(".amp-logo")&&CB.$(".amp-logo").remove();CB.System.isIPhone()||CB.System.isIPad()||CB.System.runsInIFrame()||r.play()});r.addEventListener("error",
function(){var b=r.error();if(b){var d=b.code>>28,b=(b.code&8388607)>>23;if(!CB.System.isIPhone()&&!CB.System.isIPad()){var c=this.getAzureError(r);alert("Sorry, There is a problem with the Video Player: "+c+d+","+b)}}}.bind(this));amp("azuremediaplayer"+this.playerInstance).removeEventListener("loadeddata");amp("azuremediaplayer"+this.playerInstance).addEventListener("loadeddata",function(){this.startTimer();this.getStartTimeFromDB()}.bind(this));amp("azuremediaplayer"+this.playerInstance).removeEventListener("loadedmetadata");
amp("azuremediaplayer"+this.playerInstance).addEventListener("loadedmetadata",function(){}.bind(this));amp("azuremediaplayer"+this.playerInstance).isLive()||(amp("azuremediaplayer"+this.playerInstance).removeEventListener("ended"),amp("azuremediaplayer"+this.playerInstance).addEventListener("ended",function(){this.onEndOfVideoHdl(this.playerInstance,this.currentvideoid)}.bind(this)))}amp("azuremediaplayer"+this.playerInstance).src([{src:h,type:"application/vnd.ms-sstr+xml"}]);CB.System.isIPhone()||
CB.System.isIPad()||l&&(CB.System.runsInIFrame()||amp("azuremediaplayer"+this.playerInstance).play());amp("azuremediaplayer"+this.playerInstance).controls(!0);amp("azuremediaplayer"+this.playerInstance).options({logo:{enabled:!1}})}return b};d.prototype.getAzureError=function(b){var d="Unknown Error: ";b.error().code&amp.errorCode.abortedErrStart?d="MEDIA_ERR_ABORTED: ":b.error().code&amp.errorCode.networkErrStart?d="MEDIA_ERR_NETWORK: ":b.error().code&amp.errorCode.decodeErrStart?d="MEDIA_ERR_DECODE: ":
b.error().code&amp.errorCode.srcErrStart?d="MEDIA_ERR_SRC_NOT_SUPPORTED: ":b.error().code&amp.errorCode.encryptErrStart?d="MEDIA_ERR_ENCRYPTED errors: ":b.error().code&amp.errorCode.srcPlayerMismatchStart&&(d="SRC_PLAYER_MISMATCH error: ");return d};d.prototype.setupAzureMediaPlayer=function(){c=CB.MediaPlayerType.MediaPlayerAzure};d.prototype.setupNanoPlayer=function(){this.generateNanoPlayer("wmpHolder",240,320)};d.prototype.setupHTML=function(){CB.LOG("Setup HTML");c=CB.MediaPlayerType.MediaPlayerHTML};
d.prototype.setupSL=function(b){};d.prototype.setupAzure=function(b){var d=320,c=320;if(!CB.$.get("azuremediaplayer"+this.playerInstance)){var h=this.generateHTMLHelp("wmpHolder"+this.playerInstance);h&&h.offsetParent&&(c=h.offsetParent.clientWidth,d=h.offsetParent.clientHeight)}CB.System.isHTTPS()&&(b=b.replace("http://","https://"));this.htmlHolder=this.generateAzureMediaPlayer("wmpHolder"+this.playerInstance,d,c,b)};d.prototype.setupHelp=function(){this.generateHTMLHelp("wmpHolder")};d.prototype.reportChannel=
function(b){CB.LOG("RadionManager::ReportChannel");c==CB.MediaPlayerType.MediaPlayerHTML?(this.htmlHolder=this.generateHTMLPlayer("wmpHolder",240,320,"http://video.chessbase.com/js/hls"+b.sChannel+"/hls0.m3u8"),document.getElementsByTagName("video")[0].play()):c==CB.MediaPlayerType.MediaPlayerFlash&&(this.nChannel=b.sChannel,jwplayer("wmpHolder").load([{file:"http://video.chessbase.com/js/hls"+b.sChannel+"/hls2.m3u8"}]))};d.prototype.onLoadChat=function(b){b=JSON.parse(b);if(b.length)for(var d=0;d<
b.length;d++){var c=b[d],h=new CB.ScriptCommand;h.time=c.Time;h.type=c.GameActionType;h.action=c.GameActionContent;this.chatActions.push(h)}};d.prototype.onCurGameChanged=function(){var b=this.gameKernel.getCurPos();if(this.cachepos)for(var d=0;d<this.cachepos.length;d++)if(b.equals(this.cachepos[d])){this.setStartTime(this.cachetime[d]);break}};d.prototype.b64_to_utf8=function(b){return decodeURIComponent(escape(window.atob(b)))};d.prototype.reportBroadcastStreamingData=function(b){CB.LOG("RadionManager::reportBroadcastStreamingData ");
if(c==CB.MediaPlayerType.MediaPlayerWMV){b=b.getURL(CB.StreamingItemType.WMV);var d=document.getElementById("MediaPlayer1");d&&(d.URL=b,d.data=b)}else if(c==CB.MediaPlayerType.MediaPlayerAzure)b=b.getURL(CB.StreamingItemType.SMOOTHSTREAMING),0<b.length&&this.setupAzure(b);else if(c!=CB.StreamingItemType.SMOOTHSTREAMING)if(c==CB.MediaPlayerType.MediaPlayerHTML){b=b.getURL(CB.StreamingItemType.MP4);this.htmlHolder=this.generateHTMLPlayer("wmpHolder",240,320);if(d=document.getElementsByTagName("video")[0])d.src=
b;d.play();this.doResize(d.offsetParent.clientWidth,d.offsetParent.clientHeight)}else c==CB.MediaPlayerType.MediaPlayerFlash&&(b=b.getURL(CB.StreamingItemType.MP4),jwplayer("wmpHolder").setup({file:b,image:"http://shop.chessbase.com/pics/p_6251",autostart:!0,width:"100%",height:"90%"}))};d.prototype.doResize=function(b,d){if(c==CB.MediaPlayerType.MediaPlayerAzure){if(document.getElementById("azuremediaplayer"+this.playerInstance)){var g=amp("azuremediaplayer"+this.playerInstance);g&&(g.height(),g.height(d),
g.width(b))}}else if(c==CB.MediaPlayerType.MediaPlayerHTML){if(g=document.getElementsByTagName("video")[0])g.height=d,g.width=b}else if(g=document.getElementById("MediaPlayer1"))g.width=b,g.height=d;c==CB.MediaPlayerType.MediaPlayerFlash&&jwplayer("wmpHolder").resize(b,d-40)};d.prototype.onSync=function(b){document.getElementById("MediaPlayer1")};d.prototype.onScriptCommand=function(b,d){null!=this.gameKernel&&this.gameKernel.executeGameAction(b,d);if(null!=this.watchSessions)this.watchSessions.onGameActionFromStream(b,
d)};d.prototype.getCurrentTime=function(){if(c==CB.MediaPlayerType.MediaPlayerAzure)try{var b=amp("azuremediaplayer"+this.playerInstance);if(b&&b.currentTime)return b.currentTime()}catch(d){return-1}else if(c==CB.MediaPlayerType.MediaPlayerWMV){if(b=document.getElementById("MediaPlayer1"),b.controls&&b.controls.currentPosition)return b.controls.currentPosition}else{if(c==CB.MediaPlayerType.MediaPlayerHTML)return document.getElementsByTagName("video")[0].currentTime;if(c!=CB.MediaPlayerType.MediaPlayerSL&&
c==CB.MediaPlayerType.MediaPlayerFlash)return this.currenttime=jwplayer("wmpHolder").getPosition()}return 0};d.prototype.mustExecute=function(b,d){return b>=d&b<d+1};d.prototype.CMSGameActionsHandler=function(d){d=this.getCurrentTime();this.onGameActionHdl(this.playerInstance,d);var c=!1;if(!this.endEventFired){for(l=0;l<this.chatActions.length;l++)if(this.mustExecute(this.chatActions[l].time,d)){var g=this.chatActions[l].action;if(g){var h=new CB.DataBuffer;h.constructFromString(g,!0);h.rewind();
(new CB.ChatStreamData).read(h)}}for(var l=0;l<this.gameActions.length;l++)if(this.mustExecute(this.gameActions[l].time,d)){if(0!=d)this.onScriptCommand(this.gameActions[l].type,this.gameActions[l].action);c=!0;if(60<=d-b){if(g=CB.$.get("videoid")){g=g.innerHTML;h=Math.floor(d)/60;h=Math.floor(h);this.endEventFired=!1;var q="",r=CB.$.get("userid");r&&(q=encodeURIComponent(r.innerHTML));1<h&&(CB.AJAX.load(this.baseurl+"Replay/AddSnippetViewed?id="+encodeURIComponent(g)+"&time="+h+"&user="+q,this.onSnippetViewed.bind(this),
{responseType:"text"}),0!=this.gameHeaderStr.localeCompare(this.gameKernel.game.hdr.toString())&&(this.gameHeaderStr=this.gameKernel.game.hdr.toString(),this.gameKernel.Vk.saveToCloud(!0)))}b=d}}else if(c)break}};d.prototype.saveToCloud=function(){V15.cloudMgr&&V15.cloudMgr.isLoggedIn()&&V15.cloudMgr.saveGameToClipboard(this.gameKernel.game)};d.prototype.showTimedMessage=function(b,d){V15.panelMgr.showMessage(b);this.gameKernel.boardWin.addMessage(b,!0);(new CB.Timer(function(){this.gameKernel.boardWin.destroyMessage()}.bind(this))).runOnce(d)};
d.prototype.showMessage=function(b){V15.panelMgr.showMessage(b);this.gameKernel.boardWin.addMessage(b,!0);(new CB.Timer(function(){this.gameKernel.boardWin.destroyMessage()}.bind(this))).runOnce(3E3)};d.prototype.onNextVideo=function(b){b=JSON.parse(b);var d=b.ID,c=b.MSG;2<c.length?this.showMessage(c):(b=b.STATE,"3"==b?(this.showMessage("please try again"),this.gameKernel.Vk.restoreMoveEnterPosition()):2<d.length&&("5"==b?window.location.href=this.baseurl+"Replay/Video?id="+d:(CB.$.set("videoid",
d),this.loadVideoFromId(d))))};d.prototype.playSolution=function(b){this.showMessage("Solution");b=this.baseurl+"Replay/GetSolution?id="+encodeURIComponent(b);CB.AJAX.load(b,this.onGetSolution.bind(this),{responseType:"text"})};d.prototype.onGetSolution=function(b){b=JSON.parse(b);var d=b.ID;b=b.MSG;2<b.length?this.showMessage(b):this.loadVideoFromId(d)};d.prototype.disable=function(){amp("azuremediaplayer"+this.playerInstance).pause();amp("azuremediaplayer"+this.playerInstance).controls(!1)};d.prototype.onSnippetViewed=
function(b){b=JSON.parse(b);c!=CB.MediaPlayerType.MediaPlayerAzure||this.playerAuthenticated||(0!=b.localeCompare("Ok")?(CB.$.set("videoid",""),0==b.localeCompare("Expert")?this.gameKernel.boardWin.addMessage("You have to purchase this video in order to watch it",!0):this.gameKernel.boardWin.addMessage("Please login with your Premium account",!0)):this.playerAuthenticated=!0)};d.prototype.renderPartial=function(b){b="Replay/RenderPartial?id="+encodeURIComponent(b);var d=new XMLHttpRequest;d.open("POST",
this.baseurl,!0);d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.onload=function(){};d.send(b)};d.prototype.restart=function(){var b=amp("azuremediaplayer"+this.playerInstance);b&&b.currentTime(0)};d.prototype.setStartTime=function(b){if("0"!=b)if(c==CB.MediaPlayerType.MediaPlayerAzure){var d=amp("azuremediaplayer"+this.playerInstance);d&&d.currentTime(1*b)}else c==CB.MediaPlayerType.MediaPlayerWMV?(d=document.getElementById("MediaPlayer1"),
d.controls&&d.controls.currentPosition&&(d.controls.currentPosition=b)):c==CB.MediaPlayerType.MediaPlayerHTML&&(document.getElementsByTagName("video")[0].currentTime=b);c==CB.MediaPlayerType.MediaPlayerAzure&&(CB.System.runsInIFrame()||this.play())};d.prototype.loadVideoFromId=function(b){this.currentvideoid=b;$.get(this.baseurl+"Replay/GetAllSmoothStreaming?id="+b,function(b){if(b){for(var d=new CB.BroadcastStreamingDataEx,c=0;c<b.length;c++){var e=b[c].URLType,q=b[c].URL;"SS"==e?(e=CB.strUtil.base64.decode(q),
e=new CB.BroadcastStreamingItemEx(e,CB.StreamingItemType.SMOOTHSTREAMING),d.add(e)):"WMV"==e?(e=CB.strUtil.base64.decode(q),e=new CB.BroadcastStreamingItemEx(e,CB.StreamingItemType.WMV),d.add(e)):"MP4"==e?(e=CB.strUtil.base64.decode(q),e=new CB.BroadcastStreamingItemEx(e,CB.StreamingItemType.MP4),d.add(e)):"GA"==e&&(e=CB.strUtil.base64.decode(q),e=new CB.BroadcastStreamingItemEx(e,CB.StreamingItemType.GAMEACTIONS),d.add(e))}"function"==typeof getAllFinished&&getAllFinished();this.reportBroadcastStreamingData(d)}}.bind(this)).fail(function(){}.bind(this))};
d.prototype.startTimer=function(){this.currenttime=0;null==this.myTimer&&(this.myTimer=setInterval(this.CMSGameActionsHandler.bind(this),1E3))};d.prototype.getStartTimeFromDB=function(){var b=CB.strUtil.getURLParam("gotopos");if(b){var d=CB.strUtil.getURLParam("id");d&&this.currentvideoid===d&&(new CB.Timer(function(){this.setStartTime(b)}.bind(this))).runOnce(1E3)}else{var c=CB.$.get("gotopos");if(c&&"0"!=c.innerHTML)(d=CB.$.get("videoid"))&&this.currentvideoid===d&&(new CB.Timer(function(){this.setStartTime(c.innerHTML)}.bind(this))).runOnce(1E3);
else if(this.currentvideoid){var d=this.currentvideoid,h="";if(h=CB.$.get("userid"))h=h.innerHTML,d=this.baseurl+"Replay/GetStartTime?id="+encodeURIComponent(d)+"&user="+encodeURIComponent(h),$.get(d,function(b){b&&this.setStartTime(b)}.bind(this)).fail(function(){}.bind(this))}}};d.prototype.onWMV=function(b){b=b.substring(1,b.length-2);alert(b);b=CB.strUtil.base64.decode(b);var d=new CB.BroadcastStreamingDataEx;b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.WMV);d.add(b);this.reportBroadcastStreamingData(d)};
d.prototype.onGA=function(b){b=b.substring(1,b.length-2);alert(b);b=CB.strUtil.base64.decode(b);var d=new CB.BroadcastStreamingDataEx;b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.GAMEACTIONS);d.add(b);this.reportBroadcastStreamingData(d)};d.prototype.onMP4=function(b){b=b.substring(1,b.length-2);alert(b);b=CB.strUtil.base64.decode(b);var d=new CB.BroadcastStreamingDataEx;b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.MP4);d.add(b);this.reportBroadcastStreamingData(d)};d.prototype.pause=
function(){amp("azuremediaplayer"+this.playerInstance).pause()};d.prototype.play=function(){if(amp&&this.playerInstance&&this.videoUrl){var b=amp("azuremediaplayer"+this.playerInstance);b&&b.play()}};d.prototype.autoTest=function(){amp("azuremediaplayer"+this.playerInstance).pause();this.autoTest=new CB.RadioTestManager(this.gameKernel);this.autoTest.start()};return d}();"use strict";
CB.VideoElement=function(){var c=function(b,d,c,f,g){this.aMediaplayer=CB.MediaPlayerType.MediaPlayerAzure;this.nInPage=b;this.hasListeners=!1;this.fnGetKernel=d;this.ticket=c;this.gaHandler=f;this.endvideoHandler=g;this.initState()};c.prototype.initElem=function(b){this.videoManager=new CB.VideoManager(this.nInPage,this.aMediaplayer,b,this.gaHandler,this.endvideoHandler)};c.prototype.initState=function(){};c.prototype.clear=function(){};c.prototype.onNewGame=function(){};c.prototype.resize=function(b,
d){this.videoManager.doResize(b,d)};c.prototype.disable=function(){this.videoManager.disable()};Ve.initForListeners(c);return c}();CB.VideoElement.factory=function(c,b,d,e,f,g){b=new CB.VideoElement(b||0,d,e,f,g);b.initElem(c);return b};"use strict";
CB.LiveVideoManager=function(){var c="",b=function(b,c,f){this.onGameActionHdl=f;this.el=c;c=CB.$(this.el);this.nInstance=b;b="wmpHolder"+b;c.html("<div id='"+b+"' style='width:100%;height:100%;'></div>");this.name=b};b.prototype.setUrl=function(b){c=b;this.player&&this.player.pause();b="wmpHolder"+this.nInstance;this.remove(b);CB.$(this.el).html("<div id='"+b+"' style='width:100%;height:100%;'></div>");this.player=null;(new CB.Timer(function(){this.generateLivePlayer(this.name,200,800)}.bind(this))).runOnce(500)};
b.prototype.cleanUp=function(){this.remove(this.myRadio)};b.prototype.remove=function(b){(b=document.getElementById(b))&&b.parentNode.removeChild(b)};b.prototype.generateLivePlayer=function(b,c,f){this.generateNanoPlayer(b,c,f)};b.prototype.generateNanoPlayer=function(b,e,f){e={source:{bintu:{apiurl:"https://bintu.nanocosmos.de:443",streamid:c}},playback:{autoplay:!0,muted:!1,metadata:!0},events:{onReady:function(b){},onPlay:function(b){},onPause:function(b){},onLoading:function(b){},onStartBuffering:function(b){},
onStopBuffering:function(b){},onStats:function(b){},onError:function(b){try{b&&b.data&&b.data.message||JSON.stringify(b)}catch(d){}},onMetaData:function(b){if(b.data.handlerName&&"onCuePoint"===b.data.handlerName)this.onMetaData(b.data.message)}.bind(this)}};this.player||(this.player=new NanoPlayer(this.name));this.player.instance=this;this.player.setup(e).then(function(b){try{JSON.stringify(b)}catch(d){alert(d)}},function(b){alert(b);try{var d=JSON.stringify(b);"{}"===d&&(d=b.message);b=d}catch(c){}document.getElementById("status").innerText=
"Setup Error: "+b});return b};b.prototype.onMetaData=function(b){this.onGameActionHdl(b,this.nInstance)};b.prototype.onCurGameChanged=function(){var b=this.gameKernel.getCurPos();if(this.cachepos)for(var c=0;c<this.cachepos.length;c++)b.equals(this.cachepos[c])&&this.setStartTime(this.cachetime[c])};b.prototype.b64_to_utf8=function(b){return decodeURIComponent(escape(window.atob(b)))};b.prototype.doResize=function(b,c){var f=document.getElementById("wmpHolder0");f&&(f.style.height=c+"px",f.style.width=
b+"px")};b.prototype.onSync=function(b){document.getElementById("MediaPlayer1")};b.prototype.onScriptCommand=function(b,c){null!=this.gameKernel&&this.gameKernel.executeGameAction(b,c);if(null!=this.watchSessions)this.watchSessions.onGameActionFromStream(b,c)};b.prototype.play=function(){this.player&&this.player.play()};b.prototype.stop=function(){this.player?this.player.pause():alert("player not found (stop)")};b.prototype.showMessage=function(b){V15.panelMgr.showMessage(b);this.gameKernel.boardWin.addMessage(b,
!0);(new CB.Timer(function(){this.gameKernel.boardWin.destroyMessage()}.bind(this))).runOnce(3E3)};b.prototype.onAll=function(b){};return b}();"use strict";
CB.LiveVideoElement=function(){var c=function(b,d,c,f,g){this.aMediaplayer=CB.MediaPlayerType.MediaPlayerAzure;this.nInPage=b;this.hasListeners=!1;this.fnGetKernel=d;this.ticket=c;this.gaHandler=f;this.endvideoHandler=g;this.initState()};c.prototype.initElem=function(b){this.videoManager=new CB.LiveVideoManager(this.nInPage,b,this.gaHandler)};c.prototype.initState=function(){};c.prototype.clear=function(){};c.prototype.onNewGame=function(){};c.prototype.resize=function(b,d){this.videoManager.doResize(b,
d)};c.prototype.disable=function(){this.videoManager.disable()};c.prototype.setUrl=function(b){this.videoManager.setUrl(b)};Ve.initForListeners(c);return c}();CB.LiveVideoElement.factory=function(c,b,d,e,f){b=new CB.LiveVideoElement(b||0,d,e,f);b.initElem(c);return b};"use strict";RecorderState={RecordStopped:0,RecordNormal:1,RecordSolution:2,RecordGoodMove:3,RecordOtherMoves:4,RecordOtherMovesNoVideo:5};
CB.OfflineVideoManager=function(){var c=CB.MediaPlayerType.MediaPlayerUnknown,b=function(b,e,f,g,h){this.playerInstance=b;this.playerAuthenticated=!1;this.onGameActionHdl=g;this.onEndOfVideoHdl=h;this.gameActions=[];this.chatActions=[];this.el=f;this.gameHeaderStr="";CB.$(this.el).html("<div id='wmpHolder"+b+"'></div>");c=e;this.determineBrowser()};b.prototype.cleanUp=function(){this.remove("MediaPlayer1")};b.prototype.remove=function(b){(b=document.getElementById(b))&&b.parentNode.removeChild(b)};
b.prototype.getPlayerType=function(){return c};b.prototype.determineBrowser=function(){this.prepareAzure()};b.prototype.prepareAzure=function(){this.setupAzureMediaPlayer()};b.prototype.isMp4Client=function(){var b=!1;CB.System.isActivexEnabled()&&(this.detectWMP(),null!=this.P&&this.P.version&&(b=!0));return!b};b.prototype.generateHTMLPlayer=function(b,c,f,g){this.currentvideoid=g;b=document.getElementById(b);g='<video controls playsinline autoplay poster="static/poster.png" id="video" src="'+g+
'" type="video/mp4"></video>';b&&(b.innerHTML=g);var h=document.getElementsByTagName("video")[0];h&&(h.load(),h.addEventListener("loadeddata",function(){this.startTimer();CB.System.isElectron()||h.play()}.bind(this)),h.onloadstart=function(){this.showMessage("loading...");CB.System.isElectron()||h.play()}.bind(this),h.onprogress=function(){this.showMessage("downloading...")}.bind(this),h.onwaiting=function(){this.showMessage("waiting...")}.bind(this),h.addEventListener("ended",function(){this.onEndOfVideoHdl(this.playerInstance,
this.currentvideoid)}.bind(this)),CB.System.isElectron()||h.play());return b};b.prototype.generateSLPlayer=function(b,c,f){};b.prototype.onError=function(){alert("onError")};b.prototype.generateHTMLHelp=function(b){if(b=document.getElementById(b))b.innerHTML='For instructions click on the <a href="http://play.chessbase.com/js/apps/playchess/playchesscms.html">link</a>';return b};b.prototype.stop=function(){var b=document.getElementsByTagName("video")[0];b&&(b.paused||b.pause())};b.prototype.getDuration=
function(){var b=0,c=document.getElementsByTagName("video")[0];c&&(b=c.duration);return b};b.prototype.isWindows=function(){return-1!=navigator.appVersion.indexOf("Win")};b.prototype.autoPlay=function(){var b=CB.strUtil.getURLParam("autoplay"),c=!0;null!=b&&0<b.length&&(c="false"!=b);return c};b.prototype.disable=function(){var b=document.getElementById("wmpHolder0");b&&(b.innerHTML='<video controls type="video/mp4"></video>')};b.prototype.setupAzureMediaPlayer=function(){c=CB.MediaPlayerType.MediaPlayerAzure};
b.prototype.setupHTML=function(){CB.LOG("Setup HTML");c=CB.MediaPlayerType.MediaPlayerHTML};b.prototype.setupSL=function(b){};b.prototype.setupAzure=function(b){this.htmlHolder=this.generateHTMLPlayer("wmpHolder"+this.playerInstance,320,320,b)};b.prototype.onCurGameChanged=function(){var b=this.gameKernel.getCurPos();if(this.cachepos)for(var c=0;c<this.cachepos.length;c++)if(b.equals(this.cachepos[c])){this.setStartTime(this.cachetime[c]);break}};b.prototype.b64_to_utf8=function(b){return decodeURIComponent(escape(window.atob(b)))};
b.prototype.setUrl=function(b){this.setupAzure(b)};b.prototype.doResize=function(b,e){if(c==CB.MediaPlayerType.MediaPlayerAzure){var f=document.getElementsByTagName("video")[0];f&&(f.height=e,f.width=b)}};b.prototype.onSync=function(b){document.getElementById("MediaPlayer1")};b.prototype.onScriptCommand=function(b,c){null!=this.gameKernel&&this.gameKernel.executeGameAction(b,c);if(null!=this.watchSessions)this.watchSessions.onGameActionFromStream(b,c)};b.prototype.getCurrentTime=function(){var b=
document.getElementsByTagName("video")[0];return b?b.currentTime:0};b.prototype.setCurrentTime=function(b){var c=document.getElementsByTagName("video")[0];c&&(c.currentTime=b)};b.prototype.mustExecute=function(b,c){return b>=c&b<c+1};b.prototype.CMSGameActionsHandler=function(b){b=this.getCurrentTime();this.onGameActionHdl(this.playerInstance,b)};b.prototype.saveToCloud=function(){V15.cloudMgr&&V15.cloudMgr.isLoggedIn()&&V15.cloudMgr.saveGameToClipboard(this.gameKernel.game)};b.prototype.showTimedMessage=
function(b,c){V15.panelMgr.showMessage(b);this.gameKernel.boardWin.addMessage(b,!0);(new CB.Timer(function(){this.gameKernel.boardWin.destroyMessage()}.bind(this))).runOnce(c)};b.prototype.showMessage=function(b){V15.panelMgr.showMessage(b);this.gameKernel&&(this.gameKernel.boardWin.addMessage(b,!0),(new CB.Timer(function(){this.gameKernel.boardWin.destroyMessage()}.bind(this))).runOnce(3E3))};b.prototype.startTimer=function(){this.currenttime=0;null==this.myTimer&&(this.myTimer=setInterval(this.CMSGameActionsHandler.bind(this),
1E3))};b.prototype.onWMV=function(b){b=b.substring(1,b.length-2);b=CB.strUtil.base64.decode(b);var c=new CB.BroadcastStreamingDataEx;b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.WMV);c.add(b);this.reportBroadcastStreamingData(c)};b.prototype.onGA=function(b){b=b.substring(1,b.length-2);b=CB.strUtil.base64.decode(b);var c=new CB.BroadcastStreamingDataEx;b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.GAMEACTIONS);c.add(b);this.reportBroadcastStreamingData(c)};b.prototype.onMP4=
function(b){b=b.substring(1,b.length-2);b=CB.strUtil.base64.decode(b);var c=new CB.BroadcastStreamingDataEx;b=new CB.BroadcastStreamingItemEx(b,CB.StreamingItemType.MP4);c.add(b);this.reportBroadcastStreamingData(c)};b.prototype.pause=function(){var b=document.getElementsByTagName("video")[0];b&&(b.paused?b.play():b.pause())};b.prototype.play=function(){var b=document.getElementsByTagName("video")[0];b&&b.play()};return b}();"use strict";
CB.OfflineVideoElement=function(){var c=function(b,d,c,f,g){this.aMediaplayer=CB.MediaPlayerType.MediaPlayerAzure;this.nInPage=b;this.hasListeners=!1;this.fnGetKernel=d;this.ticket=c;this.gaHandler=f;this.endvideoHandler=g;this.initState()};c.prototype.initElem=function(b){this.videoManager=new CB.OfflineVideoManager(this.nInPage,this.aMediaplayer,b,this.gaHandler,this.endvideoHandler)};c.prototype.initState=function(){};c.prototype.clear=function(){};c.prototype.onNewGame=function(){};c.prototype.resize=
function(b,d){this.videoManager.doResize(b,d)};c.prototype.disable=function(){this.videoManager.disable()};c.prototype.setUrl=function(b){this.videoManager.setUrl(b)};Ve.initForListeners(c);return c}();CB.OfflineVideoElement.factory=function(c,b,d,e,f,g){b=new CB.OfflineVideoElement(b||0,d,e,f,g);b.initElem(c);return b};"use strict";CB.namespace("CB.BoardTextures");
CB.BoardTextures=function(){var c,b,d,e=function(b,d,c,e,f,t){this.localDB=localforage.createInstance({name:"Textures"});this.squaresW=this._loadBitmap(b);this.squaresB=this._loadBitmap(d);this.margin=this._loadBitmap(c);this.background=this._loadBitmap(e);this.callOnSquaresLoaded=function(){};this.callOnBackgroundLoaded=function(){};this.squaresB.callOnLoaded=this._onSquaresLoaded.bind(this);this.squaresW.callOnLoaded=this._onSquaresLoaded.bind(this);this.margin.callOnLoaded=this._onSquaresLoaded.bind(this);
this.background.callOnLoaded=this._onBackgroundLoaded.bind(this);this.lastSizPix=0;this.cacheB=Array(64);this.cacheW=Array(64);this.clrCoordinates=f;this.clrMarginSepLine=t};e.prototype.destroy=function(){this.callOnSquaresLoaded=this.callOnBackgroundLoaded=null;this.removeAllListeners();this.abortCreateBackground();e.clearCache()};e.clearCache=function(){b=c=0;d={}};e.prototype.isBoardValid=function(){return this.squaresB.loaded&&this.squaresW.loaded&&this.margin.loaded};e.prototype.getSquare=function(b,
d){try{var c=CB.Square.isDark(b);if(!(0>b||63<b))return d==this.lastSizPix?c?void 0===this.cacheB[b]&&(this.cacheB[b]=this._cutSquare(b,d,c)):void 0===this.cacheW[b]&&(this.cacheW[b]=this._cutSquare(b,d,c)):(this.lastSizPix=d,this.cacheB=Array(64),this.cacheW=Array(64),c?this.cacheB[b]=this._cutSquare(b,d,c):this.cacheW[b]=this._cutSquare(b,d,c)),c?this.cacheB[b]:this.cacheW[b]}catch(e){CB.LogException("Tex:getSquare",e)}};e.prototype.drawSquare=function(b,d,c,e){(d=this.getSquare(d,c))&&d.draw(b,
e.x,e.y)};e.prototype.getMarkedSquare=function(b,d){var c=document.createElement("canvas");c.width=c.height=d;c=c.getContext("2d");this.getSquare(b,d).draw(c,0,0);c.lineWidth=Math.max(1,d/16);c.strokeStyle=this.getOriginSquareMarkerClr();var e=d-c.lineWidth;CB.CanvasTools.drawRoundedRect(c,c.lineWidth/2,c.lineWidth/2,e,e,Math.max(1,e/4));e=new CB.Bitmap;e.copyFromCtx(c,0,0,d,d);return e};e.prototype.getOriginSquareMarkerClr=function(){return"hsla( 0, 10%, 10%, 0.4 )"};var f={};CB.PixelFilter&&(f=
new CB.PixelFilter);b=c=0;d={};e.prototype.createBackground=function(e,h,l){V15.panelMgr.useBackgroundFilter()&&f&&600<h&&500<l&&this.background.loaded&&(this.background.drawTiled(e,0,0,h,l),e=e.getImageData(0,0,h,l),f.darkenCorners(e,function(e){c=e.width;b=e.height;d=e;this.fireOnBGReady()}.bind(this)))};e.prototype.abortCreateBackground=function(){f&&f.isRunning&&f.abort()};e.prototype.drawBackground=function(e,f,l){this.background.loaded&&(c==f&&b==l?e.putImageData(d,0,0):this.background.drawTiled(e,
0,0,f,l))};e.prototype.getTexturesForPieceStyle=function(b){switch(b){default:return CB.CommandIds.BOARD2D_WOOD;case CB.CommandIds.PIECES2D_OLDSTYLE:return CB.CommandIds.BOARD2D_OLDWOOD;case CB.CommandIds.PIECES2D_CRYSTALS:return CB.CommandIds.BOARD2D_CRYSTALS;case CB.CommandIds.PIECES2D_CRYSTALS_WOOD:return CB.CommandIds.BOARD2D_CRYSTALS_WOOD;case CB.CommandIds.PIECES2D_USCF:return CB.CommandIds.BOARD2D_USCF;case CB.CommandIds.PIECES2D_HABSBURG:return CB.CommandIds.BOARD2D_HABSBURG;case CB.CommandIds.PIECES2D_WORLDCHESS:return CB.CommandIds.BOARD2D_WORLDCHESS;
case CB.CommandIds.PIECES2D_FF:return CB.CommandIds.BOARD2D_FF;case CB.CommandIds.PIECES2D_BLUE:return CB.CommandIds.BOARD2D_BLUE}};e.prototype._loadBitmap=function(b){return CB.Bitmap.createFromDB(this.localDB,b)};e.prototype._storeInLocalDB=function(b){if(!b.url||0!=b.url.search("blob:")){var d=CB.CanvasTools.imgToBlob(b.image,b.width,b.height);if(d)try{this.localDB.setItem(b.url,d)}catch(c){CB.LogException("Tex::_storeInLocalDB",c)}}};e.prototype._cutSquare=function(b,d,c){try{var e=Math.min(this.squaresB.width,
this.squaresB.height),f=d,t=55;CB.System.isMobile()&&(t=10);d<t?f=2*d:128<d&&(f=.5*d);if(this.squaresB&&this.squaresB.isValid()){var v=Math.floor((e-f)/7),y=83*CB.Square.getFile(b)%7*v,A=41*CB.Square.getRank(b)%7*v;0>y&&(y=0);0>A&&(A=0);var w=c?this.nYOffsBlack:0,z=new CB.Bitmap;this.ctx&&(d==f?z.copyFromCtx(this.ctx,y,A+w,d,d):z.copyScaledFromCtx(this.ctx,y,A+w,d,d,f,f));return z}}catch(C){CB.LogException("Tex:cutSquare",C)}};e.prototype._onSquaresLoaded=function(){this.squaresW.loaded&&this.squaresB.loaded&&
this.margin.loaded&&(this.canvas=document.createElement("canvas"),this.canvas.width=Math.max(this.squaresW.width,this.squaresB.width),this.canvas.height=this.squaresW.height+this.squaresB.height,this.ctx=this.canvas.getContext("2d"),this.squaresW.draw(this.ctx,0,0),this.nYOffsBlack=this.squaresW.height,this.squaresB.draw(this.ctx,0,this.nYOffsBlack),this.callOnSquaresLoaded&&this.callOnSquaresLoaded(),this._storeInLocalDB(this.squaresW),this._storeInLocalDB(this.squaresB),this._storeInLocalDB(this.margin))};
e.prototype._onBackgroundLoaded=function(){this.callOnBackgroundLoaded&&this.callOnBackgroundLoaded();this._storeInLocalDB(this.background)};Ve.initForListeners(e);Ve.addEvent(e,"BGReady");return e}();"use strict";
CB.PieceSpriteFactory=function(){var c,b=0,d=function(d,c,e){this.id=++b;this.localDB=localforage.createInstance({name:"Pieces"});d||(d="DiagramTTFritz");this.loaded=!1;this.sqSidePix=e;this.bitmapAll=new CB.Bitmap;this.onLoadedHandlers=new CB.Handlers(this);this.bitmapAll=CB.Bitmap.createFromDB(this.localDB,V15.mediaPathChess+"Pieces/"+d+c+".png");this.bitmapAll.callOnLoaded=this._onLoaded.bind(this);this.urlsW=Array(6);this.urlsB=Array(6);this.name=d},e=[];d.getCachedFactory=function(b,c){var h=
e[c];h?h.nCacheUse++:(h=new CB.PieceSpriteFactory(b,c,c),h.nCacheUse=0,e[c]=h,d.checkCache(c));return h};d.checkCache=function(b){var d=0;e.forEach(function(){d++});if(6<d){for(var c=1E5,l=-1,q=0;q<e.length;q++)e[q]&&e[q].nCacheUse<c&&q!=b&&(c=e[q].nCacheUse,l=q);0<=l&&delete e[l]}};d.resetCache=function(){e=[]};d.prototype.isValid=function(){return void 0!==this.urlsW[0]};d.prototype.addOnLoadedHandler=function(b){return this.onLoadedHandlers.add(b)};d.prototype.removeOnLoadedHandler=function(b){this.onLoadedHandlers.remove(b)};
d.prototype.createSprite=function(b){if(CB.Piece.side(b)==CB.Side.BLACK){var d=new CB.Sprite;d.fromUrl(this.urlsB[CB.Piece.nominal(b)-1]);d.piece=b;return d}d=new CB.Sprite;d.fromUrl(this.urlsW[CB.Piece.nominal(b)-1]);d.piece=b;return d};d.prototype.createPromoSprites=function(){this.ctx.clearRect(0,0,this.sqSidePix,this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.W_QUEEN-1)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,0,0,this.sqSidePix,this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.W_KNIGHT-
1)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,0,.3*this.sqSidePix,.3*this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.W_BISHOP-1)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.W_ROOK-1)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,.6*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix);this.promoWhite=new CB.Sprite(this.ctx);this.promoWhite.fromUrl(this.canvas.toDataURL());
this.ctx.clearRect(0,0,this.sqSidePix,this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.B_QUEEN-3)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,0,0,this.sqSidePix,this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.B_KNIGHT-3)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,0,.3*this.sqSidePix,.3*this.sqSidePix);this.bitmapAll.draw(this.ctx,(CB.Piece.B_BISHOP-3)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix);
this.bitmapAll.draw(this.ctx,(CB.Piece.B_ROOK-3)*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,.7*this.sqSidePix,.6*this.sqSidePix,.3*this.sqSidePix,.3*this.sqSidePix);this.promoBlack=new CB.Sprite(this.ctx);this.promoBlack.fromUrl(this.canvas.toDataURL())};d.prototype.getPromoSprite=function(b){return b==CB.Side.BLACK?this.promoBlack:this.promoWhite};d.prototype._onLoaded=function(){void 0===c&&(c=document.createElement("canvas"));this.canvas=c;this.canvas.width=this.sqSidePix;this.canvas.height=
this.sqSidePix;this.ctx=this.canvas.getContext("2d");for(var b=0;6>b;b++)this.ctx.clearRect(0,0,this.sqSidePix,this.sqSidePix),this.bitmapAll.draw(this.ctx,b*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,0,0,this.sqSidePix,this.sqSidePix),this.urlsW[b]=this.canvas.toDataURL();for(b=6;12>b;b++)this.ctx.clearRect(0,0,this.sqSidePix,this.sqSidePix),this.bitmapAll.draw(this.ctx,b*this.sqSidePix,0,this.sqSidePix,this.sqSidePix,0,0,this.sqSidePix,this.sqSidePix),this.urlsB[b-6]=this.canvas.toDataURL();
this.loaded=!0;this.createPromoSprites();this.onLoadedHandlers.execute();this._storeInLocalDB(this.bitmapAll)};d.prototype._storeInLocalDB=function(b){if(!b.url||0!=b.url.search("blob:")){var d=CB.CanvasTools.imgToBlob(b.image,b.width,b.height);if(d)try{this.localDB.setItem(b.url,d)}catch(c){CB.LogException("PieceFact::_storeInLocalDB",c)}}};return d}();"use strict";var spriteCache=[];
CB.BoardSprites=function(){var c=function(){this.spritesOnSq=[];this.reservoir=[];this.blindSprites=[]};c.clearCache=function(){spriteCache=[]};c.prototype.initSprites=function(b){for(var d=[0,1,2,3,3,3,10,0,0,1,2,3,3,3,10,0,0],c=CB.Piece.W_KING;c<=CB.Piece.B_PAWN;c++){void 0==this.reservoir[c]&&(this.reservoir[c]=[]);for(var f=0;f<d[c];f++)this.reservoir[c].push(b.createSprite(c))}this.promoWhite=b.getPromoSprite(CB.Side.WHITE);this.promoBlack=b.getPromoSprite(CB.Side.BLACK);this.sqSidePix=b.sqSidePix;
this.name=b.name};c.prototype.create=function(b){this.initSprites(b)};c.prototype.copy=function(b){for(var d in b)b.hasOwnProperty(d)&&(this[d]=b[d])};c.prototype.setup=function(b,d,c){if(void 0!==b){if(this.spritesOnSq.length)for(var f=0;64>f;f++)void 0!==this.spritesOnSq[f]&&f!==c&&(this.reservoir[this.spritesOnSq[f].piece]&&this.reservoir[this.spritesOnSq[f].piece].push(this.spritesOnSq[f]),delete this.spritesOnSq[f]);for(f=0;64>f;f++){var g=d[f];g&&f!==c&&(this.spritesOnSq[f]=this.createSprite(b,
g,f),this.spritesOnSq[f].deleteBackground())}}};c.prototype.changeBoard=function(b,d,c){if(void 0!==b&&0!=this.reservoir.length){for(var f=[],g=[],h=0;64>h;h+=1)0==d[h]||d[h]!=c[h]||void 0!==this.spritesOnSq[h]&&this.spritesOnSq[h].piece===d[h]||(CB.LOG("Repair sprite squares at "+h),void 0!==this.spritesOnSq[h]&&this._toReservoir(this.spritesOnSq[h]),this.spritesOnSq[h]=this.createSprite(b,d[h],h));for(h=0;64>h;h+=1)if(0!=d[h]&&d[h]!=c[h]){var l=this.spritesOnSq[h];l||(l=this.createSprite(b,d[h],
h));g.push({square:h,piece:d[h],sprite:l});delete this.spritesOnSq[h]}for(var l=[],q=1;2>=q;q++)for(h=0;64>h;h+=1)if(0!=c[h]&&d[h]!=c[h]&&!l[h]){for(var r=!1,t=-1,v=99999,y=0;y<g.length&&!r;y++)if(void 0!=g[y]&&g[y].piece==c[h]&&(2==q||CB.Square.getFile(g[y].square)==CB.Square.getFile(h))){var A=CB.Square.getDist(g[y],h);A<v&&(v=A,t=y)}0<=t&&(this.spritesOnSq[h]=g[t].sprite,f.push(new CB.PieceAnimationJob(c[h],this.spritesOnSq[h],g[t].square,h,V15.Vb.getSquare(g[t].square,b.sqSidePix))),delete g[t],
r=!0,l[h]=!0);r||2!=q||(this.spritesOnSq[h]=this.createSprite(b,c[h],h),f.push(new CB.PieceAnimationJob(c[h],this.spritesOnSq[h],-1,h,V15.Vb.getSquare(h,b.sqSidePix))))}for(y=0;y<g.length;y++)void 0!=g[y]&&(f.push(new CB.PieceAnimationJob(g[y].piece,g[y].sprite,g[y].square,-1,V15.Vb.getSquare(g[y].square,b.sqSidePix))),this._toReservoir(g[y].sprite),delete g[y]);return f}};c.prototype.set=function(b,d){CB.LOG("BoardSprites set: "+(b?b.piece:"")+", sq="+d);this.spritesOnSq[d]&&this._toReservoir(this.spritesOnSq[d]);
b?this.spritesOnSq[d]=b:delete this.spritesOnSq[d]};c.prototype.giveBack=function(b){this._toReservoir(b)};c.prototype.createSprite=function(b,d,c){if(this.reservoir[d]&&0<this.reservoir[d].length){for(var f,g=!1,h=0;h<this.reservoir[d].length;h++)c==this.reservoir[d][h].lastSq&&((f=this.reservoir[d][h])&&(g=!0),this.reservoir[d].splice(h,1));g||((f=this.reservoir[d][0])||(f=b.createSprite(d)),this.reservoir[d].shift());f.piece=d;return f}CB.LOG("CB.Piece NOT in reservoir: "+CB.Square.getStr(c),"LogError");
return b.createSprite(d)};c.prototype.getPromoSprite=function(b){return b==CB.Side.BLACK?this.promoBlack:this.promoWhite};c.prototype.getBlindSprite=function(b,d){this.blindSprites[d]||(this.blindSprites[d]=b.createSprite(d));return this.blindSprites[d]};c.prototype.isAllLoaded=function(){for(var b=0;64>b;b++)if(void 0!==this.spritesOnSq[b]&&!this.spritesOnSq[b].loaded)return!1;if(0==this.reservoir.length)return!1;for(b=CB.Piece.W_KING;b<=CB.Piece.B_PAWN;b++)for(var d=0;d<this.reservoir[b].length;d++)if(!this.reservoir[b][d]||
!this.reservoir[b][d].loaded)return!1;return!0};c.prototype.change=function(b,d){void 0!==this.spritesOnSq[d]&&this._toReservoir(this.spritesOnSq[d]);this.spritesOnSq[d]=this.spritesOnSq[b];delete this.spritesOnSq[b]};c.prototype.promo=function(b,d,c,f){void 0!==this.spritesOnSq[d]&&this._toReservoir(this.spritesOnSq[d]);this.spritesOnSq[d]=this.createSprite(f,c);this.spritesOnSq[b].deleteBackground();this._toReservoir(this.spritesOnSq[b]);delete this.spritesOnSq[b]};c.prototype.enPassant=function(b,
d,c){this.spritesOnSq[d]=this.spritesOnSq[b];this._toReservoir(this.spritesOnSq[c]);delete this.spritesOnSq[c];delete this.spritesOnSq[b]};c.prototype.deleteBackgrounds=function(){for(var b=0;64>b;b++)void 0!==this.spritesOnSq[b]&&this.spritesOnSq[b].deleteBackground();this.promoWhite&&this.promoWhite.deleteBackground();this.promoBlack&&this.promoBlack.deleteBackground()};c.prototype.getPiece=function(b){return this.spritesOnSq[b]};c.prototype._toReservoir=function(b){this.reservoir[b.piece].push(b)};
c.prototype._getClickRect=function(b,d){return new CB.Rect(Math.floor(b.x-d/2),Math.floor(b.y-d/2),Math.floor(b.x+d/2),Math.floor(b.y+d/2))};return c}();
CB.PieceAnimationJob=function(){var c=function(b,d,c,f,g){CBDebug.assert(void 0!==d);this.piece=b;this.sprite=d;this.sqFrom=c;this.sqTo=f;this.textureSqTo=g;this.ptFrom=this.ptTo=new CB.Point(0,0)};c.prototype.isBoardAttribute=function(){return!1};c.prototype.isPieceAnim=!0;c.prototype.deleteBackground=function(){this.sprite.deleteBackground()};c.prototype.startAnimation=function(b,d){this.debug="started";this.sprite.hide(b);var c=this.ptTo.subtract(this.ptFrom),f=new CB.Vector(c.x,c.y);this.nAnimCountDown=
Math.floor(f.getLength()/this.sprite.w*d+.5);this.isFirst=!0;5>this.nAnimCountDown&&(this.nAnimCountDown=5);this.vecDisplace=new CB.Vector(c.x/this.nAnimCountDown,c.y/this.nAnimCountDown);this.currPos=this.ptFrom;if(-1==this.sqFrom||-1==this.sqTo)this.nAnimCountDown=0;this.totCountDown=this.nAnimCountDown};c.prototype.loaded=function(){return this.sprite&&this.sprite.loaded};c.prototype.hide=function(b){if(this.sprite){var d=!1,c=Math.floor(this.sprite.w/2);this.isFirst&&-1!=this.sqFrom?void 0!==
this.textureSqTo&&(this.textureSqTo.draw(b,this.ptFrom.x-c,this.ptFrom.y-c),this.sprite.saveBeforeMove(b,this.currPos),d=!0):-2==this.nAnimCountDown&&-1==this.sqFrom&&void 0!==this.textureSqTo&&(this.textureSqTo.draw(b,this.ptTo.x-c,this.ptTo.y-c),this.sprite.saveBeforeMove(b,this.currPos),d=!0);d||this.sprite.hide(b)}};c.prototype.show=function(b){this.sprite.show(b)};c.prototype.moveToNoSave=function(b,d){this.sprite.moveToNoSave(b,d)};c.prototype.moveTo=function(b,d){this.sprite.moveTo(b,d)};c.prototype.getPumpedW=
function(){};c.prototype.getPumpedH=function(){};c.prototype.getPumpFactor=function(){if(this.totCountDown){var b=Math.min(1,(this.totCountDown-this.nAnimCountDown)/this.totCountDown);return.5>b?1+1*b:1+1*(1-b)}return 1};c.prototype.saveBeforeMove=function(b,d){this.sprite.saveBeforeMove(b,d)};c.prototype.getMoveClipRect=function(){return this.sprite.getMoveClipRect()};c.prototype.deleteBackground=function(){this.sprite.deleteBackground()};c.prototype.displace=function(b){b=this.limitSteps(b);this.currPos.x+=
b*this.vecDisplace.x;this.currPos.y+=b*this.vecDisplace.y};c.prototype.prepNextStep=function(b){b=this.limitSteps(b);this.nAnimCountDown-=b;this.isFirst=!1;return-2>this.nAnimCountDown};c.prototype.canDelete=function(){return-2>this.nAnimCountDown};c.prototype.limitSteps=function(b){1>=this.nAnimCountDown?b=1:b>this.nAnimCountDown&&(b=this.nAnimCountDown);return b};c.prototype.isDeleteAtEnd=function(){return-1===this.sqTo};c.prototype.shouldHideInThisStep=function(){return-3<=this.nAnimCountDown&&
void 0!==this.sprite};c.prototype.hasReachedEndPos=function(){return 0>=this.nAnimCountDown};c.prototype.isImmobileInThisStep=function(){return-1>=this.nAnimCountDown};c.prototype.getsInvisibleAtEnd=function(){return-2>=this.nAnimCountDown&&this.isDeleteAtEnd()};c.prototype.isStillMoving=function(){return 0<=this.nAnimCountDown};return c}();"use strict";
CB.BoardFunAnimations=function(){var c=function(b){this.board=b;this.happyRook=null;this.animSteps=ObjUtil.clone(b.animSteps)};c.prototype.cancelFun=function(b){(new CB.Timer(function(){this.board.animSteps=this.animSteps;this.board.redraw()}.bind(this))).runOnce(b)};c.prototype.happySize=c.prototype.defaultSize=64;c.prototype.stampHappy=function(){null==this.happyRook&&(this.happyRook=this.createFunSprite("Happy",this.happySize));var b=new CB.BitmapAnimationJob(this.happyRook,this.getHappyStart(),
this.getHappyEnd());this.board.animSteps={forMove:3,forPosition:2};this.board.runFunAnimation([b]);this.cancelFun(3E3)};c.prototype.stampCheckOk=function(){null==this.checkMark&&(this.checkMark=this.createFunSprite("Check",this.defaultSize));var b=new CB.BitmapAnimationJob(this.checkMark,this.getHappyStart(),this.getHappyEnd());this.board.animSteps={forMove:4,forPosition:2};this.board.runFunAnimation([b]);this.cancelFun(3E3)};c.prototype.getHappyStart=function(){var b=this.board.getInnerRect().getTopLeft();
b.x+=this.happySize;b.y+=this.happySize;return b};c.prototype.getHappyEnd=function(){var b=this.board.getInnerRect(),d=b.getTopLeft();d.x+=b.w/2;d.y+=b.h/2;return d};c.prototype.createFunSprite=function(b,d){var c=V15.mediaPathChess+"Sprites/"+b+d.toString()+".png",f=new CB.Sprite;f.fromUrl(c);f.noShadow=!0;return f};return c}();
CB.BitmapAnimationJob=function(){var c=function(b,d,c){CBDebug.assert(void 0!==b);this.sprite=b;this.ptFrom=d;this.ptTo=c};c.prototype.isBoardAttribute=function(){return!1};c.prototype.deleteBackground=function(){this.sprite.deleteBackground()};c.prototype.copyBackground=function(b){this.sprite.saveBeforeMove(b,this.ptFrom)};c.prototype.startAnimation=function(b,d){this.debug="started";this.copyBackground(b);var c=this.ptTo.subtract(this.ptFrom),f=new CB.Vector(c.x,c.y);this.nAnimCountDown=Math.floor(f.getLength()/
this.sprite.w*d+.5);this.isFirst=!0;5>this.nAnimCountDown&&(this.nAnimCountDown=5);this.vecDisplace=new CB.Vector(c.x/this.nAnimCountDown,c.y/this.nAnimCountDown);this.currPos=this.ptFrom};c.prototype.loaded=function(){return this.sprite&&this.sprite.loaded};c.prototype.hide=function(b){this.sprite&&this.sprite.hide(b)};c.prototype.show=function(b){this.sprite.show(b)};c.prototype.moveToNoSave=function(b,d){this.sprite.moveToNoSave(b,d)};c.prototype.moveTo=function(b,d){this.sprite.moveTo(b,d)};c.prototype.saveBeforeMove=
function(b,d){this.sprite.saveBeforeMove(b,d)};c.prototype.getMoveClipRect=function(){return this.sprite.getMoveClipRect()};c.prototype.deleteBackground=function(){this.sprite.deleteBackground()};c.prototype.displace=function(b){b=this.limitSteps(b);this.currPos.x+=b*this.vecDisplace.x;this.currPos.y+=b*this.vecDisplace.y};c.prototype.prepNextStep=function(b){b=this.limitSteps(b);this.nAnimCountDown-=b;this.isFirst=!1;return-2>this.nAnimCountDown};c.prototype.canDelete=function(){return-2>this.nAnimCountDown};
c.prototype.limitSteps=function(b){1>=this.nAnimCountDown?b=1:b>this.nAnimCountDown&&(b=this.nAnimCountDown);return b};c.prototype.isDeleteAtEnd=function(){return-1===this.sqTo};c.prototype.shouldHideInThisStep=function(){return-3<=this.nAnimCountDown&&void 0!==this.sprite};c.prototype.hasReachedEndPos=function(){return 0>=this.nAnimCountDown};c.prototype.isImmobileInThisStep=function(){return-1>=this.nAnimCountDown};c.prototype.getsInvisibleAtEnd=function(){return-2>=this.nAnimCountDown&&this.isDeleteAtEnd()};
c.prototype.isStillMoving=function(){return 0<=this.nAnimCountDown};return c}();"use strict";var attrId=0;
CB.BoardArrow=function(){function c(b){return 0<b?1:0>b?-1:0}var b=function(b,d,c,h,l){this.from=b;this.to=d;this.rgba=c;this.lineWidthPercent=h;this.id=++attrId;this.dash=l};b.prototype.draw=function(d){d.save();var f=this.boardControl.getSquareCenterPos(this.from),g=this.boardControl.getSquareCenterPos(this.to),h=CB.Square.getFile(this.from),l=CB.Square.getRank(this.from),q=CB.Square.getFile(this.to),r=CB.Square.getRank(this.to),l=c(r-l),h=c(q-h);this.boardControl.blackIsBottom?(g.x+=h*this.boardControl.nSqPix/
4,g.y-=l*this.boardControl.nSqPix/4):(g.x-=h*this.boardControl.nSqPix/4,g.y+=l*this.boardControl.nSqPix/4);h=.5*this.boardControl.nSqPix;this.lineWidthPercent?(d.lineWidth=Math.max(1,this.boardControl.nSqPix*this.lineWidthPercent*.01),h=5*d.lineWidth):d.lineWidth=Math.max(1,.09*this.boardControl.nSqPix);d.lineCap="round";this.rgba?b.setStrokeFillStyles(d,this.rgba,f.x,f.y,g.x,g.y):(q=b.getHslYellow(),d.strokeStyle=(new CB.HSLColor(q.h,q.s,q.l,.75)).toString(),d.fillStyle=(new CB.HSLColor(q.h,q.s,
q.l,.9)).toString());b.drawArrow(d,f.x,f.y,g.x,g.y,3,1,Math.PI/8,h,.8*d.lineWidth,this.rgba,this.dash);d.restore();return this._getClipRect()};b.setStrokeFillStyles=function(b,d,c,h,l,q){if(d&&(d.alpha||d.hue)){c=b.createLinearGradient(c,h,l,q);var r=d.alpha;d.alpha=.15;c.addColorStop(0,d);d.alpha=.4;c.addColorStop(.4,d);d.alpha=.55;c.addColorStop(.6,d);d.alpha=r;c.addColorStop(1,d);b.strokeStyle=c;b.fillStyle=d}else d&&0==d.search("hsla")?(r=/hsla\(\s*(\d{1,3}),\s*(\d{1,3})\%,\s*(\d{1,3})\%,\s(.+)\)/g.exec(d),
c=b.createLinearGradient(c,h,l,q),h=String.f("hsla( {0}, {1}%, {2}%, {3} )",r[1],r[2],r[3],"0.15"),l=String.f("hsla( {0}, {1}%, {2}%, {3} )",r[1],r[2],r[3],"0.4"),q=String.f("hsla( {0}, {1}%, {2}%, {3} )",r[1],r[2],r[3],.55*r[4]),r=String.f("hsla( {0}, {1}%, {2}%, {3} )",r[1],r[2],r[3],r[4]),c.addColorStop(0,h),c.addColorStop(.4,l),c.addColorStop(.6,q),c.addColorStop(1,r),b.strokeStyle=c,b.fillStyle=d):(b.fillStyle=d,b.strokeStyle=d)};b.prototype.undo=function(b){for(var d=CB.Square.getFile(this.from),
g=CB.Square.getRank(this.from),h=CB.Square.getFile(this.to),l=CB.Square.getRank(this.to),q=c(l-g),r=c(h-d);d!=h||g!=l;){this.boardControl.restoreSquare(b,CB.Square.I(d,g));if(0!=r&&0!=q){var t=CB.Square.I(d+r,g),v=CB.Square.I(d,g+q);0<=t&&64>t&&this.boardControl.restoreSquare(b,t);0<=v&&64>v&&this.boardControl.restoreSquare(b,v)}d!=h&&(d+=r);g!=l&&(g+=q)}0<=d&&0<=g&&this.boardControl.restoreSquare(b,CB.Square.I(d,g));return this._getClipRect()};b.prototype._getClipRect=function(){var b=this.boardControl.getSquareRect(this.from),
b=b.getUnion(this.boardControl.getSquareRect(this.to));if(this.lineWidthPercent){var d=this.boardControl.nSqPix*this.lineWidthPercent*.01;b.expand(d,d)}return b};b.prototype.toString=function(){return"Arrow: "+CB.Square.toString(this.from)+"-"+CB.Square.toString(this.to)};b.prototype.getId=function(){return"arrow"+this.from+this.to};var d=function(b,d,c,h,l,q,r,t){b.beginPath();b.moveTo(d,c);b.lineTo(h,l);b.lineTo(q,r);switch(t){case 0:t=Math.sqrt((q-d)*(q-d)+(r-c)*(r-c));b.arcTo(h,l,d,c,.55*t);b.fill();
break;case 1:b.lineTo(d,c);b.fill();break;case 2:b.stroke();break;case 3:b.quadraticCurveTo((d+h+q)/3,(c+l+r)/3,d,c);b.fill();break;case 4:if(q==d)t=r-c,q=(h+d)/2,h=(h+d)/2,r=l+t/5,t=l-t/5;else{t=Math.sqrt((q-d)*(q-d)+(r-c)*(r-c));h=((d+q)/2+h)/2;l=((c+r)/2+l)/2;q=(r-c)/(q-d);t=t/(2*Math.sqrt(q*q+1))/5;var v=q*t;q=h-t;r=l-v;h+=t;t=l+v}b.bezierCurveTo(q,r,h,t,d,c);b.fill()}},d=function(b,d,c,h,l,q,r,t){b.beginPath();b.moveTo(d,c);b.lineTo(h,l);b.lineTo(q,r);switch(t){case 0:t=Math.sqrt((q-d)*(q-d)+
(r-c)*(r-c));b.arcTo(h,l,d,c,.55*t);b.fill();break;case 1:b.lineTo(d,c);b.fill();break;case 2:b.stroke();break;case 3:b.quadraticCurveTo((d+h+q)/3,(c+l+r)/3,d,c);b.fill();break;case 4:if(q==d)t=r-c,q=(h+d)/2,h=(h+d)/2,r=l+t/5,t=l-t/5;else{t=Math.sqrt((q-d)*(q-d)+(r-c)*(r-c));h=((d+q)/2+h)/2;l=((c+r)/2+l)/2;q=(r-c)/(q-d);t=t/(2*Math.sqrt(q*q+1))/5;var v=q*t;q=h-t;r=l-v;h+=t;t=l+v}b.bezierCurveTo(q,r,h,t,d,c);b.fill()}};b.drawFree=function(b,d,c,h,l,q,r,t){b.save();b.lineWidth=q;b.lineCap="round";CB.BoardArrow.drawArrow(b,
d,c,h,l,3,1,Math.PI/8,6*q,.8*b.lineWidth,r,t);b.restore()};b.drawArrow=function(c,f,g,h,l,q,r,t,v,y,A,w){q="undefined"!=typeof q?q:3;r="undefined"!=typeof r?r:1;t="undefined"!=typeof t?t:Math.PI/8;v="undefined"!=typeof v?v:10;y=y||0;var z="function"!=typeof q?d:q,C=h-f,D=l-g,E=Math.sqrt(C*C+D*D);if(0!=E){var F=Math.atan2(l-g,h-f),G=y*Math.cos(F);y*=Math.sin(F);E=(E-.76*v)/E;r&1?(C=f+C*E-G,D=g+D*E-y):(C=h,D=l);r&2?(G=f+(h-f)*(1-E),E=g+(l-g)*(1-E)):(G=f,E=g);c.save();A?b.setStrokeFillStyles(c,A,G,E,
C,D):(A=c.createLinearGradient(G,E,C,D),y=b.getHslYellow(),A.addColorStop(0,(new CB.HSLColor(y.h,y.s,y.l,.2)).toString()),A.addColorStop(.2,(new CB.HSLColor(y.h,y.s,y.l,.35)).toString()),A.addColorStop(.65,(new CB.HSLColor(y.h,y.s,y.l,.55)).toString()),A.addColorStop(1,(new CB.HSLColor(y.h,y.s,y.l,.9)).toString()),c.strokeStyle=A);c.beginPath();w&&c.setLineDash(w);c.moveTo(G,E);c.lineTo(C,D);c.stroke();v=Math.abs(v/Math.cos(t));r&1&&(A=F+Math.PI+t,w=h+Math.cos(A)*v,A=l+Math.sin(A)*v,D=F+Math.PI-t,
C=h+Math.cos(D)*v,D=l+Math.sin(D)*v,z(c,w,A,h,l,C,D,q));r&2&&(A=F+t,w=f+Math.cos(A)*v,A=g+Math.sin(A)*v,D=F-t,C=f+Math.cos(D)*v,D=g+Math.sin(D)*v,z(c,w,A,f,g,C,D,q));c.restore()}};b.getHslYellow=function(){return{h:40,s:90,l:60}};return b}();
CB.BoardColouredSquare=function(){var c=function(b,d,c){this.sq=b;this.rgba=d;this.isWholeSquare=c;this.id=++attrId};c.prototype.draw=function(b){return this.drawFrame(b)};c.prototype.drawFrame=function(b){var d=this.boardControl.getSquareCenterPos(this.sq);b.strokeStyle=this.rgba?b.fillStyle=this.rgba.toString():b.fillStyle="rgba( 255, 220, 10, 0.5 )";var c=16;this.isWholeSquare&&(c=10);b.lineWidth=Math.max(1,this.boardControl.nSqPix/c);this.boardControl.drawSquare(b,this.sq);var c=this.boardControl.nSqPix-
b.lineWidth,f=c-0;CB.CanvasTools.drawRoundedRect(b,d.x-c/2+0,d.y-c/2+0,f,f,Math.max(1,f/3.5));this.boardControl.drawPiece(b,this.sq);return this._getClipRect()};c.prototype.drawWhole=function(b){var d=this.boardControl.getSquareCenterPos(this.sq);CB.Square.getFile(this.sq);CB.Square.getRank(this.sq);b.lineWidth=Math.max(1,.08*this.boardControl.nSqPix);this.rgba?b.strokeStyle=b.fillStyle=this.rgba:(b.strokeStyle="rgba( 255, 220, 10, 0.6 )",b.fillStyle="rgba( 255, 220, 10, 0.6 )");var c=.5*this.boardControl.nSqPix;
b.fillRect(d.x-c,d.y-c,2*c,2*c);return this._getClipRect()};c.prototype.undo=function(b){var d=CB.Square.getFile(this.sq),c=CB.Square.getRank(this.sq);this.boardControl.restoreSquare(b,CB.Square.I(d,c));return this._getClipRect()};c.prototype._getClipRect=function(){return this.boardControl.getSquareRect(this.sq)};c.prototype.toString=function(){return"Sq="+CB.Square.toString(this.sq)+", Clr="+this.rgba};c.fromJson=function(b){this.sq=b.sq};c.prototype.getId=function(){return"square"+this.sq};return c}();
CB.BoardLinePoint=function(){var c=function(b,d){this.sq=b;this.corner=d};c.stringToPoints=function(b){var d=[];if(b=b.match(/[a-h][1-8][t,b][l,r]/ig))for(var c=0;c<b.length;c++){var f=CB.Square.fromString(b[c].substr(0,2));d.push(new CB.BoardLinePoint(f,b[c].substr(2,2)))}return d};c.prototype.getXY=function(b,d){var c=b.getPixPos(this.sq),f=b.nSqPix;switch(this.corner){case "tl":c.x-=d/2;c.y-=d/2;break;case "tr":c.x+=f+d/2;c.y-=d/2;break;case "bl":c.x-=d/2;c.y+=f+d/2;break;case "br":c.x+=f+d/2;
c.y+=f+d/2;break;case "ct":c.x+=f/2;c.y+=f/2;break;case "bm":c.x+=f/2+d/2;c.y+=f+d/2;break;case "tm":c.x+=f/2+d/2;c.y-=d/2;break;case "lm":c.x-=d/2;c.y+=f/2+d/2;break;case "rm":c.x+=f+d/2,c.y+=f/2+d/2}return c};c.prototype.getClipRect=function(b,d){var c=b.getPixPos(this.sq),f=b.nSqPix,f=f+2*d;c.x-=d;c.y-=d;var g=new CB.Rect;g.fromTwoPoints(c.x,c.y,c.x+f,c.y+f);return g};c.prototype.toString=function(){return"Point: Sq="+CB.Square.toString(this.sq)+", Corner="+this.corner};c.prototype.getId=function(){return"point"+
this.sq+this.corner};return c}();
CB.BoardLine=function(){var c=function(b,d,c,f){this.points=b||[];this.thickPercent=d||10;this.clr=c;this.dash=f;this.id=++attrId};c.prototype.draw=function(b){b.save();b.strokeStyle=this.clr?b.fillStyle=this.clr:b.fillStyle="hsla( 0, 50%, 70%, 0.6 )";b.lineCap="round";b.lineWidth=this.getLineWidthPixel();if(this.points.length){b.beginPath();this.dash&&this.dash.length&&b.setLineDash(this.dash);var d=this.points[0].getXY(this.boardControl,b.lineWidth);b.moveTo(d.x,d.y);for(var c=1;c<this.points.length;c++)d=
this.points[c].getXY(this.boardControl,b.lineWidth),b.lineTo(d.x,d.y);b.stroke()}b.restore();return this._getClipRect()};c.prototype.undo=function(b){return this._getClipRect()};c.prototype.getLineWidthPixel=function(){return Math.max(1,this.boardControl.nSqPix*this.thickPercent/100)};c.prototype._getClipRect=function(){for(var b=null,d=0;d<this.points.length;d++)b=null==b?this.points[d].getClipRect(this.boardControl,this.getLineWidthPixel()):b.getUnion(this.points[d].getClipRect(this.boardControl,
this.getLineWidthPixel()));return b};c.prototype.toString=function(){return"Line: "+this.clr.toString()+"/"+this.thickPercent};c.prototype.getId=function(){return"line"+this.points.join(",")};return c}();
CB.BoardZone=function(){var c=function(b,c,f,g,h,l){this.from=b;this.to=c;this.thick=f;this.clr=g;this.dash=h;this.boardControl=l;this.edges=this.getEdgeSquares(this.from,this.to);this.createLine()};c.prototype.getEdgeSquares=function(d,c){var f=[d,c,8*Math.floor(d/8)+c%8,8*Math.floor(c/8)+d%8];b(f);return f};var b=function(b){b.sort(function(b,d){var c=Math.floor(b/8),h=Math.floor(d/8);return c!=h?c-h:b%8-d%8});b[2]=[b[3],b[3]=b[2]][0];b[2]==b[3]&&8>b[2]-b[1]&&(b[1]=[b[3],b[3]=b[1]][0])};c.prototype.createLine=
function(){var b=["bl","tl","tr","br"];this.boardControl.blackIsBottom&&(b=["tr","br","bl","tl"]);b=b.map(function(b,d){return new CB.BoardLinePoint(this.edges[d],b)}.bind(this));b.push(new CB.BoardLinePoint(this.edges[0],this.boardControl.blackIsBottom?"tr":"bl"));b=new CB.BoardLine(b,this.thick,this.clr,this.dash);b.boardControl=this.boardControl;this.line=b};c.prototype.draw=function(b){this.line.draw(b)};c.prototype.undo=function(b,c){return this.line.undo(b,c)};c.prototype.toString=function(){return"Zone: "+
this.edges.join(",")};c.prototype.getId=function(){return"zone"+this.edges.join(",")};return c}();"use strict";
CB.BoardArea=function(){function c(b,c,f,g){var h=!1,l=f.event;void 0===l&&(l=f);for(f=0;f<b.length;f++)b[f]&&b[f].isInMyArea(g.x,g.y)&&(c.call(b[f],l,g),h=!0);return h}var b=function(b,c,f,g){this.cbcanvas=b;this.width=c;this.height=f;this.options=g;this.boards=[];this.shadows=[];b=CB.System.isFirefox()||CB.System.isSafari()||CB.System.runsInIFrame();if(!b&&!this.isTransparent()){for(c=0;4>c;c++)this.shadows[c]=new CB.DivElement(this.cbcanvas.canvas.parentElement,"BAreaShadow"+c),this.shadows[c].setVisible(!b&&
0==c&&!V15.isBoardOnlyApp());this.shadows[0].setCssClass("BoardAreaShadowT");this.shadows[1].setCssClass("BoardAreaShadowR");this.shadows[2].setCssClass("BoardAreaShadowB");this.shadows[3].setCssClass("BoardAreaShadowL")}g&&g.suppressCalcGeometry||this.calcGeometry();this.idStyleListener=glSettings.addOnBoardStyleListener(function(){(new CB.Timer(function(){this.calcGeometry()}.bind(this))).runOnce(300)}.bind(this));V15.Vb.callOnBackgroundLoaded=this.onBackgroundTexturesLoaded.bind(this)};b.prototype.addBoard=
function(b){this.boards.push(b);b.idBoardAreaHandler=b.onReadyHandlers.add(this.onBoardReady.bind(this))};b.prototype.removeBoard=function(b){b=this.getInxOfBoard(b);void 0!==b&&(b=this.boards.splice(b,1),b[0]&&b[0].destroy(),this.drawBackground(this.cbcanvas.bufferCtx),this.cbcanvas.requestRedraw(),CB.LOG("RemoveBoard: "+b[0].debugName))};b.prototype.getSizeRatio=function(){return this.width/this.height};b.prototype.onDestroyDOM=function(){this.removeAllBoards()};b.prototype.removeAllBoards=function(){for(var b=
0;b<this.boards.length;b++)this.boards[b]&&this.boards[b].destroy();this.boards=[];this.calcGeometry()};b.prototype.setPosInput=function(b){this.boards=[];this.addBoard(b);this.drawBackground(this.cbcanvas.bufferCtx);this.calcGeometry()};b.prototype.removePosInput=function(b){this.boards=[];this.boards.push(b);this.calcGeometry();this.drawBackground(this.cbcanvas.bufferCtx);this.calcGeometry();this.cbcanvas.requestRedraw()};b.prototype.getInxOfBoard=function(b){for(var c=0;c<this.boards.length;c++)if(this.boards[c]&&
this.boards[c].uniqueId==b.uniqueId)return c};b.prototype.draw=function(b){try{this.drawForeground(b),this.needsShadows=!1}catch(c){CB.LogException("AreaDraw",c)}};b.prototype.setBackgroundStyle=function(){this.cbcanvas.canvas.style.backgroundImage="url( '"+V15.Vb.background.url+"' )"};b.prototype.drawWood=function(b){for(var c=0;c<this.boards.length;c++)this.boards[c]&&this.boards[c].drawWood(b,this.boardHasShadow())};b.prototype.drawForeground=function(b){for(var c=0;c<this.boards.length;c++)this.boards[c]&&
this.boards[c].draw(b,this.boardHasShadow())};b.prototype.drawBackground=function(b){this.isTransparent()?this.needsShadows=!0:void 0!==b&&V15.Vb.background&&V15.Vb.background.loaded&&(V15.Vb.drawBackground(b,this.width,this.height),this.needsShadows=!0)};b.prototype.beforeResize=function(){for(var b=0;b<this.boards.length;b++)this.boards[b]&&this.boards[b].beforeResize()};b.prototype.resize=function(b,c){this.width=b;this.height=c;this.calcGeometry()};b.prototype.forceResize=function(){this.resize(this.width,
this.height)};b.prototype.getInfoWin=function(){if(!this.infoWin){var b=$("<div class='cbBoardAreaInfo'><div id='idBoardAreaInfo'></div></div>");b.hide();$(this.cbcanvas.canvas.parentElement).parent().append(b);this.infoWin=b[0]}return this.infoWin};b.prototype.removeInfoWin=function(){this.infoWin&&$(this.infoWin).remove();delete this.infoWin};b.prototype.calcGeometry=function(){this.infoWin&&$(this.infoWin).hide();this.cbcanvas&&(this.bgListenerId&&V15.Vb.removeOnBGReadyListener(this.bgListenerId),
this.bgListenerId=V15.Vb.addOnBGReadyListener(this.onBGReady.bind(this)),V15.Vb.createBackground(this.cbcanvas.ctx,this.width,this.height));this.boards.forEach(function(b){b.setTitleVisible(!1)});this.nBoardCallbacksExpected=this.boards.length;this.arrangeBoards();this.cbcanvas.block(!1);0===this.boards.length&&void 0!==this.cbcanvas.control&&this.cbcanvas.requestRedraw();var b=this.cbcanvas.pixToZoom(this.width),c=this.cbcanvas.pixToZoom(this.height),f=Math.min(c/50,10),g=Math.min(b/50,10);this.shadows&&
4==this.shadows.length&&(this.shadows[0].setPosSize(0,0,b,g),this.shadows[1].setPosSize(b-g,f,f,c-2*f),this.shadows[2].setPosSize(0,c-f,b,f),this.shadows[3].setPosSize(0,f,g,c-2*f));this.infoWin&&($(this.infoWin).css("width",b/2),b=this.height/10,$(this.infoWin).css("height",b),$(this.infoWin).css("position","absolute"),$(this.infoWin).css("top",this.height/60),$(this.infoWin).css("left",this.width/4))};b.prototype.onMouseDown=function(b,e){this.boards.length&&c(this.boards,this.boards[0].onMouseDown,
b,e)};b.prototype.onContextMenu=function(b,e){this.boards.length&&c(this.boards,this.boards[0].onContextMenu,b,e)};b.prototype.onMouseUp=function(b,e){if(this.boards.length&&!c(this.boards,this.boards[0].onMouseUp,b,e)&&1==this.boards.length)this.boards[0].onMouseUp(b,e)};b.prototype.onMouseWheel=function(b,e){this.boards.length&&c(this.boards,this.boards[0].onMouseWheel,b,e)};b.prototype.onMouseMove=function(b,e){if(this.boards.length)if(1==this.boards.length)this.boards[0].onMouseMove(b,e);else c(this.boards,
this.boards[0].onMouseMove,b,e)};b.prototype.onMouseEnter=function(b,e){this.boards.length&&c(this.boards,this.boards[0].onMouseEnter,b,e)};b.prototype.onMouseLeave=function(b,e){this.boards.length&&c(this.boards,this.boards[0].onMouseLeave,b,e)};b.prototype.onDoubleClick=function(b,c){};b.prototype.onBackgroundTexturesLoaded=function(){this.width&&this.cbcanvas&&V15.Vb.createBackground(this.cbcanvas.ctx,this.width,this.height);this.cbcanvas.onControlBackgroundReady();if(void 0!==this.onReady)this.onReady()};
b.prototype.getClickPos=function(b){var c=this.cbcanvas.canvas.getBoundingClientRect();return new CB.Point(b.getX()-c.left,b.getY()-c.top)};b.prototype.getLayout=function(b,c,f){var g={w:10,nX:b,nY:1};if(0==b)return g;var h=Math.max(c,f);g.w=Math.round(Math.min(Math.min(c,f)-0,Math.floor(h/b-0)));if(0==g.w)return g;h==c?(g.nX=b,g.nY=1):(g.nX=1,g.nY=b);for(var h=b,l=1;l<=b;){var q=Math.floor(Math.min(c/h-0,f/l-0));g.w<q&&(g.w=q,g.nX=h,g.nY=l);l++;h=Math.floor(b/l);b!=h*l&&h++}1==h&&1<l&&1==b?(g.h=
f,g.w=c):g.h=g.w;return g};b.prototype.arrangeBoards=function(){if(0!=this.boards.length){var b=this.width,c=this.height,f=0,g=0;this.infoWin&&(c-=this.height/8,g+=this.height/8);var h=0;if(1<this.boards.length&&this.options.splitLayout){var l=this.width-this.height-0;if(Math.abs(l)>.2*Math.max(this.width,this.height)&&0<l)var f=this.width-l,q=Math.min(f,this.height),b=l,g=6,c=q-2*g,h=1}l=this.getLayout(this.boards.length-h,b,c);if(0!=l.w){var b=Math.floor((b-l.nX*l.w)/(l.nX+1)),c=Math.floor((c-l.nY*
l.h)/(l.nY+1)),r=new CB.Size(l.w,l.h);if(1==this.boards.length)this.boards[0].setLeftSpace(b),this.boards[0].setPosSize(new CB.Point(b,0),r);else for(0<h&&(this.boards[0].setLeftSpace(b),this.boards[0].setTitleVisible(!0),this.boards[0].setPosSize(new CB.Point(0,0),new CB.Size(q,q))),q=0;q<l.nX;q++)for(var t=f+b+q*(b+l.w),v=0;v<l.nY;v++){var y=g+c+v*(c+l.w);h<this.boards.length&&(y=new CB.Point(t,y),this.boards[h].setLeftSpace(b),this.boards[h].setTitleVisible(!0),this.boards[h].setPosSize(y,r),h++)}}}};
b.prototype.clearBackground=function(){CB.LOG("Area.ClearBackground","LogBold");this.drawBackground(this.cbcanvas.bufferCtx);this.cbcanvas.requestRedraw()};b.prototype.onBoardReady=function(b){--this.nBoardCallbacksExpected;0>=this.nBoardCallbacksExpected&&(CB.LOG("Area.OnBoardReady..redraw","LogBlue","board"),this.drawBackground(this.cbcanvas.bufferCtx),this.cbcanvas.requestRedraw(),this.boards.forEach(function(b){b.setTitleVisible(!0);void 0!==b.rightWin&&b.rightWin.setVisible(!0)}),this.nBoardCallbacksExpected=
this.boards.length);this.infoWin&&$(this.infoWin).show()};b.prototype.onBGReady=function(){this.drawBackground(this.cbcanvas.bufferCtx);this.cbcanvas.requestRedraw()};b.prototype.isTransparent=function(){return this.options?this.options.transparent:!1};b.prototype.boardHasShadow=function(){return this.options?this.options.boardShadow&&this.needsShadows:this.needsShadows};return b}();"use strict";
CB.RawBoardControl=function(){var c=1,b=function(){this.options={};this.permanentAttributes=[]};b.prototype.init=function(b,d,e,l){this.cbcanvas||(this.cbcanvas=b,this.ptTopLeft={x:0,y:0},this.y=0,this.width=this.nBoardOuterW=d,this.height=this.nBoardOuterH=e,this.debugName=l,this.blackIsBottom=!1,this.allowInput=!0,this.enableEvaluation=!1,this.evaluation=0,this.enableCoordinates=!0,this.calcGeometry(),this.board=new CB.Board,this.moveEntry=new CB.MoveEntry(this),this.legalFromSquares={},this.pieceFontName=
"DiagramTTFritz",this.boardSprites=new CB.BoardSprites,this.animation=new CB.Animation(this.cbcanvas),this.jobsWaitingForSpriteLoad=[],this.onReadyHandlers=new CB.Handlers(this),this.idPieceFactoryHandler=null,this.nMarginW=1,V15.Vb.callOnSquaresLoaded=this.onSquareTexturesLoaded.bind(this),this.uniqueId=c++,this.animSteps={forMove:.6,forPosition:1},this.resizeTimer=new CB.Timer(this.resizeHdl.bind(this)),this.animation.callOnAnimFinished=function(){this.currPiece&&this.buttonDown&&(this.currPiece.moveTo(this.cbcanvas.bufferCtx,
this.currPiece.pos),this.cbcanvas.joinClipRect(this.currPiece.getMoveClipRect()));this.renderQueuedAttributes(!0);this.callOnAnimFinished&&this.callOnAnimFinished(this)}.bind(this),this.animation.callOnBeforeEveryStep=function(){this.currPiece&&this.buttonDown&&(this.currPiece.hide(this.cbcanvas.bufferCtx),this.currPiece.deleteBackground(),this.cbcanvas.joinClipRect(this.currPiece.getMoveClipRect()))}.bind(this),this.animation.callOnAfterEveryStep=function(){this.currPiece&&this.buttonDown&&(this.currPiece.moveTo(this.cbcanvas.bufferCtx,
this.currPiece.pos),this.cbcanvas.joinClipRect(this.currPiece.getMoveClipRect()))}.bind(this))};b.prototype.destroy=function(){this.destroyTitle();this.destroyMessage();this.destroyRightWin();this.destroyBottomWin();this.destroySubTitle();this.onReadyHandlers.remove(this.idBoardAreaHandler);this.onReadyHandlers.empty();this.idStyleListener&&glSettings.removeOnBoardStyleListener(this.idStyleListener);this.setGame(null);this.enableEvaluation=!1;this.shouldAnimatePosChange=this.fnBoardClick=this.fnSquareRelease=
this.fnSquareChangeInMouseMove=this.fnMarkSquaresOnButtonDown=this.fnSquareClick=null;this.pieceSpriteFactory&&null!=this.idPieceFactoryHandler&&this.pieceSpriteFactory.removeOnLoadedHandler(this.idPieceFactoryHandler);this.idPieceFactoryHandler=null};b.prototype.onRecycle=function(){};b.prototype.addStyleListener=function(){this.idStyleListener=glSettings.addOnBoardStyleListener(this.onBoardStyle.bind(this))};b.prototype.onBoardStyle=function(b,d){V15.setBoardTextures(CB.BoardTextures.prototype.getTexturesForPieceStyle(b));
this.changeBoardStyle(b,d)};b.prototype.changeBoardStyle=function(b,d){CB.PieceSpriteFactory.resetCache();this.pieceFontName=d;this.nSqPix=0};b.prototype.setPosSize=function(b,d){this.ptSetPos=b;var c=new CB.Size(0,0),e=new CB.Size(0,0);void 0!==this.subTitleWin&&(e.h=this.cbcanvas.pixToZoom(7));this.ptTopLeft=new CB.Point(Math.round(b.x+c.w),Math.round(b.y+c.h));this.width=Math.round(d.w-c.w);this.height=Math.round(d.h-c.h-e.h);this.resize(this.width,this.height)};b.prototype.getPos=function(){return this.ptSetPos?
this.ptSetPos:this.ptTopLeft};b.prototype.beforeResize=function(){this.titleWin&&this.titleWin.setVisible(!1)};b.prototype.resize=function(b,d){this.killAnimations();this.width=b;this.height=d;CB.LOG("RawBrd.RESIZE: w="+this.width+", h="+this.height,"LogBold","resize");b&&d?this.resizeTimer.runOnce(10):this.resizeTimer.stop();this.currPiece&&this.currPiece.deleteBackground()};b.prototype.resizeHdl=function(){this.resizeTimer.stop();this.killAnimations();this.renderedAttributes=[];var b=this.nSqPix;
this.calcGeometry();b!=this.nSqPix||void 0===this.pieceSpriteFactory||this.rightWin?(this.boardSprites=new CB.BoardSprites,this.pieceSpriteFactory=this.createPieceSpriteFactory()):this.boardSprites.isAllLoaded()&&(this.boardSprites.deleteBackgrounds(),this.onReadyHandlers.count()?this.onReadyHandlers.execute():this.cbcanvas.requestRedraw());this.canShowTitle()?(this.titleWin.onResize(this),this.titleWin.setVisible(!0)):this.titleWin&&this.titleWin.setVisible(!1);if(void 0!==this.messageWin)this.messageWin.onResize(this);
if(void 0!==this.rightWin)this.rightWin.onResize(this);void 0!==this.bottomWin&&(this.bottomWin.canShowIfHeight(this.height,this.cbcanvas)?(this.bottomWin.setVisible(!0),this.bottomWin.onResize(this)):this.bottomWin.setVisible(!1));this.subTitleWin&&(this.subTitleWin.onResize(this),this.subTitleWin.setVisible(!0))};b.prototype.createPieceSpriteFactory=function(){var b=CB.PieceSpriteFactory.getCachedFactory(this.pieceFontName,this.nSqPix);b.loaded?(this.idPieceFactoryHandler=null,(new CB.Timer(function(){this.createBoardSprites()}.bind(this))).runOnce(10)):
this.idPieceFactoryHandler=b.addOnLoadedHandler(this.createBoardSprites.bind(this));return b};b.prototype.calcGeometry=function(){var b=this.height,d,c;this.options?(d=this.options.topDist||0,c=this.options.bottomDist||0,!d&&this.options.marginDistDivisor&&(d=b/this.options.marginDistDivisor),!c&&this.options.marginDistDivisor&&(c=b/this.options.marginDistDivisor)):(d=V15.config.board2DTopOffset,c=V15.config.board2DBottomOffset);b-=d+c;d=0;this.canShowTitle()&&(d=this.titleWin.getDesiredHeight(this.height,
this.cbcanvas),this.titleWin.getSpacingToBoard&&(d+=this.titleWin.getSpacingToBoard(this.height,this.cbcanvas)));b-=d;c=0;void 0!==this.bottomWin&&this.bottomWin.canShowIfHeight(this.height,this.cbcanvas)&&(c=this.bottomWin.getDesiredHeight(this.height,this.cbcanvas),this.bottomWin.confirmHeight(c,this.cbcanvas),c+=this.bottomWin.getSpacingToBoard(this.height,this.cbcanvas),b-=c);var b=Math.round(b),e=this.width,q=0;void 0!==this.rightWin&&(q=this.rightWin.getDesiredWidth(this.width,this.height,this.cbcanvas));
e-=q;this.nBoardOuterW=Math.min(e-.056*e,b);this.options&&this.options.marginDistDivisor&&(this.nBoardOuterW-=Math.floor(this.nBoardOuterW/this.options.marginDistDivisor));this.enableCoordinates=480<=this.nBoardOuterW;this.options&&this.options.minWForCoordinates&&(this.enableCoordinates=this.nBoardOuterW>=this.options.minWForCoordinates);this.nMarginW=this.calcMarginW();this.nBoardInnerW=this.nBoardOuterW-2*this.nMarginW;this.nDesiredSqPix=this.nSqPix=Math.floor(this.nBoardInnerW/8);this.nSqPix=
CB.RawBoardControl.getAvailSqPix(this.nDesiredSqPix);1>this.nSqPix&&(this.nSqPix=1);this.nBoardInnerW=8*this.nSqPix;this.nBoardOuterW=this.nBoardInnerW+2*this.nMarginW;this.sqOffs=0;this.x0=Math.floor(this.ptTopLeft.x+(this.width-this.nBoardOuterW-q)/2+.5);this.y0=Math.floor(this.ptTopLeft.y+d+Math.min((this.height-d-c-this.nBoardOuterW)/2,100));this.options&&this.options.shiftXPercent&&(this.x0=Math.floor(this.x0+this.nBoardOuterW*this.options.shiftXPercent/100))};b.getAvailSqPix=function(b){var d=
[160,152,144,138,132,126,120,114,110,106,102,98,94,90,88,84,82,80,78,76,74,72,70,68,66,64,62,60,58,56,54,52,50,48,46,44,42,41,40,39,38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,12,10,8],c;for(c=0;c<d.length;c++)if(b>=d[c]){b=d[c];break}c>=d.length&&(b=8);return b};b.prototype.calcMarginW=function(){return this.enableCoordinates?this.options&&this.options.bigCoords?Math.max(12,Math.round(Math.min(24,this.nBoardOuterW/25))):Math.max(6,Math.round(Math.min(16,this.nBoardOuterW/
40))):Math.round(Math.min(12,this.nBoardOuterW/60))};b.prototype.setTitleText=function(b){this.titleWin&&this.titleWin.setText(b);this.debugName=b};b.prototype.addTitle=function(b,d,c){void 0===this.titleWin&&(this.titleWin=new CB.BoardTitle(this,b,function(b){this.fnBoardClick(this.uniqueId);b.preventDefault()}.bind(this),"",d,function(b){c(b)}));return this.titleWin};b.prototype.addLogo=function(b){void 0===this.titleWin&&(this.titleWin=new CB.BoardLogo(this,b));return this.titleWin};b.prototype.setTitleWin=
function(b){this.destroyTitle();this.titleWin=b;this.resizeHdl()};b.prototype.setTitleAndBottom=function(b,d){this.destroyTitle();this.destroyBottomWin();this.titleWin=b;this.bottomWin=d};b.prototype.canShowTitle=function(){return window.V15&&V15.isBoardOnlyApp()?this.titleWin&&210<Math.min(this.height,this.width):this.titleWin&&100<Math.min(this.height,this.width)};b.prototype.setTitleVisible=function(b){this.canShowTitle()&&this.titleWin.setVisible(b)};b.prototype.addSubTitle=function(){this.subTitleWin||
(this.subTitleWin=new CB.BoardSubTitle(this),this.resizeTimer.runOnce(10));return this.subTitleWin};b.prototype.setLeftSpace=function(b){this.nLeftSpace=b};b.prototype.addPlayingClock=function(b){return this.elemClock=this.titleWin=new CB.PlayingClockElm(this,this.getOuterRect().h/16,b)};b.prototype.removePlayingClock=function(){this.elemClock&&(this.elemClock.destroy(),this.elemClock=null,this.destroyTitle(),this.titleWin=null)};b.prototype.destroyTitle=function(){this.titleWin&&this.titleWin.destroy();
delete this.titleWin};b.prototype.destroySubTitle=function(){this.subTitleWin&&(this.subTitleWin.destroy(),delete this.subTitleWin)};b.prototype.destroyMessage=function(){this.messageWin&&this.messageWin.destroy();delete this.messageWin};b.prototype.destroyRightWin=function(){this.rightWin&&this.rightWin.destroy();delete this.rightWin};b.prototype.destroyBottomWin=function(){this.bottomWin&&this.bottomWin.destroy();delete this.bottomWin};b.prototype.hasClock=function(){return this.titleWin&&this.titleWin.getClock()};
b.prototype.getClockDisplay=function(){if(this.titleWin)return this.titleWin.getClock()};b.prototype.addModalMessage=function(b){this.destroyMessage();return this.addMessage(b,!0,!0)};b.prototype.addMessage=function(b,d,c){if(this.messageWin||d)this.messageWin?this.messageWin.setText(b):(this.messageWin=new CB.BoardMessage(this,b,c),this.messageWin.setVisible(!0)),this.messageWin.onResize(this)};b.prototype.addBubble=function(b,d,c,e){this.messageWin&&(this.messageWin.destroy(),delete this.messageWin);
this.messageWin=new CB.BoardBubble(b,d,c,e);this.messageWin.setVisible(!0);this.messageWin.onResize(this)};b.prototype.addRightWin=function(b){this.rightWin=b;this.rightWin.onResize(this)};b.prototype.addSideIcon=function(b){this.rightWin||(this.rightWin=new CB.BoardSideIcon(this,b),this.rightWin.getDesiredWidth(this.width,this.height,this.cbcanvas),this.rightWin.onResize(this))};b.prototype.destroySideIcon=function(){this.rightWin&&this.rightWin.destroy();delete this.rightWin};b.prototype.addBottomWin=
function(b){if(this.bottomWin=b)this.bottomWin.onResize(this)};b.prototype.markAsSelected=function(b){V15.isBoardOnlyApp()||this.titleWin&&this.titleWin.markAsSelected(b)};b.prototype.onMouseEnter=function(b,d){this.getClickPos(d)};b.prototype.onContextMenu=function(b,d){};b.prototype.onMouseLeave=function(b,d){this.getClickPos(d)};var d=new CB.Vr,e=new CB.Vr;b.prototype.onMouseMove=function(b,c){var h=this.getClickPos(c);if(this.enableEvaluation&&this.evaluation)if(this.evalBulgeRect&&this.evalBulgeRect.isInside(h.x,
h.y)){var l=this.evaluation.strEval+"<br/><em>"+this.evaluation.strLine+"</em>";d.exec(function(){this.showEvalToolTip(new CB.Point(b.clientX,b.clientY),l)}.bind(this),200)}else this.hideEvalToolTip();this.toMoveRect&&this.toMoveRect.isInside(h.x,h.y)&&this._game?(l=this._game.getCurPos().getBTM()?"Black's move":"White's move",l+=", click to flip board",e.exec(function(){this.toMoveToolTipShown||this.showToMoveToolTip(new CB.Point(b.clientX,b.clientY),l);this.toMoveToolTipShown=!0}.bind(this),200)):
this.hideToMoveToolTip()};b.prototype.onMouseUp=function(b,d){var c=this.getClickPos(d);this.toMoveRect&&this.toMoveRect.isInside(c.x,c.y)&&this.flipBoard()};b.prototype.showEvalToolTip=function(b,d){this.showToolTip("Eval",b,d,new CB.Size(190,40),e)};b.prototype.hideEvalToolTip=function(){this.hideToolTip("Eval",d)};b.prototype.showToMoveToolTip=function(b,d){this.showToolTip("ToMove",b,d,new CB.Size(140,35),e,2500)};b.prototype.showToolTip=function(b,d,c,e,q,r){var t=this;!t[b]&&c&&(V15.isBoardOnlyApp()&&
(d.x=d.x-e.w-5),t[b]=new CB.ToolTip,t[b].setText(c),t[b].setPosSize(d,e),t[b].setVisible(!0),(new CB.Timer(function(){t.hideToolTip(b,q)}.bind(t))).runOnce(r||6E3))};b.prototype.hideToMoveToolTip=function(){this.hideToolTip("ToMove",e)};b.prototype.hideToolTip=function(b,d){d.stop();this[b]&&(this[b].destroy(),delete this[b])};b.prototype.movePieceToSq=function(b,d){this.moveSprite(b,this.getSquareCenterPos(d));b.lastSq=d};b.prototype.moveSprite=function(b,d){b.moveTo(this.cbcanvas.bufferCtx,d);this.cbcanvas.requestAnimation(b.getMoveClipRect())};
b.prototype.hideSprite=function(b){b&&(b.hide(this.cbcanvas.bufferCtx),this.cbcanvas.requestAnimation(b.getMoveClipRect()))};b.prototype.getPromFromClickPos=function(b,d){var c=this.getPixPos(b);return d.x<c.x+.7*this.nSqPix?CB.Piece.QUEEN:d.y<c.y+.3*this.nSqPix?CB.Piece.KNIGHT:d.y<c.y+.6*this.nSqPix?CB.Piece.BISHOP:CB.Piece.ROOK};b.prototype.setBoardAttributes=function(b,d){for(var c=0;c<b.length;c++);c=this.renderAttributes(b);b.length&&d&&this.cbcanvas.requestAnimation(c)};b.prototype.concatAttributes=
function(b){if(this.renderedAttributes&&b)for(var d=0;d<b.length;d++)-1==this.renderedAttributes.indexOf(b[d])&&this.renderedAttributes.push(b[d]);else this.renderedAttributes=b};b.prototype.addAttributes=function(b,d){this.queueBoardAttributes(b,{eraseQueue:!0,renderNow:!0,requestAnimInRender:!0,permanent:d})};b.prototype.renderAttributes=function(b,d){this.concatAttributes(b);for(var c=null,e=0;e<b.length;e++){b[e].boardControl=this;var q=b[e].draw(d||this.cbcanvas.bufferCtx),c=c?c.getUnion(q):
q}return c};b.prototype.undoAttributes=function(b){if(void 0!==this.renderedAttributes&&this.renderedAttributes.length){CB.LOG("Undo Attributes: len="+this.renderedAttributes.length,"LogBoard");for(var d=null,c=0;c<this.renderedAttributes.length;c++){for(var e=!1,q=0;!e&&q<this.permanentAttributes.length;q++)e=this.renderedAttributes[c].id==this.permanentAttributes[q].id||this.renderedAttributes[c].sq==this.permanentAttributes[q].sq&&"undefined"!=typeof this.renderedAttributes[c].sq;if(!e&&b&&this._game){var r=
this._game.getMoveBaggage();if(r&&r.attributes)for(q=0;!e&&q<r.attributes.length;q++)e=this.renderedAttributes[c].id==r.attributes[q].id||this.renderedAttributes[c].sq==r.attributes[q].sq&&"undefined"!=typeof this.renderedAttributes[c].sq}e||(e=this.renderedAttributes[c].undo(this.cbcanvas.bufferCtx,function(b){return this.getPixPos(nSq)}.bind(this)),d=d?d.getUnion(e):e)}this.cbcanvas.requestAnimation(d);this.renderedAttributes=[].concat(this.permanentAttributes)}};b.prototype.queueBoardAttributes=
function(b,d){if(d.permanent)if(2==d.permanent)for(var c=0;c<b.length;c++){for(var e=!1,q=0;!e&&q<this.permanentAttributes.length;q++)e=b[c].id==this.permanentAttributes[q].id;e||this.permanentAttributes.push(b[c])}else 1==d.permanent&&this._game&&(c=this._game.getMoveBaggage()||{},c.attributes=(c.attributes||[]).concat(b),this._game.setMoveBaggage(c));else this.queuedAttributes=!this.queuedAttributes||d&&d.eraseQueue?b:this.queuedAttributes.concat(b);d.renderNow&&!this.isAnimationUnderway()&&this.renderQueuedAttributes(d.requestAnimInRender,
d.ctx)};b.prototype.clearBaggageAttributes=function(){this._game.setMoveBaggage(null)};b.prototype.clearPermanentAttributes=function(){this.permanentAttributes=[]};b.prototype.clearBoardAttributes=function(){this.queuedAttributes=[]};b.prototype.renderQueuedAttributes=function(b,d){if(this.permanentAttributes){this.queuedAttributes=this.queuedAttributes||[];for(var c=0;c<this.permanentAttributes.length;c++)-1==this.queuedAttributes.indexOf(this.permanentAttributes[c])&&this.queuedAttributes.push(this.permanentAttributes[c])}this.queuedAttributes&&
this.queuedAttributes.length&&(c=this.renderAttributes(this.queuedAttributes,d),b&&this.cbcanvas.requestAnimation(c,!0),this.queuedAttributes=[])};b.prototype.clearAll=function(){this.clearBoardAttributes();this.destroyMessage();this.redraw()};b.prototype.isAnimationUnderway=function(){return this.jobsWaitingForSpriteLoad.length||this.animation.jobs.length||this.animation.inAnimation};b.prototype.runFunAnimation=function(b){this.jobsWaitingForSpriteLoad=(this.jobsWaitingForSpriteLoad||[]).concat(b);
this.animateWhenSpritesReady();this.funAnimJobs=(this.funAnimJobs||[]).concat(b)};b.prototype.undoFunAnimations=function(){this.funAnimJobs&&this.funAnimJobs.forEach(function(b){b.hide(this.cbcanvas.bufferCtx)}.bind(this));this.funAnimJobs=[]};b.prototype.animateCapture=function(b){this.hideSprite(this.currPiece);0<=b&&(this.drawSquare(this.cbcanvas.bufferCtx,b),this.currPiece.saveBackground(this.cbcanvas.bufferCtx),this.moveSprite(this.currPiece,this.getSquareCenterPos(b)))};b.prototype.animateFromTo=
function(b,d,c,e){if(void 0!==b){var q=c.subtract(d);this.nAnimCount=e;this.posAnimTarget=c;this.vecAnimDisplace=new CB.Vector(q.x/this.nAnimCount,q.y/this.nAnimCount);this.animSprite=b;this.animCurrPos=d;b=new CB.Rect;b.fromTwoPoints(d.x,d.y,c.x,c.y);this.cbcanvas.joinClipRect(b);this.idRequestStepAnim=window.requestAnimationFrame(this.doAnimateStep.bind(this))}};b.prototype.doAnimateStep=function(){this.animSprite.moveTo(this.cbcanvas.bufferCtx,this.animCurrPos);this.animCurrPos=0===this.nAnimCount?
this.posAnimTarget:this.animCurrPos.add(this.vecAnimDisplace);this.cbcanvas.joinClipRect(this.animSprite.getMoveClipRect());this.cbcanvas._drawDoubleBufferClipped();0<this.nAnimCount&&(this.idRequestStepAnim=window.requestAnimationFrame(this.doAnimateStep.bind(this)));this.nAnimCount--};b.prototype.loadedAll=function(){return void 0!==this.pieceSpriteFactory&&this.pieceSpriteFactory.loaded&&this.boardSprites.isAllLoaded()&&V15.Vb.isBoardValid()?!0:!1};b.prototype.resetInternalBoard=function(){this.board=
new CB.Board};b.prototype.setBoard=function(b,d){if(this.blindMoves)this.blindSqs=b;else if(this.undoAttributes(),this.undoFunAnimations(),!ObjUtil.equals(b,this.board.sqs)&&1<this.nSqPix)if(this.loadedAll()){var c=!1;if(d&&this.canAnimate()){var e=this.boardSprites.changeBoard(this.pieceSpriteFactory,this.board.sqs,b);e&&e.length?(this.board.copyFrom(b),this.jobsWaitingForSpriteLoad=e,this.animateWhenSpritesReady(),this.checkCurrPieceCaptured(),c=this.isAnimated=!0):this.sqArrNotDrawn=b}c||(CB.LOG("Set Board, No Animation",
"LogRed","board"),d&&this.animation.currFPS&&this.animation.currFPS++,this.board.copyFrom(b),this.queuedAttributes=[],this.redraw(),this.isAnimated=!1);this.drawToMove(this.cbcanvas.bufferCtx,!1)}else this.board.copyFrom(b)};b.prototype.prepareFullRedraw=function(){delete this.currPiece;this.buttonDown=!1;this.killAnimations();this.cbcanvas.cancelAnimationFrames()};b.prototype.redraw=function(b){CB.LOG("Redraw","LogBoard","board");try{if(!(1>=this.nSqPix)){var d=-1;this.currPiece&&this.buttonDown&&
-1!=this.fromSq&&(d=this.fromSq);this.boardSprites.setup(this.pieceSpriteFactory,this.board.sqs,d);this.killAnimations();this.jobsWaitingForSpriteLoad=[];this.currPiece&&this.buttonDown&&this.currPiece.deleteBackground();delete this.markedMove;if(!this.draw(this.cbcanvas.bufferCtx))return CB.LOG("Draw failed in redraw","LogError"),!1;this.currPiece&&this.buttonDown&&(-1!=this.fromSq&&"undefined"!=typeof this.fromSq&&this.drawSquare(this.cbcanvas.bufferCtx,this.fromSq),this.currPiece.moveTo(this.cbcanvas.bufferCtx,
this.clickPos.add(this.clickOffs)));this.addBoardColourAndArrowsFromAnno(!0);this.renderQueuedAttributes(!1);if(!b){var c=this.getOuterRect();this.currPiece&&(c=c.getUnion(this.currPiece.getMoveClipRect()));this.cbcanvas.requestAnimation(c,!0)}this.sqArrNotDrawn=null;return!0}}catch(e){CB.LogException("BoardRedraw",e)}};b.prototype.checkCurrPieceCaptured=function(){this.currPiece&&-1!=this.fromSq&&this.board.sqs[this.fromSq]!=this.currPiece.piece&&(delete this.currPiece,this.fromSq=-1)};b.prototype.canAnimate=
function(){return!this.animation.currFPS||this.animation.currFPS>V15.minFPS};b.prototype.killAnimations=function(){this.animation.kill();this.idRequestStepAnim&&(window.cancelAnimationFrame(this.idRequestStepAnim),this.idRequestStepAnim=0)};b.prototype.quickFinishAnimations=function(){this.animation.quickFinish();this.idRequestStepAnim&&(window.cancelAnimationFrame(this.idRequestStepAnim),this.idRequestStepAnim=0)};b.prototype.animateWhenSpritesReady=function(){function b(d,c,e){return 40>d.currFPS?
30>d.currFPS?20>d.currFPS?.25:.5:Math.min(1,c.forMove):3>e?c.forMove:c.forPosition}for(var d=!0,c=0;c<this.jobsWaitingForSpriteLoad.length;c++)this.jobsWaitingForSpriteLoad[c].loaded()||(this.jobsWaitingForSpriteLoad[c].tryLoadCnt=(this.jobsWaitingForSpriteLoad[c].tryLoadCnt||0)+1,d=20<this.jobsWaitingForSpriteLoad[c].tryLoadCnt);if(d){for(c=0;c<this.jobsWaitingForSpriteLoad.length;c++)if(this.jobsWaitingForSpriteLoad[c].isPieceAnim){var e,d=-1==this.jobsWaitingForSpriteLoad[c].sqFrom?this.getPieceRepositoryPos(this.jobsWaitingForSpriteLoad[c].piece):
this.getSquareCenterPos(this.jobsWaitingForSpriteLoad[c].sqFrom);e=-1==this.jobsWaitingForSpriteLoad[c].sqTo?this.getPieceRepositoryPos(this.jobsWaitingForSpriteLoad[c].piece):this.getSquareCenterPos(this.jobsWaitingForSpriteLoad[c].sqTo);this.jobsWaitingForSpriteLoad[c].ptFrom=d;this.jobsWaitingForSpriteLoad[c].ptTo=e}c=this.jobsWaitingForSpriteLoad;c.length&&this.animation.startMultiAnimation(c,b(this.animation,this.animSteps,c.length),this.getOuterRect());this.jobsWaitingForSpriteLoad=[]}else setTimeout(function(){this.animateWhenSpritesReady()}.bind(this),
100)};b.prototype.draw=function(b,d){if(!isNaN(this.x0)&&1<this.nSqPix&&1<this.nDesiredSqPix){CB.LOG("Board Draw: ("+this.nSqPix+"/"+this.nDesiredSqPix+"): "+this.debugName,"LogBold","board");if(this.drawForeground(b,d))this.addBoardColourAndArrowsFromAnno(!1,this.cbcanvas.bufferCtx);else return!1;void 0!==this.drawExtras&&this.drawExtras(this.getOuterRect())}return!0};b.prototype.drawWood=function(b,d){return this.drawMargin(b,d)?this.drawSquares(b):!1};b.prototype.drawForeground=function(b,d){if(this.drawWood(b,
d)&&this.pieceSpriteFactory&&this.pieceSpriteFactory.loaded)return this.drawPieces(b),!0};b.prototype.getInnerRect=function(){return new CB.Rect(this.x0+this.nMarginW,this.y0+this.nMarginW,this.x0+this.nMarginW+this.nBoardInnerW,this.y0+this.nMarginW+this.nBoardInnerW)};b.prototype.getOuterRect=function(){return new CB.Rect(this.x0,this.y0,this.x0+this.nBoardOuterW,this.y0+this.nBoardOuterW)};b.prototype.drawMargin=function(b,d){if(4>this.nBoardOuterW)return!0;try{return this.loadedAll()?(b.save(),
d&&this.setDefaultShadow(b,.6),V15.Vb.margin.drawTiled(b,this.x0,this.y0,this.nBoardOuterW,this.nBoardOuterW),V15.Vb.clrMarginSepLine&&(b.lineWidth=1,CB.CanvasTools.drawRect(b,this.getInnerRect(),V15.Vb.clrMarginSepLine)),b.restore(),this.enableEvaluation&&this.drawEvalBulge(b,d,this.evaluation),this.enableCoordinates&&this.drawCoordinates(b),this.drawToMove(b),!0):!1}catch(c){CB.LogException("RawB:DrawMargin",c)}};b.prototype.drawCoordinates=function(b){b.save();var d=Math.round(.8*this.nMarginW);
b.font=d+"px "+V15.config.defaultFont;var c=null;V15.Vb&&(c=V15.Vb.clrCoordinates);b.fillStyle=c||"yellow";var c=b.measureText("A").width,e=this.x0+(this.nMarginW-c)/2,q=this.y0+this.nSqPix/2+d/2+this.nMarginW-.2*d;V15.panelMgr&&V15.panelMgr.viewport&&V15.panelMgr.viewport.rtl&&(e+=8*this.nSqPix+this.nMarginW);for(var r=0;8>r;r++)this.blackIsBottom?b.fillText(r+1,e,q+r*this.nSqPix):b.fillText(8-r,e,q+r*this.nSqPix);e=this.x0+(this.nSqPix-c)/2+this.nMarginW+.1*c;q=this.y0+this.nBoardInnerW+this.nMarginW+
(this.nMarginW-d)/2+d-.2*d;for(r=0;8>r;r++)this.blackIsBottom?b.fillText(String.fromCharCode(104-r),e+r*this.nSqPix,q):b.fillText(String.fromCharCode(97+r),e+r*this.nSqPix,q);b.restore()};b.prototype.drawToMove=function(b){if(this._game){this.drawToMoveBackground(b);b.save();var d=.34*this.getBulgeW(this.getOuterRect().w),c=this.x0+2*this.nMarginW+this.nBoardInnerW+.9*d,e=this.y0+this.nBoardInnerW+2*this.nMarginW-d-.02*this.nBoardInnerW;b.beginPath();b.arc(c,e,d,0,2*Math.PI,!1);var q=b.createRadialGradient(c-
.3*d,e-.2*d,.1*d,c-.2*d,e-.2*d,d);this._game.getCurPos().getBTM()?(q.addColorStop(0,"rgba( 150, 150, 160, 1.0 )"),q.addColorStop(1,"rgba( 60, 30, 30, 1.0 )")):(q.addColorStop(0,"rgba( 250, 250, 255, 1.0 )"),q.addColorStop(1,"rgba( 220, 220, 225, 1.0 )"));b.fillStyle=q;b.lineWidth=0;this.setDefaultShadow(b,.8,2,3);b.fill();b.restore();this.toMoveRect=new CB.Rect(c-d,e-d,c+2*d,e+2*d);this.cbcanvas.requestAnimation(this.toMoveRect)}};b.prototype.getBulgeW=function(b){return Math.min(Math.max(.054*b,
5),30)};b.prototype.drawToMoveBackground=function(b){var d=this.getOuterRect(),c=.09*d.h,e=this.getBulgeW(d.w),q=.4*c,r=new CB.Path,t=d.bottom-c,v=d.bottom,d=d.right;this.toMoveBulgeRect=new CB.Rect(d,t,d+e,t-c);r.push(new CB.Point(d,t));r.push(new CB.Point(e/8+d,q/4+t));r.push(new CB.Point(e/2+d,q/2+t));r.push(new CB.Point(3*e/4+d,3*q/4+t));r.push(new CB.Point(e+d,q+t));r.push(new CB.Point(e+d,v));r.push(new CB.Point(d,v));b.save();r.curve(b);c=V15.Vb.margin.getPattern(b);b.fillStyle=c||"brown";
b.fill();b.restore()};b.prototype.setDefaultShadow=function(b,d,c,e){c=c||Math.max(1,Math.min(4,Math.round(Math.sqrt(this.nBoardOuterW/60))));b.shadowOffsetX=c;b.shadowOffsetY=c;b.shadowBlur=e||3*c;b.shadowColor="rgba( 60, 30, 15, "+d+" )";return c};b.prototype.displayEvaluation=function(b,d){var c=b!=this.enableEvaluation;this.enableEvaluation=b;this.evaluation=d;b&&c?(new CB.Timer(function(){this.resizeHdl();delete this.markedMove;this.markLastMove(!0)}.bind(this))).runOnce(500):b&&(this.drawEvalBulge(this.cbcanvas.bufferCtx,
!1,this.evaluation),delete this.markedMove,this.cbcanvas.requestAnimation())};b.prototype.setEvaluationInvalid=function(){this.enableEvaluation&&this.evaluation&&(this.evaluation.isInvalid=!0,(new CB.Timer(function(){this.resizeHdl();delete this.markedMove;this.markLastMove(!0)}.bind(this))).runOnce(200))};b.prototype.displayCoordinates=function(b){this.enableCoordinates=b};b.prototype.drawEvalBulge=function(b,d,c){var e=this.getOuterRect();if(!(50>e.width)){this.evaluation=c;var q=.5*e.h,r=this.getBulgeW(e.w),
t=.15*q,v=new CB.Path,y=e.top+(e.h-q)/2,e=e.right;this.evalBulgeRect=new CB.Rect(e,y,e+r,y+q);v.push(new CB.Point(e,y));v.push(new CB.Point(r/8+e,t/4+y));v.push(new CB.Point(r/2+e,t/2+y));v.push(new CB.Point(7*r/8+e,3*t/4+y));v.push(new CB.Point(r+e,t+y));var A=y+(q-t);v.push(new CB.Point(r+e,A));v.push(new CB.Point(7*r/8+e,t/4+A));v.push(new CB.Point(r/2+e,t/2+A));v.push(new CB.Point(r/8+e,3*t/4+A));v.push(new CB.Point(e,A+t));b.save();v.curve(b);v=V15.Vb.margin.getPattern(b);b.fillStyle=v||"brown";
d&&this.setDefaultShadow(b,1);this.bulgeRect=new CB.Rect(e,y,e+r,y+q-2*t);b.fill();d=y+t+2;y=.35*r;e+=(r-y)/5;q=new CB.Rect(e,d,e+y,d+(q-2*t-4));t=b.createLinearGradient(q.left,q.top,q.right,q.top);this.scaleEval(c.value,.3,143);e=new CB.Color(216.75,216.75,216.75,1);d=new CB.Color(255,255,255,1);y=new CB.Color(191.25,191.25,191.25,1);t.addColorStop(0,e.toString());t.addColorStop(.3,d.toString());t.addColorStop(1,y.toString());b.lineWidth=q.w;b.strokeStyle=t;b.lineCap="round";this.setDefaultShadow(b,
1,2,3);CB.CanvasTools.drawLine(b,q.left+q.w/2,q.top,q.left+q.w/2,q.bottom);b.shadowColor="black";this.setDefaultShadow(b,0,0,0);this.drawEvalMarker(b,0,"black",q);c.isInvalid||(c=-this.scaleEval(c.value,.7,333)*q.h/2+q.h/2+q.top,t=b.createLinearGradient(q.left+q.w/2,c-2,q.left+q.w/2,c+2),t.addColorStop(0,"rgba( 0, 220, 0, 1.0 )"),t.addColorStop(.4,"rgba( 0, 235, 0, 1.0 )"),t.addColorStop(1,"rgba( 0, 200, 0, 1.0 )"),b.strokeStyle=t,b.lineCap="round",b.lineWidth=Math.min(Math.max(2,r/2),7),this.setDefaultShadow(b,
.6,1,2),CB.CanvasTools.drawLine(b,q.left+1,c,q.right+1,c));b.restore()}};b.prototype.drawEvalMarker=function(b,d,c,e){d=-this.scaleEval(100*d,.7,333)*e.h/2+e.h/2+e.top;b.strokeStyle=c;b.lineWidth=1;b.lineCap="";CB.CanvasTools.drawLine(b,e.left,d,e.right+1,d)};b.prototype.scaleEval=function(b,d,c){d=(Math.pow(d,.01*Math.abs(b))-1)/(d-1)*100;d>c&&(d=c);0>b&&(d=-d);return d/c};b.prototype.drawSquares=function(b){if(V15.Vb.isBoardValid()){for(var d=0;64>d;d++)V15.Vb.drawSquare(b,d,this.nSqPix,this.getPixPos(d));
return!0}return!1};b.prototype.drawPieces=function(b){for(var d=0;64>d;d++){var c=this.boardSprites.getPiece(d);!c&&0<this.board.sqs[d]&&this.pieceSpriteFactory&&(CB.LOG("Emergency Draw: "+d,"LogError"),c=this.boardSprites.createSprite(this.pieceSpriteFactory,this.board.sqs[d],d));if(c){var e=this.getSquareCenterPos(d);c.moveToNoSave(b,e)}}};b.prototype.drawPiece=function(b,d){var c=this.boardSprites.getPiece(d);if(c){var e=this.getSquareCenterPos(d);c.moveToNoSave(b,e)}};b.prototype.restoreSquare=
function(b,d){if(this.board.sqs[d]){var c=this.boardSprites.getPiece(d);c&&(V15.Vb.drawSquare(b,d,this.nSqPix,this.getPixPos(d)),c.moveToNoSave(b,this.getSquareCenterPos(d)),c.setBackground(V15.Vb.getSquare(d,this.nSqPix)))}else V15.Vb.drawSquare(b,d,this.nSqPix,this.getPixPos(d))};b.prototype.drawSquare=function(b,d){V15.Vb.drawSquare(b,d,this.nSqPix,this.getPixPos(d))};b.prototype.onSquareTexturesLoaded=function(){CB.LOG("Textures OK","","board")};b.prototype.createBoardSprites=function(){void 0!==
this.pieceSpriteFactory&&(this.pieceSpriteFactory.isValid()?this.boardSprites.sqSidePix!==this.nSqPix&&(this.boardSprites.create(this.pieceSpriteFactory),this.boardSprites.setup(this.pieceSpriteFactory,this.board.sqs,this.getPixPos.bind(this)),setTimeout(this.drawIfAllReady.bind(this),300)):CB.LOG("PSpriteFactory not Valid Yet","LogRed","board"))};b.prototype.drawIfAllReady=function(){V15.Vb.isBoardValid()&&this.boardSprites.isAllLoaded()?(this.sqArrNotDrawn&&(CB.LOG("Set Buffered Board in DrawIfAllReady..",
"LogBold","board"),this.setBoard(this.sqArrNotDrawn,!1)),this.onReadyHandlers.count()?(CB.LOG("DRAWIFALLREADY - handlers","LogBold","board"),this.onReadyHandlers.execute()):(CB.LOG("DRAWIFALLREADY - redraw","LogBold","board"),this.cbcanvas.requestRedraw())):setTimeout(this.drawIfAllReady.bind(this),500)};b.prototype.isReady=function(){return V15.Vb.isBoardValid()&&this.boardSprites&&this.boardSprites.isAllLoaded()};b.prototype.getPixPos=function(b){var d=Math.floor(b/8);b%=8;this.blackIsBottom?(d=
Math.floor(this.x0+this.nMarginW+this.sqOffs+(7-d)*this.nSqPix),b=Math.floor(this.y0+this.nMarginW+this.sqOffs+b*this.nSqPix)):(d=Math.floor(this.x0+this.nMarginW+this.sqOffs+d*this.nSqPix),b=Math.floor(this.y0+this.nMarginW+this.sqOffs+(7-b)*this.nSqPix));return new CB.Point(d,b)};b.prototype.getSquareRect=function(b){b=this.getPixPos(b);return new CB.Rect(b.x,b.y,b.x+this.nSqPix,b.y+this.nSqPix)};b.prototype.getSquareCenterPos=function(b){return this.getPixPos(b).add(this.getCenterOffs())};b.prototype.isInMyArea=
function(b,d){var c=new CB.Rect,e=this.toMoveRect?this.toMoveRect.w:0;c.fromPosSize(new CB.Point(this.x0,this.y0),new CB.Size(this.width+e,this.height));return b>=c.left&&b<=c.right&&d>=c.top&&d<=c.bottom};b.prototype.getClickPos=function(b){ASSERT(void 0!==b.x);return new CB.Point(b.x,b.y)};b.prototype.getClickedSquare=function(b){var d=b.x-this.nMarginW-this.sqOffs-this.x0;b=b.y-this.nMarginW-this.sqOffs-this.y0;this.blackIsBottom?(d=7-Math.floor(d/this.nSqPix),b=Math.floor(b/this.nSqPix)):(d=Math.floor(d/
this.nSqPix),b=7-Math.floor(b/this.nSqPix));return 0<=d&&8>d&&0<=b&&8>b?8*d+b:-1};b.prototype.getGenerousClipRect=function(b,d){var c=CB.Square.getFile(b),e=CB.Square.getRank(b),q=CB.Square.getFile(d),r=CB.Square.getRank(d),t=Math.max(c,q),v=Math.min(e,r),c=CB.Square.get64(Math.min(c,q),Math.max(e,r)),v=CB.Square.get64(t,v),t=this.getPixPos(c),v=this.getPixPos(v);v.add(new CB.Point(this.nSqPix,this.nSqPix));c=new CB.Rect;c.fromTwoPoints(t.x,t.y,v.x,v.y);c.expand(this.nSqPix,this.nSqPix);return c};
b.prototype.getCenterOffs=function(){return new CB.Point(Math.floor(this.nSqPix/2),Math.floor(this.nSqPix/2))};b.prototype.getOffsFromSqCenter=function(b){var d=this.getPixPos(this.getClickedSquare(b)).add(this.getCenterOffs());CB.LOG("Click="+b+", center="+d);CB.LOG("Diff="+b.subtract(d));return d.subtract(b)};b.prototype.getPieceRepositoryPos=function(b){return new CB.Point(-500,-500)};b.prototype.handleRightButtonDown=function(b,d){this.redrawBlindBoard()};b.prototype.redrawBlindBoard=function(){this.blindMoves&&
(this.backBoard=this.board.sqs.slice(),this.board.copyFrom(this.blindSqs),this.redraw(!1),this.board.copyFrom(this.backBoard))};b.prototype.handleRightButtonUp=function(b,d){this.redraw(!1)};b.prototype.flipBoard=function(){this.setBlackIsBottom(!this.blackIsBottom,!0)};b.prototype.setBlackIsBottom=function(b,d){b!=this.blackIsBottom&&(this.blackIsBottom=b,this.killAnimations(),this.boardSprites.deleteBackgrounds(),d&&(this.destroyMessage(),this.prepareFullRedraw(),this.redraw(!0)),this.cbcanvas.requestRedraw(),
this.titleWin&&this.titleWin.notifyBoardTurned&&this.titleWin.notifyBoardTurned(this),this.bottomWin&&this.bottomWin.notifyBoardTurned&&this.bottomWin.notifyBoardTurned(this))};b.prototype.getSideToShow=function(){return this.blackIsBottom?CB.Side.BLACK:CB.Side.WHITE};b.prototype.setSideToShow=function(b){b!==this.getSideToShow()&&this.flipBoard()};b.prototype.setLegalFromSquares=function(b){this.legalFromSquares=b};b.prototype._game=null;b.prototype.setGame=function(b){this.permanentAttributes=[];
this.blindMoves||this.resetInternalBoard();this._game&&(this._game.removeOnCurPosChangedListener(this.idCurPosListener),this._game.removeOnChangedListener(this.idChangeListener),this._game.removeOnNavigateListener(this.idNavigate),this._game.removeOnMoveListener(this.idMove),this._game.removeOnHeaderChangedListener(this.idHeader));if(this._game=b){b=this._onGameCurPosChanged.bind(this);var d=this._onChanged.bind(this),c=this._onHeaderChanged.bind(this),e=this._onNavigate.bind(this),q=this._onMove.bind(this);
this.idCurPosListener=this._game.addOnCurPosChangedListener(b);this.idChangeListener=this._game.addOnChangedListener(d);this.idNavigate=this._game.addOnNavigateListener(e);this.idMove=this._game.addOnMoveListener(q);this.idHeader=this._game.addOnHeaderChangedListener(c);this.idRest=this._game.addOnResetGameListener(this._onResetGame.bind(this));this._onGameCurPosChanged(this._game,this._game.getCurPos(),!1);this._onHeaderChanged()}};b.prototype.getGame=function(){return this._game};b.prototype._onGameCurPosChanged=
function(b,d,c){CB.LOG("RawBoard._onCurPosChng","LogBoard","board");"undefined"==typeof c&&this.shouldAnimatePosChange&&(c=this.shouldAnimatePosChange());this.nextCurPosNoAnim&&(this.nextCurPosNoAnim=c=!1);b=!1;this.isAnimationUnderway()?(this._game&&this.setBoard(this._game.getCurPos().board,!1),CB.LOG("RawBoard._onCurPos::Redraw","","board"),b=!0):this._game&&this.setBoard(this._game.getCurPos().board,c);this.addBoardColourAndArrowsFromAnno();b&&this.markLastMove(!1);this.moveEntry.renderPreMoves()};
b.prototype.shouldAnimatePosChange=function(){return!0};b.prototype._onChanged=function(){this.addBoardColourAndArrowsFromAnno()};b.prototype._onResetGame=function(){CB.LOG("RawBoard._onResetGame","LogBoard");this.moveEntry.clearPreMoves()};b.prototype._onHeaderChanged=function(){this.titleWin&&this.titleWin.displaysHeader&&this.setTitleText(this._game.hdr.getStrPlayers(this.nSqPix>this.cbcanvas.zoomToPix(42)))};b.prototype._onMove=function(b){CB.LOG("RawBoard._onMove ","LogBoard","board");if(this.moveEntry)this.moveEntry.onMove()};
b.prototype._onNavigate=function(){this.markLastMove(!1)};b.prototype.addBoardColourAndArrowsFromAnno=function(b,d){var c=[].concat(this.permanentAttributes);if(this._game){var e=this._game.getAnno(CB.AnnoType.SQUARE_LIST);if(e)for(var q=0;q<e.length;q++){var r=new CB.BoardColouredSquare(e[q].field,e[q].getColour());r.fromAnno=!0;c.push(r)}if(e=this._game.getAnno(CB.AnnoType.ARROW_LIST))for(q=0;q<e.length;q++)r=new CB.BoardArrow(e[q].from,e[q].to,e[q].getColour()),r.fromAnno=!0,c.push(r)}this._game&&
(q=this._game.getMoveBaggage())&&q.attributes&&(c=c.concat(q.attributes));0<c.length&&(q=!1,b||(q=!0,this.shouldAnimatePosChange&&(q=!this.shouldAnimatePosChange())),d&&(q=!0),this.removeLastAnnoAttribsFromQueue(),this.pieceSpriteFactory&&this.pieceSpriteFactory.loaded||(q=!1,d=null),this.queueBoardAttributes(c,{eraseQueue:!1,renderNow:q,requestAnimInRender:q,ctx:d}))};b.prototype.markLastMove=function(b,d){if(this._game&&this._game.mainLine.length){var c=this._game.getLastMove();c&&(c!=this.markedMove||
d)&&(this.markedMove=c,c=new CB.BoardArrow(c.from,c.to),c.lastMove=!0,this.removeLastMarkedMoveFromQueue(),this.queueBoardAttributes([c],{eraseQueue:!1,renderNow:b||!this.canAnimate(),requestAnimInRender:!0}))}};b.prototype.removeLastMarkedMoveFromQueue=function(){if(this.queuedAttributes){var b=this.queuedAttributes.find(function(b){return b.lastMove}),b=this.queuedAttributes.indexOf(b);0<=b&&this.queuedAttributes.splice(b,1)}};b.prototype.removeLastAnnoAttribsFromQueue=function(){if(this.queuedAttributes){var b;
do{b=this.queuedAttributes.find(function(b){return b.fromAnno});var d=this.queuedAttributes.indexOf(b);0<=d&&this.queuedAttributes.splice(d,1)}while(b)}};b.prototype.markSquare=function(b,d,c,e,q){this.queueBoardAttributes([new CB.BoardColouredSquare(b,d,c)],{eraseQueue:!1,renderNow:!q,requestAnimInRender:!0,permanent:e})};b.prototype.drawArrow=function(b,d,c,e,q,r){"undefined"!==typeof b&&this.queueBoardAttributes([new CB.BoardArrow(b,d,c,e,r)],{eraseQueue:!0,renderNow:!0,requestAnimInRender:!0,
permanent:q})};b.prototype.drawLine=function(b){this.queueBoardAttributes([b],{eraseQueue:!0,renderNow:!0,requestAnimInRender:!0,permanent:!0})};b.prototype.markSquares=function(b){this.currPiece&&(this.currPiece.hide(this.cbcanvas.bufferCtx),this.currPiece.deleteBackground());for(var d=0;d<b.length;d++)this.queueBoardAttributes([new CB.BoardColouredSquare(b[d].sq,b[d].clr)],{eraseQueue:!1,renderNow:d==b.length-1,requestAnimInRender:d==b.length-1});this.currPiece&&this.currPiece.moveTo(this.cbcanvas.bufferCtx,
this.currPiece.pos)};b.prototype.restoreSquares=function(b){b.forEach(function(b){this.restoreSquare(this.cbcanvas.bufferCtx,b.sq);this.restoreSquare(this.cbcanvas.ctx,b.sq)}.bind(this))};return b}();"use strict";
CB.BoardControl=function(){var c=function(b,d,c,f,g){this.init(b,d,c,f);this.pieceFontName=CB.PieceFonts[glSettings.pieceStyleId];this.markedSqsOnButtonDown=[];this.options=g;this.pieceTouchSq=-1};CB.inherit(c,CB.RawBoardControl);c.prototype.onMouseDown=function(b,d){if(this._game){V15.Vb.abortCreateBackground();try{if(2==b.button)this.handleRightButtonDown(b,d);else if(!this.buttonDown&&(this.blindMoves||this.redraw(),this.destroyMessage(),new CB.Tick,this.buttonDown=!0,this.clickPos=this.getClickPos(d),
this.clickOffs=this.getOffsFromSqCenter(this.clickPos),void 0!==this.fnBoardClick&&this.fnBoardClick(this.uniqueId,this.clickPos,b),this.allowInput)){var c=this.getClickedSquare(this.clickPos);this.moveEntry.clearAttributesOnMouseDown(c);-1!=c&&(this.blindMoves?this.flashBlindPiece(c):(this.currPiece=this.grabPiece(c,this.clickPos.add(this.clickOffs)),this.moveEntry.onSquareClicked(c)),this.fromSq=c,this.markedSqsOnButtonDown=[],this.fnMarkSquaresOnButtonDown&&(this.markedSqsOnButtonDown=this.markedSqsOnButtonDown.concat(this.fnMarkSquaresOnButtonDown(c))),
this.markSquares(this.markedSqsOnButtonDown),this.fnSquareClick&&this.fnSquareClick(c),(this.currPiece||this.hasPieceInAdjacentSquare(c))&&b.preventDefault())}}catch(f){CB.LogException("BoardDown",f)}}};c.prototype.hasPieceInAdjacentSquare=function(b){for(var d=[-7,-8,-9,-1,1,7,8,9],c=0;c<d.length;c++){var f=b+d[c];if(0<=f&&64>=f&&this.board.sqs[f])return!0}};c.prototype.onMouseUp=function(b,d){if(this._game)try{if(2==b.button)this.handleRightButtonUp(b,d);else if(this.getClickPos(d),this.buttonDown){this.buttonDown=
!1;var c=this.clickPos=this.getClickPos(d),f=!1;if(this.allowInput){new CB.Tick;var g=this.getClickedSquare(c);if(-1==g){void 0!==this.currPiece&&(this.animateFromTo(this.currPiece,c,this.getSquareCenterPos(this.fromSq),2),delete this.currPiece);this.fromSq=-1;this.superClass.onMouseUp.call(this,b,d);return}if(this.blindMoves)g!=this.fromSq&&(this.toSq=g,this.prom=0,this.handlePromo(this.fromSq,this.toSq,c,!1),this.moveEntry.boardWinMoveEntered(this.fromSq,this.toSq,this.prom));else if(void 0!==this.currPiece||
this.fromSq===this.moveEntry.getLastPreMoveToSq()||0==this.board.get(g)||0<=this.fromSq&&0==this.board.get(this.fromSq)){if(g!==this.fromSq){this.pieceTouchSq=-1;var h=this.moveEntry.isLegalOrPremove(this.board,this.fromSq,g);if(!h&&this.moveEntry.isLegal(this.board,g,this.fromSq)&&this.moveEntry.mayEnterBackwards(this.board,g)){var l=g,g=this.fromSq;this.fromSq=l;h=!0;this.currPiece=this.grabPiece(this.fromSq,this.getSquareCenterPos(this.fromSq))}h?(this.toSq=g,this.prom=0,f=this.moveEntry.isPremove(this.board,
this.fromSq,this.toSq),this.moveEntry.colorOk(this.board.get(this.fromSq))&&(this.board.get(g)&&!f&&this.animateCapture(g),this.handlePromo(this.fromSq,this.toSq,c,f)||this.handleEnPassant(this.fromSq,this.toSq,f)||(f||(this.boardSprites.change(this.fromSq,g),this.board.change(this.fromSq,g)),this.currPiece&&this.movePieceToSq(this.currPiece,g))),this.moveEntry.boardWinMoveEntered(this.fromSq,this.toSq,this.prom)||(this.currPiece&&(this.currPiece.moveTo(this.cbcanvas.bufferCtx,this.getSquareCenterPos(this.fromSq)),
this.currPiece.lastSq=this.fromSq),f=!0,this.cbcanvas.requestAnimation(this.getGenerousClipRect(this.fromSq,this.toSq),!0))):this.currPiece&&this.animateFromTo(this.currPiece,c,this.getSquareCenterPos(this.fromSq),5);delete this.fromSq}else this.clickHandler?this.clickHandler(g):this.currPiece?(this.movePieceToSq(this.currPiece,g),this.moveEntry.isMyPiece(g)?this.pieceTouchSq=g:this.moveEntry.isOpponentPiece(g)&&(this.moveEntry.tryTwoClickMove(this.pieceTouchSq,g),this.pieceTouchSq=-1)):(this.moveEntry.tryTwoClickMove(this.pieceTouchSq,
g)||this.singleClickDisabled||(l=this.moveEntry.fillSingleClickMove(this.board,g),l.ok&&this.moveEntry.boardWinMoveEntered(l.from,g,0)),this.pieceTouchSq=-1);delete this.currPiece}b.preventDefault();this.fnSquareRelease&&this.fnSquareRelease(g)}else this.currPiece&&(this.animateFromTo(this.currPiece,c,this.getSquareCenterPos(this.fromSq),5),delete this.currPiece);this.fromSq=-1;this.markedSqsOnButtonDown.length&&(this.markedSqsOnButtonDown=[]);this.redraw();f&&this.moveEntry.renderPreMoves()}}catch(q){CB.LogException("BoardUp",
q)}};c.prototype.onMouseWheel=function(b,d){};c.prototype.onMouseMove=function(b,d){try{if(this.allowInput){this.clickPos=this.getClickPos(d);var c=this.getClickedSquare(this.clickPos);this.moveSq=c;var f,g;this.isWhitePromoPawn(this.fromSq)?(g=c,7==CB.Square.getRank(g)&&(f=this.blindMoves||this.moveEntry.isLegalOrPremove(this.board,this.fromSq,g))):this.isBlackPromoPawn(this.fromSq)&&(g=c,0==CB.Square.getRank(g)&&(f=this.blindMoves||this.moveEntry.isLegalOrPremove(this.board,this.fromSq,g)));f?(this.currPiece&&
(this.hideSprite(this.currPiece),this.currPiece.saveBackground(this.cbcanvas.bufferCtx)),this.drawPromChoice(g),CB.LOG("Prom: "+g)):(void 0!==this.promoSprite&&(CB.LOG("Delete PromoSprite"),this.hideSprite(this.promoSprite),delete this.promoSprite,this.currPiece&&this.currPiece.deleteBackground()),this.currPiece&&(this.animation.hideAll(),this.moveSprite(this.currPiece,this.clickPos.add(this.clickOffs)),this.animation.showAll()));if(void 0!==this.currPiece)b.preventDefault(),c!=this.fromSq&&this.fnSquareChangeInMouseMove&&
this.fnSquareChangeInMouseMove(c);else if(!this.blindMoves){f=!1;if(0<=c){var h=this.board.get(c);h===CB.Piece.NONE||!this.moveEntry||this.moveEntry.getMySide()!=CB.Piece.side(h)&&null!==this.moveEntry.getMySide()||(b.target.style.cursor=this.busy?"wait":"pointer",f=!0)}f||(b.target.style.cursor=this.busy?"wait":"default")}}this.superClass.onMouseMove.call(this,b,d)}catch(l){CB.LogException("BMMove",l)}};c.prototype.isWhitePromoPawn=function(b){return(this.board.get(b)==CB.Piece.W_PAWN||this.blindMoves&&
this.blindSqs&&this.blindSqs[b]==CB.Piece.W_PAWN)&&6==CB.Square.getRank(b)};c.prototype.isBlackPromoPawn=function(b){return(this.board.get(b)==CB.Piece.B_PAWN||this.blindMoves&&this.blindSqs&&this.blindSqs[b]==CB.Piece.B_PAWN)&&1==CB.Square.getRank(b)};c.prototype.handlePromo=function(b,d,c,f){this.isWhitePromoPawn(b)?this.prom=this.getPromFromClickPos(d,c):this.isBlackPromoPawn(b)&&(this.prom=this.getPromFromClickPos(d,c)+CB.Side.SIDE_MASK);return this.prom?(f?(this.drawSquare(this.cbcanvas.bufferCtx,
this.toSq),this.currPiece.deleteBackground(),this.cbcanvas.requestAnimation(this.getSquareRect(this.toSq))):(this.blindMoves||(this.boardSprites.promo(this.fromSq,this.toSq,this.prom,this.pieceSpriteFactory),this.board.promo(this.fromSq,this.toSq,this.prom)),this.drawSquare(this.cbcanvas.bufferCtx,this.toSq),this.blindMoves||(this.movePieceToSq(this.boardSprites.getPiece(this.toSq),this.toSq),this.drawSquare(this.cbcanvas.bufferCtx,this.fromSq))),delete this.promoSprite,!0):!1};c.prototype.drawPromChoice=
function(b){void 0===this.promoSprite&&(this.promoSprite=this.boardSprites.getPromoSprite(CB.Piece.side(this.board.sqs[this.fromSq])));CB.LOG("Move Promo Sprite to: "+CB.Square.toString(b));this.movePieceToSq(this.promoSprite,b)};c.prototype.handleEnPassant=function(b,d,c){var f;this.board.get(b)==CB.Piece.W_PAWN&&4==CB.Square.getRank(b)&&this.moveEntry.mayEnPassant(b,d)?f=CB.Square.get64(CB.Square.getFile(d),4):this.board.get(b)==CB.Piece.B_PAWN&&3==CB.Square.getRank(b)&&this.moveEntry.mayEnPassant(b,
d)&&(f=CB.Square.get64(CB.Square.getFile(d),3));return void 0!==f?(c||(this.boardSprites.enPassant(b,d,f),this.board.enPassant(b,d,f),this.movePieceToSq(this.currPiece,this.toSq),this.drawSquare(this.cbcanvas.bufferCtx,f),this.cbcanvas.requestAnimation(this.getSquareRect(f))),!0):!1};c.prototype.markPreMove=function(b,d){this.queueBoardAttributes([new CB.BoardArrow(b,d,this.moveEntry.getPreMoveHsla())],{eraseQueue:!0,renderNow:!0,requestAnimInRender:!1})};c.prototype.grabPiece=function(b,d){var c=
this.boardSprites.getPiece(b);c&&(c.fromSq=b);void 0===c&&b!==this.moveEntry.getLastPreMoveToSq()||!c||(c.pieceName=CB.Piece.toString(this.board.get(b)),CB.LOG(c.pieceName),c.hasBackground()?this.moveSprite(c,this.clickPos.add(this.clickOffs)):(c.pos=d,c.setBackground(V15.Vb.getSquare(b,this.nSqPix))));return c};c.prototype.flashBlindPiece=function(b){this.blindPiece=this.boardSprites.getBlindSprite(this.pieceSpriteFactory,this.blindSqs?this.blindSqs[b]:this.board.sqs[b]);var d=this.getSquareCenterPos(b);
this.blindPiece.moveTo(this.cbcanvas.bufferCtx,d);this.cbcanvas.requestAnimation(this.getSquareRect(b));(new CB.Timer(function(){d.x+=2;d.y+=2;this.blindPiece.moveTo(this.cbcanvas.bufferCtx,d);this.cbcanvas.requestAnimation(this.getSquareRect(b));this.hideSprite(this.blindPiece);this.blindPiece=null}.bind(this))).runOnce(100)};c.prototype.setBusy=function(b){this.busy=b;this.cbcanvas.canvas.style.cursor=this.busy?"wait":"default"};c.prototype.test=function(){var b=["rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
"rnbqk2r/1p2bppp/p2p1n2/4p1B1/4P3/1NN5/PPP1BPPP/R2QK2R b KQkq - 0 8","4rk1r/pppb1ppp/2np4/8/3P4/2PBP3/PP1N2PP/R4RK1 w - - 0 15","b4rk1/p1p1qpp1/3p1n1p/4p3/4P2B/3P1N2/PRPQ1PPP/6K1 w - - 0 16","7r/3kp3/1p6/p1p1p3/3nP1p1/PPKPB1P1/5P2/R7 b - - 0 29"];this.testInx=void 0===this.testInx?0:this.testInx+1;this.testInx>b.length-1&&(this.testInx=0);this.execStr(b[this.testInx])};c.prototype.refreshMarkedSquares=function(){this.buttonDown&&this.fromSq&&this.fromSq==this.moveSq&&(this.markedSqsOnButtonDown&&
this.markedSqsOnButtonDown.length&&this.restoreSquares(this.markedSqsOnButtonDown),this.markedSqsOnButtonDown=[],this.fnMarkSquaresOnButtonDown&&(this.markedSqsOnButtonDown=this.markedSqsOnButtonDown.concat(this.fnMarkSquaresOnButtonDown(this.fromSq,!0))),this.markSquares(this.markedSqsOnButtonDown))};c.prototype.execStr=function(b){b=new CB.Position(b);this.setBoard(b.board)};return c}();"use strict";
CB.ClockElement=function(){var c=function(b,d){this.colorActive=V15.config.clrActiveClock;this.colorActiveNormal=new CB.Color(220,250,190);this.colorActiveEmphasize=new CB.Color(50,110,0);this.colorInactive=new CB.Color(140,140,100);this.colorFinished=this.colorActive;this.background=new CB.DivElement(b,"clockBG");this.textWhite=new CB.DivElement(this.background,"clockW");this.textBlack=new CB.DivElement(this.background,"clockB");this.config=d?d:{border:1,borderClr:"black"};this.initText(this.textWhite);
this.initText(this.textBlack);this.displayCentiSecs=!1;this.displayHours=!0;this.textWhite.setText("0:00:00");this.textBlack.setText("0:00:00");this.timerToMove=new CB.Timer(this.stopEmphasizeToMove.bind(this));this.runningClockId=0};c.prototype.destroy=function(){this.background.destroy()};c.prototype.setDisplayCentiSecs=function(b){this.displayCentiSecs=b};c.prototype.setDisplayHours=function(b){this.displayHours=b};c.prototype.setText=function(b,d){d?this.textBlack.setText(b):this.textWhite.setText(b)};
c.prototype.setTextWhite=function(b){this.textWhite.setText(b)};c.prototype.setTextBlack=function(b){this.textBlack.setText(b)};c.prototype.setVisible=function(b){this.background.setVisible(b)};c.prototype.initText=function(b){b.setBackgroundColor(new CB.Color(0,0,0,.5));b.setColor(new CB.Color(255,255,255,.9));b.setBorder(this.config.border,this.config.borderClr);b.setTextAlign("center");b.setFontFamily(V15.config.defaultFont);b.elDOM.addEventListener("mousedown",function(b){b.preventDefault()})};
c.prototype.setPosSize=function(b,d,c,f){var g=new CB.Rect(0,0,Math.round(c/2),f-1),h=new CB.Rect(Math.round(c/2),0,c,f-1);this.background.setPos(b,d);this.background.setSize(c,f);this.textWhite.setPos(g.left,g.top);this.textWhite.setSize(g.getSize().w,g.getSize().h);this.textBlack.setPos(h.left,h.top);this.textBlack.setSize(h.getSize().w,h.getSize().h);b=Math.round(.7*f);do this.textWhite.setFontSize(b),this.textBlack.setFontSize(b),--b,this.textWhite.setVerticalAlign((g.h-b)/2+2),this.textBlack.setVerticalAlign((g.h-
b)/2+1);while(3<b&&(this.textWhite.getTextWidth()>g.w-5||this.textWhite.getTextHeight()>g.h-2));c=Math.max(1,Math.min(4,Math.round(Math.sqrt(c/100))));this.background.setBoxShadow(c,5*c,"rgba( 60, 30, 20, 0.6 )")};c.prototype.showResult=function(b){this.textWhite.setText(lm.RESULT+":");b==CB.GameResultEnum.UNDEFINED_RESULT?this.textBlack.setText(lm.ABORTED):this.textBlack.setText(CB.GameResultEnum.toString(b));this.textWhite.setColor(this.colorFinished);this.textBlack.setColor(this.colorFinished)};
c.prototype.showTimeOverstepped=function(b){this.textWhite.setText("TIME")};c.prototype.setToMove=function(b){b?(this.textWhite.setColor(this.colorInactive),this.textBlack.setColor(this.colorActive)):(this.textWhite.setColor(this.colorActive),this.textBlack.setColor(this.colorInactive))};c.prototype.showRestTime=function(b,d){var c=this.getTimeString(b);d?this.textBlack.setText(c):this.textWhite.setText(c)};c.prototype.showCurrTime=function(b,d){};c.prototype.setRunsForward=function(b){this.runsForward=
b};c.prototype.emphasizeToMove=function(b){this.timerToMove.runOnce(b||8E3);this.textWhite.setBackgroundColor(this.colorActiveEmphasize);this.textBlack.setBackgroundColor(this.colorActiveEmphasize)};c.prototype.stopEmphasizeToMove=function(){this.textWhite.setBackgroundColor(new CB.Color(0,0,0,.5));this.textBlack.setBackgroundColor(new CB.Color(0,0,0,.5))};c.prototype.getTimeString=function(b){0>b&&(b=new Date(0));var d="";this.displayHours&&(d=b.getUTCHours()+":");if(4E3>b.valueOf()&&!this.runsForward){var c=
b.getUTCSeconds();b=Math.floor(b.getUTCMilliseconds()/100);1<b.toString().length&&(b="0");d=c+"."+b}else c=b.getUTCMinutes(),1==c.toString().length&&(c="0"+c),d+=c,c=Math.floor(b.getUTCSeconds()),1==c.toString().length&&(c="0"+c),d+=":"+c;return d};return c}();"use strict";function LineStackItemHash(c){var b=c.getLine();c=c.getMovesToGo()|b.length<<8;0<b.length&&(c|=b[0].from<<16|b[0].to<<24);return c}
function LineStackItemEq(c,b){return c.getLine()===b.getLine()&&c.getMovesToGo()===b.getMovesToGo()}CB.cbNotationDefaults={game:null,useMatBalance:!0,useDiagrams:!0,useMedals:!0,useResult:!0,useColorMarkers:!0,useHeader:!0,moveClass:"",commentClass:"",resultClass:"",lineClass:"",colorMarkerClass:"",medalClass:"",isActive:!0,notationLocalization:null,setColorMarkersOnDiagrams:!0};
CB.NotaElement=function(){function c(b,d,c){d.append("<span class='");d.append(c);d.append("'>");d.append(b);d.append("</span>")}var b=function(b,d,c){this.notaHeaderElement=new CB.NotaHeaderElement(d);this.notaFooterElement=new CB.NotaFooterElement(d,c);this.elementId=0;this.panel=b;this.gateUpdate=new CB.Vr;this.stopAtMoves=[];this.nInPage=d;this.diagrams=[];this.reserveDiagrams=[]};b.prototype.panel=null;b.prototype.m_ng=null;b.prototype.m_selElem=null;b.prototype.m_active=!0;b.prototype.notaHeaderElement=
null;b.prototype.initElem=function(b,d){var c;this.elementId=c="string"==typeof b?b:b.id;c=CB.$("#"+c);if(this.elem=c.single()){c.parent();c.addClass("cbnota-container");this.precreateLayout();this._setOptions(d);this.scrollParent=CB.$(".nota-game",this.elem).single();c.on("dragover",this.onElementDragOver.bind(this)).on("dragenter",this.onElementDragEnter.bind(this)).on("drop",this.onElementDrop.bind(this)).on("mousewheel",this.onMouseWheel.bind(this)).on("DOMMouseScroll",this.onMouseWheel.bind(this));
CB.Element.isEventSupported("touchstart")&&(c.on("touchstart",this.onButtonDown.bind(this)).on("touchend",this.onButtonUp.bind(this)).on("touchmove",this.onMouseMove.bind(this)).on("touchleave touchcancel",this.onMouseLeave.bind(this)),this.supportsTouch=!0);if(CB.Element.isEventSupported("mousedown"))c.on("mousedown",this.onButtonDown.bind(this)).on("mouseup",this.onButtonUp.bind(this)).on("mousemove",this.onMouseMove.bind(this)).on("mouseleave",this.onMouseLeave.bind(this)).on("dblclick",this.onDoubleClick.bind(this));
CB.System.isSafari()&&$(".nota-game").css("padding-right","50px");c=CB.$("#nota-head-"+this.nInPage).single();this.header=new CB.DivElement(c,this.getHeaderId(),{append:!1});this.header.setVisible(!0);this.notaHeaderElement.initElem(this.getHeaderId(),d,null,this.nInPage);d.useMatBalance&&this.createMatBalance()}};b.prototype.destroy=function(){alert("NOTIMPL NotaEl")};b.prototype.createMatBalance=function(){if(null===CB.$.get(this.getFooterId())){var b=CB.$.get(this.elementId);if(b){var d=CB.$("#nota-foot-"+
this.nInPage).single();this.footer=new CB.DivElement(d,this.getFooterId());this.footer.setVisible(!0);this.notaFooterElement.initElem(this.getFooterId())}}d=CB.$("#"+this.elementId);b&&d.removeClass("nomat")};b.prototype.getHeaderId=function(){return"theheader-"+this.nInPage};b.prototype.getFooterId=function(){return"thefooter-"+this.nInPage};b.prototype.destroyMatBalance=function(){var b=CB.$("#"+this.getFooterId()).single();b&&0<b.childNodes.length&&(b.removeChild(b.childNodes[0]),this.footer=null,
CB.$("#"+this.elementId).addClass("nomat"))};b.prototype.setUseMatBalance=function(b){(this.useMatBalance=b)?CB.$("#"+this.getFooterId()).show():CB.$("#"+this.getFooterId()).hide()};b.prototype._setOptions=function(b){b.notationLocalization=b.notationLocalization||lm.NOTA_LOCALIZATION;this.m_ng=new CB.NotationGenerator(b.notationLocalization);this.m_useDiagrams=b.useDiagrams;void 0!==b.diagramOptions&&(this.m_diagramOptions=b.diagramOptions);this.m_useHeader=b.useHeader;void 0!==b.useMatBalance&&
(this.useMatBalance=b.useMatBalance);void 0!==b.useResult&&(this.m_useResult=b.useResult);this.m_active=b.isActive;this.m_options=b;b.game&&this.setGame(b.game)};b.prototype.setOptions=function(b){this._setOptions(b)};b.prototype.m_game=null;b.prototype.setGame=function(b){this.notaHeaderElement.setGame(b);this.m_game&&(this.m_game.removeOnMoveListener(this.m_inxOnMove),this.m_game.removeOnNavigateListener(this.m_inxOnNavigate),this.m_game.removeOnChangedListener(this.m_inxOnChanged),this.m_game.removeOnHeaderChangedListener(this.m_inxOnHeaderChanged),
this.m_game.removeOnAnnoChangedListener(this.m_inxOnAnnoChanged),this.m_game.removeOnEvalListener(this.m_inxOnEval));this.m_game=b;this.m_inxOnMove=this.m_game.addOnMoveListener(this.onMove.bind(this));this.m_inxOnNavigate=this.m_game.addOnNavigateListener(this.onNavigate.bind(this));this.m_inxOnChanged=this.m_game.addOnChangedListener(this.onChanged.bind(this));this.m_inxOnHeaderChanged=this.m_game.addOnHeaderChangedListener(this.onHeaderChanged.bind(this));this.m_inxOnAnnoChanged=this.m_game.addOnAnnoChangedListener(this.onChanged.bind(this));
this.m_inxOnEval=this.m_game.addOnEvalListener(this.onEval.bind(this));this.initSubElements();this.useMatBalance&&this.notaFooterElement.setGame(b);this.notaHeaderElement.setGame(b);this.evProfileControl&&this.evProfileControl.setEvalArr(b.getEvaluationProfile())};b.prototype.setSize=function(b,d){this.notaHeaderElement.onResize(b,d);this.resizeDiagrams();this.resizeEvProfile(b);this.onNavigate(!0)};b.prototype.getGame=function(){return this.m_game};b.prototype.onMove=function(){this.initSubElements();
this.markCurLine()};b.prototype.onHeaderChanged=function(){};b.prototype.onChanged=function(){this.initSubElements();this.markCurLine()};b.prototype.onEval=function(b,d,c){var e;CB.Evaluation&&(e=CB.Evaluation.getEvalString(d));this.evProfileControl||this.notaFooterElement.setText(e+".")};b.prototype.onNavigate=function(b){b=b||!1;var d=this.FindMoveElement();this.setSelItem(d,b);this.markCurLine();this.scheduleUpdate(this);this.evProfileControl&&this.m_game.isOnMainLine()&&this.evProfileControl.markMove(this.m_game.getPlyNum())};
b.prototype.ResultToStr=function(b){return CB.GameResultEnum.toString(b)};b.prototype.InitResult=function(d,e){var h=b.prototype.ResultToStr(d);h&&c(h,e,"cbgame-result")};b.prototype.scheduleUpdate=function(b){this.gateUpdate.exec(function(){b.matcontrol&&(b.matcontrol.setPos(b.m_game.getCurPos()),b.matcontrol.render())}.bind(this),200)};b.prototype.getLayoutHtml=function(){return String.formatEx("<div class='nota-container'><div class='nota-head-container'><div class='nota-head' id='nota-head-{0}'></div></div><div class='nota-game-container'><div class='nota-ogame'><div class='nota-igame'><div class='nota-game' data-inx-game='{0}'></div></div></div></div><div class='nota-foot-container'><div class='nota-foot' id='nota-foot-{0}'></div></div></div>",
this.nInPage)};b.prototype.precreateLayout=function(){CB.$(this.elem).html(this.getLayoutHtml())};b.prototype.initSubElements=function(){this.diagrams&&this.diagrams.forEach&&this.diagrams.forEach(function(b){b.boardArea.changeParentElDOM(null)});this.reserveDiagrams=this.reserveDiagrams.concat(this.diagrams);this.diagrams=[];"undefined"==typeof this.m_game&&(this.m_game=new CB.Game);var d=new StringBuilder,c=this.m_game.getHeader(),e=this.m_game.getMainLine(),l=this.m_game.getStartPos().getMoveNum(),
q={lineCnt:0,nodeCnt:0,breakForTraining:!1,foldCnt:0};b.initLine(this,e,0,0,l,0,d,q,0,0,0);this.m_useResult&&!q.breakForTraining&&this.InitResult(c.getResult(),d);CB.$(".nota-game",this.elem).html(d.toString());for(d=1;d<=q.foldCnt;d++)c=$("#fold"+d+this.nInPage),c.click(function(b){this.doOnFoldLine(b,function(b){b.toggle()})}.bind(this)),c.on("touchstart",function(b){this.doOnFoldLine(b,function(b){b.toggle()})}.bind(this)),c.on("fold",function(b){this.doOnFoldLine(b,function(b){b.hide()})}.bind(this)),
c.on("unfold",function(b){this.doOnFoldLine(b,function(b){b.show()})}.bind(this));this.afterInitDiagrams();(new CB.Timer(function(){this.createEvaluationProfile()}.bind(this))).runOnce(30);this.onNavigate(!0)};b.prototype.doOnFoldLine=function(b,d){var c=b.currentTarget.dataset.line,e=$(String.f(".cbmove[data-linecnt='{0}']:not([data-inx-mv='0'])",c));d(e);var q=$(String.f(".cbcomment[data-linecnt='{0}']",c));d(q);c=$(String.f("[data-linecnt-this='{0}']",c));d(c);e.length&&(q=$(e[0]).parent().find(".cbcol-marker"),
d(q));e.is(":visible")||c.is(":visible")?($(b.currentTarget).addClass("cbFoldBtn"),$(b.currentTarget).removeClass("cbUnFoldBtn"),$(b.currentTarget).parent().find(".cbUnFoldBtn").trigger("unfold")):($(b.currentTarget).addClass("cbUnFoldBtn"),$(b.currentTarget).removeClass("cbFoldBtn"))};b.initLine=function(b,d,c,e,q,r,t,v,y,A,w){var z=++v.lineCnt,C=0;r||d.isAnnotated()&&(C=1);0===r&&(b.useMatBalance?b.createMatBalance():b.destroyMatBalance());var D,E=0,F=0,G=0;d.forEach(function(b){b.forAllMoves(function(b){E++;
(b=b.getAnno())&&b[CB.AnnoType.POSTTEXT]&&(G+=b[CB.AnnoType.POSTTEXT].toString().length)});b.hasLines()&&F++});var I=6>=r&&(10<E+G/8||1<w)&&V15.config.hasFolding;1<=r&&I&&(D=(++v.foldCnt).toString()+b.nInPage.toString(),D=String.f("<span class='cbNodeBtn cbFoldBtn' data-line='{0}' data-level={2} id='{1}'></span>",z,"fold"+D,r));t.appendFormat("<span class='cbline' data-inx-line='{0}' data-inx-mv-parent = '{1}' data-level='{2}' data-commented='{3}' data-linecnt-this='{4}' data-nodecnt-this='{5}' lastLine='{6}'>{7}",
c,e,r,C,y,A,c===w-1?"1":"0",D);0===r&&b.createMovelessAnnoElement(d,t);c=!1;0<d.length&&(c=d[0].getSide()===CB.Side.WHITE);e=!0;C=!1;y=0;for(w=d.length;y<w;++y)if(b.shouldStop(d,y)){C=!0;break}if(!C)for(y=0,w=d.length;y<w;++y){C=d[y];b.CreateMoveElements(C,y,d,q,c||e,r,t,v,z,A);if(v.breakForTraining)break;(c=!c)&&++q;e=C.hasLines()}t.append("</span>")};b.prototype.suppressNotationFromMoves=function(b){this.stopAtMoves=b};b.prototype.shouldStop=function(b,d){for(var c=b[d],e=0;e<this.stopAtMoves.length;e++)if(c.from==
this.stopAtMoves[e].from&&c.to==this.stopAtMoves[e].to){var q=this.m_game.getLinePos(b,d).toFEN(),r=q.indexOf(" "),t=this.stopAtMoves[e].fen.indexOf(" ");if(r==t&&(q=q.substr(0,r),t=this.stopAtMoves[e].fen.substr(0,t),q==t))return!0}return!1};b.prototype.createMovelessAnnoElement=function(b,d){var c=b.getAnno();c&&(c[CB.AnnoType.POSTTEXT]||c[CB.AnnoType.PRETEXT])&&c[CB.AnnoType.POSTTEXT]&&(c=c[CB.AnnoType.POSTTEXT].getString(),this.createCommentElements(c,0,0,d,0))};b.DIAG_CHAR="[#]";b.prototype.createCommentElementsWithDiags=
function(d,c,e,l,q,r,t){if(d){if(0>d.indexOf(b.DIAG_CHAR))return this.createCommentElements(d,c,e,r,t);for(var v=0,y=d.indexOf(b.DIAG_CHAR);0<=y;y=d.indexOf(b.DIAG_CHAR,v))0<y-v&&(v=d.substring(v,y),this.createCommentElements(v,c,e,r,t)),this.wroteDiagram=this.createDiagElements("",c,e,l,q,r,t),v=y+b.DIAG_CHAR.length;v<d.length&&(v=d.substring(v),this.createCommentElements(v,c,e,r,t))}};b.prototype.createMedal=function(b,d,c,e,q){b&&(e.appendFormat("<span class='cbcomment cbmedal medal-{2}' data-inx-mv='{0}' data-linecnt='{1}'>",
d,q,b),e.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp</span>"),e.append(" "))};b.prototype.createCommentElements=function(b,d,c,e,q){e.appendFormat("<span class='cbcomment' data-inx-mv='{0}' data-linecnt='{1}'>",d,q);e.append(CB.strUtil.escapeHtmlEntities(b));e.append("</span>");e.append(" ")};b.prototype.createTrainingElements=function(b,d,c,e,q,r){c=CB.Language.getStrUserLanguageTwoChars();e.appendFormat("<span class='cbcomment cbtraining' data-inx-mv='{0}' data-linecnt='{1}'>",d,q);e.append(CB.strUtil.escapeHtmlEntities(b.getQuestion(c)||
lm.TRAINING_QUESTION));b.solved||(e.append('<div class="cbTrainingLinks">'),e.append(String.f('<span class="cbTrainingLink cbTrainingSolution" data-inx-mv="{0}" data-linecnt="{1}">{2}</span>',d,q,lm.TRAINING_SOLUTION)),1<=b.nHelpClicked?(e.appendFormat("<span class='cbcomment cbtraining cbtraininghelptext' data-inx-mv='{0}' data-linecnt='{1}'>",d,q),e.append(CB.strUtil.escapeHtmlEntities(b.getHelp(c)||"No help available")),e.append("</span>")):b.getHelp(c)&&e.append(String.f('<span class="cbTrainingLink cbTrainingHelp" data-inx-mv="{0}" data-linecnt="{1}">{2}</span>',
d,q,lm.TRAINING_HELP)),e.append("</div>"));e.append("</span>");e.append(" ");return!b.solved};b.CreateGlyphableText=function(b,d,e){if(b.length){for(var l=!0,q=0,r=b.length;q<r;++q)if(57344<=b.charCodeAt(q)){l=!1;break}if(l)d.append(b);else{for(var l=!1,t="",q=0,r=b.length;q<r;++q){var v=b[q],y="\ue000"<=v;y===l?t+=v:(l?c(t,d,e):d.append(t),t=v,l=y)}t&&(l?c(t,d,e):d.append(t))}}};b.prototype.CreateGlyphableSpanText=function(d,c){var e=document.createElement("span");b.CreateGlyphableText(d,e,"cbspec-glyph");
return e};b.prototype.CreateMoveElements=function(d,c,e,l,q,r,t,v,y,A){var w=d.getAnno();w&&w[CB.AnnoType.PRETEXT]&&this.createCommentElementsWithDiags(w[CB.AnnoType.PRETEXT].getString(),c,e,w,!1,t,y);var z=l;q||this.wroteDiagram||(z=null);this.wroteDiagram=!1;q=this.m_ng.getMoveNota(d,z);if(w&&w[CB.AnnoType.SYMBOL]){for(var z=w[CB.AnnoType.SYMBOL],C=0;C<z.length;C++);q=Vp.addTexts(q,z)}0==c?t.appendFormat("<span class='cbmove' data-inx-mv = '{0}' data-linecnt = '{1}' data-nodecnt = '{2}'>",c,y,A):
t.appendFormat("<span class='cbmove' data-inx-mv = '{0}' data-linecnt = '{1}'>",c,y);b.CreateGlyphableText(q,t,"cbspec-glyph");t.append("</span>");t.append(" ");w&&(w[CB.AnnoType.SQUARE_LIST]||w[CB.AnnoType.ARROW_LIST]?t.appendFormat("<span class='cbcol-marker' data-inx-mv='{0}'> </span>",c):w[CB.AnnoType.MOVE_MEDAL]&&t.appendFormat("<span class='cbmedal-marker' data-inx-mv='{0}'> </span>",c));t.append(" ");w&&w[CB.AnnoType.TIME]&&this.createCommentElementsWithDiags(w[CB.AnnoType.TIME].getString(),
c,e,w,!0,t,y);w&&w[CB.AnnoType.MOVE_MEDAL]&&this.createMedal(w[CB.AnnoType.MOVE_MEDAL].getOneMedal(),c,e,t,y);w&&w[CB.AnnoType.POSTTEXT]&&this.createCommentElementsWithDiags(w[CB.AnnoType.POSTTEXT].getString(),c,e,w,!0,t,y);if(d.hasLines())for(d=d.getSubLines(),A=++v.nodeCnt,q=0,z=d.length;q<z;++q)b.initLine(this,d[q],q,c,l,r+1,t,v,y,A,z);w&&w[CB.AnnoType.TRAINING]&&(this.createDiagElements("Find the next move",c,e,w,!0,t,y),v.breakForTraining=this.createTrainingElements(w[CB.AnnoType.TRAINING],c,
e,t,y,v));w&&w[CB.AnnoType.DIAGRAM]&&(l=w[CB.AnnoType.DIAGRAM].getString(),this.createDiagElements(l,c,e,w,!0,t,y))};b.prototype.createDiagElements=function(d,c,e,l,q,r,t){if(this.m_useDiagrams)return q||--c,e=this.m_game.getLinePos(e,c+1),this.m_options.setColorMarkersOnDiagrams||(l=null),l=b.toFenEx(e,l),r.appendFormat("<span class='cbdia' data-fen='{0}' data-legend='{1}' data-inx-mv='{2}' data-linecnt='{3}'>",l,d,c,t),r.append("</span>"),!0};b.toFenEx=function(b,d){var c=b.toFEN();d&&d[CB.AnnoType.ARROW_LIST]&&
(c=c+";"+d[CB.AnnoType.ARROW_LIST].toString(";"));d&&d[CB.AnnoType.SQUARE_LIST]&&(c=c+";"+d[CB.AnnoType.SQUARE_LIST].toString(";"));return c};b.parseFenEx=function(b){b=b.split(";");for(var d=new Position(b[0]),c=new Annotation,e=new ColSqAnno,q=new ColArrowAnno,r=1,t=b.length;r<t;++r){var v=b[r];if(v.length==ColSq.STRING_LEN){var y=new ColSq;y.init(v);e.push(y)}else v.length==ColArrow.STRING_LEN&&(y=new ColArrow,y.init(v),q.push(y))}0<e.length&&c.setItem(AnnoType.SQUARE_LIST,e);0<q.length&&c.setItem(AnnoType.ARROW_LIST,
q);return{anno:c,position:d}};b.prototype.removeClass=function(b){for(var d=Array.prototype.slice.call(document.getElementsByClassName(b)),c=0,e=d.length;c<e;c++){var q=d[c];q.className=q.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)","g"),"$1")}};b.prototype.setSelItem=function(b,c){if(null!==b){this.m_selElem&&(CB.$(this.m_selElem).removeClass("cbcur-move"),this.m_selElem=null);var e=CB.$(this.elem);c||b?(this.m_selElem=b,CB.$(this.m_selElem).addClass("cbcur-move"),!d&&this.m_selElem&&($(this.m_selElem).is(":visible")||
$(this.m_selElem).parents().children(".cbNodeBtn").trigger("unfold"),this.IsInPageVisible(this.m_selElem)||this.scrollIntoView(this.m_selElem)),d=!1):"scroll"!==e.css("overflow-y")&&window.scrollTo(notaElm.getX(),notaElm.getY())}};b.prototype.scrollCurElemIntoView=function(){if(this.m_selElem)return this.scrollIntoView(this.m_selElem)};b.prototype.blinkCurrElem=function(){this.blinkElem(this.m_selElem,"blinkShort")};b.prototype.blinkCurrElemMedium=function(){this.blinkElem(this.m_selElem,"blinkMedium")};
b.prototype.blinkElem=function(b,d){b&&($(b).addClass(d),(new CB.Timer(function(){$(d).removeClass(d)}.bind(this))).runOnce(600))};b.prototype.emphasizeMove=function(){this.scrollCurElemIntoView();this.blinkElem(this.m_selElem,"blinkAnimation")};b.prototype.scrollIntoView=function(b){var d=b.offsetTop;b=d+b.offsetHeight;var c=this.scrollParent.scrollTop,e=this.scrollParent.clientHeight,q=c+e,r=this.scrollParent.scrollTop;d<c?this.scrollParent.scrollTop=Math.max(0,d-30):b>q&&(this.scrollParent.scrollTop=
b-e);d=Math.abs(this.scrollParent.scrollTop-r);300<d&&this.blinkCurrElem();return 0<d};b.prototype.IsInPageVisible=function(b){var d=b.offsetTop;b=d+b.offsetHeight;var c=this.scrollParent.scrollTop,e=c+this.scrollParent.clientHeight;return d>=c&&b<=e};b.prototype.handleCursorDown=function(){var b=this.findMoveInAdjacentLine(this.m_selElem,!1);b&&(this.setSelItem(b),this.gameGotoElement(b))};b.prototype.handleCursorUp=function(){var b=this.findMoveInAdjacentLine(this.m_selElem,!0);b&&(this.setSelItem(b),
this.gameGotoElement(b))};b.prototype.findMoveInAdjacentLine=function(b,d){if("undefined "!=typeof $&&b){var c=$(b),e=c.data("linecnt"),q=c.data("inx-mv"),e=c.parent().find(String.f('[data-linecnt-this="{0}"][data-inx-mv-parent="{1}"]',e,q));if(e.length&&!d&&(q=$(e[0]).data("nodecnt-this"),e=$(e[0]).find(String.f('[data-nodecnt="{0}"][data-inx-mv="0"]',q)),e.length))return e[0];var r=c.offset().top,t=[],v=1E7;$(this.elem).find(".cbmove, .cbtraininghelptext");e=function(b,c){var e=$(c).offset().top-
r;(d?0>e:0<e)&&Math.abs(e)<=v&&(v=Math.abs(e),t.push(c))};d?$($(this.elem).find(".cbmove").get().reverse()).each(e):$(this.elem).find(".cbmove, .cbtraininghelptext").each(e);t.sort(function(b,d){return Math.abs($(b).offset().top-r)-Math.abs($(d).offset().top-r)});for(e=1;e<t.length;e++)if(d){if($(t[e]).offset().top<$(t[0]).offset().top){t.length=e;break}}else if($(t[e]).offset().top>$(t[0]).offset().top){t.length=e;break}c.offset();c.width();t.sort(function(b,d){return $(b).offset().left-$(d).offset().left});
return t[0]}};b.prototype.findMoveInPrevLine=function(b,d){if("undefined "!=typeof $&&b){var c=null,e=1E7,q=0,r=$(b);$(b).prevAll().find(".cbmove").each(function(b,d){var f=$(d).offset().top-r.offset().top;if(0>f){var g=Math.abs($(d).offset().left-r.offset().left);g<e&&(f==q||!c)&&(e=g,c=d,q=f)}}.bind(this));return c}};b.prototype.m_lastClicked=null;b.prototype.onMouseWheel=function(b){if(this.m_game&&this.m_active){var d="undefined"!=typeof b.wheelDelta?-b.wheelDelta:b.detail;"undefined"==typeof $&&
(0>d?this.m_game.gotoPrev():this.m_game.gotoNext(),b.preventDefault())}};b.prototype.onButtonDown=function(b){this.ptTouchStart=this.ptTouchMove=new CB.Point(b);CB.LOG("ButtonDown:"+this.ptTouchStart);this.buttonDown=!0;this.isTouch="touchstart"==b.type};var d;b.prototype.onButtonUp=function(b){CB.LOG("ButtonUp");this.buttonDown=!1;this.ptTouchMove&&2!=b.button&&10>this.ptTouchMove.getDist(this.ptTouchStart)&&(d=!0,this.focus(),this.onElementClick(b)&&this.fireOnMoveTouched())};b.prototype.onDoubleClick=
function(b){this.m_game.fireOnNotaDoubleClick()};b.prototype.onContextMenu=function(b){this.onElementClick(b);V15.panelMgr.execNotaContextMenu&&(V15.panelMgr.execNotaContextMenu(b),b.preventDefault())};b.prototype.focus=function(){V15.panelMgr&&V15.panelMgr.notaPanel&&V15.panelMgr.notaPanel.focus();var b=this.scrollParent;b?b.focus():alert("no parent for focus")};b.prototype.sign=function(b){return b?0>b?-1:1:0};var e=0<CB.System.getIEVersion()&&!CB.System.isMobile();b.prototype.onMouseMove=function(b){if(this.buttonDown&&
!e){var d=(new CB.Point(b)).subtract(this.ptTouchMove);CB.LOG("Move: "+d);d.y/=Math.min(2,window.devicePixelRatio);this.scrollParent.scrollTop-=this.sign(d.y)*Math.pow(Math.abs(d.y),1.7)*.7;this.ptTouchMove=new CB.Point(b);if(0<d.y&&0==this.scrollParent.scrollTop||0>d.y&&this.scrollParent.scrollTop+this.scrollParent.clientHeight>=this.scrollParent.scrollHeight)return}b.preventDefault()};b.prototype.onMouseLeave=function(b){this.buttonDown=!1};b.prototype.onElementClick=function(b){if(!this.m_active||
!this.m_game)return!1;var d=this.gameGotoElement(b.target);b.preventDefault();return d};b.prototype.gameGotoElement=function(b){var d=b;if(!$(d).is("[data-inx-mv]")&&((d=$(d).parents("[data-inx-mv]"))&&(d=d[0]),!d))return;this.m_lastClicked=d;var c=$(d).data("inx-mv"),e=0;++c;var q=[],r=!0,t=d.parentNode,v=b=!1;$(t).is(".cbLine ")||(t=$(d).parents(".cbline")[0]);$(d).is(".cbTrainingLink")&&(b=$(d).is(".cbTrainingSolution"),v=$(d).is(".cbTrainingHelp"));for(d=t;r;d=d.parentNode)e=Number(e),c=Number(c),
q.push({inxLine:e,mvsToGo:c}),d&&d.getAttribute&&(r=CB.$(d),e=r.data("inx-line"),c=r.data("inx-mv-parent"),r=0!=r.data("level"));c=[];for(e=q.length-1;0<=e;--e)c.push(q[e]);this.m_game.gotoSimplePath(c);this.m_game.triggerOnClickInNotation();if(b||v)if(q=this.m_game.getAnno(CB.AnnoType.TRAINING)){b&&(q.solved=!0,CB.LogStats("Solution: "+this.m_game.hdr.getStrPlayers(!1,0)));v&&q.nHelpClicked++;this.onChanged();b&&this.m_game.gotoNext();if(v)for(b=0;3>b;b++)this.handleCursorDown();this.scrollParent.scrollTop+=
60}return!0};b.prototype.markCurLine=function(){var b=this.m_selElem;if(b){var d=CB.$(b);if(!CB.$.is(b,"[data-inx-mv]")){b=d.parent("[data-inx-mv]");if(!b)return;d=CB.$(b)}var c=$("#"+this.elementId);this.clearCurLine(c);d=d.data("linecnt");1<d&&(c=c.find(String.formatEx('[data-linecnt="{0}"]',d)),c.addClass("cbcurline"),this.markParentCurLine(c,0));this.markAlternatives($(b))}};b.prototype.clearCurLine=function(b){b.find(".cbcurAlternative").removeClass("cbcurAlternative");b.find(".cbcurline").removeClass("cbcurline");
b.find(".cbcurlineparent").removeClass("cbcurlineparent");for(var d=1;6>=d;d++)b.find(".cbcurnode"+d).removeClass("cbcurnode"+d)};b.prototype.markParentCurLine=function(b,d){if(b.length){var c=$(b[0]).parent("[data-inx-mv-parent]");if(c){var e=parseInt($(c).data("inx-mv-parent")),q=$(c).data("linecnt-this"),r=$(c).data("nodecnt-this"),t=$(c).data("level");if(0<q){var v=$("#"+this.elementId),r=v.find(String.formatEx('[data-nodecnt="{0}"]',r));1<=r.length&&(6>t?r.addClass("cbcurnode"+t):r.addClass("cbcurnode6"));
q=String.formatEx('[data-linecnt="{0}"]',q);v=v.find(q);for(q=0;q<v.length;q++){var r=$(v[q]),y=parseInt(r.data("inx-mv"));y<=e&&1<t&&(y<=e-1?r.addClass("cbcurlineparent"):r.addClass("cbcurnode"+t))}this.markParentCurLine($(c),++d)}}}};b.prototype.markAlternatives=function(b){var d=b.data("linecnt"),c=b.data("inx-mv");b.parent().find(String.f('[data-linecnt-this="{0}"][data-inx-mv-parent="{1}"]',d,c)).each(function(b,d){var c=$(d).data("nodecnt-this");$(d).find(String.f('[data-nodecnt="{0}"][data-inx-mv="0"]',
c)).addClass("cbcurAlternative")})};b.prototype.FindMoveElement=function(b){if(this.m_game){var d=this.m_game.getSimplePath();b="";for(var c=0,e=0,q=d.length;e<q;++e){b&&(b+=">");var r=d[e],t=r.mvsToGo;b+=String.formatEx("span.cbline[data-level='{2}'][data-inx-line='{0}'][data-inx-mv-parent='{1}']",r.inxLine,c,e);e===q-1&&(b+=String.formatEx(">span.cbmove[data-inx-mv ='{0}']",t-1));c=t}d=0==b.length;b=String.f("div.nota-game[data-inx-game='{0}']>",this.nInPage)+b;return this.m_lastClicked&&CB.$.is(this.m_lastClicked,
b)?this.m_lastClicked:!d&&(b=CB.$(b))&&1==b.length?b[0]:null}};b.prototype.afterInitDiagrams=function(){if("undefined"!=typeof $&&V15.panelMgr.createDiagramPlayingMode){var b=180;V15.panelMgr.getDiagHeight&&(b=V15.panelMgr.getDiagHeight($(this.elem).width()));var d=0;$("#"+this.elementId).find(".cbdia").each(function(c,e){if(0==$(e).find("div").length){$(e).width(1.1*b);$(e).height(b);var q=this.reserveDiagrams.pop();this.gameKernel=new CB.GameKernel(V15.panelMgr);var r={kernel:this.gameKernel,diagramDiv:e};
r.kernel.setPlayingMode(V15.panelMgr.createDiagramPlayingMode(r.kernel));r.kernel.fnInitGame=function(){return function(b,d){d.boardWin&&(d.boardWin.allowInput=!1);b.reset();if(e){var c=e.dataset.fen;c&&(c=new CB.Position(c),b.assign(new CB.Game(c)))}}}();var t=this.createDiv("diagarea",d);$(t).width(b);$(t).height(b);e.appendChild(t);q?(r.boardArea=q.boardArea,r.boardArea.changeParentElDOM(t),r.kernel.setBoardWin(r.boardArea.canvas.control.boards[0]),r.kernel.initGame()):(r.boardArea=new CB.CanvasParent(t),
r.boardArea.createCanvas(r.kernel,{topDist:0,bottomDist:0,marginDistDivisor:26,shiftXPercent:-1.65,minWForCoordinates:220,transparent:!0,boardShadow:!1}),r.kernel.releaseCommandHandlers());r.boardArea.setSize(t.offsetWidth,t.offsetHeight);r.boardArea.setVisible(!0);this.diagrams.push(r);this.resizeDiagram(e,c);d++}}.bind(this))}};b.prototype.resizeDiagrams=function(){"undefined"!=typeof $&&$("#"+this.elementId).find(".cbdia").each(function(b,d){this.resizeDiagram(d,b)}.bind(this))};b.prototype.resizeDiagram=
function(b,d){if(b&&"undefined"!=typeof $){var c=$(b).find("#diagarea"+d),e=c[0],q=c.width(),c=c.height();e&&this.diagrams[d]&&this.diagrams[d].boardArea&&this.diagrams[d].boardArea.setSize(q-1,c)}};b.prototype.createEvaluationProfile=function(){if(CB.EvalProfileControl){var b=$("#"+this.elementId),d=$("#idEvCanvas-"+this.nInPage),c=this.m_game.getEvaluationProfile();if(c&&c.isValid())if(d.length)this.evProfileControl&&this.evProfileControl.setEvalArr(c);else{var d=b.find(".nota-game"),e=d.height();
0==e&&(e=b.height());b.find(".nota-foot-container");var q=document.createElement("div");q.id="idEvCanvas-"+this.nInPage;q.className="cbevprofile";450<CB.System.zoomToPix(e)||CB.System.isMobile()&&CB.System.isPortraitScreen()||900<window.innerHeight?($(q).insertBefore(b.find(".nota-foot-container")),q.style.margin="0",q.style.boxShadow=""):d.append(q);this.evCanvas=b=new CB.CanvasParent(q);b.setVisible(!0);var r=this;b.createCanvas({createControl:function(b,d,e,f){r.evProfileControl=new CB.EvalProfileControl(b,
d,e,"EvlProfile",f,function(b){r.m_game.gotoIndex(Math.min(b,r.m_game.mainLine.length));r.IsInPageVisible(r.m_selElem)||r.scrollIntoView(r.m_selElem)});r.evProfileControl.setEvalArr(c);return r.evProfileControl}},{});this.evProfileControl&&this.evCanvas&&this.evCanvas.setSize(this.setEvCanvasWidth,this.getEvProfileHeight())}else this.evProfileControl&&this.evProfileControl.reset()}};b.prototype.removeEvaluationProfile=function(){var b=$("#idEvCanvas-"+this.nInPage);b&&b.remove();delete this.evProfileControl};
b.prototype.getEvProfileHeight=function(){var b=66;1150<window.innerHeight?b=80:800>window.innerHeight&&(b=600>window.innerHeight?45:55);return b};b.prototype.resizeEvProfile=function(b){this.setEvCanvasWidth=b-26;b=$("#idEvCanvas-"+this.nInPage).width();this.evCanvas&&(this.evCanvas.setSize(b,this.getEvProfileHeight()),this.setEvCanvasWidth=b)};b.prototype.createDiv=function(b,d){var c=document.createElement("div");c.id=b+d;c.className=b;return c};b.prototype.isActive=function(){return this.m_active};
b.prototype.setActive=function(b){this.m_active=b};b.prototype.onElementDragOver=function(b){b.preventDefault()};b.prototype.onElementDragEnter=function(b){b.preventDefault()};b.prototype.onElementDrop=function(b){CB.LOG("Drop:"+b.dataTransfer);if(this.m_active){b.preventDefault();b=b.dataTransfer;var d=b.files;d.length?this.fromPGNFile(d[0]):(b=b.getData("text"))&&this.loadPGN(b)}};b.prototype.refoldToCurrentLine=function(){0==$(this.elem).find(".cbNodeBtn").length&&(this.initSubElements(),this.markCurLine());
if(this.m_selElem){var b=$(this.m_selElem).parents().children(".cbNodeBtn");$(this.elem).find(".cbNodeBtn").not(b).each(function(b,d){$(d).trigger("fold")})}this.scrollCurElemIntoView()};b.prototype.unfoldAll=function(){V15.config.hasFolding=!0;var b=$(this.elem).find(".cbNodeBtn");0==b.length?(this.initSubElements(),this.markCurLine(),b=$(this.elem).find(".cbNodeBtn"),b.each(function(b,d){$(d).trigger("fold")})):$(".cbmove:hidden")[0]?b.length&&b.each(function(b,d){$(d).trigger("unfold")}):$(".cbNodeBtn").remove();
this.scrollCurElemIntoView()};b.prototype.fromPGNFile=function(b){if("function"==typeof FileReader){var d=new FileReader;d.onloadend=function(){this.pgnLoadDone(d)}.bind(this);d.readAsText(b)}};b.prototype.pgnLoadDone=function(b){this.loadPGN(b.result)};b.prototype.loadPGN=function(b){this.m_game.merge&&this.m_game.merge(PGN.parseGame(b))};Ve.initForListeners(b);Ve.addEvent(b,"MoveTouched");return b}();
CB.NotaElement.factory=function(c,b,d,e,f){b=new CB.NotaElement(b,e||0,f);null==d&&(d=CB.cbNotationDefaults,d.useMatBalance=V15.panelMgr.useMatBalanceDefault());b.initElem(c,d);V15.panelMgr&&(V15.panelMgr.notaElement=b);return b};"use strict";
CB.NotaHeaderElement=function(){var c={},b=function(b){this.w=500;this.h=400;this.initTemplates(300,200);this.elementId=0;this.gateUpdate=new CB.Vr;this.EMPTY_PERSON=V15.mediaPath+"Buttons/Person.jpg";this.EMPTY_UNO=V15.mediaPathFlags+"Flags16/United nations.png";this.requestedBlack=this.requestedWhite="";this.nInPage=b;this.titleText="";this.PERSON_FORMAT="<a href='http://pbserver.chessbase.com/Player?name={4},{5}&year={6}&ref=JSReader' target='_blank'><img class = 'cbplayerimage' src='{0}' alt='{4}' height='{2}' width='{3}'  playid='{1}' ></a>";
V15.config.playerPicLink&&(this.PERSON_FORMAT="<a href='"+V15.config.playerPicLink+"' target='_blank'><img class = 'cbplayerimage' src='{0}' alt='{4}' height='{2}' width='{3}'  playid='{1}' ></a>")};b.prototype.playerDataSource=null;b.prototype.panel=null;b.prototype.m_ng=null;b.prototype.m_selElem=null;b.prototype.m_active=!0;b.prototype.arrPlayer=[null,null];b.prototype.arrPortrait=[null,null];b.prototype.isCompact=function(b,d){return 380>b||240>d};b.prototype.isMoreCompact=function(b,d){return 300>
b||150>d&&500>b};b.prototype.isVeryCompact=function(b,d){return 290>b||130>d&&360>b||80>d};b.prototype.isTiny=function(b,d){return 220>b||90>d&&300>b||70>d};b.prototype.isPracticallyInvisible=function(b,d){return 140>b||70>d};b.prototype.usePlayerBase=function(){return!this.isVeryCompact(this.w,this.h)};b.prototype.resetPlayerCache=function(){};b.prototype.initTemplates=function(b,c){this.w=b;this.h=c;var g;if(this.titleText){var h=[].concat(this.titleText);if(this.titleIcon){var l=String.formatEx(d,
this.titleIcon);g='<div class="cbgame-header" id="ourheaderinside" ><table class="scroll notaTable" id="ourheader"><tr><td width="0%"><span class="cbplayerportrait">'+l+'</span></td><td width="0%"><span class="cbnota-title">'+h[0]+'</span></td><td width="0%"><span class="cbplayerportrait">'+l+"</span></td></tr>";for(l=1;l<h.length;l++)g+='<tr><td width="100%" colspan="3"><span class="cbnota-subtitle">'+h[l]+"</span></td></tr>";g+="</table></div>"}else g='<div class="cbgame-header" id="ourheaderinside" ><span class="cbnota-title">'+
this.titleText+"</span></div>"}else g=this.isPracticallyInvisible(b,c)?'<div class="cbgame-header-tiny" id="ourheaderinside"  style="visibility:hidden;display:none;" ></div>':this.isTiny(b,c)?'<div class="cbgame-header-tiny" id="ourheaderinside" ><table class="notaTable" id="ourheader"><tr><span class="cbmain-header-verycompact"><td width="45%" class="cbplayerwhite"><span class="cbplayertiny">{white.list}</span></td><tpl if="{black}"><td width="10%" class="cbresult"><span >{resultStr}</span></td><td width="45%" class="cbplayerblack"><span class="cbplayertiny">{black.list}</span></td></tpl></tr></table></div>':
this.isVeryCompact(b,c)?'<div class="cbgame-header-verycompact" id="ourheaderinside" ><table class="notaTable" id="ourheader"><tr><span class="cbmain-header-verycompact"><td width="45%" class="cbplayerwhite"><span class="cbplayer">{white.list}</span><tpl if="{eloWhStr}"><span class="cbelocompact">{eloWhStr}</span></tpl></td><tpl if="{black}"><td width="10%" class="cbresult"><span >{resultStr}</span></td><td width="45%" class="cbplayerblack"><span class="cbplayer">{black.list}</span><tpl if="{eloBlStr}"><span class="cbelocompact">{eloBlStr}</span></tpl></td></tpl></tr></table></div>':
this.isMoreCompact(b,c)?'<div class="cbgame-header-morecompact" id="ourheaderinside" ><table class="scroll notaTable" style="table-layout:fixed" id="ourheader"><tr><span class="cbmain-header"><td colspan="2"class="cbflagwhite-morecompact"><span class="cbplayernation">{country[0]}</span></td><td colspan="9" class="cbplayerwhite"><span class="cbplayer" >{white.list}</span><tpl if="{eloWhStr}"><span class="cbelocompact">{eloWhStr}</span></tpl></td><tpl if="{black}"><td colspan="2" class="cbresult"><span >{resultStr}</span></td><td colspan="9"  class="cbplayerblack"><span class="cbplayer">{black.list}</span><tpl if="{eloBlStr}"><span class="cbelocompact">{eloBlStr}</span></tpl></td></tpl><td colspan="2" class="cbflagblack-morecompact"><span class="cbplayernation">{country[1]}</span></td></tr></table></div>':
this.isCompact(b,c)?'<div class="cbgame-header-compact" id="ourheaderinside" ><table class="scroll notaTable" style="table-layout:fixed" id="ourheader"><tr><span class="cbmain-header"><td colspan="9"class="cbplayerwhite"><span class="cbplayer" >{white.list}</span><tpl if="{eloWhStr}"><span class="cbelocompact">{eloWhStr}</span></tpl></td><tpl if="{black}"><td colspan="2" class="cbresult"><span >{resultStr}</span></td><td colspan="9"  class="cbplayerblack"><span class="cbplayer">{black.list}</span><tpl if="{eloBlStr}"><span class="cbelocompact">{eloBlStr}</span></tpl></td></tpl></tr><tr><td colspan="2" class="cbflagwhite"><span class="cbplayernation">{country[0]}</span></td><td colspan="1" class="cbfide cbfidecompact"><span>{titleWhStr}</span></td><td colspan="14" style="text-align:center"><tpl if="{event.event}"><span class="cbevent">{event.event}</span></tpl></td><td colspan="1" class="cbfide cbfidecompact"><span>{titleBlStr}</span></td><td colspan="2" class="cbflagblack"><span class="cbplayernation">{country[1]}</span></td></tr></table></div>':
'<div class="cbgame-header" id="ourheaderinside" ><table class="scroll notaTable" id="ourheader" style="table-layout:fixed" ><tr><span class="cbmain-header"><td  class="cbplayerportrait" colspan="3" rowspan="2"><span >{portrait[0]}</span></td><td class="cbplayerwhite" colspan="8"><span class="cbplayer">{white}</span><tpl if="{eloWhStr}"><span class="cbelo">{eloWhStr}</span></tpl></td><tpl if="{black}"><td colspan="2" class="cbresult"><span >{resultStr}</span></td><td class="cbplayerblack" colspan="8"><span class="cbplayer">{black}</span><tpl if="{eloBlStr}"><span class="cbelo">{eloBlStr}</span></tpl></td><td class="cbplayerportrait" colspan="3" rowspan="2"><span>{portrait[1]}</span></td></tpl></tr><tr><td colspan="2" class="cbflagwhite" ><span class="cbplayernation">{country[0]}</span></td><td colspan="1" class="cbfide"><span>{titleWhStr}</span></td><td colspan="12" class="cbtourndata"><tpl if="{event.event}"><span class="cbevent">{event.event}</span></tpl><tpl if="{uniquePlace}"><br/><span class="cbsite">{uniquePlace}</span></tpl><tpl if="{event.dt}"><span class="cbeventdate">{dateStr}</span></tpl><tpl if="{annotator}"><span class="cbannotator">{annotatorStr}</span></tpl></td><td colspan="1" class="cbfide"><span>{titleBlStr}</span></td><td colspan="2" class="cbflagblack"<span class="cbplayernation">{country[1]}</span></td></tr></table></div>';
this.headerTemplate=function(){return String.formatEx(g,this)}};var d="<img src='{0}' alt='' height='24' width='24'>";b.prototype.InitEmptyHeader=function(d){d=d||new CB.GameHeader;this.hdrItem=ObjUtil.clone(d);this.hdrItem.resultStr=b.ResultToStr(this.hdrItem.getResult());this.hdrItem.portrait=[null,null];this.hdrItem.country=[null,null];this.hdrItem.geoIpNation=[0,0];this.hdrItem.title=[null,null];d.nationWhite&&(this.hdrItem.geoIpNation[0]=d.nationWhite);d.nationBlack&&(this.hdrItem.geoIpNation[1]=
d.nationBlack);return this.headerTemplate&&this.headerTemplate.apply?this.headerTemplate.apply(this.hdrItem):" --- "};b.prototype.InitHeader=function(b,d){this.displayOpening("");-1==this.hdrItem.event.event.search(this.hdrItem.event.site)&&(this.hdrItem.uniquePlace=this.hdrItem.event.site);-1!=this.hdrItem.annotator.search("Robot");this.hdrItem.annotator="";this.usePlayerBase()&&b&&(this.displayOpening(b.eco),this.hdrItem.eloWhStr=0<b.eloWh?b.eloWh:"",this.hdrItem.eloBlStr=0<b.eloWh?b.eloBl:"",this.hdrItem.annotatorStr=
b.annotator?"["+b.annotator+"]":"","[ChessBase]"==this.hdrItem.annotatorStr&&(this.hdrItem.annotatorStr=""),this.hdrItem.annotatorStr||(this.hdrItem.dateStr=b.date.toLocaleString()),this.prepareHeader(this.hdrItem),this.requestPlayerBase(),this.hdrItem.titleWhStr=this.getTitleStr(this.hdrItem,0),this.hdrItem.titleBlStr=this.getTitleStr(this.hdrItem,1),this.bRequestPlayerBase=!1);if(d){if(this.headerTemplate&&this.headerTemplate.apply)return this.headerTemplate.apply(this.hdrItem)}else if(this.headerInsideTemplate.apply)return this.headerInsideTemplate.apply(this.hdrItem);
return b?b.toString():null};b.prototype.getTitleStr=function(b,d){if(b.title&&CB.Title)return CB.Title.getStr(b.title[d])};b.prototype.requestPlayerBase=function(){if(CB.LoginMode){for(var b=!1,d=this.hdrItem.getBlackKey(),d=[this.hdrItem.getWhiteKey(),d],g=CB.Side.WHITE;g<=CB.Side.BLACK;++g){var h=c[d[g]];h&&h.answered?(this.hdrItem.country[g]=h["country"+this.getFlagSize()],this.hdrItem.title[g]=h.title,g==CB.Side.WHITE?this.requestedWhite=this.hdrItem.white:this.requestedBlack=this.hdrItem.black):
(this.hdrItem.geoIpNation[g]?(b=new CB.Nation(this.hdrItem.geoIpNation[g]),this.setHdrItemCountry(d[g],b,g)):this.hdrItem.country[g]=String.formatEx("<img src='{0}' alt='' height='16' width='16'>",this.EMPTY_UNO),b=this.bRequestPlayerBase&&(!h||!h.requested));h&&h.answered?(this.hdrItem.portrait[g]=h["portrait"+this.getPortraitSize()],!this.hdrItem.portrait[g]&&h.portrait32&&(this.hdrItem.portrait[g]=h.portrait32)):this.hdrItem.portrait[g]=String.formatEx("<img src='{0}' alt='' height='24' width='24' style='display:none'>",
this.EMPTY_PERSON)}b&&this.gateUpdate.exec(function(){this.requestPlayerData()}.bind(this),500)}};b.prototype.prepareHeader=function(b){b.white.last=b.white.last.replace("-"," ");b.black.last=b.black.last.replace("-"," ");var d=b.white.first.search(/\./);0<d&&b.white.first&&(b.white.first=b.white.first.slice(0,d));d=b.black.first.search(/\./);0<d&&b.black.first&&(b.black.first=b.black.first.slice(0,d));b.getWhiteKey=function(){var b=this.white.last;this.white.first&&(b+=this.white.first.slice(0,1));
return b};b.getBlackKey=function(){var b=this.black.last;this.black.first&&(b+=this.black.first.slice(0,1));return b}};b.prototype.requestPlayerData=function(){var b=this.m_game.getHeader();this.prepareHeader(b);var d=function(){if(V15.playerLobby){this.requestedWhite=b.getWhite();this.requestedBlack=b.getBlack();CB.LOG("Request: "+b.getWhite()+" / "+b.getBlack(),"","pb");var d=b.date.getYear();d||(d=CB.Date.getThisYear());b.white.last&&(V15.playerLobby.getPlayer(b.white.first,b.white.last,b.eloWh,
d,this.onWhite.bind(this)),c[b.getWhiteKey()]||(c[b.getWhiteKey()]={}),c[b.getWhiteKey()].requested=!0);b.black.last&&(V15.playerLobby.getPlayer(b.black.first,b.black.last,b.eloBl,d,this.onBlack.bind(this)),c[b.getBlackKey()]||(c[b.getBlackKey()]={}),c[b.getBlackKey()].requested=!0)}else console.log("NoPB: "+b.white.last+"-"+b.black.last)}.bind(this);V15.playerLobby?d():(CB.LOG("PlayerLobby not connected yet","","pb"),(new CB.Timer(d)).runOnce(4E3))};b.prototype._onPlayer=function(d,f){if(d&&d.player){var g=
d.player.getFirstName(),h=d.player.getLastName(),l=this.buildCacheKey(h,g);c[l]||(c[l]={});c[l].answered=!0;var q=d.player,r=new CB.Nation(0);this.arrPlayer[f]=q;q.m_NewCBPlayer&&(CB.LOG("OnPlayer: "+l,"","conn"),r=q.m_NewCBPlayer.m_HighData.m_aNation,r=new CB.Nation(r),q=q.m_NewCBPlayer.m_HighData.m_aTitle,this.hdrItem.title[f]=q,c[l].title=q,this.hdrItem.geoIpNation[f]||this.setHdrItemCountry(l,r,f));(q=d.pic)?(this.arrPortrait[f]="string"===typeof q?q:b.constructImageFromData(q),[34,40,48,64,80,
100,120].forEach(function(b){var d=this.hdrItem.date.year;d||(d=CB.Date.getThisYear());d=String.formatEx(this.PERSON_FORMAT,this.arrPortrait[f],f,b*Math.SQRT2,b,h,g,d);b==this.getPortraitSize()&&(this.hdrItem.portrait[f]=d);c[l]["portrait"+b]=d}.bind(this))):this.isCompact(this.w,this.h)||this.isMoreCompact(this.w,this.h)||(q=this.getPortraitSize(),34==q||40==q?q=32:64<q&&(q=64),r=V15.mediaPathFlags+String.formatEx("Flags{0}/{1}.png",q,r.getStrFlag()),r=String.formatEx("<img src='{1}' alt='' height='{0}' width='{0}' style='vertical-align: {2};border:none;box-shadow:none' >",
q,r,"top"),this.hdrItem.portrait[f]=c[l]["portrait"+q]=r,this.hdrItem.country[f]="",this.getFlagRaster().forEach(function(b){this.hdrItem.country[f]=" ";c[l]["country"+b]=" "}.bind(this)))}};b.prototype.buildCacheKey=function(b,d){var c=b;if(d){var h=d.charAt(d.length-1);"0"<=h&&"9">=h&&(d=d.slice(0,firtsName.length-1));c+=d.slice(0,1)}return c};b.prototype.setHdrItemCountry=function(b,d,g){if(d&&b&&(0==g||1==g)&&d.getStrFlag){var h=this.getFlagRaster();c[b]||(c[b]={});h.forEach(function(h){var q;
q=V15.mediaPathFlags+String.formatEx("Flags{0}/{1}.png",h,d.getStrFlag());q=String.formatEx("<img src='{1}' alt='' height='{0}' width='{0}' style='vertical-align: {2};border:none;box-shadow:none' >",h,q,"middle");h==this.getFlagSize()&&(this.EMPTY_UNO=V15.mediaPathFlags+String.formatEx("Flags{0}/United nations.png",h),this.hdrItem.country[g]=q);c[b]["country"+h]=q}.bind(this))}};b.prototype.getFlagSize=function(){return 500>this.w||400>this.h?400>this.w||300>this.h?16:24:750<this.w&&560<this.h?48:
32};b.prototype.getFlagRaster=function(){return[16,24,32,48,64]};b.prototype.getPortraitSize=function(){return 380<this.w&&260<this.h?450<this.w&&360<this.h?550<this.w&&450<this.h?650<this.w&&520<this.h?900<this.w?1E3<this.w?120:100:80:64:48:40:34};b.prototype.onWhite=function(b){CB.LOG("ON WHITE!");this._onPlayer(b,CB.Side.WHITE);this.scheduleUpdate(100)};b.prototype.onBlack=function(b){CB.LOG("ON BLACK!");this._onPlayer(b,CB.Side.BLACK);this.scheduleUpdate(100)};b.constructImageFromData=function(b){return CB.BinToString.ByteArrayToDataURI(b,
"image/jpeg")};b.prototype.initElem=function(b,d){this.elementId=b;this._setOptions(d);var c=CB.$("#"+b);if(CB.Element.isEventSupported("touchstart"))c.on("touchend",this.onButtonUp.bind(this));if(CB.Element.isEventSupported("mousedown"))c.on("mouseup",this.onButtonUp.bind(this));this.initSubElements()};b.prototype._setOptions=function(b){b.notationLocalization||(b.notationLocalization=CB.V1);this.m_ng=new CB.NotationGenerator(b.notationLocalization);this.m_useHeader=b.useHeader;this.m_useResult=
b.useResult;this.m_active=b.isActive;this.m_options=b;b.game&&this.setGame(b.game)};b.prototype.setOptions=function(b){this._setOptions(b)};b.prototype.m_game=null;b.prototype.setGame=function(b){this.m_game&&(this.m_game.removeOnMoveListener(this.m_inxOnMove),this.m_game.removeOnNavigateListener(this.m_inxOnNavigate),this.m_game.removeOnChangedListener(this.m_inxOnChanged),this.m_game.removeOnHeaderChangedListener(this.m_inxOnHeaderChanged));if(this.m_game=b)this.m_inxOnMove=this.m_game.addOnMoveListener(this.onMove.bind(this)),
this.m_inxOnNavigate=this.m_game.addOnNavigateListener(this.OnNavigate.bind(this)),this.m_inxOnChanged=this.m_game.addOnChangedListener(this.OnChanged.bind(this)),this.m_inxOnHeaderChanged=this.m_game.addOnHeaderChangedListener(this.onHeaderChanged.bind(this)),this.bRequestPlayerBase=!0;this.initSubElements()};b.prototype.getGame=function(){return this.m_game};b.prototype.onMove=function(){};b.prototype.OnChanged=function(){};b.prototype.onHeaderChanged=function(b){var d=null;this.m_game&&(d=this.m_game.getHeader());
if(this.requestedWhite!==d.getWhite()||this.requestedBlack!==d.getBlack())this.bRequestPlayerBase=!0;b&&b.recalc&&(b=$("#notaEl").width(),d=$("#notaEl").height(),null==b&&(b=$("#notaEl"+this.nInPage).width(),d=$("#notaEl"+this.nInPage).height()),this.initTemplates(b,d));this.initSubElements()};b.prototype.OnNavigate=function(b){};b.ResultToStr=function(b){return b==CB.GameResultEnum.UNDEFINED_RESULT?"-":CB.GameResultEnum.toString(b)};b.prototype.displayOpening=function(b){3==b.length&&(this.hdrItem.eco=
lm[b+"_ECO"])};b.prototype.scheduleUpdate=function(b){this.gateUpdate.exec(function(){this.updateSubElements();delete this.bRequestPlayerBase}.bind(this),b)};b.prototype.initSubElements=function(){var b=null;this.m_game&&(b=this.m_game.getHeader(),b.white.list=b.white.getListStr(1),b.black.list=b.black.getListStr(1));this.InitEmptyHeader(b,!0);b=this.InitHeader(b,!0);CB.$("#theheader-"+this.nInPage).html(b)};b.prototype.updateSubElements=function(){var b=null;this.m_game&&(b=this.m_game.getHeader());
b=this.InitHeader(b,!0);CB.$("#theheader-"+this.nInPage).html(b)};b.prototype.focus=function(){};b.prototype.onMouseMove=function(b){b.preventDefault()};b.prototype.showPlayerDetails=function(b,d,c){"undefined"!==typeof Ext&&b&&!glSettings.inDialog()&&CB.Forms&&CB.Forms.showPlayer(b,d,c)};b.prototype.onButtonUp=function(b){};b.prototype.onElementClick=function(b){if(!(!this.m_active||600>window.innerHeight||700>window.innerWidth)){var d=b.target;CB.$.is(d,"[playid]")&&(d=CB.$(d).attr("playid"),this.showPlayerDetails(this.arrPlayer[d],
0,this.arrPortrait[d]));b.preventDefault()}};b.prototype.isActive=function(){return this.m_active};b.prototype.setActive=function(b){this.m_active=b};b.prototype.onElementDragOver=function(b){b.preventDefault()};b.prototype.onElementDragEnter=function(b){b.preventDefault()};b.prototype.resize=function(b,d){CB.DOM.resize(this.elementId,b,d)};b.prototype.setTitleOnly=function(b,d){this.titleText=b;this.titleIcon=d;this.initTemplates(this.w,this.h);this.updateSubElements()};b.prototype.onResize=function(b,
d){this.w=b;this.h=d;this.initTemplates(b,d);this.bRequestPlayerBase=!0;this.updateSubElements()};return b}();CB.NotaHeaderElement.factory=function(c,b){var d=new CB.NotaHeaderElement(b);d.initElem(c,CB.cbNotationDefaults);return V15.panelMgr.notaHeaderElement=d};"use strict";
CB.NotaFooterElement=function(){var c=function(b,d){this.elementId=0;this.gateUpdate=new CB.Vr;this.matBalance=[];this.nInPage=b;this.ticket=d};c.prototype.panel=null;c.prototype.InitFooter=function(b){return this.generateHTML(b)};c.prototype.getPiece=function(b){return(CB.Side.toString(CB.Piece.side(b))+CB.Piece.toString(b)).toLowerCase()};c.TABLE_CELL_FMT='<span class="piece-{0}"></span>';c.TABLE_END_FMT="</div>";c.prototype.getTableStartFmt=function(){var b;b='<a href="'+(V15?V15.getAppUrl(V15.Vo.SWITCHAPP_DATABASE):
"https://database.chessbase.com")+'" class="footer-book" id="footer-book{0}"></a><div class="footer-eval" id="footer-eval{0}"></div>';return b+'<div class="mat-balance">'};c.prototype.generateHTML=function(b){V15&&V15.config.externalCommonPath&&(c.TABLE_CELL_FMT='<span style="background-image: url( {1}Media/Buttons/{0}-16px.png );"></span>');for(b=0;6>b;b++);var d=String.formatEx(this.getTableStartFmt(),this.nInPage);for(b=0;6>b;b++)if(0<this.matBalance[b+1])for(var e=0;e<this.matBalance[b+1];e++)d+=
String.formatEx(c.TABLE_CELL_FMT,this.getPiece(b+1),CB.getCommonPath());for(b=0;6>b;b++)if(0>this.matBalance[b+1])for(e=0;e<Math.abs(this.matBalance[b+1]);e++)d+=String.formatEx(c.TABLE_CELL_FMT,this.getPiece(b+9),CB.getCommonPath());return d+=c.TABLE_END_FMT};c.prototype.collapseHeader=function(){CB.$("#thefooter-"+this.nInPage).addClass("notafooter-container")};c.prototype.expandHeader=function(){CB.$("#thefooter-"+this.nInPage).addClass("notafooter-container")};c.prototype.initElem=function(b){this.collapseHeader();
this.elementId=b;this.update()};c.prototype._setOptions=function(b){this.m_options=b;b.game&&this.setGame(b.game)};c.prototype.setOptions=function(b){this._setOptions(b)};c.prototype.m_game=null;c.prototype.setText=function(b){CB.$("#footer-eval"+this.nInPage).text(b)};c.prototype.setGame=function(b){this.m_game&&(this.m_game.removeOnMoveListener(this.m_inxOnMove),this.m_game.removeOnNavigateListener(this.m_inxOnNavigate),this.m_game.removeOnChangedListener(this.m_inxOnChanged));if(this.m_game=b)this.m_inxOnMove=
this.m_game.addOnMoveListener(this.onMove.bind(this)),this.m_inxOnNavigate=this.m_game.addOnNavigateListener(this.OnNavigate.bind(this)),this.m_inxOnChanged=this.m_game.addOnChangedListener(this.OnChanged.bind(this))};c.prototype.getGame=function(){return this.m_game};c.prototype.onMove=function(){this.update()};c.prototype.OnChanged=function(){this.update()};c.prototype.OnNavigate=function(b){!this.liveBookListenerId&&V15.aTBLobby&&(this.liveBookListenerId=V15.aTBLobby.addOnLiveBookDisplayListener(this.liveBookListener.bind(this)));
this.update()};c.prototype.update=function(){for(var b=[],d=0;16>d;d++)b[d]=0;if(null!==this.getGame())for(var c=this.getGame().getCurPos(),d=0;64>d;d++)b[c.board[d]]++;for(d=1;7>d;d++)this.matBalance[d]=b[d]-b[d+8];this.initSubElements()};c.prototype.scheduleUpdate=function(){this.gateUpdate.exec(function(){this.initSubElements()}.bind(this),200)};c.prototype.initSubElements=function(){var b=new StringBuilder;this.hasImbalance()&&CB.$(".footer-eval").text("");var d=this.InitFooter(!1);d.length&&
b.append(d);CB.$("#thefooter-"+this.nInPage).html(b.toString());b=(b=CB.$("#notaparent"+this.nInPage))&&b.single()&&360<b.single().clientHeight;this.hasImbalance()||b?CB.$("#thefooter-"+this.nInPage).show():CB.$("#thefooter-"+this.nInPage).hide()};c.prototype.hasImbalance=function(){for(var b=0;6>b;b++)if(0!=this.matBalance[b+1])return!0;return!1};c.prototype.focus=function(){};c.prototype.onElementDragOver=function(b){b.preventDefault()};c.prototype.onElementDragEnter=function(b){b.preventDefault()};
c.prototype.resize=function(b,d){CB.DOM.resize(this.elementId,b,d)};c.prototype.liveBookListener=function(b){if(!CB.System.isElectron()&&b&&(!this.ticket||this.ticket==b.ticket)){for(var d=0,c=0;c<b.moves.length;c++)d+=b.moves[c].getNGames();d?CB.$("#footer-book"+this.nInPage).text(lm.LIVE_BOOK+": "+d+" "+lm.GAMES):CB.$("#footer-book"+this.nInPage).text("")}};return c}();
CB.NotaFooterElement.factory=function(c,b){var d=new CB.NotaFooterElement(b);d.initElem(c,CB.cbNotationDefaults);return V15.panelMgr.NotaFooterElement=d};"use strict";
CB.BoardMessage=function(){var c=new CB.Color(0,0,0,.25),b=new CB.Color(255,255,250,.95),d=1,e=function(b,c,e){e=e||!1;this.uniqueId=d++;this.background=new CB.DivElement(document.body,"bMessageBG"+this.uniqueId);this.background.setZIndex(99999);this.textEl=new CB.DivElement(this.background,"bMessageText"+this.uniqueId);CB.$(this.background.elDOM).addClass("board-msg");e&&CB.$(this.background.elDOM).addClass("modal");b.messageWin=this;this.textEl.setText(c||"Empty Board Message");this.background.elDOM.addEventListener("mousedown",
function(d){e||(b.destroyMessage(),d.preventDefault())});this.textEl.elDOM.addEventListener("mousemove",function(b){b.preventDefault()})};e.prototype.destroy=function(){this.background.destroy()};e.prototype.setText=function(b){this.textEl.setText(b)};e.prototype.setVisible=function(b){this.background.setVisible(b)};e.prototype.onResize=function(d){var e=d.cbcanvas.getBoundingClientRect(),h=new CB.Rect(e.left,e.top,e.left+e.width,e.top+e.height);d.cbcanvas.pixToZoomRect&&(h=d.cbcanvas.pixToZoomRect(d.getOuterRect()));
var l=2;d.nSqPix&&(l=d.nSqPix);var q=Math.round(.7*h.w),r=Math.round(q/11),t=1;50<this.textEl.getText().length&&(r*=2.1,t=2);this.background.setPos((h.w-q)/2+h.left+e.left,(h.h-r)/2+h.top+e.top-r/2-(l-r)/2+window.pageYOffset);this.background.setSize(q,r);this.textEl.setPos(0,0);this.textEl.setSize(q,r);d.cbcanvas.pixToZoom&&this.textEl.setBorder(d.cbcanvas.pixToZoom(2),new CB.Color(0,0,0,.7));this.textEl.setBackgroundColor(c);this.textEl.setColor(b);400<q?this.textEl.setFontFamily("Roboto, Merriweather, Helvetica, sans-serif; font-stretch: expanded"):
250>q&&this.textEl.setFontFamily("Roboto, Merriweather, Helvetica, sans-serif; font-stretch: condensed");d=Math.max(5,.9*r/t);do this.textEl.setFontSize(d),--d;while(5<d&&this.textEl.getTextWidth()>.95*q&&this.textEl.getTextHeight()>.95*r);this.textEl.setCenteredText()};return e}();
CB.BoardBubble=function(){var c=1,b=function(b,e,f,g,h){this.uniqueId=c++;this.square=e;if("undefined"==typeof this.square||null==this.square)this.square=-1;this.width=f||300;this.background=new CB.DivElement(document.body,"bBubbleBG"+this.uniqueId);$(this.background.elDOM).addClass("cbBoardBubble");this.setText(b,g);this.direction=h};b.TOP_RIGHT=0;b.BOTTOM_RIGHT=1;b.BOTTOM_LEFT=2;b.TOP_LEFT=3;b.prototype.destroy=function(){this.background.destroy()};b.prototype.setText=function(b,c){c?$(this.background.elDOM).html(String.f("{0}<img src='{1}' class='cbBoardBubbleIcon'>",
b,c)):$(this.background.elDOM).text(b)};b.prototype.setVisible=function(b){this.background.setVisible(b)};b.prototype.onResize=function(d){var c=this.direction||this.calcBestDirection(d,this.square),f=d.cbcanvas.getBoundingClientRect(),g;new CB.Rect(f.left,f.top,f.left+f.width,f.top+f.height);if(d.cbcanvas.pixToZoomRect&&d.cbcanvas.pixToZoom){g=d.cbcanvas.pixToZoomRect(d.getOuterRect());var h=2;d.nSqPix&&(h=d.nSqPix);$(this.background.elDOM).css("max-width",this.width);var l=$(this.background.elDOM).outerWidth(),
q=$(this.background.elDOM).outerHeight(),r=(g.w-l)/2+g.left+f.left;g=(g.h-q)/2+g.top+f.top-q/2-(2.5*h-q)/2+window.pageYOffset;if(-1!=this.square){g=d.cbcanvas.pixToZoomRect(d.getInnerRect());r=g.left+f.left;g=g.top+f.top+window.pageYOffset;var f=this.square>>3,t=7-(this.square&7);d.blackIsBottom&&(f=7-f,t=7-t);var v=d.cbcanvas.pixToZoom(8),y=d.cbcanvas.pixToZoom(40);switch(c){default:case b.TOP_RIGHT:r+=d.cbcanvas.pixToZoom((f+1)*h);r-=v;g+=d.cbcanvas.pixToZoom(t*h)-q;g-=y;break;case b.BOTTOM_RIGHT:r+=
d.cbcanvas.pixToZoom((f+1)*h);r-=v;g+=d.cbcanvas.pixToZoom((t+1)*h);g+=y;break;case b.BOTTOM_LEFT:r+=d.cbcanvas.pixToZoom(f*h)-l;r+=v;g+=d.cbcanvas.pixToZoom((t+1)*h);g+=y;break;case b.TOP_LEFT:r+=d.cbcanvas.pixToZoom(f*h)-l,r+=v,g+=d.cbcanvas.pixToZoom(t*h)-q,g-=y}}else $(this.background.elDOM).removeClass("cbBoardBubbleTR cbBoardBubbleBR cbBoardBubbleTL cbBoardBubbleBL");if(r+l<window.innerWidth&&5<r&&-1!=this.square)switch(c){default:case b.TOP_RIGHT:$(this.background.elDOM).addClass("cbBoardBubbleTR");
break;case b.TOP_LEFT:$(this.background.elDOM).addClass("cbBoardBubbleTL");break;case b.BOTTOM_RIGHT:$(this.background.elDOM).addClass("cbBoardBubbleBR");break;case b.BOTTOM_LEFT:$(this.background.elDOM).addClass("cbBoardBubbleBL")}else $(this.background.elDOM).removeClass("cbBoardBubbleTR cbBoardBubbleBR cbBoardBubbleTL cbBoardBubbleBL"),5>r&&(r=5),r+l>window.innerWidth&&(r=window.innerWidth-l);$(this.background.elDOM).css({position:"absolute",left:r+"px",top:g+"px"})}};b.prototype.calcBestDirection=
function(d,c){for(var f=this.countCoveredPieces(d,c,b.TOP_RIGHT),g=this.countCoveredPieces(d,c,b.BOTTOM_RIGHT),h=this.countCoveredPieces(d,c,b.BOTTOM_LEFT),l=this.countCoveredPieces(d,c,b.TOP_LEFT),f=[f,g,h,l],g=-1,h=64,l=0;4>l;l++)f[l]<h&&(h=f[l],g=l);return g};b.prototype.countCoveredPieces=function(d,c,f){c=0;var g=this.square>>3,h=this.square&7;d.blackIsBottom&&(g=7-g,h=7-h);switch(f){default:case b.TOP_RIGHT:for(f=g+1;f<g+5&&8>f;f++)for(var l=h+1;l<h+3&&8>l;l++)0!=d.board.sqs[8*f+l]&&(c+=1,console.log(c));
break;case b.BOTTOM_RIGHT:for(f=g+1;f<g+5&&8>f;f++)for(l=h-1;l>h-3&&0<l;l--)0!=d.board.sqs[8*f+l]&&c++;break;case b.BOTTOM_LEFT:for(f=g-1;f>g-5&&0<f;f--)for(l=h-1;l>h-3&&0<l;l--)0!=d.board.sqs[8*f+l]&&c++;break;case b.TOP_LEFT:for(f=g-1;f>g-5&&0<f;f--)for(l=h+1;l<h+3&&8>l;l++)0!=d.board.sqs[8*f+l]&&c++}return c};return b}();"use strict";
CB.DiagramAnimationController=function(){var c=function(b,d,c,e){this.pos=ObjUtil.clone(d);this.boardWin=c;this.diagDiv=e;this.parseAnimations(b);this.timer=new CB.Timer(this.timerHdl.bind(this));this.loopBeginInx=this.nAnim=0;this.timeScale=1;this.currBoard=ObjUtil.clone(this.pos.board);this.storeBoard=[];this.storeBoard[0]=ObjUtil.clone(this.pos.board);this.postedSuccess=!1};c.needsDiagramAnimButtons=function(b){var d=!1;b.forEach(function(b){if(b.match(/move:/i)||b.match(/beginloop/i))d=!0});return d};
c.parseDiagramHelp=function(b){var d={text:"",icon:null,sq:-1,attrs:[]};b=b.split("/");for(var e=0;e<b.length;e++){var f=b[e].match(/text:(.+)/i);if(f)d.text=f[1];else{var r=b[e].match(/arrow:([a-h][1-8][a-h][1-8]),(\d+),(\w+)(,dash)?/i);if(r){var f=CB.Square.fromString(r[1].substr(0,2)),t=CB.Square.fromString(r[1].substr(2,2)),v=null;r[4]&&(v=[4,8]);d.attrs.push(new CB.BoardArrow(f,t,CB.DiagramAnimationController.translateArrowColor(r[3]),parseInt(r[2]),v))}else if(r=b[e].match(/file:([a-h][1-8][a-h][1-8]),(\d+),(.+)/i))f=
CB.Square.fromString(r[1].substr(0,2)),t=CB.Square.fromString(r[1].substr(2,2)),d.attrs.push(new CB.BoardLine(c.getFilePoints(f,t),parseInt(r[2]),CB.DiagramAnimationController.translateLineColor(r[3]),[2,10]));else if(r=b[e].match(/rank:([a-h][1-8][a-h][1-8]),(\d+),(.+)/i))f=CB.Square.fromString(r[1].substr(0,2)),t=CB.Square.fromString(r[1].substr(2,2)),d.attrs.push(new CB.BoardLine(c.getRankPoints(f,t),parseInt(r[2]),CB.DiagramAnimationController.translateLineColor(r[3]),[2,10]));else if(r=b[e].match(/diagonal:([a-h][1-8][a-h][1-8]),(\d+),(.+)/i))f=
CB.Square.fromString(r[1].substr(0,2)),t=CB.Square.fromString(r[1].substr(2,2)),d.attrs.push(new CB.BoardLine(CB.DiagramAnimationController.getDiagonalPoints(f,t),parseInt(r[2]),CB.DiagramAnimationController.translateLineColor(r[3]),[2,15]));else if(f=b[e].match(/(mark|bigmark):(\[([a-h][1-8],?){2,}\]|[a-h][1-8]),(.{3,})/i))if(t=f[2],2<t.length){if(t=t.match(/([a-h][1-8])/g))for(r=0;r<t.length;r++)v=CB.Square.fromString(t[r]),d.attrs.push(new CB.BoardColouredSquare(v,CB.DiagramAnimationController.translateSquareColor(f[4],
v),"bigmark"==f[1]))}else t=CB.Square.fromString(f[2]),d.attrs.push(new CB.BoardColouredSquare(t,CB.DiagramAnimationController.translateSquareColor(f[4],t),"bigmark"==f[1]));else if(v=b[e].match(/bubble:([a-h][1-8])/i))d.sq=CB.Square.fromString(v[1]);else if(f=b[e].match(/icon:(.+)/))d.icon=CB.getCommonPath()+"Media/Emojis/"+f[1]+".png";else if(f=b[e].match(/line:([a-h1-8tlbr-]+,(\d+),(.+))/))t=CB.BoardLinePoint.stringToPoints(f[1].split(",")[0]),d.attrs.push(new CB.BoardLine(t,f[2],CB.DiagramAnimationController.translateLineColor(f[3])))}}return d};
c.parseChoiceFeedback=function(b){for(var d=[],e=0;e<b.length;e++){var f=b[e];switch(f.name){case "Mark":for(var r=0;r<f.squares.length;r++)d.push(new CB.BoardColouredSquare(f.squares[r].sq,c.translateSquareColor(f.color,f.squares[r].sq),3<f.thick));break;case "Arrow":d.push(new CB.BoardArrow(f.from.sq,f.to.sq,c.translateArrowColor(f.color),f.thick,f.dashed))}}return d};c.prototype.parseAnimations=function(b){this.animations=[];b.forEach(function(b){var d={},c="",e=b.indexOf(":");0<e?(d.command=b.substr(0,
e),c=b.substr(e+1),d.command.indexOf("$")&&(b=d.command.split("$"),d.command=b[0],d.subCommand=b[1])):d.command=b;1<c.length&&(c=c.split("/"),1<c.length?(d.time=parseFloat(c[1].substr(0,c[1].length-1)),isNaN(d.time)&&(d.time=0),3<=c.length&&(d.icon=CB.getCommonPath()+"Media/Emojis/"+c[2]+".png")):d.time=0,this.isTextCommand(d.command)?d.params=[c[0]]:d.params=c[0].split(","));this.animations.push(d)}.bind(this))};c.prototype.setStartBoard=function(){this.boardWin.setBoard(this.pos.board);this.boardWin.redraw();
this.currBoard=ObjUtil.clone(this.pos.board)};c.prototype.rewind=function(b){this.timer.stop();this.nAnim=0;this.setStartBoard();this.clearColors();this.boardWin.destroyMessage();this.boardWin.destroySideIcon();b&&this.drawInvariants();this.userMoved=!1};c.prototype.onUserMove=function(){this.userMoved=!0};c.prototype.play=function(){this.userMoved&&this.rewind();0==this.nAnim&&this.setStartBoard();this.timeScale=1;this.timer.runOnce(0);this.isSingleStep=!1;this.onPlay()};c.prototype.step=function(){this.userMoved&&
this.rewind();0==this.nAnim&&this.setStartBoard();this.timeScale=1;this.isSingleStep=!0;this.timer.runOnce(0);this.onPlay()};c.prototype.stepBack=function(){this.userMoved&&this.rewind();this.timeScale=1;this.isSingleStep=!0;for(this.nAnim--;0<this.nAnim&&"move"!=this.animations[this.nAnim].command;)this.nAnim--;if(0>=this.nAnim)this.setStartBoard(),this.nAnim=0;else{var b=this.boardWin.animSteps;this.boardWin.animSteps={forMove:4,forPosition:4};this.boardWin.setBoard(this.storeBoard[this.nAnim],
!0);this.boardWin.animSteps=b;this.currBoard=ObjUtil.clone(this.storeBoard[this.nAnim]);this.clearText();this.clearColors()}};c.prototype.fastForward=function(){this.timeScale*=2;this.timer.runOnce(0);this.isSingleStep=!1};c.prototype.pause=function(){this.timer.stop()};c.prototype["continue"]=function(){};c.prototype.restartLoop=function(){this.timer.stop();this.nAnim=this.loopBeginInx+1;this.setStartBoard();this.timer.runOnce(0)};c.prototype.onPlay=function(){};c.prototype.onSuccess=function(){this.postedSuccess||
(this.boardWin.destroySideIcon(),this.boardWin.addSideIcon({url:CB.getCommonPath()+"Media/Ribbons/Reader/Check48.png",cssClass:"cbBoardCheckMark",boardFract:10}),this.dataset=this.diagDiv.dataset,this.id=this.dataset.posid||"noid",window.playchessUser&&V15.resultPostBack.postPlayed(window.playchessUser,this.id),this.postedSuccess||CB.SendEvent("Play",this.id),this.postedSuccess=!0)};c.prototype.drawInvariants=function(){for(var b=!1,d=0;d<this.animations.length;d++){var e=this.animations[d];if(0==
e.time||9999==e.time){var f=2;9999==e.time&&(f=1);switch(e.command){case "title":this.setTitle(e.params[0]);break;case "legend":this.setLegend(e.params[0]);break;case "text":this.setText(e.params[0]);break;case "bubble":this.setBubble(e.subCommand,e.params,e.icon);break;case "mark":c.drawMarks(this.boardWin,e.params,!1,f);b=!0;break;case "bigmark":c.drawMarks(this.boardWin,e.params,!0,f);b=!0;break;case "line":c.drawLines(this.boardWin,e.params,f);b=!0;break;case "arrow":c.drawArrows(this.boardWin,
e.params,f);b=!0;break;case "file":c.drawFile(this.boardWin,e.params,f);b=!0;break;case "rank":c.drawRank(this.boardWin,e.params,f);b=!0;break;case "diagonal":c.drawDiagonal(this.boardWin,e.params,f),b=!0}}else break}b&&this.boardWin.renderQueuedAttributes(!0)};c.prototype.setLegend=function(b){$(this.diagDiv).find(".diagText").text(b)};c.prototype.setText=function(b){this.boardWin.addBubble(b,"",320)};c.prototype.setBubble=function(b,d,c){var e=-1;b&&(e=CB.Square.fromString(b));this.boardWin.addBubble(d,
e,320,c)};c.prototype.clearText=function(b){this.boardWin.destroyMessage()};c.prototype.setTitle=function(b){$(this.diagDiv).find(".diagTitle").text(b)};var b={red:"hsla( 0, 85%, 50%, 0.70 )",lightred:"hsla( 0, 100%, 70%, 0.70 )",green:"hsla( 90, 70%, 40%, 0.7 )",yellow:"hsla( 40, 90%, 60%, 0.75 )",blue:"hsla( 220, 60%, 50%, 0.65 )",orange:"hsla( 24, 90%, 50%, 0.65 )",gold:"hsla( 42, 97%, 53%, 0.65 )",brown:"hsla( 14, 32%, 38%, 0.65 )",white:"hsla( 0, 0%, 100%, 0.9 )",black:"hsla( 0, 0%, 0%, 0.9 )"},
d={red:"hsla( 0, 80%, 50%, 0.7 )",lightred:"hsla( 0, 100%, 70%, 0.70 )",green:"hsla( 90, 75%, 45%, 0.7 )",yellow:"hsla( 40, 100%, 70%, 0.6 )",blue:"hsla( 220, 62%, 50%, 0.7 )",orange:"hsla( 24, 90%, 50%, 0.5 )",gold:"hsla( 42, 97%, 53%, 0.5 )",brown:"hsla( 14, 32%, 38%, 0.5 )",white:"hsla( 0, 0%, 100%, 0.9 )",black:"hsla( 0, 0%, 0%, 0.9 )"};c.drawMarks=function(d,e,f,q){var r=[];e.forEach(function(e){if(e.match(/[a-h][1-8]-[a-h][1-8]/i)){var h=0,y=0;e.charAt(3)>e.charAt(0)?h=1:e.charAt(3)<e.charAt(0)&&
(h=-1);e.charAt(4)>e.charAt(1)?y=1:e.charAt(4)<e.charAt(1)&&(y=-1);for(var A=Math.max(Math.abs(e.charCodeAt(3)-e.charCodeAt(0)),Math.abs(e.charCodeAt(4)-e.charCodeAt(1))),w=CB.Square.colFromString(e.charAt(0)),z=CB.Square.rowFromString(e.charAt(1)),C=0;C<=A;C++)r.push(CB.Square.I(w+C*h,z+C*y))}else e.match(/[a-h][0-9]/i)?r.push(CB.Square.fromString(e)):(r.forEach(function(h){var w=c.translateSquareColor(e,h);w||(w=b.green);d.markSquare(h,w,f,q)}.bind(this)),r=[])}.bind(this))};c.translateSquareColor=
function(c,e){return CB.Square.isDark(e)?d[c]:b[c]};c.prototype.clearColors=function(){this.boardWin.clearBaggageAttributes();this.boardWin.clearPermanentAttributes();this.boardWin.board.sqs=[];this.boardWin.setBoard(this.currBoard)};c.prototype.clearBoard=function(){this.boardWin.clearBaggageAttributes();this.boardWin.board.sqs=[];for(var b=0;64>b;b++)this.currBoard[b]=0;this.boardWin.setBoard(this.currBoard)};var e={red:"hsla( 0, 60%, 50%, 0.7 )",lightred:"hsla( 0, 100%, 70%, 0.70 )",green:"hsla( 90, 70%, 50%, 0.70 )",
yellow:"hsla( 40, 90%, 65%, 0.80 )",blue:"hsla( 220, 70%, 50%, 0.7 )",orange:"hsla( 24, 90%, 50%, 0.7 )",gold:"hsla( 42, 97%, 53%, 0.7 )",brown:"hsla( 14, 32%, 38%, 0.7 )",white:"hsla( 0, 0%, 100%, 0.9 )",black:"hsla( 0, 0%, 0%, 0.9 )"};c.drawArrows=function(b,d,f){var q=[],r=[],t=0;d.forEach(function(d){if(d.match(/[a-h][1-8][a-h][1-8]/i))q.push(CB.Square.fromString(d.substr(0,2))),r.push(CB.Square.fromString(d.substr(2,2)));else if(d.charAt(0).match(/[0-9]/))t=parseInt(d);else{for(var h=0;h<q.length;h++){var A=
d.split("+"),w=c.translateArrowColor(A[0]);w||(w=e.green);b.drawArrow(q[h],r[h],w,t,f,A[1]?[6,10]:null)}q=r=[];t=0}}.bind(this));for(d=0;d<q.length;d++)b.drawArrow(q[d],r[d],e.green,15,f)};c.translateArrowColor=function(b){return e[b]};var f={red:"hsla( 0, 80%, 50%, 0.75 )",lightred:"hsla( 0, 100%, 70%, 0.70 )",green:"hsla( 90, 75%, 50%, 0.65 )",yellow:"hsla( 40, 100%, 60%, 0.75 )",blue:"hsla( 220, 60%, 50%, 0.65 )",orange:"hsla( 24, 90%, 50%, 0.65 )",gold:"hsla( 42, 97%, 53%, 0.65 )",brown:"hsla( 14, 32%, 38%, 0.65 )",
white:"hsla( 0, 0%, 100%, 0.9 )",black:"hsla( 0, 0%, 0%, 0.9 )"};c.translateLineColor=function(b){return e[b]};c.drawLines=function(b,d,c){var e=[],r=[],t=0;d.forEach(function(b){var d=b.match(/[a-h][1-8][t,b][l,r]/ig);if(d)for(b=0;b<d.length;b++){var c=CB.Square.fromString(d[b].substr(0,2));r.push(new CB.BoardLinePoint(c,d[b].substr(2,2)))}else if(b.charAt(0).match(/^[0-9]+$/))t=parseInt(b);else{d=b.split("+");(b=f[d[0]])||(b=f.green);c=[];switch(d[1]){default:case "dashed":d[1]&&(c=[6,12]);break;
case "dotted":c=[3,10]}d=new CB.BoardLine(r,t,b,c);e.push(d);r=[];t=0}}.bind(this));b.addAttributes(e,c)};c.drawFile=function(b,d,e){var f=[],r=d[0];d=d[1]||"white";if(r){var t=CB.Square.fromString(r.substr(0,2)),r=CB.Square.fromString(r.substr(2,2));f.push(new CB.BoardLine(c.getFilePoints(t,r),6,CB.DiagramAnimationController.translateLineColor(d)))}b.addAttributes(f,e)};c.drawRank=function(b,d,e){var f=[],r=d[0];d=d[1]||"white";if(r){var t=CB.Square.fromString(r.substr(0,2)),r=CB.Square.fromString(r.substr(2,
2));f.push(new CB.BoardLine(c.getRankPoints(t,r),6,CB.DiagramAnimationController.translateLineColor(d)))}b.addAttributes(f,e)};c.drawDiagonal=function(b,d,c){var e=[],f=d[0];d=d[1]||"white";if(f){var t=CB.Square.fromString(f.substr(0,2)),f=CB.Square.fromString(f.substr(2,2));e.push(new CB.BoardLine(CB.DiagramAnimationController.getDiagonalPoints(t,f),10,CB.DiagramAnimationController.translateLineColor(d),[7,12]))}b.addAttributes(e,c)};c.getFilePoints=function(b,d){return[new CB.BoardLinePoint(b,"bl"),
new CB.BoardLinePoint(d,"tl"),new CB.BoardLinePoint(d,"tr"),new CB.BoardLinePoint(b,"br"),new CB.BoardLinePoint(b,"bl")]};c.getRankPoints=function(b,d){return[new CB.BoardLinePoint(b,"bl"),new CB.BoardLinePoint(d,"br"),new CB.BoardLinePoint(d,"tr"),new CB.BoardLinePoint(b,"tl"),new CB.BoardLinePoint(b,"bl")]};c.getDiagonalPoints=function(b,d){var c=CB.Square.getFile(b),e=CB.Square.getRank(b),f=CB.Square.getFile(d),t=CB.Square.getRank(d);c<f?e<t?(c=["bl","lm","bm"],e=["tm","tr","rm"]):(c=["tl","tm",
"lm"],e=["rm","br","bm"]):e<t?(c=["br","bm","rm"],e=["lm","tl","tm"]):(c=["tr","rm","tm"],e=["bm","bl","lm"]);return[new CB.BoardLinePoint(b,c[0]),new CB.BoardLinePoint(b,c[1]),new CB.BoardLinePoint(d,e[0]),new CB.BoardLinePoint(d,e[1]),new CB.BoardLinePoint(d,e[2]),new CB.BoardLinePoint(b,c[2]),new CB.BoardLinePoint(b,c[0])]};c.prototype.animMove=function(b,d){var c,f,r,t=!0;d.forEach(function(b){if(b.match(/[a-h][1-8][a-h\-][1-8\-]/i)){var d=b.substr(0,2);b=b.substr(2,2);c=CB.Square.fromString(d);
"--"!=b?(f=CB.Square.fromString(b),this.currBoard[f]=this.currBoard[c]):t=!1;this.currBoard[c]=0}else if(b.match(/[wb][K,Q,N,B,R,P][a-h][1-8]/)){var d="b"==b.charAt(0)?CB.Piece.COLOUR:0,g=" KQNBRP".split("").indexOf(b.charAt(1));b=b.substr(2,2);f=CB.Square.fromString(b);this.currBoard[f]=g+d;t=!1}else r=e[b]}.bind(this));var v=b.animSteps;b.animSteps={forMove:6,forPosition:2};b.setBoard(this.currBoard,!0);b.animSteps=v;r&&t&&b.drawArrow(c,f,r,10,!1)};c.prototype.shouldShowAnimButtons=function(){this.animations.forEach(function(b){if("move "==
b.command)return!0})};c.prototype.timerHdl=function(){this.storeBoard[this.nAnim]=ObjUtil.clone(this.currBoard);var b=!1,d=this.animations[this.nAnim];switch(d.command){case "title":this.setTitle(d.params[0]);break;case "legend":this.setLegend(d.params[0]);break;case "text":this.setText(d.params[0]);break;case "bubble":this.setBubble(d.subCommand,d.params,d.icon);break;case "mark":c.drawMarks(this.boardWin,d.params,!1,!1);b=!0;break;case "bigmark":c.drawMarks(this.boardWin,d.params,!0,!1);b=!0;break;
case "line":c.drawLines(this.boardWin,d.params,!1,!1);b=!0;break;case "clearcolor":this.clearColors();break;case "clearboard":this.clearBoard();break;case "cleartext":this.clearText();break;case "clearall":this.clearColors();this.clearText();break;case "arrow":c.drawArrows(this.boardWin,d.params,!1);b=!0;break;case "file":c.drawFile(this.boardWin,d.params,!1);b=!0;break;case "rank":c.drawRank(this.boardWin,d.params,!1);b=!0;break;case "diagonal":c.drawDiagonal(this.boardWin,d.params,!1);b=!0;break;
case "move":this.animMove(this.boardWin,d.params);break;case "beginloop":this.loopBeginInx=this.nAnim;break;case "endloop":this.restartLoop();break;case "success":this.onSuccess()}b&&this.boardWin.renderQueuedAttributes(!0);if("endloop"==d.command||this.nAnim==this.animations.length-2)this.onSuccess();"endloop"!=d.command&&(this.nAnim++,this.nAnim>=this.animations.length?this.isSingleStep?this.anim--:this.nAnim=0:this.isSingleStep?this.skipInSingleStep(d.command)&&this.timer.runOnce(0):this.timer.runOnce(1E3*
d.time/this.timeScale))};c.prototype.skipInSingleStep=function(b){return 0<="wait beginloop endloop legend cleartext clearcolor clearall arrow bigmark".split(" ").indexOf(b)};c.prototype.isTextCommand=function(b){return 0<=["legend","text","title","bubble"].indexOf(b)};return c}();"use strict";
CB.ChessAudioInstance=function(){var c=function(){this.enabled=!0};c.prototype._game=null;c.prototype.setGame=function(b){this._game&&this._game.removeOnMoveListener(this.idOnMove);(this._game=b)&&!V15.config.isSilentBoard&&(this.idOnMove=this._game.addOnMoveListener(this._onMove.bind(this)))};c.prototype.getGame=function(){return this._game};c.prototype.enable=function(b){this.enabled=b};c.prototype.sideToPlay={};c.prototype.sideToPlay[CB.Side.WHITE]=!0;c.prototype.sideToPlay[CB.Side.BLACK]=!0;c.prototype.enableSide=
function(b,d){this.sideToPlay[b]=d};c.prototype._onMove=function(){var b=this._game.getCurPos(),d=this._game.getLastMove();if(d&&this.enabled&&V15&&V15.chessAudio)V15.chessAudio.onMove(d,b)};return c}();"use strict";
CB.ChessAudio=function(){var c=function(b,d){this.withTactics=d;this.folder=b;this.queue=new CB.AudioQueue;this.allAudios=[];this.loaded=!1;this.newGame=this.createAudio("Board/newgame");this.moveSounds=[];this.strongMoves=[];this.moveCaptures=[];this.strongCaptures=[];this.strongCaptures.push(this.createAudio("Board/CaptStrong"));this.castle=this.createAudio("Board/castle");this.winApplause=[];this.drawApplause=this.createAudio("Server/clapping");this.drawOfferEng=this.createAudio("Server/draw");
this.drawOfferDeu=this.createAudio("Server/remis");this.ping=this.createAudio("Server/ping2");this.ringbell=this.createAudio("Server/ringbellonce");this.challengebell=this.createAudio("Server/ChallengeBell");this.playFaster=this.createAudio("Server/Feedback/faster");this.punches=[];this.grunts=[];this.myError=[];this.oppError=[];this.cheer=[];this.punishCap=[];this.punishNoCap=[];this.bestCap=[];this.bestNoCap=[];this.only=[];this.wellDone=[];this.alarm=this.createAudio("Server/Aooga")};c.prototype.stopAll=
function(){this.queue.stopAll()};c.prototype.isEnabled=function(){return this.queue.isEnabled()};c.prototype.enable=function(b){return this.queue.enable(b)};c.prototype.loadAll=function(){new CB.Tick;this.individualApplause=this.createAudio("Server/IndividualApplause");for(var b=1;11>=b;b++)this.moveSounds.push(this.createAudio("Board/move"+b));for(b=1;15>=b;b++)this.moveCaptures.push(this.createAudio("Board/capture"+b));for(b=1;5>=b;b++)this.winApplause.push(this.createAudio("Server/winapplause"+
b));this.winApplause.push(this.createAudio("Server/cheer1"));this.winApplause.push(this.createAudio("Server/cheer2"));this.winApplause.push(this.createAudio("Server/cheer3"));this.winApplause.push(this.createAudio("Server/cheer5"));if(this.withTactics){for(b=1;16>=b;b++)this.punches.push(this.createAudio("Server/punch"+b));for(b=1;8>=b;b++)this.grunts.push(this.createAudio("Server/grunt"+b));for(b=1;9>=b;b++)this.myError.push(this.createAudio("Server/MyError"+b));for(b=1;5>=b;b++)this.cheer.push(this.createAudio("Server/Cheer"+
b))}if(V15.config.useAnalysisEngines||this.withTactics)for(b=1;5>=b;b++)this.oppError.push(this.createAudio("Server/OppError"+b));if(V15.config.useAnalysisEngines){for(var d=["Plop","CluckCluck","FistInHand","Snap"],c=["Marseillaise","Yes","SoftClapClap"],f=["Cluck","DoubleSnap","Drawlips"],g=["CuckooWhistle","Moan","Moan2"],h=["Exhale","sharpinhale","sssinhale"],l=["WellDone"],b=0;b<d.length;b++)this.punishCap.push(this.createAudio("Server/Feedback/"+d[b]));for(b=0;b<c.length;b++)this.punishNoCap.push(this.createAudio("Server/Feedback/"+
c[b]));for(b=0;b<f.length;b++)this.bestCap.push(this.createAudio("Server/Feedback/"+f[b]));for(b=0;b<g.length;b++)this.bestNoCap.push(this.createAudio("Server/Feedback/"+g[b]));for(b=0;b<h.length;b++)this.only.push(this.createAudio("Server/Feedback/"+h[b]));for(b=0;b<l.length;b++)this.wellDone.push(this.createAudio("Server/Feedback/"+l[b]));for(b=1;2>=b;b++)this.strongMoves.push(this.createAudio("Board/moveStrong"+b))}(new CB.Timer(function(){new CB.Tick;this.allAudios.forEach(function(b){b.load()});
this.allAudios=[];this.loaded=!0}.bind(this))).runOnce(1E3)};c.prototype.onMove=function(b,d){this.queue.stopAll();b.isTake()?b.isStrong?this.playStrongCapture():this.playCapture():b.isCastling()?this.playCastle():b.isStrong?this.playStrongMove():this.playMove()};c.prototype.playMove=function(){this.queue.push(this.moveSounds[Math.floor(Math.random()*this.moveSounds.length)])};c.prototype.playStrongMove=function(){this.queue.push(this.strongMoves[Math.floor(Math.random()*this.strongMoves.length)])};
c.prototype.playCapture=function(){this.queue.push(this.moveCaptures[Math.floor(15*Math.random())])};c.prototype.playStrongCapture=function(){this.queue.push(this.strongCaptures[Math.floor(Math.random()*this.strongCaptures.length)])};c.prototype.playCastle=function(){this.queue.push(this.castle)};c.prototype.onWin=function(){this.queue.push(this.winApplause[Math.floor(9*Math.random())])};c.prototype.onDraw=function(){this.queue.push(this.drawApplause)};c.prototype.onPing=function(){this.queue.push(this.ping)};
c.prototype.onIndividualApplause=function(){this.individualApplause&&this.queue.push(this.individualApplause)};c.prototype.onFightChallengeReceived=function(){this.queue.push(this.challengebell)};c.prototype.onFightStart=function(){this.queue.push(this.ringbell)};c.prototype.onFightMyCorrect=function(){this.queue.push(this.punches[Math.floor(14*Math.random())])};c.prototype.onFightOppCorrect=function(){this.queue.push(this.grunts[Math.floor(Math.random()*this.grunts.length)])};c.prototype.onFightMyWrong=
function(){this.queue.push(this.myError[Math.floor(Math.random()*this.myError.length)])};c.prototype.onFightOppWrong=function(){this.queue.push(this.oppError[Math.floor(Math.random()*this.oppError.length)])};c.prototype.onFightCheer=function(){this.queue.push(this.cheer[Math.floor(Math.random()*this.cheer.length)])};c.prototype.warnPlayFaster=function(){this.queue.push(this.playFaster)};c.prototype.onPunishedBlunderCapture=function(){this.queue.push(this.punishCap[Math.floor(Math.random()*this.punishCap.length)])};
c.prototype.onPunishedBlunderNoCapture=function(){this.queue.push(this.punishNoCap[Math.floor(Math.random()*this.punishNoCap.length)])};c.prototype.onBestMoveCapture=function(){this.queue.push(this.bestCap[Math.floor(Math.random()*this.bestCap.length)])};c.prototype.onBestMoveNoCapture=function(){this.queue.push(this.bestNoCap[Math.floor(Math.random()*this.bestNoCap.length)])};c.prototype.onOnlyMove=function(){this.queue.push(this.only[Math.floor(Math.random()*this.only.length)])};c.prototype.onWellDone=
function(){this.queue.push(this.wellDone[Math.floor(Math.random()*this.wellDone.length)])};c.prototype.opponentOffersDraw=function(){CB.Language.getUserLanguageId()==CB.Language.DEU?this.queue.push(this.drawOfferDeu):this.queue.push(this.drawOfferEng)};c.prototype.onNewGame=function(){this.queue.push(this.newGame)};c.prototype.onDisconnect=function(){this.queue.push(this.alarm)};c.prototype.onThreat=function(){this.queue.push(this.alarm)};c.prototype.onIncomingChallenge=function(){this.queue.push(this.challengebell)};
c.prototype.createAudio=function(b){b=new CB.Audio(this.folder+b,null,!0);this.allAudios.push(b);return b};return c}();"use strict";
CB.BoardBottomWin=function(){var c=function(b){this.config=b||{};this.config.hMinToShow=150;this.height=20};c.prototype.getDesiredHeight=function(b,d){return this.calcHeight(b,d)};c.prototype.calcHeight=function(b,d){var c=d.zoomToPix(this.config.hMax);return Math.min(c,b/this.config.hScale)};c.prototype.confirmHeight=function(b,d){this.height=d.pixToZoom(b)};c.prototype.canShowIfHeight=function(b,d){return b>d.pixToZoom(this.config.hMinToShow)};c.prototype.getSpacingToBoard=function(b,d){return d?
d.zoomToPix(this.config.spacing):0};c.prototype.getRect=function(b){var d=b.cbcanvas.canvas.getBoundingClientRect(),c=b.cbcanvas.pixToZoomRect(b.getOuterRect());c.h=this.height;var f=b.cbcanvas.pixToZoom(b.getOuterRect().h);c.move(d.left,d.top+f+b.cbcanvas.pixToZoom(this.config.spacing)-1);return c};return c}();
CB.BoardURL=function(){var c=1,b=function(d,e){b.superClass.call(this,e);this.uniqueId=c++;this.background=new CB.DivElement(document.body,"bBottomBG"+this.uniqueId);this.url=new CB.DivElement(this.background,"bBottomURL"+this.uniqueId);this.url.setURL(d.url,d.linkText,"BoardBottomURL",!0)};CB.inherit(b,CB.BoardBottomWin);b.prototype.onResize=function(b){var c=this.getRect(b),f=c.w;this.config.rightAlign&&(f-=b.nMarginW);this.background.setPos(c.left,c.top);this.background.setSize(f,c.h);this.url.setPos(0,
0);this.url.setSize(f,c.h);this.url.elDOM.className="BoardBottomURL";this.url.setFontSize(c.h);this.url.setFontSize(Math.max(3,c.h));this.config.rightAlign?this.url.setRightAlign():this.url.setCenteredText();V15.config.versionChessBaseCom&&(this.url.linkNode.style.color="Black")};b.prototype.destroy=function(){this.background.destroy()};b.prototype.setVisible=function(b){this.background.setVisible(b)};return b}();
CB.BoardDoubleURL=function(){var c=1,b=function(d,e){b.superClass.call(this,e);this.uniqueId=c++;this.background=new CB.DivElement(document.body,"bBottomURLBG"+this.uniqueId);this.urlLeft=new CB.DivElement(this.background,"bBottomURLLeft"+this.uniqueId);this.urlLeft.setURL(d.urlLeft,d.linkTextLeft,"BoardBottomURL",!0);this.urlRight=new CB.DivElement(this.background,"bBottomURLRight"+this.uniqueId);this.urlRight.setURL(d.urlRight,d.linkTextRight,"BoardBottomURL",!0)};CB.inherit(b,CB.BoardBottomWin);
b.prototype.onResize=function(b){var c=this.getRect(b);b=b.cbcanvas.pixToZoom(b.nMarginW);var f=c.w,f=f-2*b;this.background.setPos(c.left,c.top);this.background.setSize(f,c.h);f/=2;this.urlLeft.setPos(b,0);this.urlLeft.setSize(f,c.h);this.urlLeft.elDOM.className="BoardBottomURL";this.urlLeft.setFontSize(Math.max(4,c.h));this.urlLeft.setLeftAlign();this.urlRight.setPos(f+b,0);this.urlRight.setSize(f,c.h);this.urlRight.elDOM.className="BoardBottomURL";this.urlRight.setFontSize(Math.max(4,c.h));this.urlRight.setRightAlign();
if(V15.config.versionChessBaseCom||V15.config.transparent)this.urlLeft.linkNode.style.color="Black",this.urlRight.linkNode.style.color="Black"};b.prototype.destroy=function(){this.background.destroy()};b.prototype.setVisible=function(b){this.background.setVisible(b)};return b}();"use strict";
CB.BoardSideIcon=function(){var c=0,b=function(b,e){this.config=e;this.myId=++c;$(b.cbcanvas.canvas);this.img=$(String.f("<img src='{0}' class='{1}' id='cbBoardIcon{2}'/>",e.url,e.cssClass,this.myId));$(document.body).append(this.img);$(this.img).css("position","absolute");this.width=this.height=32};b.prototype.destroy=function(){$("#cbBoardIcon"+this.myId).remove()};b.prototype.setVisible=function(b){b?$(this.img).show():$(this.img).hide()};b.prototype.getDesiredWidth=function(b,c,f){return this.width=
this.height=this.calcWidth(b,f)};b.prototype.calcWidth=function(b,c){var f=c.zoomToPix(48);return Math.min(f,b/this.config.boardFract)};b.prototype.onResize=function(b){var c=$(b.cbcanvas.canvas).offset().top,f=$(b.cbcanvas.canvas).offset().left,g=b.cbcanvas.pixToZoomRect(b.getOuterRect());g.move(f,c);$(this.img).css("transition","0");$(this.img).css({left:g.left,top:g.top+g.h/2,width:this.width,height:this.width});$(this.img).css("transition","left 0.8s, top 0.8s, width 0.5s, height 0.5s");(new CB.Timer(function(){$(this.img).css({left:g.left+
g.w-this.width/4,top:g.top+this.height/10})}.bind(this))).runOnce(0)};return b}();"use strict";
CB.BoardTitle=function(){var c=new CB.Color(0,0,0,.3),b=new CB.Color(210,255,170,.75),d=new CB.Color(255,255,220,.9),e=1,f=function(b,f,l,q,r,t){this.board=b;this.uniqueId=e++;this.background=new CB.DivElement(b.cbcanvas.canvas.parentNode,"bTitleBG"+this.uniqueId);r||(this.clock=new CB.ClockElement(this.background));this.textEl=new CB.DivElement(this.background,"bTitleText"+this.uniqueId);CB.ToolButtons&&!V15.isBoardOnlyApp()&&(this.btnEl=new CB.CloseButton(this.background,"bCloseBtn"+this.uniqueId,
this.onCloseClicked.bind(this)));b.titleWin=this;this.onBoardCloseClick=f;this.textEl.setText(q||"Waiting for game...");$(this.textEl.elDOM).on("click",l);$(this.textEl.elDOM).on("dblclick",t);this.clock&&($(this.clock.background.elDOM).on("click",l),$(this.clock.background.elDOM).on("dblclick",t));this.textEl.setBackgroundColor(c);this.textEl.setColor(d);this.textEl.setFontFamily(V15.config.defaultCondensedFont);$(this.textEl).css("cursor","pointer");this.h=Math.round(b.cbcanvas.pixToZoom(this.calcHeight(b.height)))};
f.prototype.destroy=function(){this.background.destroy()};f.prototype.displaysHeader=!0;f.prototype.setText=function(b){this.textEl.setText(b);if(this.textW){b=this.getInitialFontH();do{this.textEl.setFontSize(b);--b;var d=this.textEl.getTextWidth();this.textEl.getTextHeight();CB.LOG("TitleW:"+d)}while(4<b&&(this.textEl.getTextWidth()>this.textW-4||this.textEl.getTextHeight()>this.h-2))}};f.prototype.setVisible=function(b){this.background.setVisible(b)};f.prototype._selected=!1;f.prototype.markAsSelected=
function(e){this._selected!=e&&((this._selected=e)?(this.textEl.setBackgroundColor(b),this.textEl.setColor("black")):(this.textEl.setBackgroundColor(c),this.textEl.setColor(d)))};f.prototype.getClock=function(){return this.clock};f.prototype.getInitialFontH=function(){if(this.board){var b=Math.round(this.board.cbcanvas.pixToZoom(this.calcHeight(this.board.height))),b=Math.round(.65*b);8>b&&(b=8);return b}return 16};f.prototype.getDesiredHeight=function(b,d){return this.calcHeight(b)};f.prototype.calcHeight=
function(b){var d=this.board?this.board.cbcanvas.zoomToPix(36):36;return Math.min(d,b/16)};f.prototype.onResize=function(b){this.board=b;b.cbcanvas.canvas.getBoundingClientRect();var d=b.cbcanvas.pixToZoomRect(b.getOuterRect()),c=Math.round(b.cbcanvas.pixToZoom(this.calcHeight(b.height))),e=c+1,f=this.getInitialFontH();this.h=c;d.move(-1,-this.h);d.h=this.h;this.btnW=this.btnEl?e:0;CB.System.isMobile()&&this.btnEl&&this.btnW<CB.System.pixToZoom(26)&&(this.btnW=CB.System.pixToZoom(26));this.clockW=
this.clock?Math.min(260,.4*d.w):0;d.w--;this.textW=d.w-this.clockW-this.btnW;this.background.setPos(d.left,d.top);this.background.setSize(d.w,d.h);c=Math.max(1,Math.min(4,Math.round(Math.sqrt(d.w/100))));this.background.setBoxShadow(c,8*c,"rgba( 60, 30, 20, 0.5 )");this.clock&&this.clock.setPosSize(0,0,this.clockW,this.h);this.textEl.setPos(this.clockW,0);this.textEl.setSize(this.textW,this.h);this.textEl.setBorder(b.cbcanvas.pixToZoom(1),new CB.Color(0,0,0,1));this.markAsSelected(this._selected);
this.textEl.setCenteredText();do this.textEl.setFontSize(f),--f,this.textEl.getTextWidth(),this.textEl.getTextHeight();while(4<f&&(this.textEl.getTextWidth()>this.textW||this.textEl.getTextHeight()>this.h-2));this.textEl.setVerticalAlign(!0);this.btnEl&&(this.btnEl.setPos(d.w-this.btnW,this.h-this.btnW),this.btnEl.setSize(this.btnW,this.btnW))};f.prototype.onCloseClicked=function(b){if(void 0!==this.onBoardCloseClick)this.onBoardCloseClick(b)};return f}();"use strict";
CB.MultiBoard=function(){var c=function(b,d,c,f){this.cbcanvas=b;this.boardArea=new CB.BoardArea(b,d,c,f);this.width=d;this.height=c;this.idStyleListener=glSettings.addOnBoardStyleListener(this.onBoardStyle.bind(this));this.keyDownHandlerId=V15.commands.registerkeyDownHandler(this)};c.prototype.destroy=function(){glSettings.removeOnBoardStyleListener(this.idStyleListener);V15.commands.unregisterkeyDownHandler(this.keyDownHandlerId)};c.prototype.onKeyDown=function(b){var d=!0;switch(b.getKey()){default:d=
!1;break;case b.TAB:this.selectNextBoard()}return d};c.prototype.onBoardStyle=function(b,d){V15.setBoardTextures(CB.BoardTextures.prototype.getTexturesForPieceStyle(b));for(var c=0;c<this.boardArea.boards.length;c++)this.boardArea.boards[c].onBoardStyle(b,d);this.boardArea.calcGeometry()};c.prototype.addBoard=function(b,d,c){0==this.boardArea.boards.length&&this.boardArea.clearBackground();c||b.addTitle(function(){return this.onBoardCloseClick(b,d)}.bind(this),!1,function(b){return this.onDoubleClick(b)}.bind(this));
V15.isBoardOnlyApp()&&V15.useBottomURL&&V15.GetBottomURLData&&100<window.innerHeight&&(b.bottomWin=new CB.BoardDoubleURL(V15.GetBottomURLData(),{hScale:25,hMax:16,spacing:3,rightAlign:!0}));b.fnBoardClick=this.onBoardClick.bind(this);c=!1;if(null!=d){b.idGame=d;for(var f=0;!c&&f<this.boardArea.boards.length;f++)c=this.boardArea.boards[f].idGame==d}c||this.boardArea.addBoard(b)};c.prototype.removeBoard=function(b){b&&(this.cbcanvas.block(!0),this.boardArea.removeBoard(b),this.boardArea.calcGeometry(),
this.markSelectedBoard())};c.prototype.onDestroyDOM=function(){this.removeAllBoards()};c.prototype.removeAllBoards=function(){this.boardArea.removeAllBoards();this.cbcanvas.requestRedraw();this.drawBackground(this.cbcanvas.bufferCtx)};c.prototype.setNotation=function(b){this.notation=b};c.prototype.beforeResize=function(){this.boardArea.beforeResize()};c.prototype.resize=function(b,d){this.width=b;this.height=d;this.boardArea.resize(b,d);this.markSelectedBoard()};c.prototype.markSelectedBoard=function(){if(this.idSelected){var b=
this.getBoardById(this.idSelected);b&&b.markAsSelected(!0)}};c.prototype.draw=function(b){this.boardArea.draw(b)};c.prototype.drawForeground=function(b){this.boardArea.drawForeground(b)};c.prototype.drawBackground=function(b){this.boardArea.drawBackground(b)};c.prototype.clearBackground=function(){};c.prototype.refreshBoards=function(){this.boardArea.calcGeometry();this.markSelectedBoard()};c.prototype.calcGeometry=function(){this.boardArea.calcGeometry()};c.prototype.onMouseDown=function(b,d){if(!V15.lobby.boardAreaClickHandler||
0!=b.button&&"undefined"!=typeof b.button)this.boardArea.onMouseDown(b,d);else V15.lobby.boardAreaClickHandler(b)};c.prototype.onMouseUp=function(b,d){this.boardArea.onMouseUp(b,d)};c.prototype.onMouseMove=function(b,d){this.boardArea.onMouseMove(b,d)};c.prototype.onMouseWheel=function(b,d){};c.prototype.onMouseEnter=function(b,d){this.boardArea.onMouseEnter(b,d)};c.prototype.onMouseLeave=function(b,d){this.boardArea.onMouseLeave(b,d)};c.prototype.onDoubleClick=function(b){if(this.onDblClick){var d=
this.getBoardById(this.idSelected);this.onDblClick(d.idGame,b)}V15.lobby.boardAreaDClickHandler&&0==b.button&&V15.lobby.boardAreaDClickHandler(b)};c.prototype.toggleAnnoField=function(){};c.prototype.openAnnoField=function(){};c.prototype.isAnnoFieldOpen=function(){};c.prototype.closeAnnoField=function(){};c.prototype.setAnnoFieldText=function(b){};c.prototype.outEngineMsg=function(b,d){};c.prototype.onBoardCloseClick=function(b,d){this.removeBoard(b);if(void 0!==this.onCloseBoard)this.onCloseBoard(d)};
c.prototype.onBoardClick=function(b,d,c){if(b!=this.clickedBoardId){c=this.getBoardById(b);this.mark(c);if(void 0!==this.onClickBoard)this.onClickBoard(c.idGame,d);this.clickedBoardId=b}};c.prototype.markBoard=function(b){b<this.boardArea.boards.length&&this.mark(this.boardArea.boards[b])};c.prototype.mark=function(b){var d=this.getBoardById(this.idSelected);d&&d!==b&&d.markAsSelected(!1);b?(b.markAsSelected(!0),this.idSelected=b.uniqueId):this.idSelected=-1};c.prototype.markBoardByGameId=function(b){b=
this.getBoardByGameId(b);this.mark(b)};c.prototype.selectNextBoard=function(){var b=this.idSelected,d=this.boardArea.boards.findIndex(function(d){return d.uniqueId==b});0<=d&&(d+=1,d>=this.boardArea.boards.length&&(d=0));this.markBoard(d);if(this.onClickBoard&&this.boardArea.boards[d])this.onClickBoard(this.boardArea.boards[d].idGame)};c.prototype.getBoardByGameId=function(b){return this.boardArea.boards.find(function(d){return d.idGame==b})};c.prototype.getBoardById=function(b){if(b)return this.boardArea.boards.find(function(d){return d.uniqueId==
b})};return c}();"use strict";
CB.ChatElement=function(){var c=function(b,d){this.nInPage=b;this.fnOnEnter=d;this.myTabInx=1};c.prototype.initElem=function(b,d){this.options=d;var c;this.elementId=c="string"==typeof b?b:$(b).attr("id");c=$("#"+c);c.addClass("cbChatContainer");c[0].style.position="relative";this.elem=c[0];var f=document.createElement("div");f.id=this.elementId+"-out";var g=document.createElement("input");g.id=this.elementId+"-in";g.placeholder="Please log in with your ChessBase Account to type chat here.";this.createTitle();
c.append(f);c.append(g);f=$(f);g=$(g);f[0].style.width="calc( 100% - 2px )";f[0].style.height="100%";f.addClass("cbChatOut");g.addClass("cbChatInp");f[0].style.width="calc( 100% - 8px) ";if(this.options.toolbar){var h=$(String.f('<div class="{0}" id="{1}-tb"></div>',"cbChatToolBar",this.elementId));c.append(h);this._initToolBar(h)}g.keypress(this.inputKeypress.bind(this));g.focus(this.onFocus.bind(this));g.blur(this.onBlur.bind(this));if(this.elem&&(f.on("mousewheel",this.onMouseWheel.bind(this)).on("DOMMouseScroll",
this.onMouseWheel.bind(this)),CB.Element.isEventSupported("touchstart")&&(f.on("touchstart",this.onButtonDown.bind(this)).on("touchend",this.onButtonUp.bind(this)).on("touchleave touchcancel",this.onMouseLeave.bind(this)),this.supportsTouch=!0),CB.Element.isEventSupported("mousedown")))f.on("mousedown",this.onButtonDown.bind(this)).on("mouseup",this.onButtonUp.bind(this)).on("mouseleave",this.onMouseLeave.bind(this)).on("dblclick",this.onDoubleClick.bind(this));c.resize(this.resize.bind(this));var l;
this.options&&this.options.noInvite||(l=this.isOnLiveChess()?this.getInviteLoginText():"Click <a href=https://live.chessbase.com/Logon?returnurl="+encodeURIComponent(document.location)+' target="_blank">here to login</a> with your free ChessBase Account and type chat below.');this._addLine(l,"cbChatLine cbChatSeparator")};c.prototype.setNChannelReceivers=function(b){this.nChannelReceivers=this.nReceivers=b;this.setInputPlaceHolder()};c.prototype.setNClubRoomPlayers=function(b){this.nClubRoomPlayers=
this.nReceivers=b;this.setInputPlaceHolder()};c.prototype.setNKibitzChatReceivers=function(b){this.nKibitzReceivers=this.nReceivers=b;this.setInputPlaceHolder()};c.prototype.createTitle=function(){var b=$(String.f('<div id="{0}-title" class="cbChatTitle">Chat And Info</div>',this.elementId));$(this.elem).append(b)};c.prototype.setTitle=function(b){$("#"+this.elementId+"-title").text(b)};c.prototype.setFnSendChat=function(b){this.fnOnEnter=b};c.prototype.getInviteLoginText=function(){return'<a href="https://live.chessbase.com/logon?returnurl='+
encodeURIComponent(document.location)+'">Log in</a> with your free ChessBase Account and type chat below.'};c.prototype.isOnLiveChess=function(){return-1!=document.URL.search(/live.chessbase.com/i)||-1!=document.URL.search(/live.playchess.com/i)};c.prototype.$Out=function(){return $("#"+this.elementId+"-out")};c.prototype.$In=function(){return $("#"+this.elementId+"-in")};c.prototype.toGeneralChat=function(){this.setTitle(String.f("{0} ({1})",lm.CHAT,lm.TO_ALL));this.options.toolbar&&$("#radBtnall"+
this.nInPage).length&&($("#radBtnall"+this.nInPage).jqxRadioButton("check"),$("#radBtnopp"+this.nInPage).jqxRadioButton("uncheck"),$("#radBtnSpanopp"+this.nInPage).text(lm.TO_OPPONENT),$("#radBtnSpanopp"+this.nInPage).jqxRadioButton("disable"))};c.prototype.toKibitzerChat=function(){this.setTitle(lm.TO_KIBITZERS);this.options.toolbar&&$("#radBtnall"+this.nInPage).length&&(this.toKibitzers=!0,this.toOpponent=this.toPlayer=!1,$("#radBtnopp"+this.nInPage).jqxRadioButton("check"),$("#radBtnSpanopp"+this.nInPage).text(lm.TO_KIBITZERS),
$("#radBtnall"+this.nInPage).jqxRadioButton("uncheck"))};c.prototype.toOpponentChat=function(b){this.toPlayer=this.toKibitzers=!1;this.toOpponent=!0;this.signalIndividualChat(b);this.fnOnEnter=this.options.sendOpponent};c.prototype.signalIndividualChat=function(b){this.setTitle("Chat with "+b);this.options.toolbar&&$("#radBtnall"+this.nInPage).length&&($("#radBtnopp"+this.nInPage).jqxRadioButton("check"),$("#radBtnSpanopp"+this.nInPage).text("-> "+b),$("#radBtnall"+this.nInPage).jqxRadioButton("uncheck"),
this.receiverName=b)};c.prototype.setReceiverId=function(b,d){var c=d||V15.lobby.lists.clientNameMap[b];c&&(this.toKibitzers=!1,this.toPlayer=!0,this.toOpponent=!1,this.signalIndividualChat(c),this.fnOnEnter=this.options.sendPlayer,this.idReceiver=b)};c.prototype.sendTokenChat=function(b,d){this.toPlayer&&this.idReceiver?(this.outMyGameChat(d),V15.lobby.sendChat(d,this.idReceiver,b)):this.toOpponent&&(this.outMyGameChat(d),V15.lobby.playingSession.sendTokenChat(b,d))};c.prototype._fnReceiverClick=
function(b,d){this.fnOnEnter=null;if(d)switch(b){case "opp":case "one":this.toKibitzers?(this.nReceivers=this.nKibitzReceivers,this.fnOnEnter=this.options.sendKibitzers):(this.nReceivers=1,this.toPlayer?this.fnOnEnter=this.options.sendPlayer:this.receiverName&&(this.fnOnEnter=this.options.sendOpponent));this.fnOnEnter?this.setInputPlaceHolder():this.setInputPlaceHolderMsg(lm.PLEASE_SELECT_RECEIVER);break;case "all":V15.lobby.isInClubRoom()?this.nReceivers=this.nClubRoomPlayers:this.nReceivers=this.nChannelReceivers,
this.setInputPlaceHolder(),this.fnOnEnter=this.options.sendGeneral}return null!=this.fnOnEnter};c.prototype.resize=function(){var b=0;this.options.toolbar&&(b=32);var d=$("#"+this.elementId),c=$("#"+this.elementId+"-title"),f=$("#"+this.elementId+"-in"),g=$("#"+this.elementId+"-out"),h=g.width();f[0].style.width=h-8+"px";f.height(20);d=d.height();f=f.outerHeight(!0);c=c.outerHeight(!0);c=d-c-f-b;0>c&&(c=10);g[0].style.height=c+"px";g[0].style.width="100%";g=$("#"+this.elementId+"-tb");g.length&&(g[0].style.height=
b+"px")};c.prototype.hasFocus=function(){return $("#"+this.elementId+"-in").is(":focus")};c.prototype.onFocus=function(b){this._hasFocus=!0};c.prototype.onBlur=function(b){this._hasFocus=!1};c.prototype.inputKeypress=function(b){13==b.keyCode&&(b=this.$In().val())&&(this.fnOnEnter&&this.fnOnEnter(this.nInPage,b),this.$In().val(""))};c.prototype.onButtonDown=function(b){this.buttonDown=!0};c.prototype.onButtonUp=function(b){this.buttonDown=!1};c.prototype.onDoubleClick=function(b){};c.prototype.onMouseWheel=
function(b){};c.prototype.onMouseLeave=function(b){this.buttonDown=!1};c.prototype.out=function(b,d,c){"string"===typeof b?this.add(b,d,c):b.isToChannel()||b.isToGroup()?this.addChannelMsg(b):b.isOpponentChat?this.addIndividualMsg(b):b.isToSession()?this.addGameMsg(b):b.isPrivate()||b.isToIndividuals()?this.addIndividualMsg(b):this.add(b.toString(),d)};c.prototype.outHtml=function(b){this._addLine(b);this._scrollToEnd()};c.prototype.outMyChannelChat=function(b){b=String.formatEx('<span class="cbChannelSender">-> To All:</span><span class="cbChannelChat cbMyChat">{0}</span>',
b);this._addLine(b);this._scrollToEnd()};c.prototype.outMyGameChat=function(b){b=String.formatEx('<span class="cbGameChatSender">-> {1}</span><span class="cbGameChat cbMyChat">{0}</span>',b,this.receiverName);this._addLine(b);this._scrollToEnd()};c.prototype.addChannelMsg=function(b){b=String.formatEx('<span class="cbChannelSender">{0} (To All): </span><span class="cbChannelChat">{1}</span>',b.strSender,b.strMsg);this._addLine(b);this._scrollToEnd()};c.prototype.addGameMsg=function(b){b=String.formatEx('<span class="cbGameChatSender">{0}:</span><span class="cbGameChat">{1}</span>',
b.strSender,b.strMsg);this._addLine(b);this._scrollToEnd()};c.lineId=0;c.prototype.addIndividualMsg=function(b){var d="chatLine"+(++c.lineId).toString(),e=String.formatEx('<span id="{2}"><span class="cbGameChatSender">{0}:</span><span class="cbGameChat">{1}</span></span>',b.strSender,b.strMsg,d);this._addLine(e);this._scrollToEnd();$("#"+d).click(function(){V15.lobby.lists.registerClientName(b.idSender,b.strSender);this.setReceiverId(b.idSender)}.bind(this));V15.panelMgr.signalIncomingChat(b.strSender)};
c.prototype._scrollToEnd=function(){var b=$("#"+this.elementId+"-out"),d=b.offset().top,c=b.scrollTop(),f=b.find("div").last().offset().top;b.scrollTop(f-d+c)};c.prototype.add=function(b,d,c){if(b){var f=$("#"+this.elementId+"-out"),g=!1;c&&(c=f.find("div").last(),c.length&&(c.text(c.text()+b),g=!0));g||(g=document.createElement("div"),$(g).text(b),$(g).addClass("cbChatLine"),$(g).addClass(d),f.append(g));this._scrollToEnd()}};c.prototype.addKibitzChat=function(b,d,c,f,g,h){if(b||g)this.addOriginLine(b,
d,f,g),b=$($.parseHTML(c)).text(),f=this._addLine(b,"cbChatLine"),$(f).addClass("cbChatSeparator"),b=$("#"+this.elementId+"-out"),d=b.offset().top,c=b.scrollTop(),h&&(h=$(f).offset().top,b.scrollTop(h-d+c))};c.prototype.addOriginLine=function(b,d,c,f){var g="";d&&d.white?(g=d.white.getListStr(1),(d=d.black.getListStr(1))&&(g+="-"+d)):"String "==typeof d&&(g=d);d="";var h="cbSessionName";c&&c.idGame&&(d=String.formatEx('onClick = "V15.panelMgr.addGameById( {0}, {1}, {2} );"',this.nInPage,c.idGame,
c.mvInx),h="cbChatGameLink");c="cbSender";b==this.user&&(c+=" cbChatUserName cbBigUserName");b=f?String.formatEx('<span class="cbSessionName {2}"{1}>{0}:</span>',g,d,h):String.formatEx('<span class="{4}">{0}:</span><span class="cbSessionName {3}"{2}>({1})</span>',b,g,d,h,c);g="cbChatOrigin";f&&(g+=" cbAutoChat");this._addLine(b,g)};c.prototype.clear=function(){$("#"+this.elementId+"-out").html("")};c.prototype.outLoginOk=function(b){this.out("");this.user=b;b=String.formatEx("{0}<span class='cbChatUserName'>{1}</span>",
"Hello, ",b);this._addLine(b,"cbChatLoginOk cbChatSeparator");this.setInputPlaceHolder()};c.prototype.setInputPlaceHolder=function(){var b=lm.TYPE_CHAT_HERE;this.nReceivers&&(b+=" ("+this.nReceivers+" "+lm.RECEIVERS+")");this.setInputPlaceHolderMsg(b)};c.prototype.setInputPlaceHolderMsg=function(b){var d=$("#"+this.elementId+"-in");d&&d.attr("placeholder",b)};c.prototype.inviteLogin=function(){var b=this.getInviteLoginText();this._addLine(b,"cbChatLine")};c.prototype._addLine=function(b,d){var c=
$("#"+this.elementId+"-out"),f=document.createElement("div");d&&$(f).addClass(d);$(f).html(b);c.append(f);return f};c.prototype._initToolBar=function(b){var d=this;$(b).jqxToolBar({width:"100%",tools:"custom | custom | button",theme:V15.config.jqxTheme,initTools:function(b,c,g){switch(c){case 0:return d._createRadioButton(g,lm.TO_OPPONENT,"opp",160,22,!1);case 1:return d._createRadioButton(g,lm.TO_ALL,"all",160,22,!0);case 2:g.jqxButton({width:130,height:22}),g.text("Shortcuts"),g.click(function(b){d._fnReceiverClick("opp",
!0)&&V15.panelMgr.openChatMenu(b,g,50)})}}})};c.prototype._createRadioButton=function(b,d,c,f,g,h){d=$(String.f("<div id={1}><span id={2}>{0}</span></div>",d,"radBtn"+c+this.nInPage,"radBtnSpan"+c+this.nInPage));b.append(d);d.jqxRadioButton({width:f,height:g,checked:h});var l=this;d.on("change",function(b){l._fnReceiverClick(c,b.args.checked)})};c.prototype.onTabSelect=function(b){b.args.item==this.myTabInx&&this._scrollToEnd()};return c}();
CB.ChatElement.factory=function(c,b,d,e){b=new CB.ChatElement(b||0,d);b.initElem(c,e);return b};"use strict";
CB.LiveBookElement=function(){var c=function(b,d,c){this.nInPage=b;this.hasListeners=!1;this.fnGetKernel=d;this.ticket=c;this.stampToday=CB.TBrainMove.getTimeStampToday();this.entries=[];this.config={minVisits:5};this.curMove=0;this.initListeners()};c.prototype.initElem=function(b,d){var c;this.elementId=c="string"==typeof b?b:b.id;c=$("#"+c);c.addClass("cbBookContainer");this.elem=c[0];this.createGrid()};c.prototype.resize=function(){$(this.elem).jsGrid("option","fields",this.getGridFields($(this.elem).width()));
$(this.elem).jsGrid("option","height","100%");$(this.elem).jsGrid("option","width","100%");this.hasListeners||this.initListeners();$(this.elem).jsGrid("refresh")};c.prototype.createGrid=function(){$(this.elem).jsGrid({width:"400px",height:"100%",heading:!0,filtering:!1,editing:!1,inserting:!1,updateOnResize:!0,sorting:!0,autoload:!0,noDataContent:"Replay and check the LiveBook here",rowClick:function(b){},controller:{loadData:function(b){b=[];for(var d=0;d<this.entries.length;d++){var c={Move:this.entries[d].line,
N:this.entries[d].getStrNGames(),Visits:this.entries[d].getStrNVisits(),Players:this.entries[d].getPlayers(),Result:this.entries[d].getStrResult(),Elo:this.entries[d].getStrElo()};b.push(c)}return b}.bind(this)},fields:this.getGridFields()});this.gridCreated=!0};c.prototype.getNGamesItemTemplate=function(d,c){if(this.curMove<b||this.isStandard)return"-"==d?String.formatEx('<span class="jsg-liveVisits">({0})</span>',c.Visits):d;var g="https://live.chessbase.com/logon?returnurl="+encodeURIComponent(document.location);
return String.formatEx('<a class="jsg-premiumRequired" href="{0}">Login</a>',g)};c.prototype.getPlayersItemTemplate=function(b,c){if(0==this.curMove&&!this.isPremium)return"---";if(this.curMove<d||this.isPremium)return b;if(this.isStandard)return String.formatEx('<a class="jsg-premiumRequired" href="{0}">Premium Required</a>',"https://account.chessbase.com/en/matrix");var g="https://live.chessbase.com/logon?returnurl="+encodeURIComponent(document.location);return String.formatEx('<a class="jsg-premiumRequired" href="{0}">Premium Required</a>',
g)};c.prototype.getGridFields=function(b){if(380>(b||400))return[{name:"Move",type:"text",width:30,css:"jsg-liveMove"},{name:"N",type:"number",width:25,css:"jsg-liveNGames",itemTemplate:this.getNGamesItemTemplate.bind(this)},{name:"Result",type:"number",width:25,css:"jsg-liveResult"},{name:"Elo",type:"number",width:20,css:"jsg-liveElo"}];b=[{name:"Move",type:"text",width:18,css:"jsg-liveMove"},{name:"N",type:"number",width:16,css:"jsg-liveNGames",itemTemplate:this.getNGamesItemTemplate.bind(this)},
{name:"Result",type:"number",width:10,css:"jsg-liveResult"},{name:"Elo",type:"number",width:8,css:"jsg-liveElo"}];return b=b.concat([{name:"Players",type:"text",width:50,css:"jsg-livePlayers",itemTemplate:this.getPlayersItemTemplate.bind(this)}])};c.prototype.isVisible=function(){return $(this.elem).is(":visible")};var b=12,d=7;c.prototype.liveBookListener=function(b){if(!this.ticket||this.ticket==b.ticket)if(this.entries=[],$(this.elem).jsGrid("option","noDataContent","Position not in LiveBook"),
!this.isVisible())this.lbInfo=b;else if(this.fnGetKernel()&&this.fnGetKernel().getCurPos){if(b.moves.length){var d=b.moves,c=this.fnGetKernel().getCurPos(),h=c.getSideToMove();6>=c.getPieces().length&&(b.sorted||CB.TBrainMoveList.sortEval(d,h==CB.Side.BLACK));if(!this.fnGetKernel())return;this.curMove=this.fnGetKernel().getCurPos().getPlyNum();for(d=c=0;d<b.moves.length;d++)c+=b.moves[d].getNVisits();this.stampToday=CB.TBrainMove.getTimeStampToday();c=6>=this.fnGetKernel().getCurPos().getPieces().length;
this.entries=[];for(d=0;d<b.moves.length;d++)if(h=b.moves[d],c||this.passesMoveFilter(h)){var l=h.getMoveRecord(),h={line:this.generateLine(b.position,l),nGames:h.m_performanceStats.getNGames(),Result:Math.round(h.m_performanceStats.getFPercent(b.position.isBTM()))+"%",elo:Math.round(h.m_performanceStats.getSortEloAv()),from:l.from,to:l.to,players:[],eval:h.getNEval(),nVisits:h.getNVisits(),getStrElo:function(){return this.elo?this.elo:""},getStrNGames:function(){return this.nGames?this.nGames.toLocaleString(CB.Language.getStrUserLanguage(),
{maximumFractionDigits:0}):"-"},getStrNVisits:function(){return this.nVisits?this.nVisits.toLocaleString(CB.Language.getStrUserLanguage(),{maximumFractionDigits:0}):""},getPlayers:function(){for(var b=[],d=0;d<this.players.length&&4>d;d++){var c=this.players[d].name;1600<window.innerWidth&&0==b.length&&this.players[d].year&&(c+=" ("+this.players[d].year+")");b.push(c)}return b.join(", ")},getStrResult:function(){if(this.nGames)return this.Result;var b=this.eval;if(29750<Math.abs(b)){var d="#"+(3E4-
Math.abs(b));0>b&&(d="-"+d);return d}d="";0<b&&(d="+");return d+(.01*b).toFixed(2)}};this.entries.push(h)}this.entries=this.entries.sort(function(b,d){return d.nGames==b.nGames?d.nVisits-b.nVisits:d.nGames-b.nGames});this.searchOnlineDB()}$(this.elem).jsGrid("loadData")}};c.prototype.passesMoveFilter=function(b){var d=this.config.minVisits||2;return(0<b.getNGames()||300>this.stampToday-b.m_nTimeStamp||b.isMyMove)&&(b.getNVisits()>=d||b.hasEval())};c.prototype.searchOnlineDB=function(){if(V15.onlineLobby&&
V15.panelMgr.usesOnlineDB&&V15.panelMgr.usesOnlineDB()&&this.isPremium){V15.onlineLobby.isConnected()||V15.onlineLobby.connect();var b=new CB.SearchMask;b.setSearchBoard(this.fnGetKernel().game.getCurPos().board,this.fnGetKernel().game.getCurPos().getSideToMove());b.setUseBoard(!0);V15.onlineLobby.search(b,100,this.fnGetKernel().game.getMoveNo())}};c.prototype.onDBGamesListener=function(b){if(this.isVisible()){for(var d=!1,c=0;c<this.entries.length;c++)this.entries[c].players=[];for(var h=0;h<b.length;h++)if(b[h].nFlags&
CB.OnlineEntryEnum.FLAGS_ONLINE_GAME&&V15.onlineLobby.firstMove<b[h].aGame.getCurLine().length)for(var l=b[h].aGame.getCurLine()[V15.onlineLobby.firstMove],c=0;c<this.entries.length;c++)if(this.entries[c].from==l.from&&this.entries[c].to==l.to){var q="",r=0,t=b[h].aGame.hdr.date.year;V15.onlineLobby.firstMove&1?(q=b[h].aGame.hdr.black.getListStr(0),r=b[h].aGame.hdr.eloWh):(q=b[h].aGame.hdr.white.getListStr(0),r=b[h].aGame.hdr.eloBl);for(var v=!1,y=0;!v&&y<this.entries[c].players.length;y++)v=this.entries[c].players[y].name==
q;if(!v){this.entries[c].players.push({name:q,elo:r,year:t});d=!0;break}}if(d){for(c=0;c<this.entries.length;c++)this.entries[c].players=this.entries[c].players.sort(function(b,d){return d.elo-b.elo}).filter(function(b){return 2400<b.elo}),8<this.entries[c].players.length&&(this.entries[c].players.length=8),this.entries[c].players=this.entries[c].players.sort(function(b,d){return d.year==b.year?d.elo-b.elo:d.year-b.year});$(this.elem).jsGrid("render")}}};c.prototype.generateLine=function(b,d){for(var c=
this.convertJSONLine(ObjUtil.clone(b),d),h=new CB.NotationGenerator(CB.V1),l="",q=this.fnGetKernel().game.getStartPos().getBTM(),r=0;r<c.length;r++){var t=h.getMoveNota(c[r]),v=h.getStrMoveNumInLine(r,this.fnGetKernel().getCurPos().getPlyNum(),q),l=l+(v+t);r<c.length-1&&(l+=" ")}return l};c.prototype.convertJSONLine=function(b,d){var c=[];b.isLegalMove(d)&&(b.preCalcCtx(d),b.makeMove(d),b.postCalcCtx(d,!0),c.push(d));return c};c.prototype.loginListener=function(b){};c.prototype.onAccountTypeListener=
function(b){this.isPremium=3==b.type;this.isStandard=2==b.type||3==b.type};c.prototype.initListeners=function(){V15.aTBLobby&&(this.hasListeners=!0,V15.aTBLobby.addOnLiveBookDisplayListener(this.liveBookListener.bind(this)));V15.onlineLobby&&V15.onlineLobby.addOnGamesListener(this.onDBGamesListener.bind(this));V15.addOnAccountTypeListener(this.onAccountTypeListener.bind(this))};return c}();CB.LiveBookElement.factory=function(c,b,d,e){b=new CB.LiveBookElement(b||0,d,e);b.initElem(c);return b};"use strict";
CB.EvalProfileControl=function(){var c=function(b,c,f,g,h,l){this.init(b,c,f,g);this.options=h;this.gotoMove=l;this.nMove=0},b=1;c.prototype.onDestroyDOM=function(){};c.prototype.reset=function(){this.evArr&&(this.evArr.first=0,this.evArr.last=1,this.evArr.evalArr=[CB.EvalProfileAnno.EV_INVALID,CB.EvalProfileAnno.EV_INVALID]);this.redraw()};c.prototype.redraw=function(){this.cbcanvas.requestRedraw()};c.prototype.setEvalArr=function(b){b?(this.evArr=ObjUtil.clone(b),this.cbcanvas.requestRedraw()):
this.reset()};c.prototype.init=function(d,c,f,g){this.debugName=g;this.cbcanvas=d;this.calcGeometry();this.uniqueId=b++;this.resizeTimer=new CB.Timer(this.resizeHdl.bind(this))};c.prototype.resize=function(b,c){this.width=b;this.height=c;b&&c?this.resizeTimer.runOnce(5):this.resizeTimer.stop()};c.prototype.calcGeometry=function(){};c.prototype.resizeHdl=function(){this.width&&this.height&&this.cbcanvas.requestRedraw()};c.prototype.onMouseDown=function(b,c){};c.prototype.onMouseUp=function(b,c){var f=
(c.x-this.getDist())/this.getBinWidth();this.gotoMove(Math.floor(f))};c.prototype.onMouseWheel=function(b,c){};c.prototype.onMouseMove=function(b,c){};c.prototype.onDoubleClick=function(b,c){};c.prototype.onMouseEnter=function(b,c){};c.prototype.onMouseLeave=function(b,c){};c.prototype.drawForeground=function(b){};c.prototype.markMove=function(b){this.nMove=b;this.width&&this.height&&this.cbcanvas.requestRedraw()};c.prototype.draw=function(b){this.evArr&&(CB.LOG("DRAW EVALPROFILE","LogRed"),this.fillBG(b),
this.drawXAxis(b),this.drawYAxis(b),this.drawValues(b),this.drawMoveMarker(b))};c.prototype.getDist=function(){return Math.max(2,this.height/16)};c.prototype.getYMiddle=function(){return Math.ceil((this.height-2*this.getDist())/2)};c.prototype.getHalfRange=function(){var b=this.evArr.range()/2,b=Math.floor(100*(b/100+1));200>b&&(b=200);1200<b&&(b=1200);return b};c.prototype.getYValue=function(b){if(32767==b)return 0;var c=this.getHalfRange(),f=0<b?1:0>b?-1:0;Math.abs(b)>c&&(b=c);b=0==b?0:Math.abs(b);
c=Math.abs(c);return(this.height-2*this.getDist())/2*(b/c)*f};c.prototype.fillBG=function(b){if(this.width&&this.height){var c=b.createLinearGradient(0,0,this.width,this.height);c.addColorStop(0,"hsla( 0, 0%,  97%, 1.0 )");c.addColorStop(1,"hsla( 0, 0%, 99%, 1.0 )");b.fillStyle=c;CB.CanvasTools.fillRect(b,new CB.Rect(0,0,this.width,this.height))}};c.prototype.drawXAxis=function(b){var c=this.getDist(),f=this.getYMiddle()+1,g=this.width-this.getDist();b.strokeStyle="black";b.lineWidth=2;b.lineCap=
"round";CB.CanvasTools.drawLine(b,c,f,g,f)};c.prototype.drawYAxis=function(b){var c=this.getDist()-2,f=this.getDist(),g=f+this.height-2*this.getDist();b.strokeStyle="black";b.lineWidth=2;b.lineCap="round";CB.CanvasTools.drawLine(b,c,f,c,g)};c.prototype.getBinWidth=function(){if(!this.evArr)return 1;var b=Math.max(30,this.evArr.last+1);return Math.max(1,(this.width-2*this.getDist())/b)};c.prototype.drawMoveMarker=function(b){var c=(this.nMove+0)*this.getBinWidth()+this.getDist(),f=new CB.Rect(c,0,
c+this.getBinWidth(),0+this.height);CB.LOG("evR="+f.toString());b.fillStyle="hsla( 30, 3%, 30%, 0.16 )";CB.CanvasTools.fillRect(b,f);f=this.cbcanvas.zoomToPix(10);b.font=String.formatEx("{0}px Roboto",f);b.fillStyle="black";var g=this.evArr.evalArr[this.nMove-this.evArr.first],h=.27*this.height,f=this.getYMiddle()-h;0<=g&&(f=this.getYMiddle()+h);h="";"undefined"!=typeof g&&g!=CB.EvalProfileAnno.EV_INVALID&&(h=(g/100).toFixed(2),h+=", "+CB.Evaluation.getEvalString(g));if(h){var g=b.measureText(h).width,
l=-this.getBinWidth();c+l+g>this.width&&(l=this.width-g-c-5);b.fillText(h,c+l,f)}};c.prototype.drawValues=function(b){var c=this.getBinWidth();b.strokeStyle="hsla( 0, 0%, 0%, 0.4 )";b.fillStyle="green";b.lineWidth=1;for(var f=0;f<this.evArr.last-this.evArr.first+1;f++){var g=Math.round((this.evArr.first+f)*c+this.getDist()),h=Math.round(g+c),l=this.getYMiddle(),q=this.evArr.evalArr[f],r=this.getYValue(q);r&&(b.fillStyle=0>r?28E3<Math.abs(q)?"hsla( 0, 30%, 30%, 1.0 )":"red":28E3<Math.abs(q)?"hsla( 120, 30%, 25%, 1.0 )":
"green",q=Math.round(this.getYMiddle()-r),q<l&&(r=q,q=l,l=r),g=new CB.Rect(g,l,h,q),CB.LOG("evR="+g.toString()),CB.CanvasTools.fillRect(b,g),b.strokeStyle="black",CB.CanvasTools.drawRect(b,g))}};return c}();
CB.VersionCodeEnum={JSPLAYCHESS:1101,JSLIVEBLITZ:1102,JSCBONLINE:1103,JSOPENINGS:1104,JSPREMIUM:1105,JSFRITZ:1106,JSTEST:1107,JSMYGAMES:1108,JSPLAYERDB:1109,JSTACTICS:1110,JSTACTICSBOARD:1111,JSCBONLINEBOARD:1112,JSPREMIUMBOARD:1113,JSENDGAMES:1114,JSLIVE:1115,JSREADER:1116,JSPLAY:1117,JSSTUDY:1118,toString:function(c){for(a in CB.VersionCodeEnum)if(CB.VersionCodeEnum[a]==c)return a;return c}};
CB.VersionCode=function(){var c=function(b,d,c,f){this.nFamily=void 0!==b?b:CB.VersionCodeEnum.JSPLAYCHESS;this.nMajor=void 0!==d?d:0;this.nMinor=void 0!==c?c:0;this.nBeta=void 0!==f?f:0};c.prototype.Vz=function(b){b.Vv(this.nFamily);b.Vv(this.nMajor);b.Vv(this.nMinor);b.Vv(this.nBeta);b.Vv(83);b.Vv(0);b.Vx(0);b.Vv(0);b.Vv(0)};c.prototype.toString=function(){return this.familyToString(this.nFamily)+" "+this.getStrVersion()};c.prototype.getStrVersion=function(){var b=this.nMajor+"."+this.nMinor;this.nBeta&&
(b+="."+this.nBeta);CB.System.isCordova()&&(b+="c");CB.System.browserIsSafeForEngine()&&(b+="e");CB.System.isMobile()&&(b+="m");return b};c.prototype.familyToString=function(b){switch(b){default:return CB.VersionCodeEnum.toString(b);case CB.VersionCodeEnum.JSPLAYCHESS:return"Playchess";case CB.VersionCodeEnum.JSLIVEBLITZ:return"LiveBlitz";case CB.VersionCodeEnum.JSCBONLINE:return"OnlineDB";case CB.VersionCodeEnum.JSOPENINGS:return"Openings";case CB.VersionCodeEnum.JSFRITZ:return"Fritz";case CB.VersionCodeEnum.JSMYGAMES:return"MyGames";
case CB.VersionCodeEnum.JSTRAINING:return"Training";case CB.VersionCodeEnum.JSENDGAMES:return"Endgames";case CB.VersionCodeEnum.JSLIVE:return"Live";case CB.VersionCodeEnum.JSREADER:return"Reader";case CB.VersionCodeEnum.JSPLAY:return"Play";case CB.VersionCodeEnum.JSSTUDY:return"Study"}};c.prototype.GetNCompressedVersion64=function(){return this.nFamily<<48|this.nMajor<<32|this.nMinor<<16|this.nBeta};return c}();
CB.SockMsgId={NONE:0,WIN_INVALID_PASSWORD:17,WIN_ACCESS_DENIED:42,ALIVE:7001,LOGON:7002,LOGOFF:7003,YOUR_ID:7004,INVALID_PASSWORD:7005,RECONNECT_OK:7006,CLIENTPING:7007,CLIENTECHO:7008,BINDERTIMEOUT:7009,ALREADYLOGGEDON:7010,FORCE_LOGOFF:7011,INVALIDPASSWORD:7012,YOUR_LOGINTOKEN:7013,ACCOUNT_LOCKOUT:7014,IAMALIVE:7015,LOGIN_OTHER_MACHINE:7016,KICKEDOUT_OTHER_MACHINE:7017,IDLE_CLIENT_LOGOFF:7018,CHAT:7020,STARTTYPINGCHAT:7021,ALERT:7022,PING_BY_NAME:7023,RESPOND_PING_BY_NAME:7024,USER:7030,QUERY_SERVERALIVE:7040,
SERVER_IS_ALIVE:7041,TEST:7042,CLIENTLIST:7050,ADDCLIENTS:7051,REMOVECLIENTS:7052,CLIENTDATACHANGE:7053,LISTFRAGMENTRECEIVED:7054,LISTUPDATECHANGE:7055,CLIENTDATACHANGELIST:7056,SESSIONSTATUSCHANGELIST:7057,REQUESTCLIENTLIST:7058,GROUPSTATUSCHANGE:7060,CHANGEGROUP:7061,DEFAULTGROUPS:7062,CHANNELDATA:7070,CHANNELSTATUSCHANGE:7071,REQUESTCHANNELS:7072,JOINCHANNEL:7073,GETBROADCASTURLS:7074,BROADCASTURLS_DATA:7075,GETGEOLEADERBOARD:7076,GEOLEADERBOARD_DATA:7077,GETFRIENDSLEADERBOARD:7078,GETFRIENDSLEADERBOARD_REPLY:7079,
REQUEST_STATISTICS:7080,STATISTICS_DATA:7081,RELAYFRIENDSMESSAGE:7082,FRIENDSMESSAGE_DATA:7083,GETACTIVEHLSSTREAMS:7084,GETACTIVEHLSSTREAMS_REPLY:7085,GROUPHTMLCHANGED:7086,REQUESTCLIENTDATA:7087,CLIENTDATA:7088,REQUESTBROADCASTURLSEX:7089,REQUESTBROADCASTURLSEX_DATA:7090,REQUESTGROUPS:7091,GROUPSDATA:7092,QUERY_ONLINE_DB:7100,REQUEST_ONLINE_DB_GAMES:7101,REQUEST_ONLINE_DB_HEADERS:7102,REQUEST_ONLINE_DB_STATISTICS:7103,REQUEST_ONLINE_DB_USER_INFO:7104,REQUEST_ONLINE_DB_ADMIN_INFO:7105,ONLINE_DB_NUMBERS:7106,
ONLINE_DB_GAMES:7107,ONLINE_DB_HEADERS:7108,ONLINE_DB_STATISTICS:7109,ONLINE_DB_MAINTENANCE:7110,ONLINE_DB_USER_INFO:7111,ONLINE_DB_ADMIN_INFO:7112,MAINTENANCE_ONLINE_DB_UPDATE:7113,PLAYER_BASE_USER:7200,TERABRAIN_USER:7300,TERABRAIN_ERROR:7301,TERABRAIN_MAINTENANCE:7302,REQUEST_TERABRAIN_POSITION:7303,TERABRAIN_REQUEST:7304,TERABRAIN_ENGINE_SEARCHDATA:7305,TERABRAIN_BOOKINFO:7306,TERABRAIN_TABLEDATA:7307,CLOUD_USER:7400,TRAINING_USER:7401,ANALYSIS_USER:7402,LIVE_USER:7403,toString:function(c){for(var b in this)if(this[b]==
c)return"SockMsg:"+b;return"Unknown SockMsg: "+c},toNumString:function(c){return"SockMsgId="+c}};
CB.WebSockMessage=function(){var c=function(b){this.type=b||CB.SockMsgId.NONE;this._init()};c.prototype.getType=function(){return this.type};c.prototype.setType=function(b){this.type=b};c.prototype.getUserType=function(){return this.userType};c.prototype.setUserType=function(b){this.userType=b};c.prototype.getIdReceiver=function(){return this.idReceiver};c.prototype.setIdReceiver=function(b){this.idReceiver=b};c.prototype.Vj=function(){return this.idSender};c.prototype.Vm=function(b){this.idSender=
b};c.prototype.setVal=function(b){this.nVal=b};c.prototype.getVal=function(){return this.nVal};c.prototype.address=function(b,d){this.idSender=b;this.idReceiver=d};c.prototype.getBuf=function(){return this.buf};c.prototype.fillSendArrBuf=function(b){var d=16;b&&(d+=4);var d=new ArrayBuffer(d+this.buf.getWriteSize()),c=new DataView(d);c.setInt16(0,this.type);c.setInt32(2,this.nVal);c.setInt32(6,this.idSender);c.setInt16(10,this.userType);c.setInt32(12,this.idReceiver);b?(c.setInt32(16,this.msgId),
this.buf.writeToDataView(c,20)):this.buf.writeToDataView(c,16);return d};c.prototype.fromReceiveBuf=function(b){if(16<=b.byteLength){var d=new DataView(b);this.type=d.getInt16(0);this.nVal=d.getInt32(2);this.idSender=d.getInt32(6);this.userType=d.getInt16(10);this.idReceiver=d.getInt32(12);20<=b.byteLength&&(this.buf.readFromDataView(d,16),this.buf.rewind())}else throw Error("Illegal Message received");};c.prototype.toString=function(){var b="",d;for(d in CB.SockMsgId)if(this.type==CB.SockMsgId[d]){b+=
d;break}this.userType&&(b+=", usr="+this.userType);b+=", sender="+this.idSender+", receiver="+this.idReceiver;this.buf.getSize()&&(b+=", bufsize="+this.buf.getSize());return b};c.prototype._init=function(){this.nVal=this.idSender=this.idReceiver=this.userType=0;this.buf=new CB.DataBuffer;this.msgId=0};return c}();CB.LoginMode={NORMAL:1,GUEST:2};CB.LogoffType={DEFAULT:0,REMOVE_WATCHER:1,RESIGN:2,ABORT:3};CB.LoginFlags={YES2CHESS:32,HASWEBSOCKIDS:128,IS_WEAK_GUEST:1024,SPRINT_REQUESTS_NEXT_POS:2048};
CB.LogonData=function(){var c=function(b,d,c,f,g,h){this.strName=b;this.strPass=d;this.nMode=c;this.version=V15.versionCode;this.guid=f;this.language=CB.Language.getStrUserLanguage();this.codepage=CB.System.getWindowsCodePage();this.strRoom="";this.strRoomUrl=document.referrer;this.token=g||"";this.app=h||"";this.flags=0;this.documentUrl=""};c.prototype.Vc=function(b){var d=new CB.WebSockMessage(CB.SockMsgId.LOGON);d.address(CB.ConnectId.UNKNOWN,CB.ConnectId.SERVER);d.getBuf().Vx(this.nMode);this.version.Vz(d.getBuf());
var c=this.strName;CB.strUtil.hasASCIIgreater127(c)&&!CB.strUtil.mayBeUtf8(c)&&(c=CB.strUtil.encodeUTF8(c));var f=this.strPass;CB.strUtil.hasASCIIgreater127(f)&&!CB.strUtil.mayBeUtf8(f)&&(c=CB.strUtil.encodeUTF8(f));d.getBuf().V8(c);d.getBuf().V8(f);this.guid.Vz(d.getBuf());d.getBuf().V5(this.language);d.getBuf().V5(navigator.platform);d.getBuf().Vx(this.codepage);d.getBuf().V8(this.strRoom);d.getBuf().V5(this.token);d.getBuf().V8(0<this.strRoom.length?this.strRoomUrl:"");d.getBuf().V5(this.app);
b&&(this.flags|=CB.LoginFlags.HASWEBSOCKIDS);d.getBuf().Vx(this.flags);d.getBuf().V5(navigator.appVersion);d.getBuf().V5(this.documentUrl);return d};c.prototype.setIsBeginner=function(){this.flags|=CB.LoginFlags.IS_WEAK_GUEST};c.prototype.setRequestsSprintPos=function(){this.flags|=CB.LoginFlags.SPRINT_REQUESTS_NEXT_POS};return c}();"use strict";
CB.YourIdData=function(){var c=function(){this.nId=CB.ConnectId.NONE;this.nIdCMSArchive=this.nIdBroadcastGroup=this.nIdDefaultPlayingGroup=0;this.strUserId=this.strToken="";this.nFlags=this.Vl=0};c.prototype.fromSocketsMsg=function(b){b.getBuf().rewind();this.nIdDefaultPlayingGroup=b.getBuf().V10();this.nIdBroadcastGroup=b.getBuf().V10();this.nId=b.getBuf().V10();this.nIdCMSArchiv=b.getBuf().V10();this.strToken=b.getBuf().V6(200);this.Vl=b.getBuf().V11();this.strUserId=b.getBuf().V6(200);this.nFlags=
b.getBuf().V10()};c.prototype.isFromBridge=function(){return 0!==(this.nFlags&2)};return c}();
CB.ChatData=function(){var c=function(){this.idReceiver=this.idSender=CB.ConnectId.NONE;this.eColName=this.eWeight=0;this.strMsg="";this.eSound=0;this.strSender="";this.nTotalReceivers=this.flags=this.nChannel=0;this.arrReceivers=[];this.token=0};c.prototype.chatFlags={ITALIC:1,UNDERLINE:2,UTF8:256,AUTOMATIC:4096,TO_GROUP:8192,TO_OBSERVERS:16384,TO_CHANNEL:32768,TO_INDIVIDUALS:65536,TO_OBSERVERSANDPLAYERS:131072,TO_SESSION:262144};c.YELLOW=14;c.prototype.Vc=function(){var b=new CB.WebSockMessage(CB.SockMsgId.CHAT);
b.address(this.idSender,this.idReceiver);var d=b.getBuf();d.Vv(this.eWeight);d.Vv(this.eColName);d.V5(this.strMsg);d.Vv(this.eSound);d.V5(this.strSender);d.Vx(this.nChannel);d.Vx(this.nTotalReceivers);d.Vx(this.flags);if(this.isToIndividuals()){d.Vx(this.arrReceivers.length);for(var c=0;c<this.arrReceivers.length;c++)d.Vx(this.arrReceivers[c])}d.Vh(this.token);return b};c.prototype.fromSocketsMsg=function(b){var d=b.getBuf();this.idReceiver=b.getIdReceiver();this.idSender=b.Vj();d.rewind();this.eWeight=
d.V11();this.eColName=d.V11();try{this.strMsg=d.V6(1E3)}catch(c){CB.LogException("Chat Msg Len exception, sender="+this.idSender)}this.eSound=d.V11();try{this.strSender=d.V6(210)}catch(c){CB.LogException("Chat Sender exception, msg="+this.strMsg+", sender="+this.idSender)}this.nChannel=d.V10();this.nTotalReceivers=d.V10();this.flags=d.V10();if(this.isToIndividuals()){b=d.V10();for(var e=0;e<b&&500>e;e++)this.arrReceivers.push(d.V10())}this.token=d.Vw()};c.prototype.toString=function(){var b="";0<
this.strSender.length&&(b+="<em>"+this.strSender+":</em> ");return b+=this.strMsg};c.prototype.isPrivate=function(){return 0==this.flags};c.prototype.isToIndividuals=function(){return 0!=(this.flags&this.chatFlags.TO_INDIVIDUALS)};c.prototype.setToIndividuals=function(b){CB.setFlag(this,this.chatFlags.TO_INDIVIDUALS,b)};c.prototype.isToChannel=function(){return 0!=(this.flags&this.chatFlags.TO_CHANNEL)};c.prototype.setToChannel=function(b){CB.setFlag(this,this.chatFlags.TO_CHANNEL,b)};c.prototype.isToSession=
function(){return CB.isFlag(this.flags,this.chatFlags.TO_SESSION)};c.prototype.setToSession=function(b){CB.setFlag(this,this.chatFlags.TO_SESSION,b)};c.prototype.isToObservers=function(){return CB.isFlag(this.flags,this.chatFlags.TO_OBSERVERS)};c.prototype.setToObservers=function(b){CB.setFlag(this,this.chatFlags.TO_OBSERVERS,b)};c.prototype.getIdSession=function(){return this.nChannel};c.prototype.setToGroup=function(b){CB.setFlag(this,this.chatFlags.TO_GROUP,b)};c.prototype.isToGroup=function(){return 0!=
(this.flags&this.chatFlags.TO_GROUP)};c.prototype.setIdSession=function(b){this.nChannel=b};c.prototype.setChannel=function(b){this.nChannel=b;this.setToChannel(!0)};c.prototype.setAutomatic=function(b){CB.setFlag(this,this.chatFlags.AUTOMATIC,b)};c.prototype.isAutomatic=function(){return 0!=(this.flags&this.chatFlags.AUTOMATIC)};c.prototype.setReceivers=function(b){b.length?(this.idReceiver=b[0],this.arrReceivers=b):(this.idReceiver=b,this.arrReceivers.push(b))};c.prototype.autoTests=function(){window.chat=
new c;chat.eColName=2;chat.eWeight=1;chat.eSound=3;chat.nChannel=4;chat.nTotalReceivers=5;chat.strMsg="Hello World!";chat.strSender="Doktor Schiwago";var b=chat.Vc();window.chat2=new c;chat2.fromSocketsMsg(b);return chat2.strMsg!==chat.strMsg?"test failed":"test OK"};return c}();CB.ConnectId={NONE:0,UNKNOWN:0,SERVER:1};CB.SockState={CONNECTING:0,CONNECTED:1,CLOSING:2,CLOSED:3};
CB.Connection=function(){var c=function(b,d){this.connectId=CB.ConnectId.NONE;this.uris=[].concat(d);this.nUri=0;V15&&void 0!=V15.config.nBridge&&V15.config.nBridge<this.uris.length&&(this.nUri=V15.config.nBridge);this.wsUri=this.uris[this.nUri];this.msgsWaitingToSend=new CB.Queue;this.msgsWaitingToSendNoId=new CB.Queue;this.onYourId=function(b){};this.onClose=function(b){};this.isFirstConnect=!0;this.firstConnectTries=0;this.onConnectionLoss=function(){};this.onServerDown=function(){};this.lobby=
b;this.Va=0;this.error=!1;this.isActiveTicker=new CB.Tick;this.weAreAliveTicker=new CB.Tick;this.tryTimer=new CB.Timer(this.periodicHandler.bind(this));this.tryTimerPeriod=200;this.msgCnt=0};c.prototype.open=function(){try{this.socket&&this.socket.close();this.socket=new WebSocket(this.wsUri);var b=this;this.error=!1;this.socket.onopen=function(){for(;!b.msgsWaitingToSendNoId.empty();)b.socket.readyState==CB.SockState.CONNECTED?b.sendMessage(b.msgsWaitingToSendNoId.pop(),!0):(b.msgsWaitingToSendNoId.pop(),
CB.LOG("YOU DID SOMETHING BAD, YOU ARE SENDING BUT HAVE NOT WAITED FOR CONNECTION TO COMPLETE","LogException"));for(;!b.msgsWaitingToSend.empty();)b.socket.readyState==CB.SockState.CONNECTED?b.sendMessage(b.msgsWaitingToSend.pop(),!1):(b.msgsWaitingToSend.pop(),CB.LOG("YOU DID SOMETHING BAD, YOU ARE SENDING BUT HAVE NOT WAITED FOR CONNECTION TO COMPLETE","LogException"));CB.LOG("Connected to "+b.wsUri,"","conn");console.log("Connected:"+b.wsUri);this.tryTimerPeriod=200;(new CB.Timer(function(){b.lobby.onConnect()})).runOnce(20)};
this.socket.onclose=function(d){5;b.onClose(b);if(void 0!==b.onBroken)b.onBroken();1E3<d.Code&&(V15.LogConnection(b.lobby.getName()+"-Close="+d.Code),console.log("Close: "+closeCodes[d.Code]))};this.socket.onerror=function(d){CB.LOG("OnError  : "+b.wsUri,"LogError","conn");console.log("Error: "+b.wsUri+" "+d);b.isFirstConnect&&1<b.uris.length&&4>++b.firstConnectTries?(b.switchConnection(),b.open()):(b.error=!0,b.onSocketError(b))};this.socket.onmessage=function(d){b.tryTimer.stop();if(d.data instanceof
ArrayBuffer){var c=new CB.WebSockMessage;try{c.fromReceiveBuf(d.data)}catch(f){EXCEPTION(f.toString())}b.V0(c);b.weAreAliveTicker.start()}else CB.LOG(d.data,"","conn"),console.log("RESPONSE: "+d.data);b.Va=0}}catch(d){CB.LogException("Conn",d)}};c.prototype.close=function(){CB.LOG("Close Conn"+this.wsUri,"","conn");(this.isConnected()||this.isConnecting())&&this.socket.close();this.tryTimer.stop()};c.prototype.isConnected=function(){return this.socket&&this.socket.readyState==CB.SockState.CONNECTED};
c.prototype.isConnecting=function(){return this.socket&&this.socket.readyState==CB.SockState.CONNECTING};c.prototype.onSocketError=function(){this.isFirstConnect?(this.onServerDown(),this.lobby.periodicPingTimer&&this.lobby.periodicPingTimer.stop(),this.tryTimer.runPeriodic(3E4)):(this.onConnectionLoss(),this.tryTimer.runPeriodic(this.tryTimerPeriod))};c.prototype.V0=function(b){this.isFirstConnect=!1;var d=!0;switch(b.getType()){default:d=!1;break;case CB.SockMsgId.YOUR_ID:this.handleYourId(b);break;
case CB.SockMsgId.ALIVE:d=!1}d||this.lobby.handleReceived(b)};c.prototype.handleYourId=function(b){var d=new CB.YourIdData;d.fromSocketsMsg(b);this.connectId=d.nId;this.lobby.idReceived(d);this.onYourId(this)};c.prototype.sendMessage=function(b,d){if(this.socket){if(!b.getType())throw Error("Sending invalid sockMsg");b.msgId=d?0:++this.msgCnt;b.getIdReceiver()==CB.ConnectId.NONE&&b.setIdReceiver(CB.ConnectId.SERVER);b.Vm(this.connectId);if(this.socket.readyState==CB.SockState.CONNECTED){this.socket.binaryType=
"arraybuffer";var c=b.fillSendArrBuf(!d);this.socket.send(c)}else this.socket.readyState==CB.SockState.CONNECTING?(d?this.msgsWaitingToSendNoId.push(b):this.msgsWaitingToSend.push(b),CB.LOG("MSGs WAITING TO SEND="+this.msgsWaitingToSend.getLength(),"LogRed")):this.socket.readyState!=CB.SockState.CLOSING&&this.socket.readyState!=CB.SockState.CLOSED&&(this.error=!0,this.onSocketError())}};c.prototype.sendText=function(b){this.socket&&1==this.socket.readyState?(console.log("SENT: "+b),this.socket.send(b)):
CB.LOG("Connection not open")};c.prototype.breakForTesting=function(){CB.LOG("Break Connection for Testing");this.close()};c.prototype.periodicHandler=function(){CB.LOG("Conn Periodic, retries="+this.Va+", "+this.lobby.connectId,"","conn");this.tryTimer.runPeriodic(1E4);this.socket&&this.socket.readyState!=CB.SockState.CONNECTED&&this.error&&(this.Va+=1,1<=this.Va&&(this.isFirstConnect||6<this.Va)&&this.switchConnection(),this.lobby.pingServer&&this.lobby.pingServer(!0,1==this.Va?2E3:6E3,!0),5<this.Va&&
this.tryTimer.runPeriodic(5E4+3E4*Math.random()))};c.prototype.switchConnection=function(){this.nUri++;if(this.uris&&this.uris.length&&(this.nUri>=this.uris.length&&(this.nUri=0),CB.LOG("nUri: "+this.nUri,"","conn"),this.wsUri=this.uris[this.nUri],CB.LOG("Switch Conn: "+this.wsUri,"","conn"),console.log("Switch Conn: "+this.wsUri),this.lobby.onSwitchConn))this.lobby.onSwitchConn(this.nUri)};return c}();
CB.ClientParams=function(){var c=function(b){this.guid=new CBGuid;this.password=this.userName="";this.stayLoggedIn=!0;var d="ClientGUID"+b,c=null,f=window;f.localStorage?c=f.localStorage:f.sessionStorage&&(c=f.sessionStorage);if(c&&c[d]){b=JSON.parse(c[d]);for(var g in b)this.guid[g]=b[g]}else this.guid=new CBGuid,this.guid.fromRandom(b),c&&(c[d]=JSON.stringify(this.guid))};c.prototype.toString=function(){return"User="+this.userName+", mode="+this.loginMode};c.prototype.saveLogin=function(){this.save("user",
this.userName)};c.prototype.loadLogin=function(){this.userName=this.load("user")};c.prototype.getSessionStorage=function(){var b=null,d=window;d.sessionStorage?b=d.sessionStorage:d.localStorage&&(b=d.localStorage);return b};c.prototype.storeRoom=function(b,d,c,f){this.room=b;this.set("room",b);this.set("roomurl",d);this.set("banner",c);this.set("roomtext",f)};c.prototype.clearRoom=function(){this.room="";this.set("room","");this.set("roomurl","");this.set("banner","");this.set("gradient","");this.set("roomtext",
"")};c.prototype.storeBanner=function(b,d){this.set("banner",b);this.set("gradient",d)};c.prototype.storeSeek=function(b){this.set("seek",b)};c.prototype.store=function(b,d){this.getSessionStorage()[d]=b};c.prototype.get=function(b){return this.getSessionStorage()[b]||""};c.prototype.set=function(b,d){this.getSessionStorage()[b]=d};c.prototype.load=function(b){return window.localStorage?window.localStorage[b]||"":""};c.prototype.save=function(b,d){window.localStorage&&(window.localStorage[b]=d)};
c.prototype.isKibitz=function(){return this.get("kibitz")};c.prototype.startEngine=function(){if(!CB.System.isMobile()){var b=this.get("layout");return b&&0<=b.search("engine")}};c.prototype.hasLayout=function(){return this.get("layout")};c.prototype.shouldDisplayBoardUrls=function(){return this.isKibitz()&&this.noRibbons()};c.prototype.noRibbons=function(){var b=this.get("layout");return b&&0<=b.search("nomenu")};c.prototype.noPlayers=function(){var b=this.get("layout");return b&&0<=b.search("noplayers")};
c.prototype.noLists=function(){var b=this.get("layout");return b&&0<=b.search("nolists")};c.prototype.receiveSeeksAlways=function(){return!1};c.prototype.noLists=function(){var b=this.get("layout");return b&&0<=b.search("nolists")};c.prototype.noChat=function(){var b=this.get("layout");return b&&0<=b.search("nochat")};c.prototype.noBook=function(){var b=this.get("layout");return b&&0<=b.search("nobook")};c.prototype.noNota=function(){var b=this.get("layout");return b&&0<=b.search("nonota")};c.prototype.getRoom=
function(){return this.get("room")};c.prototype.getRoomUrl=function(){return this.get("roomurl")};c.prototype.getRoomText=function(){return this.get("roomtext")};c.prototype.getBanner=function(){return this.get("banner")};c.prototype.getGradient=function(){return this.get("gradient")};c.prototype.getPlay=function(){return this.get("play")};c.prototype.isPlay=function(){return this.get("play")};c.prototype.prepareLoginChange=function(){var b={banner:this.getBanner(),gradient:this.getGradient(),room:this.getRoom(),
roomUrl:this.getRoomUrl()};this.keepStateAccrossLogin(b)};c.prototype.afterLoginChange=function(){var b=this.getStateAcrossLogin();b&&(this.resetStateAfterLogin(),this.storeBanner(b.banner,b.gradient))};c.prototype.keepStateAccrossLogin=function(b){b=JSON.stringify(b);window.localStorage&&(window.localStorage.AcrossLogin=b)};c.prototype.resetStateAfterLogin=function(b){window.localStorage&&delete window.localStorage.AcrossLogin};c.prototype.getStateAcrossLogin=function(){if(window.localStorage){var b=
window.localStorage.AcrossLogin;if(b)return JSON.parse(b)}};c.prototype.clearLoginCookies=function(b){this.loginToken="";b||CB.DOM.clearCookie("AccountName64");CB.DOM.clearCookie("AccountToken");CB.DOM.clearCookie("AccountMode");CB.DOM.setCookie("CBCOMMON","")};c.prototype.clearCBCommonCookie=function(){CB.DOM.setCookie("CBCOMMON","")};c.prototype.rememberLoginToken=function(){this.stayLoggedIn&&this.loginToken?CB.DOM.setCookie("AccountToken",this.loginToken):CB.LOG("RememberLoginToken, stayLoggedIn="+
this.stayLoggedIn+"="+this.loginToken)};c.prototype.clearLoginToken=function(){CB.DOM.clearCookie("AccountToken");this.loginToken=""};c.prototype.hasUserAndPass=function(){return this.userName&&"guest"!=this.userName&&(this.loginToken||this.password)};c.prototype.requestTokenWithPassword=function(b){!this.loginToken&&this.password&&this.loginMode==CB.LoginMode.NORMAL&&(new CB.Timer(function(){(new CB.AccountsManager(b)).pwLogin(this.userName,this.password,function(b){b&&b.Token&&(this.loginToken=
unescape(b.Token),this.rememberLoginToken(),CB.DOM.setAccountNameCookie(this.userName),CB.DOM.setCookie("AccountMode",CB.LoginMode.NORMAL))}.bind(this))}.bind(this))).runOnce(100)};return c}();"use strict";CB.namespace("CB.Server.LogOffReason");CB.Server.LogOffReason={MAINTENANCE:0,ADMIN_ACTION:1,DOUBLE_LOGIN:2,IDLE_CLIENT:3};CB.namespace("CB.Server.Connector");
CB.Server.Connector=function(){var c=function(){this.hasIdReceived=!1;this.pingServerPeriodMS=12E3;this.reconnectBaseTime=5E3;this.bufferedMsgs=[];this.isFirstConn=!0;this.name="...";this.pingCount=this.connectCount=0;this.logClientEcho=this.silentServerPing=!0};c.prototype.create=function(b,d,c,e,q){this.pingTimer=new CB.Timer(this.onServerPingTimeout.bind(this));this.user=d;this.utf8User=CB.strUtil.encodeUTF8(d);this.pass=c;this.conn=new CB.Connection(this,b);this.loginMode=e;this.token=q;this.pingStart=
CB.getTick();this.Va=0;this.timerReconnect=new CB.Timer;this.nMyLagMS=3E3;this.conn.onConnectionLoss=this.onConnLoss.bind(this);this.conn.onServerDown=this.hdlOnServerDown.bind(this);this.boundLoginOk=!1;e!=CB.LoginMode.GUEST&&CB.DOM.setAccountNameCookie(d);this.periodicPingTimer=new CB.Timer(this.periodicPingHandler.bind(this))};c.prototype.hdlOnServerDown=function(b){if(void 0!==this.onServerDown)this.onServerDown();this.hasIdReceived=!1};c.prototype.onConnLoss=function(b){if(void 0!==this.onConnBroken)this.onConnBroken();
this.hasIdReceived=!1;this.onServerNotAlive()};c.prototype.getName=function(){return"Connector"};c.prototype.connectUser=function(b,d,c,e){this.pingTimer&&this.pingTimer.stop();this.userLoggedOff=this.forcedLogOff=!1;this.pingTimer=new CB.Timer(this.onServerPingTimeout.bind(this));this.isConnected()&&this.hasIdReceived&&this.logOff();this.onChangeLogin();this.user=b;this.utf8User=CB.strUtil.encodeUTF8(this.user);this.pass=d;this.token=e;this.loginMode=c;this.pingStart=CB.getTick();this.Va=0;this.timerReconnect=
new CB.Timer;this.nMyLagMS=3E3;(new CB.Timer(this.connectFresh())).runOnce(100);c!=CB.LoginMode.GUEST&&CB.DOM.setAccountNameCookie(b)};var b=new CB.Vr;c.prototype.reconnectUser=function(){b.exec(function(){this.loginMode=this.pass?CB.LoginMode.NORMAL:CB.LoginMode.GUEST;this.connectUser(this.user,this.pass,this.loginMode,this.token);this.Va++;this.timerReconnect.stop()}.bind(this),10*this.Va)};c.prototype.connectFresh=function(){this.conn.close();this.hasIdReceived=!1;this.connect()};c.prototype.connect=
function(){this.conn&&(this.boundLoginOk=this.hasIdReceived=!1,this.conn.close(),this.conn.open(),this.isSilent()||this.statusMsg(lm.CONNECTING,"LogBold"),this.periodicPingTimer.runPeriodic(this.pingServerPeriodMS),this.connectCount++)};c.prototype.isConnected=function(){return this.conn?this.conn.isConnected():!1};c.prototype.isConnecting=function(){return this.conn?this.conn.isConnecting():!1};c.prototype.isLoggedIn=function(){return this.boundLoginOk&&this.isConnected()};c.prototype.wasLoggedIn=
function(){return!this.isFirstConn&&!this.isConnected()};c.prototype.hasSockMsgIds=function(){return!1};c.prototype.logonGuest=function(){this.isSilent()||(this.logIntoChat(this.getWaitForServerMsg(),"LogGreen","conn"),this.statusMsg(this.getWaitForServerMsg(),"LogGreen","conn"));var b=V15.Vf.guid;CB.System.runsInIFrame()&&b.fromRandom(10);b=this.createLogonData(b,!0);this.modifyLoginData(b);this.sendNoId(b.Vc(this.hasSockMsgIds()));this.userLoggedOff=!1};c.prototype.logon=function(){if(!this.hasIdReceived){this.boundLoginOk=
!1;this.isSilent()||(this.logIntoChat(this.getWaitForServerMsg(),"LogGreen","conn"),this.statusMsg(this.getWaitForServerMsg(),"LogGreen","conn"));var b=this.createLogonData(V15.Vf.guid,!1);this.modifyLoginData(b);this.sendNoId(b.Vc(this.hasSockMsgIds()));this.userLoggedOff=!1}};c.prototype.modifyLoginData=function(b){};c.prototype.createLogonData=function(b,d){return d?new CB.LogonData("Guest","Pass",CB.LoginMode.GUEST,b):new CB.LogonData(this.user,this.pass,CB.LoginMode.NORMAL,b,this.token)};c.prototype.clearLoginCookies=
function(){V15.Vf&&V15.Vf.clearLoginCookies(!0)};c.prototype.getWaitForServerMsg=function(){return"Waiting for Server"};c.prototype.logOff=function(){CB.LOG(this.name+" - ConnectorLogOff:"+this.user+" "+this.loginMode,"LogBold");this.periodicPingTimer&&this.periodicPingTimer.stop();if(this.hasIdReceived&&this.isConnected()){var b=new CB.WebSockMessage(CB.SockMsgId.LOGOFF);b.address(this.conn.connectId,CB.ConnectId.SERVER);b.buf.Vx(0);this.send(b);this.loginMode=CB.LoginMode.GUEST}this.onLogOff()};
c.prototype.onLogOff=function(){this.periodicPingTimer&&this.periodicPingTimer.stop();this.hasIdReceived=this.boundLoginOk=!1;this.userLoggedOff=!0};c.prototype.onChangeLogin=function(){};c.prototype.changeLogin=function(){V15.Vf&&V15.Vf.prepareLoginChange&&V15.Vf.prepareLoginChange();this.logOff(!0);window.location.replace(V15.getLoginUrl())};c.prototype.handleBinderTimeout=function(){this.logIntoChat("Sorry, cannot reach the "+this.name+"server. It is in maintenance. Please try again in 15 minutes.",
"LogBold");this.conn.close();this.clearLoginCookies()};var d=new CB.Vr;c.prototype.pingServer=function(b,c,e){if(this.forcedLogOff)this.statusMsg(lm.PLEASE_LOGIN_SHORT);else if(this.conn&&this.conn.error&&!this.conn.isConnected()&&this.connect(),this.hasIdReceived||e)50<this.pingCount++||d.exec(function(){this.sendSimple(CB.SockMsgId.QUERY_SERVERALIVE);b||this.logIntoChat("Testing Connection to Server");this.pingStart=CB.getTick();this.pingTimer.isActive()||this.pingTimer.runOnce(c||6E3);this.silentServerPing=
b;this.periodicPingTimer.runPeriodic(this.pingServerPeriodMS)}.bind(this),500)};c.prototype.onServerPingTimeout=function(){this.isSilent()||this.statusMsg(lm.RECONNECT);this.connect()};c.prototype.periodicPingHandler=function(){var b=this.conn.weAreAliveTicker.getExpiredMS();if(b>this.getMaxConnSilenceMS()&&(this.pingServer(!0,this.getConnTimeOutMS(),!0),b>this.getMaxConnSilenceMS()+this.periodicPingTimer.getTimeoutMs()))this.onServerNotAlive(b)};c.prototype.onServerNotAlive=function(b){};c.prototype.getConnTimeOutMS=
function(){return 6E3};c.prototype.getMaxConnSilenceMS=function(){return 2E4};c.prototype.handleServerIsAlive=function(b){b=CB.getTick()-this.pingStart;this.nMyLagMS=b/2;if(!this.silentServerPing){this.logIntoChat("Ping="+b+"ms");if(V15.chessAudio)V15.chessAudio.onPing();this.isSilent()||this.statusMsg("Server OK")}if(this.onServerAlive)this.onServerAlive(b);this.pingTimer.stop();this.pingCount=0};c.prototype.handleAreYouAlive=function(){this.sendSimple(CB.SockMsgId.IAMALIVE)};c.prototype.pingPlayer=
function(b){this.sendSimple(CB.SockMsgId.CLIENTPING,b);this.pingStart=CB.getTick()};c.prototype.pingPlayerByName=function(b){var d=new CB.WebSockMessage(CB.SockMsgId.PING_BY_NAME);d.address(this.conn.connectId,CB.ConnectId.SERVER);d.buf.V5(b);this.send(d);this.pingStart=CB.getTick()};c.prototype.handleRespondPingByName=function(b){b.getBuf().V6(200);b.getBuf().readInt()};c.prototype.handleForceLogoff=function(b){this.conn.tryTimer.stop();var d="Possibly for maintenance.";switch(b.getBuf().V10()){case CB.Server.LogOffReason.ADMIN_ACTION:d=
"Administrator action.";break;case CB.Server.LogOffReason.MAINTENANCE:d="Planned server maintenance in progress.";break;case CB.Server.LogOffReason.DOUBLE_LOGIN:d="Double Login.";break;case CB.Server.LogOffReason.IDLE_CLIENT:d="User inactive."}V15.config.silentServers||this.displayForceLogOffMsg(d);this.forcedLogOff=!0;this.onLogOff()};c.prototype.displayForceLogOffMsg=function(b){this.statusMsg("Server logged you off: "+b,"LogForceLogOff")};c.prototype.notifyUserActivity=function(){};c.prototype.getNId=
function(){return this.conn.connectId};c.prototype.getNIdBound=function(){return void 0!==this.idBound?this.idBound:0};c.prototype.isGuest=function(){return this.client?this.client.isGuest():this.loginMode==CB.LoginMode.NORMAL&&this.hasIdReceived?!1:!0};c.prototype.isPremium=function(){return this.isGuest?!1:this.client.isPremium()};c.prototype.signalOnConnect=function(){};c.prototype.onConnect=function(){this.signalOnConnect();this.reconnectBaseTime=5E3;this.pingTimer.stop();this.loginMode!=CB.LoginMode.NORMAL||
V15.forceGuestLogon()?this.logonGuest():this.logon()};c.prototype.idReceived=function(b){CB.LOG(this.name+" - idReceived: "+b.nId,"","conn");this.hasIdReceived=!0;this.Va=0;this.timerReconnect.stop();this.isFirstConn=!1;this.Vl=b.Vl;b.strToken&&!V15.Vf.loginToken&&(V15.Vf.loginToken=b.strToken,V15.Vf.rememberLoginToken());b.strUserId&&"guest"!=b.strUserId.toLowerCase()&&(this.user=CB.strUtil.decodeUTF8(b.strUserId),V15.Vf.userName=this.user,this.utf8User=b.strUserId,this.loginMode==CB.LoginMode.NORMAL&&
CB.DOM.setCodedCookie("AccountBackName64",this.user));this.onIdReceived(b);if(V15.panelMgr.onLoggedIn)V15.panelMgr.onLoggedIn(this.loginMode==CB.LoginMode.NORMAL);this.bufferedMsgs.forEach(function(b){this.send(b)}.bind(this));this.bufferedMsgs=[]};c.prototype.onIdReceived=function(){};c.prototype.handleReceivedByConnector=function(b){var d=!0;switch(b.getType()){default:d=!1;break;case CB.SockMsgId.ALIVE:this.handleAreYouAlive(b);break;case CB.SockMsgId.BINDERTIMEOUT:this.handleBinderTimeout();break;
case CB.SockMsgId.INVALID_PASSWORD:case CB.SockMsgId.INVALIDPASSWORD:this.handleInvalidPassword();break;case CB.SockMsgId.ACCOUNT_LOCKOUT:this.handleAccountLockout();break;case CB.SockMsgId.ALREADYLOGGEDON:this.onAlreadyLoggedOn();break;case CB.SockMsgId.LOGIN_OTHER_MACHINE:this.onLoginOtherMachine();break;case CB.SockMsgId.KICKEDOUT_OTHER_MACHINE:this.onKickedOutOtherMachine();break;case CB.SockMsgId.SERVER_IS_ALIVE:this.handleServerIsAlive(b);break;case CB.SockMsgId.CLIENTPING:this.handleClientPing(b);
break;case CB.SockMsgId.CLIENTECHO:this.handleClientEcho(b);break;case CB.SockMsgId.RESPOND_PING_BY_NAME:this.handleRespondPingByName(b);break;case CB.SockMsgId.FORCE_LOGOFF:this.handleForceLogoff(b);break;case CB.SockMsgId.YOUR_LOGINTOKEN:this.handleLoginToken(b);case CB.SockMsgId.IDLE_CLIENT_LOGOFF:}return d};c.prototype.handleInvalidPassword=function(){this.statusMsg("Sorry, your account '"+this.user+"' or your password is not valid.","LogError");this.hasIdReceived=!1;this.clearLoginCookies();
this.pingTimer.stop();this.periodicPingTimer.stop();if(this.onInvalidPassword)this.onInvalidPassword();else alert("Sorry, your password is not valid")};c.prototype.handleAccountLockout=function(){this.statusMsg("Sorry, your account is currently locked. Please wait one hour...","LogError");this.hasIdReceived=!1;this.clearLoginCookies();alert("Account currently locked.")};c.prototype.handleLoginToken=function(b){var d=b.getBuf().V10(),c=b.getBuf().V6(200);this.token=c;this.Vl=b.getBuf().V10();b=b.getBuf().V6(200);
CB.LOG("nBoundId="+d+", token="+c+", account="+this.Vl,"LogBlue","conn");V15.Vf.loginToken=c;b&&(this.user=V15.Vf.userName=CB.strUtil.decodeUTF8(b),this.utf8User=b);V15.Vf.rememberLoginToken();CB.DOM.setCookie("AccountMode","1");if(this.onLoginToken)this.onLoginToken(c)};c.prototype.onAlreadyLoggedOn=function(){this.statusMsg("Already logged on: "+this.user+". Please log off or wait a few minutes.","LogBold");alert("Already logged on: "+this.user);CB.ToolButtons&&CB.ToolButtons.hideBusyMask()};c.prototype.onKickedOutOtherMachine=
function(){CB.ToolButtons&&CB.ToolButtons.hideBusyMask()};c.prototype.onLoginOtherMachine=function(){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();this.timerReconnect.stop();this.periodicPingTimer.stop()};c.prototype.manageAccount=function(){this.hasIdReceived&&(this.logOff(),window.location.replace(V15.getManageAccountUrl()+"?user="+V15.Vf.userCoded+"&token="+V15.Vf.loginToken))};c.prototype.isSilent=function(){return!0};c.prototype.logIntoChat=function(b,d,c){this.isSilent()||(void 0===d&&(d="LogIntoChat"),
V15.panelMgr.chatOut&&b&&V15.panelMgr.chatOut(b.toString(),d,c))};c.prototype.statusMsg=function(b,d,c){V15.panelMgr.statusMsg?V15.panelMgr.statusMsg(b):this.logIntoChat(b,d,c)};c.prototype.handleClientPing=function(b){this.sendSimple(CB.SockMsgId.CLIENTECHO,b.Vj())};c.prototype.handleClientEcho=function(b){var d=CB.getTick()-this.pingStart;this.logClientEcho&&this.logIntoChat("Ping "+this.lists.clientNameMap[b.Vj()]+"="+d+"ms");this.pingTimer.stop();this.fnOnClientEcho&&b.Vj()!=this.getNIdBound()&&
this.fnOnClientEcho(b.Vj());return d};c.prototype.handleContinuousSelfEcho=function(b){};var e={};c.prototype.sendSimple=function(b,d){e=new CB.WebSockMessage(b);var c=d;c||(c=CB.ConnectId.SERVER);e.address(this.getNId(),c);this.send(e)};c.prototype.send=function(b,d){if(!this.forcedLogOff&&!this.userLoggedOff)try{0==b.Vj()&&b.Vm(this.getNId()),0==b.getIdReceiver()&&b.setIdReceiver(CB.ConnectId.SERVER),this.conn.sendMessage(b,!this.hasSockMsgIds()),this.conn.error&&this.statusMsg(this.name+" not connected...",
"LogCAPError"),this.conn.error&&d&&this.bufferedMsgs.push(b),this.conn.isConnected()||this.initiateReconnect()}catch(c){CB.LOG(c.toString()),this.initiateReconnect()}};c.prototype.sendNoId=function(b){try{0==b.Vj()&&b.Vm(this.getNId()),0==b.getIdReceiver()&&b.setIdReceiver(CB.ConnectId.SERVER),this.conn.sendMessage(b,!0),this.conn.isConnected()||this.initiateReconnect()}catch(d){CB.LOG(d.toString()),this.initiateReconnect()}};c.prototype.initiateReconnect=function(){if(!this.timerReconnect.isActive()&&
!this.inTorture&&(CB.LOG(this.name+" initiate reconn."),this.timerReconnect.runOnce(Math.min(6E4,this.reconnectBaseTime+1E3*this.Va),function(){this.pingServer(!0)}.bind(this)),this.Va++,3==this.Va))this.onDisconnectAlarm()};c.prototype.onDisconnectAlarm=function(){};return c}();"use strict";
CB.CloudDatabase=function(){var c=function(b,d,c){this.cloudId=b;this.manager=this.cloudManager=c;this.nGames=d;this.resetCaches();this.idHeaderListener=this.cloudManager.addOnHeadersChangedListener(this.onHeadersChanged.bind(this));this.idGameListener=this.cloudManager.addOnGameChangedListener(this.onGameChanged.bind(this));this.idGameNosListener=this.cloudManager.addOnGamesChangedByGameNoListener(this.onChangedByGameNo.bind(this));this.idHeaderNosListener=this.cloudManager.addOnHeadersChangedByGameNoListener(this.onChangedByGameNo.bind(this));
this.idGameAppendedListener=this.cloudManager.addOnGameAppendedListener(this.onGameAppended.bind(this));this.idChangeLoginListener=this.cloudManager.addOnChangeLoginListener(this.onChangeLogin.bind(this));this.idReorganizedListener=this.cloudManager.addOnReorganizedListener(this.onReorganized.bind(this));this.idDeletedListener=this.cloudManager.addOnDeletedListener(this.onDeleted.bind(this));this.dbItem=this.cloudManager.getCloudDBItem(this.cloudId);CB.LOG("Created: "+this,"LogGreen")};CB.inherit(c,
CB.Database);c.prototype.destroy=function(){CB.LOG("Destroy: "+this,"LogRed");this.cloudManager.removeOnHeadersChangedListener(this.idHeaderListener);this.cloudManager.removeOnGameChangedListener(this.idGameListener);this.cloudManager.removeOnGamesChangedByGameNoListener(this.idGameNosListener);this.cloudManager.removeOnHeadersChangedByGameNoListener(this.idHeaderNosListener);this.cloudManager.removeOnGameAppendedListener(this.idGameAppendedListener);this.cloudManager.removeOnChangeLoginListener(this.idChangeLoginListener);
this.cloudManager.removeOnReorganizedListener(this.idReorganizedListener);this.cloudManager.removeOnDeletedListener(this.idDeletedListener);this.requestedHeaderNums=[]};c.prototype.toString=function(){return this.dbItem.title+"/"+this.cloudId};c.prototype.isLoadFromFile=function(){return!1};c.prototype.canSaveTo=function(){return!0};c.prototype.shouldShowLastGame=function(){return this.dbItem&&this.dbItem.type==CB.CloudDBType.CLIPBOARD};c.prototype.setupListeners=function(b){void 0===b.idHeaderListener&&
(b.idHeaderListener=this.addOnGameHeadersChangedListener(b.onGameHeadersChanged.bind(b)));void 0===b.idDBLengthListener&&(b.idDBLengthListener=this.addOnDBLengthListener(b.onDBLengthListener.bind(b)));void 0===b.idDBDeletedListener&&(b.idDBDeletedListener=this.addOnDBDeletedListener(b.onDBDeletedListener.bind(b)));b.removeListeners=function(){this.removeOnGameHeadersChangedListener(b.idHeaderListener);this.removeOnDBLengthListener(b.idDBLengthListener);this.removeOnDBDeletedListener(b.idDBDeletedListener);
delete b.idHeaderListener;delete b.idDBLengthListener;delete b.idDBDeletedListener}.bind(this)};c.prototype.resetCaches=function(){this.headers=[];this.requestedHeaderNums=[];this.pendingHeaderJobs=[];this.pendingGameJobs=[]};c.prototype.getGameCount=function(){return this.nGames};c.prototype.setSubSet=function(b){this.superClass.setSubSet.call(this,b);this.fireOnDBLength(this.getSetSize())};c.prototype.clearSubSet=function(){this.superClass.clearSubSet.call(this,arguments);this.fireOnDBLength(this.getGameCount())};
c.prototype.getCopySrcId=function(){return this.cloudId};c.prototype.getDisplayTitle=function(){return"Cloud: "+CB.strUtil.decodeUTF8(this.dbItem.owner+" - "+this.dbItem.title)};c.prototype.getHeaderJson=function(b){if(1>b||b>this.nGames)ASSERT(0);else{var d;void 0===this.headers[b]?(this.requestedHeaderNums[b]||(this.requestedHeaderNums[b]=1,this.cloudManager.loadHeader(this.cloudId,b)),d=new CB.GameHeader,this.fillPlaceHolderHeader(d,b),d.nGame=b,this.headers[b]=d,void 0===this.headers[b].loadCnt?
this.headers[b].loadCnt=0:this.headers[b].loadCnt++):d=this.headers[b];return d.toJson()}};c.prototype.loadHeadersJsonAsync=function(b,d,c){c>this.getSetSize()&&(c=this.getSetSize());if(this.checkPendingHeaderJob(d,c))CB.LOG("Job already underway: "+d+"-"+c);else{CB.LOG("Cl-Load Hdrs Async: "+d+" - "+c);var f=this;b={first:d,last:c,jsons:[],callback:b,count:0,calls:1,complete:function(){return this.count==this.last-this.first+1},addHeader:function(b){var d=f.getSetInxOfGameNo(b.nGame);d>=this.first&&
d<=this.last&&!this.jsons[d-this.first]&&(this.jsons[d-this.first]=b.toJson(),this.count++)},timeOut:function(){for(var b=0;b<this.last-this.first+1;b++)if(!this.jsons[b]){var d=new CB.GameHeader;f.fillPlaceHolderHeader(d,f.getGameNoInSet(b+1));this.jsons[b]=d.toJson()}try{for(b=0;b<this.calls;b++)this.callback(this.jsons)}catch(c){CB.LOG("JobTimeOutException: "+c,"LogException")}this.timeout=!0}};this.pendingHeaderJobs.push(b);b.timer=new CB.Timer(b.timeOut.bind(b));for(c<d?b.timer.runOnce(100):
b.timer.runOnce(1E4);d<=c&&d<=this.getSetSize();d++)if(b=this.getGameNoInSet(d)){if(!this.requestedHeaderNums[b]&&(this.requestedHeaderNums[b]=1,this.cloudManager.loadHeader(this.cloudId,b),void 0===this.headers[b])){var g=new CB.GameHeader;this.fillPlaceHolderHeader(g);g.nGame=b;this.headers[b]=g}this.headers[b].loadCnt=0}}};c.prototype.checkPendingHeaderJob=function(b,d){for(var c=0;c<this.pendingHeaderJobs.length;c++){var f=this.pendingHeaderJobs[c];if(f&&f.first<=b&&f.last>=d&&!f.timeout)return this.pendingHeaderJobs[c].calls++,
!0}return!1};c.prototype.onHeadersChanged=function(b){for(var d=0;d<b.length;d++)b[d].header.loadCnt=void 0!==this.headers[b[d].nGame]?++this.headers[b[d].nGame].loadCnt:0,this.headers[b[d].nGame]=b[d].header,this.requestedHeaderNums[b[d].nGame]=0;for(var c=0;c<this.pendingHeaderJobs.length;c++)if(this.pendingHeaderJobs[c])for(d=0;d<b.length;d++)this.pendingHeaderJobs[c].addHeader(b[d].header);for(c=0;c<this.pendingHeaderJobs.length;c++)if(this.pendingHeaderJobs[c]&&this.pendingHeaderJobs[c].complete()){d=
this.pendingHeaderJobs[c];CB.LOG("Complete Job: "+d.first+" - "+d.last);this.pendingHeaderJobs[c].timer.stop();try{for(var f=0;f<d.calls;f++)this.pendingHeaderJobs[c].callback(this.pendingHeaderJobs[c].jsons)}catch(g){CB.LOG("PendingJ: "+g,"LogException")}CB.LOG("Complete J after callback: "+d.first+" - "+d.last);delete this.pendingHeaderJobs[c]}d=!1;for(c=0;d&&c<this.pendingHeaderJobs.length;c++)this.pendingHeaderJobs[c]&&this.pendingHeaderJobs[c].timeout&&(d=!1);d&&(this.pendingHeaderJobs=[]);this.fireOnGameHeadersChanged(b)};
c.prototype.fillPlaceHolderHeader=function(b,d){b.white=new CB.PlayerData("Waiting for Server...");b.loadCnt=0;b.nGame=d};c.prototype.getGame=function(b){return new CB.Game};c.prototype.loadGameAsync=function(b,d){if(!(d>this.getGameCount())){CB.LOG("Cloud Game: "+d);var c=this,f={gameNo:d,game:new CB.Game,callback:b,loaded:!1,setGame:function(b){b.getGameNo()==d&&(this.game=b,this.loaded=!0)},timeOut:function(){for(var b=0;b<this.last-this.first+1;b++)if(!this.jsons[b]){var d=new CB.GameHeader;c.fillPlaceHolderHeader(d);
this.game.setHeader(d);this.loaded=!0}CB.LOG("Timeout Job: "+this.first+" - "+this.last);this.callback(this.game);this.timeout=!0}};f.timer=new CB.Timer(f.timeOut.bind(f));f.timer.runOnce(1E4);this.pendingGameJobs.push(f);this.cloudManager.loadGame(this.cloudId,d)}};c.prototype.onGameChanged=function(b){if(b.cloudId==this.cloudId){for(var d=0;d<this.pendingGameJobs.length;d++)this.pendingGameJobs[d]&&this.pendingGameJobs[d].setGame(b.game);for(d=0;d<this.pendingGameJobs.length;d++)this.pendingGameJobs[d]&&
this.pendingGameJobs[d].loaded&&(CB.LOG("Complete Game Job"),this.pendingGameJobs[d].timer.stop(),this.pendingGameJobs[d].callback(this.pendingGameJobs[d].game),delete this.pendingGameJobs[d]);CB.LOG("...CloudDB OnGameChanged");this.reorgJobs(this.pendingGameJobs)}};c.prototype.onChangedByGameNo=function(b){if(b.cloudId==this.cloudId){for(var d=this.nGames,c=0;c<b.gameNos.length;c++)b.gameNos[c]>this.nGames&&(this.nGames=b.gameNos[c]);this.nGames>d&&this.clearSubSet();for(c=0;c<b.gameNos.length;c++)b.gameNos[c]<=
this.nGames&&this.cloudManager.loadHeader(this.cloudId,b.gameNos[c])}};c.prototype.onGameAppended=function(b){b.cloudId==this.cloudId&&(this.nGames++,this.requestedHeaderNums=[],this.clearSubSet())};c.prototype.onChangeLogin=function(){this.fireOnDBDeleted()};c.prototype.onReorganized=function(b){b.cloudId==this.cloudId&&(this.nGames=b.nNewLen,this.requestedHeaderNums=[],0<this.filterText.length&&this.setFilter(this.filterText),this.fireOnDBLength(this.nGames))};c.prototype.onDeleted=function(b){b.cloudId==
this.cloudId&&this.fireOnDBDeleted()};c.prototype.toggleDeleteMark=function(b){if(this.headers[b]){var d=!this.headers[b].deleted;this.headers[b].setDeleted(d);void 0===this.headers[b].loadCnt?this.headers[b].loadCnt=0:this.headers[b].loadCnt++;var c=new CB.Server.HeaderResponse(this.cloudId,b,0,this.headers[b]);this.fireOnGameHeadersChanged([c]);this.cloudManager.sendMarkAsDeleted(this.cloudId,[b],[d])}};c.prototype.toggleDeleteMarks=function(b){for(var d=[],c=[],f=0;f<b.length;f++){var g=b[f];if(this.headers[g]){var h=
!this.headers[g].deleted;this.headers[g].setDeleted(h);void 0===this.headers[g].loadCnt?this.headers[g].loadCnt=0:this.headers[g].loadCnt++;var l=new CB.Server.HeaderResponse(this.cloudId,g,0,this.headers[g]);this.fireOnGameHeadersChanged([l]);d.push(g);c.push(h)}}this.cloudManager.sendMarkAsDeleted(this.cloudId,d,c)};c.prototype.removeDeletedGames=function(){this.resetCaches();this.cloudManager.reorgOnServer(this.cloudId)};c.prototype.reorgJobs=function(b){for(var d=!0,c=0;d&&c<b.length;c++)b[c]&&
b[c].timeout&&(d=!1)};c.prototype.importGames=function(b,d){if("number"==typeof b)this.cloudManager.copyGamesTo(b,this.cloudId,d);else if("function"==typeof b){var c=b(d);this.cloudManager.saveGames(this.cloudId,c)}};Ve.initForListeners(c);Ve.addEvent(c,"GameHeadersChanged");Ve.addEvent(c,"DBLength");Ve.addEvent(c,"DBDeleted");return c}();"use strict";CB.CloudDBType={NONE:0,REP_WHITE:1,REP_BLACK:2,OWN_GAMES:3,PLAYCHESS:4,TACTICTRAINING:5,OPENINGS_BACKUP:6,TRAININGPOSITIONS:7,AGAINSTFRITZ:8,CLIPBOARD:9};
CB.CloudDBItem=function(){var c=function(){this.propFlags.CLOUDDBITEM_ALLRIGHTS=this.propFlags.CLOUDDBITEM_MAY_VIEW|this.propFlags.CLOUDDBITEM_MAY_LOAD|this.propFlags.CLOUDDBITEM_MAY_SAVE|this.propFlags.CLOUDDBITEM_MAY_ADMIN|this.propFlags.CLOUDDBITEM_OWNER};c.prototype.propFlags={CLOUDDBITEM_SHARED:1,CLOUDDBITEM_MAY_VIEW:131072,CLOUDDBITEM_MAY_LOAD:262144,CLOUDDBITEM_MAY_SAVE:524288,CLOUDDBITEM_MAY_ADMIN:1048576,CLOUDDBITEM_OWNER:2097152};c.prototype.fromDataBuf=function(b){b.beginSizedRead();this.name=
b.V6(100);this.title=b.V6(200);this.owner=b.V6(100);this.nGames=b.V10();this.dateAccessed=b.Vs();this.nUsage=b.V10();this.cloudId=b.readUint64();this.allFileSize=b.Vy();this.dateCreated=b.Vs();this.flags=b.V10();this.type=b.V10();b.endSizedRead()};c.prototype.toString=function(){return this.name+", "+this.title+", "+this.owner+", nGames="+this.nGames+", type="+this.type};c.DBNAME_EXISTS=-1;c.QUOTA_EXCEEDED=-2;c.TOO_MANY_DATABASES=-3;c.CREATE_DB_OK=0;c.TYPE_AGAINSTFRITZ=8;return c}();
CB.CloudDBItemList=function(){var c=function(){this.items=[]};c.prototype.size=function(){return this.items.length};c.prototype.fromDataBuf=function(b){this.items=[];for(var d=b.Vw(),c=0;c<d&&200>c;c++){var f=new CB.CloudDBItem;f.fromDataBuf(b);this.items.push(f)}};c.prototype.getById=function(b){for(var d=0;d<this.items.length;d++)if(this.items[d].cloudId==b)return this.items[d]};c.prototype.getIdByType=function(b){for(var d=0;d<this.items.length;d++)if(this.items[d].type==b)return this.items[d].cloudId;
return 0};c.prototype.removeById=function(b){for(var d=0;d<this.items.length;d++)if(this.items[d].cloudId==b){this.items.splice(d,1);break}};c.prototype.containsName=function(b){for(var d=0;d<this.items.length;d++)if(this.items[d].name.toLowerCase()==b.toLowerCase())return!0;return!1};return c}();CB.CloudGame=function(){var c=function(b){this.game=b;this.time=new CB.DateAndTime(0)};c.prototype.Vz=function(b){this.game.hdr.compactToDataBuf(b);b.Vx(0);this.game.writeGameOnly2(b);this.time.Vz(b)};return c}();
"use strict";CB.namespace("CB.Server.HeaderRequest");
CB.Server.HeaderRequest=function(){var c=function(b,d,c){this.cloudId=b;this.nGame=d;this.dateAndTime=c};c.prototype.fromDataBuf=function(b){b.beginSizedRead();this.cloudId=b.Vw();b.Vw();this.nGame=b.V10();this.dateAndTime=new CB.DateAndTime;this.dateAndTime.fromDataBuf(b);b.endSizedRead()};c.prototype.Vz=function(b){b.beginSizedWrite();b.Vh(this.cloudId);b.Vh(0);b.Vx(this.nGame);void 0===this.dateAndTime&&(this.dateAndTime=new CB.DateAndTime(0));this.dateAndTime.Vz(b);b.endSizedWrite()};c.prototype.setEquals=
function(b){return this.cloudId==b.cloudId&&this.nGame==b.nGame&&this.dateAndTime==b.dateAndTime};c.prototype.setGreater=function(b){return this.cloudId==b.cloudId?this.nGame==b.nGame?this.dateAndTime>b.dateAndTime:this.nGame>b.nGame:this.cloudId>b.cloudId};return c}();CB.Server.HeaderResponseType={HEADER:0,REQUEST_GAME:1,UPTODATE:2,NOT_AVAILABLE:3};
CB.Server.HeaderResponse=function(){var c=function(b,d,c,f){this.cloudId=b;this.nGame=d;this.eType=c;this.header=f};c.prototype.fromDataBuf=function(b){b.beginSizedRead();this.cloudId=b.V10();this.nGame=b.V10();this.eType=b.V10();switch(this.eType){case CB.Server.HeaderResponseType.HEADER:this.header=new CB.GameHeader,this.header.compactFromDataBuf(b),(new CB.DateAndTime).fromDataBuf(b)}b.endSizedRead()};return c}();"use strict";CB.namespace("CB.Server.CloudManager");
CB.CloudUserMsgId={NONE:0,REQUEST_DATABASES:1600,RESPOND_DATABASES:1601,REQUEST_MULTIPLE_HEADERS:1602,RESPOND_MULTIPLE_HEADERS:1603,CLIENTREQUEST_GAME:1604,SERVERRESPOND_GAME:1605,APPEND_GAME:1606,NOTIFY_HEADER_CHANGED:1607,NOTIFY_GAME_CHANGED:1608,NOTIFY_DB_REORGANIZED:1609,NOTIFY_DB_DELETED:1610,DISK_USED:1611,INC_USAGE:1612,CONFIRM_GAME:1613,RENAME_TITLE_TO_CLIENT:1614,CONFIRM_MULTIPLE_HEADERS:1615,CREATE_CLOUD_DB:1616,CLOUD_DB_CREATED:1617,DELETE_CLOUD_DB:1618,CLOUDDB_DELETE_FINISHED:1619,SET_DELETE_MARK:1620,
REORG_CLOUD_DB:1621,CLOUDDB_REORG_FINISHED:1622,COPY_GAMES_TO:1623,NOTIFY_COPY_DONE:1624,COPY_GAMES_FINISHED:1625,SEARCH_GAMES:1626,SEARCH_RESULT:1627,GAMES_TO_SERVER:1628,CONFIRM_GAMES_TO_SERVER:1629,STORE_POS_AND_MOVES:1630,CHECK_POS_AND_MOVES:1631,RESPOND_POS_AND_MOVES:1632,REMOVE_FROM_MYMOVES:1633,LOAD_MY_MOVES:1634,RESPOND_ALL_MYMOVES:1635,REMOVE_WHOLE_TREE:1636,RESPOND_TREE_REMOVED:1637,MAKE_MAIN_MOVEORDER:1638,STORE_EVAL:1639,UPLOAD_GAME:1640,STORE_TEXT:1641,NOTIFY_PLAYED:1642,START_DRILL:1643,
UNLEARN_WHOLE_TREE:1644,RESPOND_TREE_UNLEARNED:1645,RESPOND_COUNT_MYMOVES:1647,NOTIFY_MYMOVES_CHANGED:1648,STOP_DRILL:1649,SAVE_TO_CLIPBOARD:1650,SERVER_REQUESTGAME:1656,toString:function(c){for(var b in this)if(this[b]==c)return b;return"Unknown CloudUserMsgId: "+c},toNumString:function(c){return"CloudId="+c}};CB.PosAndMoveFlags={MY_BLACK:1,MY_WHITE:2,MOVE_WHITE:4,MOVE_BLACK:8,REP_IMPORTANT:16,REP_EXCLUDE:32,WITH_TEXT:64,DRILLED:128,DELETED:256,WHITE:6,BLACK:9,MOVE:12,MYMOVE:3};
CB.Server.CloudManager=function(){var c=function(){this.setRequestedHeaders=new CB.Set;this.timerSend=new CB.Timer;this.selectedCloudId=0;this.mapDBs={};this.headerResponseReceiver=new CB.VectorSender(function(b){this.send(b)}.bind(this));this.gameSender=new CB.VectorSender(function(b){this.send(b)}.bind(this));this.autoOpenDB=!1;this.lastMyMovesLoadMode=this.myMovesLoadMode=CB.GetMovesType.NONE;this.name="cloud"};CB.inherit(c,CB.Server.Connector);c.prototype.createLobby=function(b,c,f,g,h){this.create(b,
c,f,g,h)};c.prototype.getName=function(){return"CloudMgr"};c.prototype.onChangeLogin=function(){this.fireOnChangeLogin();this.closeAllDatabases();V15.setLoggedIn(this.isLoggedIn())};c.prototype.onLoginToken=function(){this.logIntoChat("Connected to CloudServer","","conn");this.boundLoginOk=!0;V15.shouldRequestCloudDBsOnLogin()?this.requestDatabases():CB.ToolButtons&&CB.ToolButtons.hideBusyMask();this.loginMode!=CB.LoginMode.GUEST&&(V15.setLoggedIn(!0),V15.panelMgr.getKernel()&&this.checkPosAndMoves(V15.panelMgr.getKernel().getCurPos()),
V15.config.silentCloud||V15.panelMgr.showMessage(String.formatEx(lm.LOGIN_WELCOME,this.user),2E3));V15.showAccountType(this.Vl);V15.panelMgr.study&&0==V15.panelMgr.savedStudyToCloud&&(V15.panelMgr.gameKernel.Vk.saveToCloud(V15.panelMgr.study),V15.panelMgr.savedStudyToCloud=!0)};c.prototype.onIdReceived=function(){!V15.config.silentCloud&&CB.ToolButtons&&CB.ToolButtons.showBusyMask("Requesting databases ... ",null,5E3)};c.prototype.onLogOff=function(){this.superClass.onLogOff.apply(this,arguments)};
c.prototype.logIntoChat=function(b,c,f){5};c.prototype.testYesNo=function(b){CB.LOG("YesNo="+b)};c.prototype.test=function(){};c.prototype.handleReceived=function(b){if(!this.handleReceivedByConnector(b))try{switch(b.getType()){default:TRACE("Unhandled: "+b.toString());break;case CB.SockMsgId.DEFAULTGROUPS:this.logIntoChat("Connected to CloudServer");this.boundLoginOk=!0;alert("Default Groups not expected...");break;case CB.SockMsgId.CLOUD_USER:this.handleCloudMsg(b);break;case CB.SockMsgId.INVALIDPASSWORD:this.clearLoginCookies()}}catch(c){b=
CB.SockMsgId.toNumString(b.getType()),CB.LogException(b,c)}};c.prototype.handleChat=function(b){V15.panelMgr.chatOut(chat.toString())};c.prototype.isLoggedIn=function(){return this.boundLoginOk&&this.isConnected()};c.prototype.handleCloudMsg=function(b){try{switch(b.getUserType()){default:TRACE("Unhandled Cloud Msg: "+b.toString());break;case CB.CloudUserMsgId.RESPOND_DATABASES:this.handleRespondDatabases(b);break;case CB.CloudUserMsgId.RESPOND_MULTIPLE_HEADERS:this.handleRespondMultipleHeaders(b);
break;case CB.CloudUserMsgId.SERVERRESPOND_GAME:this.handleServerRespondGame(b);break;case CB.CloudUserMsgId.NOTIFY_GAME_CHANGED:this.handleGamesChanged(b);break;case CB.CloudUserMsgId.NOTIFY_HEADER_CHANGED:this.handleHeaderChanged(b);break;case CB.CloudUserMsgId.NOTIFY_DB_REORGANIZED:case CB.CloudUserMsgId.NOTIFY_COPY_DONE:this.handleNotifyDBReorganized(b);break;case CB.CloudUserMsgId.COPY_GAMES_FINISHED:this.handleCopyGamesFinished(b);break;case CB.CloudUserMsgId.NOTIFY_DB_DELETED:this.handleDBDeleted(b);
break;case CB.CloudUserMsgId.DISK_USED:this.handleDiskUsed(b);break;case CB.CloudUserMsgId.CONFIRM_GAME:break;case CB.CloudUserMsgId.CONFIRM_GAMES_TO_SERVER:this.handleConfirmGamesToServer(b);break;case CB.CloudUserMsgId.RENAME_TITLE_TO_CLIENT:this.handleRenameTitle(b);break;case CB.CloudUserMsgId.CLOUD_DB_CREATED:this.handleDBCreated(b);break;case CB.CloudUserMsgId.CLOUDDB_DELETE_FINISHED:this.deletionFinished(b);break;case CB.CloudUserMsgId.CLOUDDB_REORG_FINISHED:this.reorgFinished(b);break;case CB.CloudUserMsgId.SEARCH_RESULT:this.searchResult(b);
break;case CB.CloudUserMsgId.RESPOND_POS_AND_MOVES:this.respondPosAndMoves(b);break;case CB.CloudUserMsgId.RESPOND_ALL_MYMOVES:this.respondAllMyMoves(b);break;case CB.CloudUserMsgId.RESPOND_TREE_REMOVED:this.respondTreeRemoved(b);break;case CB.CloudUserMsgId.RESPOND_TREE_UNLEARNED:this.respondTreeUnlearned(b);break;case CB.CloudUserMsgId.RESPOND_COUNT_MYMOVES:this.respondCountMyMoves(b);break;case CB.CloudUserMsgId.NOTIFY_MYMOVES_CHANGED:this.notifyMyMovesChanged(b);case CB.CloudUserMsgId.SERVER_REQUESTGAME:}}catch(c){b=
CB.CloudUserMsgId.toNumString(b.getUserType()),CB.LogException(b,c)}};c.prototype.handleReconnectOk=function(b){};c.prototype.requestDatabases=function(){var b=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);b.setUserType(CB.CloudUserMsgId.REQUEST_DATABASES);var c=this.user;this.loginMode==CB.LoginMode.GUEST&&(c="Guest");b.getBuf().V5(c);b.getBuf().Vx(CB.System.getWindowsCodePage());this.send(b)};c.prototype.handleRespondDatabases=function(b){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();this.cloudDBItemList=
new CB.CloudDBItemList;this.cloudDBItemList.fromDataBuf(b.getBuf());var c=b.getBuf().Vw(),f=b.getBuf().Vw(),g=b.getBuf().Vw(),h=b.getBuf().Vw();b.getBuf().Vw();this.logIntoChat("Received Databases... qKB="+c+", siz= "+f+", maxDB="+g+", lastDBId="+h);V15.config.silentCloud||(0!=h&&this.autoOpenDB?this.cloudDatabaseSelected(h,!0):V15.panelMgr.openDatabasePanel&&V15.panelMgr.selectCloudDatabase(this.user,this.cloudDBItemList,this.cloudDatabaseSelected.bind(this)));this.autoOpenDB=!1};c.prototype.getCloudDBItem=
function(b){return this.cloudDBItemList.getById(b)};c.prototype.cloudDatabaseSelected=function(b,c){if(0<=b){this.selectedCloudId&&this.endUse(this.selectedCloudId);var f=this.cloudDBItemList.getById(b);if(f){var g=this.openCloudDatabase(f);V15.panelMgr.showDatabase(g);if(c&&("Clipboard"==f.name||"CloudClip"==f.name)&&V15.panelMgr.gameKernel)V15.panelMgr.gameKernel.onDBGameClicked(g,g.nGames);this.callAfterDBSelected&&((new CB.Timer(this.callAfterDBSelected)).runOnce(100),this.callAfterDBSelected=
null)}this.selectedCloudId=b;this.incDBUsage(b)}else this.selectedCloudId=0};c.prototype.setCallAfterDBSelected=function(b){this.callAfterDBSelected=b};c.prototype.openCloudDatabaseById=function(b){if(b=this.cloudDBItemList.getById(b))return this.openCloudDatabase(b)};c.prototype.openCloudDatabase=function(b){if(void 0!==this.mapDBs[b.cloudId])return this.beginUse(this.mapDBs[b.cloudId]),this.mapDBs[b.cloudId];b=new CB.CloudDatabase(b.cloudId,b.nGames,this);this.beginUse(b);return b};c.prototype.beginUse=
function(b){void 0==this.mapDBs[b.cloudId]&&(this.mapDBs[b.cloudId]=b);this.mapDBs[b.cloudId].incUsers()};c.prototype.endUse=function(b){"object"===typeof b?b=b.cloudId:ASSERT("number"===typeof b);void 0!==this.mapDBs[b]&&(this.mapDBs[b].decUsers(),0>=this.mapDBs[b].getNUsers()&&(this.mapDBs[b].destroy(),delete this.mapDBs[b]))};c.prototype.closeAllDatabases=function(){for(var b in this.mapDBs)this.mapDBs.hasOwnProperty(b)&&(this.mapDBs[b].destroy(),delete this.mapDBs[b])};c.prototype.incDBUsage=
function(b){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);c.setUserType(CB.CloudUserMsgId.INC_USAGE);c.getBuf().Vh(b);c.getBuf().Vh(0);this.send(c)};c.prototype.createDatabase=function(b){if(this.cloudDBItemList.containsName(b))alert(b+" exists.");else if(!this.isGuest()){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);c.setUserType(CB.CloudUserMsgId.CREATE_CLOUD_DB);c.getBuf().V5(b);c.getBuf().Vx(CB.System.getWindowsCodePage());V15.Vf.guid.Vz(c.getBuf());this.send(c)}};c.prototype.handleDBCreated=
function(b){var c=b.getBuf().V10();b.getBuf().Vw();b.getBuf().Vw();b.getBuf().V6(100);switch(c){case CB.CloudDBItem.DBNAME_EXISTS:alert("Name Exists");break;case CB.CloudDBItem.QUOTA_EXCEEDED:alert("Disk Space insufficient");break;case CB.CloudDBItem.TOO_MANY_DATABASES:alert("Too many databases ");break;case CB.CloudDBItem.CREATE_DB_OK:this.requestDatabases()}};c.prototype.deleteDatabase=function(){V15.panelMgr.selectCloudDatabase(this.user,this.cloudDBItemList,this.dbSelectedForDelete.bind(this))};
c.prototype.dbSelectedForDelete=function(b){if(b&&CB.Forms){var c=this.getCloudDBItem(b);if(c){var f="<strong>"+CB.strUtil.decodeUTF8(c.title)+"</strong>",f=f+("</br></br>"+c.nGames+" games"),f=f+("</br></br> Owner="+CB.strUtil.decodeUTF8(c.owner));CB.Forms.Confirm("Please confirm deletion of this database:",f,function(c){if("yes"==c||"ok"==c)c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER),c.setUserType(CB.CloudUserMsgId.DELETE_CLOUD_DB),c.getBuf().Vh(b),c.getBuf().Vh(0),this.send(c),this.bQuotaExceeded=
!1,this.fireOnDeleted({cloudId:b}),this.endUse(b),this.selectedCloudId==b&&(this.selectedCloudId=0)}.bind(this))}}};c.prototype.deletionFinished=function(b){var c=b.getBuf().Vw();b.getBuf().Vw();b.getBuf().V6(100);this.cloudDBItemList.removeById(c)};c.prototype.handleRespondMultipleHeaders=function(b){b=this.headerResponseReceiver.receiveVector(b,CB.SockMsgId.CLOUD_USER,CB.CloudUserMsgId.CONFIRM_MULTIPLE_HEADERS,function(b){var d=new CB.Server.HeaderResponse;d.fromDataBuf(b);return d});b.overhead.V14();
this.logIntoChat("Received Multiple Headers: "+b.vec.length);for(var c=[],f=0;f<b.vec.length&&1E3>f;f++){var g=b.vec[f];switch(g.eType){default:throw"URTyp";case CB.Server.HeaderResponseType.HEADER:c.push(g);case CB.Server.HeaderResponseType.UPTODATE:case CB.Server.HeaderResponseType.REQUEST_GAME:case CB.Server.HeaderResponseTyp_AVAILABLE:}}c.length&&this.fireOnHeadersChanged(c)};c.prototype.loadHeader=function(b,c,f){void 0==c&&alert("nGame");this.setRequestedHeaders.insert(new CB.Server.HeaderRequest(b,
c,f));40<this.setRequestedHeaders.size()?this.sendHeaderRequests():this.timerSend.runOnce(500,this.sendHeaderRequests.bind(this))};c.prototype.sendHeaderRequests=function(){var b=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);b.setUserType(CB.CloudUserMsgId.REQUEST_MULTIPLE_HEADERS);b.getBuf().Vx(this.setRequestedHeaders.size());for(var c=0;c<this.setRequestedHeaders.size()&&100>c;c++)this.setRequestedHeaders.getElements()[c].Vz(b.getBuf());this.send(b);this.setRequestedHeaders.clear()};c.prototype.loadGame=
function(b,c,f){f=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);f.setUserType(CB.CloudUserMsgId.CLIENTREQUEST_GAME);f.getBuf().Vh(b);f.getBuf().Vh(0);f.getBuf().Vx(c);(new CB.DateAndTime(0)).Vz(f.getBuf());this.send(f)};c.prototype.handleServerRespondGame=function(b){var c=b.getBuf().Vw();b.getBuf().Vw();var f=b.getBuf().V10();b=this.gameFromBuf(b.getBuf());b.replaceDBId=c;b.replaceGameNo=f;this.fireOnGameChanged({cloudId:c,game:b})};c.prototype.handleGamesChanged=function(b){var c=b.getBuf().Vw();
b.getBuf().Vw();for(var f=b.getBuf().V10(),g=[],h=0;h<f&&1E3>h;h++){var l=b.getBuf().V10();g.push(l)}this.fireOnGamesChangedByGameNo({cloudId:c,gameNos:g})};c.prototype.handleHeaderChanged=function(b){var c=b.getBuf().Vw();b.getBuf().Vw();for(var f=[],g=b.getBuf().V10(),h=0;h<g&&100>h;h++)f.push(b.getBuf().V10());this.fireOnHeadersChangedByGameNo({cloudId:c,gameNos:f})};c.prototype.handleNotifyDBReorganized=function(b){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();var c=b.getBuf().Vw();b.getBuf().Vw();
if(b.getBuf().V10()){b=b.getBuf().V10();var f=this.cloudDBItemList.getById(c);f&&(f.nGames=b);this.fireOnReorganized({cloudId:c,nNewLen:b})}};c.prototype.handleCopyGamesFinished=function(b){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();var c=b.getBuf().Vw();b.getBuf().Vw();b.getBuf().V6(100);b=b.getBuf().V10();this.callAfterDBSelected=null;var f=this.cloudDBItemList.getById(c);f&&(f.nGames=b);this.fireOnReorganized({cloudId:c,nNewLen:b})};c.prototype.handleDBDeleted=function(b){var c=b.getBuf().Vw();
b.getBuf().Vw();this.fireOnDeleted({cloudId:c});this.endUse(c)};c.prototype.sendMarkAsDeleted=function(b,c,f){var g=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);g.setUserType(CB.CloudUserMsgId.SET_DELETE_MARK);g.getBuf().Vh(b);g.getBuf().Vh(0);g.getBuf().Vx(c.length);for(b=0;b<c.length;b++)g.getBuf().Vx(c[b]),g.getBuf().V13(f[b]);V15.Vf.guid.Vz(g.getBuf());(new CB.DateAndTime(0)).Vz(g.getBuf());this.send(g)};c.prototype.reorgOnServer=function(b){if(!this.isGuest()){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);
c.setUserType(CB.CloudUserMsgId.REORG_CLOUD_DB);c.getBuf().Vh(b);c.getBuf().Vh(0);V15.Vf.guid.Vz(c.getBuf());this.send(c);(b=this.cloudDBItemList.getById(b))&&CB.ToolButtons&&CB.ToolButtons.showBusyMask("Cleaning Up "+b.name,null,2E4)}};c.prototype.reorgFinished=function(b){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();var c=b.getBuf().Vw();b.getBuf().Vw();b.getBuf().V6(100);b=b.getBuf().V10();this.callAfterDBSelected=null;var f=this.cloudDBItemList.getById(c);f&&(f.nGames=b);this.fireOnReorganized({cloudId:c,
nNewLen:b})};c.prototype.copyGamesTo=function(b,c,f){var g=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);g.setUserType(CB.CloudUserMsgId.COPY_GAMES_TO);g.getBuf().Vh(b);g.getBuf().Vh(0);g.getBuf().Vh(c);g.getBuf().Vh(0);V15.Vf.guid.Vz(g.getBuf());g.getBuf().Vx(f.length);for(b=0;b<f.length;b++)g.getBuf().Vx(f[b]);this.send(g);CB.ToolButtons&&CB.ToolButtons.showBusyMask("Copying games ... ",null,2E4)};c.prototype.requestFilterSet=function(b,c){var f=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);f.setUserType(CB.CloudUserMsgId.SEARCH_GAMES);
f.getBuf().Vh(b);f.getBuf().Vh(0);f.getBuf().Vn(c);V15.Vf.guid.Vz(f.getBuf());this.send(f);CB.ToolButtons&&CB.ToolButtons.showBusyMask("Searching on Server ... ",null,2E4)};c.prototype.searchResult=function(b){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();var c=b.getBuf().Vw();b.getBuf().Vw();for(var f=b.getBuf().V10(),g=[],h=0;h<f&&1E4>h;h++){var l=b.getBuf().V10();g.push(l)}(b=this.cloudDBItemList.getById(c))&&this.openCloudDatabase(b).setSubSet(g)};c.prototype.handleDiskUsed=function(b){b.getBuf().Vw();
b.getBuf().Vw()};c.prototype.handleRenameTitle=function(b){b.getBuf().Vw();b.getBuf().Vw();this.requestDatabases()};c.prototype.gameFromBuf=function(b){var c=new CB.Game,f=new CB.GameHeader;f.compactFromDataBuf(b);b.V10();c.readGameOnly2(b);c.setHeader(f);return c};c.prototype.gameToBuf=function(b,c){c.hdr.compactToDataBuf(b);b.Vx(0);c.writeGameOnly2(b);return c};c.prototype.saveGame=function(b,c){if(this.selectedCloudId){var f=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);f.setUserType(CB.CloudUserMsgId.APPEND_GAME);
f.getBuf().Vh(this.selectedCloudId);f.getBuf().Vh(0);void 0!==c?f.getBuf().Vx(c):f.getBuf().Vx(0);V15.Vf.guid.Vz(f.getBuf());(new CB.DateAndTime(0)).Vz(f.getBuf());this.gameToBuf(f.getBuf(),b);if(void 0===c){var g=this.openCloudDatabaseById(this.selectedCloudId);g&&(b.replaceDBId=this.selectedCloudId,b.replaceGameNo=g.getGameCount()+1)}this.send(f);void 0!==c?this.fireOnGamesChangedByGameNo({cloudId:this.selectedCloudId,gameNos:[c]}):this.fireOnGameAppended({cloudId:this.selectedCloudId})}};c.prototype.replaceGame=
function(b){this.canReplaceGame(b)?this.saveGame(b,b.replaceGameNo):this.saveGame(b)};c.prototype.canReplaceGame=function(b){return b.replaceDBId&&b.replaceDBId==this.selectedCloudId&&0<b.replaceGameNo};c.prototype.saveGames=function(b,c){for(var f=[],g=0;g<c.length;g++)f.push(new CB.CloudGame(c[g]));g=new CB.DataBuffer;g.writeFakeInt64(b);V15.Vf.guid.Vz(g);c.length&&(CB.ToolButtons&&CB.ToolButtons.showBusyMask("Saving Games ... ",null,1E3),this.gameSender.sendVector(this.getNId(),CB.ConnectId.SERVER,
f,2E4,CB.SockMsgId.CLOUD_USER,CB.CloudUserMsgId.GAMES_TO_SERVER,g,function(b,d){d.Vz(b)}))};var b=new CB.Vr;c.prototype.handleConfirmGamesToServer=function(d){d=this.gameSender.handleConfirmBunch(d);var c=this.cloudDBItemList.getById(this.selectedCloudId);c&&(c.nGames+=d,b.exec(function(){CB.ToolButtons&&CB.ToolButtons.hideBusyMask();this.fireOnReorganized({cloudId:this.selectedCloudId,nNewLen:c.nGames})}.bind(this),2E3))};c.prototype.storePosAndMoves=function(b,c){var f=this.createMsg(CB.CloudUserMsgId.STORE_POS_AND_MOVES);
this.gameToBuf(f.getBuf(),b);f.getBuf().Vx(c);f.getBuf().Vx(CB.System.getWindowsCodePage());this.send(f)};c.prototype.storeEval=function(b,c){var f=this.createMsg(CB.CloudUserMsgId.STORE_EVAL);this.gameToBuf(f.getBuf(),b);f.getBuf().Vx(c);var g=CB.PosAndMoveFlags.MOVE_WHITE;this.isMovesLoadedFor(!0)&&(g=CB.PosAndMoveFlags.MOVE_BLACK);f.getBuf().Vx(g);f.getBuf().Vx(CB.System.getWindowsCodePage());this.send(f)};c.prototype.storeText=function(b,c){var f=this.createMsg(CB.CloudUserMsgId.STORE_TEXT);this.gameToBuf(f.getBuf(),
b);f.getBuf().V5(CB.strUtil.encodeUTF8(c));var g=CB.PosAndMoveFlags.MOVE_WHITE;this.isMovesLoadedFor(!0)&&(g=CB.PosAndMoveFlags.MOVE_BLACK);f.getBuf().Vx(g);f.getBuf().Vx(CB.System.getWindowsCodePage());this.send(f)};c.prototype.notifyPlayed=function(b,c,f){var g=this.createMsg(CB.CloudUserMsgId.NOTIFY_PLAYED);b.write(g.getBuf());c.write2(g.getBuf());g.getBuf().V13(f);g.getBuf().Vx(CB.System.getWindowsCodePage());this.send(g)};c.prototype.uploadToMyMoves=function(b){var c=this.createMsg(CB.CloudUserMsgId.UPLOAD_GAME);
this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};c.prototype.makeMainMoveOrder=function(b){var c=this.createMsg(CB.CloudUserMsgId.MAKE_MAIN_MOVEORDER);this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};c.prototype.removeFromMyMoves=function(b,c){var f=this.createMsg(CB.CloudUserMsgId.REMOVE_FROM_MYMOVES);b.write(f.getBuf());delete c.annos;(new CB.Move(c.from,c.to,c.prom)).write2(f.getBuf());f.getBuf().Vx(CB.System.getWindowsCodePage());
this.send(f)};c.prototype.removeWholeTree=function(b,c,f){var g=this.createMsg(CB.CloudUserMsgId.REMOVE_WHOLE_TREE);b.write(g.getBuf());c.write2(g.getBuf());g.getBuf().Vx(f);g.getBuf().Vx(CB.System.getWindowsCodePage());this.send(g)};c.prototype.respondTreeRemoved=function(b){var c=b.getBuf().Vw();b.getBuf().V10();CB.LOG("Removed: "+c+" moves.","LogBold");this.reloadMyMoves();V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.FORCE_UPDATE);1<c&&V15.panelMgr.showMessage(c+" "+lm.MOVES_UNMARKED,4E3)};
c.prototype.respondTreeUnlearned=function(b){var c=b.getBuf().Vw();b.getBuf().V10();V15.panelMgr.showMessage(c+" "+lm.MOVES_UNLEARNED,4E3)};c.prototype.unlearnWholeTree=function(b,c,f){var g=this.createMsg(CB.CloudUserMsgId.UNLEARN_WHOLE_TREE);b.write(g.getBuf());c.write2(g.getBuf());g.getBuf().Vx(f);g.getBuf().Vx(CB.System.getWindowsCodePage());this.send(g)};c.prototype.respondCountMyMoves=function(b){};c.prototype.checkPosAndMoves=function(b,c,f){var g=this.createMsg(CB.CloudUserMsgId.CHECK_POS_AND_MOVES);
b.write(g.getBuf());g.getBuf().V13(c?!0:!1);g.getBuf().writeInt(f||0);g.getBuf().Vx(CB.System.getWindowsCodePage());this.send(g,!0)};c.prototype.respondPosAndMoves=function(b){var c=new CB.Position;c.read(b.getBuf());for(var f=b.getBuf().V10(),g=[],h=[],l=0;l<f&&200>l;l++){var q=new CB.Move;q.read2(b.getBuf());var h=b.getBuf().Vw(),r=b.getBuf().V10(),t=b.getBuf().readUint8(),v=b.getBuf().V6(300),y=b.getBuf().readUint8(),A=b.getBuf().Vu(),w=b.getBuf().readUint8();g.push({move:q,visits:h,flags:r,eval:t,
correct:y,txt:v,date:A,learnPercent:w})}f={count:0,total:0,drilled:0,learned:0,quote:0,toString:function(){return"Stats: cnt="+this.count+", total="+this.total+", drilled="+this.drilled+", learned="+this.learned},getPercent:function(){return this.total?Math.round(100*this.quote/this.total):0}};f.count=b.getBuf().Vw();f.total=b.getBuf().Vw();f.drilled=b.getBuf().Vw();f.learned=b.getBuf().Vw();f.quote=b.getBuf().readFloat64();this.fireOnMyMoves({position:c,moves:g,stats:f})};c.prototype.loadMyMoves=
function(b,c){this.lastLoadMyMovesStartGame=c;V15.panelMgr.blockLiveBookUpdates&&V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.BLOCKED);var f=this.createMsg(CB.CloudUserMsgId.LOAD_MY_MOVES);f.getBuf().Vx(b);this.gameToBuf(f.getBuf(),c);f.getBuf().Vx(CB.System.getWindowsCodePage());this.send(f)};c.prototype.reloadMyMoves=function(){this.lastLoadMyMovesStartGame||(this.lastLoadMyMovesStartGame=new CB.Game);this.loadMyMoves(this.lastMyMovesLoadMode,this.lastLoadMyMovesStartGame)};c.prototype.respondAllMyMoves=
function(b){var c=this.gameFromBuf(b.getBuf()),f=b.getBuf().Vw();5;b=b.getBuf().V10();var g;switch(b){case CB.GetMovesType.ALL:g="Both Colors";break;case CB.GetMovesType.WHITE:g="White";break;case CB.GetMovesType.BLACK:g="Black"}c.hdr.white=new CB.PlayerData("","My Moves");c.hdr.black=new CB.PlayerData("",g);0==f?(c="No Marked Moves Found.",b!=CB.GetMovesType.ALL&&(c=g+" - "+c),V15.panelMgr.showMessage(c,5E3),V15.panelMgr.shakeMarkButton(),c=new CB.Game):V15.panelMgr.stopShakeMarkButton();V15.panelMgr.loadGame(c);
V15.panelMgr.setLayoutMyMoves(!0,b==CB.GetMovesType.BLACK);this.lastMyMovesLoadMode=this.myMovesLoadMode=b;V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.NOT_BLOCKED)};c.prototype.notifyMyMovesChanged=function(b){V15.notifyMyMovesChanged()};c.prototype.startDrill=function(b,c){var f=this.createMsg(CB.CloudUserMsgId.START_DRILL);b.write(f.getBuf());f.getBuf().Vx(c);f.getBuf().Vx(CB.System.getWindowsCodePage());this.send(f)};c.prototype.stopDrill=function(){var b=this.createMsg(CB.CloudUserMsgId.STOP_DRILL);
b.getBuf().Vx(CB.System.getWindowsCodePage());this.send(b)};c.prototype.saveGameToClipboard=function(b){if(!(3>b.getMainLine().length&&b.isNormalInit())){var c=this.createMsg(CB.CloudUserMsgId.SAVE_TO_CLIPBOARD);this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)}};c.prototype.createMsg=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);c.setUserType(b);b=this.user;this.loginMode==CB.LoginMode.GUEST&&(b="Guest");c.getBuf().V5(CB.strUtil.encodeUTF8(b));
return c};c.prototype.onResetGame=function(){this.myMovesLoadMode=-1};c.prototype.isMovesLoadedForAny=function(){return 0<=this.myMovesLoadMode};c.prototype.isMovesLoadedFor=function(b){switch(this.myMovesLoadMode){default:return!1;case CB.GetMovesType.ALL:return!0;case CB.GetMovesType.BLACK:return b;case CB.GetMovesType.WHITE:return!b}};c.prototype.displayForceLogOffMsg=function(b){var c=V15.panelMgr.getKernel();c&&c.boardWin&&!V15.config.silentCloud&&c.boardWin.addMessage("Server logged you off: "+
b,!0)};Ve.initForListeners(c);Ve.addEvent(c,"HeadersChanged");Ve.addEvent(c,"HeadersChangedByGameNo");Ve.addEvent(c,"GameChanged");Ve.addEvent(c,"GamesChangedByGameNo");Ve.addEvent(c,"GameAppended");Ve.addEvent(c,"ChangeLogin");Ve.addEvent(c,"Reorganized");Ve.addEvent(c,"Deleted");Ve.addEvent(c,"MyMoves");return c}();"use strict";CB.namespace("CB.Server.MyMovesManager");
CB.CloudUserMsgId={NONE:0,REQUEST_DATABASES:1600,RESPOND_DATABASES:1601,REQUEST_MULTIPLE_HEADERS:1602,RESPOND_MULTIPLE_HEADERS:1603,CLIENTREQUEST_GAME:1604,SERVERRESPOND_GAME:1605,APPEND_GAME:1606,NOTIFY_HEADER_CHANGED:1607,NOTIFY_GAME_CHANGED:1608,NOTIFY_DB_REORGANIZED:1609,NOTIFY_DB_DELETED:1610,DISK_USED:1611,INC_USAGE:1612,CONFIRM_GAME:1613,RENAME_TITLE_TO_CLIENT:1614,CONFIRM_MULTIPLE_HEADERS:1615,CREATE_CLOUD_DB:1616,CLOUD_DB_CREATED:1617,DELETE_CLOUD_DB:1618,CLOUDDB_DELETE_FINISHED:1619,SET_DELETE_MARK:1620,
REORG_CLOUD_DB:1621,CLOUDDB_REORG_FINISHED:1622,COPY_GAMES_TO:1623,NOTIFY_COPY_DONE:1624,COPY_GAMES_FINISHED:1625,SEARCH_GAMES:1626,SEARCH_RESULT:1627,GAMES_TO_SERVER:1628,CONFIRM_GAMES_TO_SERVER:1629,STORE_POS_AND_MOVES:1630,CHECK_POS_AND_MOVES:1631,RESPOND_POS_AND_MOVES:1632,REMOVE_FROM_MYMOVES:1633,LOAD_MY_MOVES:1634,RESPOND_ALL_MYMOVES:1635,REMOVE_WHOLE_TREE:1636,RESPOND_TREE_REMOVED:1637,MAKE_MAIN_MOVEORDER:1638,STORE_EVAL:1639,UPLOAD_GAME:1640,STORE_TEXT:1641,NOTIFY_PLAYED:1642,START_DRILL:1643,
UNLEARN_WHOLE_TREE:1644,RESPOND_TREE_UNLEARNED:1645,RESPOND_COUNT_MYMOVES:1647,NOTIFY_MYMOVES_CHANGED:1648,STOP_DRILL:1649,SAVE_TO_CLIPBOARD:1650,LOAD_ALL_MYMOVES_EX:1651,COUNT_MYMOVES_EX:1652,CHECK_POS_AND_MOVES_EX:1653,REQUEST_REPERTOIRELIST:1654,RESPOND_REPERTOIRELIST:1655,toString:function(c){for(var b in this)if(this[b]==c)return b;return"Unknown CloudUserMsgId: "+c},toNumString:function(c){return"MyMovesId="+c}};
CB.PosAndMoveFlags={MY_BLACK:1,MY_WHITE:2,MOVE_WHITE:4,MOVE_BLACK:8,REP_IMPORTANT:16,REP_EXCLUDE:32,WITH_TEXT:64,DRILLED:128,DELETED:256,WHITE:6,BLACK:9,MOVE:12,MYMOVE:3};
CB.Server.MyMovesManager=function(){var c=function(){this.setRequestedHeaders=new CB.Set;this.timerSend=new CB.Timer;this.selectedMyMovesId=0;this.mapDBs={};this.headerResponseReceiver=new CB.VectorSender(function(b){this.send(b)}.bind(this));this.gameSender=new CB.VectorSender(function(b){this.send(b)}.bind(this));this.autoOpenDB=!1;this.lastMyMovesLoadMode=this.myMovesLoadMode=CB.GetMovesType.NONE;this.name="MyMoves"};CB.inherit(c,CB.Server.Connector);c.prototype.createLobby=function(b,d,c,f,g){this.create(b,
d,c,f,g)};c.prototype.getName=function(){return"MyMovesMgr"};c.prototype.onChangeLogin=function(){V15.setLoggedIn(this.isLoggedIn())};c.prototype.onLoginToken=function(){this.logIntoChat("Connected to MyMovesServer","","conn");this.boundLoginOk=!0;this.loginMode!==CB.LoginMode.GUEST&&(V15.setLoggedIn(!0),V15.panelMgr.getKernel()&&this.checkPosAndMoves(V15.panelMgr.getKernel().getCurPos()));V15.showAccountType(this.Vl)};c.prototype.onIdReceived=function(b){b.isFromBridge()||(this.boundLoginOk=!0,this.loginMode!==
CB.LoginMode.GUEST?b.strUserId&&(V15.Vf.userName=CB.strUtil.decodeUTF8(b.strUserId),this.user=CB.strUtil.decodeUTF8(b.strUserId),this.utf8User=b.strUserId,b.strToken&&(V15.Vf.loginToken=b.strToken,CB.DOM.setCookie("AccountMode",CB.LoginMode.NORMAL),V15.Vf.rememberLoginToken(),this.Vl=b.Vl,V15.setLoggedIn(!0),V15.showAccountType(this.Vl),V15.panelMgr.getKernel()&&this.checkPosAndMoves(V15.panelMgr.getKernel().getCurPos())),this.fnOnIdReceived&&this.fnOnIdReceived()):(this.user="Guest"+this.getNId(),
this.utf8User="Guest"+this.getNId()))};c.prototype.onLogOff=function(){this.superClass.onLogOff.apply(this,arguments)};c.prototype.logIntoChat=function(b,d,c){5};c.prototype.testYesNo=function(b){CB.LOG("YesNo="+b)};c.prototype.test=function(){};c.prototype.handleReceived=function(b){if(!this.handleReceivedByConnector(b))try{switch(b.getType()){default:TRACE("Unhandled: "+b.toString());break;case CB.SockMsgId.DEFAULTGROUPS:this.logIntoChat("Connected to MyMovesServer");this.boundLoginOk=!0;alert("Default Groups not expected...");
break;case CB.SockMsgId.CLOUD_USER:this.handleMyMovesMsg(b);break;case CB.SockMsgId.INVALIDPASSWORD:this.clearLoginCookies()}}catch(d){b=CB.SockMsgId.toNumString(b.getType()),CB.LogException(b,d)}};c.prototype.handleChat=function(b){V15.panelMgr.chatOut(chat.toString())};c.prototype.isLoggedIn=function(){return this.boundLoginOk&&this.isConnected()};c.prototype.handleMyMovesMsg=function(b){try{switch(b.getUserType()){default:TRACE("Unhandled MyMoves Msg: "+b.toString());break;case CB.CloudUserMsgId.DISK_USED:this.handleDiskUsed(b);
break;case CB.CloudUserMsgId.RESPOND_POS_AND_MOVES:this.respondPosAndMoves(b);break;case CB.CloudUserMsgId.RESPOND_ALL_MYMOVES:this.respondAllMyMoves(b);break;case CB.CloudUserMsgId.RESPOND_TREE_REMOVED:this.respondTreeRemoved(b);break;case CB.CloudUserMsgId.RESPOND_TREE_UNLEARNED:this.respondTreeUnlearned(b);break;case CB.CloudUserMsgId.RESPOND_COUNT_MYMOVES:this.respondCountMyMoves(b);break;case CB.CloudUserMsgId.NOTIFY_MYMOVES_CHANGED:this.notifyMyMovesChanged(b);break;case CB.CloudUserMsgId.RESPOND_REPERTOIRELIST:this.handleRepertoireList(b);
case CB.CloudUserMsgId.NOTIFY_GAME_CHANGED:}}catch(d){b=CB.CloudUserMsgId.toNumString(b.getUserType()),CB.LogException(b,d)}};c.prototype.handleReconnectOk=function(b){};c.prototype.handleDiskUsed=function(b){b.getBuf().Vw();b.getBuf().Vw()};c.prototype.gameFromBuf=function(b){var d=new CB.Game,c=new CB.GameHeader;c.compactFromDataBuf(b);b.V10();d.readGameOnly2(b);d.setHeader(c);return d};c.prototype.gameToBuf=function(b,d){d.hdr.compactToDataBuf(b);b.Vx(0);d.writeGameOnly2(b);return d};c.prototype.storePosAndMoves=
function(b,d){var c=this.createMsg(CB.CloudUserMsgId.STORE_POS_AND_MOVES);this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(d);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};c.prototype.storeEval=function(b,d){var c=this.createMsg(CB.CloudUserMsgId.STORE_EVAL);this.gameToBuf(c.getBuf(),b);c.getBuf().Vx(d);var f=CB.PosAndMoveFlags.MOVE_WHITE;this.isMovesLoadedFor(!0)&&(f=CB.PosAndMoveFlags.MOVE_BLACK);c.getBuf().Vx(f);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};c.prototype.storeText=
function(b,d){var c=this.createMsg(CB.CloudUserMsgId.STORE_TEXT);this.gameToBuf(c.getBuf(),b);c.getBuf().V5(CB.strUtil.encodeUTF8(d));var f=CB.PosAndMoveFlags.MOVE_WHITE;this.isMovesLoadedFor(!0)&&(f=CB.PosAndMoveFlags.MOVE_BLACK);c.getBuf().Vx(f);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};c.prototype.notifyPlayed=function(b,d,c){var f=this.createMsg(CB.CloudUserMsgId.NOTIFY_PLAYED);b.write(f.getBuf());d.write2(f.getBuf());f.getBuf().V13(c);f.getBuf().Vx(CB.System.getWindowsCodePage());
this.send(f)};c.prototype.uploadToMyMoves=function(b){var d=this.createMsg(CB.CloudUserMsgId.UPLOAD_GAME);this.gameToBuf(d.getBuf(),b);d.getBuf().Vx(CB.System.getWindowsCodePage());this.send(d)};c.prototype.makeMainMoveOrder=function(b){var d=this.createMsg(CB.CloudUserMsgId.MAKE_MAIN_MOVEORDER);this.gameToBuf(d.getBuf(),b);d.getBuf().Vx(CB.System.getWindowsCodePage());this.send(d)};c.prototype.removeFromMyMoves=function(b,d){if(d&&this.isMovesLoadedForAny()){var c=this.createMsg(CB.CloudUserMsgId.REMOVE_FROM_MYMOVES);
b.write(c.getBuf());delete d.annos;(new CB.Move(d.from,d.to,d.prom)).write2(c.getBuf());c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)}};c.prototype.removeWholeTree=function(b,d,c){var f=this.createMsg(CB.CloudUserMsgId.REMOVE_WHOLE_TREE);b.write(f.getBuf());d.write2(f.getBuf());f.getBuf().Vx(c);f.getBuf().Vx(CB.System.getWindowsCodePage());this.send(f)};c.prototype.respondTreeRemoved=function(b){var d=b.getBuf().Vw();b.getBuf().V10();CB.LOG("Removed: "+d+" moves.","LogBold");this.reloadMyMoves();
V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.FORCE_UPDATE);1<d&&V15.panelMgr.showMessage(d+" "+lm.MOVES_UNMARKED,4E3)};c.prototype.respondTreeUnlearned=function(b){var d=b.getBuf().Vw();b.getBuf().V10();V15.panelMgr.showMessage(d+" "+lm.MOVES_UNLEARNED,4E3)};c.prototype.unlearnWholeTree=function(b,d,c){var f=this.createMsg(CB.CloudUserMsgId.UNLEARN_WHOLE_TREE);b.write(f.getBuf());d.write2(f.getBuf());f.getBuf().Vx(c);f.getBuf().Vx(CB.System.getWindowsCodePage());this.send(f);this.conn.breakForTesting()};
c.prototype.respondCountMyMoves=function(b){};c.prototype.checkPosAndMoves=function(b,d,c){var f=this.createMsg(CB.CloudUserMsgId.CHECK_POS_AND_MOVES);b.write(f.getBuf());f.getBuf().V13(d?!0:!1);f.getBuf().writeInt(c||0);f.getBuf().Vx(CB.System.getWindowsCodePage());this.send(f,!0)};c.prototype.checkPosAndMovesEx=function(b,d,c){if(!this.currRepListItem)return this.checkPosAndMoves(b,d,c);var f=this.createMsg(CB.CloudUserMsgId.CHECK_POS_AND_MOVES_EX);this.repListItemToPosMovesId(this.currRepListItem,
f.getBuf());b.write(f.getBuf());f.getBuf().V13(d?!0:!1);f.getBuf().writeInt(c||0);f.getBuf().Vx(CB.System.getWindowsCodePage());this.send(f,!0)};c.prototype.respondPosAndMoves=function(b){var d=new CB.Position;d.read(b.getBuf());for(var c=b.getBuf().V10(),f=[],g=0;g<c&&200>g;g++){var h=new CB.Move;h.read2(b.getBuf());var l=b.getBuf().Vw(),q=b.getBuf().V10(),r=b.getBuf().readUint8(),t=b.getBuf().V6(300),v=b.getBuf().readUint8(),y=b.getBuf().Vu(),A=b.getBuf().readUint8();f.push({move:h,visits:l,flags:q,
eval:r,correct:v,txt:t,date:y,learnPercent:A})}c={count:0,total:0,drilled:0,learned:0,quote:0,toString:function(){return"Stats: cnt="+this.count+", total="+this.total+", drilled="+this.drilled+", learned="+this.learned},getPercent:function(){return this.total?Math.round(100*this.quote/this.total):0}};c.count=b.getBuf().Vw();c.total=b.getBuf().Vw();c.drilled=b.getBuf().Vw();c.learned=b.getBuf().Vw();c.quote=b.getBuf().readFloat64();this.fireOnMyMoves({position:d,moves:f,stats:c})};c.prototype.setAndLoadMyMovesByName=
function(b,d){this.myMovesLoadMode<CB.GetMovesType.GLOBAL_WHITE&&(d=new CB.Game);this.currRepListItem=b;this.myMovesLoadMode=0===b.eMode?CB.GetMovesType.GLOBAL_WHITE:CB.GetMovesType.GLOBAL_BLACK;V15.panelMgr.blockLiveBookUpdates&&V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.BLOCKED);var c=this.createMsg(CB.CloudUserMsgId.LOAD_ALL_MYMOVES_EX);this.repListItemToPosMovesId(b,c.getBuf());c.getBuf().Vx(this.myMovesLoadMode);this.gameToBuf(c.getBuf(),d);c.getBuf().Vx(CB.System.getWindowsCodePage());
this.send(c)};c.prototype.reloadGlobalMyMoves=function(b,d,c){if(this.currRepListItem&&this.currRepListItem.path&&this.currRepListItem.name){var f=this.currRepListItem.path.split("\\")[0];this.currRepListItem.path=this.makeServerPath(f,b,d,this.currRepListItem.eMode);this.setAndLoadMyMovesByName(this.currRepListItem,c)}};c.prototype.makeServerPath=function(b,d,c,f){switch(d){case CB.RepDepth.EASY:b+="\\Easy";break;case CB.RepDepth.CLUB:b+="\\Club";break;case CB.RepDepth.TOURNAMENT:b+="\\Tourn";break;
case CB.RepDepth.MASTER:b+="\\Profi"}switch(c){case CB.RepStyle.FASHION:b+="-Fashion";break;case CB.RepStyle.SIDELINES:b+="-SideLines"}1===f?b=b+="-Black":0===f&&(b=b+="-White");return b};c.prototype.repListItemToPosMovesId=function(b,d){d.V5(b.name);d.V5(b.path);d.V13(b.global)};c.prototype.loadCurrentMyMoves=function(b,d){this.currRepListItem&&b>=CB.GetMovesType.GLOBAL_WHITE?this.setAndLoadMyMovesByName(this.currRepListItem,d):this.loadMyMoves(b,d)};c.prototype.loadMyMoves=function(b,d,c){this.currRepListItem=
null;this.loadMyMovesHdl=c;this.doLoadMyMoves(b,new CB.Game)};c.prototype.doLoadMyMoves=function(b,d){this.lastLoadMyMovesStartGame=d;V15.panelMgr.blockLiveBookUpdates&&V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.BLOCKED);var c=this.createMsg(CB.CloudUserMsgId.LOAD_MY_MOVES);c.getBuf().Vx(b);this.gameToBuf(c.getBuf(),d);c.getBuf().Vx(CB.System.getWindowsCodePage());this.send(c)};c.prototype.resetGame=function(){var b=V15.panelMgr.getKernel();b&&b.game.assign(new CB.Game);this.lastLoadMyMovesStartGame=
new CB.Game};c.prototype.reloadMyMoves=function(){this.lastLoadMyMovesStartGame||(this.lastLoadMyMovesStartGame=new CB.Game);this.loadMyMoves(this.lastMyMovesLoadMode,this.lastLoadMyMovesStartGame)};c.prototype.respondAllMyMoves=function(b){var d=this.gameFromBuf(b.getBuf()),c=b.getBuf().Vw();b=b.getBuf().V10();var f;switch(b){case CB.GetMovesType.ALL:f="Both Colors";break;case CB.GetMovesType.WHITE:f="White";break;case CB.GetMovesType.BLACK:f="Black"}d.hdr.white=new CB.PlayerData("","My Moves");
d.hdr.black=new CB.PlayerData("",f);0==c?(d="No Marked Moves Found.",b!=CB.GetMovesType.ALL&&b<CB.GetMovesType.GLOBAL_WHITE&&(d=f+" - "+d),V15.panelMgr.showMessage(d,5E3),V15.panelMgr.shakeMarkButton(),d=new CB.Game):V15.panelMgr.stopShakeMarkButton();b>=CB.GetMovesType.GLOBAL_WHITE&&this.removeAllMyMoveAnnos(d);V15.panelMgr.loadGame(d);this.myMovesLoadMode=b;var g;this.currRepListItem&&(g=this.currRepListItem.getNotaHeaderTitleLines());V15.panelMgr.setLayoutMyMoves(!0,b,g);this.lastMyMovesLoadMode=
b;V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.NOT_BLOCKED);this.loadMyMovesHdl&&(this.loadMyMovesHdl(),delete this.loadMyMovesHdl)};c.prototype.removeAllMyMoveAnnos=function(b){b.forAllMoves(function(b){(b=b.getAnno())&&(b=b.getSymbol())&&b.removeMyMoveMark()})};c.prototype.notifyMyMovesChanged=function(b){V15.notifyMyMovesChanged()};c.prototype.startDrill=function(b,d){var c=this.createMsg(CB.CloudUserMsgId.START_DRILL);b.write(c.getBuf());c.getBuf().Vx(d);c.getBuf().Vx(CB.System.getWindowsCodePage());
this.send(c)};c.prototype.stopDrill=function(){var b=this.createMsg(CB.CloudUserMsgId.STOP_DRILL);b.getBuf().Vx(CB.System.getWindowsCodePage());this.send(b)};c.prototype.requestRepertoireList=function(b){var d=this.createMsg(CB.CloudUserMsgId.REQUEST_REPERTOIRELIST);this.repListItemToPosMovesId({name:"",path:"",global:!0},d.getBuf());d.getBuf().Vx(b?1:0);this.send(d)};c.prototype.handleRepertoireList=function(b){var d=new CB.RepertoireItemList;d.fromDataBuf(b.getBuf());b=b.getBuf().V14();this.fireOnRepertoires({list:d,
black:b})};c.prototype.createMsg=function(b){var d=new CB.WebSockMessage(CB.SockMsgId.CLOUD_USER);d.setUserType(b);b=this.user;this.loginMode==CB.LoginMode.GUEST&&(b="Guest");d.getBuf().V5(CB.strUtil.encodeUTF8(b));return d};c.prototype.onResetGame=function(){this.myMovesLoadMode=CB.GetMovesType.NONE};c.prototype.isMovesLoadedForAny=function(){return this.myMovesLoadMode>=CB.GetMovesType.ALL&&this.myMovesLoadMode<CB.GetMovesType.GLOBAL_WHITE};c.prototype.getLoadedMovesSide=function(){switch(this.lastMyMovesLoadMode){default:return CB.Side.NONE;
case CB.GetMovesType.ALL:case CB.GetMovesType.WHITE:case CB.GetMovesType.GLOBAL_WHITE:return CB.Side.WHITE;case CB.GetMovesType.BLACK:case CB.GetMovesType.GLOBAL_BLACK:return CB.Side.BLACK}};c.prototype.isMovesLoadedFor=function(b){switch(this.myMovesLoadMode){default:return!1;case CB.GetMovesType.ALL:return!0;case CB.GetMovesType.BLACK:return b;case CB.GetMovesType.WHITE:return!b}};c.prototype.displayForceLogOffMsg=function(b){var d=V15.panelMgr.getKernel();d&&d.boardWin&&d.boardWin.addMessage("Server logged you off: "+
b,!0)};Ve.initForListeners(c);Ve.addEvent(c,"MyMoves");Ve.addEvent(c,"Repertoires");return c}();"use strict";CB.namespace("CB.DOM");CB.DOM.get=function(c){return document.getElementById(c)};CB.DOM.inputAdd=function(c,b){var d=document.createTextNode(c),e=document.createElement("div");void 0!==b&&(e.className=b);document.body.appendChild(e);e.appendChild(d);void 0!==CB.input?document.body.insertBefore(e,CB.input):document.body.appendChild(e)};
CB.DOM.add=function(c,b,d){var e=document.createElement("div");b&&b.length?(b=document.createElement(b),b.innerText=c):b=document.createTextNode(c);void 0!==d&&(e.className=d);e.appendChild(b);document.body.appendChild(e)};CB.DOM.addUrl=function(c,b,d){var e=document.createElement("div"),f=document.createElement("a");f.href=c;f.target="_blank";b&&b.length&&(f.textContent=b);void 0!==d&&(e.className=d);e.appendChild(f);document.body.appendChild(e)};
CB.DOM.addBr=function(){var c=document.createElement("br");document.body.appendChild(c)};CB.DOM.insertBefore=function(c,b,d){c=document.createTextNode(c);var e=document.createElement("div");e.className=void 0!==d?d:"Text";document.body.appendChild(e);e.appendChild(c);void 0!==document.getElementById(b)?document.body.insertBefore(e,document.getElementById(b)):document.body.appendChild(e)};
CB.DOM.getCookie=function(c){for(var b=document.cookie.split(";"),d=0;d<b.length;d++){var e=b[d].split("="),f=e[0].trim(),e=1<e.length?e[1]:"";if(f==c)return decodeURIComponent(e)}return""};CB.DOM.codeAccountName=function(c){return CB.strUtil.base64.encode(CB.strUtil.htmlEncode(c))};CB.DOM.setAccountNameCookie=function(c){"guest"!=c&&this.setCodedCookie("AccountName64",c)};CB.DOM.getAccountNameCookie=function(c){return this.getCodedCookie("AccountName64",c)};
CB.DOM.setCodedCookie=function(c,b){CB.DOM.setCookie(c,this.codeAccountName(b))};CB.DOM.getCodedCookie=function(c,b){var d=CB.DOM.getCookie(c),d=CB.strUtil.base64.decode(d);b&&(d=CB.strUtil.htmlDecode(d),d=d.replace("%25","%"),d=d.replace("%20"," "));return d};
CB.DOM.setCookie=function(c,b){var d=new Date,e;b?(d.setYear(d.getFullYear()+1),e=d.toGMTString()):e="Thu, 01 Jan 1970 00:00:01 GMT";d=".chessbase.com";-1!=document.URL.search(/localhost/i)&&(d="localhost");e=c+"="+encodeURIComponent(b)+";expires="+e+";path=/;";d.length&&(e+="domain="+d+";");document.cookie=e};CB.DOM.clearCookie=function(c){CB.DOM.setCookie(c,"")};CB.DOM.addCls=function(c,b){void 0!==c&&(c.className=0<c.className.length?c.className+(" "+b):b)};
CB.DOM.removeCls=function(c,b){void 0!==c&&(c.className=c.className.replace(new RegExp("\b"+b+"\b"),""))};CB.DOM.resize=function(c,b,d){if("string"===typeof c||"number"===typeof c)c=document.getElementById(c);void 0!==c&&(c.style.width=b,c.style.height=d)};CB.DOM.setText=function(c,b){c&&("undefined"==typeof c.textContent?c.innerText=b:c.textContent=b)};function textOut(c,b){CB.Logger?CB.LOG(c,b):(CB.DOM.add(c,"",b),void 0!==CB.input&&CB.input.scrollIntoView())}
function TRACE(c){V15.config.debug&&textOut(c,"LogTrace")}function EXCEPTION(c,b){var d=c;void 0!==b&&(d+=" ("+b+")");textOut(d,"LogException")}function CHAT(c){textOut(c,"LogChat")}
CB.CSS=function(){var c={},b;c.getStyleSheet=function(){if(void 0===b){var d=document.createElement("style");d.setAttribute("media","screen");d.appendChild(document.createTextNode(""));document.head.appendChild(d);b=d.sheet}return b};c.createStyleSheet=function(b){var d=document.createElement("style");d.id=b;d.setAttribute("media","screen");d.appendChild(document.createTextNode(""));document.head.appendChild(d);return d.sheet};c.addRules=function(b,d){try{void 0!==c.getStyleSheet().addRule?c.getStyleSheet().addRule(b,
d):c.getStyleSheet().insertRule(b+" { "+d+" }",c.getStyleSheet().cssRules.length)}catch(g){CB.LogException("CSS:addRules",g)}};c.getGradToRight=function(b,d){return"background-image:linear-gradient( to right,"+b+","+d+")"};c.getCenteredText=function(){return"display:block;margin-left:auto;margin-right:auto;text-align:center"};c.getHeader=function(b,d,c){return c?"<"+b+' style="'+c+'">'+d+"</"+b+">":"<"+b+">"+d+"</"+b+">"};c.findKeyframesRule=function(b){for(var d=c.getStyleSheet(),g=0;g<d.cssRules.length;++g)if(d.cssRules[g].type==
window.CSSRule.KEYFRAMES_RULE&&d.cssRules[g].name==b)return d.cssRules[g];g=CB.System.isWebKit()?"-webkit-":"";void 0===d.insertRule?d.addRule("@"+g+"keyframes "+b+"{ 0% { top: 10px } 100% { top: 30px } }"):d.insertRule("@"+g+"keyframes "+b+"{ 0% { top: 10px } 100% { top: 30px } }",d.cssRules.length);for(g=0;g<d.cssRules.length;++g)if(d.cssRules[g].type==window.CSSRule.KEYFRAMES_RULE&&d.cssRules[g].name==b)return d.cssRules[g];return null};var d={};c.addIcon=function(b){b=[].concat(b);for(var c=0;c<
b.length;c++)1<b[c].length&&void 0==d[b[c]]&&(CB.CSS.getStyleSheet().insertRule("."+b[c]+"{ background-image: url( "+V15.config.getRibbonPath()+b[c]+".png ) !important; }",0),d[b[c]]=1)};return c}();"use strict";
CB.$=function(){function c(b){var d=document.createElement("div");d.innerHTML=b;return d.childNodes}function b(b){q.prototype[b]=function(){return this.arr[b].apply(this,arguments)}}function d(b){q.prototype[b]=function(d){this.on(b,d)}}var e=/^#(\w|-)+$/,f=/^.(\w|-)+$/,g=/^\w+$/,h=/^\[(\w|-)+\]$/,l=/^<.*>$/,q=function(b,d){var f=[];if(null!=b&&""!=b)if("string"===typeof b){d=d||document;var h=(new q(d)).single();b=b.trim();b.startsWith(">")?(f=b.replace(">","").trim(),f=(new q(f,h)).arr.filter(function(b){return b.parentNode==
h})):e.test(b)?(b=b.substring(1),f=(f=document.getElementById(b))?[f]:[]):g.test(b)?f=h.getElementsByTagName(b):l.test(b)?f=c(b):h&&(f=h.querySelectorAll(b,h))}else"object"===typeof b&&(f=b.proloJQ?b.arr:[b]);this.length=f.length;this.arr=[];for(var r=0;r<f.length;++r)this[r]=f[r],this.arr.push(f[r]);this.proloJQ=!0};b("indexOf");b("find");b("findIndex");b("find");b("some");b("every");b("map");b("filter");b("reduce");b("forEach");q.prototype.single=function(){return 1===this.arr.length?this.arr[0]:
null};q.prototype.first=function(){return this.arr[0]};q.prototype.last=function(){return this.arr[this.arr.length-1]};q.prototype.addClass=function(b){this.forEach(function(d){d.classList&&d.classList.add(b)});return this};q.prototype.removeClass=function(b){b?this.forEach(function(d){d.classList&&d.classList.remove(b)}):this.forEach(function(b){b.className=""});return this};q.prototype.toggleClass=function(b){this.forEach(function(d){d.classList&&d.classList.toggle(b)});return this};q.prototype.hide=
function(){this.forEach(function(b){if("none"!==b.style.display){var d=b.style.display;b.oldDisplay="none"!=d?d:"block";b.style.display="none"}})};q.prototype.show=function(){this.forEach(function(b){b.style.display&&"none"!==b.style.display||(b.style.display=b.oldDisplay||"block",delete b.oldDisplay)})};q.prototype.setDisplay=function(b){this.forEach(function(d){d.style.display=b})};q.prototype.toggle=function(b){b?this.show():this.hide()};q.prototype.parent=function(b){for(var d=this.single().parentNode;null!=
d;d=d.parentNode)if(v.is(d,b))return d;return null};q.prototype.on=function(b,d){this.forEach(function(c){c.addEventListener(b,d)});return this};q.prototype.off=function(b,d){this.forEach(function(c){c.removeEventListener(b,d)});return this};d("mousemove");d("mousedown");d("mouseup");d("click");q.prototype.html=function(b){if(void 0===b)return this.single().innerHTML;this.forEach(function(d){d.innerHTML=b});return this};q.prototype.text=function(b){if(void 0===b)return this.single().textContent?this.single().textContent:
this.single().innerHTML;this.forEach(function(d){d.textContent?d.textContent=b:d.innerText=b});return this};q.prototype.prependTo=function(b){var d=(new q(b)).single();this.forEach(function(b){d.insertBefore(b,d.firstChild)})};q.prototype.prepend=function(b){var d=new q(b);this.forEach(function(b){d.prependTo(b)})};q.prototype.appendTo=function(b){var d=(new q(b)).single();this.forEach(function(b){d.appendChild(b)});return this};q.prototype.append=function(b){var d=new q(b);this.forEach(function(b){d.appendTo(b)});
return this};q.prototype.insertBefore=function(b){var d=new q(b);this.forEach(function(b){d.forEach(function(d){d.parentNode&&d.parentNode.insertBefore(b,d)})});return this};q.prototype.empty=function(){this.html("");return this};q.prototype.remove=function(){this.forEach(function(b){b.parentNode&&b.parentNode.removeChild(b)});return this};q.prototype.attr=function(b,d){if(void 0===d){var c=this.single().attributes[b];return c?c.value:null}this.forEach(function(c){c.setAttribute(b,d)});return this};
q.prototype.data=function(b,d){return this.attr("data-"+b,d)};var r=/^[+-]?(([0-9]*\.[0-9]+)|[0-9]+)/,t="marginTop marginBottom marginLeft marginRight paddingTop paddingBottom paddingLeft paddingRight height width minHeight minWidth maxHeight maxWidth borderWidth left top bottom right".split(" ");q.prototype.css=function(b,d){if(b&&"object"==typeof b&&!d){for(var c in b)b.hasOwnProperty(c)&&this.css(c,b[c]);return this}var e=minusToCamel(b);if(void 0===d)return this.arr.length?getComputedStyle(this.arr[0])[e]:
null;this.forEach(function(b){var c=d;null==c&&(c="");var c=c.toString(),f;f=c;var g=r.exec(f);g?(g=g[0],f=f.substring(g.length),f={val:parseFloat(g),unit:f}):f=null;f&&!f.unit&&(c+=0<=t.indexOf(e)?"px":"");b.style[e]=c});return this};q.prototype.position=function(){return{top:parseFloat(this.css("top")),left:parseFloat(this.css("left"))}};var v=function(b,d){return ObjUtil.isFunction(b)&&!d?(v.addOnReadyListener(b),null):new q(b,d)};Ve.initInstForListeners(v);Ve.addInstEvent(v,"Ready");(new q(document)).on("DOMContentLoaded",
function(b){v.fireOnReady()});v.is=function(b,d,c){return b?d?f.test(d)?(d=d.replace(".",""),b.classList&&b.classList.contains(d)):e.test(d)?(d=d.replace("#",""),b.id===d):g.test(d)?b.tagName==d:h.test(d)?(d=d.replace("[",""),d=d.replace("]",""),b.attributes&&b.hasAttribute(d)):0<=v(d,c).indexOf(b):!0:!1};v.get=function(b){return v("#"+b).single()};v.set=function(b,d){v("#"+b).single().innerHTML=d};v.fn=q.prototype;return v}();"use strict";
CB.Element=function(){var c=0,b={append:!0},d=function(d,e,h,l){d&&(void 0===this.elDOM&&(this.elDOM=document.createElement(d)),d=l||{},d=ObjUtil.copyTo(b,d,!0),this.uniqueId||(this.uniqueId=++c),this.childs=[],this.isChild=!1,void 0!==e?e instanceof CB.Element?(this.parentDOM=e.elDOM,e.addChild(this),this.isChild=!0):this.parentDOM=e:this.parentDOM=document.body,this.elDOM.id=h?h:"CBEl"+this.uniqueId,this.debug=this.elDOM.id,e=d.append,this.parentDOM&&(e?this.parentDOM.appendChild(this.elDOM):this.parentDOM.insertBefore(this.elDOM,
this.parentDOM.firstChild)),this.style=this.elDOM.style,this.setVisible(!1))};d.prototype.destroy=function(){this.destroyed||(this.childs.forEach(function(b,d){this.childs[d]&&this.childs[d].destroy()}.bind(this)),void 0!==this.extJSEl&&this.elDOM.removeChild(this.extJSEl.getEl().dom),this.parentDOM.removeChild(this.elDOM),this.destroyed=!0)};d.prototype.changeParentElDOM=function(b){if(this.isChild)throw"!Change parent ElDom on Child El ";this.parentDOM&&this.parentDOM.contains(this.elDOM)&&this.parentDOM.removeChild(this.elDOM);
(this.parentDOM=b)&&this.parentDOM.appendChild(this.elDOM)};d.prototype.addChild=function(b){this.childs[b.uniqueId]=b};d.prototype.removeChild=function(b){delete this.childs[b.uniqueId]};d.prototype.destroyChilds=function(){this.childs.forEach(function(b,d){this.childs[d]&&this.childs[d].destroy()}.bind(this));this.childs=[]};d.prototype.setVisible=function(b){this.style.visibility=b?"visible":"hidden";this.childs.forEach(function(d,c){this.childs[c]&&this.childs[c].setVisible(b)}.bind(this));void 0!==
this.extJSEl&&(b?this.extJSEl.show():this.extJSEl.hide())};d.prototype.isVisible=function(){return"visible"==this.style.visibility};d.prototype.setRect=function(b){this.setPos(b.topLeft.x,b.topLeft.y);this.setSize(b.w,b.h)};d.prototype.setRelativePos=function(){this.style.position="relative"};d.prototype.setPos=function(b,d){b=Math.floor(b);d=Math.floor(d);this.x=b;this.y=d;this.style.position="absolute";this.style.left=Math.round(b)+"px";this.style.top=Math.round(d)+"px"};d.prototype.setSize=function(b,
d){b=Math.floor(b);d=Math.floor(d);this.w=b;this.h=d;this.elDOM.width=b;this.elDOM.height=d;this.style.width=b+"px";this.style.height=d+"px";void 0!==this.extJSEl&&(this.extJSEl.setWidth(b),this.extJSEl.setHeight(d));this.vAlign&&(this.style.lineHeight=d+"px");this.onResize()};d.prototype.onResize=function(){};d.prototype.setHeight=function(b){this.h=b=Math.floor(b);this.style.height=b+"px";void 0!==this.extJSEl&&this.extJSEl.setHeight(b)};d.prototype.setPosSize=function(b,d,c,e){this.setPos(b,d);
this.setSize(c,e)};d.prototype.setZIndex=function(b){this.style.zIndex=b};d.prototype.setBorder=function(b,d,c){b=Math.floor(b);this.style.borderWidth=b+"px";void 0!==d&&(this.style.borderColor=d);this.style.borderStyle=void 0!==c?c:"solid"};d.prototype.setCssClass=function(b){this.elDOM.className=b};d.prototype.setBoxShadow=function(b,d,c){this.style.boxShadow=b+"px "+b+"px "+d+"px 0px "+c};d.prototype.setRounded=function(b){b=Math.floor(b);this.style.borderRadius=b+"px"};d.prototype.setBackgroundColor=
function(b){this.backgroundColor=b.toString();this.style.backgroundColor=b.toString()};d.prototype.setColor=function(b){this.style.color=b.toString()};d.prototype.setMargin=function(b){this.style.margin=b+"px"};d.prototype.setPadding=function(b){this.style.padding=b+"px"};d.prototype.setZIndex=function(b){this.style.zIndex=b};d.prototype.setExtJSElement=function(b){this.extJSEl=b};d.enablePointerEvents=function(b,d){b.style.pointerEvents=d?"all":"none"};d.prototype.setClickHandler=function(b){this.elDOM.addEventListener("click",
b)};d.prototype.setHandler=function(b,d){this.elDOM.addEventListener(b,d)};d.addClass=function(b,d){if(!b.className||0>b.className.indexOf(d))b.className+=" "+d};d.removeClass=function(b,d){b.className=b.className.replace(d,"");b.className=b.className.replace(/\s+/g," ")};var e={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};d.isEventSupported=function(b){var d=document.createElement(e[b]||"div");b="on"+b;var c=b in d;c||(d.setAttribute(b,"return;"),c=
"function"==typeof d[b]);return c};d.prototype.setWoodenBackground=function(){this.elDOM.style.background="#101010";this.elDOM.style.backgroundImage="url( "+CB.getCommonPath()+"Media/Chess/OrangeBrighterSoft.jpg )";this.elDOM.style.backgroundSize="100% 100%";this.elDOM.style.backgroundRepeat="no-repeat";this.elDOM.style.backgroundPosition="bottom left"};return d}();"use strict";
CB.DivElement=function(){var c=function(b,d,c){CB.DivElement.superClass.call(this,"div",b,d,c)};CB.inherit(c,CB.Element);c.prototype.setImage=function(b,d,c){void 0===this.imageNode?(this.imageNode=document.createElement("img"),this.imageNode.setAttribute("src",b),this.imageNode.setAttribute("flag","alternate text"),this.imageNode.setAttribute("height",c+"px"),this.imageNode.setAttribute("width",d+"px"),this.elDOM.appendChild(this.imageNode)):this.imageNode.setAttribute("src",b)};c.prototype.setCssClass=
function(b){this.elDOM.className=b};c.prototype.setText=function(b){"undefined"!=typeof b&&(void 0===this.textNode&&(this.textNode=document.createElement("span"),this.textNode.style.display="inline-block",this.elDOM.appendChild(this.textNode),this.textNode.style.cursor="pointer"),b=b.toString(),b.replace(/</g,"("),b.replace(/>/g,")"),this.textNode.textContent?this.textNode.textContent=b:this.textNode.innerText?this.textNode.innerText=b:this.textNode.innerHTML=b)};c.prototype.setTextAlign=function(b){this.style.textAlign=
b;this.textNode&&(this.textNode.textAlign=b)};c.prototype.getText=function(){if(this.textNode){if(this.textNode.textContent)return this.textNode.textContent;if(this.textNode.innerText)return this.textNode.innerText}return""};c.prototype.setZIndex=function(b){this.style.zIndex=b};c.prototype.setFontSize=function(b){if(b)void 0!==this.linkNode?this.linkNode.style.fontSize=Math.round(b)+"px":(this.textNode&&(this.textNode.style.fontSize=Math.round(b)+"px"),this.style.fontSize=Math.round(b)+"px",this.fontH=
Math.round(b),this.centeredText&&this.setCenteredText());else throw Error("FontSize = 0");};c.prototype.setFontFamily=function(b){this.style.fontFamily=b;this.textNode&&(this.textNode.style.fontFamily=b)};c.prototype.setFontWeight=function(b){this.style.fontWeight=b};c.prototype.setVerticalAlign=function(b){void 0===this.textNode&&this.setText(" ");void 0!==this.textNode&&(this.textNode.style.verticalAlign=b,this.textNode.style.display="inline-block",this.textNode.style.lineHeight="normal",void 0!==
this.h&&(this.style.lineHeight=this.h+"px"))};c.prototype.setCenteredText=function(){this.setTextAlign("center");this.setVerticalAlign("middle");this.centeredText=!0;this.style.display="block";this.vAlign=!0};c.prototype.setRightAlign=function(){this.setAlign("right")};c.prototype.setLeftAlign=function(){this.setAlign("left")};c.prototype.setAlign=function(b){this.setTextAlign(b);this.setVerticalAlign("middle");this.centeredText=!1;this.style.display="block"};c.prototype.getTextWidth=function(){return void 0!==
this.textNode?this.textNode.clientWidth:0};c.prototype.getTextHeight=function(){return void 0!==this.textNode?this.textNode.clientHeight:0};c.prototype.setHoverBright=function(){$(this.elDOM).hover(function(){$(this).css("filter","brightness(108%)")},function(){$(this).css("filter","brightness(100%)")})};c.prototype.setURL=function(b,d,c,f){void 0===this.linkNode&&(this.linkNode=document.createElement("a"),this.elDOM.appendChild(this.linkNode));this.linkNode.href=b;this.linkNode.target="_blank";d&&
d.length&&(this.linkNode.textContent?this.linkNode.textContent=d:this.linkNode.innerText=d);c&&c.length&&(this.linkNode.className=c);f&&this.linkNode.setAttribute("onclick","if ( typeof ( ga ) !== 'undefined' && CB.System.runsOnChessBaseDomain() ) ga( 'send', 'event', 'link', "+('"'+d+'"')+");")};return c}();"use strict";
CB.ToolTip=function(){var c=new CB.Color(255,255,248,.95),b=new CB.Color(0,0,0,.9),d=1,e=function(){this.uniqueId=d++;this.background=new CB.DivElement(document.body,"bTTipBG"+this.uniqueId);this.textEl=new CB.DivElement(this.background,"bSTTipText"+this.uniqueId);this.background.elDOM.style.zIndex=99999;this.textEl.setBackgroundColor(c);this.textEl.setColor(b);this.textEl.setFontFamily("Roboto, Helvetica, sans-serif")};e.prototype.destroy=function(){this.background.destroy()};e.prototype.setText=
function(b){this.textEl.setText(b)};e.prototype.setVisible=function(b){this.background.setVisible(b)};e.prototype.setPosSize=function(b,d){var c=Math.max(8,Math.round(.4*d.h)),e=new CB.Rect(b.x,b.y,b.x+d.w,b.y+d.h),q=d.w,r=(e.w-q)/2;e.w=q;e.move(r,0);this.background.setPos(b.x,b.y);this.background.setSize(d.w,d.h);e=Math.max(1,Math.min(4,Math.round(Math.sqrt(d.w/100))));this.background.setBoxShadow(e,8*e,"rgba( 60, 30, 20, 0.3 )");this.textEl.setPos(0,0);this.textEl.setSize(d.w,d.h);this.textEl.setBorder(1,
new CB.Color(0,0,0,.5));this.textEl.setRounded(4);this.textEl.setCenteredText();do this.textEl.setFontSize(c),--c;while(4<c&&(this.textEl.getTextWidth()>q||this.textEl.getTextHeight()>d.h-3));CB.LOG("ToolTip: pos="+b.x+", "+b.y)};return e}();"use strict";
CB.CanvasElement=function(){var c=function(b,d){CB.CanvasElement.superClass.call(this,"canvas",b,d);this._uniqueId=d};CB.inherit(c,CB.Element);c.prototype.setCssClass=function(b){this.elDOM.className=b};c.prototype.setCanvasSize=function(b,d){this.elDOM.width=b;this.elDOM.height=d};c.prototype.render=function(){};c.prototype.setWoodenBackground=function(){this.elDOM.style.background="#101010";this.elDOM.style.backgroundImage="url( "+CB.getCommonPath()+"Media/Chess/OrangeBrighterSoft.jpg )";this.elDOM.style.backgroundSize=
"100% 100%";this.elDOM.style.backgroundRepeat="no-repeat";this.elDOM.style.backgroundPosition="bottom left"};return c}();"use strict";
CB.CanvasParent=function(){var c=1,b=function(b){this.uniqueId=c++;this.background=new CB.DivElement(b,"aCanvParentBG"+this.uniqueId);this.background.setRelativePos();this.canvasEl=new CB.CanvasElement(this.background,"aCanvParentCanvas"+this.uniqueId)};b.prototype.createCanvas=function(b,c){return this.canvas=new CB.Canvas2D(this.canvasEl.elDOM.id,b,c)};b.prototype.changeParent=function(b){this.background.elDOM.parentElement.removeChild(this.background.elDOM);b&&b.appendChild(this.background.elDOM)};
b.prototype.getElDom=function(){return this.background.elDOM};b.prototype.changeParentElDOM=function(b){this.background.changeParentElDOM(b)};b.prototype.setVisible=function(b){this.background.setVisible(b)};b.prototype.setPosSize=function(b,c,f,g){this.background.setPosSize(b,c,f,g);this.canvasEl.setPosSize(0,0,f,g);this.canvas&&this.canvas.resize(f,g)};b.prototype.setSize=function(b,c){this.background.setSize(b,c);this.canvasEl.setSize(b,c);this.canvas&&this.canvas.resize(b,c)};b.prototype.setWoodenBackground=
function(){this.background.setWoodenBackground()};return b}();"use strict";
CB.CanvasParent3D=function(){var c=function(b,d){this.div=new CB.DivElement(b,"boardarea");CB.$("#boardarea").css("visibility","visible");this.canvasId=d};c.prototype.createCanvas=function(b,d){CB.$("#3d").css("visibility","visible");this.canvas=new CB.ThreeJSNoExtJs(this.div.elDOM.id,b,function(){d&&d()}.bind(this));return this};c.prototype.createCanvasInit=function(){this.canvas.canvas.addEventListener("mousedown",this.onMouseDown.bind(this),!1);this.canvas.canvas.addEventListener("mousemove",this.onMouseMove.bind(this),
!1);this.canvas.canvas.addEventListener("mouseup",this.onMouseUp.bind(this),!1);this.control=new CB.BoardArea3D(this.canvas,1,1)};c.prototype.onMouseDown=function(b){this.control.onMouseDown(b)};c.prototype.onMouseUp=function(b){this.control.onMouseUp(b)};c.prototype.onMouseMove=function(b){this.control.onMouseMove(b)};c.prototype.setVisible=function(b){};c.prototype.setPosSize=function(b,d,c,f){this.canvas&&this.canvas.resize(c,f)};c.prototype.setWoodenBackground=function(){};c.prototype.resize=
function(b,d){this.canvas&&this.canvas.resize(b,d)};c.prototype.mousewheel=function(b,d){};c.prototype.DOMMouseScroll=function(b){};return c}();"use strict";CB.namespace("CB.UIElement");
CB.UIElement=function(){var c=function(b,d,c){CB.UIElement.superClass.call(this,b,d,c);this.elDOM&&(this.elDOM.className="cb-button",this.elDOM.addEventListener("mousedown",this.onMouseDown.bind(this)),this.elDOM.addEventListener("mouseup",this.onMouseUp.bind(this)),this.elDOM.addEventListener("mouseover",this.onMouseOver.bind(this)),this.elDOM.addEventListener("mouseleave",this.onMouseLeave.bind(this)))};CB.inherit(c,CB.Element);c.prototype.setText=function(b){b.replace(/</g,"(");b.replace(/>/g,
")");this.elDOM.innerHTML=b};c.prototype.setEnabled=function(b){this.elDOM.disabled=!b};c.prototype.getEnabled=function(){return!this.elDOM.disabled};c.prototype.setHandler=function(b){this.elDOM.addEventListener("click",function(d){b(d)})};c.prototype.setBackgroundColor=function(b){this.backgroundColor=b.toString();this.style.backgroundColor=b.toString()};c.prototype.setHoverColor=function(b){this.hoverColor=b.toString()};c.prototype.setClickColor=function(b){this.clickColor=b.toString()};c.prototype.onMouseDown=
function(){this.clickColor&&(this.style.backgroundColor=this.clickColor)};c.prototype.onMouseUp=function(){this.hoverColor?this.style.backgroundColor=this.hoverColor:this.backgroundColor&&(this.style.backgroundColor=this.backgroundColor)};c.prototype.onMouseOver=function(){this.hoverColor&&(this.style.backgroundColor=this.hoverColor)};c.prototype.onMouseLeave=function(){this.backgroundColor&&(this.style.backgroundColor=this.backgroundColor)};c.prototype.setColor=function(b){this.style.color=b.toString()};
return c}();"use strict";CB.namespace("CB.Button");
CB.Button=function(){var c=function(b,d,c){b&&(CB.Button.superClass.call(this,"button",b,d),this.elDOM.className=c||"cb-button")};CB.inherit(c,CB.Element);c.prototype.setImage=function(b){this.style.backgroundImage="url( "+b+")";this.style.backgroundRepeat="no-repeat";this.style.backgroundPosition="center"};c.prototype.setHandler=function(b){this.elDOM.addEventListener("click",b)};c.prototype.setText=function(b){var d=this.elDOM;d&&("undefined"==typeof d.textContent?d.innerText=b:d.textContent=b)};
c.prototype.setEnabled=function(b){this.elDOM.disabled=!b};return c}();
CB.CloseButton=function(){var c=function(b,d,c){CB.CloseButton.superClass.call(this,b,d,"cb-CloseButton");this.textNode=document.createElement("span");this.textNode.style.display="inline-block";"undefined"!=typeof this.textNode.textContent?this.textNode.textContent="X":this.textNode.innerText="X";this.textNode.style.textAlign="centered";this.textNode.style.verticalAlign="middle";this.textNode.style.cursor="default";this.textNode.style.fontFamily="Roboto, Helvetica, sans-serif";this.elDOM.appendChild(this.textNode);
c&&this.setHandler(c)};CB.inherit(c,CB.Button);c.prototype.onResize=function(){var b=Math.round(.8*this.h);this.style.fontSize=b+"px";this.textNode.style.fontSize=b+"px";this.textNode.style.lineHeight=this.h+"px"};return c}();"use strict";CB.namespace("CB.CheckBox");
CB.CheckBox=function(){var c=function(b,d){CB.CheckBox.superClass.call(this,"form",b,d);this.checkId=this.elDOM.id+"-chk";this.htmlFirstPart='<input type="checkbox" id='+this.checkId+" />";this.elDOM&&(this.elDOM.innerHTML=this.htmlFirstPart)};CB.inherit(c,CB.Element);c.prototype.setChecked=function(b){var d=document.getElementById(this.checkId);d.checked=d.defaultChecked=b};c.prototype.getChecked=function(){return document.getElementById(this.checkId).checked};c.prototype.setEnabled=function(b){document.getElementById(this.checkId).disabled=
!b};c.prototype.getEnabled=function(){return!document.getElementById(this.checkId).disabled};c.prototype.setText=function(b){b.replace(/</g,"(");b.replace(/>/g,")");this.elDOM&&(this.elDOM.innerHTML=this.htmlFirstPart+b)};return c}();"use strict";
CB.Canvas2D=function(){var c=function(b,d,c){this.canvas=document.getElementById(b);if(null===this.canvas)throw Error("ID "+b+" not found.");this.ctx=this.canvas.getContext("2d");this._createDoubleBuffer(b);this._addListeners(b);this.idDOM=b;this.zoomRatio=this.calcZoomRatio();this.control=d.createControl(this,this.canvas.width,this.canvas.height,c);if(d.onControlReady)d.onControlReady(this.control);this.resizeTimer=new CB.Timer(this.resizeHdl.bind(this))};c.prototype.destroyDOM=function(){this.resizeTimer.stop();
this.el&&null!=this.el.destroy&&this.el.destroy();this.control.onDestroyDOM()};c.prototype.drawLine=function(b,d){this.ctx.beginPath();this.ctx.moveTo(b.x,b.y);this.ctx.lineTo(d.x,d.y);this.ctx.stroke()};c.prototype.drawText=function(b,d,c,f){void 0!==f&&(this.ctx.fillStyle=f);void 0!==c&&(this.ctx.font=c+"px sans serif");this.ctx.fillText(d,b.x,b.y)};c.drawEllipse=function(b,d,c,f,g){b.save();b.beginPath();b.translate(d-f,c-g);b.scale(f,g);b.arc(1,1,1,0,2*Math.PI,!1);b.restore();b.lineWidth=5;b.stroke()};
c.prototype.resize=function(b,d){5>b&&(b=5);5>d&&(d=5);this.blockResize||(this.control&&this.control.beforeResize&&this.control.beforeResize(),this.resizeTimer.runOnce(10,function(){this.resizeHdl(b,d)}.bind(this)))};c.prototype.setBlockResize=function(b){this.blockResize=b};c.prototype.onMouseDown=function(b){CB.LOG("Mouse Down: "+b.pageX+", "+b.pageY,"","mouse");var d=this.zoomToPixEvent(b),c=new CB.Rect;c.fromRect(this.canvas.getBoundingClientRect());CB.LOG("Scaled: "+d.x+", "+d.y+", boundRect="+
c);this.control.onMouseDown(b,d);return!1};c.prototype.onContextMenu=function(b){CB.LOG("ContextMenu: "+b.pageX+", "+b.pageY,"","mouse");var d=this.zoomToPixEvent(b),c=new CB.Rect;c.fromRect(this.canvas.getBoundingClientRect());CB.LOG("Scaled: "+d.x+", "+d.y+", boundRect="+c,"","mouse");if(this.control.onContextMenu)this.control.onContextMenu(b,d);b.preventDefault();return!1};c.prototype.onMouseUp=function(b){CB.LOG("Mouse Up","","mouse");var d=this.zoomToPixEvent(b);this.control.onMouseUp(b,d);return!1};
c.prototype.onMouseMove=function(b){var d=this.zoomToPixEvent(b);this.control.onMouseMove(b,d);return!1};c.prototype.onMouseWheel=function(b){var d=this.zoomToPixEvent(b);this.control.onMouseWheel(b,d)};c.prototype.onDoubleClick=function(b){var d=this.zoomToPixEvent(b);CB.LOG("DCLICK:"+this.getClickPos(d),"","mouse");this.getClickPos(d);this.control.onDoubleClick(b,d)};c.prototype.onMouseEnter=function(b){var d=this.zoomToPixEvent(b);this.control.onMouseEnter(b,d)};c.prototype.onMouseLeave=function(b){var d=
this.zoomToPixEvent(b);this.control.onMouseLeave(b,d)};c.prototype.onTouchStart=function(b){if(!this.isDefaultPrevented(b)){CB.LOG("Touch Start","","touch");b.touches&&(this.touchStartX=b.touches[0].clientX,this.touchStartY=b.touches[0].clientY);var d=this.zoomToPixEvent(b);this.control.onMouseDown(b,d)}};c.prototype.onTouchEnd=function(b){if(!this.isDefaultPrevented(b)){delete this.touchStartX;CB.LOG("Touch End","","touch");var d=this.zoomToPixEvent(b);this.control.onMouseUp(b,d)}};c.prototype.onTouchMove=
function(b){if(!this.isDefaultPrevented(b)){CB.LOG("Touch Move","","touch");var d=this.zoomToPixEvent(b);this.control.onMouseMove(b,d);delete this.touchStartX}};c.prototype.isDefaultPrevented=function(b){return void 0!==b.parentEvent&&void 0!==b.parentEvent.browserEvent?b.parentEvent.browserEvent.defaultPrevented:b.defaultPrevented};c.prototype.onTouchLeave=function(b){delete this.touchStartX};c.prototype.onTouchCancel=function(b){delete this.touchStartX;CB.LOG("Touch Cancel","","touch")};c.prototype.onKeyDown=
function(b){CB.LOG("Key Down")};c.prototype.onKeyUp=function(b){CB.LOG("Key Up")};c.prototype.onKeyPress=function(b){CB.LOG("Key Press")};c.prototype.zoomToPixEvent=function(b){return b.touches&&b.touches.length?new CB.Point(this.zoomToPixX(b.touches[0].pageX),this.zoomToPixY(b.touches[0].pageY)):b.changedTouches&&b.changedTouches.length?new CB.Point(this.zoomToPixX(b.changedTouches[0].pageX),this.zoomToPixY(b.changedTouches[0].pageY)):new CB.Point(this.zoomToPixX(b.pageX),this.zoomToPixY(b.pageY))};
c.prototype.zoomToPixX=function(b){return(b-this.canvas.getBoundingClientRect().left-window.pageXOffset)*this.zoomRatio};c.prototype.zoomToPixY=function(b){return(b-this.canvas.getBoundingClientRect().top-window.pageYOffset)*this.zoomRatio};c.prototype.pixToZoomX=function(b){return this.canvas.getBoundingClientRect().left-window.pageXOffset+b/this.zoomRatio};c.prototype.pixToZoomY=function(b){return this.canvas.getBoundingClientRect().top-window.pageYOffset+x/this.zoomRatio};c.prototype.zoomToPix=
function(b){return this.zoomRatio?b/this.zoomRato:b};c.prototype.pixToZoom=function(b){return this.zoomRatio?b/this.zoomRatio:b};c.prototype.zoomToPix=function(b){return this.zoomRatio?b*this.zoomRatio:b};c.prototype.zoomToPixRect=function(b){var d=this.zoomToPix(b.left),c=this.zoomToPix(b.top);return new CB.Rect(d,c,d+b.w*this.zoomRatio,c+b.h*this.zoomRatio)};c.prototype.pixToZoomRect=function(b){var d=this.pixToZoom(b.left),c=this.pixToZoom(b.top);return new CB.Rect(d,c,d+b.w/this.zoomRatio,c+b.h/
this.zoomRatio)};c.prototype.getClickPos=function(b){var d=this.canvas.getBoundingClientRect();return new CB.Point(b.getX()-d.left,b.getY()-d.top)};c.prototype.getBoundingClientRect=function(){var b=this.canvas.getBoundingClientRect();return new CB.Rect(b.left,b.top,b.right,b.bottom)};c.prototype.execStr=function(b){};c.prototype._addListeners=function(b){b=CB.$.get(b);b=CB.$(b);CB.Element.isEventSupported("touchstart")&&(b.on("touchstart",this.onTouchStart.bind(this)),b.on("touchend",this.onTouchEnd.bind(this)),
b.on("touchmove",this.onTouchMove.bind(this)),b.on("touchcancel",this.onTouchCancel.bind(this)),b.on("touchleave",this.onTouchLeave.bind(this)));CB.Element.isEventSupported("mousedown")&&(b.on("mousedown",this.onMouseDown.bind(this)),b.on("mouseup",this.onMouseUp.bind(this)),b.on("mousemove",this.onMouseMove.bind(this)),b.on("mousewheel",this.onMouseWheel.bind(this)),b.on("mouseenter",this.onMouseEnter.bind(this)),b.on("mouseleave",this.onMouseLeave.bind(this)),b.on("dblclick",this.onDoubleClick.bind(this)));
if(CB.Element.isEventSupported("contextmenu"))b.on("contextmenu",this.onContextMenu.bind(this));b.on("keydown",this.onKeyDown.bind(this));b.on("keyup",this.onKeyUp.bind(this));b.on("keypress",this.onKeyPress.bind(this))};c.prototype._createDoubleBuffer=function(b){this.buffer=document.createElement("canvas");this.buffer.width=this.canvas.width;this.buffer.height=this.canvas.height;this.bufferCtx=this.buffer.getContext("2d")};c.prototype.cutClipRect=function(b){this.clipRect=this.clipRect?this.clipRect.getCutAtBoundary(b):
b};c.prototype._drawDoubleBufferClipped=function(){this.ctx.save();this.clipRect?CB.CanvasTools.clipRect(this.ctx,this.clipRect):CB.CanvasTools.clipRect(this.ctx,new CB.Rect(1,1,this.canvas.width-1,this.canvas.height-1));this.ctx.globalCompositeOperation="copy";try{this.ctx.drawImage(this.buffer,0,0)}catch(b){}this.ctx.restore();delete this.clipRect;this.dirty=!1;this.requestIdClipped=null};c.prototype._drawDoubleBuffer=function(){CB.LOG("DrawDBuff");var b=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation=
"copy";this.ctx.drawImage(this.buffer,0,0);this.ctx.globalCompositeOperation=b;this.dirty=!1;delete this.clipRect;this.requestId=null};c.prototype.joinClipRect=function(b){this.clipRect=this.clipRect?this.clipRect.getUnion(b):b};c.prototype.cancelAnimationFrames=function(){this.requestIdClipped&&window.cancelAnimationFrame(this.requestIdClipped);this.requestId&&window.cancelAnimationFrame(this.requestId)};c.prototype.block=function(b){this.blocked=b};c.prototype.requestAnimation=function(b){this.blocked||
1>this.canvas.width||1>this.canvas.height||(b?(this.joinClipRect(b),this.dirty=!0,this.requestIdClipped&&window.cancelAnimationFrame(this.requestIdClipped),this.requestIdClipped=window.requestAnimationFrame(this._drawDoubleBufferClipped.bind(this))):(this.dirty=!0,this.requestId&&(CB.LOG("Cancel Anim="+this.requestIdClipped),window.cancelAnimationFrame(this.requestId)),this.requestIdClipped&&window.cancelAnimationFrame(this.requestIdClipped),this.clipRect=new CB.Rect(1,1,this.canvas.width,this.canvas.height),
this.requestId=window.requestAnimationFrame(this._drawDoubleBufferClipped.bind(this))))};c.prototype.onControlForegroundReady=function(){this.control.drawForeground(this.bufferCtx)};c.prototype.onControlBackgroundReady=function(){this.control&&this.control.drawWood&&this.control.drawWood(this.bufferCtx)};c.prototype.resizeHdl=function(b,d){b=Math.floor(b);d=Math.floor(d);this.scaleToBrowserZoom(b,d)||(this.clipRect=this.lastClipRect=new CB.Rect(0,b,0,d),this.zoomRatio=1,this.setCanvasSizeNonZoomed(this.canvas,
b,d),this.setCanvasSizeNonZoomed(this.buffer,b,d),this.control&&this.control.resize(b,d))};c.prototype.setCanvasSizeNonZoomed=function(b,d,c){b.width=d;b.height=c;b.style.width=d+"px";b.style.height=c+"px"};c.prototype.scaleToBrowserZoom=function(b,d){return 1!=this.calcZoomRatio()?(this.clipRect=this.lastClipRect=new CB.Rect(0,b,0,d),this.zoomRatio=this.calcZoomRatio(),this.scaleCanvas(this.canvas,this.ctx,b,d,this.zoomRatio),this.scaleCanvas(this.buffer,this.bufferCtx,b,d,this.zoomRatio),this.control.resize(b*
this.zoomRatio,d*this.zoomRatio),!0):!1};c.prototype.calcZoomRatio=function(){var b=window.devicePixelRatio,b=Math.min(3,b);CB.System.overrideDeviceZoom(b);return b};c.prototype.scaleCanvas=function(b,d,c,f,g){b.width=Math.round(c*g);b.height=Math.round(f*g);b.style.width=c+"px";b.style.height=f+"px";CB.LOG("CanvasWH="+b.width+", "+b.height,"","canv")};c.prototype.getBackStorePixelRatio=function(){return this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||
this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1};c.prototype.getDevicePixelRatio=function(){alert(0);return window.devicePixelRatio};c.prototype.hide=function(){this.canvas.style.visibility="hidden"};c.prototype.show=function(){this.canvas.style.visibility="visible"};c.prototype.requestRedraw=function(){this.blocked||(delete this.clipRect,this.control&&this.control.draw(this.bufferCtx),this.requestAnimation(new CB.Rect(1,1,this.canvas.width-1,this.canvas.height-1),!0))};return c}();
(function(){for(var c=0,b=["ms","moz","webkit","o"],d=0;d<b.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[b[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[d]+"CancelAnimationFrame"]||window[b[d]+"CancelRequestAnimationFrame"];for(d=0;d<b.length&&!window.cancelAnimationFrame;++d)window.cancelAnimationFrame=window[b[d]+"CancelAnimationFrame"]||window[b[d]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,
d){var g=(new Date).getTime(),h=Math.max(0,16-(g-c)),l=window.setTimeout(function(){b(g+h)},h);c=g+h;return l});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(b){clearTimeout(b)})})();"use strict";
CB.Storage=function(){var c=function(){window.localStorage?this.storage=window.localStorage:window.sessionStorage&&(this.storage=window.sessionStorage)};c.prototype.save=function(b,d){d&&void 0!==this.storage&&(this.storage[b]=JSON.stringify(d))};c.prototype.load=function(b){if(void 0!==this.storage&&this.storage[b]&&"undefined"!==this.storage[b])return JSON.parse(this.storage[b])};return c}();"use strict";
CB.Audio=function(){var c=1,b=function(b,e,f){this.audio=document.createElement("audio");var g=this.getFormat();this.ok=!1;g?(this.url=b+g,this.audio.addEventListener("canplay",this.onCanPlay.bind(this),!1),this.audio.addEventListener("canplaythrough",this.onCanPlayThrough.bind(this),!1),this.audio.addEventListener("ended",this.onEnded.bind(this),!1),this.audio.addEventListener("error",this.onError.bind(this),!1),this.audio.addEventListener("abort",this.onError.bind(this),!1),this.audio.src=b+g,this.fnEnded=
e,this.isQueued=this.canPlay=!1,this.uniqueId=c++,f?this.audio.preload="none":(this.audio.preload="metadata",this.audio.load(),this.ok=!0)):(CB.LOG("Audio not supported","LogError"),this.url="!format!")};b.prototype.load=function(){this.audio.load();this.ok=!0};b.prototype.toString=function(){return this.url};b.prototype.play=function(){try{this.audio.play()}catch(b){console.log(b)}};b.prototype.pause=function(){this.audio.pause()};b.prototype.onCanPlay=function(){};b.prototype.onCanPlayThrough=function(){};
b.prototype.onEnded=function(){this.fnEnded&&this.fnEnded(this.uniqueId)};b.prototype.onError=function(){};b.prototype.getFormat=function(){if(this.audio.canPlayType){var b=this.audio.canPlayType("audio/mpeg");if(""!=b)return".mp3";b=this.audio.canPlayType("audio/ogg");if(""!=b)return".ogg"}return""};return b}();
CB.AudioQueue=function(){var c=function(){this.queue=[];this.nextId=0;this.enabled=!0};c.prototype.push=function(b){if(this.enabled&&b){var d=b;"string"==typeof b&&(d=new CB.Audio(b));d.fnEnded=this.callBackPlayed.bind(this);d.ok&&this.queue.push(d);1==this.queue.length&&d.play()}};c.prototype.enable=function(b){(this.enabled=b)||this.stopAll()};c.prototype.isEnabled=function(){return this.enabled};c.prototype.stopAll=function(){this.currPlaying&&this.currPlaying.pause();for(var b=0;b<this.queue.length;b++)this.queue[b]&&
this.queue[b].pause();this.queue=[];delete this.currPlaying};Object.defineProperty(c.prototype,"length",{get:function(){return this.queue.length},set:function(b){this.queue.length>b&&this.queue.splice(0,this.queue.length-b)},enumerable:!0});c.prototype.callBackPlayed=function(b){for(var d=0;d<this.queue.length;d++)if(this.queue[d]&&this.queue[d].uniqueId==b){d<this.queue.length-1&&this.queue[d+1].play();this.queue.splice(d,1);break}};return c}();"use strict";
CB.Canvas3D=function(){var c=function(b,d){this.control=d.createControl3D(b,0,0);if(d.onControlReady)d.onControlReady(this.control);this._addListeners(b);this.resizeTimer=new CB.Timer(this.resizeHdl.bind(this))};c.prototype.onThreeRender=function(b,d){this.control.onThreeRender(b,d)};c.prototype.dispose=function(){this.control.dispose()};c.prototype.drawLine=function(b,d){};c.prototype.drawText=function(b,d,c,f){};c.prototype.resize=function(b,d){this.width=b;this.height=d;this.blockResize||this.resizeTimer.runOnce(100,
function(){this.resizeHdl(b,d)}.bind(this))};c.prototype.renderScene=function(){};c.prototype.resizeHdl=function(b,d){b=Math.floor(b);d=Math.floor(d);this.control.resize(b,d)};c.prototype.block=function(b){this.blocked=b};c.prototype.setBlockResize=function(b){this.blockResize=b};c.prototype.onTouchStart=function(b){this.control.onTouchStart(b)};c.prototype.onTouchEnd=function(b){this.control.onTouchEnd(b)};c.prototype.onTouchMove=function(b){this.control.onTouchMove(b)};c.prototype.onTouchCancel=
function(b){this.control.onTouchCancel(b)};c.prototype.onTouchLeave=function(b){this.control.onTouchLeave(b)};c.prototype.onMouseDown=function(b){this.control.onMouseDown(b)};c.prototype.onMouseUp=function(b){this.control.onMouseUp(b)};c.prototype.onMouseMove=function(b){this.control.onMouseMove(b)};c.prototype.onMouseWheel=function(b){CB.LOG("Wheel:"+b.getWheelDelta())};c.prototype.onDoubleClick=function(b){CB.LOG("DCLICK:"+this.getClickPos(b));this.getClickPos(b);this.control.onDoubleClick(b)};
c.prototype.onMouseEnter=function(b){this.control.onMouseEnter(b)};c.prototype.onMouseLeave=function(b){this.control.onMouseLeave(b)};c.prototype.onKeyDown=function(b){CB.LOG("Key Down")};c.prototype.onKeyUp=function(b){CB.LOG("Key Up")};c.prototype.onKeyPress=function(b){CB.LOG("Key Press")};c.prototype.getClickPos=function(b){var d=this.canvas.getBoundingClientRect();return new CB.Point(b.getX()-d.left,b.getY()-d.top)};c.prototype.getBoundingClientRect=function(){var b=this.canvas.getBoundingClientRect();
return new CB.Rect(b.left,b.top,b.right,b.bottom)};c.prototype.execStr=function(b){};c.prototype._addListeners=function(b){CB.Element.isEventSupported("touchstart")&&(b.canvas.addEventListener("touchstart",this.onTouchStart.bind(this),!1),b.canvas.addEventListener("touchend",this.onTouchEnd.bind(this),!1),b.canvas.addEventListener("touchmove",this.onTouchMove.bind(this),!1),b.canvas.addEventListener("touchcancel",this.onTouchCancel.bind(this),!1),b.canvas.addEventListener("touchleave",this.onTouchLeave.bind(this),
!1));b.canvas.addEventListener("mousedown",this.onMouseDown.bind(this),!1);b.canvas.addEventListener("mousemove",this.onMouseMove.bind(this),!1);b.canvas.addEventListener("mouseup",this.onMouseUp.bind(this),!1)};c.prototype.cutClipRect=function(b){this.clipRect=this.clipRect?this.clipRect.getCutAtBoundary(b):b};c.prototype.joinClipRect=function(b){this.clipRect=this.clipRect?this.clipRect.getUnion(b):b};c.prototype.requestAnimation=function(b,d){};c.prototype.onControlForegroundReady=function(){CB.LOG("onControlForegroundReady");
this.control.drawForeground(this.ctx);this.control.drawForeground(this.bufferCtx)};c.prototype.onControlBackgroundReady=function(){this.control.draw(this.ctx);this.control.draw(this.bufferCtx)};c.prototype.requestRedraw=function(){this.renderScene()};c.prototype.pixToZoom=function(b){return this.zoomRatio?b/this.zoomRatio:b};c.prototype.zoomToPix=function(b){return this.zoomRatio?b*this.zoomRatio:b};c.prototype.zoomToPixRect=function(b){var d=this.zoomToPix(b.left),c=this.zoomToPix(b.top);return new CB.Rect(d,
c,d+b.w*this.zoomRatio,c+b.h*this.zoomRatio)};c.prototype.pixToZoomRect=function(b){var d=this.pixToZoom(b.left),c=this.pixToZoom(b.top);return new CB.Rect(d,c,d+b.w/this.zoomRatio,c+b.h/this.zoomRatio)};return c}();
(function(){for(var c=0,b=["ms","moz","webkit","o"],d=0;d<b.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[b[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[d]+"CancelAnimationFrame"]||window[b[d]+"CancelRequestAnimationFrame"];for(d=0;d<b.length&&!window.cancelAnimationFrame;++d)window.cancelAnimationFrame=window[b[d]+"CancelAnimationFrame"]||window[b[d]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,
d){var g=(new Date).getTime(),h=Math.max(0,16-(g-c)),l=window.setTimeout(function(){b(g+h)},h);c=g+h;return l});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(b){clearTimeout(b)})})();"use strict";
CB.Queue=function(){var c=function(){this.nOffset=0;this.queue=[]};c.prototype={getLength:function(){return this.queue.length-this.nOffset},empty:function(){return 0==this.queue.length},push:function(b){this.queue.push(b)},pop:function(){if(0!=this.queue.length){var b=this.queue[this.nOffset];2*++this.nOffset>=this.queue.length&&(this.queue=this.queue.slice(this.nOffset),this.nOffset=0);return b}},front:function(){return 0<this.queue.length?this.queue[this.nOffset]:void 0}};return c}();"use strict";
CB.BinToString={StringToByteArray:function(c,b){for(var d=0,e=0,f=0,g=0;g<b.length;g++){var h=b[g].charCodeAt(0);if(63>h||126<h)return 1;h-=63;2>=e?(f|=h<<2-e,e+=6,8<=e&&(e-=8,c[d++]=f&255,f=0)):(e-=2,f|=h>>e,c[d++]=f&255,f=h<<8-e)}return d},ByteArrayToString:function(c,b){var d="";if(0<b){for(var e=[],f=0,g=0,h=0;g<b;)2>=h?(e[f++]=63+(c[g]>>2-h&63)&255,h+=6,8<=h&&(g++,h-=8)):(h-=2,e[f]=c[g]<<h&63,g++,g<b?e[f]|=c[g]>>8-h&63:h=0,e[f++]+=63);for(g=e[f]=0;g<f;g++)d+=String.fromCharCode(e[g])}else d=
"";return d},ByteArrayToBase64:function(c){for(var b="",d,e,f,g,h,l,q=0;q<c.length;)d=c[q++],e=c[q++],f=c[q++],g=d>>2,d=(d&3)<<4|e>>4,h=(e&15)<<2|f>>6,l=f&63,isNaN(e)?h=l=64:isNaN(f)&&(l=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);
return b},ByteArrayToDataURI:function(c,b){var d=this.ByteArrayToBase64(c);return"data:"+b+";charset=utf-8;base64,"+d}};"use strict";CB.LineEvalType={LOWERBOUND:1,UPPERBOUND:2,EXACT:3};
CB.EngineValue=function(){var c={MATE_VALUE:3E4,MATE_THRESHOLD:28E3,MOVE_VALUE:28E3,MOVE_THRESHOLD:26E3};c.MIN_VALUE=-c.MATE_VALUE;c.MAX_VALUE=c.MATE_VALUE;c.getMateEval=function(b){return 0>b?-c.MATE_VALUE-b:c.MATE_VALUE-b};c.getMovesToMate=function(b){return b>-c.MATE_THRESHOLD||b<c.MATE_THRESHOLD?-1:0>b?b-c.MATE_THRESHOLD:c.MATE_THRESHOLD-b};return c}();
CB.EvaluationGrade=function(){var c={EV_TOTALLY_WINNING:200,EV_WINNING:140,EV_ADVANTAGE:70,EV_SLIGHT_ADVANTAGE:25};c.EV_TOTALLY_LOSING=-c.EV_TOTALLY_WINNING;c.EV_LOSING=-c.EV_WINNING;c.EV_DISADVANTAGE=-c.EV_ADVANTAGE;c.EV_SLIGHT_DISADVANTAGE=-c.EV_SLIGHT_ADVANTAGE;c.getGlyph=function(b){return b>=c.EV_WINNING?CB.SpecialGlyphs.W_DECIS_ADV:b>=c.EV_ADVANTAGE?CB.SpecialGlyphs.W_MODER_ADV:b>c.EV_SLIGHT_ADVANTAGE?CB.SpecialGlyphs.W_SLIGHT_ADV:b>=c.EV_SLIGHT_DISADVANTAGE?CB.SpecialGlyphs.EQUAL_ACTIVE_POS:
b>c.EV_DISADVANTAGE?CB.SpecialGlyphs.B_SLIGHT_ADV:b>c.EV_LOSING?CB.SpecialGlyphs.B_MODER_ADV:CB.SpecialGlyphs.B_DECIS_ADV};return c}();CB.PredefinedEngineOptions={MultiPV:"MultiPV",Ponder:"Ponder"};
CB.EngineInstance=function(){var c={getPosString:function(b){var c="position startpos";b.isNormalInit()||(c="position fen "+b.getStartPos().toFEN());b=b.getCurLineCut();if(0<b.length)for(var c=c+" moves",f=0;f<b.length;++f)c+=" "+b[f].toString();return c},getGoString:function(b){var c=new StringBuilder;c.append("go ");b=b||{};b.depth?c.appendFormat("depth {0} ",b.depth):b.moveTime&&c.appendFormat("movetime {0} ",Math.round(b.moveTime));b.wTime&&c.appendFormat("wtime {0} ",Math.round(b.wTime));b.bTime&&
c.appendFormat("btime {0} ",Math.round(b.bTime));(b.infinite||ObjUtil.isEmpty(b))&&c.appendFormat("infinite ");return c.toString()},getSetOptionString:function(b,c){var f=String.formatEx("setoption name {0}",b);"undefined"!==typeof c&&(f+=String.formatEx(" value {0}",c));return f}},b=function(d,c,f,g){console.log(d);CB.LOG(d);this.url=d;this.worker=null;this.calculating=!1;this.tag=f||null;this.name=g;this.szPool=c;this.pool=[];this.cur=null;this.lines=[];this.meta={name:"",author:""};this.metaDone=
!1;this.szPool&&(this.idPoolTimeout=setInterval(this._poolTimeout.bind(this),b.POOL_TIMEOUT));this.engOptionVals=CB.EngineInstance._createPreDefaultOptions();0<this.szPool&&this._pushWorker();this.id=++b.engineCount;this.minDepthForFire=0};b.engineCount=0;b._createPreDefaultOptions=function(){var b={};b[CB.PredefinedEngineOptions.MultiPV]=1;b[CB.PredefinedEngineOptions.Ponder]="false";return b};b.prototype.setMinDepthForFire=function(b){this.minDepthForFire=b};b.prototype.getTag=function(){return this.tag};
b.prototype.setTag=function(b){this.tag=b};b.prototype._killWorker=function(){CBDebug.assert(null!=this.worker);CBDebug.assert(this.calculating);this.calculating=!1;this.worker.terminate();this.worker=null;this.loadingWorker=!1};b.prototype._handleBestMove=function(b){b=b.split(" ");var c=CB.Move.fromString(b[1]),f;"ponder"==b[2]&&(f=CB.Move.fromString(b[3]));this.calculating=!1;this.fireOnBestMove(this,{move:c,ponder:f})};b.prototype._handleInfo=function(b){for(var c=b.split(" "),f=b=null,g=null,
h=1,l=null,q=null,r=null,t=null,v=null,y=null,A=CB.LineEvalType.EXACT,w=!1,z=1;z<c.length;++z)switch(c[z]){case "depth":b=parseInt(c[++z]);break;case "seldepth":f=parseInt(c[++z]);break;case "nps":q=parseInt(c[++z]);break;case "nodes":r=parseInt(c[++z]);break;case "score":var C=c[++z],g=parseInt(c[++z]);switch(C){case "mate":w=!0}break;case "time":t=parseInt(c[++z]);break;case "currmovenumber":y=parseInt(c[++z]);break;case "currmove":C=c[++z];v=CB.Move.fromString(C);break;case "lowerbound":A=CB.LineEvalType.LOWERBOUND;
break;case "upperbound":A=CB.LineEvalType.UPPERBOUND;break;case "multipv":h=parseInt(c[++z]);break;case "pv":for(l=[],++z;z<c.length;++z)if(C=c[z],CB.Move.isValidString(C))l.push(CB.Move.fromString(C));else{--z;break}}f=f||b;b&&b>this.minDepthForFire&&this.fireOnInfo(this,b,f,r,q,t);v&&(this.linesOnly||this.fireOnCurMove(this,y,v));l&&(this.lines[h-1]=l,b>this.minDepthForFire||2>=b)&&(c=ObjUtil.clone(l),this.fireOnLine(this,b,f,A,w,g,h,c,{handicapStyle:0,analysis:this.currGoOptions&&this.currGoOptions.infinite}))};
b.g_regexMeta=/^id (\w+) (.*)$/i;b.prototype._handleIdInfo=function(d){this.metaDone||(d=b.g_regexMeta.exec(d))&&d.length&&(this.meta[d[1]]=d[2])};b.prototype._handleUCIOK=function(b){this.metaDone||(this.metaDone=!0,this.linesOnly||this.fireOnUCIInfo(this))};b.prototype._handle=function(b){"readyok"!==b&&("uciok"===b?this._handleUCIOK():b.startsWith("id")?this._handleIdInfo(b):b.startsWith("option")||(b.startsWith("bestmove")?this._handleBestMove(b):b.startsWith("info")&&this._handleInfo(b)))};b.prototype._onMessage=
function(b){this.loadingWorker=!1;this._handle(b.data)};b.prototype._post=function(b){try{this.worker&&this.worker.postMessage(b)}catch(c){CB.LogException("Post",c)}};b.POOL_TIMEOUT=4E3;b.prototype.pool=[];b.prototype._getWorker=function(){if(0==this.pool.length)try{return new Worker(this.url)}catch(b){alert("Engine: "+b)}return this.pool.pop()};b.prototype._poolTimeout=function(){this.pool.length>=this.szPool||this._pushWorker()};b.prototype._pushWorker=function(){try{CB.EngineInstance.isAjax?this._startWorkerAjax(function(b){this.pool.push(b)}.bind(this)):
this.pool.push(new Worker(this.url))}catch(b){CB.LogException("Engine "+this.url,b)}};b.prototype._startWorker=function(){try{if(this.worker=this._getWorker())this.worker.onmessage=this._onMessage.bind(this),this._post("uci"),this._post("isready"),this._sendPendingOptions()}catch(b){CB.LogException("Start this.url",b)}};b.prototype.go=function(b,e){this.currGoOptions=e||{infinite:!0};this.stop();this.calculating=!0;this.linesOnly||this.fireOnSearchStart();if(this.worker||this.loadingWorker)CB.LOG("Go, Worker already there");
else{this.loadingWorker=!0;if(CB.EngineInstance.isAjax){this._startWorkerAjax(function(b){return function(d){this.loadingWorker=!1;this.worker=d;this.worker.onmessage=this._onMessage.bind(this);this._post("uci");this._post("isready");this._sendPendingOptions();d=c.getPosString(b);var e=c.getGoString(this.currGoOptions);""!=e&&(this.cur=ObjUtil.clone(b.getCurPos()),this.lines=[],this._post(d),this._post(e))}.bind(this)}.call(this,b));return}this._startWorker()}var f=c.getPosString(b),g=c.getGoString(this.currGoOptions);
""!=g&&(this.cur=ObjUtil.clone(b.getCurPos()),this.lines=[],this._post(f),this._post(g))};b.prototype.getCurPos=function(){return this.cur};b.prototype.getLines=function(){return this.lines};b.prototype.getBestMove=function(){return 0==this.lines.length||0==this.lines[0].length?null:this.lines[0][0]};b.prototype.stop=function(){this.worker&&this.calculating&&(this._post("quit"),this._killWorker())};b.prototype.getName=function(){return this.meta.name};b.prototype.isCalculating=function(){return this.calculating};
b.prototype.setHighestMoveInBook=function(){};b.prototype.newGame=function(){this.worker&&!this.calculating&&this._post("ucinewgame");this.linesOnly||this.fireOnNewGame()};b.prototype.dispose=function(){if(this.szPool){if(this.pool.length)for(var b=0;b<this.pool.length;++b)this.pool[b].terminate();clearInterval(this.idPoolTimeout)}this.removeAllListeners()};b.prototype.exit=function(){this.stop();this.dispose();this.fireOnExit()};b.prototype.engOptionVals=null;b.prototype.setOption=function(b,e){this.engOptionVals[b]=
e;this.worker&&this._post(c.getSetOptionString(b,e))};b.prototype.getOption=function(b){return this.engOptionVals[b]};b.prototype.setMultiPV=function(b){this.setOption(CB.PredefinedEngineOptions.MultiPV,b)};b.prototype.getMultiPV=function(){return this.getOption(CB.PredefinedEngineOptions.MultiPV)};b.prototype.clearHash=function(){};b.prototype.setPonder=function(b){this.setOption(CB.PredefinedEngineOptions.Ponder,b?"true":"false")};b.prototype.offerDrawToEngine=function(){return!1};b.prototype._sendPendingOptions=
function(){for(var b in this.engOptionVals)this.engOptionVals.hasOwnProperty(b)&&this._post(c.getSetOptionString(b,this.engOptionVals[b]))};b.prototype._startWorkerAjax=function(b){var c="https://pgn.chessbase.com/common/chess/engine/df14/df14AjaxData.js";V15.canRunWebAssembly()&&(c="https://pgn.chessbase.com/common/chess/engine/webasm/fritzajax3.js");$.ajax({url:c,type:"GET",data:{},async:!0,cache:!0,processData:!1,success:function(c){c=new Blob([c],{type:"application/javascript"});c=new Worker(URL.createObjectURL(c));
b(c)}})};Ve.initForListeners(b);Ve.addEvent(b,"Line");Ve.addEvent(b,"LosingLine");Ve.addEvent(b,"CurMove");Ve.addEvent(b,"CurLine");Ve.addEvent(b,"Info");Ve.addEvent(b,"BestMove");Ve.addEvent(b,"UCIInfo");Ve.addEvent(b,"NewGame");Ve.addEvent(b,"SearchStart");Ve.addEvent(b,"Exit");Ve.addEvent(b,"Threat");return b}();"use strict";
CB.AnalysisEngine=function(){var c={},b=function(d){d=d||{};this.options=ObjUtil.copyTo(c,d,!0);this.szPool=0;V15.canRunWebAssembly()&&(this.szPool=4);this.loadEngineInstance();this.id=++b.engineCount};b.engineCount=0;b.prototype.destroy=function(){};b.prototype.loadEngineInstance=function(){this.engine=new CB.EngineInstance(V15.config.getEngineUrl()[0],this.szPool,1,"Analysis");this.options.minDepthForFire&&this.engine.setMinDepthForFire(this.options.minDepthForFire);this.idOnLine=this.engine.addOnLineListener(this._onLine.bind(this))};
b.prototype.onGameNavigate=function(){};b.prototype.engineGo=function(b){this._resetGoState();this.kernel=b;this.engine.setMultiPV(this._getNVarsToCalc());this.engine.go(this.kernel.game,{infinite:!0});this.engine.fireOnThreat(!1);this.running=!0};b.prototype.threatGo=function(b){this._resetGoState();this.engine.setMultiPV(2);this.engine.go(b,{infinite:!0});this.running=!0};b.prototype.engineStop=function(){this.engine.stop();this.running=!1};b.prototype.clearLines=function(){this._resetGoState()};
b.prototype.dispose=function(){this.engine.exit()};b.prototype.linkPlayingMode=function(b){b.getMarkedSquaresOnButtonDown&&(b.clickHintTimer||(b.clickHintTimer=new CB.Timer),b.kernel.boardWin.fnMarkSquaresOnButtonDown=b.getMarkedSquaresOnButtonDown.bind(b),b.startClickHintTimer&&(b.kernel.boardWin.fnSquareClick=b.startClickHintTimer.bind(b)),b.kernel.boardWin.fnSquareChangeInMouseMove=function(){b.clickHintTimer&&b.clickHintTimer.stop()}.bind(b),b.kernel.boardWin.fnSquareRelease=function(){b.clickHintTimer&&
b.clickHintTimer.stop()}.bind(b),b.idOnLineListener||(b.idOnLineListener=this.addOnLineListener(b.onAnalysisLine.bind(b)),b.kernel.boardWin.idOnLineListener||(b.kernel.boardWin.idOnLineListener=this.addOnLineListener(b.kernel.boardWin.refreshMarkedSquares.bind(b.kernel.boardWin)))))};b.prototype.unlinkPlayingMode=function(b){b.clickHintTimer&&b.clickHintTimer.stop();b.kernel.boardWin&&(b.kernel.boardWin.fnSquareClick=null,b.kernel.boardWin.fnMarkSquaresOnButtonDown=null,this.removeOnLineListener(b.kernel.boardWin.idOnLineListener),
b.kernel.boardWin.idOnLineListener=null);this.removeOnLineListener(b.idOnLineListener);b.idOnLineListener=null};b.prototype.linkPlayingModeForThreat=function(b){b.idOnThreatLineListener||(b.idOnThreatLineListener=this.addOnLineListener(b.onThreatLine.bind(b)))};b.prototype.unlinkPlayingModeForThreat=function(b){this.removeOnLineListener(b.idOnThreatLineListener);b.idOnThreatLineListener=null};b.prototype._getNVarsToCalc=function(){return this.nFixedVars?this.nFixedVars:128};b.prototype.getHintSquaresOnButtonDown=
function(b){var c=[];if(0<this.lastDepth){var f=CB.AnalysisEngine.linesToArray(this.curLines[this.lastDepth-1]);f.sort(function(b,d){return d.getEval()-b.getEval()});if(!f.length)return c;var g=f[0].getEval();f.forEach(function(f){var l=f.getEval();f.getMove().from==b&&c.push({sq:f.getMove().to,clr:this._getTargetSqClr(l,g),txt:g-l})}.bind(this))}return c};b.prototype.getCounterMoveTo=function(b,c){if(0<this.lastDepth){var f=CB.AnalysisEngine.linesToArray(this.curLines[this.lastDepth-1]);f.sort(function(b,
d){return d.getEval()-b.getEval()});if(f.length)for(var g=f[0].getEval(),h=0;h<f.length;h++){var l=f[h],q=l.getEval();if(l.getMove(0).from==b&&l.getMove(0).to==c)return{from:l.getMove(1).from,to:l.getMove(1).to,clr:this._getTargetSqClr(q,g)}}}};b.prototype._getTargetSqClr=function(b,c){if(23E3<Math.abs(b))return new CB.HSLColor(0,0,0,.6);for(var f=c-b,g=.55+.15,g=[[2E4,0,95,55,1],[1E3,3,95,50,.9],[700,4,95,48,.9],[400,12,95,47,.9],[300,14,95,46,.9],[250,18,95,46,g],[200,19,95,45,.9],[170,20,90,60,
.9],[140,24,90,60,.9],[120,28,90,60,.9],[100,30,90,60,.9],[90,34,90,45,.9],[80,38,90,45,g],[70,46,90,45,g],[60,50,90,45,g],[50,65,90,45,g],[40,70,90,45,.55],[30,75,90,45,.55],[20,80,90,45,.55],[15,90,90,45,.55],[10,100,90,45,.55],[7,110,90,45,.55],[5,115,90,42,.7],[0,120,90,42,.74]],h=0;h<g.length;h++)if(f>=g[h][0])return new CB.HSLColor(g[h][1],g[h][2],g[h][3],g[h][4]);return new CB.HSLColor(CB.HSLColor.GREEN,90,40,.6)};b.prototype._resetGoState=function(){this.curLines=[];this.baseLines={};this.depthLines=
[];this.depthArrLines=[];this.lastDepth=1;this.bestAt1Ply=null};b.prototype._onLine=function(b,c,f,g,h,l,q,r){if(g==CB.LineEvalType.EXACT){if(c>this.lastDepth){this.maxPVNum=0;0<this.lastDepth&&this.curLines[this.lastDepth]&&this.storeLines(ObjUtil.clone(this.curLines[this.lastDepth]),this.lastDepth);if(this.lastDepth&&this.depthArrLines[this.lastDepth]&&this.depthArrLines[this.lastDepth].length){var t,v;1<this.depthArrLines[this.lastDepth].length&&(t=this.depthArrLines[this.lastDepth][1],v=this.depthArrLines[this.lastDepth][1].getEval());
(!this.options.minDepthForFire||this.lastDepth>=this.options.minDepthForFire||1==this.lastDepth)&&this.fireOnLine(this.lastDepth,this.depthArrLines[this.lastDepth][0].getEval(),this.depthArrLines[this.lastDepth][0],v,t)}this.lastDepth=c;(20<=c||(CB.System.isMobile()||CB.System.runsInIFrame())&&8<=c)&&this.engineStop()}h&&(l=CB.EngineValue.getMateEval(l));b=new CB.EvaluatedLine(r,l);this.curLines[this.lastDepth]||(this.curLines[this.lastDepth]={});this.curLines[this.lastDepth][b.key()]=b}};b.prototype.storeLines=
function(b,c){this.depthLines[c]=b;this.depthArrLines[c]=CB.AnalysisEngine.linesToArray(b)};b.linesToArray=function(b){var c=[],f;for(f in b)b.hasOwnProperty(f)&&c.push(b[f]);c.sort(function(b,d){return d.getEval()-b.getEval()});for(b=0;b<c.length;b++)c[b].lineNumber=b;c.getNLinesInEvalRange=function(b){for(var d=0,c=this[0].getEval(),e=1;e<this.length&&!(c-this[e].getEval()>b);e++)d++;return d};c.hasClearlyBest=function(b){return 1==c.length?!0:c[0].getEval()-c[1].getEval()>=b};return c};b.prototype.getBestMove=
function(){if(3<this.lastDepth){var b=CB.AnalysisEngine.linesToArray(this.curLines[this.lastDepth]);b.sort(function(b,d){return d.getEval()-b.getEval()});return b[0].getMove()}};Ve.initForListeners(b);Ve.addEvent(b,"Line");return b}();"use strict";
CB.Evaluation=function(){var c=function(b){this.val=b};c.getEvalString=function(b){return 2E4<b?lm.WHITE_MATES:420<b?lm.WHITE_CLEARLY_WINNING:350<b?lm.WHITE_WINNING:250<b?lm.WHITE_DECISIVE:130<b?lm.WHITE_CLEARLY_BETTER:80<b?lm.WHITE_BETTER:40<b?lm.WHITE_SLIGHTLY:22<b?lm.WHITE_EDGE:-2E4>b?lm.BLACK_MATES:-420>b?lm.BLACK_CLEARLY_WINNING:-350>b?lm.BLACK_WINNING:-250>b?lm.BLACK_DECISIVE:-130>b?lm.BLACK_CLEARLY_BETTER:-80>b?lm.BLACK_BETTER:-40>b?lm.BLACK_SLIGHTLY:-22>b?lm.BLACK_EDGE:lm.EQUAL_POS};c.getEmoticonUrl=
function(b){b=c.getEmo(b);return CB.getCommonPath()+String.f("Media/Emojis/Fritz/Fritz{0}.png",b)};c.getSmilingEmoticonUrl=function(){return c.getEmoticonUrl(81)};c.getEmo=function(b){return 2E4<b?"Mates":420<b?"ClearlyWins":350<b?"Wins":250<b?"Decisive":130<b?"ClearlyBetter":80<b?"Better":40<b?"SlightlyBetter":22<b?"Equal":-420>b?"ClearlyLosing":-350>b?"Losing":-250>b?"DecisivelyWorse":-130>b?"ClearlyWorse":-80>b?"Worse":-40>b?"SlightlyWorse":"Equal"};c.prototype.toString=function(){return c.getEvalString(this.val)};
return c}();"use strict";CB.EvaluatedLine=function(){var c=function(b,d){this.line=b;this.eval=d};c.prototype.getEval=function(){return this.eval};c.prototype.getLine=function(){return this.line};c.prototype.length=function(){return this.line.length};c.prototype.getMove=function(b){return this.line[b||0]};c.prototype.key=function(){return this.getMove().toString()};c.prototype.toString=function(){return String.formatEx("{eval}: {line}",this)};return c}();"use strict";
CB.EngineWrapper=function(){var c=function(b,d,c,f){this.nEngine=b;this.url=d;this.engine={};this.viewLink=c;this.gameLink=f};c.prototype.load=function(){var b=this;try{b.url.match(/http/i)?$.ajax({url:b.url,type:"GET",data:{},async:!0,cache:!0,processData:!1,success:function(d){d=new Blob([d],{type:"application/javascript"});b.engine=new Worker(URL.createObjectURL(d));b.engine.onmessage=c.prototype.onMessage.bind(b);b.engine.error=c.prototype.onError.bind(b);b.engine.postMessage({cmd:"reset"});b.isRunning=
!1}}):(this.engine=new Worker(this.url),this.engine.onmessage=c.prototype.onMessage.bind(this),this.engine.error=c.prototype.onError.bind(this),this.engine.postMessage({cmd:"reset"}),this.isRunning=!1)}catch(d){}};c.prototype.unLoad=function(){this.abort()};c.prototype.newGame=function(){this.abort();this.engine.postMessage({cmd:"reset"})};c.prototype.makeMove=function(b){this.engine.postMessage({cmd:"move",move:b.toJSON()})};c.prototype.search=function(b,d){this.isRunning=!0;this.engine.postMessage({cmd:"search",
timeout:b,maxdepth:d})};c.prototype.sendNewPos=function(b){this.abort();b=b.toFEN();this.engine.postMessage({cmd:"position",fen:b});this.viewLink&&this.viewLink.clearEngineOutput(this.nEngine)};c.prototype.sendNewGame=function(b,d){this.abort();this.engine.postMessage({cmd:"reset"});if(!b.isNormalInit()){var c={cmd:"position",fen:b.getStartPos().toFEN()};d.forEach(function(b){c[b.piece+"Table"]=this.getStrExternTable(b.vals)}.bind(this));this.engine.postMessage(c)}for(var f=0;f<b.mainLine.length;f++){var g=
b.mainLine[f].toJSON();this.engine.postMessage({cmd:"move",move:g})}this.viewLink&&this.viewLink.clearEngineOutput(this.nEngine)};c.prototype.analyse=function(b){this.abort();b=b.toFEN();this.engine.postMessage({cmd:"position",fen:b});this.engine.postMessage({cmd:"analyze"});this.isRunning=!0;this.viewLink&&this.viewLink.clearEngineOutput(this.nEngine)};c.prototype.abort=function(){this.isRunning&&(this.engine.terminate(),this.isRunning=!1,this.load())};c.prototype.onMessage=function(b){if("pv"==
b.data.id)this.gameLink.onEnginePV(this.nEngine,b.data);else"move"==b.data.id&&(this.gameLink.onEngineMove(this.nEngine,b.data),this.isRunning=!1)};c.prototype.onError=function(b){CB.LOG("Error: "+b.message);alert(b)};c.prototype.genGoodSquaresForWhitePieceEval=function(b,d){};c.prototype.getStrExternTable=function(b){for(var d=Array(64),c=0;64>c;c++)d[c]=0;b.forEach(function(b){var c=CB.Square.getRank(b.sq),e=CB.Square.getFile(b.sq);d[8*(7-c)+e]=b.val});return JSON.stringify(d)};c.prototype.getStrExternEval=
function(){return""};return c}();"use strict";
CB.EngineLinesElement=function(){function c(b){if(b.handicap){var d=CB.Handicap.getTypeStr(b.handicap);return String.formatEx("{5}: {0}, {1} {2} {3}={4}s",d,lm.DEPTH,b.depth,lm.TIME,idiv(b.totalTime,1E3),lm.LEVEL)}return String.formatEx(lm.ENG_SEARCH_INFO_FMT,b.depth,b.maxDepth,idiv(b.nps,1E3),idiv(b.totalTime,1E3))}function b(b){var d=CB.$(b.target),c=d.data("pv"),c=c.trim(),c=c.split(" ").map(CB.Move.fromString),d=d.parent("[data-pos]"),d=CB.$(d),d=new CB.Position(d.data("pos")),c=new CB.Game(d,
c),c=CB.PGNWriter.toPGN(c);b.dataTransfer.setData("text",c)}function d(d,e,h){if(CB.$(".pv",d)){d.on("dragstart",b);CB.$(".pv",d).text(e.pv.lineStr);CB.$(".pvnum",d).text(e.num);if(!(e.analysis||h||CB.System.isMobile()||CB.System.runsInIFrame())){var l=String.f("<img src='{0}'/>",CB.Evaluation.getSmilingEmoticonUrl());CB.$(".evImage",d).html(l)}if(e.evalStr&&e.handicap)e.handicap&&CB.$(".evStr",d).text(e.evalStr),h||CB.System.isMobile()||CB.System.runsInIFrame()||(l=String.f("<img src='{0}'/>",CB.Evaluation.getEmoticonUrl(e.eval)),
CB.$(".evImage",d).html(l));else{var q=new StringBuilder;CB.NotaElement.CreateGlyphableText(e.symbol,q,"cbspec-glyph");h=q.toString();CB.$(".symbol",d).html(h)}d.data("pvnum",e.num);d.data("depth",e.depth);d.data("mv",e.pv[0].toString());q=new StringBuilder;e.handicap?q.appendFormat("{0}",e.pv[0]):e.pv.forEach(function(b){q.appendFormat("{0} ",b)});d.data("pv",q.toString());d.removeClass("outdated");CB.$(".engine-info-text").hide();e=c(e);CB.$(".data",d).text(e)}}var e=function(b){this.nInPage=b||
0;this.initState()};e.INIT_HTML=e.LINE_HTML="<div class='line'><div class='nota'><span class='pvnum'></span><span class='symbol'></span><span class='pv'></span></div><div class='evImage'></div><div class='data'></div><div class='evStr'></div></div>";e.defaultOptions={scrollLines:!0};e.prototype.getInitHTML=function(b){return String.f("<div class='lines-container' id='lines-container-{0}'><div class='engine-lines' id='engine-lines-{0}' ><div class='data-common' id='data-common-{0}'></div></div></div><div class='engine-info-text' id='engine-info-text-{0}'></div>",
b)};e.prototype.initElem=function(b,d){this.options=ObjUtil.copyTo(e.defaultOptions,d||{},!0);this.el=b;CB.$(this.el).html(this.getInitHTML(this.nInPage));var c=CB.$("#engine-lines-"+this.nInPage,this.el);this.elLines=c.single();this.elContainer=CB.$("#lines-container-"+this.nInPage,this.el).single();CB.$("#data-common-"+this.nInPage).html(this.options.loadingTitle||"<br/>"+lm.LOADING_ENGINE);c.on("click",this.onLinesClick.bind(this));CB.$("#engine-info-text-"+this.nInPage).hide();this.scrollParent=
this.elContainer};e.prototype.initState=function(){this.lastDepth=this.lastPos=this.lastTime=this.lastNodes=this.lastNps=null};e.prototype.setEngine=function(b){if(this.engine){var d=this.engine;d.engine&&(d=d.engine);this.idOnLine&&(d.removeOnLineListener(this.idOnLine),d.removeOnLosingLineListener(this.idOnLosingLine),d.removeOnInfoListener(this.idOnInfo),d.removeOnNewGameListener(this.idOnNewGame),d.removeOnSearchStartListener(this.idOnSearchStart),d.removeOnExitListener(this.idOnExit),d.removeOnThreatListener(this.idOnThreat))}if(this.engine=
b)d=this.engine,d.engine&&!d.addOnLosingLineListener&&(d=d.engine),d&&d.addOnLineListener&&(this.idOnLine=d.addOnLineListener(this.onEngineLine.bind(this)),this.idOnLosingLine=d.addOnLosingLineListener(this.onLosingLine.bind(this)),this.idOnInfo=d.addOnInfoListener(this.onEngineInfo.bind(this)),this.idOnNewGame=d.addOnNewGameListener(this.onNewGame.bind(this)),this.idOnSearchStart=d.addOnSearchStartListener(this.onSearchStart.bind(this)),this.idOnExit=d.addOnExitListener(this.onExit.bind(this)),this.idOnThreat=
d.addOnThreatListener(this.onThreat.bind(this)))};e.prototype.onLinesClick=function(b){b.preventDefault();var d=b.target;b=CB.$(d);CB.$.is(d,".line")||(d=b.parent(".line"));d&&(b=CB.$(d).data("mv"),CB.Move.isValidString(b)&&(b=CB.Move.fromString(b),this.fireOnMoveEntered(b)))};e.prototype.clear=function(){$(this.elLines).find(".line").remove();$(this.elLines).find("#data-common-"+this.nInPage).empty()};e.prototype.onNewGame=function(){this.clear()};e.prototype.displayInfo=function(b,d){this.clear();
this.switchLinesToInfo();this.setInfoText(b,d)};e.prototype.onSearchStart=function(b){this.clear();this.switchLinesToInfo();this.setInfoText("Calculating ...","startSearch")};e.prototype.onExit=function(b){this.clear();this.switchLinesToInfo();this.setInfoText("Engine Stopped.","engineStopped")};e.prototype.onThreat=function(b){b?$("#engine-lines-"+this.nInPage).addClass("cbEngineThreat"):$("#engine-lines-"+this.nInPage).removeClass("cbEngineThreat")};e.prototype.onEngineInfo=function(b,d,c,e,q,r){this.lastNps=
q||this.lastNps;this.lastNodes=e||this.lastNodes;this.lastTime=r||this.lastTime};e.prototype.onEngineLine=function(b,d,c,e,q,r,t,v,y){this.switchInfoToLines();this.hideInfo();if(e===CB.LineEvalType.EXACT){e=b.getMultiPV();CB.$(this.elLines).data("lines",e);e=1<e;b=b.getCurPos();var A=b.toFEN();$(this.elLines).data("pos",A);(this.lastPos&&!b.equals(this.lastPos)||this.lastDepth&&this.lastDepth>d)&&this.clear();e||this.options.scrollLines||this.clear();e&&1==t&&CB.$(".line",this.elLines).addClass("outdated");
this.lastPos=b;this.lastDepth=d;CB.Game.initLine(b,v);var w=new CB.NotationGenerator(lm.NOTA_LOCALIZATION);y.analysis||(v=v.slice(0,1));var A=w.getLineNota(b,v),z=r;q?(0>z&&(z=-z),z=w.getLocalization().strMate+z):(b.isWTM()||(z=-z),z=(z/100).toFixed(2));A=y.analysis?"("+z+") "+A:" "+A;c={id:"pv",line:v,pv:v,eval:r,evalStr:CB.Evaluation&&!q?CB.Evaluation.getEvalString(100*z)+".":"",nps:this.lastNps,depth:d,maxDepth:c,totalTime:this.lastTime,handicap:y.handicapStyle,analysis:y.analysis,num:t};c.pv.lineStr=
A;q&&(r=0>r?-Number.MAX_VALUE:Number.MAX_VALUE);q=r;b.isBTM()&&(q=-q);q=CB.EvaluationGrade.getGlyph(q);q=Vp.getText(q);c.symbol=q;this.outCommonData(c);this.outLine(c,e,d);e||this.scrollBottom();CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.updateTouchBarInfo(c.evalStr)}};e.prototype.onLosingLine=function(b,d){this.showInfo()};e.prototype.scrollBottom=function(){this.scrollParent&&(this.scrollParent.scrollTop=this.scrollParent.scrollHeight)};e.prototype.outCommonData=
function(b){CB.$("#data-common-"+this.nInPage,this.elLines).text(c(b))};e.prototype.showInfo=function(){CB.$("#engine-info-text-"+this.nInPage).show()};e.prototype.hideInfo=function(){CB.$("#engine-info-text-"+this.nInPage).hide()};e.prototype.switchInfoToLines=function(){CB.$("#engine-info-text-"+this.nInPage).hide();CB.$("#lines-container-"+this.nInPage).show()};e.prototype.switchLinesToInfo=function(){CB.$("#engine-info-text-"+this.nInPage).show();CB.$("#lines-container-"+this.nInPage).hide()};
e.prototype.setInfoText=function(b,d){CB.$("#engine-info-text-"+this.nInPage).text(b);CB.$("#engine-info-text-"+this.nInPage).removeClass("findStrong");d&&CB.$("#engine-info-text-"+this.nInPage).addClass(d);CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.updateTouchBarInfo(b)};e.prototype.outLine=function(b,c){var h=CB.$("#data-common-"+this.nInPage,this.elLines);if(c){var l=String.formatEx(".line[data-pvnum='{0}']",b.num),l=CB.$(l);0==l.length&&(l=CB.$(e.LINE_HTML),l.insertBefore(h));
d(l,b,!0)}else l=CB.$(e.LINE_HTML),d(l,b,!1),l.insertBefore(h)};Ve.initForListeners(e);Ve.addEvent(e,"MoveEntered");return e}();"use strict";
CB.AutoEnginePanelMgrMixin=function(){return{autoEngPanel:null,_autoShowEngine:!1,getAutoEngPanel:function(){return this.autoEngPanel},setAutoShowEngine:function(c){this._autoShowEngine!==c&&(this._autoShowEngine=c,this.toggleEnginePanel(c))},getAutoShowEngine:function(){return this._autoShowEngine},toggleAutoShowEngine:function(){this._autoShowEngine=!this._autoShowEngine;this.toggleEnginePanel(this._autoShowEngine);return this._autoShowEngine},toggleEnginePanel:function(c){V15.commands.fireChecked(CB.CommandIds.TOGGLE_ANALYSIS_AUTO_ENGINE,
c);var b=this.getEngPanelLocation(),d=b.region,b=b.container;c?(this.autoEngPanel||(this.autoEngPanel=CB.Panels.createAutoEnginePanel(0,{h:CB.System.pixToZoom(.26*window.innerHeight),region:d,autoInit:!0,active:!0})),this.beforeShowAutoEngPanel(),b.contains(this.autoEngPanel)||(b.add(this.autoEngPanel),b.updateLayout())):this.autoEngPanel&&(b.remove(this.autoEngPanel,!0),this.afterHideAutoEngPanel(),this.autoEngPanel.setGame(null),this.autoEngPanel.disposeEngine(),this.autoEngPanel=null);return this.autoEngPanel},
beforeShowAutoEngPanel:function(){},afterHideAutoEngPanel:function(){}}}();CB.AutoEngineAppMixin=function(){}();CB.AutoEngineGUIElements=function(){return{createAutoEngineBtn:function(c){return CB.ToolButtons.toggleBtn(c,lm.ANALYSIS_ENGINE,"Engine",CB.CommandIds.TOGGLE_ANALYSIS_AUTO_ENGINE,lm.ANALYSIS_ENGINE,CB.Weight(4),"RunningEngine")},createToolBarEngineBtn:function(){return CB.ToolButtons.smallBtn("","Engine16",CB.CommandIds.TOGGLE_ANALYSIS_AUTO_ENGINE,lm.ANALYSIS_ENGINE)}}}();"use strict";
CB.HintTypes={NONE:0,FROM:1,TO:2,CAPTURE:3,CHECK:4,PIECE:5,MATE_THREAT:9,GARDEZ_QUEEN:16,NUM:9,toString:function(c){if("string"==typeof c)return c;CB.HintTypes.msgs||(CB.HintTypes.msgs=["","From","To",lm.CAPTURE_SOMETHING,lm.GIVE_CHECK,"Piece","","","","Threaten mate","","","","","","","Attack the queen"]);if(CB.HintTypes.msgs[c])return CB.HintTypes.msgs[c];for(var b in this)if(this[b]==c)return b;return"Unknown HintType: "+c}};
CB.Hints=function(){var c=function(){};c.engUrl="/Common/Chess/Engine/Enginemin.js";c.engine=new CB.EngineWrapper(0,c.engUrl,null,c);CB.System.isElectron()||c.engine.load();c.gen=function(b,d){for(var e=[],f=[],g=0;g<CB.HintTypes.NUM;g++)f[g]=0;for(var h=b.getCurPos(),l=h.V7(),q=!1,g=0;g<l.length;g++){var r=l[g];h.preSetMinCtx(r);d.from==r.from&&f[CB.HintTypes.FROM]++;d.from==r.from&&f[CB.HintTypes.TO]++;d.mvd==r.mvd&&d.from!=r.from&&f[CB.HintTypes.PIECE]++;r.vct&&f[CB.HintTypes.CAPTURE]++;var t=
new CB.Position;t.copy(h);t.makeMove(r);t.isCheck()&&(f[CB.HintTypes.CHECK]++,r.equals(d)&&(q=!0))}c.threatensMate(b.getCurPos(),d)&&e.push(CB.HintTypes.MATE_THREAT);2<=f[CB.HintTypes.CHECK]&&q&&e.push(CB.HintTypes.CHECK);3<=f[CB.HintTypes.CAPTURE]&&d.vct&&e.push(CB.HintTypes.CAPTURE);4<=f[CB.HintTypes.PIECE]?e.push(CB.HintTypes.PIECE):3<=f[CB.HintTypes.FROM]&&(d.piece&CB.Piece.PIECE_MASK)!=CB.Piece.PAWN&&e.push(CB.HintTypes.FROM);3<=f[CB.HintTypes.TO_SQ]&&e.push(CB.HintTypes.TO_SQ);return e};c.genAsync=
function(b,d,e,f){for(var g=[],h=[],l=0;l<CB.HintTypes.NUM;l++)h[l]=0;for(var q=b.getCurPos(),r=q.V7(),t=!1,l=0;l<r.length;l++){var v=r[l];q.preSetMinCtx(v);d.from==v.from&&h[CB.HintTypes.FROM]++;d.from==v.from&&h[CB.HintTypes.TO]++;d.mvd==v.mvd&&d.from!=v.from&&h[CB.HintTypes.PIECE]++;v.vct&&h[CB.HintTypes.CAPTURE]++;var y=new CB.Position;y.copy(q);y.makeMove(v);y.isCheck()&&(h[CB.HintTypes.CHECK]++,v.equals(d)&&(t=!0))}2<=h[CB.HintTypes.CHECK]&&t&&g.push(CB.HintTypes.CHECK);2<=h[CB.HintTypes.CAPTURE]&&
d.vct&&g.push(CB.HintTypes.CAPTURE);3<=h[CB.HintTypes.PIECE]?g.push(CB.HintTypes.PIECE):2<=h[CB.HintTypes.FROM]&&(d.piece&CB.Piece.PIECE_MASK)!=CB.Piece.PAWN&&g.push(CB.HintTypes.FROM);2<=h[CB.HintTypes.TO_SQ]&&g.push(CB.HintTypes.TO_SQ);g.length||g.push(CB.HintTypes.PIECE);c.continueAsync(b,d,e,g,f)};c.continueAsync=function(b,d,e,f,g){var h=b.getCurPos(),l=ObjUtil.clone(h);l.makeMove(d);l.canMakeNullMove()&&l.makeNullMove();l.isLegal()?(c.fnAfterSearch=function(b,r){h.getSideToMove()===CB.Side.BLACK&&
(b=-b);2E4<b&&(f=[CB.HintTypes.MATE_THREAT].concat(f));var t=new CB.Move;r.moves[0]&&(t.fromJSON(r.moves[0]),(l.board[t.to]&CB.Piece.PIECE_MASK)==CB.Piece.QUEEN&&500<b&&(f=[CB.HintTypes.GARDEZ_QUEEN].concat(f)),f.length||(t=c.genMovingPieceHint(h,e,d,!1))&&f.push(t));f&&g(f)},c.engine.sendNewPos(l),c.engine.search(100,2)):g(f)};c.onEnginePV=function(b,d){c.fnAfterSearch&&c.fnAfterSearch(d.eval,d.pv)};c.onEngineMove=function(b,d){};c.getStrPieceHint=function(b){var d=lm.MOVE_IMP+" ";switch(b&CB.Piece.PIECE_MASK){case CB.Piece.KING:d+=
lm.YOUR_KING_ACC;break;case CB.Piece.QUEEN:d+=lm.YOUR_QUEEN_ACC;break;case CB.Piece.ROOK:d+=lm.YOUR_ROOK_ACC;break;case CB.Piece.KNIGHT:d+=lm.YOUR_KNIGHT_ACC;break;case CB.Piece.BISHOP:d+=lm.YOUR_BISHOP_ACC;break;case CB.Piece.PAWN:d+=lm.YOUR_PAWN_ACC}return d};c.getYourPieceAcc=function(b,d){switch(b&CB.Piece.PIECE_MASK){case CB.Piece.KING:return lm.YOUR_KING_ACC;case CB.Piece.QUEEN:return lm.YOUR_QUEEN_ACC;case CB.Piece.ROOK:return lm.YOUR_ROOK_ACC;case CB.Piece.KNIGHT:return lm.YOUR_KNIGHT_ACC;
case CB.Piece.BISHOP:return lm.YOUR_BISHOP_ACC;case CB.Piece.PAWN:return lm.YOUR_PAWN_ACC}};c.getStrPieceOnSqHint=function(b,d){return this.getStrPieceHint(b)+" "+CB.Square.toString(d)};c.display=function(b,d,c,f,g){if(c.length){for(var h=[],l=0;l<c.length;l++)c[l]===CB.HintTypes.FROM?(f(b.from),this.showFromSqHint(d,b.from,g,f)):c[l]==CB.HintTypes.TO?f(b.to):c[l]==CB.HintTypes.PIECE?(d.findSquaresOfPiece(d.board[b.from]).forEach(function(b){f&&f(b,"hsla( 130, 50%, 40%, 0.35 )")}.bind(this)),this.showPieceHint(d.board[b.from],
g)):h.push(CB.HintTypes.toString(c[l]));h.length&&(h.join(", "),g(h))}};c.displayHint=function(b,d,c,f,g){"string"===typeof c?g(c):c===CB.HintTypes.FROM?(f&&f(b.from),this.showFromSqHint(d,b.from,g,f)):c===CB.HintTypes.TO?f&&f(b.to):c===CB.HintTypes.PIECE?(d.findSquaresOfPiece(d.board[b.from]).forEach(function(b){f&&f(b,"hsla( 130, 50%, 40%, 0.35 )")}.bind(this)),this.showPieceHint(d.board[b.from],g)):(b=CB.HintTypes.toString(c),g(b))};c.showFromSqHint=function(b,d,c,f){f&&f(d);c(CB.Hints.getStrPieceOnSqHint(b.board[d],
d)+".")};c.showPieceHint=function(b,d){d(CB.Hints.getStrPieceHint(b)+".")};c.genMovingPieceHint=function(b,d,e,f){var g,h=b.getBTM(),l=b.board[e.from],q=CB.Square.R(e.from),r=CB.Square.R(e.to);if((h?r>=CB.Square.R_7&&q<CB.Square.R_5:r<=CB.Square.R_2&&q>CB.Square.R_4)&&!e.vct)return"Retreat a piece";if(e.isCastling())return"Castle";switch(l&CB.Piece.PIECE_MASK){case CB.Piece.KING:g=c.genKingHints(b,d,l,e,f);break;case CB.Piece.PAWN:g=c.genPawnHints(b,d,l,e,f);break;case CB.Piece.BISHOP:g=c.genBishopHints(b,
d,l,e,f);break;case CB.Piece.KNIGHT:g=c.genKnightHints(b,d,l,e,f);break;case CB.Piece.ROOK:g=c.genRookHints(b,d,l,e,f);break;case CB.Piece.QUEEN:g=c.genQueenHints(b,d,l,e)}return g};c.genQueenHints=function(b,d,e,f){d=c.getYourPieceAcc(e);4<c.countMovesOf(b,CB.Piece.QUEEN)&&(.5>Math.random()?d=CB.Square.isLight(f.to)?c.getYourPieceAcc(e)+" to a light square.":c.getYourPieceAcc(e)+" to a dark square.":(CB.Square.F(f.from)==CB.Square.F(f.to)&&c.getYourPieceAcc(e),d=CB.Square.R(f.from)==CB.Square.R(f.to)?
c.getYourPieceAcc(e)+" horizontally.":c.getYourPieceAcc(e)+" diagonally"));return"Move "+d};c.genKingHints=function(b,d,e,f){d="";if(3<=c.countMovesOf(b,CB.Piece.KING)){var g=c.getRankDiff(f,b.getBTM());b=c.getFileDiff(f,b.getBTM());var h=CB.Square.F(f.from);f=CB.Square.F(f.to);0!=g&&(0==b||.5>Math.random())?0<g?d="Advance "+c.getYourPieceAcc(e):0>g&&(d="Retreat "+c.getYourPieceAcc(e)):0!=b&&CB.Square.isCenterFile(f)&&!CB.Square.isCenterFile(h)?d="Centralize "+c.getYourPieceAcc(e):0!=b&&0==g&&(d=
"Move your king sideways")}return d};c.genPawnHints=function(b,d,e,f){var g;12>=b.getMoveNum()?g="Move your "+CB.Square.colToString(CB.Square.F(f.from))+"-pawn":2==c.getRankDiff(f,b.getBTM())?g="Make a double step with your pawn":3<c.countMovesOf(b,CB.Piece.PAWN)&&(g=CB.Square.isCenterFile(f.from)?"Move your center pawn":CB.Square.F(f.from)<CB.Square.C_E?"Move your pawn on the queens side":"Move your pawn on the kings side");return g};c.genBishopHints=function(b,d,e,f){var g=b.getBTM();2==b.countPieces(CB.Piece.BISHOP|
(g?CB.Piece.COLOUR:0))?(e=CB.Square.isLight(f.from)?"Move your light squared bishop":"Move your dark squared bishop",24>=b.getMoveNum()&&(g&&CB.Square.R(f.from)==CB.Square.R_8||!g&&CB.Square.R(f.from)==CB.Square.R_1)&&(e=c.genDevelopBishopHint(b,d,f))):e=0>c.getRankDiff(f,b.getBTM())?"Retreat your bishop":"Advance your bishop";return e};c.genDevelopBishopHint=function(b,d,e){var f,g,h,l,q,r;b.getBTM()?(g=CB.Square.F8,h=CB.Square.C8,l=CB.Square.G8,q=CB.Square.B8,r=CB.Piece.B_KNIGHT):(g=CB.Square.F1,
h=CB.Square.C1,l=CB.Square.G1,q=CB.Square.B1,r=CB.Piece.W_KNIGHT);if(e.from==g)if(b.board[l]==r)f="Develop your king's side";else{if(c.isCastleMove(d[2],CB.Square.C_G)||c.isCastleMove(d[4],CB.Square.C_G))f="Prepare to castle"}else if(e.from==h)if(b.board[q]==r)f="Develop your queen's side";else if(c.isCastleMove(d[2],CB.Square.C_C)||c.isCastleMove(d[4],CB.Square.C_C))f="Prepare to castle";return f};c.genKnightHints=function(b,d,e,f){var g;d=b.getBTM();12>=b.getMoveNum()&&(CB.Square.C(f.from)==CB.Square.C_B?
g="Develop your queen's knight":CB.Square.C(f.from)==CB.Square.C_G&&(g="Develop your king's knight"));g||(CB.Square.IsCenterSquare(f.to)?g="Centralize your knight":(b=c.getRankDiff(f,d),g=2==b?"Advance your knight":-2==b?"Retreat your knight":"Move your knight sideways"));return g};c.genRookHints=function(b,d,e,f){var g;if(3<c.countMovesOf(b,CB.Piece.ROOK)){var h=b.getBTM();g=c.genDoubleRooksHint(b,d,f);if(!g){d=b.countPieces(CB.Piece.W_PAWN)+b.countPieces(CB.Piece.B_PAWN);e=c.getRankDiff(b,h);var h=
c.getFileDiff(b,h),l=CB.Square.F(f.from);f=CB.Square.F(f.to);10<=d&&(!c.isOpenFile(b,l)&&c.isOpenFile(b,f)?g="Move your rook to an open file":0==h?g=3<=e?"Advance your rook":-3>=e?"Retreat your rook":"Move your rook vertically":0==e&&(g=CB.Square.isCenterFile(f)&&!CB.Square.isCenterFile(l)?"Centralize your rook":"Move your rook horizontally"))}}return g};c.isOpenFile=function(b,d){for(var c=0;8>c;c++)if((b.board[8*d+c]&CB.Piece.PIECE_MASK)==CB.Piece.PAWN)return!1;return!0};c.isClosedFile=function(b,
d){for(var c=0;8>c;c++)if(b.board[8*file+c]==(CB.Piece.PAWN|(d?CB.Piece.BLACK:0)))return!0;return!1};c.hasRookInFile=function(b,d,c){d=CB.Square.F(d);for(var f=0;8>f;f++)if(b.board[8*d+f]==CB.Piece.ROOK|(c?CB.Piece.BLACK:0))return!0;return!1};c.genDoubleRooksHint=function(b,d,e){var f;if(c.isOpenFile(b,CB.Square.F(e.to))&&c.hasRookInFile(b,e.to,b.getBTM()))f="Double your rooks";else if(b=CB.Square.F(e.to),CB.Square.F(e.from)==b)for(var g=2;g<d.length&&6>g;g+=2){var h=d[g];h.mvd&CB.Piece.PIECE_MASK==
CB.Piece.ROOK&&CB.Square.F(h.to)==b&&CB.Square.F(h.from)!=b&&h.from!=e.to&&(f="Prepare to double rooks")}return f};c.isCastleMove=function(b,d){return(b.mvd&CB.Piece.PIECE_MASK)==CB.Piece.KING&&CB.Square.F(b.to)==d&&CB.Square.F(b.from)==CB.Square.C_G};c.countMovesOf=function(b,d){var c=0;b.V7().forEach(function(f){(b.board[f.from]&CB.Piece.PIECE_MASK)==d&&c++});return c};c.getRankDiff=function(b,d){return d?CB.Square.R(b.from)-CB.Square.R(b.to):CB.Square.R(b.to)-CB.Square.R(b.from)};c.getFileDiff=
function(b,d){return d?CB.Square.F(b.from)-CB.Square.F(b.to):CB.Square.F(b.to)-CB.Square.F(b.from)};c.isVerticalMove=function(b){return CB.Square.F(b.from)==CB.Square.F(b.to)};c.isHorizontalMove=function(b){return CB.Square.R(b.from)==CB.Square.R(b.to)};return c}();"use strict";
CB.Commands=function(){var c=function(){this.uniqueKeyDownHandlerId=this.uniqueCommandHandlerId=0;this.commandHandlers=[];this.keyDownHandlers=[];this.toggleButtons={};this.disableShortCutCounter=0;this.curStateChange={}};c.prototype.registerCommandHandler=function(b){this.uniqueCommandHandlerId+=1;this.commandHandlers[this.uniqueCommandHandlerId]=b;return this.uniqueCommandHandlerId};c.prototype.unregisterCommandHandler=function(b){delete this.commandHandlers[b]};c.prototype.commandHandler=function(b,
d){try{for(var c=0;c<this.commandHandlers.length&&(void 0===this.commandHandlers[c]||!this.commandHandlers[c].execCommand(b,d));c++);}catch(f){c=V15.Vo.toNumString(b),CB.LogException(c,f)}};c.prototype.onFileSelect=function(b,d){for(var c=0;c<this.commandHandlers.length;c++)if(void 0!==this.commandHandlers[c]&&this.commandHandlers[c].onFileSelect)this.commandHandlers[c].onFileSelect(b,d)};c.prototype.onTextFieldChange=function(b,d){CB.LOG("TextFieldChange: "+b+", "+d);for(var c=0;c<this.commandHandlers.length;c++)if(void 0!==
this.commandHandlers[c]&&this.commandHandlers[c].onTextFieldChange)this.commandHandlers[c].onTextFieldChange(b,d)};c.prototype.onRegisterField=function(b,d){for(var c=0;c<this.commandHandlers.length;c++)if(void 0!==this.commandHandlers[c]&&this.commandHandlers[c].onRegisterField)this.commandHandlers[c].onRegisterField(b,d)};c.prototype.addPressedButton=function(b,d){};c.prototype.handleKeyPressed=function(b){};c.prototype.registerkeyDownHandler=function(b){this.uniqueKeyDownHandlerId+=1;this.keyDownHandlers[this.uniqueKeyDownHandlerId]=
b;return this.uniqueKeyDownHandlerId};c.prototype.unregisterkeyDownHandler=function(b){delete this.keyDownHandlers[b]};c.prototype.handleKeyDown=function(b){try{if(0>=this.disableShortCutCounter)for(var d=0;d<this.keyDownHandlers.length;d++){if(void 0!==this.keyDownHandlers[d]&&this.keyDownHandlers[d].onKeyDown(b)){b.stopEvent();break}}else CB.LOG("KeyHandlers disabled: "+this.disableShortCutCounter,"LogError")}catch(c){CB.LogException("KeyDown="+b.getKey(),c)}return!0};c.prototype.execCommandLine=
function(b){for(var d=0;d<this.commandHandlers.length&&(void 0===this.commandHandlers[d]||!this.commandHandlers[d].execCommandLine||!this.commandHandlers[d].execCommandLine(b));d++);};c.prototype.enableShortCuts=function(){--this.disableShortCutCounter;0>this.disableShortCutCounter&&CBDebug.assert("Shortcut counter");CB.LOG("EnableShortcuts="+this.disableShortCutCounter)};c.prototype.disableShortCuts=function(){this.disableShortCutCounter+=1;CB.LOG("DisableShortcuts="+this.disableShortCutCounter,
"LogError LogBold")};c.prototype.getCurStateChange=function(){return this.curStateChange};c.prototype.fireChecked=function(b,d){this.curStateChange={id:b,state:d};this.fireOnChecked()};c.prototype.fireEnabledChanged=function(b,d){this.curStateChange={id:b,state:d};this.fireOnEnabledChanged()};c.prototype.fireVisibleChanged=function(b,d){this.curStateChange={id:b,state:d};this.fireOnVisibleChanged()};Ve.initForListeners(c);Ve.addEvent(c,"Checked",function(){return[this.getCurStateChange()]});Ve.addEvent(c,
"EnabledChanged",function(){return[this.getCurStateChange()]});Ve.addEvent(c,"VisibleChanged",function(){return[this.getCurStateChange()]});return c}();
CB.CommandIds={NONE:0,FLIP_BOARD:1,NEW_GAME:2,TAKEBACK:3,EXECMOVE:4,TOGGLE_ANALYSIS_ENGINE:5,SETUP_POSITION:6,ENGINE_MOVE_NOW:7,TOGGLE_ANALYSIS_AUTO_ENGINE:8,ENGINE_HINT:9,ADD_POST_TEXT:10,ADD_PRE_TEXT:11,PROMOTE_LINE:12,DELETE_LINE:13,CUT_LINE:14,MARK_GOOD:15,MARK_BAD:16,MARK_VERYGOOD:17,MARK_VERYBAD:18,MARK_INTERESTING:19,MARK_DUBIOUS:20,WHITE_WINS:30,WHITE_BETTER:31,WHITE_SLIGHTLY:32,EQUAL:33,UNCLEAR:34,BLACK_WINS:36,BLACK_BETTER:37,BLACK_SLIGHTLY:38,COMPENSATION:35,INSERT_DIAGRAM:39,DELETE_PREVIOUS_MOVES:40,
OPEN_PGN_DATABASE:60,OPEN_CMS:63,ENGINE_PLUS_LINE:70,ENGINE_MINUS_LINE:71,DOWNLOAD_PGN:75,START_LINE:80,PIECES2D_FRITZ:100,PIECES2D_CRYSTALS:101,PIECES2D_CRYSTALS_WOOD:115,PIECES2D_USCF:102,PIECES2D_OLDSTYLE:103,PIECES2D_HABSBURG:104,PIECES2D_WORLDCHESS:105,PIECES2D_BLUE:106,PIECES2D_FF:107,PIECES3D_FRITZ:120,PIECES3D_MODERN:121,PIECES3D_ROOM:122,PIECES3D_BALLOON:123,PIECES3D_METAL:124,PIECES3D_FUTURE:125,PIECES3D_BLACKWHITE:126,PIECES3D_CHARACTER:127,PIECES_LAST:128,TOGGLE_PIECES:140,BOARD2D_WOOD:200,
BOARD2D_CRYSTALS:201,BOARD2D_CRYSTALS_WOOD:202,BOARD2D_USCF:203,BOARD2D_OLDWOOD:204,BOARD2D_HABSBURG:205,BOARD2D_FF:206,BOARD2D_WORLDCHESS:207,BOARD2D_BLUE:208,GO_BACK:210,GO_HOME:211,CMS_SOLUTION:212,CMS_TRYAGAIN:213,CMS_PREVIOUS:214,CMS_NEXT:215,PLAYERDB_TEST:231,SEND_FEEDBACK:240,GAME_COPYTOCLIPBOARD:250,GAME_PASTEFROMCLIPBOARD:251,SWITCHAPP_PLAY:260,SWITCHAPP_LIVE:261,SWITCHAPP_DATABASE:262,SWITCHAPP_MYGAMES:263,SWITCHAPP_FRITZ:264,SWITCHAPP_FF:265,SWITCHAPP_TACTICS:266,SWITCHAPP_OPENINGS:267,
SWITCHAPP_VIDEO:268,SWITCHAPP_NEWS:269,LOGIN:300,LOGOUT:301,CHANGE_PASSWORD:302,MANAGE_ACCOUNT:303,MANAGE_FRIENDS:304,INVITE_FRIEND:305,HELP:306,TOGGLE_HANDICAP:400,LANG_ENGLISH:400,LANG_DEUTSCH:401,LANG_ESPANOL:402,LANG_DUTCH:403,LANG_ROMANIAN:404,LANG_CHINESE:405,LANG_FRENCH:406,LANG_RUSSIAN:407,LANG_NORWEGIAN:408,LANG_POLISH:409,LANG_ITALIAN:410,LANG_HEBREW:411,LANG_CATALAN:412,LANG_TURKISH:413,LANG_SLOWENIAN:414,LANG_GREEK:415,LANG_UKRAINIAN:416,LANG_VIETNAMESE:417,LANG_ARABIC:418,LANG_SERBIAN:419,
LANG_LITHUANIAN:420,LANG_PORTUGUESE:421,LANG_FARSI:422,LANG_GAELIC:423,LANG_CROATIAN:424,LANG_CZECH:425,LANG_HINDI:426,TRANSLATE_PAGE:500,TEST:9999,toNumString:function(c){return"CommandId="+c}};CB.getCommonPath=function(){return CB.System.isElectron()?"Common/":"/Common/"};
CB.AppConfigDebug={externalCommonPath:!1,getEngineUrl:function(){return V15.canRunWebAssembly()?(CB.EngineInstance.isAjax=!0,["https://pgn.chessbase.com/common/chess/engine/webasm/fritzajax3.js"]):["/Common/Chess/Engine/df14/df14.js"]},getExternalCommonPath:function(){return CB.System.isElectron()?"file://Common/":"https://pgn.chessbase.com/common/"},getRibbonPath:function(){return CB.getCommonPath()+"Media/Ribbons/"},getPlaychessUris:function(){return["ws://playserver.chessbase.com:7000"]},getLiveUris:function(){return https?
["wss://liveserver.chessbase.com:6008"]:["ws://liveserver.chessbase.com:7001"]},getLiveResult:function(){var c=CB.System.isHTTPS();return[(c?"https":"http")+"://liveserver.chessbase.com:"+(c?6009:80)]},getDBBridgeUris:function(){return CB.System.isHTTPS()?["wss://dbserver.chessbase.com:443"]:["ws://dbserver.chessbase.com:7000"]},getCloudServerUris:function(){return CB.System.isHTTPS()?["wss://cloudserver.chessbase.com:6008"]:["ws://cloudserver.chessbase.com:7000"]},getMyMovesServerUris:function(){return CB.System.isHTTPS()?
["wss://mymovesserver.chessbase.com:443"]:["ws://mymovesserver.chessbase.com:7001"]},getTrainingUris:function(){return CB.System.isHTTPS()?["wss://trainingserver.chessbase.com:443"]:["ws://trainingserver.chessbase.com:7000","wss://trainingserver.chessbase.com:6008"]},getPlBridgeUris:function(){return CB.System.isHTTPS()?["wss://pbridge.chessbase.com:443"]:["ws://pbridge.chessbase.com:7000"]},getTbBridgeUris:function(){return CB.System.isHTTPS()?["wss://tbridge.chessbase.com:6008","wss://tbridge2.chessbase.com:6008"]:
["ws://tbridge2.chessbase.com:7000","ws://tbridge.chessbase.com:7000"]},getAccountUris:function(){return CB.System.isHTTPS()?["https://users.chessbase.com","https://usersback.chessbase.com"]:["http://users.chessbase.com","http://usersback.chessbase.com"]},getVideoPortalUris:function(){return CB.System.isHTTPS()?["https://videos.chessbase.com/"]:CB.System.runsOnChessBaseDomain()?["http://videos.chessbase.com/"]:["http://localhost:49599/"]},loginWebUrl:"http://account.chessbase.com",createAccountWebUrl:"https://live.chessbase.com/createAccount",
createAccountWebUrl2:"https://live.chessbase.com/createAccount",resetPasswordWebUrl:"http://account.chessbase.com/en/pwd-recovery",resetPasswordWebUrl2:"http://account.chessbase.com/{0}/pwd-recovery",versionChessBaseCom:!1,editAccountUrl:"http://account.chessbase.com/{0}/me",helpUrl:"http://help.chessbase.com/Apps/{0}/index.html",getFlagPath:function(c){return CB.getCommonPath()+"Media/FlagsIso/"+c+"/"},has3DBoard:!1,board2DTopOffset:0,board2DBottomOffset:0,useAnalysisEngines:!0,debug:!0,jqxTheme:"chessbase",
defaultFont:"Roboto, sans serif",defaultCondensedFont:"Roboto Condensed, Arial Narrow, sans serif",boardBG:CB.getCommonPath()+"media/chess/OrangeBrighterSoftBacklightLessSatur.jpg",imgSuffix:"",clrActiveClock:new CB.Color(220,250,190),bgActiveClock:"hsla( 240, 20%, 10%, 1.0 )"};
CB.AppConfigRelease=ObjUtil.copyTo(CB.AppConfigDebug,{release:!0,loginWebUrl:"http://account.chessbase.com",getEngineUrl:function(){return V15.canRunWebAssembly()?(CB.EngineInstance.isAjax=!0,["https://pgn.chessbase.com/common/chess/engine/webasm/fritzajax3.js"]):["/Common/Chess/Engine/df14/df14.js"]},getPlaychessUris:function(){return CB.System.isHTTPS()?["wss://cbridge2.chessbase.com:6008","wss://playserver.chessbase.com:443","wss://cbridge3.chessbase.com:443","wss://cbridge4.chessbase.com:6008"]:
["ws://cbridge2.chessbase.com:7000","ws://playserver.chessbase.com:7000","wss://cbridge3.chessbase.com:443","ws://cbridge4.chessbase.com:7000"]},getMyMovesServerUris:function(){return CB.System.isHTTPS()?["wss://mymovesserver.chessbase.com:443"]:["ws://mymovesserver.chessbase.com:7001"]},getTrainingUris:function(){return CB.System.isHTTPS()?["wss://trainingserver2.chessbase.com:443","wss://trainingserver.chessbase.com:6008"]:["wss://trainingserver2.chessbase.com:443","wss://trainingserver.chessbase.com:6008",
"ws://trainingserver2.chessbase.com:7000"]},getDBBridgeUris:function(){return CB.System.isHTTPS()?["wss://dbserver.chessbase.com:443"]:["ws://dbserver.chessbase.com:7000"]},getCloudServerUris:function(){return CB.System.isHTTPS()?["wss://cloudserver.chessbase.com:6008"]:["ws://cloudserver.chessbase.com:7000"]},getAccountUris:function(){return CB.System.isHTTPS()?["https://users.chessbase.com"]:["http://users.chessbase.com"]},getLiveUris:function(){return["wss://liveserver.chessbase.com:6008"]},getLiveResult:function(){var c=
CB.System.isHTTPS();return[(c?"https":"http")+"://liveserver.chessbase.com:"+(c?6009:80)]},createAccountWebUrl:"https://account.chessbase.com/en/create-account",createAccountWebUrl2:"https://account.chessbase.com/{0}/create-account",resetPasswordWebUrl:"http://account.chessbase.com/en/pwd-recovery",resetPasswordWebUrl2:"http://account.chessbase.com/{0}/pwd-recovery",editAccountUrl:"http://account.chessbase.com/{0}/me",debug:!1},!0);
CB.ChessApp=function(){var c=function(){void 0===this.config&&(this.config=CB.AppConfigRelease);this.mediaPath=CB.getCommonPath()+"Media/";this.mediaPathChess=this.mediaPath+"Chess/";this.mediaPathFlags="https://pgn.chessbase.com/common/media/Flags/";this.minFPS=16;document.onmousemove=this.resetIdle.bind(this);document.onkeypress=this.resetIdle.bind(this);this.idleTimer=new CB.Timer;this.lastActionTick=new CB.Tick;this.loggedIn=!1;this.appName=this.appTitle="ChessBase App";this.acc={name:"Free",
type:0};window.localforage&&localforage.config({driver:localforage.INDEXEDDB,name:"ChessBase",version:1,storeName:"CBCache"})};c.prototype.initInstance=function(){this.commands=new CB.Commands;glSettings=new CB.GlobalSettings;this._initResources();this.idleTimer.runPeriodic(6E4,this.onIdle.bind(this));this.extendCommandIds(CB.CommandIds,this.getAppSpecificCommandIds());this.commandHandlerId=this.commands.registerCommandHandler(this);this.detLanguage();CB.System.isMobile()||V15.initToolTips();window.onerror=
function(b,c,f,g,h){var l="Main";0<=c.search("df14")&&(l="Engine");c=String.formatEx("line={0}, col={1}, typ={2}",f,g,l);h&&h.stack&&(c+="/"+h.stack);CB.LogException(b,c);"Engine"==h&&V15&&V15.panelMgr&&V15.panelMgr.showMessage("Sorry, cannot load the engine, please use the Chrome Browser or Firefox")};this.initAnalytics()};c.prototype.exitInstance=function(){glSettings.destroy()};c.prototype.detLanguage=function(){this.setLanguageFromUrlParam()};c.prototype.setLanguageFromUrlParam=function(){var b=
CB.strUtil.getURLParam("lang");b&&(b=CB.Language.getLanguageIdOfParam(b),glSettings.languageCommandId=glSettings.getCommandIdOfLanguage(b));"undefined"!=typeof glSettings.languageCommandId?glSettings.changeLanguage(glSettings.languageCommandId):this.changeLanguage(CB.Language.getUserLanguageId())};c.prototype.overrideLanguageFromPlugin=function(b){if(b=this.getPluginLanguage(b))b=CB.Language.getLanguageIdOfParam(b),glSettings.languageCommandId=glSettings.getCommandIdOfLanguage(b)};c.prototype.getPluginLanguage=
function(b){b=$(b);if(b.length)return b[0].dataset.language};c.prototype.initAnalytics=function(){"undefined"!==typeof ga&&ga("set","anonymizeIp",!0)};c.prototype.isBoardOnlyApp=function(){return!1};c.prototype.getLoginUrl=function(){return this.config.loginWebUrl};c.prototype.getManageAccountUrl=function(){return this.config.loginWebUrl+"en/me"};c.prototype._initResources=function(){glSettings.boardTextureId||(glSettings.boardTextureId=this.getDefaultBoardCmdId());var b=glSettings.boardTextureId;
glSettings.boardTextureId=void 0;this.setBoardTextures(b);this.config.delayAudioInit||(this.chessAudio=new CB.ChessAudio(V15.config.getExternalCommonPath()+"Media/Sounds/",!0))};c.prototype.getDefaultBoardCmdId=function(){return CB.CommandIds.BOARD2D_WOOD};c.prototype.setBoardTextures=function(b){this.Vb&&this.Vb.destroy();if(glSettings.boardTextureId!=b)switch(b){default:b=CB.CommandIds.BOARD2D_WOOD;case CB.CommandIds.BOARD2D_WOOD:case CB.CommandIds.BOARD2D_CRYSTALS_WOOD:case CB.CommandIds.BOARD2D_USCF:case CB.CommandIds.BOARD2D_OLDWOOD:this.Vb=
new CB.BoardTextures(this.mediaPathChess+"LightSquaresCoolerBrighterSofter.jpg",this.mediaPathChess+"DarkSquaresLessSatur.png",this.mediaPathChess+"MarginBrighter.jpg",this.mediaPathChess+"OrangeBrighterSoftBacklightLessSatur.jpg","gold","black");break;case CB.CommandIds.BOARD2D_CRYSTALS:this.Vb=new CB.BoardTextures(this.mediaPathChess+"WhiteMarbleCut.jpg",this.mediaPathChess+"GreyMarble.jpg",this.mediaPathChess+"DarkMarginCut.jpg",this.mediaPathChess+"WhiteMarbleBack.jpg");break;case CB.CommandIds.BOARD2D_HABSBURG:this.Vb=
new CB.BoardTextures(this.mediaPathChess+"LightSquaresCooler.png",this.mediaPathChess+"DarkSquaresOrange.png",this.mediaPathChess+"MarginBrighter.jpg",this.mediaPathChess+"OrangeBrighterSoftBacklight.jpg");break;case CB.CommandIds.BOARD2D_FF:this.Vb=new CB.BoardTextures(this.mediaPathChess+"LightSquaresFFTex.png",this.mediaPathChess+"DarkSquaresFFTex.png",this.mediaPathChess+"MarginFF.png",this.mediaPathChess+"BackgroundFF.png");break;case CB.CommandIds.BOARD2D_WORLDCHESS:this.Vb=new CB.BoardTextures(this.mediaPathChess+
"WorldChessLightSquares.jpg",this.mediaPathChess+"WorldChessDarkSquares.jpg",this.mediaPathChess+"WorldChessDarkSquares.jpg",this.mediaPathChess+"WorldChessBackground.jpg","white","white");break;case CB.CommandIds.BOARD2D_BLUE:this.Vb=new CB.BoardTextures(this.mediaPathChess+"BlueLightSquares.jpg",this.mediaPathChess+"BlueDarkSquares.jpg",this.mediaPathChess+"BlueDarkSquares.jpg",this.mediaPathChess+"BlueBackground.jpg","white","white")}glSettings.boardTextureId=b};c.prototype.boardMenuBtn=function(b){return V15.config.has3DBoard?
CB.ToolButtons.menuBtn(b,lm.BOARDS,"Board2DSquares",[lm.BOARD_FRITZ,lm.BOARD_CRYSTALS,lm.BOARD_CRYSTALS+" (Wood)",lm.BOARD_USCF,lm.BOARD_OLDSTYLE,lm.BOARD_HABSBURG,"-",lm.BOARD3D_FRITZ,lm.BOARD3D_MODERN,lm.BOARD3D_ROOM,lm.BOARD3D_BALLOON,lm.BOARD3D_METAL,lm.BOARD3D_FUTURE,lm.BOARD3D_BLACKWHITE],"wQFritz16 wQCrystals16 wQCrystals16 wQUSCF16 wQOldstyle16 wQHabsburg16  Fritz16 Modern16 Room16 Balloon16 Metal16 Future16 BlackWhite16".split(" "),[CB.CommandIds.PIECES2D_FRITZ,CB.CommandIds.PIECES2D_CRYSTALS,
CB.CommandIds.PIECES2D_CRYSTALS_WOOD,CB.CommandIds.PIECES2D_USCF,CB.CommandIds.PIECES2D_OLDSTYLE,CB.CommandIds.PIECES2D_HABSBURG,null,CB.CommandIds.PIECES3D_FRITZ,CB.CommandIds.PIECES3D_MODERN,CB.CommandIds.PIECES3D_ROOM,CB.CommandIds.PIECES3D_BALLOON,CB.CommandIds.PIECES3D_METAL,CB.CommandIds.PIECES3D_FUTURE,CB.CommandIds.PIECES3D_BLACKWHITE],void 0,"",CB.Weight(8)):CB.ToolButtons.menuBtn(b,lm.BOARDS,"Board2DSquares",[lm.BOARD_FRITZ,lm.BOARD_CRYSTALS,lm.BOARD_CRYSTALS+"(Wood)",lm.BOARD_USCF,lm.BOARD_OLDSTYLE,
lm.BOARD_HABSBURG],"wQFritz16 wQCrystals16 wQCrystals16 wQUSCF16 wQOldstyle16 wQHabsburg16".split(" "),[CB.CommandIds.PIECES2D_FRITZ,CB.CommandIds.PIECES2D_CRYSTALS,CB.CommandIds.PIECES2D_CRYSTALS_WOOD,CB.CommandIds.PIECES2D_USCF,CB.CommandIds.PIECES2D_OLDSTYLE,CB.CommandIds.PIECES2D_HABSBURG],void 0,"",CB.Weight(12))};c.prototype.switchAppMenuBtn=function(b){return!CB.System.isMobile()||1E3<window.innerWidth||1E3<window.innerHeight?CB.ToolButtons.menuBtn(b,lm.OTHER_TOOLS,"SwitchApp",[lm.MENU_PLAYCHESS_TOOL,
"Live Chess",lm.MENU_TACTICS_TOOL,lm.MENU_VIDEO_TOOL,lm.MENU_FRITZ_TOOL,lm.MENU_OPENINGS_TOOL,lm.MENU_DATABASE_TOOL,lm.MENU_MYGAMES_TOOL,lm.MENU_FRITZ_CHESSTER_TOOL,"News"],"WebAppPlay16 WebAppLive16 WebAppTactics16 WebAppVideos16 WebAppFritz16 WebAppOpenings16 WebAppDatabase16 WebAppMyGames16 WebAppFF16 WebAppNews16".split(" "),[CB.CommandIds.SWITCHAPP_PLAY,CB.CommandIds.SWITCHAPP_LIVE,CB.CommandIds.SWITCHAPP_TACTICS,CB.CommandIds.SWITCHAPP_VIDEO,CB.CommandIds.SWITCHAPP_FRITZ,CB.CommandIds.SWITCHAPP_OPENINGS,
CB.CommandIds.SWITCHAPP_DATABASE,CB.CommandIds.SWITCHAPP_MYGAMES,CB.CommandIds.SWITCHAPP_FF,CB.CommandIds.SWITCHAPP_NEWS],void 0,"",CB.Weight(1)):CB.ToolButtons.menuBtn(b,lm.OTHER_TOOLS,"SwitchApp",[lm.MENU_PLAYCHESS_TOOL,lm.MENU_TACTICS_TOOL,lm.MENU_DATABASE_TOOL,lm.MENU_OPENINGS_TOOL,lm.MENU_VIDEO_TOOL,lm.MENU_FRITZ_TOOL],"WebAppPlay16 WebAppTactics16 WebAppDatabase16 WebAppOpenings16 WebAppVideos16 WebAppFritz16".split(" "),[CB.CommandIds.SWITCHAPP_PLAY,CB.CommandIds.SWITCHAPP_TACTICS,CB.CommandIds.SWITCHAPP_DATABASE,
CB.CommandIds.SWITCHAPP_OPENINGS,CB.CommandIds.SWITCHAPP_VIDEO,CB.CommandIds.SWITCHAPP_FRITZ],void 0,"",CB.Weight(1))};c.prototype.loginMenuBtn=function(b){return CB.ToolButtons.menuBtn(b,lm.LOGIN,"Login",[lm.LOGIN,lm.LOGOUT,lm.CHANGE_PASSWORD,lm.ACCOUNT,lm.INVITE_FRIEND],["Login16","Logout16","ChangePassword16","Account16","MailGames16"],[CB.CommandIds.LOGIN,CB.CommandIds.LOGOUT,CB.CommandIds.CHANGE_PASSWORD,CB.CommandIds.MANAGE_ACCOUNT,CB.CommandIds.INVITE_FRIEND],void 0,"",CB.Weight(16))};c.prototype.getAvailableLanguages=
function(){return[CB.Language.ENG,CB.Language.DEU,CB.Language.ESP,CB.Language.NED,CB.Language.ROM,CB.Language.CHN,CB.Language.FRA,CB.Language.RUS,CB.Language.NOR,CB.Language.POL,CB.Language.ITA,CB.Language.HEB,CB.Language.CAT,CB.Language.TRK,CB.Language.SLO,CB.Language.GRK,CB.Language.UKR,CB.Language.VIE,CB.Language.ARA,CB.Language.SER,CB.Language.LIT,CB.Language.BRA,CB.Language.FAR,CB.Language.GAL,CB.Language.CRO,CB.Language.CZE,CB.Language.HIN]};c.prototype.languageBtn=function(b){var c=this.getAvailableLanguages(),
f=CB.Language.getNativeLangNames(c);f.push("Your Language Here!");var g=CB.Language.getFlagNames(c);g.push(CB.Language.getRibbonFlagName(CB.Language.UN));c=glSettings.getLanguageCommandIds(c);c.push(CB.CommandIds.TRANSLATE_PAGE);b=CB.ToolButtons.menuBtn(b,lm.LANGUAGE,"",f,g,c,void 0,"",CB.Weight(14),!0);glSettings.languageBtn=b;glSettings.languageCommandId?glSettings.changeLangButtonFlag(glSettings.languageCommandId):b.changeFlagIcon(CB.Language.getRibbonFlagName(CB.Language.getUserLanguageId()));
return b};c.prototype.getLocalizationArr=function(b){var c=[];CB.Loc.Playchess&&CB.Loc.Playchess[b]&&c.push(CB.Loc.Playchess[b]);CB.Loc.Chess[b]?(CB.LOG("Chess.Localization="+b+" ok","","loc"),c.push(CB.Loc.Chess[b])):CB.LOG("Chess.Localization="+b+" not found");CB.LOG("locArr for "+b+"="+c.join(","),"","loc");return c};c.prototype.changeLanguage=function(b){var c=this.getLocalizationArr("ENG");(b=this.getLocalizationArr(CB.Language.getInternalName(b)))&&(c=c.concat(b));glLoc=new CB.Localization(c)};
c.prototype.resetIdle=function(){this.lastActionTick.start()};c.prototype.isIdle=function(){return 12E4<this.lastActionTick.getExpiredMS()};c.prototype.allowMoveEntryDialog=function(){return!1};var b=!1;c.prototype.onIdle=function(){this.isIdle()?(this.idleFunc&&this.idleFunc(),b=!0):(b&&this.notIdleFunc&&this.notIdleFunc(),b=!1)};c.prototype.initToolTips=function(){"undefined"!==typeof Ext&&Ext.QuickTips.init()};c.prototype.getCommandIdFromVersionCode=function(){var b=0;switch(V15.versionCode.nFamily){case CB.VersionCodeEnum.JSPLAYCHESS:b=
V15.Vo.SWITCHAPP_PLAY;break;case CB.VersionCodeEnum.JSREADER:b=V15.Vo.SWITCHAPP_LIVE;break;case CB.VersionCodeEnum.JSCBONLINE:b=V15.Vo.SWITCHAPP_DATABASE;break;case CB.VersionCodeEnum.JSPREMIUM:b=V15.Vo.SWITCHAPP_PLAY;break;case CB.VersionCodeEnum.JSFRITZ:b=V15.Vo.SWITCHAPP_FRITZ;break;case CB.VersionCodeEnum.JSMYGAMES:b=V15.Vo.SWITCHAPP_MYGAMES;break;case CB.VersionCodeEnum.JSTRAINING:b=V15.Vo.SWITCHAPP_TACTICS;break;case CB.VersionCodeEnum.JSOPENINGS:b=V15.Vo.SWITCHAPP_OPENINGS}return b};c.prototype.getAppUrl=
function(b){var c="http://www.chessbase.com";switch(b){case V15.Vo.SWITCHAPP_PLAY:c="http://play.chessbase.com";break;case V15.Vo.SWITCHAPP_LIVE:c="http://live.chessbase.com";break;case V15.Vo.SWITCHAPP_TACTICS:c="http://tactics.chessbase.com";break;case V15.Vo.SWITCHAPP_DATABASE:c="https://database.chessbase.com";break;case V15.Vo.SWITCHAPP_MYGAMES:c="http://mygames.chessbase.com";break;case V15.Vo.SWITCHAPP_OPENINGS:c="http://openings.chessbase.com";break;case V15.Vo.SWITCHAPP_FRITZ:c="http://fritz.chessbase.com";
break;case V15.Vo.SWITCHAPP_VIDEO:c="http://videos.chessbase.com";break;case V15.Vo.SWITCHAPP_FF:c=CB.Language.getUserLanguageId()==CB.Language.DEU?"http://fritzundfertig.chessbase.com":"http://fritzandchesster.chessbase.com";break;case V15.Vo.SWITCHAPP_NEWS:c=CB.Language.getUserLanguageId()==CB.Language.DEU?"http://de.chessbase.com":"http://en.chessbase.com"}return c};c.prototype.execCommand=function(b){try{var c=!0,f;switch(b){default:c=!1;break;case void 0:break;case V15.Vo.SWITCHAPP_PLAY:case V15.Vo.SWITCHAPP_LIVE:case V15.Vo.SWITCHAPP_DATABASE:case V15.Vo.SWITCHAPP_MYGAMES:case V15.Vo.SWITCHAPP_FRITZ:case V15.Vo.SWITCHAPP_FF:case V15.Vo.SWITCHAPP_TACTICS:case V15.Vo.SWITCHAPP_OPENINGS:case V15.Vo.SWITCHAPP_VIDEO:case V15.Vo.SWITCHAPP_NEWS:f=
this.getAppUrl(b);break;case V15.Vo.LOGOUT:this.setLoggedIn(!1);break;case CB.CommandIds.CHANGE_PASSWORD:this.changePassword();break;case CB.CommandIds.MANAGE_ACCOUNT:f=String.formatEx(this.config.editAccountUrl,CB.Language.getParamOfLanguageId(glSettings.getLanguageId()));break;case CB.CommandIds.MANAGE_FRIENDS:this.manageFriends();break;case CB.CommandIds.INVITE_FRIEND:this.inviteFriend();break;case CB.CommandIds.HELP:this.openHelp()}f&&(window.location=f+"?ref="+this.appName+"&lang="+CB.Language.getParamOfLanguageId(glSettings.getLanguageId()))}catch(g){b=
V15.Vo.toNumString(b),CB.LogException(b,g)}return c};c.prototype.extendCommandIds=function(b,c){if(c){for(var f in b)b.hasOwnProperty(f)&&void 0===c[f]&&(c[f]=b[f]);this.Vo=c}};c.prototype.setLoggedIn=function(b){this.loggedIn=b;b||(V15.Vf.loginToken="",V15.Vf.loginMode=CB.LoginMode.GUEST,CB.DOM.clearCookie("AccountToken"),CB.DOM.clearCookie("AccountMode"),V15.Vf.clearCBCommonCookie());CB.LOG("LoggedIN = "+b,"","acc");b?b:V15.showAccountType(0);this.fireOnLogin(b)};c.prototype.changePassword=function(){V15.Vf.userName?
CB.Forms.changePassword(V15.Vf.userName,this.changePasswordHandler.bind(this),{}):alert("Please Login First")};c.prototype.changePasswordHandler=function(b,c){CB.LOG(b+"/"+c);(new CB.AccountsManager(V15.shortAppName)).changePassword(V15.Vf.userName,b,c,V15.Vf.loginToken,this.changePWOkHandler)};c.prototype.changePWOkHandler=function(b){CB.LOG(b);b&&1==b.ResultType?alert("Password changed."):alert("Could not change password")};c.prototype.hasUserName=function(){var b=CB.DOM.getAccountNameCookie(!0)||
V15.Vf.userName;return 0<b.length&&"guest"!=b};c.prototype.manageFriends=function(){(new CB.AccountsManager(V15.shortAppName)).getFriends(V15.Vf.userName,V15.Vf.loginToken,"0",this.getFriendsOkHandler)};c.prototype.getFriendsOkHandler=function(b){CB.LOG(b);if(b&&"OK"==b.Result){for(var e=new CB.AccountsManager(V15.shortAppName),f=[],g=0;g<b.users.length;g++){var h=new CB.ManageFriendsEntry(b.users[g]);f.push(h)}CB.Forms.showManageFriendsList(e,"Friends",f,c.prototype.setFriends)}};c.prototype.setFriends=
function(b,e){b.setFriends(V15.Vf.userName,V15.Vf.loginToken,"0",e,c.prototype.setFriendsOkHandler)};c.prototype.setFriendsOkHandler=function(b){CB.LOG(b)};c.prototype.inviteFriend=function(){var b=this.getCommandIdFromVersionCode(V15.versionCode.nFamily),b=c.prototype.getAppUrl(b),b="mailto:%20&subject="+escape(this.shortAppName)+"&body="+escape("Join me using "+this.appName+" "+b);window.location.href=b};c.prototype.showAdvertising=function(){};c.prototype.openHelp=function(){var b=String.formatEx(this.config.helpUrl,
CB.Language.getHelpParamOfLanguageId(glSettings.getLanguageId()));window.open(b,"_blank")};c.prototype.getAccountType=function(){return this.acc&&this.acc.type?this.acc.type:0};c.prototype.isPremium=function(){return 3<=this.getAccountType()};c.prototype.isLoggedIn=function(){return 2<=this.getAccountType()};c.prototype.animatedBoard=function(){return!0};c.prototype.isExtJS=function(){return"undefined"!=typeof Ext};c.prototype.allowMoveEntryDialog=function(){return this.isExtJS()};c.prototype.forceGuestLogon=
function(){return CB.System.runsInIFrame()||V15.Vf.noRibbons()};c.prototype.showAccountType=function(b){this.acc={name:"Free",type:b};switch(b){case 0:case 1:this.acc.name="Free";break;case 2:this.acc.name="Standard";break;case 3:this.acc.name="Premium"}this.fireOnAccountType(this.acc)};c.prototype.passToFritzOnline=function(b){V15.saveGameToLocalStorage();var c=ObjUtil.clone(b);c.deleteRemaining();c.unAnnotate();c=CB.PGNWriter.toUrlPGN(c);b=2E3<c.length?"?fen="+b.getCurPos().toFEN():"?pgn="+c;window.location=
"http://fritz.chessbase.com"+b+"&ref=pgn"};c.prototype.saveGameToLocalStorage=function(b){if(this.panelMgr.getKernel&&this.panelMgr.getKernel()&&CB.PGNWriter){var c=this.panelMgr.getKernel().game,f=CB.PGNWriter.toPGN(c),g=encodeURI(f);if(3900<g.length||b)b=ObjUtil.clone(c),b.unAnnotate(),f=CB.PGNWriter.toPGN(b);g=encodeURI(f);3900>g.length&&(CB.DOM.setCookie("CBLastGame",f),CB.DOM.setCookie("CBLastMoveIndex",c.getMoveIndex()),c.replaceGameNo&&(CB.DOM.setCookie("CBLastGameNo",c.replaceGameNo),CB.DOM.setCookie("CBLastGameDBId",
c.replaceDBId)));V15.Vf.save("CBLastGame",f)}};c.prototype.loadGameFromLocalStorage=function(){if((!V15.urlParams||!V15.urlParams.pgn&&!V15.urlParams.buf64)&&this.panelMgr.getKernel&&this.panelMgr.getKernel()&&PGN){var b=CB.DOM.getCookie("CBLastGame"),c="",f="";b?(c=CB.DOM.getCookie("CBLastGameNo"),f=CB.DOM.getCookie("CBLastGameDBId")):b=V15.Vf.load("CBLastGame");if(b)return b=PGN.parseGame(b),"My Moves"!=b.hdr.white.last&&(c&&f&&(b.replaceGameNo=parseInt(c),b.replaceDBId=parseInt(f)),b.getCurPos().isLegal()&&
(this.panelMgr.getKernel().game.assign(b),(c=CB.DOM.getCookie("CBLastMoveIndex"))&&this.panelMgr.getKernel().game.gotoIndex(c))),!0}};c.prototype.tryLogin=function(b){V15.Vf.userName=CB.DOM.getAccountNameCookie(!0)||V15.Vf.userName;V15.Vf.loginToken=CB.DOM.getCookie("AccountToken");if(V15.Vf.loginToken&&V15.Vf.userName&&"guest"!=V15.Vf.userName)return(new CB.AccountsManager(V15.shortAppName)).tokenLogin(V15.Vf.userName,V15.Vf.loginToken,b),!0;V15.Vf.clearCBCommonCookie();5;return!1};c.prototype.tryUserPassLogin=
function(b){return V15.Vf.hasUserAndPass()?((new CB.AccountsManager(V15.shortAppName)).pwLogin(V15.Vf.userName,V15.Vf.password,b),!0):!1};c.prototype.debugLogin=function(){5};c.prototype.connectPlayerLobby=function(b){V15.playerLobby=new CB.Server.PlayerLobby;V15.playerLobby.create(V15.config.getPlBridgeUris(),"Guest","",CB.LoginMode.GUEST);b&&V15.playerLobby.connect()};c.prototype.logOffPlayerLobby=function(){V15.playerLobby&&V15.playerLobby.logOff()};c.prototype.connectTeraBrainLobby=function(){V15.aTBLobby=
new CB.Server.TeraBrainLobby;V15.aTBLobby.create(V15.config.getTbBridgeUris(),"Guest","",CB.LoginMode.GUEST);V15.aTBLobby.connect()};c.prototype.logOffTeraBrainLobby=function(){V15.aTBLobby&&V15.aTBLobby.logOff()};c.prototype.connectOnlineDBLobby=function(b){V15.onlineLobby=new CB.Server.OnlineLobby;V15.onlineLobby.createLobby(V15.config.getDBBridgeUris(),"Guest","",CB.LoginMode.GUEST);b&&V15.onlineLobby.connect()};c.prototype.logOffOnlineLobby=function(){V15.onlineLobby&&V15.onlineLobby.logOff()};
c.prototype.setExternalCommonPath=function(b){CB.getCommonPath=function(){return CB.System.isElectron()?"Common/":"https://pgn.chessbase.com/common/"};this.config.externalCommonPath=!0;this.mediaPath=CB.getCommonPath()+"Media/";this.mediaPathChess=this.mediaPath+"Chess/";b.engine&&(b=CB.System.getIEVersion(),CB.EngineInstance.isAjax=12<=b||!b,this.config.getEngineUrl=function(){return CB.EngineInstance.isAjax&&!CB.System.isElectron()?CB.System.canRunWebAssembly()?["https://pgn.chessbase.com/Common/Chess/Engine/WebAsm/FritzAjax3.js"]:
["https://pgn.chessbase.com/Common/Chess/Engine/df14/df14ajaxdata.js"]:CB.System.canRunWebAssembly()?["/Common/Chess/Engine/WebAsm/Fritz.js"]:["/Common/Chess/Engine/df14/df14.js"]})};c.prototype.getUserFromUrl=function(){var b=CB.strUtil.getURLParam("user"),c=CB.strUtil.getURLParam("pass");return b.length&&c.length?(V15.Vf.userCoded=b,b=CB.strUtil.base64.decode(b),c=CB.strUtil.base64.decode(c),b=CB.strUtil.htmlDecode(b),V15.Vf.userName=b,V15.Vf.password=c,V15.Vf.loginMode=CB.LoginMode.NORMAL,!0):
!1};c.prototype.isPlugin=function(){return!1};c.prototype.canRunWebAssembly=function(){return CB.System.canRunWebAssembly()};Ve.initForListeners(c);Ve.addEvent(c,"Login");Ve.addEvent(c,"AccountType");return c}();CB.PieceFonts={};CB.PieceFonts[CB.CommandIds.PIECES2D_FRITZ]="DiagramTTFritz";CB.PieceFonts[CB.CommandIds.PIECES2D_CRYSTALS]="DiagramTTCrystals";CB.PieceFonts[CB.CommandIds.PIECES2D_CRYSTALS_WOOD]="DiagramTTCrystals";CB.PieceFonts[CB.CommandIds.PIECES2D_USCF]="DiagramTTUSCF";
CB.PieceFonts[CB.CommandIds.PIECES2D_OLDSTYLE]="DiagramTTOldstyle";CB.PieceFonts[CB.CommandIds.PIECES2D_HABSBURG]="DiagramTTHabsburg";CB.PieceFonts[CB.CommandIds.PIECES2D_WORLDCHESS]="DiagramTTWorldChess";CB.PieceFonts[CB.CommandIds.PIECES2D_BLUE]="DiagramTTFritz";CB.PieceFonts[CB.CommandIds.PIECES3D_FRITZ]="Fritz";CB.PieceFonts[CB.CommandIds.PIECES3D_MODERN]="Modern";CB.PieceFonts[CB.CommandIds.PIECES3D_ROOM]="Room";CB.PieceFonts[CB.CommandIds.PIECES3D_BALLOON]="Balloon";
CB.PieceFonts[CB.CommandIds.PIECES3D_METAL]="Metal";CB.PieceFonts[CB.CommandIds.PIECES3D_FUTURE]="Future";CB.PieceFonts[CB.CommandIds.PIECES3D_BLACKWHITE]="BlackWhite";CB.PieceFonts[CB.CommandIds.PIECES3D_CHARACTER]="Character";
function buildOldBrowserLandingPage(){CB.LogBrowser("Old");CB.DOM.add("www.playchess.com","h1","NonMobiH1");CB.DOM.add("Play chess and kibitz grand master games","h3","NonMobiH3");CB.DOM.addBr();CB.DOM.add("We are sorry, your browser needs an update.","","NonMobiBody");CB.DOM.add("Please install the latest version.","","NonMobiBody");CB.DOM.addBr();CB.DOM.add("We recommend using Chrome or Firefox. Thank you!","","NonMobiBody");CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addUrl("http://www.playchess.com",
"www.playchess.com","NonMobiLink");CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();CB.DOM.addBr();navigator.userAgent&&CB.DOM.add(navigator.userAgent,"","NonMobiBody")}
CB.LogException=function(c,b,d){var e=b?b.toString():"---";if("undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()){CB.System.isMobile()&&(e+=" (mob)",CB.System.getAndroidVersion()?e+=", andr="+CB.System.getAndroidVersion():CB.System.getiOSVersion()&&(e+=", ios="+CB.System.getiOSVersion()));var f="catch";V15&&(e+=", ver="+V15.versionCode.getStrVersion(),f+=V15.versionCode.getStrVersion());var g=c+", "+e;b&&(b.lineNumber&&(g+=", line="+b.lineNumber),b.columnNumber&&(g+=", col="+b.columnNumber),
b.stack&&(d=b.stack));ga("send","event",f,g,d)}console.log(c+", "+e)};CB.LogStats=function(c){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event","Stats",c)};function padInt(c,b){var d="000000000"+c;return d.substr(d.length-b)}CB.LogReplayed=function(c,b){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event","Replayed",c,"",padInt(b,6))};
CB.LogBrowser=function(c){5;"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event","Browser",c)};CB.LogConnection=function(c){5;"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event","Connect",c)};
CB.LogVersion=function(){if("undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&(ga("send","event","Version",V15.versionCode.toString()),glSettings&&"undefined"!=typeof glSettings.languageCommandId)){var c=glSettings.getLanguageIdOfCommandId(glSettings.languageCommandId);ga("send","event","Lang",CB.Language.getParamOfLanguageId(c))}};CB.LogConversion=function(c){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","pageview","Goal/"+c)};
CB.LogPage=function(c){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","pageview",c)};CB.SendEvent=function(c,b,d){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event",c,b,d)};CB.SendEvent=function(c,b,d){"undefined"!==typeof ga&&CB.System.runsOnChessBaseDomain()&&ga("send","event",c,b,d)};CB.PostSpiegelEvent=function(){};"use strict";
CB.GlobalSettings=function(){var c=function(){this.commandHandlerId=V15.commands.registerCommandHandler(this);this.keyDownHandlerId=V15.commands.registerkeyDownHandler(this);this.boardTextureId=V15.config.defaultBoardTextureId||CB.CommandIds.BOARD2D_WOOD;this.pieceStyleId=CB.CommandIds.PIECES2D_FRITZ;this.pieceStyleId3D=CB.CommandIds.PIECES3D_FRITZ;this.load();V15.config.forceBoardTextureId&&(this.pieceStyleId=V15.config.forcePieceStyleId,this.boardTextureId=V15.config.forceBoardTextureId);this.b3dSelected=
!1};c.prototype.destroy=function(){V15.commands.unregisterCommandHandler(this.commandHandlerId);V15.commands.unregisterkeyDownHandler(this.keyDownHandlerId);this.save()};c.prototype.save=function(){var b=new CB.Storage;b.save("pieceStyleId",this.pieceStyleId);b.save("boardTextureId",this.boardTextureId);b.save("pieceStyleId3D",this.pieceStyleId3D);b.save("langCommandId",this.languageCommandId)};c.prototype.load=function(){var b=new CB.Storage;this.pieceStyleId=b.load("pieceStyleId");this.pieceStyleId3D=
b.load("pieceStyleId3D");this.boardTextureId=b.load("boardTextureId");this.languageCommandId=b.load("langCommandId")};c.prototype.isBlueBoard=function(){return this.boardTextureId==CB.CommandIds.BOARD2D_BLUE};c.prototype.sendFeedback=function(b,c){(new CB.FeedbackManager).send(b,c)};var b=new CB.Vr;c.prototype.execCommand=function(d){try{switch(d){case CB.CommandIds.SEND_FEEDBACK:glSettings.inDialog()||CB.Forms.showFeedbackForm(this.sendFeedback);break;case CB.CommandIds.LANG_ENGLISH:case CB.CommandIds.LANG_DEUTSCH:case CB.CommandIds.LANG_ESPANOL:case CB.CommandIds.LANG_DUTCH:case CB.CommandIds.LANG_ROMANIAN:case CB.CommandIds.LANG_CHINESE:case CB.CommandIds.LANG_FRENCH:case CB.CommandIds.LANG_RUSSIAN:case CB.CommandIds.LANG_NORWEGIAN:case CB.CommandIds.LANG_POLISH:case CB.CommandIds.LANG_ITALIAN:case CB.CommandIds.LANG_HEBREW:case CB.CommandIds.LANG_CATALAN:case CB.CommandIds.LANG_TURKISH:case CB.CommandIds.LANG_SLOWENIAN:case CB.CommandIds.LANG_GREEK:case CB.CommandIds.LANG_UKRAINIAN:case CB.CommandIds.LANG_VIETNAMESE:case CB.CommandIds.LANG_ARABIC:case CB.CommandIds.LANG_SERBIAN:case CB.CommandIds.LANG_LITHUANIAN:case CB.CommandIds.LANG_PORTUGUESE:case CB.CommandIds.LANG_FARSI:case CB.CommandIds.LANG_GAELIC:case CB.CommandIds.LANG_CROATIAN:case CB.CommandIds.LANG_CZECH:case CB.CommandIds.LANG_HINDI:this.changeLanguage(d);
break;case CB.CommandIds.TRANSLATE_PAGE:window.open("https://docu.chessbase.com/translate.html","_blank");break;case CB.CommandIds.PIECES2D_FRITZ:case CB.CommandIds.PIECES2D_CRYSTALS:case CB.CommandIds.PIECES2D_CRYSTALS_WOOD:case CB.CommandIds.PIECES2D_USCF:case CB.CommandIds.PIECES2D_OLDSTYLE:case CB.CommandIds.PIECES2D_HABSBURG:case CB.CommandIds.PIECES2D_WORLDCHESS:case CB.CommandIds.PIECES2D_BLUE:case CB.CommandIds.PIECES2D_FF:this.changeBoardStyle(d);break;case CB.CommandIds.TOGGLE_PIECES:b.exec(this.nextBoardStyle(),
3E3);break;case CB.CommandIds.PIECES3D_FRITZ:case CB.CommandIds.PIECES3D_MODERN:case CB.CommandIds.PIECES3D_ROOM:case CB.CommandIds.PIECES3D_BALLOON:case CB.CommandIds.PIECES3D_METAL:case CB.CommandIds.PIECES3D_FUTURE:case CB.CommandIds.PIECES3D_BLACKWHITE:case CB.CommandIds.PIECES3D_CHARACTER:CB.System.isWebGlCapable()?this.change3DBoardStyle(d):(alert(lm.BROWSER_DOESNT_SUPPORT_3D),this.changeBoardStyle(CB.CommandIds.PIECES2D_FRITZ))}}catch(c){d=V15.Vo.toNumString(d),CB.LogException(d,c)}};c.prototype.onKeyDown=
function(b){return!1};c.prototype.onFileSelect=function(b,c){return!1};c.prototype.setIsDialogActive=function(b){V15.panelMgr.setIsFormOpen(b)};c.prototype.inDialog=function(){return V15.panelMgr.getIsFormOpen()};c.prototype.change3DBoardStyle=function(b){V15.panelMgr.deleteCanvasPanel&&(this.b3dSelected?V15.panelMgr.deleteCanvasPanel3D():V15.panelMgr.deleteCanvasPanel(),this.b3dSelected=!0,this.pieceFontName3D=CB.PieceFonts[b],this.pieceStyleId3D=b,V15.panelMgr.addCanvasPanel3D())};c.prototype.changeBoardStyle=
function(b){this.b3dSelected&&(this.b3dSelected=!1,V15.panelMgr.deleteCanvasPanel3D(),V15.panelMgr.addCanvasPanel());CB.BoardSprites.clearCache();this.pieceFontName=CB.PieceFonts[b];this.pieceStyleId=b;this.fireOnBoardStyle(b,this.pieceFontName)};c.prototype.nextBoardStyle=function(){this.pieceStyleId=this.pieceStyleId?this.pieceStyleId+1:CB.CommandIds.PIECES2D_FRITZ+1;this.pieceStyleId>=CB.CommandIds.PIECES_LAST&&(this.pieceStyleId=CB.CommandIds.PIECES2D_FRITZ);!V15.config.has3DBoard&&this.pieceStyleId>=
CB.CommandIds.PIECES3D_FRITZ&&(this.pieceStyleId=CB.CommandIds.PIECES2D_FRITZ);this.pieceStyleId>=CB.CommandIds.PIECES3D_FRITZ?CB.System.isWebGlCapable()?this.change3DBoardStyle(this.pieceStyleId):this.changeBoardStyle(this.pieceStyleId):this.changeBoardStyle(this.pieceStyleId)};c.prototype.changeLanguage=function(b){var c=this.languageCommandId;this.changeLangButtonFlag(b);this.languageCommandId=b;V15.changeLanguage(this.getLanguageIdOfCommandId(b));V15.appUrl&&c!=b&&(this.save(),window.location=
V15.appUrl+"?lang="+CB.Language.getParamOfLanguageId(glSettings.getLanguageId()))};c.prototype.changeLangButtonFlag=function(b){this.languageBtn&&this.languageBtn.changeFlagIcon(CB.Language.getRibbonFlagName(this.getLanguageIdOfCommandId(b)))};c.prototype.getLanguageIdOfCommandId=function(b){switch(b){default:alert("languageId: "+b);case CB.CommandIds.LANG_ENGLISH:return CB.Language.ENG;case CB.CommandIds.LANG_DEUTSCH:return CB.Language.GER;case CB.CommandIds.LANG_ESPANOL:return CB.Language.ESP;case CB.CommandIds.LANG_DUTCH:return CB.Language.NED;
case CB.CommandIds.LANG_ROMANIAN:return CB.Language.ROM;case CB.CommandIds.LANG_CHINESE:return CB.Language.CHN;case CB.CommandIds.LANG_FRENCH:return CB.Language.FRA;case CB.CommandIds.LANG_RUSSIAN:return CB.Language.RUS;case CB.CommandIds.LANG_NORWEGIAN:return CB.Language.NOR;case CB.CommandIds.LANG_POLISH:return CB.Language.POL;case CB.CommandIds.LANG_ITALIAN:return CB.Language.ITA;case CB.CommandIds.LANG_HEBREW:return CB.Language.HEB;case CB.CommandIds.LANG_CATALAN:return CB.Language.CAT;case CB.CommandIds.LANG_TURKISH:return CB.Language.TRK;
case CB.CommandIds.LANG_SLOWENIAN:return CB.Language.SLO;case CB.CommandIds.LANG_GREEK:return CB.Language.GRK;case CB.CommandIds.LANG_UKRAINIAN:return CB.Language.UKR;case CB.CommandIds.LANG_VIETNAMESE:return CB.Language.VIE;case CB.CommandIds.LANG_ARABIC:return CB.Language.ARA;case CB.CommandIds.LANG_SERBIAN:return CB.Language.SER;case CB.CommandIds.LANG_LITHUANIAN:return CB.Language.LIT;case CB.CommandIds.LANG_PORTUGUESE:return CB.Language.BRA;case CB.CommandIds.LANG_FARSI:return CB.Language.FAR;
case CB.CommandIds.LANG_GAELIC:return CB.Language.GAL;case CB.CommandIds.LANG_CROATIAN:return CB.Language.CRO;case CB.CommandIds.LANG_CZECH:return CB.Language.CZE;case CB.CommandIds.LANG_HINDI:return CB.Language.HIN}};c.prototype.getCommandIdOfLanguage=function(b){switch(b){default:case CB.Language.ENG:return CB.CommandIds.LANG_ENGLISH;case CB.Language.GER:return CB.CommandIds.LANG_DEUTSCH;case CB.Language.ESP:return CB.CommandIds.LANG_ESPANOL;case CB.Language.NED:return CB.CommandIds.LANG_DUTCH;
case CB.Language.ROM:return CB.CommandIds.LANG_ROMANIAN;case CB.Language.CHN:return CB.CommandIds.LANG_CHINESE;case CB.Language.FRA:return CB.CommandIds.LANG_FRENCH;case CB.Language.RUS:return CB.CommandIds.LANG_RUSSIAN;case CB.Language.NOR:return CB.CommandIds.LANG_NORWEGIAN;case CB.Language.POL:return CB.CommandIds.LANG_POLISH;case CB.Language.ITA:return CB.CommandIds.LANG_ITALIAN;case CB.Language.HEB:return CB.CommandIds.LANG_HEBREW;case CB.Language.CAT:return CB.CommandIds.LANG_CATALAN;case CB.Language.TRK:return CB.CommandIds.LANG_TURKISH;
case CB.Language.SLO:return CB.CommandIds.LANG_SLOWENIAN;case CB.Language.UKR:return CB.CommandIds.LANG_UKRAINIAN;case CB.Language.GRK:return CB.CommandIds.LANG_GREEK;case CB.Language.VIE:return CB.CommandIds.LANG_VIETNAMESE;case CB.Language.ARA:return CB.CommandIds.LANG_ARABIC;case CB.Language.SER:return CB.CommandIds.LANG_SERBIAN;case CB.Language.LIT:return CB.CommandIds.LANG_LITHUANIAN;case CB.Language.BRA:return CB.CommandIds.LANG_PORTUGUESE;case CB.Language.FAR:return CB.CommandIds.LANG_FARSI;
case CB.Language.GAL:return CB.CommandIds.LANG_GAELIC;case CB.Language.CRO:return CB.CommandIds.LANG_CROATIAN;case CB.Language.CZE:return CB.CommandIds.LANG_CZECH;case CB.Language.HIN:return CB.CommandIds.LANG_HINDI}};c.prototype.getLanguageCommandIds=function(b){var c=[];b.forEach(function(b){c.push(this.getCommandIdOfLanguage(b))}.bind(this));return c};c.prototype.isRTLLanguage=function(){return this.languageCommandId&&(this.languageCommandId==CB.CommandIds.LANG_HEBREW||this.languageCommandId==
CB.CommandIds.LANG_ARABIC||this.languageCommandId==CB.CommandIds.LANG_FARSI)};c.prototype.getLanguageId=function(){return this.languageCommandId?this.getLanguageIdOfCommandId(this.languageCommandId):CB.Language.getUserLanguageId()};Ve.initForListeners(c);Ve.addEvent(c,"BoardStyle");Ve.addEvent(c,"BoardStyle3D");return c}();var glSettings;"use strict";
CB.FeedbackManager=function(){var c=function(){};c.prototype.send=function(b,d){this.strAddress=b;this.strComment=d;var c=CB.LoginMode.GUEST;CB.Server.PlayerLobby?(this.aPlayerLobby=new CB.Server.PlayerLobby(V15.config.getPlBridgeUris(),"Guest","",c),this.aPlayerLobby.connect(this.onConnected,this)):alert("Thank you")};c.prototype.onConnected=function(b){b.aPlayerLobby&&(b.aPlayerLobby.sendFeedback(b.strAddress,b.strComment,this.feedbackReceived),b.aPlayerLobby.logOff(),alert("Thank you"))};c.prototype.feedbackReceived=
function(b){};return c}();
CB.AccountPanelMgrMixin=function(){return{onLogin:function(){CB.LOG("Login="+V15.isLoggedIn());this.gameKernel&&this.gameKernel.game.fireOnChanged({forceUpdate:!0});this.setLoginHtml(V15.isLoggedIn())},setLoginHtml:function(c){if(this.infoPanel){if(c)this.infoPanel.setHeight(450<window.innerHeight?28:20),Ext.apply(this.infoPanel,{overflowY:"auto"}),this.infoPanel.update('<div class="CBInfoLoggedIn">'+this.getLoggedInHtml()+"</div>"),this.infoPanel.setBodyStyle(this.getLoginInfoGradient()+";color:white;text-transform:uppercase");
else{var b=window.innerHeight/3;this.eastContainer&&this.eastContainer.el&&(b=this.eastContainer.getHeight());CB.System.isMobile()&&900>window.innerHeight?this.infoPanel.setHeight(Math.min(b,120)):this.infoPanel.setHeight(Math.min(b,160));Ext.apply(this.infoPanel,{overflowY:"scroll"});this.infoPanel.update('<div class="CBInfoNotLoggedIn">'+this.getPleaseLoginHtml()+"</div>");this.infoPanel.setBodyStyle(CB.CSS.getGradToRight("rgba(254, 254,252,255)","rgba( 251, 251,247,255)")+";color:black;text-transform:none;")}this.infoPanel.loggedIn=
c;V15.Vf.noLists()&&this.infoPanel.el&&this.infoPanel.setVisible(!1)}},getLoginInfoGradient:function(){return CB.CSS.getGradToRight("rgba(6, 216,19,255)","rgba(24, 147,23,255)")},getGuestInfoGradient:function(){return CB.CSS.getGradToRight("hsl( 120, 15%, 30% )","hsl( 0, 15%, 20% )")},getPleaseLoginHtml:function(c){c=CB.CSS.getHeader("h3",lm.LOGIN_PLEASE_LOGIN,"margin-top:4px");c+=this.getLoginInviteHeader()+"<br/>";if(!CB.System.isMobile()||900<window.innerHeight)c+=this.getFunctionalityText()+"<br/>",
c+=lm.LOGIN_ACCOUNT_FREE+"<br/><br/>";CB.System.isCordova()||(c+=this.genCreateAccountLink());return c},genCreateAccountLink:function(){return'<a href="'+V15.config.createAccountWebUrl+'" style="color:#8B0A16">'+lm.LOGIN_CREATE_LINK+"</a>"},getLoggedInHtml:function(){return String.f(lm.LOGIN_WELCOME,V15.Vf.userName)},getLoginInviteHeader:function(){return String.f(lm.GENERAL_INVITE,V15.appTitle)},getFunctionalityText:function(){return lm.PLEASE_LOGIN},resizeInfoPanel:function(){var c=!1;if(this.infoPanel&&
this.infoPanel.el)if(this.infoPanel.loggedIn){var b=22;450<window.innerHeight&&(b=650<window.innerHeight?30:26);this.infoPanel.setHeight(b);c=!0}else this.eastContainer&&(b=Math.min(220,Math.max(20,.3*this.eastContainer.getHeight())),this.infoPanel.setHeight(b));return c}}}();
CB.AccountAppMixin=function(){return{accountLogin:function(c,b){V15.Vf.userName=CB.DOM.getAccountNameCookie(!0)||V15.Vf.userName;V15.Vf.loginToken=CB.DOM.getCookie("AccountToken");if(!c&&V15.Vf.loginToken&&V15.Vf.userName&&"guest"!=V15.Vf.userName){var d=new CB.AccountsManager(V15.shortAppName);V15.Vf.userName&&"guest"!=V15.Vf.userName&&V15.Vf.password?d.pwLogin(V15.Vf.userName,V15.Vf.password,this.receiveTokenHandler.bind(this)):d.tokenLogin(V15.Vf.userName,V15.Vf.loginToken,this.tokenLoginHandler.bind(this))}else this.onRequestLogin(b)},
onRequestLogin:function(c){this.enterLoginForm(c)},enterLoginForm:function(c,b){V15.panelMgr.showAccountsForm(c,"",b)},tokenLoginHandler:function(c){c&&1!=c.ResultType&&!c.timeout?(this.setLoggedIn(!1),this.enterLoginForm()):c.timeout?(CB.DOM.clearCookie("AccountToken"),this.setLoggedIn(!1)):(this.setLoggedIn(!0),this.onTokenLoginOk(),V15.showAccountType(c.Subscription));this.loginPending=!1},onTokenLoginOk:function(){},receiveTokenHandler:function(c){if(c&&c.Token){var b=unescape(c.Token);V15.Vf.loginToken=
b;CB.LOG("AccToken = "+b,"","acc");V15.Vf.rememberLoginToken();c.userId&&1==c.ResultType&&(V15.Vf.userName=c.userId);CB.DOM.setAccountNameCookie(V15.Vf.userName);this.setLoggedIn(!0);CB.ToolButtons&&CB.ToolButtons.showBusyMask("Logged in OK: "+V15.Vf.userName);CB.Timer.launch(function(){CB.ToolButtons&&CB.ToolButtons.hideBusyMask()},600);this.onTokenLoginOk()}else{CB.LOG("No Token Received in token handler");if(c&&1!=c.Result&&!c.timeout&&!c.error)this.onInvalidToken();c.timeout&&CB.DOM.clearCookie("AccountToken",
"");this.setLoggedIn(!1);this.loginPending=!1}},onInvalidToken:function(){V15.panelMgr.showAccountsForm()?V15.panelMgr.showAccountsForm(lm.PW_INVALID,V15.Vf.userName):this.enterLoginForm(String.formatEx(lm.PW_INVALID,V15.Vf.userName))},isLoggedIn:function(){return this.loggedIn||this.loginPending},setLoggedIn:function(c){this.superClass.setLoggedIn.apply(this,arguments);c?document.title=this.appTitle+" - "+V15.Vf.userName:(document.title=this.appTitle+" - not logged in",this.loginPending=!1)}}}();
"use strict";CB.FilterFlagsEnum={OLSM_NULL:0,OLSM_USE_BOARD:1,OLSM_WINS:16,OLSM_DRAWS:32,OLSM_LOSSES:64,OLSM_WINS_ONLY:128,OLSM_WHITE:256,OLSM_BLACK:512,OLSM_IGNORE_COLORS:1024,OLSM_BEST_GAMES:4096};
CB.SearchMask=function(){var c=function(){this.init()};c.prototype.ELO_NONE=0;c.prototype.YEAR_NONE=0;c.prototype.m_strWhMask="";c.prototype.m_strBlMask="";c.prototype.m_strTournMask="";c.prototype.m_strTitle="";c.prototype.m_strPlaceMask="";c.prototype.freeText="";c.prototype.m_nMinECO=0;c.prototype.m_nMaxECO=65535;c.prototype.m_iMinYear=0;c.prototype.m_iMaxYear=3E3;c.prototype.m_iWhiteMinElo=0;c.prototype.m_iBlackMinElo=0;c.prototype.m_board=new CB.Board;c.prototype.m_eSideToMove=0;c.prototype.m_nFlags=
CB.FilterFlagsEnum.OLSM_WINS|CB.FilterFlagsEnum.OLSM_DRAWS|CB.FilterFlagsEnum.OLSM_LOSSES|CB.FilterFlagsEnum.OLSM_WHITE|CB.FilterFlagsEnum.OLSM_BLACK;c.prototype.init=function(b){};c.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();b.writeByte(1);b.V5(this.m_strWhMask);b.V5(this.m_strBlMask);b.V5(this.m_strTitle);b.V5(this.m_strPlaceMask);b.writeInt(this.m_iMinYear);b.writeInt(this.m_iMaxYear);b.writeInt(this.m_iWhiteMinElo);b.writeInt(this.m_iBlackMinElo);b.Vi(this.m_nMinECO);b.Vi(this.m_nMaxECO);
b.writeInt(this.m_nFlags);if(this.getUseBoard()){b.writeByte(this.m_eSideToMove);for(var d=0;64>d;d++)b.writeByte(this.m_board[d])}b.V5(this.freeText);b.endSizedWrite()};c.prototype.setSearchBoard=function(b,d,c){this.m_board=b;this.m_eSideToMove=d};c.prototype.SETFLAG=function(b,d){this.m_nFlags=d?this.m_nFlags|b:this.m_nFlags&~b};c.prototype.ISFLAG=function(b){return 0!=(this.m_nFlags&b)};c.prototype.setIgnoreColors=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_IGNORE_COLORS,b)};c.prototype.setUseBoard=
function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_USE_BOARD,b)};c.prototype.getUseBoard=function(){return this.ISFLAG(CB.FilterFlagsEnum.OLSM_USE_BOARD)};c.prototype.setWins=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_WINS,b)};c.prototype.setDraws=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_DRAWS,b)};c.prototype.setLosses=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_LOSSES,b)};c.prototype.setWhite=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_WHITE,b)};c.prototype.setBlack=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_BLACK,
b)};c.prototype.setGoodGames=function(b){this.SETFLAG(CB.FilterFlagsEnum.OLSM_BEST_GAMES,b)};c.prototype.setFreeText=function(b){this.freeText=b};c.prototype.parseFreeText=function(){var b="",d=this.freeText.split(" "),c=0;if(1<d.length)for(var f=0;f<d.length;f++)d[f].replace(" ",""),isNaN(d[f])?(b&&(b+=" "),b+=d[f]):c=d[f];0<c&&(this.freeText=b,this.m_iMinYear=this.m_iMaxYear=c)};c.prototype.toString=function(){return"searchmask="+this.freeText+" board= "+m_board.toString()};return c}();"use strict";
CB.OnlineStatEntry=function(){var c=function(){this.clear()},c=function(b){this.moves=[];this.strScore=this.strGames=this.strMoves="";this.iLastYear=0;null!=b&&(this.strMoveNr=b.nota,this.aMove=new CB.Move(b.from,b.to,b.prom))};c.prototype.iLastYear;c.prototype.nWhiteEloSum=0;c.prototype.nBlackEloSum=0;c.prototype.nWhiteEloCount=0;c.prototype.nBlackEloCount=0;c.prototype.nLosses=0;c.prototype.nDraws=0;c.prototype.nWins=0;c.prototype.nGames=0;c.prototype.nDate=0;c.prototype.score=0;c.prototype.strMoveNr=
"?";c.prototype.moves=[];c.prototype.aMove=new CB.Move;c.prototype.clear=function(){nGames=nDate=nLosses=nDraws=nWins=nWhiteEloCount=nBlackEloCount=nWhiteEloSum=nBlackEloSum=0;this.moves=[]};c.prototype.getMove=function(b){return b<this.moves.length?this.moves[b]:new CB.Move};c.prototype.getNMoves=function(){return this.moves.length};c.prototype.getNWhiteEloAv=function(){return 0<this.nWhiteEloCount?Math.round(this.nWhiteEloSum/this.nWhiteEloCount):0};c.prototype.getNBlackEloAv=function(){return 0<
this.nBlackEloCount?Math.round(this.nBlackEloSum/this.nBlackEloCount):0};c.prototype.getNEloAv=function(b){return b==CB.Side.WHITE?this.getNWhiteEloAv():this.getNBlackEloAv()};c.prototype.V3=function(b,d){b.beginSizedRead();this.nGames=b.Vw();this.strGames=this.nGames.toString();this.nDate=b.Vw();this.iLastYear=(new CB.Date(this.nDate)).year>>9;this.nLosses=b.Vw();this.nDraws=b.Vw();this.nWins=b.Vw();b.Vw();this.nWhiteEloCount=b.Vw();this.nWhiteEloSum=b.Vy();this.nBlackEloCount=b.Vw();this.nBlackEloSum=
b.Vy();var c=b.readUint8();if(0<c){var f=new CB.NumBoard;f.init(d.board,f.FORMAT_1);for(var g=new CB.NotationGenerator(lm.NOTA_LOCALIZATION),h=new CB.MoveCoder,l=0;l<c;++l){var q=h.decode(b.readUint8(),l);if(0<q&&q<f.FULL_MOVE_INFO){var r=new CB.Position;d.copyTo(r);var t=new CB.Move;f.decode(t,q,r.getBTM());r.isLegalMove(t)&&(r.preCalcCtx(t),r.makeMove(t),r.postCalcCtx(t,!0),q=g.getMoveNota(t),t.nota=q,this.moves.push(t))}}}b.endSizedRead();return!0};return c}();"use strict";
CB.OnlineStatistics=function(){var c=function(){this.vecStat=[]};c.prototype.clear=function(){this.vecStat=[]};c.prototype.V3=function(b,d){this.clear();var c=b.Vw(),f=d.toFEN(),g=new CB.Position(f);if(0<c&&(f=new CB.OnlineStatEntry,f.V3(b,g),--c,0<c))for(g=0;g<f.getNMoves()&&0<c;++g,--c){var h=d.toFEN(),h=new CB.Position(h),l=f.getMove(g);h.preCalcCtx(l);h.makeMove(l);h.postCalcCtx(l,!0);l=new CB.OnlineStatEntry(l);l.V3(b,h);this.vecStat.push(l)}return!0};c.prototype.getEntry=function(b){return this.vecStat[b]};
c.prototype.Count=function(){return this.vecStat.length};return c}();"use strict";CB.OnlineEntryEnum={FLAGS_ONLINE_NONE:0,FLAGS_ONLINE_ID:1,FLAGS_ONLINE_HEADER:2,FLAGS_ONLINE_GAME:2,toString:function(c){for(var b in this)if(this[b]==c)return"OnlneEntryId: "+b;return"Unknown OnlineEntryId: "+c}};CB.OnlineEntry=function(){var c=function(){this.aGame=new CB.Game};c.prototype.aGame;c.prototype.aHeader;c.prototype.aDB;c.prototype.nGameNr;c.prototype.nFlags;return c}();"use strict";
CB.GameEncoder=function(){var c=function(){};c.prototype.numBits=[1,6,6,5,5,5,3,1,1,6,6,5,5,5,3,1];c.prototype.theBits=[0,32,34,18,20,22,6,0,0,33,35,19,21,23,7,0];c.prototype.isUniqe=[0,255,255,255,255,255,6,14,255,255,255,255,255,255,255,255,255,255,3,11,4,12,5,13,255,255,255,255,255,255,255,255,1,9,2,10,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];c.prototype.moveDecode18=[90,170,153,97,156,120,48,246,217,33,251,89,244,117,179,
207,138,229,61,134,20,71,41,42,47,157,19,128,51,253,27,168,57,178,205,242,200,185,0,139,132,58,106,30,59,86,194,64,214,53,10,84,5,186,72,131,85,11,100,103,243,191,212,6,29,225,177,38,227,180,160,143,215,122,95,187,199,236,226,88,175,119,218,184,209,222,98,163,62,83,142,112,65,166,174,167,16,197,137,189,66,32,107,255,74,79,123,155,34,46,75,76,196,245,249,173,221,210,198,39,223,44,224,4,231,9,111,109,96,182,146,70,94,69,23,254,172,145,93,234,56,36,102,148,115,55,108,105,21,220,40,77,150,99,114,181,
37,63,144,110,235,158,202,211,240,101,91,149,12,43,15,68,248,125,219,7,49,67,17,206,203,193,1,171,104,232,228,113,26,247,28,129,204,147,216,80,195,165,3,140,161,116,208,183,31,241,22,130,118,78,151,82,87,121,8,252,35,192,213,133,14,45,54,50,250,176,73,126,60,201,169,25,13,92,190,233,81,230,127,135,162,152,164,141,124,154,238,239,24,136,188,237,159,52,2,18];c.prototype.HUFF_960=128;c.prototype.HUFF_CASTLE=64;c.prototype.HUFF_EP=32;c.prototype.decodeMove2=function(b,d){var c=[];c[0]=CB.Piece.QUEEN;
c[1]=CB.Piece.ROOK;c[2]=CB.Piece.BISHOP;c[3]=CB.Piece.KNIGHT;b.From=d>>6&63;b.To=d>>0&63;b.SetProm(c[d>>12&3]);b.SetMoveType(0);return!0};c.prototype.decode=function(b,d){var c=!1,f=d.getPos()-4;d.rewind();for(var g=[],h=0;h<f;h++)g[h]=d.readUint8();if(0<f&&g[0]<=f){c=new CB.Position;0<g[0]?(HuffToPos3(c,g,f),b.setStartPosition(c),h=g[0],CBDebug.assert(!1)):(b.getStartPos().NormalInit=!0,h=1);var l=new CB.NumBoard;for(l.init(c.board,l.FORMAT_1);h<f;){var q=new CB.Move,r=this.moveDecode18[g[h]]-h;
++h;if(r>=l.FULL_MOVE_INFO)if(r==l.FULL_MOVE_INFO){if(h+2>f)break;r=this.moveDecode18[g[h]]-h;++h;r|=this.moveDecode18[g[h]]-h<<8;++h;decodeMove2(q,r)}else break;else 0<r&&l.decode(q,r,c.getBTM());this.addMoveInfo(c,q);b.makeMove(q);l.execute(q,c)}c=!0}return c};c.prototype.posToHuff3=function(b,d,c){var f,g,h;varindex=0;d[index]=0;index++;d[index]=0;b.GetBTM()&&(d[index]=128);f=0;g=1;for(h=2;64>f;f++){var l=b[f]&15;g+=numBits[l];if(8<g){d[index]|=theBits[l]>>g-8;if(++h>c)return ERRCODE.EC_CANCEL;
index++;d[index]=0;g-=8}d[index]|=theBits[l]<<8-g;if(8<=g){g=0;if(++h>c)return ERRCODE.EC_CANCEL;index++;d[index]=0}}l=f=0;0<b.GetCastleRights()&&(l|=HUFF_CASTLE,f+=4);0<b.GetCPPEPFile()&&(l|=HUFF_EP,f+=3);if(0<f){if(8<g+f){if(++h>c)return ERRCODE.EC_CANCEL;index++;d[index]=0}0<b.GetCastleRights()?(d[index]|=b.GetCastleRights()&15,0<b.GetCPPEPFile()&&(d[index]|=(b.GetCPPEPFile()-1&7)<<4)):0<b.GetCPPEPFile()&&(d[index]|=b.GetCPPEPFile()-1&7)}else 0==g&&--h;d[index]=h|l;return ERRCODE.EC_OK};c.prototype.huffToPos3=
function(b,d,c){var f,g,h=0,l;for(f=0;64>f;f++)b[f]=0;f=d[h]&(HUFF_960|HUFF_CASTLE|HUFF_EP);g=d[h]&31;if(8<g&&g<c){0<(f&HUFF_CASTLE)?(b.SetCastleRights(d[g-1]&15),0<(f&HUFF_EP)?b.setCPPEPFile((d[g-1]>>4&7)+1):b.setCPPEPFile(0)):(b.SetCastleRights(CB.CastleRights.NONE),0<(f&HUFF_EP)?b.setCPPEPFile((d[g-1]&7)+1):b.setCPPEPFile(0));h++;b.SetSideToMove(0<(d[h]&128)?CB.Side.BLACK:CB.Side.WHITE);f=0;c=1;for(l=64;64>f&&c<g;f++){var q=0,r=0;do q<<=1,0<(d[h]&l)&&(q|=1),r++,l>>=1,0==l&&(l=128,h++,c++);while(255==
isUniqe[q]&&6>r);if(255==isUniqe[q])break;b[f]=CB.Piece(isUniqe[q])}if(64>f)return b.SetGroundPos(),ERRCODE.EC_CANCEL}else return b.SetGroundPos(),ERRCODE.EC_CANCEL;b.FindKings();return ERRCODE.EC_OK};c.prototype.addMoveInfo=function(b,d){b.preCalcCtx(d);b.makeMove(d);b.postCalcCtx(d,!0)};return c}();CB.NumBoardImpl=function(){var c=function(){};c.prototype.numBoard=[];c.prototype.piecePos=[];return c}();
CB.NumBoard=function(){var c=function(){this.numBoard=this.m_aImpl.numBoard;this;piecePos=this.m_aImpl.piecePos};c.prototype.MOVE_EP=16;c.prototype.MOVE_DOUBLE=32;c.prototype.MOVE_PROM=64;c.prototype.moveOffs_Chess=[0,0,0,0,0,0,0,4,2,1,0,0,0,0,0,3,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,6,7,0,0,0,0,0,5,0,0,1,2,3,4,5,6,7,14,1,0,0,0,6,21,8,0,15,0,0,0,22,7,9,0,0,16,0,23,0,0,10,0,0,0,17,0,0,0,11,0,0,25,0,18,0,0,12,3,26,0,0,0,19,4,13,27,2,0,0,0,5,20,0,0,1,0,0,0,
1,0,0,2,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,2];c.prototype.moveOffs2=[0,0,0,0,0,0,0,4,2,1,0,0,0,0,0,3,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,0,0,0,0,0,0,0,6,7,0,0,0,0,0,5,0,0,1,2,3,4,5,6,7,14,1,0,0,0,6,21,8,0,15,0,0,0,22,7,9,0,0,16,0,23,0,0,10,0,0,0,17,0,0,0,11,0,0,25,0,18,0,0,12,3,26,0,0,0,19,4,13,27,2,0,0,0,5,20,0,0,1,0,0,0,1,0,0,2,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,2];c.prototype.tableOffs_Chess=[0,0,1,1,1,1,2,0,0,0,1,1,1,1,2,0];c.prototype.tableOffs2=[0,0,1,1,1,1,2,0,0,0,1,1,1,1,2,0];c.prototype.wPawnOffs_Chess=111;c.prototype.pieceMov_Chess=[0,1,9,8,15,7,63,56,57,16,48,1,2,3,4,5,6,7,8,16,24,32,40,48,56,9,18,27,36,45,54,63,15,22,29,36,43,50,57,1,2,3,4,5,6,7,8,16,24,32,40,48,56,1,2,3,4,5,6,7,8,16,24,32,40,48,56,9,18,27,36,45,54,63,15,22,29,36,43,50,57,9,18,27,36,45,54,63,15,22,29,36,43,50,57,17,10,58,49,55,62,14,23,17,10,
58,49,55,62,14,23,1,2,9,57,1,2,9,57,1,2,9,57,1,2,9,57,1,2,9,57,1,2,9,57,1,2,9,57,1,2,9,57,1,2,3,4,5,6,7,8,16,24,32,40,48,56,9,18,27,36,45,54,63,15,22,29,36,43,50,57,1,2,3,4,5,6,7,8,16,24,32,40,48,56,9,18,27,36,45,54,63,15,22,29,36,43,50,57,1,2,3,4,5,6,7,8,16,24,32,40,48,56,9,18,27,36,45,54,63,15,22,29,36,43,50,57,17,10,58,49,55,62,14,23,0,0,1,9,8,15,7,63,56,57,16,48];c.prototype.bPawnMov_Chess=[7,6,63,15,7,6,63,15,7,6,63,15,7,6,63,15,7,6,63,15,7,6,63,15,7,6,63,15,7,6,63,15];c.prototype.pieceNum_Chess=
[0,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,5,5,5,5,5,5,5,5,5,5,5,5,5,5,21,21,21,21,21,21,21,21,21,21,21,21,21,21,4,4,4,4,4,4,4,4,4,4,4,4,4,4,20,20,20,20,20,20,20,20,20,20,20,20,20,20,3,3,3,3,3,3,3,3,19,19,19,19,19,19,19,19,6,6,6,6,22,22,22,22,38,38,38,38,54,54,54,54,70,70,70,70,86,86,86,86,102,102,102,102,118,118,118,118,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,
34,34,34,34,34,34,34,34,37,37,37,37,37,37,37,37,37,37,37,37,37,37,36,36,36,36,36,36,36,36,36,36,36,36,36,36,35,35,35,35,35,35,35,35,0,0,17,17,17,17,17,17,17,17,17,17];c.prototype.pieceOffs_Chess=[0,1,11,95,53,39,111,0,0,1,11,95,53,39,111,0,0,237,143,103,67,53,115,0,0,237,143,103,67,53,115,0,0,0,171,227,199,199,119,0,0,0,171,227,199,199,119,0,0,0,0,0,0,0,123,0,0,0,0,0,0,0,123,0,0,0,0,0,0,0,127,0,0,0,0,0,0,0,127,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,131,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0,139,
0,0,0,0,0,0,0,139,0];c.prototype.pieceInx_Chess=[0,24,0,1,2,3,26,0,0,25,12,13,14,15,27,0,0,42,4,5,6,7,28,0,0,43,16,17,18,19,29,0,0,0,8,9,10,11,30,0,0,0,20,21,22,23,31,0,0,0,0,0,0,0,32,0,0,0,0,0,0,0,33,0,0,0,0,0,0,0,34,0,0,0,0,0,0,0,35,0,0,0,0,0,0,0,36,0,0,0,0,0,0,0,37,0,0,0,0,0,0,0,38,0,0,0,0,0,0,0,39,0,0,0,0,0,0,0,40,0,0,0,0,0,0,0,41,0];c.prototype.maxPiece_Chess=[0,16,48,48,48,48,128,0,0,16,48,48,48,48,128,0];c.prototype.maxPiece_MultiKing=[0,32,48,48,48,48,128,0,0,32,48,48,48,48,128,0];c.prototype.moveOffs=
[];c.prototype.tableOffs=[];c.prototype.pieceMov=[];c.prototype.pieceNum=[];c.prototype.bPawnMov=[];c.prototype.pieceOffs=[];c.prototype.pieceInx=[];c.prototype.maxPiece=[];c.prototype.wPawnOffs=0;c.prototype.FORMAT_0=0;c.prototype.FORMAT_1=1;c.prototype.FULL_MOVE_INFO=235;c.prototype.CB_ORIGIN1=236;c.prototype.KING2_START=237;c.prototype.KING2_END=246;c.prototype.CB_LINE_START=254;c.prototype.CB_LINE_END=255;c.prototype.IsMultiByte=function(b){return b==FULL_MOVE_INFO};c.prototype.m_aImpl=new CB.NumBoardImpl;
c.prototype.numBoard=[];c.prototype.piecePos=[];c.prototype.MOVEPIECE=function(b,d){b&&b<this.maxPiece[b&CB.Piece.PIECE_MASK]&&(this.piecePos[this.pieceInx[b]]=d)};c.prototype.init=function(b,d){var c=[],f;this.moveOffs=this.moveOffs_Chess;this.tableOffs=this.tableOffs_Chess;this.pieceMov=this.pieceMov_Chess;this.pieceNum=this.pieceNum_Chess;this.bPawnMov=this.bPawnMov_Chess;this.pieceOffs=this.pieceOffs_Chess;this.pieceInx=this.pieceInx_Chess;this.maxPiece=this.maxPiece_Chess;this.wPawnOffs=this.wPawnOffs_Chess;
for(f=0;48>f;f++)this.piecePos[f]=255;for(f=0;16>f;f++)c[f]=f;switch(d){case this.FORMAT_1:for(f=63;0<=f;f--){var g=b[f]&15;0<g?(this.numBoard[f]=c[g],c[g]<this.maxPiece[g&CB.Piece.PIECE_MASK]&&(this.piecePos[this.pieceInx[c[g]]]=f,c[g]+=16),CBDebug.assert(0<this.numBoard[f])):this.numBoard[f]=0}break;default:for(f=0;64>f;f++)g=b[f],0<g?(this.numBoard[f]=c[g],c[g]<maxPiece[g&CB.Piece.PIECE_MASK]&&(this.piecePos[pieceInx[c[g]]]=f,c[g]+=16),CBDebug.assert(0<this.numBoard[f])):this.numBoard[f]=0}};c.prototype.promote=
function(b,d){for(d|=uint(b&Chess.COLOUR);d<maxPiece[d&15];){if(255==piecePos[pieceInx[d]]){piecePos[pieceInx[d]]=piecePos[pieceInx[b]];break}d+=16}numBoard[piecePos[pieceInx[b]]]=d;piecePos[pieceInx[b]]=255;return 0};c.prototype.capture=function(b){if(b)if((b&CB.Piece.PIECE_MASK)==CB.Piece.PAWN)this.MOVEPIECE(b,255);else if(b<this.maxPiece[b&15]){this.MOVEPIECE(b,255);for(var d=this.maxPiece[b&15]-16,c=b;c<d;c+=16){this.piecePos[this.pieceInx[c]]=this.piecePos[this.pieceInx[c+16]];if(255==this.piecePos[this.pieceInx[c]])break;
this.numBoard[this.piecePos[this.pieceInx[c]]]=c;this.piecePos[this.pieceInx[c+16]]=255}if(255!=this.piecePos[this.pieceInx[d|b&15]])for(b=this.maxPiece[b&15]|b&15,c=0;64>c;c++)if(this.numBoard[c]==b){this.piecePos[this.pieceInx[b-16]]=c;this.numBoard[c]=b-16;break}}return 0};c.prototype.execute=function(b,d){if(!b.IsNullMove){var c=b.from,f=b.to,g=this.numBoard[c],h=this.numBoard[f];g||CBDebug.assert("no piece to move");this.numBoard[f]=this.numBoard[c];this.numBoard[c]=0;this.MOVEPIECE(g,f);h&&
(h&CB.Piece.PIECE_MASK)!=CB.Piece.KING&&this.capture(h);if(b.isCastling()||b.isProm())b.isProm()?b.IsProm()&&this.promote(g,b.prom):b.isCastling()&&(d.getBTM()?b.isLongCastling()?(this.MOVEPIECE(this.numBoard[CB.Square.A8],f+(CB.Square.B8-CB.Square.A8)),this.numBoard[f+(CB.Square.B8-CB.Square.A8)]=this.numBoard[CB.Square.A8],this.numBoard[CB.Square.A8]=0):b.isShortCastling()&&(this.MOVEPIECE(this.numBoard[CB.Square.H8],CB.Square.F8),this.numBoard[CB.Square.F8]=this.numBoard[CB.Square.H8],this.numBoard[CB.Square.H8]=
0):b.isLongCastling()?(this.MOVEPIECE(this.numBoard[CB.Square.A1],f+(CB.Square.B1-CB.Square.A1)),this.numBoard[f+(CB.Square.B1-CB.Square.A1)]=this.numBoard[CB.Square.A1],this.numBoard[CB.Square.A1]=0):b.isShortCastling()&&(this.MOVEPIECE(this.numBoard[CB.Square.H1],CB.Square.F1),this.numBoard[CB.Square.F1]=this.numBoard[CB.Square.H1],this.numBoard[CB.Square.H1]=0));for(c=0;64>c;c++)this.numBoard[c]&&this.numBoard[c]<this.maxPiece[this.numBoard[c]&7]&&this.piecePos[this.pieceInx[this.numBoard[c]]]!=
c&&DUMP("(1) Inx corrupted: "+String(c))}};c.prototype.encode=function(b,d){CBDebug.assert(0<numBoard[b.from]);if(0<numBoard[b.from]&&numBoard[b.from]<maxPiece[b.CB.Piece.Nominal()]){var c=(b.to&56)-(b.from&56)&56|(b.To&7)-(b.From&7)&7;d=pieceOffs[numBoard[b.from]]+moveOffs[64*tableOffs[b.CB.Piece.Nominal()]+c];CBDebug.assert(d<FULL_MOVE_INFO||16<maxPiece[CB.Piece.KING]&&d>=KING2_START&&d<=KING2_END);c=new CB.Move;Decode(c,d,(numBoard[b.fr]&Chess.COLOUR)==Chess.COLOUR);CBDebug.assert(c.From==b.From&&
c.To==b.To)}};c.prototype.decode=function(b,d,c){CBDebug.assert(d<this.FULL_MOVE_INFO||16<this.maxPiece[CB.Piece.KING]&&d>=this.KING2_START&&d<=this.KING2_END);var f=this.pieceMov[d],g=this.pieceNum[d];c&&(g|=CB.Side.SIDE_MASK,(g&CB.Piece.PIECE_MASK)==CB.Piece.PAWN&&(f=this.bPawnMov[d-this.wPawnOffs]));b.from=this.piecePos[this.pieceInx[g]]&63;b.to=(b.from&56)+(f&56)&56|b.from+f&7;b.prom=0;for(b=b.type=0;64>b;b++)0!=this.numBoard[b]&&this.numBoard[b]<this.maxPiece[this.numBoard[b]&CB.Piece.PIECE_MASK]&&
this.piecePos[this.pieceInx[this.numBoard[b]]]!=b&&CBDebug.assert(!1)};return c}();
CB.MoveCoder=function(){var c=function(){};c.prototype.moveEncode19=[115,113,245,122,119,36,91,210,93,137,56,239,159,205,160,142,246,17,125,46,62,241,57,130,39,88,11,70,204,118,173,135,54,30,199,68,154,186,55,27,168,53,175,123,52,49,129,221,206,1,73,169,18,209,58,165,183,72,31,198,251,6,63,2,101,229,136,32,60,71,41,37,110,250,197,51,43,150,105,163,238,26,191,116,249,207,208,75,215,40,158,111,120,134,234,67,176,86,121,185,124,83,240,24,89,244,13,196,223,78,38,231,103,79,171,145,184,151,149,69,188,
181,161,0,195,44,5,178,172,174,66,133,80,217,254,236,146,132,157,235,96,242,140,87,74,247,100,219,95,99,187,224,85,255,155,22,237,192,148,126,141,167,189,139,180,20,47,23,182,222,179,131,220,3,253,200,127,7,16,33,214,152,211,42,14,97,64,45,77,227,19,29,248,153,156,112,147,109,61,233,225,218,81,144,213,59,84,9,166,104,76,194,228,232,212,48,177,252,203,143,34,10,162,35,98,106,65,90,25,190,193,138,128,92,230,4,15,107,21,243,201,108,102,12,202,114,94,28,216,164,117,82,226,170,8,50];c.prototype.moveDecode19=
[123,49,63,173,235,126,61,177,254,207,221,26,243,106,184,236,178,17,52,190,165,238,155,167,103,228,81,39,247,191,33,58,67,179,220,223,5,71,110,24,89,70,183,76,125,187,19,166,215,45,255,75,44,41,32,38,10,22,54,205,68,198,20,62,186,226,130,95,35,119,27,69,57,50,144,87,210,188,109,113,132,202,251,101,206,152,97,143,25,104,227,6,233,8,246,148,140,185,224,149,146,64,242,112,209,78,225,237,241,197,72,91,195,1,245,0,83,250,29,4,92,98,3,43,100,18,159,176,232,46,23,171,137,131,93,31,66,9,231,163,142,160,15,
219,203,115,136,196,158,118,77,117,181,193,36,154,194,138,90,12,14,122,222,79,249,55,208,161,40,51,253,114,128,30,129,42,96,216,127,170,164,121,168,56,116,99,37,150,120,162,229,82,157,230,211,124,107,74,59,34,175,240,244,218,28,13,48,85,86,53,7,182,214,204,180,88,248,133,201,147,172,47,169,108,151,200,252,189,212,65,234,111,213,199,94,139,135,156,80,11,102,21,141,239,105,2,16,145,192,84,73,60,217,174,134,153];c.prototype.decode=function(b,d){return this.moveEncode19[b-d]};c.prototype.decode=function(b,
d){return this.moveDecode19[b]+d};return c}();"use strict";CB.namespace("CB.Server.OnlineLobby");CB.OnlineDBUserMsgId={NONE:0,REQUEST_AUTOCOMPLETE:1350,AUTOCOMPLETE:1351,toString:function(c){for(var b in this)if(this[b]==c)return b;return"Unknown OnlineDBUserMsgId: "+c}};
CB.Server.OnlineLobby=function(){var c=function(){this.idGroup=0;this.maxGames=100;this.firstMove=0;this.name="OnlineDB"};CB.inherit(c,CB.Server.Connector);c.prototype.createLobby=function(b,c,f,g){this.create(b,c,f,g)};c.prototype.testYesNo=function(b){CB.LOG("YesNo="+b)};c.prototype.games=[];c.prototype.statboard=new CB.Board;c.prototype.statside=0;var b;c.prototype.getStatistics=function(d,c){if(0<this.getNId()){V15.panelMgr.dbBook&&V15.panelMgr.dbBook.startupdate();b=this;b.statboard=new CB.Board;
for(var f=0;64>f;f++)b.statboard[f]=d[f];this.statside=c;f=new CB.WebSockMessage(CB.SockMsgId.REQUEST_ONLINE_DB_STATISTICS);f.buf.beginSizedWrite();f.buf.writeByte(c);for(var g=0;64>g;g++)f.buf.writeByte(d[g]);f.buf.endSizedWrite();this.send(f)}};c.prototype.search=function(b,c,f){V15.panelMgr.dbGames&&V15.panelMgr.dbGames.startupdate();var g=new CB.WebSockMessage(CB.SockMsgId.QUERY_ONLINE_DB);this.games=[];this.games.length=0;b.parseFreeText();b.writeToDataBuffer(g.buf);this.maxGames=c||50;this.firstMove=
f||0;this.send(g)};c.prototype.getHeaders=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.REQUEST_ONLINE_DB_HEADERS);c.buf.Vh(b.length);for(var f=0;f<b.length;f++)c.buf.Vh(b[f]);this.send(c)};c.prototype.getOneGame=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.REQUEST_ONLINE_DB_GAMES);c.setVal(1);c.buf.Vh(1);c.buf.Vh(b);this.send(c)};c.prototype.getGames=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.REQUEST_ONLINE_DB_GAMES);c.setVal(2);c.buf.Vh(b.length);for(var f=0;f<b.length;f++)c.buf.Vh(b[f]);
this.send(c)};c.prototype.requestInfo=function(){var b=new CB.WebSockMessage(CB.SockMsgId.REQUEST_ONLINE_DB_USER_INFO);this.send(b)};c.prototype.handleReceived=function(b){if(!this.handleReceivedByConnector(b))try{switch(b.getType()){default:TRACE("Unhandled: "+b.toString());break;case CB.SockMsgId.DEFAULTGROUPS:this.requestInfo();break;case CB.SockMsgId.ONLINE_DB_STATISTICS:this.handleOnlineStatistics(b);break;case CB.SockMsgId.ONLINE_DB_USER_INFO:this.handleOnlineDBUserInfo(b);break;case CB.SockMsgId.ONLINE_DB_NUMBERS:this.handleOnlineDBNumbers(b);
break;case CB.SockMsgId.ONLINE_DB_GAMES:this.handleGames(b);break;case CB.SockMsgId.ONLINE_DB_HEADERS:this.handleHeaders(b);break;case CB.SockMsgId.USER:this.handleUserMsg(b)}}catch(c){CB.LogException(CB.SockMsgId.toNumString(b.getType()),c)}};c.prototype.handleHeaders=function(b){b=b.getBuf();for(var c=[],f=b.Vw(),g=0;g<f;g++){b.beginSizedRead();var h=b.Vw(),l=new CB.DataBuffer;if(0<h){for(var q=b.Vw(),r=0;r<q;r++)l.writeUint8(b.readUint8());q=new CB.Game;if(!this.loadHeader(q,l))break;for(l=0;l<
this.games.length;l++)if(this.games[(l+g)%this.games.length].aGameNr==h){this.games[(l+g)%this.games.length].aGame.hdr=q.hdr;this.games[(l+g)%this.games.length].nFlags=CB.OnlineEntryEnum.FLAGS_ONLINE_HEADER;c.push(this.games[(l+g)%this.games.length]);break}}b.endSizedRead()}this.fireOnGames(c)};c.prototype.handleGames=function(b){var c=b.getBuf(),f=c.Vw();if(1==f&&1==b.getVal())c.beginSizedRead(),b=c.Vw(),0<b&&(f=new CB.Game,this.readGame(f,c)&&V15.panelMgr.loadGame(f)),c.endSizedRead();else{for(var g=
[],h=0;h<f;h++){c.beginSizedRead();b=c.Vw();if(0<b){var l=new CB.Game;if(this.readGame(l,c,b))g.push({aGame:l,aGameNr:b,nFlags:CB.OnlineEntryEnum.FLAGS_ONLINE_HEADER|CB.OnlineEntryEnum.FLAGS_ONLINE_GAME});else break}c.endSizedRead()}this.fireOnGames(g)}};c.prototype.handleOnlineDBNumbers=function(b){b=b.getBuf();var c=b.Vw();b.Vw();for(var f=0;f<c&&f<this.maxGames;f++){var g=b.Vw();if(0<g){var h=new CB.OnlineEntry;h.nFlags=CB.OnlineEntryEnum.FLAGS_ONLINE_ID;h.aGameNr=g;this.games.push(h)}}if(V15.panelMgr&&
V15.panelMgr.setGames)V15.panelMgr.setGames(this.games);else if(V15.panelMgr.usesOnlineDB&&V15.panelMgr.usesOnlineDB()){b=[];for(c=0;c<this.games.length;c++)this.games[c].nFlags==CB.OnlineEntryEnum.FLAGS_ONLINE_ID&&b.push(this.games[c].aGameNr);0<b.length&&V15.onlineLobby.getGames(b)}};c.prototype.handleOnlineStatistics=function(d){d=d.getBuf();for(var c=new CB.Position,f=0;64>f;f++)c.board[f]=b.statboard[f];c.sd=b.statside;f=new CB.OnlineStatistics;f.V3(d,c);this.fireOnStatistics(f)};c.prototype.handleOnlineDBUserInfo=
function(b){this.nGamesInDatabase=b.getBuf().Vw();b=new CB.SearchMask;var c,f=0;this.getGameForFirstSearch?(c=this.getGameForFirstSearch(),f=c.getCurPos().getPlyNum()):c=new CB.Game;var g=decodeURIComponent(CB.strUtil.trimQuotes(CB.strUtil.getURLParam("search")));g?b.freeText=g:(b.setSearchBoard(c.getCurPos().board,c.getCurPos().getSideToMove()),b.setUseBoard(!0));this.search(b,50,f)};c.prototype.handleUserMsg=function(b){try{switch(b.getUserType()){default:CB.LOG("UserMsg="+CB.UserMsgId.toString(b.getUserType()));
break;case CB.OnlineDBUserMsgId.AUTOCOMPLETE:this.handleAutoComplete(b)}}catch(c){CB.LogException(CB.UserMsgId.toNumString(b.getUserType()),c)}};c.prototype.requestAutoComplete=function(b,c,f){this.autoCompleteCallbackFn=c;this.combo=f;b=new CB.GameAutoCompleteRequest(b,CB.GameAutoCompleteEnum.ACR_LASTNAME);c=new CB.WebSockMessage(CB.SockMsgId.USER);b.write(c.buf);c.setUserType(CB.OnlineDBUserMsgId.REQUEST_AUTOCOMPLETE);this.send(c)};c.prototype.handleAutoComplete=function(b){var c=new CB.GameAutoCompleteAnswer;
c.read(b.getBuf());this.autoCompleteCallbackFn(this.combo,c)};c.prototype.readGame=function(b,c,f){try{return b.read2(c)}catch(g){console.log(g)}return!1};c.prototype.loadHeader=function(b,c){try{return c.rewind(),b.hdr.read(c),!0}catch(f){CB.LogException("OL-LH:"+f)}return!1};c.prototype.handleChat=function(b){V15.panelMgr.chatOut(chat.toString())};c.prototype.handleReconnectOk=function(b){};Ve.initForListeners(c);Ve.addEvent(c,"Statistics");Ve.addEvent(c,"Games");return c}();"use strict";
CB.GameAutoCompleteEnum={ACR_NONE:0,ACR_LASTNAME:1,ACR_FIRSTNAME:2,ACR_EVENT:4,ACR_SITE:8,toString:function(c){for(var b in this)if(this[b]==c)return"GameAutoCompleteId: "+b;return"Unknown GameAutoCompleteId: "+c}};CB.GameAutoCompleteRequest=function(){var c=function(b,d){this.m_strRequest=b;this.m_nFlags=d};c.prototype.write=function(b){b.beginSizedWrite();b.Vx(this.m_nFlags);b.Vn(this.m_strRequest);b.endSizedWrite()};return c}();
CB.GameAutoCompleteAnswer=function(){var c=function(){};c.prototype.read=function(b){this.data=[];b.beginSizedRead();for(var d=b.V10(),c=0;c<d;c++){var f=b.Vq(80);this.data.push(f)}b.endSizedRead()};return c}();
CB.LocalPlayerBase=function(){var c=function(){this.instance=localforage.createInstance({name:"Player"})};c.prototype.instance=null;c.prototype.createDatabase=function(){};c.prototype.setPlayer=function(b,d,c){c?d=this.getLastNameKey(c)+","+this.getFirstNameKey(d):(d=b.player.player.m_NewCBPlayer.m_aKey,d=this.getLastNameKey(d.m_sLastName)+","+this.getFirstNameKey(d.m_sFirstName));this.instance.setItem(d,b)};c.prototype.beginGetPlayer=function(b,d,c,f,g,h){b=this.getFirstNameKey(b);d=this.getLastNameKey(d);
this.instance.getItem(d+","+b).then(function(b){b?g(b):h("Player not found")})};c.prototype.getFirstNameKey=function(b){return b?b.split(/[\s-]/gi)[0]:""};c.prototype.getLastNameKey=function(b){return b.replace(/[\s-]/gi,"")};return c}();"use strict";CB.namespace("CB.Server.PlayerLobby");
CB.Server.PlayerLobby=function(){var c=function(){this.name="Players";this.idPictureTicket=this.idCandidateTicket=this.idPlayerTicket=0;this.playerContext={};this.reconnectBaseTime=6E4;this.localPB=new CB.LocalPlayerBase;this.requestQueue=[];this.connectTries=0};CB.inherit(c,CB.Server.Connector);c.prototype.requestQueue=null;c.prototype.connect=function(b,c){this.callbackfnConnected=b;this.superClass.connect.apply(this,arguments)};c.prototype.logon=function(){if(!this.hasIdReceived){var b=new CB.LogonData(this.user,
this.pass,CB.LoginMode.NORMAL,V15.Vf.guid);this.send(b.Vc())}};c.prototype.logOff=function(){if(this.hasIdReceived&&!this.loggedOff){var b=new CB.WebSockMessage(CB.SockMsgId.LOGOFF);b.address(this.conn.connectId,CB.ConnectId.SERVER);b.buf.Vx(0);this.send(b);this.pingTimer.stop();this.loggedOff=!0}};new CB.Vr;c.prototype.notifyUserActivity=function(){};c.prototype.getNId=function(){return this.conn.connectId};c.prototype.getNIdBound=function(){return this.idBound};c.prototype.isGuest=function(){return this.client?
this.client.isGuest():!0};c.prototype.onConnect=function(){this.pingTimer.stop();this.loginMode==CB.LoginMode.GUEST?this.logonGuest():this.logon()};c.prototype.sendFeedback=function(b,c,f){this.callbackFeedback=f;f=new CB.WebSockMessage(CB.SockMsgId.PLAYER_BASE_USER);f.setUserType(CB.PlayerUserMsgId.SEND_FEEDBACK);f.buf.Vn(b);f.buf.Vn(c);f.buf.Vx(V15.versionCode.nFamily);f.buf.Vn(CB.Language.getStrUserLanguage());this.send(f)};c.prototype.localPB=null;c.prototype.byteArrayToBase64=function(b){var c=
"";b=new Uint8Array(b);for(var f=b.byteLength,g=0;g<f;g++)c+=String.fromCharCode(b[g]);return window.btoa(c)};c.prototype.Base64ToByteArray=function(b){b=window.atob(b);for(var c=b.length,f=new Uint8Array(c),g=0;g<c;g++)f[g]=b.charCodeAt(g);return f.buffer};c.prototype.addToStorage=function(b,c,f){this.localPB.setPlayer({player:b,created:new Date},c,f)};var b=function(b,c){var f=b.player,g=new CB.Player;g.m_NewCBPlayer=new CB.NewCBPlayer;g.m_NewCBPlayer.m_aKey=new CB.PlayerKey;g.m_NewCBPlayer.m_HighData=
new CB.HighPlayerData;g.setFirstName(f.player.m_NewCBPlayer.m_aKey.m_sFirstName);g.setLastName(f.player.m_NewCBPlayer.m_aKey.m_sLastName);g.setNation(f.player.m_NewCBPlayer.m_HighData.m_aNation);g.setTitle(f.player.m_NewCBPlayer.m_HighData.m_aTitle);c({player:g,pic:f.pic})};c.prototype.getLocalPlayer=function(d,c,f,g){this.localPB.beginGetPlayer(d,c,0,0,function(d){var c=d.created;c.setDate(c.getDate()+1);c>new Date?b(d,f):g()},g)};c.prototype.getPlayer=function(d,c,f,g,h,l){var q=function(b){30>
++this.connectTries&&(this.isLoggedIn()||this.conn.isConnected()||this.conn.isConnecting()||this.connect(),this.requestWithTicket(d,c,f,g,function(b){this.addToStorage(b,d,c);h(b)}.bind(this)),l&&l())}.bind(this);this.localPB.beginGetPlayer(d,c,f,g,function(d){var c=d.created;c.setMonth(c.getMonth()+1)>new Date?b(d,h):q()}.bind(this),q.bind(this))};c.prototype.workRequestQueue=function(){for(;0<this.requestQueue.length;)this.requestQueue.pop()()};c.prototype.requestMultiPlayerInfo=function(b,c,f){if(this.boundLoginOk){this.idPlayerTicket++;
var g=this;this.playerContext[this.idPlayerTicket]={fnCallback:function(f){for(var h=0;h<f.length;h++)f[h].found&&g.addToStorage(f[h],b[h].firstName,b[h].lastName);c(f)}};var h=new CB.WebSockMessage(CB.SockMsgId.PLAYER_BASE_USER);f?h.setUserType(CB.PlayerUserMsgId.QUERY_JS_MULTI_PLAYER_WITH_PIC):h.setUserType(CB.PlayerUserMsgId.QUERY_JS_MULTI_PLAYER_INFO);h.buf.Vh(this.idPlayerTicket);var l=new CB.DataBuffer;l.Vh(b.length);for(var q=0;q<b.length;q++)l.Vn(String.formatEx("{0}#{1}",b[q].lastName,b[q].firstName)),
l.Vh(b[q].elo);h.buf.writeDataBuffer(l);this.send(h)}else!this.isLoggedIn()&&10>++this.connectTries&&!this.conn.isConnected()&&!this.conn.isConnecting()&&this.connect(),this.requestQueue.push(function(){this.requestMultiPlayerInfo(b,c,f)}.bind(this))};c.prototype.requestWithTicket=function(b,c,f,g,h){if(this.boundLoginOk){CB.LOG("PBReq="+c,"","pb");this.idPlayerTicket++;this.playerContext[this.idPlayerTicket]={fnCallback:h,elo:f,year:g,player:{},pic:null};var l=new CB.WebSockMessage(CB.SockMsgId.PLAYER_BASE_USER);
l.setUserType(CB.PlayerUserMsgId.QUERY_JS_PLAYER_BY_NAME_AND_ELO);l.buf.Vh(this.idPlayerTicket);l.buf.Vn(b);l.buf.Vn(c);l.buf.Vh(f);l.buf.Vh(g);this.send(l)}else this.requestQueue.push(function(){this.requestWithTicket(b,c,f,g,h)}.bind(this)),CB.LOG("PlayerLobby no boundLogin")};c.prototype.handleReceived=function(b){if(!this.handleReceivedByConnector(b)){CB.LOG("PBReply="+b.getType()+"/"+b.getUserType(),"","pb");try{switch(b.getType()){default:TRACE("Unhandled: "+b.toString());break;case CB.SockMsgId.DEFAULTGROUPS:this.boundLoginOk=
!0;this.callbackfnConnected&&this.callbackfnConnected();this.workRequestQueue();this.fireOnConnected();break;case CB.SockMsgId.BINDERTIMEOUT:break;case CB.SockMsgId.INVALIDPASSWORD:break;case CB.SockMsgId.ALREADYLOGGEDON:break;case CB.SockMsgId.CHAT:this.handleChat(b);break;case CB.SockMsgId.RECONNECT_OK:this.handleReconnectOk(b);break;case CB.SockMsgId.PLAYER_BASE_USER:this.handleUserMsg(b)}}catch(c){b=CB.SockMsgId.toNumString(b.getType()),CB.LogException(b,c)}}};c.prototype.handleUserMsg=function(b){try{switch(b.getUserType()){default:CB.LOG("UserMsg="+
CB.PlayerUserMsgId.toString(b.getUserType()));break;case CB.PlayerUserMsgId.ANS_JS_PLAYER_BY_NAME_AND_ELO:this.handleFillJSPlayer(b);break;case CB.PlayerUserMsgId.SEND_FEEDBACK_ANS:this.handleFeedback(b);break;case CB.PlayerUserMsgId.ANS_JS_PLAYER_MULTI_PLAYER_INFO:this.handleFillJSPlayerArray(b);break;case CB.PlayerUserMsgId.ANS_JS_MULTI_PLAYER_WITH_PIC:this.handleFillJSPlayerArrayWithPics(b)}}catch(c){b=CB.PlayerUserMsgId.toNumString(b.getUserType()),CB.LogException(b,c)}};c.prototype.handleMultiNationInfo=
function(b){this.handleTicket(b)};c.prototype.handleFillPlayerItemByNameAndThumb=function(b){this.handleTicket(b)};c.prototype.handleMultiPlayerItemBNat=function(b){this.handleTicket(b)};c.prototype.handleGetBatchId=function(b){this.handleTicket(b)};c.prototype.handleCurrentPBVersion=function(b){b.getBuf().Vw()};c.prototype.handleFillPlayerByCSID=function(b){this.handleTicket(b)};c.prototype.handleFillJSPlayer=function(b){b=b.getBuf();var c=b.Vw(),f=new CB.Player;f.m_NewCBPlayer=new CB.NewCBPlayer;
f.m_NewCBPlayer.m_aKey=new CB.PlayerKey;f.m_NewCBPlayer.m_HighData=new CB.HighPlayerData;var g=b.V14();CB.LOG("JSPlayer: found="+g,"LogBlue","pb");if(g)if(f.setFirstName(b.Vq(100)),f.setLastName(b.Vq(100)),b.readInt(),f.setNation(b.readInt()),f.setTitle(b.readShort()),0!=b.readInt()){g=b.Vw();CB.LOG("JSPlayer: found Picture, size="+g,"LogBlue","pb");for(var h=[],l=0;l<g;l++)h.push(b.readUint8());this.playerContext[c].fnCallback({player:f,pic:h})}else this.playerContext[c].fnCallback({player:f})};
c.prototype.handleFillJSPlayerArray=function(b){b=b.getBuf();var c=b.Vw();b.V10();for(var f=[];b.nPos<b.nSize;){var g=new CB.Player;g.m_NewCBPlayer=new CB.NewCBPlayer;g.m_NewCBPlayer.m_aKey=new CB.PlayerKey;g.m_NewCBPlayer.m_HighData=new CB.HighPlayerData;var h=b.V14();g.setLastName(b.Vq(100));g.setFirstName(b.Vq(100));b.Vw();g.setNation(b.Vw());g.setTitle(b.readShort());f.push({found:h,player:g})}this.playerContext[c].fnCallback(f)};c.prototype.handleFillJSPlayerArrayWithPics=function(b){b=b.getBuf();
var c=b.Vw();b.Vw();for(var f=[];b.nPos<b.nSize;){var g=new CB.Player;g.m_NewCBPlayer=new CB.NewCBPlayer;g.m_NewCBPlayer.m_aKey=new CB.PlayerKey;g.m_NewCBPlayer.m_HighData=new CB.HighPlayerData;var h=b.V14();g.setLastName(b.Vq(100));g.setFirstName(b.Vq(100));b.Vw();g.setNation(b.Vw());g.setTitle(b.readShort());var l=null;if(0!=b.V10())for(var q=b.Vw(),l=[],r=0;r<q;r++)l.push(b.readUint8());f.push({found:h,player:g,pic:l})}this.playerContext[c].fnCallback(f)};c.prototype.handleTicket=function(b){b=
b.getBuf();if(1==b.Vw()){b.Vw();b.Vw();var c=new CB.Player;c.V3(b);this.callbackPlayer(c,this.me)}else{b.Vw();if(2==b.Vw())for(var f=b.Vw(),c=[],g=0;g<f;g++)c.push(b.ReadByte());this.callbackPortrait(c,this.me)}};c.prototype.handleFeedback=function(b){alert("thanks")};c.prototype.handleChat=function(b){var c=new CB.ChatData;c.fromSocketsMsg(b);c.isToSession()?(b=this.watchSessions.getTitleOfSession(c.getIdSession()),b.length&&(c.strMsg="("+b+"): "+c.strMsg),V15.panelMgr.chatOut(c.toString(),"LogKibitzChat")):
V15.panelMgr.chatOut(c.toString())};c.prototype.handleReconnectOk=function(b){var c=b.getBuf().readInt();CB.LOG("Reconnect OK, groupId="+c+", N="+b.getVal()+" idRecv="+b.getIdReceiver(),"Bold");this.fireOnConnected()};c.prototype.logIntoChat=function(){};c.prototype.send=function(b){try{0==b.Vj()&&b.Vm(this.getNId()),0==b.getIdReceiver()&&b.setIdReceiver(CB.ConnectId.SERVER),this.conn.sendMessage(b,!0)}catch(c){CB.LOG(c.toString()),this.timerReconnect.isActive()||this.inTorture||(this.timerReconnect.runOnce(Math.min(6E4,
5E3+1E3*this.Va),function(){this.pingServer(!0)}.bind(this)),this.Va++)}};Ve.initForListeners(c);c.prototype.sendRandomMessage=function(){for(var b=0;10>b;b++)switch(Math.floor(15*Math.random())){case 0:this.pingServer();break;case 1:this.changeGroup(13);break;case 2:this.changeGroup(14);break;case 3:this.requestChannels();break;case 4:this.updatePlayerStatus();break;case 5:this.lists.requestGameList(!0);break;case 7:this.lists.onShowPlayers();this.lists.onHideGames();break;case 8:this.lists.onShowGames();
this.lists.onHidePlayers();break;case 9:case 10:case 11:case 12:var c=new CB.WebSockMessage(7E3+Math.floor(100*Math.random()));c.address(this.getNId(),CB.ConnectId.SERVER);c.getType()!=CB.SockMsgId.LOGOFF&&c.getType()!=CB.SockMsgId.LOGON&&this.send(c);break;case 13:case 14:c=new CB.WebSockMessage(CB.SockMsgId.USER),c.setUserType(1E3+Math.floor(100*Math.random())),c.address(this.getNId(),CB.ConnectId.SERVER),this.send(c)}};Ve.initForListeners(c);Ve.addEvent(c,"Connected");return c}();"use strict";
CB.Candidate=function(){var c=function(){};c.prototype.read=function(b){this.strLastName=b.Vq(100);this.strFirstName=b.Vq(100);this.aNation=b.Vw();this.nElo=b.Vw()};return c}();"use strict";
CB.HighPlayerData=function(){var c=function(){};c.prototype.V3=function(b){this.setDeathDate(b.Vs());this.setCurrentTitle(new CB.Title(b.Vu()));this.setNation(b.Vu());this.setBornNation(b.Vu());this.setIsMale(b.V14())};c.prototype.setDeathDate=function(b){this.m_aDeathDate=b};c.prototype.getDeathDate=function(){return this.m_aDeathDate};c.prototype.getCurrentTitle=function(){return this.m_aTitle};c.prototype.setCurrentTitle=function(b){this.m_aTitle=b};c.prototype.getNation=function(){return this.m_aNation};
c.prototype.setNation=function(b){this.m_aNation=b};c.prototype.getBornNation=function(){return this.m_aBornNation};c.prototype.setBornNation=function(b){this.m_aBornNation=b};c.prototype.getIsMale=function(){return this.m_isMale};c.prototype.setIsMale=function(b){this.m_isMale=b};return c}();"use strict";
CB.LowPlayerData=function(){var c=function(){};c.prototype.read=function(b){this.m_Titles=[];this.m_TitleDate=[];this.m_OtherNations=[];this.m_ChangeDate=[];for(var d=0;5>d;d++){var c=new CB.Title(b.Vu());this.m_Titles.push(c);c=b.Vs();this.m_TitleDate.push(c)}this.m_ChangedBornNation=b.Vs();for(d=0;10>d;d++)c=b.Vu(),this.m_OtherNations.push(c),c=b.Vs(),this.m_ChangeDate.push(c)};c.prototype.getPrevTitle=function(b){return m_Titles[b]};c.prototype.setPrevTitle=function(b,d){m_Titles[b]=d};c.prototype.getPrevTitleDate=
function(b){return m_TitleDate[b]};c.prototype.setPrevTitleDate=function(b,d){m_TitleDate[b]=d};c.prototype.getChangedBornNation=function(){return m_ChangedBornNation};c.prototype.setChangedBornNation=function(b){m_ChangedBornNation=b};c.prototype.getNextNation=function(b){return m_OtherNations[b]};c.prototype.setNextNation=function(b,d){m_OtherNations[b]=d};c.prototype.getNextChangedDate=function(b){return m_ChangeDate[b]};c.prototype.setNextChangedDate=function(b,d){m_ChangeDate[b]=d};c.prototype.getMaxTitles=
function(){return 5};c.prototype.getMaxNations=function(){return 10};return c}();"use strict";
CB.NewCBPlayer=function(){var c=function(){this.m_aKey=new CB.PlayerKey};c.prototype.V3=function(b,d){this.m_aKey=new CB.PlayerKey;if(0<(d&CB.Player.prototype.PL.PL_DATA_KEY)&&!this.m_aKey.V3(b))return!1;this.m_HighData=new CB.HighPlayerData;0<(d&CB.Player.prototype.PL.PL_DATA_HIGH)&&this.m_HighData.V3(b);this.m_LowData=new CB.LowPlayerData;0<(d&CB.Player.prototype.PL.PL_DATA_LOW)&&this.m_LowData.read(b);return!0};c.prototype.getLastName=function(){return this.m_aKey.getLastName()};c.prototype.setLastName=
function(b){this.m_aKey.setLastName(b)};c.prototype.getFirstName=function(){return this.m_aKey.getFirstName()};c.prototype.setFirstName=function(b){this.m_aKey.setFirstName(b)};c.prototype.setKey=function(b){this.m_aKey=b};c.prototype.getKey=function(){return this.m_aKey};c.prototype.getRHighPlayerData=function(){return this.m_HighData};c.prototype.getRLowPlayerData=function(){return this.m_LowData};c.prototype.getMaxTitles=function(){return this.GetRLowPlayerData().getMaxTitles()};c.prototype.getMaxNations=
function(){return this.GetRLowPlayerData().getMaxNations()};return c}();"use strict";
CB.Player=function(){var c=function(){};c.prototype.PFN={PFN_RAW:0,PFN_ARR:1,PFN_BMP:2};c.prototype.PL={PL_DATA_KEY:1,PL_DATA_HIGH:2,PL_DATA_LOW:4,PL_DATA_ELO:8,PL_DATA_ONE_ELO:16,PL_DATA_PICS:32,PL_DATA_ONE_PIC:64};c.prototype.PL_DATA_ALL=c.prototype.PL.PL_DATA_KEY+c.prototype.PL.PL_DATA_HIGH+c.prototype.PL.PL_DATA_LOW+c.prototype.PL.PL_DATA_ELO+c.prototype.PL.PL_DATA_PICS;c.prototype.V3=function(b){try{b.beginSizedRead(),this.m_nDataMask=b.V10(),this.m_NewCBPlayer=new CB.NewCBPlayer,this.m_NewCBPlayer.V3(b,
this.m_nDataMask),this.m_EloArray=new CB.EloArray,0<(this.m_nDataMask&this.PL.PL_DATA_ELO)?this.m_EloArray.V3(b):0<(this.m_nDataMask&this.PL.PL_DATA_ONE_ELO)&&this.m_EloArray.readLatestFromDataBuffer(b),this.m_MMNameArray=new CB.MMNameArray,0<(this.m_nDataMask&this.PL.PL_DATA_PICS)?this.m_MMNameArray.V3(b):0<(this.m_nDataMask&this.PL.PL_DATA_ONE_PIC)&&this.m_MMNameArray.V3(b),this.setModifyDate(b.Vs()),b.endSizedRead()}catch(d){return!1}return!0};c.prototype.getRPlayerKey=function(){return this.m_NewCBPlayer.GetKey()};
c.prototype.getCBId=function(){return this.m_NewCBPlayer.GetKey().GetCBId()};c.prototype.setCBId=function(b){this.m_NewCBPlayer.GetKey().SetCBId(b)};c.prototype.getMediaId=function(){return this.m_nMediaId};c.prototype.setMediaId=function(b){this.m_nMediaId=b};c.prototype.getRKey=function(){return this.m_NewCBPlayer.GetKey()};c.prototype.getRNewCBPlayer=function(){return this.m_NewCBPlayer};c.prototype.getREloArray=function(){return this.m_EloArray};c.prototype.getRMMNameArray=function(){return this.m_MMNameArray};
c.prototype.hasFotos=function(){return 0<this.m_MMNameArray.Count()};c.prototype.getFirstName=function(){return this.m_NewCBPlayer.getFirstName()};c.prototype.setFirstName=function(b){this.m_NewCBPlayer.setFirstName(b)};c.prototype.setFirstName2=function(b){this.m_NewCBPlayer.setFirstName(b)};c.prototype.getLastName=function(){return this.m_NewCBPlayer.getLastName()};c.prototype.setLastName=function(b){this.m_NewCBPlayer.setLastName(b)};c.prototype.getBirthDate=function(){return this.getRPlayerKey().GetBirthDate()};
c.prototype.setBirthDate=function(b){this.getRPlayerKey().setBirthDate(b)};c.prototype.getIdenticalCount=function(){return this.getRPlayerKey().getIdenticalCount()};c.prototype.getTitle=function(){return this.m_NewCBPlayer.getRHighPlayerData().getCurrentTitle()};c.prototype.setTitle=function(b){this.m_NewCBPlayer.getRHighPlayerData().setCurrentTitle(b)};c.prototype.getNation=function(){return this.m_NewCBPlayer.getRHighPlayerData().GetNation()};c.prototype.setNation=function(b){this.m_NewCBPlayer.getRHighPlayerData().setNation(b)};
c.prototype.getBornNation=function(){return this.m_NewCBPlayer.getRHighPlayerData().getBornNation()};c.prototype.getDeathDate=function(){return this.m_NewCBPlayer.getRHighPlayerData().GetDeathDate()};c.prototype.setDeathDate=function(b){this.m_NewCBPlayer.getRHighPlayerData().setDeathDate(b)};c.prototype.getIsMal=function(){return this.m_NewCBPlayer.getRHighPlayerData().getIsMale()};c.prototype.setIsMale=function(b){this.m_NewCBPlayer.getRHighPlayerData().setIsMale(b)};c.prototype.setDataMask=function(b){this.m_nDataMask=
b};c.prototype.getDataMask=function(){return this.m_nDataMask};c.prototype.getVersion=function(){return this.m_nVersion};c.prototype.setDateCached=function(b){this.m_dCached=b};c.prototype.getDateCached=function(){return this.m_dCached};c.prototype.setModifyDate=function(b){this.m_aModifyDate=b};c.prototype.getModifyDate=function(){return this.m_aModifyDate};return c}();"use strict";
CB.PlayerKey=function(){var c=function(b,d){this.m_nIdenticalCount=0;this.m_nCBId=-1;this.m_sFirstName=b;this.m_sLastName=d};c.prototype.write=function(b){b.Vn(this.m_sLastName);b.Vn(this.m_sFirstName);b.Vg(this.m_aBirthDate);b.Vi(this.m_nIdenticalCount);b.Vh(this.m_nCBId)};c.prototype.V3=function(b){this.m_sLastName=b.Vq(100);this.m_sFirstName=b.Vq(100);this.m_aBirthDate=b.Vs();this.m_nIdenticalCount=b.Vu();this.m_nCBId=b.Vw();return!0};c.prototype.getStr=function(){var b=m_sLastName;return b+=", "+
m_sFirstName};c.prototype.getCheckSum=function(){for(var b=0,d=0;d<m_sLastName.Length;d++)b+=m_sLastName[d];for(d=0;d<m_sFirstName.Length;d++)b+=m_sFirstName[d];b+=m_aBirthDate.GetYear();return b+=m_nIdenticalCount};c.prototype.getFirstName=function(){return this.m_sFirstName};c.prototype.setFirstName=function(b){this.m_sFirstName=b};c.prototype.getLastName=function(){return this.m_sLastName};c.prototype.setLastName=function(b){this.m_sLastName=b};c.prototype.getBirthDate=function(){return this.m_aBirthDate};
c.prototype.setBirthDate=function(b){this.m_aBirthDate=b};c.prototype.getIdenticalCount=function(){return this.m_nIdenticalCount};c.prototype.setIdenticalCount=function(b){this.m_nIdenticalCount=b};c.prototype.incIdenticalCount=function(){this.m_nIdenticalCount++};c.prototype.getCBId=function(){return this.m_nCBId};c.prototype.setCBId=function(b){this.m_nCBId=b};c.prototype.m_aBirthDate=new CB.Date;return c}();
CB.PlayerUserMsgId={QUERY_MULTI_NATION_INFO:1300,QUERY_FILL_PLAYERITEM_BY_NAME_AND_THUMB:1301,QUERY_FILL_PLAYERITEM_BY_NAME:1302,QUERY_FILL_MULTIPLAYERITEM_BNAT:1303,QUERY_GET_BATCH_ID:1304,QUERY_CURRENT_PB_VERSION:1305,QUERY_FILL_PLAYER_BY_CBID:1306,QUERY_FILL_CANDIDATES_ARRAY:1307,QUERY_FILL_PICTURE:1308,ANS_MULTI_NATION_INFO:1309,ANS_FILL_PLAYERITEM_BY_NAME_AND_THUMB:1310,ANS_FILL_PLAYERITEM_BY_NAME:1311,ANS_FILL_MULTIPLAYERITEM_BNAT:1312,ANS_GET_BATCH_ID:1313,ANS_CURRENT_PB_VERSION:1314,ANS_FILL_PLAYER_BY_CBID:1315,
ANS_FILL_CANDIDATES_ARRAY:1316,ANS_FILL_PICTURE:1317,SEND_FEEDBACK:1320,SEND_FEEDBACK_ANS:1321,QUERY_JS_PLAYER_BY_NAME_AND_ELO:1322,ANS_JS_PLAYER_BY_NAME_AND_ELO:1323,QUERY_JS_MULTI_PLAYER_INFO:1324,ANS_JS_PLAYER_MULTI_PLAYER_INFO:1325,QUERY_JS_MULTI_PLAYER_WITH_PIC:1326,ANS_JS_MULTI_PLAYER_WITH_PIC:1327,toString:function(c){for(var b in this)if(this[b]==c)return b;return"Unknown PBUserMsgId: "+c},toNumString:function(c){return"PlUserMsgId="+c}};"use strict";
CB.EloArray=function(){var c=function(){};c.prototype.V3=function(b){b.beginSizedRead();this.clear();var d=b.Vw();if(4096<d)return!1;if(0<d)for(var c=b.V14(),f=0;f<d;f++){var g=new CB.EloNumber(c);g.V3(b);this.vecElo.push(g)}b.endSizedRead();return!0};c.prototype.readLatestFromDataBuffer=function(b){return this.ReadFromDataBuffer(b)};c.prototype.clear=function(){this.vecElo?this.vecElo.clear():this.vecElo=[]};c.prototype.getTrendStr=function(b){for(var d=this.count()-1,c="",f=0;f<b;f++){var g=d-1;
if(0<=g){for(var h=this.vecElo[d].getDate().month;0<=g&&6>Math.abs(h-this.vecElo[g].getDate().month);)g--;0<=g&&(d=this.vecElo[d].getNElo()-this.vecElo[g].getNElo(),c=10<=Math.abs(d)?0<d?"+"+c:"-"+c:"0"+c);d=g}}return c.length==b?c:""};c.prototype.getNBestElo=function(b){b=this.vecElo[0].getNElo();this.vecElo[0].getDate();for(var d=0;d<this.vecElo.length;d++){var c=this.vecElo[d];c.getNElo()>b&&(b=c.getNElo(),c.getDate())}return b};c.prototype.getNWorstElo=function(b){b=this.vecElo[0].getNElo();this.vecElo[0].getDate();
for(var d=0;d<this.vecElo.length;d++){var c=this.vecElo[d];c.getNElo()<b&&(b=c.getNElo(),c.getDate())}return b};c.prototype.getApproxElo=function(b,d){for(var c=0,f=0,g=0;g<this.vecElo.length;g++){var h=this.vecElo[g];h.getDate().getYear()>=b&&h.getDate().getYear()<=d&&(c+=h.getNElo(),f++)}return 0<f?c/f:0};c.prototype.getBestMatchEloByDate=function(b){b=0;0<this.vecElo.length&&(b=this.vecElo[this.vecElo.length-1].getNElo());return b};c.prototype.count=function(){return this.vecElo.length};c.prototype.get=
function(b){return b<this.vecElo.length?this.vecElo[b]:new EloNumber};return c}();"use strict";CB.EloNumber=function(){var c=function(b){this.bOld=b};c.prototype.V3=function(b){b.beginSizedRead();this.nRatingId=b.Vw();this.nElo=b.Vu();this.aDate=b.Vs();this.bFide=b.V14();this.aRating=new CB.ExtRatingType12;this.aRating.V3(b);this.nRank=b.Vw();b.endSizedRead()};c.prototype.getDate=function(){return this.aDate};c.prototype.getNElo=function(){return this.aRating.getRating()};return c}();"use strict";
CB.ExtRatingType12=function(){var c=function(){};c.prototype.V3=function(b){this.nFlags=b.Vu();this.nRating=b.Vu();this.aNation=b.readUint8();this.sProvider=b.Vu();return!0};c.prototype.getRating=function(){return this.nRating};return c}();"use strict";
CB.MMNameArray=function(){var c=function(){};c.prototype.V3=function(b){var d=b.Vu();this.clear();for(var c=0;c<d;c++){var f=new CB.PLMMRecord;f.V3(b);this.append(f)}};c.prototype.getRecord=function(b){return this.vecMM[b]};c.prototype.append=function(b){this.vecMM.push(b)};c.prototype.count=function(){return this.vecMM.Count};c.prototype.clear=function(){this.vecMM?this.vecMM.clear():this.vecMM=[]};return c}();"use strict";
CB.PLMMRecord=function(){var c=function(){};c.prototype.V3=function(b){this.nSerial=b.Vw();this.aDate=b.Vs();this.nMediaType=b.Vu();this.sName=b.V6(100);this.sAuthor=b.V6(100);this.sLocation=b.V6(100);this.isExact=b.V14()};c.prototype.writeToDataBuffer=function(b){b.Vh(this.nSerial);b.Vg(this.aDate);b.Vi(this.nMediaType);b.V5(this.sName);b.V5(this.sAuthor);b.V5(this.sLocation);b.V13(this.isExact)};return c}();"use strict";
CB.Title=function(){var c=function(b){this.eTitleCode=b};c.prototype.Code={CBTC_NONE:0,CBTC_MARKED:1,CBTC_HGM:2,CBTC_WFM:4,CBTC_WIM:8,CBTC_FM:16,CBTC_IM:32,CBTC_WWCH:64,CBTC_WCH:128};c.prototype.Code.CBTC_WGM=c.prototype.Code.CBTC_WIM|c.prototype.Code.CBTC_WFM;c.prototype.Code.CBTC_GM=c.prototype.Code.CBTC_IM|c.prototype.Code.CBTC_FM;c.getStr=function(b){if((b&c.prototype.Code.CBTC_GM)==c.prototype.Code.CBTC_GM)return"GM";if((b&c.prototype.Code.CBTC_WGM)==c.prototype.Code.CBTC_WGM)return"WGM";if(b&
c.prototype.Code.CBTC_WCH)return"WCH";if(b&c.prototype.Code.CBTC_WWCH)return"WWCH";if(b&c.prototype.Code.CBTC_WIM)return"WIM";if(b&c.prototype.Code.CBTC_WFM)return"WFM";if(b&c.prototype.Code.CBTC_IM)return"IM";if(b&c.prototype.Code.CBTC_FM)return"FM"};c.prototype.getAllTitles=function(){var b="";0<(eTitleCode&c.prototype.Code.CBTC_WCH)&&(b+="WCH, ");0<(eTitleCode&c.prototype.Code.CBTC_WWCH)&&(b+="WWCH, ");(eTitleCode&c.prototype.Code.CBTC_GM)==c.prototype.Code.CBTC_GM?b+="GM, ":0<(eTitleCode&c.prototype.Code.CBTC_IM)?
b+="IM, ":0<(eTitleCode&c.prototype.Code.CBTC_FM)&&(b+="FM, ");(eTitleCode&c.prototype.Code.CBTC_WGM)==c.prototype.Code.CBTC_WGM?b+="WGM, ":0<(eTitleCode&c.prototype.Code.CBTC_WIM)?b+="WIM, ":0<(eTitleCode&c.prototype.Code.CBTC_WFM)&&(b+="WFM, ");0<(eTitleCode&c.prototype.Code.CBTC_HGM)&&(b+="HGM, ");0<(eTitleCode&c.prototype.Code.CBTC_MARKED)&&(b+="VIP, ");return b};return c}();"use strict";
CB.ChessKnowledge=function(){var c=function(){};c.isEndgame=function(b){var d=CB.Attack.sumMaterial(b,CB.Side.WHITE),c=CB.Attack.sumMaterial(b,CB.Side.BLACK);return 12>b.getPieces().length&&2100>d+c};c.getOpposition=function(b,d){var c=CB.Square.getFile(b),f=CB.Square.getFile(d),g=CB.Square.getRank(b),h=CB.Square.getRank(d);if(c==f&&2==Math.abs(g-h)){var l=[];g>h?(0<=c-1&&8>h+1&&l.push(8*(c-1)+h+1),8>h+1&&l.push(8*(c+0)+h+1),8>c+1&&8>h+1&&l.push(8*(c+1)+h+1)):(0<=c-1&&8>g+1&&l.push(8*(c-1)+g+1),8>
g+1&&l.push(8*(c+0)+g+1),8>c+1&&8>g+1&&l.push(8*(c+1)+g+1));return l}if(g==h&&2==Math.abs(c-f))return l=[],c>f?(8>f+1&&0<=h-1&&l.push(8*(f+1)+h-1),8>f+1&&l.push(8*(f+1)+h+0),8>f+1&&8>h+1&&l.push(8*(f+1)+h+1)):(8>c+1&&0<=h-1&&l.push(8*(c+1)+h-1),8>c+1&&l.push(8*(c+1)+h+0),8>c+1&&8>h+1&&l.push(8*(c+1)+h+1)),l};return c}();"use strict";
CB.CPUInfo=function(){var c=function(){this.m_nLogicalCores=this.m_nPhysicalCores=this.m_nPhysicalProcs=this.m_nNumaNode=0};c.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();b.Vh(this.m_nNumaNodes);b.Vh(this.m_nPhysicalProcs);b.Vh(this.m_nPhysicalCores);b.Vh(this.m_nLogicalCores);b.endSizedWrite();return!0};return c}();
CB.PosTree=function(){var c=function(){};c.prototype.numBits=[1,6,6,5,5,5,3,1,1,6,6,5,5,5,3,1];c.prototype.theBits=[0,32,34,18,20,22,6,0,0,33,35,19,21,23,7,0];c.prototype.isUniqe=[0,255,255,255,255,255,6,14,255,255,255,255,255,255,255,255,255,255,3,11,4,12,5,13,255,255,255,255,255,255,255,255,1,9,2,10,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];c.prototype.HUFF_960=128;c.prototype.HUFF_CASTLE=64;c.prototype.HUFF_EP=32;c.prototype.posToHuff3=
function(b,d,c){var f,g,h,l=0;d[l]=0;l++;d[l]=0;b.getBTM()&&(d[l]=128);f=0;g=1;for(h=2;64>f;f++){var q=b.board[f]&15;g+=this.numBits[q];if(8<g){d[l]|=this.theBits[q]>>g-8;if(++h>c)return 1;l++;d[l]=0;g-=8}d[l]|=this.theBits[q]<<8-g;if(8<=g){g=0;if(++h>c)return 1;l++;d[l]=0}}q=f=0;0<b.getCastleRights()&&(q|=this.HUFF_CASTLE,f+=4);0<b.getCPPEPFile()&&(q|=this.HUFF_EP,f+=3);if(0<f){if(8<g+f){if(++h>c)return 1;l++;d[l]=0}0<b.getCastleRights()?(d[l]|=b.getCastleRights()&15,0<b.getCPPEPFile()&&(d[l]|=(b.getCPPEPFile()-
1&7)<<4)):0<b.getCPPEPFile()&&(d[l]|=b.getCPPEPFile()-1&7)}else 0==g&&--h;d[0]=h|q;for(b=0;b<=l;b++)d[b]&=255;return 0};c.prototype.huff3ToPos=function(b,d,c){var f,g,h=0,l;b.ep=CB.Position.NOEP;for(f=0;64>f;f++)b.board[f]=0;f=d[h]&(this.HUFF_960|this.HUFF_CASTLE|this.HUFF_EP);g=d[h]&31;if(8<g&&g<c){0<(f&this.HUFF_CASTLE)?(b.setCastleRights(d[g-1]&15),b.ep=0<(f&this.HUFF_EP)?d[g-1]>>4&7:CB.Position.NOEP):(b.setCastleRights(CB.CastleRights.NONE),b.ep=0<(f&this.HUFF_EP)?d[g-1]&7:CB.Position.NOEP);h++;
0<(d[h]&128)?b.setBTM(!0):b.setBTM(!1);f=0;c=1;for(l=64;64>f&&c<g;f++){var q=0,r=0;do q<<=1,0<(d[h]&l)&&(q|=1),r++,l>>=1,0==l&&(l=128,h++,c++);while(255==this.isUniqe[q]&&6>r);if(255==this.isUniqe[q])break;b.board[f]=this.isUniqe[q]}if(64>f)return b.initStartPos(),1}else return b.initStartPos(),1;return 0};return c}();"use strict";
CB.HashPosition=function(){var c=function(b){this.m_cPos=[];for(var d=0;24>d;d++)this.m_cPos.push(0);b&&(new CB.PosTree).posToHuff3(b,this.m_cPos,this.m_cPos.length)};c.prototype.Len=function(){return this.m_cPos[0]&31};c.prototype.IsSet=function(){return 0!=this.m_cPos[0]};c.prototype.Clear=function(){for(var b=0;b<m_cPos.Length;b++)this.m_cPos[b]=0};c.prototype.GetBTM=function(){return 0!=(this.m_cPos[1]&128)};c.prototype.HashPosition=function(b,d){};c.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();
b.writeByteArray(this.m_cPos,this.m_cPos.length);b.endSizedWrite();return!0};c.prototype.V3=function(b){b.beginSizedRead();for(var d=0;d<this.m_cPos.length;d++)this.m_cPos[d]=b.readByte();b.endSizedRead();return!1};c.prototype.getPosition=function(){var b=new CB.PosTree,d=new CB.Position;b.huff3ToPos(d,this.m_cPos,this.m_cPos.length);return d};c.prototype.FillPos=function(b){};c.prototype.SetPos=function(b){};c.prototype.Normalize=function(b){};c.prototype.UnNormalize=function(b){};c.prototype.IsStartPosition=
function(){return!1};c.prototype.IsFinalPosition=function(){return!1};c.prototype.GetStartPos=function(){return m_sStartPosition};return c}();"use strict";
CB.HashTableData=function(){var c=function(){this.m_nIdDiscoverer=0;this.pos=new CB.HashPosition;this.move=[]};c.emptyFactory=function(){for(var b=new CB.HashTableData,d=0;d<CB.TBRAIN.HASH_LINE_CNT;d++)b.move.push(new CB.HashMoveData);return b};c.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();pos.writeToDataBuffer(b);b.writeUShort(CB.TBRAIN.HASH_LINE_CNT);for(var d=0;d<CB.TBRAIN.HASH_LINE_CNT;++d)m_aMove[d].writeToDataBuffer(b);b.Vt(m_nPopularity);b.writeUnsigned(m_nIdDiscoverer);b.writeInt(m_nFlags);
b.writeUnsigned(TBrainConstants.CALCTIME_REASONABLE_THRESH);b.writeUnsigned(TBrainConstants.CALCTIME_DISCOVERY);b.writeUnsigned(TBrainConstants.CALCTIME_DONATION);b.writeUnsigned(TBrainConstants.CALCTIME_DEEP);b.writeUnsigned(m_nGames);b.wndSizedWrite();return!0};c.prototype.V3=function(b){b.beginSizedRead();this.pos.V3(b);for(var d=b.Vu(),c=0;c<CB.TBrainMove.prototype.HASH_LINE_CNT&&c<d;++c)null==this.move[c]&&(this.move[c]=new CB.HashMoveData),this.move[c].V3(b);this.m_nPopularity=b.readUint64();
this.m_nIdDiscoverer=b.Vw();this.m_nFlags=b.Vw();this.m_nReasonableThresh=b.Vw();this.m_nDiscoveryThresh=b.Vw();this.m_nDonationThresh=b.Vw();this.m_nDeepAnalysisThresh=b.Vw();0==this.m_nDeepAnalysisThresh&&(this.m_nDeepAnalysisThresh=TBrainMove.prototype.CALCTIME_DEEP);this.m_nGames=b.Vu();b.endSizedRead();return!0};c.prototype.clear=function(){for(var b=0;b<TBRAIN.HASH_LINE_CNT;++b)m_aMove[b].clear();pos.Clear();m_nGames=m_nPopularity=m_nFlags=m_nIdDiscoverer=0};c.generateLine=function(b,d,c,f){f=
f||3;var g="",h=[];if(d&&d.m_aLine){h=this.convertToCBMoveLine(ObjUtil.clone(b),d.m_aLine);b=new CB.NotationGenerator(CB.V1);d=c.game.getStartPos().getBTM();for(var l=0;l<h.length&&l<f;l++)if(h[l].from!=h[l].to){var q=b.getMoveNota(h[l]),r=b.getStrMoveNumInLine(l,c.getCurPos().getPlyNum(),d),g=g+(r+q);l<h.length-1&&(g+=" ")}}return{line:h,lineNota:g}};c.convertToCBMoveLine=function(b,d){for(var c=[],f=0;f<d.length;f++){var g=new CB.Move(d[f]&63,d[f]>>6&63,d[f]>>12&7);b.isLegalMove(g)&&(b.preCalcCtx(g),
b.makeMove(g),b.postCalcCtx(g,!0),c.push(g))}return c};c.prototype.Dump=function(){};c.prototype.Count=function(){return TBRAIN.HASH_LINE_CNT};c.prototype.Empty=function(){return m_aMove[0].Empty()};c.prototype.FillPos=function(b){pos.FillPos(b)};c.prototype.GetHashPosition=function(){return pos};c.prototype.GetMove=function(b){CBDebug.assert(b<TBRAIN.HASH_LINE_CNT);return b<TBRAIN.HASH_LINE_CNT?m_aMove[b]:m_aMove[0]};c.prototype.SetMove=function(b,d){CBDebug.assert(d<TBRAIN.HASH_LINE_CNT);d<TBRAIN.HASH_LINE_CNT&&
(m_aMove[d]=b)};c.prototype.GetNPopularity=function(){return m_nPopularity};c.prototype.SetNPopularity=function(b){m_nPopularity=b};c.prototype.GetNGames=function(){return m_nGames};c.prototype.GetNIdDiscoverer=function(){return m_nIdDiscoverer};c.prototype.SetNIdDiscoverer=function(b){m_nIdDiscoverer=b};c.prototype.IsDiscovered=function(){return ISFLAG(1)};c.prototype.SetIsDiscovered=function(b){SETFLAG(1,b)};c.prototype.GetNReasonableThresh=function(){return m_nReasonableThresh};c.prototype.GetNDiscoveryThresh=
function(){return m_nDiscoveryThresh};c.prototype.GetNDonationThresh=function(){return m_nDonationThresh};c.prototype.GetNDeepAnalysisThresh=function(){return m_nDeepAnalysisThresh};return c}();"use strict";
CB.MachineInfo=function(){var c=function(){this.m_aCPUInfo=new CB.CPUInfo;this.m_nFlags=this.m_nSpeed=0};c.prototype.read=function(b){};c.prototype.GetCPUInfo=function(){return this.m_aCPUInfo};c.prototype.IsValid=function(){return 0<this.m_nSpeed};c.prototype.GetNSpeed=function(){return m_nSpeed};c.prototype.SetNSpeed=function(b){m_nSpeed=b};c.prototype.HasHyperThreading=function(){return ISFLAG(1)};c.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();this.m_aCPUInfo.writeToDataBuffer(b);
b.Vh(this.m_nSpeed);b.Vh(this.m_nFlags);b.endSizedWrite();return!0};c.prototype.ReadFromDataBuffer=function(b){return!0};c.prototype.CreateMachineGuid=function(){var b=new CBGuid;b.CreateFromHardware();return b};return c}();"use strict";
CB.ClientMachineInfo=function(){var c=function(){};CB.inherit(c,CB.MachineInfo);c.prototype.read=function(b){this.strLastName=b.Vq(100);this.strFirstName=b.Vq(100);this.aNation=b.Vw();this.nElo=b.Vw()};c.prototype.Init=function(){m_nSpeed=s_nSpeed;s_bInited=!0};c.prototype.GetNSpeed=function(){s_bInited&&0!=s_nSpeed||(Init(),0==s_nSpeed&&(s_nSpeed=1E5));return s_nSpeed};return c}();"use strict";
CB.GamePerformanceStats=function(){var c=function(){};c.prototype.initEmpty=function(){this.strFirstName=this.strLastName="";this.m_nResultSum=this.m_nResultCount=this.m_nEloSum=this.m_nEloCount=this.nElo=this.aNation=0};c.prototype.read=function(b){this.strLastName=b.Vq(100);this.strFirstName=b.Vq(100);this.aNation=b.Vw();this.nElo=b.Vw()};c.prototype.plus=function(b,d){var e=new c(b);e.m_nEloCount+=d.m_nEloCount;var f=e.m_nEloSum+d.m_nEloSum;f>uint.MaxValue-1E4?(e.m_nEloSum=uint(f/2),e.m_nEloCount/=
2):e.m_nEloSum=f;var f=e.m_nResultSum+d.m_nResultSum,g=e.m_nResultCount+d.m_nResultCount;f>uint.MaxValue-1E4||g>uint.MaxValue-1E4?(e.m_nResultSum=f/2,e.m_nResultCount=g/2):(e.m_nResultSum=f,e.m_nResultCount=g);return e};c.prototype.writeToDataBuffer=function(b){b.WriteUnsigned(m_nEloSum);b.WriteUnsigned(m_nEloCount);b.WriteUnsigned(m_nResultSum);b.WriteUnsigned(m_nResultCount)};c.prototype.V3=function(b){this.m_nEloSum=b.Vw();this.m_nEloCount=b.Vw();this.m_nResultSum=b.Vw();this.m_nResultCount=b.Vw();
return!0};c.prototype.getSortResult=function(){return 0!=m_nResultCount?500*m_nResultSum/m_nResultCount:0};c.prototype.getSortEloAv=function(){return 0!=this.m_nEloCount?this.m_nEloSum/this.m_nEloCount:0};c.prototype.getFPercent=function(b){return 0!=this.m_nResultCount?b?100-50*this.m_nResultSum/this.m_nResultCount:50*this.m_nResultSum/this.m_nResultCount:0};c.prototype.getNGames=function(){return Math.max(this.m_nEloCount,this.m_nResultCount)};return c}();"use strict";
CB.HashMoveData=function(){var c=function(){this.m_aLine=[0]};c.prototype.read=function(b){};c.prototype.WriteToDataBuffer=function(b){return!0};c.prototype.V3=function(b){b.beginSizedRead();this.m_nConfidence=b.Vw();this.m_nEval=b.V11();this.m_nDepth=b.readByte();this.m_nFlags=b.readByte();for(var d=b.Vu(),c=0;c<CB.TBrainMove.prototype.HASH_LINE_LEN&&c<d;++c)this.m_aLine[c]=b.Vu();this.m_nEngineId=b.Vw();this.m_nUserId=b.Vw();this.m_nTimeStamp=b.Vu();this.m_nCalcDepth=b.Vu();this.m_bReasonableDepth=
b.V14();this.m_nRankingListWeight=b.Vw();b.endSizedRead();return!0};c.prototype.Empty=function(){return!0};c.prototype.MovesEqualTo=function(b){return!1};c.prototype.ToString=function(){for(var b=0;b<HASH_LINE_LEN;++b);return"??"};c.prototype.SetTimeStamp=function(b){m_nTimeStamp=TBrainTimeStamp.DateToUShort(b)};c.prototype.GetTimeStamp=function(){return TBrainTimeStamp.UShortToDate(m_nTimeStamp)};c.prototype.Test=function(b,d){return!1};c.prototype.fillVariation=function(b,d){return!1};c.prototype.FillEvaluation=
function(b,d){return!0};c.prototype.SetMove=function(b,d){return!1};c.prototype.FillMove=function(b,d){return!1};c.prototype.IsMate=function(){return 29E3<Math.Abs(m_nEval)};c.prototype.GetNCalcDepthPercent=function(b){return 0!=GetNCalcDepth()?100*b/GetNCalcDepth()+.5:0};c.prototype.Count=function(){return TBRAIN.HASH_LINE_LEN};c.prototype.Clear=function(){};c.prototype.GetNEval=function(){return 0};c.prototype.setNEval=function(b){m_nEval=b;SETFLAG(TBRAIN.EVAL_MOVE_NO,!1)};c.prototype.GetNMoveNo=
function(){return 0};c.prototype.SetNMoveNo=function(b){m_nEval=b;SETFLAG(TBRAIN.EVAL_MOVE_NO,!0)};c.prototype.GetNDepth=function(){return m_nDepth};c.prototype.SetNDepth=function(b){m_nDepth=b};c.prototype.GetNConfidence=function(){return m_nConfidence};c.prototype.SetNConfidence=function(b){m_nConfidence=b};c.prototype.GetMove=function(b){return 0};c.prototype.SetMove=function(b,d){};c.prototype.IsEval=function(){return!ISFLAG(TBRAIN.EVAL_MOVE_NO)};c.prototype.IsMoveNo=function(){return ISFLAG(TBRAIN.EVAL_MOVE_NO)};
c.prototype.etNEngineId=function(){return m_nEngineId};c.prototype.SetNEngineId=function(b){m_nEngineId=b};c.prototype.GetNUserId=function(){return m_nUserId};c.prototype.SetNUserId=function(b){m_nUserId=b};c.prototype.UserIsLogin=function(){return ISFLAG(TBRAIN.USER_IS_LOGIN)};c.prototype.SetUserIsLogin=function(b){SETFLAG(TBRAIN.USER_IS_LOGIN,b)};c.prototype.SetNTimeStamp=function(b){m_nTimeStamp=b};c.prototype.GetNCalcDepth=function(){return m_nCalcDepth};c.prototype.IsReasonableDepth=function(){return m_bReasonableDepth};
c.prototype.SetIsReasonableDepth=function(b){m_bReasonableDepth=b};c.prototype.IsDisco=function(){return m_nCalcDepth>=TBrainConstants.CALCTIME_DISCOVERY};c.prototype.IsDeep=function(){return m_nCalcDepth>=TBrainConstants.CALCTIME_DEEP};c.prototype.GetRankingListWeight=function(){return m_nRankingListWeight};c.prototype.SetRankingListWeight=function(b){m_nRankingListWeight=b};return c}();"use strict";
CB.HashTableRequest=function(){var c=function(){this.m_aMachineGuid=new CBGuid;this.m_nCpus=this.m_nSecs=this.m_nFlags=0;this.m_nVariations=1;this.m_nNodes=this.m_nMoveNo=this.m_nHashSize=0;this.m_fMachineFact=this.m_fEngineFact=1};c.prototype.GetFormFactor=function(){return 0};c.prototype.GetFCalcDepth=function(b){return 0};c.prototype.GetNCalcTime=function(){return TBServerBinder(GetFCalcDepth(uint(m_nSecs+1))*m_fEngineFact*m_fMachineFact)};c.prototype.GetNTodaysTimeStamp=function(){return TBrainTimeStamp.GetNTodaysTimeStamp()};
c.prototype.WriteToDataBuffer=function(b){b.BeginSizedWrite();m_aMachine.WriteToDataBuffer(b);b.WriteString(m_strEngine);b.WriteUnsigned(m_nFlags);pos.WriteToDataBuffer(b);m_aMove.WriteToDataBuffer(b);b.WriteUnsigned(m_nSecs);b.WriteUnsigned(m_nCpus);b.WriteUnsigned(m_nVariations);m_aMachineGuid.WriteToDataBuffer(b);b.WriteUnsigned(m_nHashSize);b.WriteData(m_cCheckSum,m_cCheckSum.Length);b.WriteInt(m_nMoveNo);b.WriteInt64(m_nNodes);b.EndSizedWrite();return!0};c.prototype.V3=function(b){b.BeginSizedRead();
m_aMachine.ReadFromDataBuffer(b);m_strEngine=b.ReadString();m_nFlags=b.ReadUnsigned();pos.ReadFromDataBuffer(b);m_aMove.ReadFromDataBuffer(b);m_nSecs=b.ReadUnsigned();m_nCpus=b.ReadUnsigned();16<m_nCpus&&(m_nCpus=16);m_nVariations=Math.Min(64,Math.Max(1,b.ReadUnsigned()));1>m_nVariations&&(m_nVariations=1);m_aMachineGuid.ReadFromDataBuffer(b);m_nHashSize=b.ReadUnsigned();m_nMoveNo=b.ReadInt();m_nNodes=b.ReadInt64();b.EndSizedRead();return!0};c.prototype.CreateGame=function(){return new CBGame};c.prototype.GetMachine=
function(){return m_aMachine};c.prototype.SetMachine=function(b){m_aMachine=b};c.prototype.GetStrEngine=function(){return m_strEngine};c.prototype.SetStrEngine=function(b){m_strEngine=b};c.prototype.GetMachineGuid=function(){return m_aMachineGuid};c.prototype.SetMachineGuid=function(b){m_aMachineGuid=b};c.prototype.SetNSecs=function(b){m_nSecs=b};c.prototype.GetNSecs=function(){return m_nSecs};c.prototype.GetPosition=function(){return pos};c.prototype.GetTaggedHashPos=function(){return new TaggedHashPos(pos,
GetNMoveNo())};c.prototype.FillPosition=function(b){pos.FillPos(b);b.SetMoveNo(GetNMoveNo())};c.prototype.SetPosition=function(b){pos=new HashPosition(b);m_nMoveNo=b.GetMoveNo()};c.prototype.GetMove=function(b){return TBServerBinderm_aMove.GetMove(b)};c.prototype.GetNEval=function(){return m_aMove.GetNEval()};c.prototype.GetNMoveNo=function(){return m_nMoveNo};c.prototype.SetNMoveNo=function(b){m_nMoveNo=b};c.prototype.GetNDepth=function(){return m_aMove.GetNDepth()};c.prototype.IsEval=function(){return m_aMove.IsEval()};
c.prototype.IsMoveNo=function(){return m_aMove.IsMoveNo()};c.prototype.GetNCpus=function(){return m_nCpus};c.prototype.SetNCpus=function(b){m_nCpus=TBServerBinderr};c.prototype.GetNVariation=function(){return m_nVariations};c.prototype.SetNVariations=function(b){m_nVariations=TBServerBinderr};c.prototype.SetEngineFact=function(b){m_fEngineFact=b};c.prototype.SetMachineFact=function(b){m_fMachineFact=b};c.prototype.SetSilent=function(b){SETFLAG(1,b)};c.prototype.IsSilent=function(){return ISFLAG(1)};
c.prototype.SetFirstRequest=function(b){SETFLAG(2,b)};c.prototype.IsFirstRequest=function(){return ISFLAG(2)};c.prototype.SetUCI=function(b){SETFLAG(65536,b)};c.prototype.IsUCI=function(){return ISFLAG(TBServerBinderHTR.HTR_UCI_ENGINE)};c.prototype.SetUnreliableData=function(b){SETFLAG(256,b)};c.prototype.IsUnreliableData=function(){return ISFLAG(TBServerBinderHTR.HTR_UNRELIABLE_DATA)};c.prototype.IsEvalNormed=function(){return ISFLAG(TBServerBinderHTR.HTR_EVAL_NORMED)};c.prototype.SetIsEvalNormed=
function(b){SETFLAG(TBServerBinderHTR.HTR_EVAL_NORMED,b)};c.prototype.GetCheckSum=function(b){};return c}();"use strict";CB.RequestBoard=function(){return function(c,b){this.aBoard=c;this.sMove=b}}();"use strict";
CB.TaggedHashPos=function(){var c=function(b,d,c){this.pos=new CB.HashPosition(b);this.m_nMoveNo=d;this.m_nTicket=this.m_nConnectIdSolver=this.m_nConnectIdSubmissor=0;this.m_strTag=c};c.prototype.IsSet=function(){return pos.IsSet()};c.prototype.IsStartPosition=function(){return pos.IsStartPosition()};c.prototype.IsFinalPosition=function(){return pos.IsFinalPosition()};c.prototype.GetStrTag=function(){return m_strTag};c.prototype.SetStrTag=function(b){m_strTag=b};c.prototype.WriteToDataBuffer=function(b){pos.WriteToDataBuffer(b);
b.BeginSizedWrite();b.WriteInt(m_nMoveNo);b.WriteString(m_strTag);b.EndSizedWrite()};c.prototype.ReadFromDataBuffer=function(b){if(!pos.ReadFromDataBuffer(b))return!1;b.BeginSizedRead();m_nMoveNo=b.ReadInt();m_strTag=b.ReadString();var d=0<=m_nMoveNo;b.EndSizedRead();return d};c.prototype.CreatePosition=function(){var b=pos.CreatePosition();b.SetMoveNo(m_nMoveNo);return b};return c}();"use strict";
CB.TBRAIN={HASH_LINE_LEN:3,HASH_LINE_CNT:3,MAX_STR:63,EVAL_MOVE_NO:1,USER_IS_LOGIN:2,USER_MAY_DISCOVER:4,USER_TRUSTWORTHY:8,EVAL_NORMED:16};
CB.TBrainMove=function(){var c=function(){this.move=new CB.Move;this.m_performanceStats=new CB.GamePerformanceStats;this.m_nFlags=0};c.prototype.HASH_LINE_LEN=3;c.prototype.HASH_LINE_CNT=3;c.prototype.CALCTIME_DEEP=370;c.prototype.getMoveRecord=function(){return this.move};c.prototype.getLine=function(b){CBDebug.assert(b<CB.TBRAIN.HASH_LINE_LEN);return b<CB.TBRAIN.HASH_LINE_LEN?m_aLine[b]:0};c.prototype.getLine=function(b,d){CBDebug.assert(d<CB.TBRAIN.HASH_LINE_LEN);m_aLine[d]=b};c.prototype.getNEval=
function(){return this.m_nEval};c.prototype.getNTimeStamp=function(){return this.m_nTimeStamp};c.prototype.setNTimeStamp=function(b){m_nTimeStamp=b};c.prototype.hasEval=function(){return CB.isFlag(this.m_nFlags,1)||0!=this.m_nEval};c.prototype.setHasEval=function(b){this.m_nFlags=b?this.m_nFlags|1:this.m_nFlags&-2};c.prototype.hasComment=function(){};c.prototype.setHasComment=function(b){};c.prototype.getPerformanceStats=function(){return m_performanceStats};c.prototype.getNGames=function(){return this.m_performanceStats.getNGames()};
c.prototype.getEloAv=function(){return this.m_performanceStats.getSortEloAv()};c.prototype.initNaked=function(b){this.move=b;this.m_nFlags=this.m_nTimeStamp=this.m_nEval=0;this.m_aLine=[];this.m_performanceStats.initEmpty()};c.prototype.writeToDataBuffer=function(b){b.BeginSizedWrite();b.WriteInt64(m_nVisits);b.WriteBYTE(this.move.frSq);b.WriteBYTE(this.move.toSq);b.WriteBYTE(this.move.nType);b.WriteBYTE(this.move.nProm);b.WriteShort(this.m_nEval);b.WriteUShort(this.m_nTimeStamp);b.WriteShort(this.m_nFlags);
this.m_performanceStats.WriteToDataBuffer(b);b.EndSizedWrite()};c.prototype.V3=function(b){b.beginSizedRead();this.m_nVisits=b.Vy();this.move.from=b.readUint8();this.move.to=b.readUint8();this.move.nType=b.readUint8();this.move.prom=b.readUint8();this.m_nEval=b.V11();this.m_nTimeStamp=b.Vu();this.m_nFlags=b.V11();this.m_performanceStats.V3(b);this.m_aLine=[];for(var d=0;d<CB.TBrainMove.prototype.HASH_LINE_LEN;++d){var c=b.Vu();this.m_aLine.push(c)}b.endSizedRead();return!0};c.prototype.getTimeStamp=
function(){return TBrainTimeStamp.UShortToDate(m_nTimeStamp)};c.prototype.getNVisits=function(){return this.m_nVisits};c.getTimeStampToday=function(){var b=new CB.Date;b.setToday();b.setYear(b.getYear()-1945);return b.getNum()};c.prototype.toString=function(){return this.move.toString()+", N="+this.getNGames()+",ev="+this.m_nEval};return c}();"use strict";
CB.TBrainMoveList=function(){var c=function(){this.moves=[]};c.prototype.writeToDataBuffer=function(b){b.BeginSizedWrite();b.WriteInt(GetNFormat());b.WriteUnsigned(Count);for(var d=0;d<Count;d++)this[d].WriteToDataBuffer(b);b.EndSizedWrite()};c.prototype.V3=function(b){b.beginSizedRead();b.readInt();this.clear();for(var d=b.readInt(),c=0;c<d;c++){var f=new CB.TBrainMove;f.V3(b);this.add(f)}b.endSizedRead();return!0};c.prototype.clear=function(){this.moves=[]};c.prototype.count=function(){return this.moves.length};
c.prototype.add=function(b){this.moves.push(b)};c.prototype.get=function(b){return this.moves[b]};c.prototype.getNFormat=function(){return 2};c.prototype.getMaxGames=function(){for(var b=0,d=0;d<this.moves.length;d++)this.moves[d].getNGames()>b&&(b=this.moves[d].getNGames());return b};c.sortEval=function(b,d){b.sort(function(b,c){return d?b.m_nEval-c.m_nEval:c.m_nEval-b.m_nEval})};c.prototype.getHintedBestMove=function(b){if(0==this.moves.length)return b;for(var d=this.moves[0].m_nEval,c=0;c<this.moves.length;c++)if(50>
Math.abs(this.moves[c].m_nEval-d)){if(this.moves[c].move.equals(b))return b}else break;CB.LOG("EngineHintMove not Best: "+b,"LogError");return this.moves[0].move};return c}();"use strict";
CB.TeraBrainChessUser=function(){var c=function(){};c.prototype.GetStrName=function(){return m_strName};c.prototype.GetRank=function(){return m_aRank};c.prototype.SetRank=function(b){m_aRank=b};c.prototype.GetNAccountAgeDays=function(){return m_nAccountAgeDays};c.prototype.SetNAccountAgeDays=function(b){m_nAccountAgeDays=b};c.prototype.HasSerial=function(){return ISFLAG(1)};c.prototype.HasPremium=function(){return ISFLAG(2)};c.prototype.IsSilenced=function(){return ISFLAG(4)};c.prototype.GetGeoCoordinates=
function(){return m_aGeoCoords};c.prototype.GetNLocalFlags=function(){return m_nFlags};c.prototype.GetNUFDFlags=function(){return m_nUFDFlags};return c}();"use strict";
CB.TeraBrainInfo=function(){var c=function(){this.pos=new CB.HashPosition;this.moveList=new CB.TBrainMoveList};c.prototype.read=function(){};c.prototype.fromMessage=function(b){b=b.GetPDataBuf();b.Rewind();ReadFromDataBuffer(b)};c.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();pos.writeToDataBuffer(b);b.Vt(m_nVisits);moveList.writeToDataBuffer(b);b.wndSizedWrite()};c.prototype.V3=function(b){b.beginSizedRead();this.pos.V3(b);this.m_nVisits=b.Vy();this.moveList.V3(b);b.endSizedRead();
return!0};c.prototype.toString=function(){return""};c.prototype.getSocketsMessage=function(){var b=new TeraBrainMessage(SocketsMessageType.TERABRAIN_BOOKINFO);WriteToDataBuffer(b.GetPDataBuf());return b};c.prototype.getNVisits=function(){return m_nVisits};c.prototype.getMoveList=function(){return this.moveList};c.prototype.setMoveList=function(b){moveList=b};c.prototype.getHashPosition=function(){return pos};return c}();"use strict";CB.namespace("CB.Server.TeraBrainLobby");
CB.Server.TeraBrainLobby=function(){var c=function(){this.m_nUsageCnt=this.idGroup=0;this.m_bLoggedIn=!1;this.m_nUserReliability=0;this.m_bLaunchRankingDia=this.m_bAdmin=!1;this.m_nAnalysisTicket=0;this.m_bIsInAnalysis=this.m_bLaunchAnalysisByEngineNames=this.m_bSuppressRequests=!1;this.m_nAnalysisMoveLimit=1;this.m_bInEngineDonation=!1;this.m_nEngineId=this.m_nDonationPositions=0;this.associativeArray=[];this.tableDataHandlers={};this.timerClear=new CB.Timer(function(){this.setEmptyTable()}.bind(this),
2E3);this.name="TBrain";this.tracker=new CB.PositionTracker};CB.inherit(c,CB.Server.Connector);c.prototype.execCommand=function(b){if(!this.hasIdReceived)return!1;switch(b){case CB.LobbyIds.PING_SERVER:this.pingServer(!0)}};c.prototype.notifyUserActivity=function(){};c.prototype.modifyLoginData=function(b){b.documentUrl=document.URL;V15.isAnyPlugin||(b.documentUrl+=" (off)")};c.prototype.onIdReceived=function(b){this.fnOnIdReceived&&this.fnOnIdReceived()};c.prototype.request=function(b,d,c,f,g,h,
l){this.m_bSuppressRequests||(this.s_aMachineInfo=new CB.ClientMachineInfo,d=new CB.TeraBrainRequest(d,c,this.s_aMachineInfo),d.setIsNormedEval(!0),d.setCountVisit(!f),d.setConfirmRequested(g),d.setIsHumanServerGame(h),d.setIsMultiRequest(l),f=d.getSocketsMessage(),f.setVal(b),this.send(f))};c.prototype.requestPosInfo=function(b){this.hasIdReceived&&(this.request(1,b,3,!0,!1,!0),this.timerClear.runOnce(2E3))};c.prototype.requestWithTicket=function(b,d,c){this.hasIdReceived&&(this.tableDataHandlers[b]=
c,this.request(b,d,3,!0,!1,!0))};c.prototype.requestAllMoves=function(b,d,c,f,g){if(this.hasIdReceived){var h=this.tracker.track(b);this.request(f||1,b,2,h,c,d,g)}};c.requestHotPosition=function(){var b=new CB.TeraBrainMessage(SocketsMessageType.TERABRAIN_USER);b.setUserType(TeraBrainUserMsgType.TBUSER_REQ_HOTPOSITION);this.send(b)};c.prototype.requestEngineNames=function(b){var d=new CB.WebSockMessage(CB.SockMsgId.TERABRAIN_USER);d.setUserType(CB.TeraBrainUserMsgType.TBUSER_REQ_ENGINENAMES);d.buf.Vh(b.length);
for(var c=0;c<b.length;c++)d.buf.Vh(b[c]);this.send(d)};c.prototype.handleReceived=function(b){if(!this.handleReceivedByConnector(b))switch(b.getType()){default:TRACE("Unhandled: "+b.toString());break;case CB.SockMsgId.DEFAULTGROUPS:this.onConnectedToBoundServer();break;case CB.SockMsgId.CHAT:break;case CB.SockMsgId.TERABRAIN_BOOKINFO:this.handleInfoMsg(b);break;case CB.SockMsgId.TERABRAIN_TABLEDATA:this.handleTableData(b);break;case CB.SockMsgId.TERABRAIN_USER:this.handleUserMsg(b)}};c.prototype.handleUserMsg=
function(b){switch(b.getUserType()){default:CB.LOG("UserMsg="+CB.TeraBrainUserMsgType.toString(b.getUserType()));break;case CB.TeraBrainUserMsgType.TBUSER_ENGINENAMES:this.handleEngineNames(b);break;case CB.TeraBrainUserMsgType.TBUSER_USERENTRIES:break;case CB.TeraBrainUserMsgType.TBUSER_HOTPOSITION:break;case CB.TeraBrainUserMsgType.TBUSER_CONFIRM_REQUEST:this.handleConfirmRequest(b);case CB.TeraBrainUserMsgType.TBUSER_CONFIRMCOMMENT_REQUEST:case CB.TeraBrainUserMsgType.TBUSER_COMMENTS:case CB.TeraBrainUserMsgType.TBUSER_ADD_COMMENT:case CB.TeraBrainUserMsgType.TBUSER_REFRESH_COMMENT:case CB.TeraBrainUserMsgType.TBUSER_CONFIRM_LOGIN:case CB.TeraBrainUserMsgType.TBUSER_RANKINGLIST:case CB.TeraBrainUserMsgType.TBUSER_DEEP_VAR:case CB.TeraBrainUserMsgType.TBUSER_SLAVE_ANALYSIS:case CB.TeraBrainUserMsgType.TBUSER_RETRACT:case CB.TeraBrainUserMsgType.TBUSER_SUBMIT_POSITION_DONE:case CB.TeraBrainUserMsgType.TBUSER_SUBMIT_GAME_RESPONSE:case CB.TeraBrainUserMsgType.TBUSER_ANALYSE_GAME_RESPONSE:case CB.TeraBrainUserMsgType.TBUSER_USERDATA:case CB.TeraBrainUserMsgType.TBUSER_LOCALTREE:}};
c.prototype.handleInfoMsg=function(b){this.aTBI=new CB.TeraBrainInfo;this.aTBI.V3(b.getBuf());b={position:this.aTBI.pos.getPosition(),moves:this.aTBI.moveList.moves,ticket:b.getVal(),tbInfo:this.aTBI};this.fireOnLiveBook(b)};c.prototype.handleConfirmRequest=function(b){this.fireOnLiveBook({moves:[],ticket:b.getVal()})};c.prototype.onConnectedToBoundServer=function(){this.boundLoginOk=!0;this.callOnConnect?(this.callOnConnect(),this.callOnConnect=null):this.requestPosInfo(new CB.Position)};c.prototype.handleTableData=
function(b){this.timerClear.stop();this.aHTD=new CB.HashTableData;this.aHTD.V3(b.getBuf());for(var d=[],c=0;c<CB.TBrainMove.prototype.HASH_LINE_CNT;++c)null==this.associativeArray[this.aHTD.move[c].m_nEngineId]?d.push(this.aHTD.move[c].m_nEngineId):this.aHTD.move[c].EngineName=this.associativeArray[this.aHTD.move[c].m_nEngineId];0<d.length?this.requestEngineNames(d):(d=this.aHTD.pos.getPosition(),V15.panelMgr.tbPanel&&V15.panelMgr.tbPanel.update(d,this.aHTD),this.tableDataHandlers[b.getVal()]&&(this.tableDataHandlers[b.getVal()](b.getVal(),
this.aHTD),delete this.tableDataHandlers[b.getVal()]),this.fireOnTBData({position:d,table:this.aHTD}))};c.prototype.setEmptyTable=function(){this.aHTD||(this.aHTD=new CB.HashTableData);var b=CB.HashTableData.emptyFactory();V15.panelMgr.tbPanel&&V15.panelMgr.tbPanel.update(this.aHTD.pos.getPosition(),b)};c.prototype.handleEngineNames=function(b){for(var d=b.getBuf().Vw(),c=0;c<d;c++){b.getBuf().beginSizedRead();var f=b.getBuf().V6(255),g=b.getBuf().Vw();this.associativeArray[g]=f;b.getBuf().readFloat64();
b.getBuf().endSizedRead()}for(b=0;b<CB.TBrainMove.prototype.HASH_LINE_CNT;++b)this.aHTD.move[b].EngineName=this.associativeArray[this.aHTD.move[b].m_nEngineId];b=this.aHTD.pos.getPosition();V15.panelMgr.tbPanel&&(V15.panelMgr.tbPanel.update(b,this.aHTD),this.timerClear.stop(),this.fireOnTBData({position:b,table:this.aHTD}))};c.prototype.LogInPlayChessName=function(){var b=new TeraBrainMessage(SocketsMessageType.TERABRAIN_USER);b.SetUserType(TeraBrainUserMsgType.TBUSER_CHESSSERVER_LOGIN);var d=b.GetPDataBuf();
d.WriteString(m_strUsername);d.WriteString(m_strPassword);InquireMachineGuid();m_sMachineGuid.IsZero()?CBDebug.assert(!1):(this.m_sMachineGuid.WriteToDataBuffer(d),this.send(b))};c.prototype.LogOutPlayChessName=function(b){b=new TeraBrainMessage(SocketsMessageType.TERABRAIN_USER);b.SetUserType(TeraBrainUserMsgType.TBUSER_CHESSSERVER_LOGOUT);var d=b.GetPDataBuf();this.InquireMachineGuid();m_sMachineGuid.IsZero()?CBDebug.assert(!1):(this.m_sMachineGuid.WriteToDataBuffer(d),Send(b));this.m_bLoggedIn=
!1;ResetLoginData()};c.prototype.ResetLoginData=function(){this.m_nUserReliability=0;this.m_bAdmin=!1;this.m_nUserId=0};c.prototype.InquireMachineGuid=function(){m_sMachineGuid.IsZero();return m_sMachineGuid};c.prototype.GetNUserId=function(){return m_nUserId};c.prototype.GetNEngineId=function(){return m_nEngineId};c.prototype.ShouldUsePlayChessName=function(){return!0};c.prototype.UseEngineInAnalysis=function(){return!1};c.prototype.GetMaxServerSilentSeconds=function(){return 30};c.prototype.handleChat=
function(b){var d=new CB.ChatData;d.fromSocketsMsg(b);d.isToSession()?(b=this.watchSessions.getTitleOfSession(d.getIdSession()),b.length&&(d.strMsg="("+b+"): "+d.strMsg),V15.panelMgr.chatOut(d.toString(),"LogKibitzChat")):V15.panelMgr.chatOut(d.toString())};Ve.initForListeners(c);c.prototype.sendRandomMessage=function(){for(var b=0;10>b;b++);};Ve.initForListeners(c);Ve.addEvent(c,"LiveBook");Ve.addEvent(c,"TBData");Ve.addEvent(c,"LiveBookDisplay");return c}();
CB.TeraBrainUserMsgType={TBUSER_REQ_ENGINENAMES:1400,TBUSER_ENGINENAMES:1401,TBUSER_REQ_USERENTRIES:1402,TBUSER_USERENTRIES:1403,TBUSER_CHAT_TO_ALL:1404,TBUSER_INJECT_GAME:1420,TBUSER_CHESSSERVER_LOGIN:1421,TBUSER_CHESSSERVER_LOGOUT:1422,TBUSER_CONFIRM_LOGIN:1423,TBUSER_HOTPOSITION:1424,TBUSER_REQ_HOTPOSITION:1425,TBUSER_CONFIRM_REQUEST:1426,TBUSER_DEEP_CHECK:1427,TBUSER_DEEP_VAR:1428,TBUSER_BEGIN_DONATION:1429,TBUSER_END_DONATION:1430,TBUSER_SLAVE_ANALYSIS:1431,TBUSER_RETRACT_REQUEST:1432,TBUSER_RETRACT:1433,
TBUSER_SUBMIT_POSITION:1434,TBUSER_SUBMIT_POSITION_DONE:1435,TBUSER_SUBMIT_GAME:1436,TBUSER_SUBMIT_GAME_RESPONSE:1437,TBUSER_ANALYSE_GAME:1438,TBUSER_ANALYSE_GAME_RESPONSE:1439,TBUSER_COMMENTS:1440,TBUSER_REQ_COMMENTS:1441,TBUSER_ADD_COMMENT:1442,TBUSER_COMMENT_FEEDBACK:1443,TBUSER_REFRESH_COMMENT:1444,TBUSER_CONFIRMCOMMENT_REQUEST:1445,TBUSER_REQ_RANKINGLIST:1460,TBUSER_RANKINGLIST:1461,TBUSER_BACKUP_DATABASES:1462,TBUSER_TEST:1463,TBUSER_ADMIN_RESET_RANKING:1464,TBUSER_ADMIN_BLOCK_DISCOVERY:1465,
TBUSER_REQUEST_PERSONALDATA:1466,TBUSER_USERDATA:1467,TBUSER_REQUEST_LOCALTREE:1468,TBUSER_LOCALTREE:1469,TBUSER_SUSPICIOUS_LINE:1480,TBUSER_RESET_LIN:1481,TBUSER_FEEDBACK_ON_LINE:1481,TBUSER_SET_MACHINE_FACTOR:1482,toString:function(c){for(var b in this)if(this[b]==c)return b;return"Unknown TBUserMsgId: "+c}};"use strict";
CB.TeraBrainRequest=function(){var c=function(b,d,c){this.m_eRequestType=d;this.m_aHashPos=new CB.HashPosition(b);this.m_aMachineInfo=c;this.m_nMoveNo=b.getMoveNum();this.m_bCountVisit=!0;this.m_bHumanServerGame=this.m_bConfirmRequested=!1;this.m_nFlags=0};c.prototyperRequestsPosInfo=function(){return this.m_eRequestType==TeraBrainRequestType.TBREQUEST_LB_POSINFO};c.prototype.requestsAllMoves=function(){return this.m_eRequestType==TeraBrainRequestType.TBREQUEST_LB_ALLMOVES};c.prototype.requestsSearchInfo=
function(){return this.m_eRequestType==TeraBrainRequestType.TBREQUEST_SEARCH_INFO};c.prototype.isUploadOnly=function(){return this.m_eRequestType==TeraBrainRequestType.TBREQUEST_LB_UPLOADONLY};c.prototype.getHashPos=function(){return this.m_aHashPos};c.prototype.getMoveNo=function(){return this.m_nMoveNo};c.prototype.setMoveNo=function(b){this.m_nMoveNo=b};c.prototype.getTaggedPos=function(){return new CB.TaggedHashPos(GetHashPos(),GetMoveNo())};c.prototype.countVisit=function(){return this.m_bCountVisit};
c.prototype.setCountVisit=function(b){this.m_bCountVisit=b||!1};c.prototype.confirmRequested=function(){return this.m_bConfirmRequested};c.prototype.setConfirmRequested=function(b){this.m_bConfirmRequested=b||!1};c.prototype.isHumanServerGame=function(){return this.m_bHumanServerGame};c.prototype.setIsHumanServerGame=function(b){this.m_bHumanServerGame=b||!1};c.prototype.isNormedEval=function(){return this.ISFLAG(1)};c.prototype.setIsNormedEval=function(b){this.SETFLAG(1,b)};c.prototype.setIsMultiRequest=
function(b){this.SETFLAG(2,b)};c.prototype.SETFLAG=function(b,d){this.m_nFlags=d?this.m_nFlags|b:this.m_nFlags&~b};c.prototype.ISFLAG=function(b){return 0!=(this.m_nFlags&b)};c.prototype.fromMessage=function(b){b=b.getPDataBuf();b.rewind();this.V3(b)};c.prototype.getSocketsMessage=function(){var b=new CB.WebSockMessage(CB.SockMsgId.TERABRAIN_REQUEST);this.writeToDataBuffer(b.buf);return b};c.prototype.writeToDataBuffer=function(b){b.beginSizedWrite();b.Vh(this.m_eRequestType);this.m_aHashPos.writeToDataBuffer(b);
this.m_aMachineInfo.writeToDataBuffer(b);b.Vh(this.m_nMoveNo);b.V13(this.m_bCountVisit);b.V13(this.m_bConfirmRequested);b.V13(this.m_bHumanServerGame);b.Vh(this.m_nFlags);b.endSizedWrite()};c.prototype.V3=function(b){b.BeginSizedRead();this.m_eRequestType=TeraBrainRequestType(b.ReadInt());this.m_aHashPos.ReadFromDataBuffer(b);this.m_aMachineInfo.ReadFromDataBuffer(b);this.m_nMoveNo=b.ReadUint32();this.m_bCountVisit=b.ReadBool();this.m_bConfirmRequested=b.ReadBool();this.m_bHumanServerGame=b.ReadBool();
this.m_nFlags=b.ReadUint32();b.EndSizedRead();return!0};return c}();"use strict";CB.TBrainTimeStamp=function(){var c=function(){};c.prototype.UShortToDate=function(b){var d=b&31,c=b>>5&15;b=1945+(b>>9&127);return new CBDate(Math.Min(CBDate.Today().GetDate(),(new CBDate(b,c,d)).GetDate()))};c.prototype.DateToUShort=function(b){var d=Math.Max(1945,b.GetYear());return ushort(b.GetDay()|b.GetMonth()<<5|d-1945<<9)};c.prototype.GetNTodaysTimeStamp=function(){return DateToUShort(CBDate.Today())};return c}();
"use strict";CB.namespace("CB.Panels");
CB.Panels.createTBListPanel=function(c,b){CB.namespace("ExtDataModels");CB.ExtDataModels.tbItem=Ext.define("tbItem",{extend:"Ext.data.Model",fields:["m_nEval","line","m_nDepth","EngineName"]});var d,e=[],f=null,g=Ext.create("Ext.data.Store",{model:"tbItem",sorters:[{property:"m_nGames",direction:"DESC"}]});g.applyAdd=function(b){e.length&&CB.LOG("TB Store Add: "+e.length);f&&(f.hide(),f=null);g.add(e);e.length&&CB.LOG("End TB Store Add");e=[]};g.onGameRemoved=function(b){b=g.getById(b);null!==b&&
g.remove([b])};c.game.addOnResetGameListener(function(){e=[]});var h=0;d=Ext.create("Ext.grid.Panel",{title:lm.LETS_CHECK,id:"tbPanelGrid",store:g,heigth:150,width:350,split:!0,region:b.region,multiSelect:!1,collapsible:!0,animCollapse:!1,plugins:b.responsiveConfig?"responsive":null,responsiveConfig:b.responsiveConfig,viewConfig:{trackOver:!1},columns:[{text:lm.EVAL,flex:1,minWidth:30,maxWidth:80,sortable:!0,dataIndex:"m_nEval",tdCls:"gmBlackCell",renderer:function(b,d,c,e,f,g){return c.data.m_aLine[0]?
c.data.m_nEval/100:"--"}},{text:lm.VARIATION,flex:1,minWidth:100,maxWidth:120,sortable:!0,dataIndex:"line",tdCls:"gmLine",renderer:function(b,d,c,e,f,g){return V15.isLoggedIn()||12>h?c.data.line:lm.PLEASE_LOGIN_SHORT}},{text:lm.DEPTH,flex:3,minWidth:30,maxWidth:60,sortable:!0,dataIndex:"m_nDepth",tdCls:"gmBlackCell",renderer:function(b,d,c,e,f,g){return c.data.m_aLine[0]?c.data.m_nDepth:""}},{text:lm.ENGINE,flex:2,minWidth:130,maxWidth:200,sortable:!0,dataIndex:"EngineName",tdCls:"gmClock",renderer:function(b,
d,c,e,f,g){return c.data.EngineName}}]});d.onCellClick=function(b,d,c,e,f,g,h,w){CB.LOG("On TB Click: row="+g)};d.on("cellclick",d.onCellClick);d.clear=function(b){g.removeAll()};d.startupdate=function(){null===f&&d.isVisible()&&(f=d.createMask());null!==f&&f.show()};d.update=function(b,d){g.removeAll();for(var f=0;f<CB.TBrainMove.prototype.HASH_LINE_CNT;++f){d.move[f].line=CB.HashTableData.generateLine(b,d.move[f],c).lineNota;var t=new CB.ExtDataModels.tbItem(d.move[f]);0==t.data.m_aLine[0]&&(t.data.line=
"---",t.data.EngineName="---");e.push(t)}0==g.count()&&g.applyAdd(!0);h=c.getCurPos().getPlyNum()};d.createMask=function(){return new Ext.LoadMask(d.getEl(),{msg:lm.LOADING_STATISTICS})};return d};"use strict";CB.namespace("CB.Panels");
CB.Panels.createTBBookListPanel=function(c,b){function d(){if(320>e.getWidth())return"font-size:96%"}CB.namespace("ExtDataModels");CB.ExtDataModels.tbBookItem=Ext.define("tbBookItem",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},"line","Games",{name:"Result",sortType:function(b,d,c){return b}},"EloAvg","m_nVisits","m_nEval","m_nDepth","fPercent","to","fr","pr","players"]});var e,f=null,g=Ext.create("Ext.data.Store",{model:"tbBookItem",sorters:[{property:"m_nVisits",direction:"DESC"}]});
g.applyAdd=function(b){b.length&&CB.LOG("LBook Add: "+b.length);f&&(f.hide(),f=null);g.add(b);b.length&&CB.LOG("End LBook Add:"+b.length)};g.onGameRemoved=function(b){b=g.getById(b);null!==b&&g.remove([b])};var h=0,l=[{text:lm.MOVE,flex:4,minWidth:50,maxWidth:250,sortable:!1,dataIndex:"line",tdCls:"liveBookMove",renderer:function(b,c,f,g,l,q){b=e.getMyMoveDecoration(f);c.tdCls=b.cls;c.tdStyle=d();if(V15.config.freeLiveBook||!V15.config.liveBookIsPremium||r||10>h){c=f.data.line.split(" ");if(1<c.length){f=
c[0];f+='<span class="liveBookMoreMoves">';for(g=1;g<c.length;g++)f+=" "+c[g];return f+="<span>"+b.suffix}return f.data.line+b.suffix}c.tdCls="gmPremiumOnly";if(t)return String.formatEx('<a class="gmPremiumOnly" href="{0}">{1}</a>',"https://account.chessbase.com/en/matrix",lm.PREMIUM_ONLY);f="https://live.chessbase.com/logon?returnurl="+encodeURIComponent(document.location);return String.formatEx('<a class="gmPremiumOnly" href="{0}">{1}</a>',f,lm.PREMIUM_ONLY)}},{text:lm.GAMES,flex:3,minWidth:40,
maxWidth:140,sortable:!0,dataIndex:"Games",align:"right",tdCls:"liveBookGames",renderer:function(b,c,e,f,g,l){c.tdStyle=d();return V15.config.freeLiveBook||V15.isLoggedIn()||10>h?e.data.Games.toLocaleString(CB.Language.getStrUserLanguage(),{maximumFractionDigits:0}):lm.PLEASE_LOGIN_SHORT}},{text:lm.RESULT,flex:2.3,minWidth:55,maxWidth:130,sortable:!0,dataIndex:"Result",tdCls:"liveBookResult",renderer:function(b,c,e,f,g,h){c.tdStyle=d();if(0<e.data.Games)return Math.round(e.data.Result)+"%";if(V15.config.freeLiveBook||
V15.isLoggedIn()){if(c.tdCls="liveBookEval",e.data.hasEval()){b=e.data.m_nEval;e=e.data.m_nDepth;if(29750<Math.abs(b))return e="#"+(3E4-Math.abs(b)),0>b&&(e="-"+e),e;c="";0<b&&(c="+");b=c+(.01*b).toFixed(2);e&&(b+="/"+e);return b}}else return"";return"---"}},{text:lm.ELO_AVG,flex:2,minWidth:35,maxWidth:60,sortable:!0,dataIndex:"EloAvg",align:"center",tdCls:"liveBookEloAvg",renderer:function(b,c,e,f,g,h){c.tdStyle=d();if(!isNaN(e.data.EloAvg))return Math.round(e.data.EloAvg)}},{text:"%",flex:1,minWidth:30,
maxWidth:50,sortable:!0,align:"center",dataIndex:"fPercent",renderer:function(b,c,e,f,g,h){c.tdStyle=d();if(!isNaN(e.data.fPercent))return Math.round(e.data.fPercent)}},{text:lm.VISITS,flex:3,minWidth:50,maxWidth:120,sortable:!0,dataIndex:"m_nVisits",tdCls:"liveBookVisits",align:"right",renderer:function(b,c,e,f,g,l){c.tdStyle=d();if(!isNaN(e.data.m_nVisits))return V15.config.freeLiveBook||V15.isLoggedIn()||10>h?e.data.m_nVisits.toLocaleString(CB.Language.getStrUserLanguage(),{maximumFractionDigits:0}):
lm.PLEASE_LOGIN_SHORT}}],q=!1,r=!1,t=!1,v={id:"tbBookGrid",title:750<window.innerHeight||b.forceTitle?lm.LIVE_BOOK:0,region:b.region,store:g,heigth:b.height,width:b.width,minHeight:b.minHeight,autoScroll:!0,closable:b.closable,split:!0,viewConfig:{emptyText:lm.REQUESTING_MOVES},animCollapse:!1,plugins:b.responsiveConfig?"responsive":null,responsiveConfig:b.responsiveConfig,listeners:{beforeItemKeyDown:function(b,d,f,g,h){CB.LOG("Before Key Down");b=!0;switch(h.getKey()){default:b=!1;break;case h.UP:case h.DOWN:case h.PAGE_DOWN:case h.PAGE_UP:break;
case h.LEFT:CB.LOG("Cursor L");e.myFocus=!0;c().game.gotoPrev();break;case h.RIGHT:CB.LOG("Cursor R");e.myFocus=!0;c().game.gotoNext();break;case h.ENTER:CB.LOG("Enter"),e.loadMove(d.data),b=!1}return b?b:(h.stopEvent(),V15.panelMgr.getIsFormOpen()||V15.commands.handleKeyDown(h),!1)}},columns:l,tools:800<window.innerHeight&&b.helpBtn?[{type:"help",tooltip:"Get Help",callback:function(b,d,c){V15.panelMgr.showToolTip({x:c.touch.pageX-200,y:c.touch.pageY-30},lm.LIVE_BOOK_HELP,4E3)}}]:null};b.toolbar&&
CB.System.isAtLeastTablet()&&(v.bbar={items:[CB.ToolButtons.btn(lm.LOAD_WHITE,"White16","small",function(){c().boardWin.setBlackIsBottom(!1,!0);V15.loadMyMoves(CB.GetMovesType.WHITE,new CB.Game)}.bind(e)),CB.ToolButtons.btn(lm.LOAD_BLACK,"Black16","small",function(){c().boardWin.setBlackIsBottom(!0,!0);V15.loadMyMoves(CB.GetMovesType.BLACK,new CB.Game)}.bind(e)),CB.ToolButtons.btn("Restore Game","RestoreGameNew16","small",function(){V15.restorePrevGame()}.bind(e))]});e=Ext.create("Ext.grid.Panel",
v);e.myMoves=[];e.onCellClick=function(b,d,c,f,g,h,l,q){CB.LOG("On book Click: row="+h);6>c&&e.loadMove(f.data)};e.loadMove=function(b){b=new CB.Move(b.fr,b.to,b.pr);c().getCurPos().isLegalMove(b)&&c().game.makeMove(b,c().Vk.getMoveEnterType());(new CB.Timer(function(){V15.panelMgr.refreshOnlineDBGames&&V15.panelMgr.refreshOnlineDBGames()})).runOnce(400);e.myFocus=!0};e.onContextMenu=function(b,d,c,f,g,h){if(V15.cloudMgr){g.preventDefault();if(V15.cloudMgr&&V15.checkCloudLoggedIn())var l=new CB.Move(d.data.fr,
d.data.to,d.data.pr),q=function(b){e.removeFromMyMoves(l)},r=function(b){e.addMoveToMyMoves(l,!1)},t=function(b){e.addMoveToMyMoves(l,!0)},v=function(b){e.unmarkTree(l,!1)},y=function(b){e.unmarkTree(l,!0)},Q=function(b){e.unlearnTree(l,!1)},U=function(b){e.unlearnTree(l,!0)};CB.CSS.addIcon("MyMove16");CB.CSS.addIcon("ImportantMove16");CB.CSS.addIcon("EraseMove16");CB.CSS.addIcon("ResetLearning16");CB.CSS.addIcon("Cutline16");Ext.create("Ext.menu.Menu",{items:[{text:lm.MARK_MOVE,iconCls:"MyMove16",
handler:r,activated:e.isRepertoireMove(l)},{text:lm.MARK_IMPORTANT,iconCls:"ImportantMove16",handler:t},{text:lm.UNMARK_MOVE,iconCls:"Erase16",handler:q,enabled:e.isRepertoireMove(l)},"-",{text:lm.UNMARK_TREE_WHITE,iconCls:"Cutline16",handler:v},{text:lm.UNMARK_TREE_BLACK,iconCls:"Cutline16",handler:y},"-",{text:lm.RESET_LEARNING_WHITE,iconCls:"ResetLearning16",handler:Q},{text:lm.RESET_LEARNING_BLACK,iconCls:"ResetLearning16",handler:U}]}).showAt(g.getXY())}};e.isRepertoireMove=function(b){if(b)for(var d=
0;d<e.myMoves.length;d++)if(e.myMoves[d].move.equals(b))return!0;return!1};e.getMoveFlags=function(b){for(var d=0;d<e.myMoves.length;d++)if(e.myMoves[d].move.equals(b))return e.myMoves[d].flags;return 0};e.getMyMove=function(b){for(var d=0;d<e.myMoves.length;d++)if(e.myMoves[d].move.equals(b))return e.myMoves[d];return{eval:0}};e.removeMyMove=function(b){for(var d=!1,c=-1,f=0;!d&&f<e.myMoves.length;f++)e.myMoves[f].move.equals(b)&&(c=f,d=!0);0<=c&&e.myMoves.splice(c,1);return d};e.removeFromMyMoves=
function(b){V15.cloudMgr&&V15.cloudMgr.isLoggedIn()&&e.removeMyMove(b)&&(V15.cloudMgr.removeFromMyMoves(c().game.getCurPos(),b),V15.cloudMgr.isMovesLoadedFor(c().game.getCurPos().getBTM())&&V15.cloudMgr.reloadMyMoves(),e.getView().refresh())};e.unmarkTree=function(b,d){if(V15.cloudMgr&&V15.cloudMgr.isLoggedIn()){var f=V15.cloneGameToCurPos(c().game);f.getCurPos().preCalcCtx(b);f.makeMove(b);V15.cloudMgr.removeWholeTree(c().game.getCurPos(),b,d?CB.GetMovesType.BLACK:CB.GetMovesType.WHITE);e.removeMyMove(b);
e.getView().refresh()}};e.unlearnTree=function(b,d){if(V15.cloudMgr&&V15.cloudMgr.isLoggedIn()){var f=V15.cloneGameToCurPos(c().game);f.getCurPos().preCalcCtx(b);f.makeMove(b);V15.cloudMgr.unlearnWholeTree(c().game.getCurPos(),b,d?CB.GetMovesType.BLACK:CB.GetMovesType.WHITE);e.getView().refresh()}};e.updateOrAddMove=function(b){for(var d=0;d<e.myMoves.length;d++)if(e.myMoves[d].move.equals(b.move)){e.myMoves[d].flags=b.flags;return}e.myMoves.push({move:b.move,visits:0,flags:b.flags})};e.addMoveToMyMoves=
function(b,d){if(V15.cloudMgr&&V15.cloudMgr.isLoggedIn()){var f=c().game.getCurPos().getBTM()?1:2;d&&(f|=16);e.getMoveFlags(b)!=f&&(e.updateOrAddMove({move:b,flags:f}),f=V15.cloneGameToCurPos(c().game),f.getCurPos().preCalcCtx(b),f.makeMove(b),V15.cloudMgr.storePosAndMoves(f,d?3:2),e.getView().refresh());V15.cloudMgr.isMovesLoadedFor(c().game.getCurPos().getBTM())&&V15.cloudMgr.reloadMyMoves()}};e.getMyMoveDecoration=function(b){var d={suffix:"",cls:""};if(CB.PosAndMoveFlags){var c=new CB.Move(b.data.fr,
b.data.to,b.data.pr);b=e.getMoveFlags(c);c=e.getMyMove(c).eval;b&CB.PosAndMoveFlags.MYMOVE?(b&16?(d.cls+=" liveBookMoveImportant",d.suffix="**"):(d.cls+=" liveBookMoveInRep",d.suffix="*"),d.cls=b&CB.PosAndMoveFlags.MY_WHITE?b&CB.PosAndMoveFlags.BLACK?d.cls+" liveBookBoth":d.cls+" liveBookWhite":d.cls+" liveBookBlack"):b&CB.PosAndMoveFlags.MOVE?(d.cls+=" liveBookMyLine",d.suffix="",d.cls=b&CB.PosAndMoveFlags.MOVE_WHITE?b&CB.PosAndMoveFlags.BLACK?d.cls+" liveBookBoth":d.cls+" liveBookWhite":d.cls+" liveBookBlack"):
(d.cls+=" liveBookMove",d.suffix="");c&&(d.suffix+="<span class='CBSymbol'>"+Vp.getText(c)+"</span>")}return d};e.on("cellclick",e.onCellClick);e.on("itemcontextmenu",e.onContextMenu);e.startupdate=function(){null===f&&e.isVisible()&&(f=e.createMask());null!==f&&f.show()};e.clear=function(b){e.isVisible()&&(b&&this.setEmptyText(b),b=e.getHeight(),0<g.count()&&g.removeAll(),e.setHeight(b))};e.setEmptyText=function(b){Ext.apply(e.getView(),{emptyText:'<div class = "gridEmptyText">'+b+"</div>"})};var y=
CB.TBrainMove.getTimeStampToday();e.refreshAfterShow=function(){this.lbInfo&&this.liveBookListener(this.lbInfo);this.repPosInfo&&this.myMovesListener(this.repPosInfo)};e.liveBookListener=function(b){if(!e.isVisible())e.lbInfo=b;else if(c()&&c().getCurPos){var d=b.moves,f=c().getCurPos(),l=f.getSideToMove();6>=f.getPieces().length&&(b.sorted||CB.TBrainMoveList.sortEval(d,l==CB.Side.BLACK));e.setEmptyText(lm.FRESH_POSITION);d=e.getHeight();if(c()){h=c().getCurPos().getPlyNum();for(l=f=0;l<b.moves.length;l++)f+=
b.moves[l].getNVisits();y=CB.TBrainMove.getTimeStampToday();for(var q=6>=c().getCurPos().getPieces().length,r=[],l=0;l<b.moves.length;l++){var t=b.moves[l];if(q||e.passesMoveFilter(t)){var v=t.getMoveRecord();t.line=e.generateLine(b.position,v);t.fPercent=100;f&&(t.fPercent=100*t.getNVisits()/f);t.m_nEval=t.getNEval();t.Games=t.m_performanceStats.getNGames();t.Result=t.m_performanceStats.getFPercent(b.position.isBTM());t.EloAvg=t.m_performanceStats.getSortEloAv();t.fr=v.from;t.to=v.to;t.players=[];
delete t.id;t=new CB.ExtDataModels.tbBookItem(t);t.id=e.calcId(v);r.push(t)}}0<g.count()&&g.removeAll();g.applyAdd(r);e.setHeight(d);e.myFocus&&(e.myFocus=!1,e.focus());r.length?e.setEmptyText("Requesting moves..."):e.getView().refresh()}}};e.calcId=function(b){return"TBBook"+((b.prom<<12)+(b.from<<8)+b.to)};e.passesMoveFilter=function(d){var c=b.minVisits||2;return(0<d.getNGames()||300>y-d.m_nTimeStamp||d.isMyMove)&&(d.getNVisits()>=c||d.hasEval())};e.tbDataListener=function(b){if(e.isVisible()&&
c()&&c().getCurPos&&b.position.equals(c().getCurPos())){g.beginUpdate();for(var d=[],f=0;f<CB.TBrainMove.prototype.HASH_LINE_CNT;++f){var h=CB.HashTableData.generateLine(b.position,b.table.move[f],c(),3);if(h.line.length){var l=new CB.TBrainMove;l.line=h.lineNota;for(var q=!1,r=0;r<g.getCount();r++){var t=g.getAt(r);h.line[0].equals(t.data.move)&&(t.data.m_nEval=b.table.move[f].m_nEval,t.data.m_nDepth=b.table.move[f].m_nDepth,0==t.data.Games&&(t.data.line=h.lineNota),q=!0)}if(!q&&(l.players=[],l.to=
h.line[0].to,l.from=h.line[0].from,l.Games=0,l.EloAvg=0,l.to!=l.from&&(l.move=h.line[0],150<b.table.move[f].m_nCalcDepth))){l.m_nEval=b.table.move[f].m_nEval;l.m_nDepth=b.table.move[f].m_nDepth;l.setHasEval(!0);l=new CB.ExtDataModels.tbBookItem(l);l.id=e.calcId(h.line[0]);l.data.line=h.lineNota;h=!1;for(q=0;!h&&q<d.length;q++)h=d[q].id==l.id;h||d.push(l)}}}g.add(d);g.endUpdate();e.getView().refresh()}};e.onDBGamesListener=function(b){if(e.isVisible()){g.beginUpdate();for(var d=0;d<b.length;d++)if(b[d].nFlags&
CB.OnlineEntryEnum.FLAGS_ONLINE_GAME&&V15.onlineLobby.firstMove<b[d].aGame.getCurLine().length){var c=b[d].aGame.getCurLine()[V15.onlineLobby.firstMove];if((c=g.getById(e.calcId(c)))&&2>c.data.players.length){var f=V15.onlineLobby.firstMove&1?b[d].aGame.hdr.black.getListStr(0):b[d].aGame.hdr.white.getListStr(0);c.data.players[0]!=f&&c.data.players.push(f);e.getView().refreshNode(c)}}g.endUpdate()}};e.generateLine=function(b,d){for(var e=this.convertJSONLine(ObjUtil.clone(b),d),f=new CB.NotationGenerator(CB.V1),
g="",h=c().game.getStartPos().getBTM(),l=0;l<e.length;l++){var q=f.getMoveNota(e[l]),r=f.getStrMoveNumInLine(l,c().getCurPos().getPlyNum(),h),g=g+(r+q);l<e.length-1&&(g+=" ")}return g};e.convertJSONLine=function(b,d){var c=[];b.isLegalMove(d)&&(b.preCalcCtx(d),b.makeMove(d),b.postCalcCtx(d,!0),c.push(d));return c};e.myMovesListener=function(b){this.repPosInfo=b;for(var d=0;d<b.moves.length;d++)CB.LOG(b.moves[d].move+"-"+b.moves[d].visits+", "+b.moves[d].flags+", correct="+b.moves[d].correct);e.myMoves=
b.moves;e.getView().refresh()};e.createMask=function(){return new Ext.LoadMask({msg:lm.LOADING_STATISTICS,target:e})};e.initCloudListener=function(b){b.addOnMyMovesListener(e.myMovesListener)};e.onLoginListener=function(){e.myMoves=[];e.setTitle(lm.LIVE_BOOK);e.getView().refresh()};e.onAccountTypeListener=function(d){t=(r=3==d.type)||2==d.type;!q&&0<=d.type&&b.players&&(l.push({text:"Players",flex:3,minWidth:50,maxWidth:220,sortable:!0,dataIndex:"players",tdCls:"liveBookVisits",align:"left",renderer:function(b,
d,c,e,f,g){if(r)return d.tdCls="liveBookPlayers",b.join("/");d.tdCls="gmPremiumOnly";if(t)return String.formatEx('<a class="gmPremiumOnly" href="{0}">{1}</a>',"https://account.chessbase.com/en/matrix",lm.PREMIUM_ONLY);b="https://live.chessbase.com/logon?returnurl="+encodeURIComponent(document.location);return String.formatEx('<a class="gmPremiumOnly" href="{0}">{1}</a>',b,lm.PREMIUM_ONLY)}}),e.reconfigure(g,l),q=!0);e.getView().refresh()};b.suppressLiveBookListener||V15.aTBLobby.addOnLiveBookListener(e.liveBookListener);
V15.aTBLobby.addOnLiveBookDisplayListener(e.liveBookListener);V15.aTBLobby.addOnTBDataListener(e.tbDataListener);V15.addOnLoginListener(e.onLoginListener.bind(e));V15.addOnAccountTypeListener(e.onAccountTypeListener.bind(e));V15.onlineLobby&&V15.onlineLobby.addOnGamesListener(e.onDBGamesListener.bind(e));return e};"use strict";
CB.PositionTracker=function(){var c=function(){this.set=new CB.Set;this.trackCnt=0;this.enabled=!0};c.prototype.save=function(){(new CB.Storage).save("posns_trackCnt",this.trackCnt);this.set.save("posns",function(b){return 200>this.trackCnt-b.lastSeenAt}.bind(this))};c.prototype.load=function(){this.trackCnt=(new CB.Storage).load("posns_trackCnt")||0;this.set.load("posns",function(b){if(b){var d=new CB.Position;d.copy(b.pos);d=new CB.TrackedPos(d);d.cnt=b.cnt;d.lastSeenAt=b.lastSeenAt;return d}})};
c.prototype.track=function(b){if(this.enabled){this.trackCnt++;if(this.set.contains(new CB.TrackedPos(b)))return b=this.set.get(new CB.TrackedPos(b)),b.inc(),b.lastSeenAt=this.trackCnt,!0;b=new CB.TrackedPos(b);b.lastSeenAt=this.trackCnt;this.set.insert(b)}return!1};c.prototype.getAge=function(b){b=this.set.get(new CB.TrackedPos(b));return void 0!==b&&0!=b.cnt?this.trackCnt-b.lastSeenAt:-1};return c}();
CB.TrackedPos=function(){var c=function(b){this.pos=ObjUtil.clone(b);this.lastSeenAt=this.cnt=0};c.prototype.setEquals=function(b){return this.pos.setEquals(b.pos)};c.prototype.setGreater=function(b){return this.pos.setGreater(b.pos)};c.prototype.inc=function(){this.cnt++};return c}();CB.namespace("CB.Server.ClientData");CB.Server.ClientFlags={CCDATA_RECEIVES_PAYMENTS:1,CCDATA_ENGINE_ALLOWED:2,CCDATA_PREMIUM_ACCOUNT:4,CCDATA_NO_GAME_DOWNLOAD:8};
CB.Server.ClientData=function(){var c=function(){this.nConnQuality=this.n8Reserved=this.n8Flags2=this.n8InputLang=this.n8Language=this.n8NonPureFlags=this.n8Flags=this.nRank=this.eStatus=this.nId=0;this.strText=this.strName="";this.n16Reserved=this.n16Flags=this.eStatus=this.eTitle=this.nRating=0;this.geoCoords=new CB.GeoCoordinates;this.eloRating=new CB.Server.EloRating};c.prototype.fromDataBuf=function(b){this.nId=b.V10();this.eStatus=b.V10()&65535;this.nRank=b.V10();this.n8Flags=b.readUint8();
this.n8NonPureFlag=b.readUint8();this.n8Language=b.readUint8();this.n8InputLang=b.readUint8();this.n8Flags2=b.readUint8();this.n8Reserved=b.readUint8();this.nConnQuality=b.V11();this.strName=b.V6(200);this.strText=b.V6(200);this.nRating=b.V10();this.eTitle=b.V10();b.V10();this.geoCoords.fromDataBuf(b);this.n16Flags=b.V11();this.n16Reserved=b.V11();b.beginSizedRead();this.eloRating.fromDataBuf(b);b.endSizedRead();return!0};c.prototype.isGuest=function(){return(this.nRank&15)==CB.Server.RankEnum.GUEST};
c.prototype.isPremium=function(){return this.n16Flags==CB.Server.ClientFlags.CCDATA_PREMIUM_ACCOUNT};return c}();CB.namespace("CB.Server.ClientList");
CB.Server.ClientList=function(){var c=function(){this.items=[]};c.prototype.fromSocketsMsg=function(b){b=b.getBuf();for(var d=b.V10(),c=0;c<d;c++){var f=new CB.Server.ClientData;f.fromDataBuf(b)&&this.items.push(f)}};c.prototype.get=function(b){return this.items[b]};c.prototype.count=function(){return this.items.length};c.prototype.autoTests=function(){return"NOTIMPL"};return c}();"use strict";CB.namespace("CB.Server.Rank");CB.namespace("CB.Server.RankEnum");CB.namespace("CB.Server.RankFlags");
CB.Server.RankEnum={NONE:-1,GUEST:0,PAWN:1,KNIGHT:2,BISHOP:3,ROOK:4,QUEEN:5,KING:6,TOPGM:7,VIP:8,SYSOP:9,CHESSBASE:10,NUM:11,getStrCode:function(c){switch(c&15){default:case this.GUEST:return"Guest";case this.PAWN:return"Pawn";case this.KNIGHT:return"Knight";case this.BISHOP:return"Bishop";case this.ROOK:return"Rook";case this.QUEEN:return"Queen";case this.KING:return"King";case this.VIP:return"VIP";case this.TOPGM:return"topGM";case this.SYSOP:return"Sysop";case this.CHESSBASE:return"ChessBase"}},
getStrText:function(c){switch(c&15){default:case this.GUEST:return lm.GUEST;case this.PAWN:return lm.PAWN;case this.KNIGHT:return lm.KNIGHT;case this.BISHOP:return lm.BISHOP;case this.ROOK:return lm.ROOK;case this.QUEEN:return lm.QUEEN;case this.KING:return lm.KING;case this.VIP:return"VIP";case this.TOPGM:return"Top-GM";case this.SYSOP:return"Sysop";case this.CHESSBASE:return"ChessBase"}}};
CB.Server.RankFlags={FLAG_500DAYS:1,FLAG_1000DAYS:2,FLAG_100TOURNDIRS:16,FLAG_500TOURNDIRS:32,FLAG_HELPER:64,FLAG_PREMIUM:128,FLAG_ROBOT:256};
CB.Server.Rank=function(){function c(b,d,c,h){1<c.length&&CB.CSS.addRules(".rnk-"+d+c,"background-image: url( ../../common/media/server/ranks"+h+"/"+d+c+h+".png ) !important;background-repeat:no-repeat; background-position:center;")}var b=!1,d=function(d,f){this.rank=d;this.flags=f;if(!b){for(var g=CB.Server.RankEnum.PAWN;g<=CB.Server.RankEnum.KING;g++)c(void 0,"w",CB.Server.RankEnum.getStrCode(g),16),c(void 0,"b",CB.Server.RankEnum.getStrCode(g),16);c(void 0,"","Guest",16);for(g=CB.Server.RankEnum.TOPGM;g<
CB.Server.RankEnum.NUM;g++)c(void 0,"",CB.Server.RankEnum.getStrCode(g),16);c(void 0,"","Helper",16);b=!0}};d.prototype.fromCompressed=function(b){this.rank=b&255;this.flags=b>>16};d.prototype.getCompressed=function(){return this.flags<<16+rank};d.prototype.isBlackSymbol=function(){return 0!==(this.flags&CB.Server.RankFlags.FLAG_500DAYS)||0!==(this.flags&CB.Server.RankFlags.FLAG_1000DAYS)};d.prototype.isHelper=function(){return 0!=(this.flags&CB.Server.RankFlags.FLAG_HELPER)};d.prototype.isPremium=
function(){return 0!=(this.flags&CB.Server.RankFlags.FLAG_PREMIUM)};d.prototype.getStrCode=function(){return CB.Server.RankEnum.getStrCode(this.rank)};d.prototype.getStrColumn=function(){var b=CB.Server.RankEnum.getStrText(this.rank);return b+=this.getStrFlags()};d.prototype.getStrFlags=function(){var b="";this.flags&CB.Server.RankFlags.FLAG_500DAYS&&(b+="+");this.flags&CB.Server.RankFlags.FLAG_1000DAYS&&(b+="+");this.flags&CB.Server.RankFlags.FLAG_100TOURNDIRS&&(b+="*");this.flags&CB.Server.RankFlags.FLAG_500TOURNDIRS&&
(b+="*");this.flags&CB.Server.RankFlags.FLAG_PREMIUM&&(b+="!");return b};d.prototype.getSortVal=function(){return this.rank==CB.Server.RankEnum.CHESSBASE?0:this.isHelper()?256*CB.Server.RankEnum.VIP+this.flags+1:256*this.rank+this.flags+1};d.prototype.getCSSClass=function(){var b;if(this.isHelper())b="rnk-Helper";else switch(this.rank){default:case CB.Server.RankEnum.GUEST:b="rnk-Guest";break;case CB.Server.RankEnum.PAWN:case CB.Server.RankEnum.KNIGHT:case CB.Server.RankEnum.BISHOP:case CB.Server.RankEnum.ROOK:case CB.Server.RankEnum.QUEEN:case CB.Server.RankEnum.KING:b=
"rnk-"+(this.isBlackSymbol()?"b":"w")+this.getStrCode();break;case CB.Server.RankEnum.TOPGM:case CB.Server.RankEnum.VIP:case CB.Server.RankEnum.SYSOP:case CB.Server.RankEnum.CHESSBASE:b="rnk-"+this.getStrCode()}return b};return d}();"use strict";CB.namespace("CB.Server.Status");
CB.Server.StatusEnum={GONE:1,STANDING:2,PLAYER:4,WATCHER:8,ANALYSER:16,CHAIRMAN:32,SEEKING:8192,TOURNDIRECTOR:32768,SIMULMASTER:65536,APPLYING:131072,UNAPPLYING:262144,REGISTERED:524288,SOLVER:16777216,IDLE:64,NOTIDLE:128,DISCONNECTED:1048576,YESGAMES:256,NOGAMES:512,HUMAN:1024,ENGINE:2048,CENTAUR:4096,VIDEO:16384,ENCODING:4194304,LISTENING:8388608,DGT_BOARD:2097152,OFFLINE:4194304,toString:function(c){var b;if(c&this.GONE)b=lm.GONE;else if(c&this.OFFLINE)b="Offline";else switch(c&this.ACTIONTYPE&
~this.SEEKING){default:case this.STANDING:b="";break;case this.PLAYER:b=lm.PLAYING;break;case this.WATCHER:b=lm.KIBITZING;break;case this.CHAIRMAN:b=lm.CHAIRMAN;break;case this.SOLVER:b=lm.TACTICS;break;case this.REGISTERED:b="Registered"}c&this.SEEKING&&(b.length&&(b+="/"),b+=lm.SEEKS);c&this.GONE||(c&this.IDLE&&(b.length&&(b+="/"),b+=lm.IDLE),c&this.NOGAMES&&!(c&this.PLAYER)&&(b.length&&(b+="/"),b+=lm.PAUSE),c&this.CENTAUR&&(b.length&&(b+="/"),b+="Centaur"),c&this.ENGINE&&(b.length&&(b+="/"),b+=
"Engine"),c&this.TOURNDIRECTOR&&(b=lm.TOURN_DIRECTOR),c&this.SIMULMASTER&&(b="Simul Master"),c&this.APPLYING&&(b="wants in"),c&this.UNAPPLYING&&(b="wants out"),c&this.REGISTERED&&(b="registered"),c&this.DISCONNECTED&&(b+="disconnected"));return b}};
(function(){var c=CB.Server.StatusEnum;c.ACTIONTYPE=c.STANDING|c.PLAYER|c.WATCHER|c.SOLVER|c.SEEKING|c.ANALYSER|c.CHAIRMAN|c.APPLYING|c.UNAPPLYING|c.REGISTERED|c.SIMULMASTER|c.TOURNDIRECTOR;c.PLAYERTYPE=c.HUMAN|c.ENGINE|c.CENTAUR;c.IDLETYPE=c.IDLE|c.NOTIDLE|c.VIDEO|c.DISCONNECTED|c.ENCODING|c.LISTENING;c.PROMINENTTYPE=c.CHAIRMAN|c.TOURNDIRECTOR|c.SIMULMASTER;c.NOGAMETYPE=c.YESGAMES|c.NOGAMES})();
CB.Server.Status=function(){var c=CB.Server.StatusEnum,b=!1,d=function(d){this.flags=d;if(!b){d="Idle Pause Playing Kibitzing Seeking Tactics Chairman".split(" ");for(var c=0;c<d.length;c++){var g=d[c];if(1<g.length){var h="background-image: url( ../../common/media/server/status/"+g+16+".png ) !important;",h=V15&&V15.panelMgr&&V15.panelMgr.viewport&&V15.panelMgr.viewport.rtl?h+"background-repeat:no-repeat; background-position:right center;":h+"background-repeat:no-repeat; background-position:left center;";
CB.CSS.addRules(".stat-"+g,h)}}b=!0}};d.prototype.toString=function(){return CB.Server.StatusEnum.toString(this.flags)};d.prototype.getSortVal=function(){var b=0;if(this.flags&c.GONE)return b;b++;if(this.flags&c.CHAIRMAN)return b;b++;if(this.flags&c.SIMULMASTER)return b;b++;if(this.flags&c.TOURNDIRECTOR)return b;b++;if(this.flags&c.DISCONNECTED)return b;b++;if(this.flags&c.REGISTERED)return b;b++;if(this.flags&c.APPLYING)return b;b++;if(this.flags&c.UNAPPLYING)return b;b++;if(this.flags&c.SOLVER)return b;
b++;if(this.flags&c.PLAYER)return b;b++;if(this.flags&c.WATCHER)return b;b++;if(this.flags&c.SEEKING)return b;b++;if(this.flags&c.YESGAMES)return b;b++;if(this.flags&c.NOGAMES)return b;b++;if(this.flags&c.DGT_BOARD)return b;b++;if(this.flags&c.IDLE)return b;b++;return b};d.prototype.applyChange=function(b){b.isStatusChange()&&(b.status&c.ACTIONTYPE&&(this.flags&=~c.ACTIONTYPE),b.status&c.PLAYERTYPE&&(this.flags&=~c.PLAYERTYPE),b.status&c.IDLETYPE&&(this.flags&=~c.IDLETYPE),b.status&c.NOGAMETYPE&&
(this.flags&=~c.NOGAMETYPE),this.flags|=b.status)};d.prototype.isPlaying=function(){return 0!=(this.flags&c.PLAYER)};d.prototype.getCSSClass=function(){var b="";if(!(this.flags&c.GONE))if(this.flags&c.IDLE)b="stat-Idle";else if(this.flags&c.NOGAMES&&!(this.flags&c.PLAYER))b="stat-Pause";else if(this.flags&c.SEEKING)b="stat-Seeking";else switch(this.flags&c.ACTIONTYPE){case c.PLAYER:b="stat-Playing";break;case c.WATCHER:b="stat-Kibitzing";break;case c.CHAIRMAN:b="stat-Chairman";break;case c.SOLVER:b=
"stat-Tactics"}return b};return d}();"use strict";CB.namespace("CB.Server.ClientChange");CB.Server.ClientChangeEnum={STATUS:1,TEXT:2,VALUE1:4,VALUE2:8,ADDRESS:16,CONNQUAL:32};
CB.Server.ClientChange=function(){var c=CB.Server.ClientChangeEnum,b=function(){};b.prototype.init=function(b){this.reserved=this.connQual=this.flags=0;this.id=b;this.status=this.val2=this.val1=0};b.prototype.fromDataBuf=function(b){this.flags=b.V10();this.connQual=b.V11();this.reserved=b.V11();this.id=b.V10();this.ISFLAG(c.VALUE1)?this.val1=b.V10():this.val1=0;this.ISFLAG(c.VALUE2)?this.val2=b.V10():this.val2=0;this.ISFLAG(c.STATUS)&&(this.status=b.V10());this.ISFLAG(c.TEXT)&&(this.text=b.V6(65))};
b.prototype.Vz=function(b){b.Vx(this.flags);b.Vv(this.connQual||0);b.Vv(this.reserved||0);b.Vx(this.id)||0;this.ISFLAG(c.VALUE1)&&b.writeInt(this.val1);this.ISFLAG(c.VALUE2)&&b.writeInt(this.val2);this.ISFLAG(c.STATUS)&&b.writeInt(this.status);this.ISFLAG(c.TEXT)&&b.V5(this.text)};b.prototype.toString=function(){var b;b="id="+this.id;this.ISFLAG(c.VALUE1)&&(b+=" val1="+this.val1);this.ISFLAG(c.VALUE2)&&(b+=" val2="+this.val2);this.ISFLAG(c.STATUS)&&(b+=" stat="+CB.Server.StatusEnum.toString(this.status));
this.ISFLAG(c.TEXT)&&(b+=" txt="+this.text);return b};b.prototype.setStatusChange=function(b){if("number"!=typeof b)throw Error("CDC.setStatusChange must pass a number");this.flags|=c.STATUS;this.status=b};b.prototype.isStatusChange=function(){return this.ISFLAG(c.STATUS)};b.prototype.isChangedElo=function(){return this.ISFLAG(c.VALUE1)&&this.ISFLAG(c.VALUE2)&&1==this.val1};b.prototype.getChangedElo=function(){return this.isChangedElo()?this.val2&65535:0};b.prototype.ISFLAG=function(b){return 0!==
(this.flags&b)};b.prototype.isSeeking=function(){return 0!=(this.status&CB.Server.StatusEnum.SEEKING)&&this.isStatusChange()};b.prototype.isPlaying=function(){return 0!=(this.status&CB.Server.StatusEnum.PLAYER)&&this.isStatusChange()};b.prototype.setIsPlaying=function(){this.status|=CB.Server.StatusEnum.PLAYER;this.flags|=CB.Server.ClientChangeEnum.STATUS};b.prototype.isRegisteredStatus=function(){return this.isStatusChange&&0!=(this.status&CB.Server.StatusEnum.REGISTERED)};return b}();
CB.UserMsgId={NONE:0,CHALLENGE:1E3,CANCEL_SEEKS:1001,VALIDATE_SEEKS:1002,RESPOND_VALIDATE_SEEKS:1003,REQUEST_ALL_SEEKS:1004,RESPOND_ALL_SEEKS:1005,REQUESTGAMELIST:1100,GAMELIST:1101,ADDGAME:1102,REMOVEGAME:1103,GAMESTATUS:1200,GAME:1201,SESSIONACTION:1202,SETCLOCK:1203,STARTGAME:1204,TIME_PENALTY:1205,RESTARTGAME:1206,RESTARTTOURNGAME:1207,FOLLOW:1208,STOPFOLLOW:1209,FOLLOWEVENT:1210,REQUEST_SELECTED_CLIENTLIST:1211,SELECTED_CLIENTLIST:1212,REQUEST_FRIENDLIST:1213,RESPOND_FRIENDLIST:1214,ADD_REMOVE_FRIEND_FOE:1215,
STARTTOURNAMENTGAME:1216,PLAYEREVALUTION:1250,INFORMALAPPLAUSE:1251,NOTIFY_CLIENT:1260,REQUEST_BESTGAME:1261,RESPOND_BESTGAME:1262,CANCEL_BESTGAME:1263,REQUEST_ELODATA:1270,ELODATA:1271,FORMULA:1272,CONFIRM_REGISTRATION:1273,TEMP_ELO:1274,NEW_ELO:1275,USERTODATABASEID:1276,REQUEST_OPPONENTS:1277,RESPOND_OPPONENTS:1278,GETPICTURE:1280,SETPICTURE:1281,GETSMALLPICTURE:1282,SETSMALLPICTURE:1283,SETGEOPOS:1284,toString:function(c){for(var b in this)if(this[b]==c)return"UserMsg:"+b;return"Unknown UserMsgId: "+
c},toNumString:function(c){return"UserMsgId="+c}};"use strict";CB.namespace("CB.Server.GameStatusChange");
CB.Server.GameStatusEnum={UNDEFINED:-1,BLACKWINS:100,DRAW:101,WHITEWINS:102,ABORT:103,RESIGN:360,TIMEOVERSTEPPED:361,CLAIMFLAG:362,ACCEPT_CLAIMFLAG:363,REJECT_CLAIMFLAG:364,YOURMOVE_REQUEST:365,SIMUL_CLAIMWIN:366,OFFERDRAW:370,ACCEPTDRAW:371,REJECTDRAW:372,RETRACTDRAW:373,OFFERTAKEBACK:374,ACCEPTTAKEBACK:375,REJECTTAKEBACK:376,OFFERABORT:380,ACCEPTABORT:381,REJECTABORT:382,CLAIMWIN_ON_DISCONNECT:383,SERVER_FORCES_ABORT:384,EARLY_ABORT:385,ALLOW_ABORT:386,OFFERADJOURN:388,ACCEPTADJOURN:389,REJECTADJOURN:390,
RETRACTADJOURN:391,QUERYBEGIN:500,BEGINOK:501,QUERYRESTART:502,RESTARTOK:503,TRANSMISSION_READY:504,WINDOWCLOSED:505,BEGINANALYSIS:506,GAMERESTARTED:507,LIVETIME:508,MINRANKCHAT:509,TWOMOVESDONE:510,QUERYBEGINBLACK:511,BEGINOKBLACK:512,FORCERELOAD:513,CHANGEGAME_TO_ANALYSIS:514,ADD_WATCHER:600,REMOVE_WATCHER:601,REQUEST_WATCHERLIST:602,REQUEST_GAMEUPDATE:603,REQUESTGAME_ADDWATCHER:604,WATCH_NUM:605,INVITE_WATCHER:620,BLOCK_AFTER_ILLEGAL:621,RECEIVED_GAME_AFTER_ILLEGAL:622,STREAMINGON:650,STREAMINGOFF:651,
BLOCK_ENGINES:670,ALLOW_ENGINES:671,MOVE_RECEIPT:672,toString:function(c){for(var b in this)if(this[b]==c)return"GChange: "+b;return"Unknown GameStatChange: "+c}};var gsEnum=CB.Server.GameStatusEnum;
CB.Server.GameStatusChange=function(){var c=function(b,d,c){this.type=b||CB.Server.GameStatusEnum.UNDEFINED;this.idGame=d||0;this.idPlayer=c||0;this.num=this.flags=0};c.prototype.init=function(b,d){this.idGame=b;this.idPlayer=d;this.num=this.flags=0};c.prototype.fromDataBuf=function(b){this.idGame=b.readInt();this.type=b.readInt();this.idPlayer=b.readInt();this.num=b.readInt();this.flags=b.readShort();this.reserved=b.readShort()};c.prototype.Vz=function(b){b.writeInt(this.idGame);b.writeInt(this.type);
b.writeInt(this.idPlayer);b.writeInt(this.num);b.writeShort(this.flags);b.writeShort(0)};c.prototype.isResult=function(){return 0<=this.type&&this.type<=CB.Server.GameStatusEnum.ABORT};c.prototype.isWatcherChange=function(){return this.type==CB.Server.GameStatusEnum.ADD_WATCHER||this.type==CB.Server.GameStatusEnum.REQUESTGAME_ADDWATCHER||this.type==CB.Server.GameStatusEnum.REMOVE_WATCHER};c.prototype.isResult=function(){return this.type==CB.Server.GameStatusEnum.BLACKWINS||this.type==CB.Server.GameStatusEnum.WHITEWINS||
this.type==CB.Server.GameStatusEnum.DRAW};c.prototype.getWatchersInc=function(){return this.type==CB.Server.GameStatusEnum.ADD_WATCHER||this.type==CB.Server.GameStatusEnum.REQUESTGAME_ADDWATCHER?1:this.type==CB.Server.GameStatusEnum.REMOVE_WATCHER?-1:0};c.prototype.getNum=function(){return this.num};c.prototype.toString=function(){return CB.Server.GameStatusEnum.toString(this.type)+": "+this.idGame+", player="+this.idPlayer+", flags="+this.flags};return c}();"use strict";CB.namespace("CB.Server.GameItemTypeBits");
CB.Server.GameItemType={UNKNOWN:0,GAME:1,BROADCAST:2,ANALYSIS:4,SETUP:8,ABORTED:16,RATED:32,BULLET:64,BLITZ:128,SLOW:256,ENGINE:512,CENTAUR:1024,HTTP_STREAM:2048,STREAM:4096,IMPORTANT:8192,PREMIUM:16384,PRIVATE:32768,TOP_GAME:65536};CB.Server.GameItemType.SORTMASK=CB.Server.GameItemType.GAME|CB.Server.GameItemType.BROADCAST|CB.Server.GameItemType.ANALYSIS|CB.Server.GameItemType.RATED|CB.Server.GameItemType.IMPORTANT|CB.Server.GameItemType.STREAM;
CB.Server.GameItemType.COMPUTER=CB.Server.GameItemType.ENGINE|CB.Server.GameItemType.CENTAUR;CB.namespace("CB.Server.GameItem");
CB.Server.GameItem=function(){var c=function(){};c.prototype.fromDataBuf=function(b){this.white=b.V6(100);this.type=b.V11();this.black=b.V6(100);this.id=b.V10();this.idGroup=b.V10();this.result=b.V10();this.timeStart=b.V10();this.idWhite=b.V10();this.idBlack=b.V10();this.idChallenger=b.readInt();this.flags=b.readInt();this.tourn=b.V6(100);this.eloWhite=b.V11()&8191;this.eloBlack=b.V11()&8191;this.round1=b.readUint8();this.round2=b.readUint8();this.kibitzCosts=b.V11();b.beginSizedRead();var d=b.V10();
this.watchers=d&65535;this.moveLen=d>>22&511;this.eco=b.Vu();b.endSizedRead();this.clock=new CB.ClockParams;this.clock.fromDataBuf(b);this.flags&CB.Server.SessionBits.WITHCLOCK||delete this.clock};c.prototype.toString=function(){return this.white+"-"+this.black+", "+this.tourn+" ("+this.round1+")"};c.prototype.getTitle=function(){return this.white?this.white+" - ...":""};c.prototype.applyGameChange=function(b){b.isResult()&&(this.result=b.type-100);b.isWatcherChange()&&(this.watchers+=b.getWatchersInc())};
c.prototype.isBlitz=function(){return 0!=(this.type&CB.Server.GameItemType.BLITZ)};c.prototype.isBullet=function(){return 0!=(this.type&CB.Server.GameItemType.BULLET)};c.prototype.isImportant=function(){return 0!=(this.type&CB.Server.GameItemType.IMPORTANT)};c.prototype.isAnalysis=function(){return 0!=(this.type&CB.Server.GameItemType.ANALYSIS)};c.prototype.isBroadcast=function(){return 0!=(this.type&CB.Server.GameItemType.BROADCAST)};c.prototype.isStream=function(){return 0!=(this.type&CB.Server.GameItemType.STREAM)};
c.prototype.isHTTPStream=function(){return 0!=(this.type&CB.Server.GameItemType.HTTP_STREAM)};c.prototype.isPrivate=function(){return 0!=(this.flags&CB.Server.SessionBits.PRIVATE)};c.prototype.isPremium=function(){return 0!=(this.flags&CB.Server.GameItemType.PREMIUM)};c.prototype.mightBeEngineGame=function(){var b=(this.white.match(/\d/g)||[]).length,d=(this.black.match(/\d/g)||[]).length,c=(this.black.match(/\./g)||[]).length,f=(this.black.match(/\./g)||[]).length,g=0<(this.white.match(/64/g)||[]).length&&
0<(this.white.match(/bit/gi)||[]).length,h=0<(this.black.match(/64/g)||[]).length&&0<(this.black.match(/bit/gi)||[]).length;return 0<c&&0<f&&1<b&&1<d||g||h};c.prototype.getWatcherSortVal=function(){return CB.GameResultEnum.isFinished(this.result)?this.watchers/2:this.watchers};c.prototype.shouldRequestImmediatelyInLive=function(){return 2<this.result&&(300<this.watchers||2500<this.eloWhite&&2500<this.eloBlack)||2680<this.eloWhite||2680<this.eloBlack};return c}();
CB.Server.GameItem.getResultString=function(c,b){switch(c){case CB.GameResultEnum.GAME_UNFINISHED:case CB.GameResultEnum.WHITE_WINS:case CB.GameResultEnum.BLACK_WINS:case CB.GameResultEnum.DRAW:return CB.GameResultEnum.toString(c);case CB.GameResultEnum.UNDEFINED_RESULT:return b&(CB.Server.GameItemType.ANALYSIS|CB.Server.GameItemType.BROADCAST)?lm.FINISHED:lm.ABORTED}};
CB.Server.GameItemList=function(){function c(b,c,f){for(var g=0;g<b.length;g++)if(void 0===b[g].watchers||c.eloWhite>b[g].eloWhite){b.splice(g,0,c);b.length>f&&b.pop();return}b.length<f&&b.push(c)}var b=function(b){this.games=b?b:[]};b.prototype.fromDataBuf=function(b){for(var c=b.V10(),f=0;f<c;f++){var g=new CB.Server.GameItem;g.fromDataBuf(b);this.games.push(g)}};b.prototype.getIdGroup=function(){if(this.games.length)return this.games[0].idGroup};b.prototype.getAutoWatchByKibitzers=function(b){function c(b,
d,e){if(d){for(var f=0;f<b.length;f++)if(void 0===b[f].watchers||d.getWatcherSortVal()>b[f].getWatcherSortVal()){b.splice(f,0,d);b.length>e&&b.pop();return}b.length<e&&b.push(d)}}for(var f=[],g=0;g<this.games.length;g++)!(f.length<b||this.games[g].isImportant()||f.length&&this.games[g].watchers>f[f.length-1].watchers)||this.games[g].isStream()||this.games[g].isAnalysis()||this.games[g].mightBeEngineGame()||CB.GameResultEnum.isFinished(this.games[g].result)&&!this.games[g].isBroadcast()||!this.games[g].isBlitz()&&
!this.games[g].isBroadcast()||c(f,this.games[g],b);f.forEach(function(b,d,c){CB.LOG(d+":"+b+" kibitzers="+b.watchers)});return f};b.prototype.getAutoWatchByElo=function(b){for(var e=[],f=0;f<this.games.length;f++)!(e.length<b||this.games[f].isImportant()||e.length&&this.games[f].eloWhite>e[e.length-1].eloWhite)||this.games[f].isStream()||this.games[f].isAnalysis()||CB.GameResultEnum.isFinished(this.games[f].result)&&!this.games[f].isBroadcast()||!this.games[f].isBlitz()&&!this.games[f].isBroadcast()||
c(e,this.games[f],b);e.forEach(function(b,d,c){CB.LOG(d+":"+b+" Elo="+b.eloWhite)});return e};b.prototype.getAutoWatchByEloRunning=function(b,e){for(var f=[],g=0;g<this.games.length;g++)(f.length<b||this.games[g].isImportant()||f.length&&this.games[g].eloWhite>f[f.length-1].eloWhite)&&!this.games[g].isStream()&&!this.games[g].isAnalysis()&&!CB.GameResultEnum.isFinished(this.games[g].result)&&this.games[g].isBroadcast()&&this.games[g].watchers>e&&c(f,this.games[g],b);f.forEach(function(b,d,c){CB.LOG(d+
":"+b+" Elo="+b.eloWhite)});return f};b.prototype.getAutoWatchByMedia=function(b,c){for(var f=[],g=0;g<this.games.length;g++)if((this.games[g].isStream()||this.games[g].isHTTPStream())&&this.games[g].isBroadcast()&&-1==this.games[g].result){var h=!this.games[g].isPrivate();h&&(this.games[g].isPremium()&&(h=!1,c&&(h=!0)),h&&f.push(this.games[g]))}f.forEach(function(b,d,c){CB.LOG(d+":"+b+" kibitzers="+b.watchers)});g=[];for(h=0;h<f.length;h++){g.push(f[h]);var l=new CB.BroadcastPair(g[h].id,g[h].white+
" - "+g[h].black,g[h].tourn);b.push(l)}return g};b.prototype.isStream=function(b){for(b=0;b<this.games.length;b++)if(this.games[b].isStream())return!0;return!1};b.prototype.getFiltered=function(b){for(var c=[],f=0;f<this.games.length;f++)b(this.games[f])&&c.push(this.games[f]);return c.length?new CB.Server.GameItemList(c):new CB.Server.GameItemList(this.getAutoWatchByKibitzers(4))};return b}();"use strict";CB.namespace("CB.Server.GameData");
CB.Server.GameData=function(){var c=function(){};c.prototype.fromDataBuf=function(b){this.idGame=b.readInt();this.type=b.readInt();this.reserved=b.readInt();this.game=new CB.Game;this.game.fromDataBuf(b);b.beginSizedRead();this.strBanner=b.V6(255);this.strURL=b.V6(255);this.strWrapUrl=b.V6(255);b.endSizedRead()};c.prototype.Vz=function(b){b.writeInt(this.idGame)};c.prototype.toString=function(){return"GameData: "+this.idGame+", type="+this.type.toString(16)+", "+this.game.hdr.white+"-"+this.game.hdr.black};
c.prototype.isStream=function(){return 0!=(this.type&CB.Server.GameItemType.STREAM)};c.prototype.isBroadcast=function(){return 0!=(this.type&CB.Server.GameItemType.BROADCAST)};c.prototype.isHTTPStream=function(){return 0!=(this.type&CB.Server.GameItemType.HTTP_STREAM)};c.prototype.isPremiumOnly=function(){return 0!=(this.type&CB.Server.GameItemType.PREMIUM)};return c}();"use strict";
CB.MoveData=function(){var c=function(b,d,c,f){b&&(this.move=[b.from,b.to,b.prom&7],this.moveNo=d,this.centiSecs=c,this.idGame=f);this.flags=0};c.prototype.toString=function(){return CB.Square.toString(this.move[0])+"-"+CB.Square.toString(this.move[1])};c.prototype.fromDataBuf=function(b){this.idGame=b.V10();this.move=b.readByteArray(3);this.centiSecs=b.V10();this.moveNo=b.V11();this.flags=b.V11();this.eval=b.V10()};c.prototype.Vz=function(b){b.Vx(this.idGame);b.writeByteArray(this.move,3);b.Vx(this.centiSecs);
b.Vv(this.moveNo);b.Vv(this.flags||0);b.Vx(this.eval||0)};return c}();"use strict";CB.SetClockData=function(){var c=function(){};c.prototype.fromDataBuf=function(b){this.whiteCentiSecs=b.readInt();this.blackCentiSecs=b.readInt();this.tickCount=b.readInt();this.flags=b.readInt()};c.prototype.getWhiteTime=function(){return this.whiteCentiSecs};c.prototype.getBlackTime=function(){return this.blackCentiSecs};c.prototype.isBlack=function(){return 0!=(this.flags&1)};return c}();"use strict";CB.namespace("CB.Server.GameSession");
CB.Server.SessionBits={RATED:1,WITHCLOCK:2,ALLOWTRANSMITGAME:4,TAKEBACK:8,POOL_BLITZ:16,ANALYSIS:32,RESUME:64,IN_TOURNAMENT:128,IN_SIMUL:256,WITH_STARTMOVES:512,PRIVATE:1024,WITHSTREAMING:2048,WITH_MANUALCLOCK:4096,DUCATSSTAKE:8192,WHITE_ENGINE:16384,BLACK_ENGINE:32768,WHITE_CENTAUR:65536,BLACK_CENTAUR:131072,WHITE_GM:262144,BLACK_GM:524288,PREMIUM:1048576,AUTOSTARTENCODER:2097152,BLOCK_ENGINES:4194304,MATCH:8388608,SLAVE_RESTART:16777216,HAS_BETS:33554432,DISABLE_BETS:67108864,PREMIUM_MOVES:134217728,
WHITE_POOL_BLITZ:268435456,BLACK_POOL_BLITZ:536870912};
CB.Server.GameSession=function(){var c=1,b=function(b,e,f){this.lobby=b;this.idGame=e;this.viewLink=f;this.requestedGame=!1;this.nErrorCount=this.nGameRequests=0;this.isFirstRequest=!0;this.uniqueId=c++;this.receivingMoves=!0;this.bufferedActions=[];this.delayedSessionActions=[];this.nGameActionsDelay=0};b.prototype.recycle=function(){CB.LOG("Release Session:"+this.idGame,"LogBold");this.gameKernel&&(this.gameKernel.animateBoard=!1,this.gameKernel.destroy(),this.gameKernel=null);this.nErrorCount=
this.nGameRequests=0;this.receivingMoves=this.isFirstRequest=!0;this.board&&(this.board.allowInput=!0)};b.prototype.onRecycle=function(){this.recycle();if(this.board)this.board.onRecycle()};b.prototype.isFinished=function(){return this.gameKernel.isFinished()};b.prototype.toggleReceivingMoves=function(){this.receivingMoves=!this.receivingMoves;this.setReceivingMoves(this.receivingMoves);this.nGameRequests=0};b.prototype.setReceivingMoves=function(b,c){if(this.receivingMoves=b)this.lobby.watchSessions.requestGame(this.idGame),
this.requestedGame=!0;this.board.allowInput=!0;V15.commands.fireChecked(CB.LobbyIds.RECEIVING_MOVES,this.receivingMoves);c||this.gameKernel&&(b?this.gameKernel.Vk.startClock():this.gameKernel.Vk.stopClock())};b.prototype.createBoard3D=function(b){this.board=new CB.BoardControl3D(b,100,100,"FritzBoard");this.requestGame();this.requestedGame=!0;this.isFirstRequest&&this.lobby.watchSessions.addMeAsWatcher(this.idGame);return this.board};b.prototype.createBoard=function(b){this.board=new CB.BoardControl(b,
100,100,this.idGame);V15.isBoardOnlyApp()?this.board.animSteps={forMove:2,forPosition:2}:this.board.animSteps={forMove:2,forPosition:3};CB.System.isMobile()&&(this.board.animSteps={forMove:.6,forPosition:.5});this.board.allowInput=!0;this.idHandler=this.board.onReadyHandlers.add(this.onBoardReady.bind(this));return this.board};b.prototype.onBoardReady=function(){this.requestedGame||(CB.LOG("Board Ready, requesting Game"),this.requestGame(),this.requestedGame=!0,this.board.onReadyHandlers.remove(this.idHandler),
this.isFirstRequest&&this.lobby.watchSessions.addMeAsWatcher(this.idGame))};b.prototype.onGameData=function(b){try{this.isInGameRequest=!1;this.tickGameReceived=new CB.Tick;CB.LOG("Session "+this.idGame+" receives game: "+b,"LogGreen");this.gameKernel?this.receivingMoves&&(this.gameKernel.game.assign(b.game),this.gameKernel.game.gotoIndex(b.game.getMoveIndex())):(this.gameKernel=new CB.GameKernel(this.viewLink,b.game),this.gameKernel.setPlayingMode(new CB.AnalysisMode(this.gameKernel)),this.gameKernel.setBoardWin(this.board),
this.gameKernel.Vk.createGUIElements(this.board),this.gameKernel.animateBoard=!1,this.board.singleClickDisabled=!0,this.modifyPlayingMode());this.clock?this.gameKernel.Vk.setChessClock(this.clock):this.gameKernel.Vk.setChessClock(!1);this.board.debugName=b.game.hdr.getStrPlayers();this.receivingMoves&&(this.moveIndexOnServer=this.gameKernel.game.getMoveIndex(),this.executeBufferedActions());this.board.cbcanvas?this.board.setTitleText(this.gameKernel.game.hdr.getStrPlayers(this.board.nSqPix>this.board.cbcanvas.zoomToPix(46))):
this.board.setTitleText(this.gameKernel.game.hdr.getStrPlayers(20));this.bufferedActions=[];this.nErrorCount=0;this.gameKernel.animateBoard="undefined"!==typeof Ext?V15.animatedBoard()||!Ext.isIE:V15.animatedBoard();this.strBanner=b.strBanner;if((this.strURL=b.strURL)&&(V15.Vf.shouldDisplayBoardUrls()||V15.isBoardOnlyApp())&&V15.config.versionChessBaseCom){var c=this.strURL,f="?";-1!=c.search(RegExp("\\?","g"))&&(f="&");c+=f+"ref=link_from_playchess_com";this.board.destroyBottomWin();if(V15.isBoardOnlyApp()){var g=
{urlRight:c,linkTextRight:CB.strUtil.shortenURL(this.strURL),linkTextLeft:lm.FULL_VIEW,urlLeft:"http://live.chessbase.com"};this.board.bottomWin=new CB.BoardDoubleURL(g,{hScale:24,hMax:18,spacing:0,rightAlign:!0})}else this.board.bottomWin=new CB.BoardURL({linkText:CB.strUtil.shortenURL(this.strURL),url:c},{hScale:20,hMax:18,spacing:1});this.board.resizeTimer.runOnce(500)}(b.isStream()||b.isHTTPStream())&&this.setReceivingMoves(!1);b.isStream()||b.isHTTPStream()||b.game.hdr.getCBResult().isFinished()&&
this.setReceivingMoves(!1)}catch(h){CB.LogException("GSess::onGameData:",h)}};b.prototype.modifyPlayingMode=function(){this.gameKernel.Vk.fnAcceptMove=function(){this.receivingMoves&&(this.analysisAdded=!0);return!0}.bind(this);this.gameKernel.Vk.fnAfterMove=function(b){this.gameKernel.game.getMoveIndex()==this.moveIndexOnServer+1&&this.gameKernel.game.isOnMainLine()&&this.gameKernel.game.setAnno(CB.AnnoType.PRETEXT,new CB.TextAnno("Analysis:"));return!0}.bind(this)};b.prototype.getTitle=function(){if(this.gameKernel)return this.gameKernel.game.hdr.getStrPlayers(!1)};
b.prototype.executeBufferedActions=function(){for(var b=0;b<this.bufferedActions.length;b++)CB.LOG("ExecBuffered SessionAction","LogBold"),this.onSessionAction(this.bufferedActions[b],!0)};b.prototype.onSessionAction=function(b,c){if(this.receivingMoves)if(0<this.nGameActionsDelay)b.timeStamp=this.nGameActionsDelay,b.session=this,this.delayedSessionActions.push(b);else this.onProcessSessionAction(b,c);else if(b.gameAction.isMove()){var f=b.gameAction.moveData.toString();this.lobby.statusMsg("Unplugged: "+
this.gameKernel.game.hdr.getStrPlayers()+" ("+Math.floor(b.gameAction.moveData.moveNo/2+1)+"."+f+")")}};b.prototype.onProcessSessionAction=function(b,c){if(this.isInGameRequest)this.bufferedActions.push(b);else{if(!this.gameKernel)return;this.moveIndexOnServer!=this.gameKernel.game.getMoveIndex()&&this.gameKernel.game.gotoIndex(this.moveIndexOnServer);if(b.gameAction.execute(this.gameKernel.game,b.controlMove)){if(b.gameAction.isMove()||b.gameAction.isGame())b.gameAction.isMove()&&(this.gameKernel.Vk.updateClockFromGame(),
this.gameKernel.game.deleteAnno(CB.AnnoType.PRETEXT)),this.gameKernel.markLastMove(!1,!1);0<this.nErrorCount&&CB.LOG("Game in Legal Sync: "+this.gameKernel.game.hdr,"LogBold");this.nErrorCount=0;this.moveIndexOnServer=this.gameKernel.game.getMoveIndex();if(this.analysisAdded&&this.gameKernel.game.promoteLine()){var f=this.gameKernel.game.getMoveIndex();this.gameKernel.game.unAnnotate();this.gameKernel.game.gotoIndex(f);this.moveIndexOnServer=f}}else b.gameAction.isMove()&&!b.isAnEarlierMove(this.gameKernel.game)?
(this.nErrorCount+=1,CB.LOG(this.board.debugName+"-Illegal: "+b.gameAction+", "+this.nErrorCount,"LogError"),c||this.isFinished()||!(4<this.nErrorCount||6E3<this.tickGameReceived.getExpired())||(this.nGameRequests++,5>this.nGameRequests?(CB.LOG("Illegal Actions, refresh: "+this.gameKernel.game.hdr+", "+this.nGameRequests,"LogError"),this.requestGame()):CB.LOG("Too many illegal moves: "+this.gameKernel.game.hdr,"LogError"))):b.gameAction.isMove()?CB.LOG("Received an earlier move: "+this.gameKernel.game.hdr,
"LogGreen"):CB.LOG("Non move Session Action: "+b.gameAction,"LogGreen")}b.gameAction.changesMoves()&&(this.analysisAdded=!1)};b.prototype.requestGame=function(){this.isInGameRequest=!0;this.lobby.watchSessions.requestGame(this.idGame)};b.prototype.onGameStatusChange=function(b){switch(b.type){default:CB.LOG("Session.onGSC: "+b);break;case gsEnum.ADD_WATCHER:case gsEnum.REMOVE_WATCHER:case gsEnum.REQUESTGAME_ADDWATCHER:break;case gsEnum.WHITEWINS:this.finishGameWithResult(CB.GameResultEnum.WHITE_WINS);
break;case gsEnum.DRAW:this.finishGameWithResult(CB.GameResultEnum.DRAW);break;case gsEnum.BLACKWINS:this.finishGameWithResult(CB.GameResultEnum.BLACK_WINS);break;case gsEnum.TIMEOVERSTEPPED:CB.LOG("TIMEOVERSTEPPED","LogBold");if(this.gameKernel)this.gameKernel.Vk.onTimeOverstepped(this.idWhite!==b.idPlayer);this.idWhite==b.idPlayer?CB.LOG("Time - White"):CB.LOG("Time - Black")}};b.prototype.finishGameWithResult=function(b){this.isFinished()||this.gameKernel.setResult(b)};b.prototype.isFinished=function(){return!this.gameKernel||
this.gameKernel.game.hdr.getCBResult().isFinished()};b.prototype.setClock=function(b){this.gameKernel&&this.gameKernel.Vk.setManualClock(b.getWhiteTime(),b.getBlackTime(),b.isBlack())};b.prototype.onReconnect=function(){this.receivingMoves&&(this.setReceivingMoves(!0),this.board&&this.board.addMessage("Reconnected",!0))};b.prototype.onConnBroken=function(){};b.prototype.toString=function(){return this.gameKernel?this.gameKernel.game.hdr.getStrPlayers():this.idGame};b.prototype.delayGameActions=function(b){this.nGameActionsDelay=
b;0<this.nGameActionsDelay&&!this.myTimer&&(this.myTimer=setInterval(this.onBufferedGameActionsHandler.bind(this),1E3))};b.prototype.mustExecute=function(b){return 0<b.timeStamp&&(b.timeStamp--,0==b.timeStamp)?!0:!1};b.prototype.execute=function(b){b.session.onProcessSessionAction(b,!0)};b.prototype.onBufferedGameActionsHandler=function(){this.delayedSessionActions.forEach(function(b){CB.Server.GameSession.prototype.mustExecute(b)&&(CB.Server.GameSession.prototype.execute(b),b.session.gameKernel&&
b.session.gameKernel.game.updateFromExtern())})};return b}();"use strict";
CB.ManualClock=function(){var c=function(b){CB.ManualClock.superClass.call(this,b)};CB.inherit(c,CB.BaseClock);c.prototype.setTime=function(b,d,c){this.stop();b||d?(this.currTime=this.startTime=(new Date).getTime(),0<=b&&(this.whiteTime=b),0<=d&&(this.blackTime=d),0<=this.whiteTime&&(this.isBlack=!1,this.update()),0<=this.blackTime&&(this.isBlack=!0,this.update()),this.isBlack=c,this.clockLink.setToMove(c),this.start()):this.setNoClock()};c.prototype.onResult=function(b){CB.GameResultEnum.isFinished(b)&&
(this.stop(),this.clockLink.showResult(b))};c.prototype.setToMove=function(b){this.isBlack=b;this.update();this.clockLink.setToMove(b);this.clockLink.emphasizeToMove(8E3)};c.prototype.start=function(){this.updateTimer.runPeriodic(1E3);this.clockLink&&(this.clockLink.runningClockId&&this.clockLink.runningClockId!=this.id&&(CBDebug.assert(0),TRACE("Clock Collision!")),this.clockLink.runningClockId=this.id)};c.prototype.stop=function(){this.updateTimer.stop();this.clockLink&&(this.clockLink.runningClockId=
0)};c.prototype.update=function(){var b=((new Date).getTime()-this.startTime+5)/10,d=((new Date).getTime()-this.currTime+5)/10;this.clockLink.showCurrTime(new Date(10*d),this.isBlack);b=this.isBlack?this.blackTime-=b:this.whiteTime-=b;this.startTime=(new Date).getTime();0>b?this.clockLink.showRestTime(-1,this.isBlack):this.clockLink.showRestTime(new Date(10*b),this.isBlack)};return c}();"use strict";
CB.Server.ClockRange=function(){var c=function(b,d){this.nMins=b||0;this.nSecs=d||0};c.prototype.fromDataBuf=function(b){this.nMins=b.readInt();this.nSecs=b.readInt()};c.prototype.Vz=function(b){b.writeInt(this.nMins);b.writeInt(this.nSecs)};c.prototype.toString=function(){return"ClockRange"};return c}();"use strict";
CB.Server.ConnectionQuality=function(){var c=function(b){this.val=b||0};c.prototype.fromDataBuf=function(b){this.val=b.readShort()};c.prototype.Vz=function(b){b.writeShort(this.val)};c.prototype.getPing=function(){return 30*(this.val>>8&255)};c.prototype.getDiscos=function(){return this.val&255};c.prototype.getSortVal=function(){return this.val};c.prototype.toString=function(){return this.getPing()+"ms"};return c}();"use strict";CB.namespace("CB.Server.LiveSession");
CB.Server.LiveSession=function(){var c=1,b=function(b,e,f,g,h){this.lobby=b;this.idGame=g;this.ticket=e;this.requestData=f;this.fnGetBackgroundKernel=this.fnGetKernel=h;this.requestedGame=!1;this.nErrorCount=this.nGameRequests=0;this.isFirstRequest=!0;this.uniqueId=c++;this.receivingMoves=!0;this.bufferedActions=[];this.delayedSessionActions=[];this.nGameActionsDelay=0;this.animatePosChange=!1};b.prototype.getKernel=function(){return this.fnGetKernel()};b.prototype.setToBackgroundKernel=function(){this.fnGetKernel().Vk.deleteClock();
this.fnGetBackgroundKernel().Vk.beforeGameLoad();this.fnGetBackgroundKernel().game.assign(this.fnGetKernel().game);this.fnGetKernel=this.fnGetBackgroundKernel};b.prototype.isFinished=function(){return this.getKernel().isFinished()};b.prototype.toggleReceivingMoves=function(){this.receivingMoves=!this.receivingMoves;this.setReceivingMoves(this.receivingMoves);this.nGameRequests=0};b.prototype.setReceivingMoves=function(b,c){if(this.receivingMoves=b)this.requestGame(this.idGame),this.requestedGame=
!0;V15.commands.fireChecked(CB.LiveCmdIds.RECEIVING_MOVES,this.receivingMoves);c||this.getKernel()&&(b?this.getKernel().Vk.startClock():this.getKernel().Vk.stopClock())};b.prototype.requestGame=function(b){b=new CB.Server.GameStatusChange(CB.Server.GameStatusEnum.REQUEST_GAMEUPDATE,b,this.lobby.getNIdBound());this.sendGameStatusChange(b)};b.prototype.sendGameStatusChange=function(b){var c=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);c.setUserType(CB.UserMsgId.GAMESTATUS);c.getBuf();b.Vz(c.getBuf());
this.lobby.send(c)};b.prototype.onGameData=function(b){try{this.isInGameRequest=!1;this.tickGameReceived=new CB.Tick;CB.LOG("Session "+this.idGame+" receives game: "+b,"LogGreen","live");if(this.receivingMoves){this.getKernel();var c;this.getKernel().boardWin&&void 0!==this.getKernel().boardWin.prepareFullRedraw&&(this.getKernel().boardWin.prepareFullRedraw(),c=this.getKernel().boardWin.shouldAnimatePosChange,this.getKernel().boardWin.shouldAnimatePosChange=function(){return!1});this.animatePosChange=
!1;this.getKernel().Vk.beforeGameLoad();this.getKernel().game.assign(b.game);this.getKernel().game.gotoIndex(b.game.getMoveIndex());this.getKernel().idGame=b.idGame;c&&this.getKernel().boardWin&&(this.getKernel().boardWin.shouldAnimatePosChange=c);this.updateBoardAttributes()}this.receivingMoves&&(this.moveIndexOnServer=this.getKernel().game.getMoveIndex(),this.executeBufferedActions());this.getKernel().markLastMove(!0,!0);this.bufferedActions=[];this.nErrorCount=0;this.animatePosChange=!0}catch(f){CB.LogException("LSess::onGameData:",
f)}};b.prototype.shouldAnimatePosChange=function(){return this.animatePosChange};b.prototype.updateBoardAttributes=function(){var b=this.getKernel().boardWin,c=this.getKernel().game;b&&(b.cbcanvas?b.setTitleText(c.hdr.getStrPlayers(b.nSqPix>b.cbcanvas.zoomToPix(42))):b.setTitleText(c.hdr.getStrPlayers(20)),this.setClock&&this.getKernel().Vk.setManualClock(this.setClock.getWhiteTime(),this.setClock.getBlackTime(),this.getKernel().game.getCurPos().getBTM()))};b.prototype.modifyPlayingMode=function(){this.getKernel().Vk.fnAcceptMove=
function(){this.receivingMoves&&(this.analysisAdded=!0);return!0}.bind(this);this.getKernel().Vk.fnAfterMove=function(b){this.getKernel().game.getMoveIndex()==this.moveIndexOnServer+1&&this.getKernel().game.isOnMainLine()&&this.getKernel().game.setAnno(CB.AnnoType.PRETEXT,new CB.TextAnno("Analysis:"));return!0}.bind(this)};b.prototype.getTitle=function(){if(this.getKernel())return this.getKernel().game.hdr.getStrPlayers(!1)};b.prototype.executeBufferedActions=function(){for(var b=0;b<this.bufferedActions.length;b++)CB.LOG("ExecBuffered SessionAction",
"LogBold","live"),this.onSessionAction(this.bufferedActions[b],!0)};b.prototype.onSessionAction=function(b,c){if(this.receivingMoves)if(0<this.nGameActionsDelay)b.timeStamp=this.nGameActionsDelay,b.session=this,this.delayedSessionActions.push(b);else this.onProcessSessionAction(b,c);else b.gameAction.isMove()&&this.lobby.logIntoChat("Received a move: "+this.getKernel().game.hdr)};b.prototype.onProcessSessionAction=function(b,c){if(this.isInGameRequest)this.bufferedActions.push(b);else{if(!this.getKernel())return;
this.getKernel().game.delayChangedEvents(1E3);var f=this.getKernel().game.getMoveIndex(),g=f<=this.getKernel().game.mainLine.length,h=f!=this.moveIndexOnServer;this.moveIndexOnServer!=this.getKernel().game.getMoveIndex()&&this.getKernel().game.gotoIndex(this.moveIndexOnServer,!0);if(b.gameAction.execute(this.getKernel().game,b.controlMove)){if(b.gameAction.isMove()||b.gameAction.isGame())b.gameAction.isMove()&&(this.getKernel().Vk.updateClockFromGame(),this.getKernel().game.deleteAnno(CB.AnnoType.PRETEXT),
g||f++),this.getKernel().markLastMove(!0,!0);0<this.nErrorCount&&CB.LOG("Game in Legal Sync: "+this.getKernel().game.hdr,"LogBold");this.nErrorCount=0;this.moveIndexOnServer=this.getKernel().game.getMoveIndex();h&&this.getKernel().game.gotoIndex(f,!0);this.analysisAdded&&this.getKernel().game.promoteLine()&&(f=this.getKernel().game.getMoveIndex(),this.getKernel().game.unAnnotate(),this.getKernel().game.gotoIndex(f),this.moveIndexOnServer=f)}else b.gameAction.isMove()&&!b.isAnEarlierMove(this.getKernel().game)?
(this.nErrorCount+=1,CB.LOG("Illegal: "+b.gameAction+", "+this.nErrorCount,"LogError"),c||this.isFinished()||!(4<this.nErrorCount||this.tickGameReceived&&6E3<this.tickGameReceived.getExpired())||(this.nGameRequests++,5>this.nGameRequests?(CB.LOG("Illegal Actions, refresh: "+this.getKernel().game.hdr+", "+this.nGameRequests,"LogError"),this.requestGame()):CB.LOG("Too many illegal moves: "+this.getKernel().game.hdr,"LogError"))):b.gameAction.isMove()?CB.LOG("Received an earlier move: "+this.getKernel().game.hdr,
"LogGreen"):CB.LOG("Non move Session Action: "+b.gameAction,"LogGreen");this.getKernel().game.continueChangedEvents()}b.gameAction.changesMoves()&&(this.analysisAdded=!1)};b.prototype.requestGame=function(){this.isInGameRequest=!0;this.lobby.requestGame(this.idGame)};b.prototype.onGameStatusChange=function(b){switch(b.type){default:CB.LOG("Session.onGSC: "+b);break;case gsEnum.ADD_WATCHER:case gsEnum.REMOVE_WATCHER:case gsEnum.REQUESTGAME_ADDWATCHER:break;case gsEnum.WHITEWINS:this.finishGameWithResult(CB.GameResultEnum.WHITE_WINS);
break;case gsEnum.DRAW:this.finishGameWithResult(CB.GameResultEnum.DRAW);break;case gsEnum.BLACKWINS:this.finishGameWithResult(CB.GameResultEnum.BLACK_WINS);break;case gsEnum.TIMEOVERSTEPPED:CB.LOG("TIMEOVERSTEPPED","LogBold");if(this.getKernel())this.getKernel().Vk.onTimeOverstepped(this.idWhite!==b.idPlayer);this.idWhite==b.idPlayer?CB.LOG("Time - White"):CB.LOG("Time - Black")}};b.prototype.finishGameWithResult=function(b){this.isFinished()||this.getKernel().setResult(b)};b.prototype.isFinished=
function(){return!this.getKernel()||this.getKernel().game.hdr.getCBResult().isFinished()};b.prototype.onSetClock=function(b){this.setClock=b;this.getKernel()&&this.getKernel().Vk.setManualClock(b.getWhiteTime(),b.getBlackTime(),b.isBlack())};b.prototype.onReconnect=function(){this.receivingMoves&&this.setReceivingMoves(!0)};b.prototype.onConnBroken=function(){};b.prototype.toString=function(){return this.getKernel()?this.getKernel().game.hdr.getStrPlayers():this.idGame};b.prototype.delayGameActions=
function(b){this.nGameActionsDelay=b;0<this.nGameActionsDelay&&!this.myTimer&&(this.myTimer=setInterval(this.onBufferedGameActionsHandler.bind(this),1E3))};b.prototype.mustExecute=function(b){return 0<b.timeStamp&&(b.timeStamp--,0==b.timeStamp)?!0:!1};b.prototype.execute=function(b){b.session.onProcessSessionAction(b,!0)};b.prototype.onBufferedGameActionsHandler=function(){this.delayedSessionActions.forEach(function(b){CB.Server.LiveSession.prototype.mustExecute(b)&&(CB.Server.LiveSession.prototype.execute(b),
b.session.getKernel()&&b.session.getKernel().game.updateFromExtern())})};return b}();"use strict";CB.namespace("CB.Server.LiveGameList");
CB.Server.LiveGameList=function(){var c=function(b,d,c){this.lobby=b;this.ticket=d;this.requestData=c;this.sessions={};this.kernels={}};c.prototype.onGameItemList=function(b){this.gameItemList=b;this.requestData.onList(b)};c.prototype.addSession=function(b,d,c,f){if(this.sessions[b])return!1;var g=new CB.GameKernel;g.setPlayingMode(new CB.AnalysisMode(g));this.kernels[b]=g;g.enableAudio(!1);var g=new CB.Server.LiveSession(this.lobby,this.ticket,this.requestData,b,function(){return this.kernels[b]}.bind(this)),
h=this.getGameItem(b);h&&(g.clock=h.clock);g.fnOnMove=d;g.fnOnRecentAnno=c;g.fnOnGameData=f;this.sessions[b]=g;return!0};c.prototype.getGameItem=function(b){if(this.gameItemList)for(var d=0;d<this.gameItemList.games.length;d++)if(this.gameItemList.games[d].id==b)return this.gameItemList.games[d]};c.prototype.onInitKibitzing=function(b,d,c){if(this.kernels[b]&&(c&&this.kernels[c]&&this.sessions[c].setToBackgroundKernel(),d)){c=this.sessions[b];var f;d().boardWin&&void 0!==d().boardWin.prepareFullRedraw&&
(d().boardWin.prepareFullRedraw(),f=d().boardWin.shouldAnimatePosChange,d().boardWin.shouldAnimatePosChange=function(){return!1});d().Vk.beforeGameLoad();d().game.assign(this.kernels[b].game);d().idGame=b;d().markLastMove(!0,!0);f&&(d().boardWin.shouldAnimatePosChange=f);c.fnGetKernel=d;c.updateBoardAttributes()}};c.prototype.setSessionToBackground=function(b){b&&this.sessions[b]&&this.sessions[b].setToBackgroundKernel()};c.prototype.notifySessionSwap=function(b,d){if(this.sessions[b]&&this.sessions[d]){var c=
this.sessions[d].fnGetKernel;this.sessions[d].fnGetKernel=this.sessions[b].fnGetKernel;this.sessions[b].fnGetKernel=c;this.sessions[b].updateBoardAttributes();this.sessions[d].updateBoardAttributes()}};c.prototype.onGameData=function(b){this.sessions[b.idGame]&&(this.sessions[b.idGame].onGameData(b),b.idGame==this.currGameId&&this.sessions[b.idGame].fnGetKernel().markLastMove(!0,!0),this.sessions[b.idGame].fnOnMove&&this.sessions[b.idGame].fnOnMove(b.idGame),this.sessions[b.idGame].fnOnGameData&&
this.sessions[b.idGame].fnOnGameData())};c.prototype.onSessionAction=function(b){var d=b.idGame;this.sessions[d]&&(this.sessions[d].onSessionAction(b),this.sessions[d].fnOnMove&&this.sessions[d].fnOnMove(d,b))};c.prototype.onRecentAnno=function(b){this.sessions[b]&&this.sessions[b].fnOnRecentAnno&&this.sessions[b].fnOnRecentAnno(b)};c.prototype.onSetClock=function(b,d){if(this.sessions[d])this.sessions[d].onSetClock(b)};c.prototype.getPgn=function(){var b="",d;for(d in this.kernels)this.kernels[d].game&&
this.kernels[d].game.getMoves().length&&(b+=CB.PGNWriter.toPGN(this.kernels[d].game));return b};return c}();"use strict";CB.namespace("CB.Server.LiveManager");
CB.LiveMsgId={NONE:0,START_KIBITZING:801,START_KIBITZING_GAMEID:802,REQUEST_LISTS:803,RESPOND_LISTS:804,ADD_GAME:805,RECENT_ANNO:806,FINISH_KIBITZING:807,FINISH_KIBITZING_GAMEID:808,LIVE_CHAT:820,REQUEST_CHAT_LOG:821,RESPOND_CHAT_LOG:822,RESPOND_GAMEDATA:17,SESSIONACTION:200,GAMESTATUS_CHANGE:400,SETCLOCK:21,toNumString:function(c){return"LiveMsgId="+c},toString:function(c){for(var b in this)if(this[b]==c)return b;return"Unknown LiveMsgId: "+c}};
CB.LiveError={NONE:0,toString:function(c){switch(c){default:return"Msg="+c;case NONE:return"None"}}};CB.LiveCmdIds={NONE:0,PING_SERVER:1E3,RECEIVING_MOVES:2E3,toNumString:function(c){return"LiveCmdId="+c}};
CB.Server.LiveManager=function(){var c=function(b){this.callBacks=b;this.commandHandlerId=V15.commands.registerCommandHandler(this);this.pingServerPeriodMS=2E4;this.waitingTimer=new CB.Timer};c.prototype.getName=function(){return"Live"};CB.inherit(c,CB.Server.Connector);c.prototype.createLobby=function(b,d,c,h,l){V15.panelMgr.showMessage(lm.CONNECTING);this.create(b,d,c,h,"")};c.prototype.onChangeLogin=function(){this.fireOnChangeLogin()};c.prototype.signalOnConnect=function(){};c.prototype.onSwitchConn=
function(b){};c.prototype.requestLiveGames=function(b){};c.prototype.onIdReceived=function(b){var d=String.formatEx(lm.CONNECTED_TO_SERVER,this.getName());this.logIntoChat(d,"LogGreen","conn");V15.panelMgr.showMessage(d);this.boundLoginOk=!0;this.loginMode!=CB.LoginMode.GUEST?(b.strUserId&&(V15.Vf.userName=CB.strUtil.decodeUTF8(b.strUserId),this.user=CB.strUtil.decodeUTF8(b.strUserId),this.utf8User=b.strUserId,b.strToken&&(V15.Vf.loginToken=b.strToken,CB.DOM.setCookie("AccountMode",CB.LoginMode.NORMAL),
V15.Vf.rememberLoginToken())),document.title="Live Chess For "+this.user,V15.setLoggedIn(!0)):(this.user="Guest"+this.getNId(),this.utf8User="Guest"+this.getNId());V15.idleFunc=this.onIdle.bind(this);V15.notIdleFunc=this.onIdle.bind(this);this.initGameKibitzing();this.initListKibitzing()};c.prototype.initGameKibitzing=function(){if(this.boundLoginOk&&this.sessions&&this.sessions.length){var b=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);b.setUserType(CB.LiveMsgId.START_KIBITZING);var d=b.getBuf();
d.writeInt(this.sessions.length);for(var c=0;c<this.sessions.length;c++)this.requestDataToBuf(this.sessions[c].requestData,d),d.writeInt(this.sessions[c].ticket),d.V13(!1),d.V13(this.sessions[c].requestData.highestRoundOnly),this.requestDataToBuf2(this.sessions[c].requestData,d),this.sessions[c].requested=!0;b.address(this.getNId(),CB.ConnectId.SERVER);this.send(b)}};c.prototype.requestLiveLists=function(b){this.requestLists=b;this.liveGameLists=[];for(var d=0;d<b.length;d++){var c=new CB.Server.LiveGameList(this,
b[d].ticket,b[d].requestData);this.liveGameLists.push(c)}this.initListKibitzing()};c.prototype.initListKibitzing=function(){if(this.boundLoginOk&&this.liveGameLists&&this.liveGameLists.length){var b=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);b.setUserType(CB.LiveMsgId.REQUEST_LISTS);var d=b.getBuf();d.writeInt(this.liveGameLists.length);for(var c=0;c<this.liveGameLists.length;c++)this.requestDataToBuf(this.liveGameLists[c].requestData,d),d.writeInt(this.liveGameLists[c].ticket),d.V13(!1),d.V13(this.liveGameLists[c].requestData.highestRoundOnly),
this.requestDataToBuf2(this.liveGameLists[c].requestData,d),this.liveGameLists[c].requested=!0;try{window.location?d.V5(window.location.hostname||""):d.V5("")}catch(h){}b.address(this.getNId(),CB.ConnectId.SERVER);this.send(b)}};c.prototype.requestDataToBuf=function(b,d){d.V5(b.event||"");d.V5(b.round||"");d.V5(b.round2||"");d.V5(b.player||"");d.V5(b.white||"");d.V5(b.black||"");d.V5(b.date||"");d.writeInt(b.kibitzRank)};c.prototype.requestDataToBuf2=function(b,d){d.V5(b.team||"")};c.prototype.sendStartKibitzing=
function(b,d){var c=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);c.setUserType(CB.LiveMsgId.START_KIBITZING_GAMEID);var h=c.getBuf();h.writeInt(b);h.writeInt(d);c.address(this.getNId(),CB.ConnectId.SERVER);this.send(c)};c.prototype.sendFinishKibitzing=function(b,d){var c=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);c.setUserType(CB.LiveMsgId.FINISH_KIBITZING_GAMEID);var h=c.getBuf();h.writeInt(b);h.writeInt(d);c.address(this.getNId(),CB.ConnectId.SERVER);this.send(c)};c.prototype.initKibitzingById=
function(b,d,c,h,l,q,r){if(this.boundLoginOk){var t=this.getLiveGameList(d);t&&(t.addSession(b,h,q,r)&&this.sendStartKibitzing(b,d),t.onInitKibitzing(b,c,l))}};c.prototype.requestChatLog=function(b,d){var c=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);c.setUserType(CB.LiveMsgId.REQUEST_CHAT_LOG);var h=c.getBuf();h.writeInt(d);h.writeInt(b);c.address(this.getNId(),CB.ConnectId.SERVER);this.send(c)};c.prototype.setSessionToBackground=function(b,d){if(this.boundLoginOk){var c=this.getLiveGameList(b);
c&&c.setSessionToBackground(d)}};c.prototype.notifySessionSwap=function(b,d,c){this.boundLoginOk&&(b=this.getLiveGameList(b))&&b.notifySessionSwap(d,c)};c.prototype.getPgn=function(b){if(b=this.getLiveGameList(b))return b.getPgn()};var b=!1;c.prototype.onIdle=function(){V15.isIdle()!=b&&(this.updatePlayerStatus(),b=V15.isIdle())};c.prototype.updatePlayerStatus=function(){var b=0;if(this.hasIdReceived){var d=new CB.Server.ClientChange,b=this.detPlayerStatus().flags;d.setStatusChange(b);d.id=this.getNIdBound();
var c=new CB.WebSockMessage(CB.SockMsgId.CLIENTDATACHANGE);d.Vz(c.getBuf());c.address(this.getNId(),CB.ConnectId.SERVER);this.send(c);this.fireOnClientChanges([d])}return b};c.prototype.detPlayerStatus=function(){var b=CB.Server.StatusEnum.KIBITZING,b=V15.isIdle()?b|CB.Server.StatusEnum.IDLE:b|CB.Server.StatusEnum.NOTIDLE;return new CB.Server.Status(b)};c.prototype.execCommand=function(b){if(!this.hasIdReceived&&b!=CB.CommandIds.LOGIN&&b!=CB.LiveCmdIds.PING_SERVER)return!1;try{switch(b){case CB.CommandIds.LOGIN:this.changeLogin();
break;case CB.LiveCmdIds.PING_SERVER:this.pingServer(!0);break;case CB.CommandIds.TEST:this.test()}}catch(d){b=CB.LiveCmdIds.toNumString(b),CB.LogException(b,d)}};c.prototype.logIntoChat=function(b,d,c){};c.prototype.testYesNo=function(b){CB.LOG("YesNo="+b)};c.prototype.test=function(b){};c.prototype.test2=function(){this.logIntoChat("Stop Torture");this.torturer&&this.torturer.stop()};c.prototype.changeLogin=function(){V15.Vf&&V15.Vf.prepareLoginChange()&&V15.Vf.prepareLoginChange()};c.prototype.handleReceived=
function(b){if(!this.handleReceivedByConnector(b))try{switch(b.getType()){default:console.log("Unhandled: "+b.toString());break;case CB.SockMsgId.LIVE_USER:this.handleLiveUserMsg(b);break;case CB.SockMsgId.RECONNECT_OK:this.handleReconnectOk(b);break;case CB.SockMsgId.CHAT:this.handleChat(b)}}catch(d){b=CB.SockMsgId.toNumString(b.getType()),CB.LogException(b,d)}};c.prototype.handleChat=function(b){var d=new CB.ChatData;d.fromSocketsMsg(b);var c=b.getBuf().V10(),h=b.getBuf().V10(),l=new CB.GameHeader;
l.compactFromDataBuf(b.getBuf());b=b.getBuf().V10();d.isToSession()||d.isToObservers()?V15.panelMgr.kibitzChatOut(d.strSender,l,d.strMsg,{idGame:h,ticket:c,mvInx:b},d.isAutomatic(),!0):V15.panelMgr.chatOut(d.toString())};c.prototype.handleChatLog=function(b){var d=[];b=b.getBuf();var c=b.V10();b.V10();for(var h=b.V10(),l=0;l<h;l++){b.beginSizedRead();var q={};q.sender=b.V6(200);q.txt=b.V6(1500);q.gameId=b.V10();q.hdr=new CB.GameHeader;q.hdr.compactFromDataBuf(b);q.mvInx=b.V10();q.autoChat=b.V14();
q.txt.length&&d.push(q);b.endSizedRead()}V15.panelMgr.onChatLog(c,d)};c.prototype.sendChat=function(b,d,c){var h=new CB.ChatData;h.idReceiver=CB.ConnectId.SERVER;h.idSender=this.getNId();h.strMsg=c;h.strSender=b;h.nChannel=d;h.setToSession(!0);h.setToObservers(!0);h.eColName=14;b=h.Vc();b.setType(CB.SockMsgId.LIVE_USER);b.setUserType(CB.LiveMsgId.LIVE_CHAT);this.send(b)};c.prototype.displayForceLogOffMsg=function(b){this.callBacks.onForcedLogoff(b)};c.prototype.handleReconnectOk=function(b){V15.panelMgr.showPosText("Reconnected OK...");
this.requestLists&&this.requestLiveLists(this.requestLists)};var d=0;c.prototype.handleLiveUserMsg=function(b){0<d&&CB.LogException("Reenter handleLiveUserMsg: ",d);d=b.getUserType();try{switch(b.getUserType()){default:CB.LOG("UserMsg="+CB.UserMsgId.toString(b.getUserType()));break;case CB.LiveMsgId.RESPOND_LISTS:this.handleRespondLists(b);break;case CB.LiveMsgId.RESPOND_GAMEDATA:this.handleGameData(b);break;case CB.LiveMsgId.SESSIONACTION:this.handleSessionAction(b);break;case CB.LiveMsgId.SETCLOCK:this.handleSetClock(b);
break;case CB.LiveMsgId.RECENT_ANNO:this.handleRecentAnno(b);break;case CB.LiveMsgId.LIVE_CHAT:this.handleChat(b);break;case CB.LiveMsgId.RESPOND_CHAT_LOG:this.handleChatLog(b)}}catch(c){b=CB.LiveMsgId.toNumString(b.getUserType()),CB.LogException(b,c)}d=0};c.prototype.requestGame=function(b){};c.prototype.handleGameData=function(b){var d=new CB.Server.GameData;d.fromDataBuf(b.getBuf());d.game.gotoIndex(d.game.getMoveIndex());var c=b.getBuf().V10();b.getBuf().V14()&&!V15.isPremium()&&console.log("Live: no premium");
if(b=this.getLiveGameList(c))b.onGameData(d)};c.prototype.handleRespondLists=function(b){var d=b.getBuf();b=new CB.Server.GameItemList;b.fromDataBuf(d);d=d.readInt();if(d=this.getLiveGameList(d))d.onGameItemList(b)};c.prototype.handleSessionAction=function(b){var d=new CB.SessionAction;d.fromDataBuf(b.getBuf());b=b.getBuf().V10();CB.LOG("SAction: "+b);if(b=this.getLiveGameList(b))b.onSessionAction(d)};c.prototype.handleRecentAnno=function(b){var d=b.getBuf().V10();b=b.getBuf().V10();if(d=this.getLiveGameList(d))d.onRecentAnno(b)};
c.prototype.handleSetClock=function(b){var d=new CB.SetClockData;d.fromDataBuf(b.getBuf());var c=b.getBuf().V10();b=b.getBuf().V10();if(c=this.getLiveGameList(c))c.onSetClock(d,b)};c.prototype.getSession=function(b){};c.prototype.getLiveGameList=function(b){if(this.liveGameLists)for(var d=0;d<this.liveGameLists.length;d++)if(this.liveGameLists[d].ticket==b)return this.liveGameLists[d]};c.prototype.gameFromBuf=function(b){var d=new CB.Game,c=new CB.GameHeader;c.compactFromDataBuf(b);b.V10();d.readGameOnly2(b);
d.setHeader(c);return d};c.prototype.onWait=function(){this.showBoardMsg(this.waitMsg|NaN)};c.prototype.showBoardMsg=function(b){V15.gameKernel.boardWin&&V15.gameKernel.boardWin.addMessage(b,!0)};c.prototype.setNoPremiumWarningGame=function(b){4<b.getMoves().length&&(b.gotoIndex(4),b.deleteRemaining(!0),b.getMoves()[3].setAnnoItem(CB.AnnoType.POSTTEXT,new CB.TextAnno("Sorry, this broadcast is Premium only. Please login in with your Premium Account. Thanks!")))};Ve.initForListeners(c);Ve.addEvent(c,
"ChangeLogin");Ve.addEvent(c,"ClientChanges");return c}();
CB.LiveTorturer=function(){var c=function(b,d){this.wsUris=[b];this.liveLists=d;this.mustStop=!1;this.cntRobots=0;this.arrRobots=[];this.maxRobotsAllowed=30;0<=getInternetExplorerVersion()&&(this.maxRobotsAllowed=3)};c.prototype.run=function(){this.mustStop=!1;this.createTimer=new CB.Timer(function(){this.periodicCreate()}.bind(this));this.logOffTimer=new CB.Timer(function(){this.periodicLogOff()}.bind(this));this.createTimer.runPeriodic(500);this.logOffTimer.runPeriodic(350);this.guid=new CBGuid;
this.guid.fromRandom();this.arrRobots=[]};c.prototype.stop=function(){this.mustStop=!0;this.createTimer.stop();this.logOffTimer.stop();for(var b=0;b<this.arrRobots.length;b++)0<this.arrRobots[b].connectId?(this.arrRobots[b].logOff(),this.arrRobots[b].conn.tryTimer.stop(),CB.LOG("LogOff on Stop")):(this.arrRobots[b].closeConn(),CB.LOG("Close on Stop"))};c.prototype.periodicCreate=function(){this.arrRobots.length<this.maxRobotsAllowed&&this.createRobot()&&CB.LOG("Created Robot, NTot="+this.arrRobots.length+
", logged in="+this.countLoggedIn(),"LogGreen")};c.prototype.periodicLogOff=function(){if(this.countLoggedIn()>this.maxRobotsAllowed/2||this.arrRobots.length==this.maxRobotsAllowed){var b=Math.floor(Math.random()*this.arrRobots.length);b<this.arrRobots.length&&(0<this.arrRobots[b].connectId?(this.arrRobots[b].logOff(),CB.LOG("Log Off: "+this.arrRobots[b].connectId,"LogBold")):this.arrRobots[b].isTimeout()&&this.arrRobots[b].closeConn(),this.arrRobots.splice(b,1))}};c.prototype.createRobot=function(){if(this.arrRobots.length<
this.maxRobotsAllowed){var b=new CBGuid;b.fromRandom();80<Math.floor(100*Math.random())&&(b=this.guid);b=new CB.LiveConnectionRobot(this,b,this.liveLists);try{return b.logOn(),this.arrRobots.push(b),!0}catch(d){for(CB.LOG(d,"LogException");this.arrRobots.length;)this.arrRobots[0].isLoggedIn()?this.arrRobots[0].logOff():this.arrRobots[0].closeConn(),this.arrRobots.splice(0,1)}}};c.prototype.countLoggedIn=function(){for(var b=0,d=0;d<this.arrRobots.length;d+=1)0<this.arrRobots[d].connectId&&(b+=1);
return b};return c}();
CB.LiveConnectionRobot=function(){var c=function(b,d,c){this.conn=new CB.Connection(this,b.wsUris);this.conn.tryTimer.stop();this.guid=d;this.liveLists=c};c.prototype.logOn=function(){this.hasIdReceived||(this.tick=new CB.Tick,this.conn.open())};c.prototype.isTimeout=function(){return this.tick&&2E4<this.tick.getExpiredMS()};c.prototype.logOff=function(){try{if(this.hasIdReceived){var b=new CB.WebSockMessage(CB.SockMsgId.LOGOFF);b.address(this.connectId,CB.ConnectId.SERVER);b.buf.Vx(0);this.conn.sendMessage(b,
!0);this.conn.tryTimer.stop();delete this.tick}}catch(d){CB.LOG(d)}};c.prototype.idReceived=function(b){CB.LOG("idReceived: "+b.nId,"","conn");this.hasIdReceived=!0;this.Va=0;this.connectId=b.nId;delete this.tick;(new CB.Timer(function(){this.requestLiveLists(this.liveLists)}.bind(this))).runOnce(500)};c.prototype.onConnect=function(){CB.LOG("OnConnect");void 0===this.guid&&(this.guid=new CBGuid,this.guid.fromRandom());var b=new CB.LogonData("Guest","Guest",CB.LoginMode.GUEST,this.guid,"","robot");
this.conn.sendMessage(b.Vc(!1),!0)};c.prototype.closeConn=function(){this.conn.close()};c.prototype.requestLiveLists=function(b){this.liveGameLists=[];for(var d=0;d<b.length;d++){var c=new CB.Server.LiveGameList(this,b[d].ticket,b[d].requestData);this.liveGameLists.push(c)}this.initListKibitzing()};c.prototype.initListKibitzing=function(){if(this.liveGameLists&&this.liveGameLists.length){var b=new CB.WebSockMessage(CB.SockMsgId.LIVE_USER);b.setUserType(CB.LiveMsgId.REQUEST_LISTS);var d=b.getBuf();
d.writeInt(this.liveGameLists.length);for(var c=0;c<this.liveGameLists.length;c++)this.requestDataToBuf(this.liveGameLists[c].requestData,d),d.writeInt(this.liveGameLists[c].ticket),this.liveGameLists[c].requested=!0;b.address(this.getNId(),CB.ConnectId.SERVER);this.conn.sendMessage(b,!0)}};c.prototype.requestDataToBuf=function(b,d){d.V5(b.event||"");d.V5(b.round||"");d.V5(b.round2||"");d.V5(b.player||"");d.V5(b.white||"");d.V5(b.black||"");d.V5(b.date||"");d.writeInt(b.kibitzRank)};c.prototype.handleReceived=
function(b){try{switch(b.getType()){case CB.SockMsgId.CHAT:this.handleChat(b);break;case CB.SockMsgId.RECONNECT_OK:CB.LOG("Reconnect OK","LogRed");break;case CB.SockMsgId.ALIVE:this.handleAreYouAlive();break;case CB.SockMsgId.DEFAULTGROUPS:this.idBound=b.getBuf().V10();this.boundLoginOk=!0;break;case CB.SockMsgId.LIVE_USER:switch(b.getUserType()){case CB.LiveMsgId.RESPOND_LISTS:this.handleRespondLists(b);break;case CB.LiveMsgId.RESPOND_GAMEDATA:this.handleGameData(b);break;case CB.LiveMsgId.SESSIONACTION:this.handleSessionAction(b)}}}catch(d){CB.LOG("Exception: "+
d.toString(),"LogException")}};c.prototype.isLoggedIn=function(){return this.boundLoginOk&&this.conn&&this.conn.isConnected()};c.prototype.handleChat=function(b){var d=new CB.ChatData;d.fromSocketsMsg(b);V15.panelMgr.chatOut(d.toString())};c.prototype.handleAreYouAlive=function(){CB.LOG("Server -> Robot: AYAlive? boundLogin="+this.boundLoginOk);var b=new CB.WebSockMessage(CB.SockMsgId.IAMALIVE);b.address(this.connectId,CB.ConnectId.SERVER);this.conn.sendMessage(b,!0)};c.prototype.handleGameData=function(b){var d=
new CB.Server.GameData;d.fromDataBuf(b.getBuf());d.game.gotoIndex(d.game.getMoveIndex());b=b.getBuf().V10();CB.LOG("Game: "+b,"","rob");if(b=this.getLiveGameList(b))b.onGameData(d)};c.prototype.handleRespondLists=function(b){var d=b.getBuf();b=new CB.Server.GameItemList;b.fromDataBuf(d);d=d.readInt();CB.LOG("List: "+b.games.length,"","rob");if(d=this.getLiveGameList(d))d.onGameItemList(b)};c.prototype.handleSessionAction=function(b){var d=new CB.SessionAction;d.fromDataBuf(b.getBuf());b=b.getBuf().V10();
CB.LOG("SAction: "+b);this.getSession(b);if(b=this.getLiveGameList(b))b.onSessionAction(d)};c.prototype.getLiveGameList=function(b){if(this.liveGameLists)for(var d=0;d<this.liveGameLists.length;d++)if(this.liveGameLists[d].ticket==b)return this.liveGameLists[d]};c.prototype.sendChat=function(b){if(this.idBound){var d=new CB.ChatData;d.strMsg=b;d.setToIndividuals(!0);d.idSender=this.idBound;d.setReceivers(this.idBound);d.setAutomatic(!0);b=d.Vc();b.address(this.getNId(),this.getNId());this.conn.sendMessage(b,
!0)}};c.prototype.getNId=function(){return this.conn.connectId};return c}();
CB.Tournament=function(){var c=function(){};c.prototype.title=null;c.prototype.arcKey=null;c.prototype.player=null;c.prototype.rounds=null;c.prototype.availbeRounds=null;c.prototype.type=null;c.Types={koTwo:"ko",ko:"k.o.",roundrobin:"tourn",swiss:"swiss",sheveninger:"shev",match:"mat",team:"team"};c.prototype.getPlayerById=function(b){return this.player.filter(function(d){if(d.id==b||d.otherIds&&d.otherIds.contains(parseInt(b)))return!0})[0]};c.prototype.distinctPlayerForRound=function(b){b=this.rounds[b-
1];for(var d=[],c,f=0;f<b.length;f++)c=b[f],0>d.indexOf(c.white)&&d.push(c.white),0>d.indexOf(c.black)&&d.push(c.black);return d.length};c.fromJson=function(b){return c.fromObject(JSON.parse(b))};c.fromObject=function(b){var d=new c;d.title=b.Tournaments[0].t.split("_").join(" ");d.arcKey=b.Tournaments[0].k;for(var e=[],f=function(b,d){for(var c,f,g=(d.f+d.l).trim(),h=0;h<e.length;h++)if(f=e[h].lastName,c=e[h].firstName,c=(c+f).trim(),.2>CB.Levenshtein.getDistance(g,c,3,1,1)/Math.max(g.length,c.length))return e[h]},
g=0;g<b.Players.length;g++){var h=b.Players[g],l=f(e,h);l?(l.otherIds=l.otherIds||[],l.otherIds.push(h.i)):e.push(new CB.TablePlayer(h.f,h.l,h.e,h.i))}d.player=e;f=b.Rounds;d.availbeRounds=f;var q=[],r=[];f.forEach(function(c,e,f){q.push([]);q[c-1]=[];r.push([]);r[c-1]=[];rp=[];for(e=0;e<b["R-"+c+":"].length;e++){f=b["R-"+c+":"][e].b;var g=b["R-"+c+":"][e].p.split(/-|=/),h=d.getPlayerById(g[0]),l=d.getPlayerById(g[1]),g=g[2],C=h.id<<16|l.id<<4;if(!rp.contains(C)){rp.push(C);if(0>g||2<g)g=null;C=new CB.Pairing(h,
l,g);C.round=c;C.subround=f;g&&q[c-1].push(C);r[c-1].push(C);var C=g?g/2:null,D=g?(2-g)/2:null;g&&(h.opponents.push(new CB.OpponentEntry(l,C,!0,c,f)),l.opponents.push(new CB.OpponentEntry(h,D,!1,c,f)))}}}.bind(this));d.rounds=q;d.pairings=r;d.type=b.Tournaments[0].tt;d.strTB=b.Tournaments[0].tb;return d};c.PairingFromJson=function(b){return c.PairingFromObjecct(JSON.parse(b))};c.PairingfromObject=function(b){};return c}();
CB.TablePlayer=function(){var c=function(b,d,c,f,g){this.firstName=b;this.lastName=d;this.elo=c;this.id=f;this.team=g;this.valuation=new CB.Valuation;this.valuation.elo=this.elo;this.valuation.name=this.getPbServerUrl();this.valuation.info=$("<div>",{"class":"playerImageContainer"}).append($("<div>",{"class":"name"}).html(this.valuation.name));this.valuation.nation=$("<div>",{"class":"flag"}).append($("<img>",{"class":"flagImg",src:"https://pgn.chessbase.com/Common/Media/Flags/Flags64/United Nations.png"}));
this.valuation.title=$("<div>",{"class":"title"}).text("");this.opponents=[]};c.prototype.team=null;c.prototype.opponents=null;c.prototype.id=null;c.prototype.firstName=null;c.prototype.lastName=null;c.prototype.elo=null;c.prototype.valuation=null;c.prototype.getName=function(){return this.firstName?this.lastName+","+this.firstName:this.lastName};c.prototype.getDisplayeName=function(){return this.firstName&&this.firstName.length?this.lastName+","+this.firstName.substr(0,1):this.lastName};c.prototype.getFirstOpponentEntryForPlayer=
function(b){return this.getAllOpponentEntriesForPlayer(b)[0]};c.prototype.getAllOpponentEntriesForPlayer=function(b){var d=this.opponents.filter(function(d){return d.opponent===b});return d=d||[]};c.prototype.distinctOpponentCount=function(){var b=[];this.opponents.forEach(function(d){0>b.indexOf(d.opponent)&&b.push(d.opponent)});return b.length};c.prototype.getPbServerUrl=function(){this.getName();var b=this.getDisplayeName(),d=$("<a>");d.attr("href",String.formatEx("//players.chessbase.com/player/{0}_{1}?elo={2}",
this.lastName,this.firstName,this.valuation.elo));d.text(b);return d.prop("outerHTML")};return c}();CB.RankingOptions=function(){var c=function(b,d){this.tiebreakInfosArr=b;this.top=d};c.prototype.tiebreakInfosArr=null;c.prototype.top=1E4;return c}();
CB.OpponentEntry=function(){var c=function(b,d,c,f,g){this.opponent=b;this.scoredPoints=d;this.isWhite=c;this.round=f;this.board=g};c.prototype.board=null;c.prototype.opponent=null;c.prototype.scoredPoints=null;c.prototype.isWhite=null;c.prototype.round=null;return c}();CB.Pairing=function(){var c=function(b,d,c){this.white=b;this.black=d;this.result=c};c.prototype.white=null;c.prototype.black=null;c.prototype.result=null;return c}();
CB.TableResult=function(){var c=function(b){};c.prototype.result=null;return c}();CB.Round=function(){var c=function(b,d){this.roundNr=b;this.pairingsArr=d};c.prototype.roundNr=null;c.prototype.pairingsArr=null;return c}();
CB.TiebrakeInfo=function(){var c=function(b,d,c){this.propertyName=b;this.cutOffFront=this.streichWertungen=d;this.cutOffEnd=c};c.prototype.cutOffFront=null;c.prototype.cutOffEnd=null;c.prototype.propertyName=null;c.prototype.streichWertungen=null;c.Names={bhz:"Buchholz",dirEnc:"Direct encounter",snb:"Sonneborn-Berger",avgElo:"Average Elo",perf:"Performance",wins:"Wins",bl:"Games with black",prog:"Comulative",blwins:"Wins with black",bhzsum:"Sum of opponents buchholz",koya:"Koya"};c.arrFromString=
function(b){if(!b)return[];var d=[],c=/[a-zA-Z]+/;b.split(",").forEach(function(b){var g=c.exec(b)[0],h=b.match(/^\d+|\d+\b|\d+(?=\w)/g),h=h?h.map(function(b){return+b}):[],l=0,q=0;0<h.length&&(l=h[0]);1<h.length&&(q=h[1]);b.replace(g,"");d.push(new CB.TiebrakeInfo(g,l,q))});return d};return c}();
CB.Valuation=function(){var c=function(){};c.prototype.points=null;c.prototype.buchholz=null;c.prototype.sonnebornberger=null;c.prototype.wins=null;c.prototype.avgElo=null;c.prototype.eloPerff=null;c.prototype.direkterVergleich=0;return c}();
CB.TableMath=function(){var c={calc:function(b,e,f,g,h,l,q){return c.calcMethods[e](b,e,f||function(){return!0},g,h,l,q)},getOpponents:function(b,c,f){f=b.length-f;f=0>f?0:f;return b.sort(function(b,d){return d.opponent.valuation.points-b.opponent.valuation.points}).slice(c,f)},calculateEloPerf:function(d,e,f,g,h,l){l=0<=l?l:0;e=c.getOpponents(d.opponents.filter(f),h,l).filter(function(b){return null!=b.scoredPoints});d=CB.TableMath.avg(e,function(b){return b.opponent.valuation.elo});e=Math.round(CB.TableMath.sum(e,
function(b){return b.scoredPoints})/e.length*100);return d+b.getDiff(e)},calculatePoints:function(b,c,f,g,h,l,q){return CB.TableMath.sum(b.opponents.filter(f),function(b){return 1==b.scoredPoints?q.win:.5==b.scoredPoints?q.draw:0==b.scoredPoints?q.loss:b.scoredPoints})},calculateBuchHolz:function(b,e,f,g,h,l){b=CB.TableMath.getOpponents(b.opponents.filter(f),h,l);return c.sum(b,CB.TableMath.buildGetPropertyFromOpEntryFunc("points"))},calculateSonnebornBerger:function(b,c,f,g,h,l){var q=0;CB.TableMath.getOpponents(b.opponents.filter(f),
h,l).filter(f).forEach(function(b){q+=b.scoredPoints*b.opponent.valuation.points});return q},calculateWins:function(b,e,f,g,h,l){return c.getOpponents(b.opponents.filter(f),h,l).filter(function(b){return 1===b.scoredPoints}).length},calculateBlacks:function(b,e,f,g,h,l){return c.getOpponents(b.opponents.filter(f),h,l).filter(function(b){return!b.isWhite}).length},calculateAvgElo:function(b,e,f,g,h,l){b=c.getOpponents(b.opponents.filter(f),h,l);return c.avg(b,CB.TableMath.buildGetPropertyFromOpEntryFunc("elo"))},
calculateDirectEncounter:function(b,e,f,g,h,l){var q=!0,r=b.opponents.filter(function(c){return c.opponent.valuation.points==b.valuation.points});if(0==r.length)return 0;r.map(function(b){return b.opponent}).forEach(function(b){opponentOps=b.opponents.filter(function(d){return d.opponent.valuation.points==b.valuation.points});opponentOps.length!=r.length&&(q=!1)});return q?c.sum(r,function(b){return b.scoredPoints}):0},calculateComulative:function(b,c,f,g,h,l){b=b.opponents.filter(f);c=0;for(f=1;f<=
b.length;f++)c+=f*b[b.length-f];return c},calculateBlackWins:function(b,c,f,g,h,l){return b.opponents.filter(f).filter(function(b){return!b.isWhite}).filter(function(b){return 1==b.scoredPoints}).length},calculateBuchHolzSum:function(b,e,f,g,h,l){b=b.opponents.filter(f);b=c.getOpponents(b,h,l);b=b.filter(function(b){return null!=b.scoredPoints});b.forEach(function(b){b.opponent.valuation.bhz||(b.opponent.valuation.bhz=c.calculateBuchHolz(b.opponent,"bhz",f,g,h,l))});return c.sum(b,function(b){return parseFloat(b.opponent.valuation.bhz)})},
calculateBuchHolzMinMax:function(b,e,f,g,h,l){return c.calculateBuchHolz(b,e,f,g,1,1)},calculateKoya:function(b,e,f,g,h,l){b=b.opponents.filter(function(b){return b.opponent.valuation.points>=b.opponent.opponents.length/2});return c.sum(b,function(b){return b.scoredPoints})},sum:function(b,c){var f=0;b.forEach(function(b){f+=c(b)});return f},avg:function(b,e){return c.sum(b,e)/b.length},buildGetPropertyFromOpEntryFunc:function(b){return function(c){return parseFloat(c.opponent.valuation[b])}},max:function(b,
c){max=0;b.forEach(function(b){b=c(b);max=b>max?b:max});return max},min:function(b,c){min=0;b.forEach(function(b){b=c(b);min=b<min?b:min});return min}};c.calcMethods={points:c.calculatePoints,buchholz:c.calculateBuchHolz,sonnebornberger:c.calculateSonnebornBerger,wins:c.calculateWins,avgElo:c.calculateAvgElo,eloPerf:c.calculateEloPerf,direkterVergleich:c.calculateDirectEncounter,blacks:c.calculateBlacks,bl:c.calculateBlacks,bhz:c.calculateBuchHolz,snb:c.calculateSonnebornBerger,perf:c.calculateEloPerf,
dirEnc:c.calculateDirectEncounter,prog:c.calculateComulative,blwins:c.calculateBlackWins,bhzsum:c.calculateBuchHolzSum,bhzminmax:c.calculateBuchHolzMinMax,koya:c.calculateKoya};var b={100:800,99:677,98:589,97:538,96:501,95:470,94:444,93:422,92:401,91:383,90:366,89:351,88:336,87:322,86:309,85:296,84:284,83:273,82:262,81:251,80:240,79:230,78:220,77:211,76:202,75:193,74:184,73:175,72:166,71:158,70:149,69:141,68:133,67:125,66:117,65:110,64:102,63:95,62:87,61:80,60:72,59:65,58:57,57:50,56:43,55:36,54:29,
53:21,52:14,51:7,50:0,getDiff:function(b){return 50<b?this[b]:-this[100-b]}};return c}();
CB.ArrayToTableConverter=function(){var c=function(){};c.convertToHtmlTable=function(b){var d=$("<table>"),e=$("<thead>"),f=$("<tbody>"),g=CB.TableMath.max(b,function(b){return b.length});theadRow=$("<tr>");var h=0;b[0].forEach(function(b,d,c){var e=$("<th>");b.colspan&&b.str?(e.html(b.str),e.attr("colspan",b.colspan),h+=b.colspan):(e.html(b),h++);d===c.length-1&&e.attr("colspan",g-h);theadRow.append(e)});e.append(theadRow);for(var l=1;l<b.length;l++){var q=b[l],r=$("<tr>");q.forEach(function(b,d,
e){var f;c.isNumberField(b)&&(f="tdNumber");f=$("<td>",{"class":f});f.html(b);d===e.length-1&&f.attr("colspan",g-d);r.append(f)});f.append(r)}d.append(e);d.append(f);return d};c.isNumberField=function(b){if(!b)return!1;if(b instanceof Number||"number"===typeof b||!isNaN(b)||b.charCodeAt&&189==b.charCodeAt(0)||b&&$(b).text&&(b=$(b).text(),b instanceof Number||"number"===typeof b||!isNaN(b)||189==b.charCodeAt(0)))return!0};return c}();CB.Comparer=CB.Comparer||{};
CB.Comparer.PlayerComparer=function(){var c=function(b){this.subComparer=_subComparer};c.prototype.subComparer=null;c.prototype.compare=function(b,d){};return c}();CB.Comparer=CB.Comparer||{};
CB.Comparer.HigherNumberComparer=function(){var c=function(b,d){this.subComparer=b;this.property=d};c.prototype.subComparer=null;c.prototype.property=null;c.prototype.compare=function(b,d){return b.valuation[this.property]===d.valuation[this.property]?this.subComparer?this.subComparer.compare(b,d):0:d.valuation[this.property]-b.valuation[this.property]};return c}();CB.Comparer=CB.Comparer||{};
CB.Comparer.Comparer=function(){var c=function(){this.comparer=[]};c.prototype.comparer=null;c.prototype.addComparer=function(b){this.comparer.push(b)};c.prototype.removeComparer=function(b){b=this.comparer.indexOf(b);return this.comparer.slice(b)};c.prototype.removeComparerByIndex=function(b){return this.comparer.slice(b,1)};c.prototype.compare=function(b,d){var c,f=0,g=this.comparer.length;do c=this.comparer[f].compare(b,d),f++;while(0==c&&f<g);return c};c.fromTiebrakeInfos=function(b){var d=new CB.Comparer.Comparer;
d.addComparer(new CB.Comparer.HigherNumberComparer(null,"points"));b.forEach(function(b){d.addComparer(new CB.Comparer.HigherNumberComparer(null,b.propertyName))});return d};return c}();CB.Formatter=CB.Formatter||{};
CB.Formatter.KoFormatter=function(){var c=function(){};c.prototype.sortRounds=function(b){var c=b[b.length-1];c.sort(function(b,d){return Math.max(d.white.elo,d.black.valuation.elo)-Math.max(b.white.elo,b.black.valuation.elo)});var f=0,g=[];c.forEach(function(b){var d=b.white.elo>b.black.elo?b.white:b.black;b=b.white.elo>b.black.elo?b.black:b.white;g.contains(d)||(d.sortIndex=++f,g.push(d));g.contains(b)||(b.sortIndex=++f,g.push(b))});for(var h=1/3,c=b.length-2;0<=c;c--)b[c].forEach(function(b){var d=
b.white.elo>b.black.elo?b.white:b.black;b=b.white.elo>b.black.elo?b.black:b.white;d.sortIndex&&b.sortIndex||(d.sortIndex?b.sortIndex=d.sortIndex+h:b.sortIndex?d.sortIndex=b.sortIndex-h:console.log("How?"))}),h/=3;b.forEach(function(b){b.sort(function(b,d){return Math.min(b.white.sortIndex,b.black.sortIndex)-Math.min(d.white.sortIndex,d.black.sortIndex)})})};c.prototype.toHtml=function(b,c,f,g){c=b.players;f=b.tournament.rounds;console.log(b);g=b.tournament.availbeRounds;this.sortRounds(f);for(var h=
$("<div>",{"class":"koContainer"}),l=$("<div>",{"class":"koContent"}),q=0;q<g.length;q++){var r=g[q],t=$("<div>",{"class":"koRound koRound-"+r});t.append(this.createRoundDiv(f[q],r,c,b));l.append(t)}h.append(l);return h};c.prototype.toHtmlOld=function(b,c,f,g){c=g.width;f=b.players;g=b.tournament.rounds;this.sortRounds(g);var h=b.tournament.availbeRounds,l=$("<div>",{"class":"koContainer"}),q=$("<div>",{"class":"koHead"});q.append(this.createHead(h,b));for(var r=$("<div>",{"class":"koContent"}),t=
0;t<h.length;t++){var v=h[t],y=$("<div>",{"class":"koRound koRound-"+v});y.append(this.createRoundDiv(g[t],v,f,b));r.append(y)}l.append(q);l.append($("<div>",{"class":"koContentContainer"}).append(r));520<=c?l.css("width",500):l.css("width","100%");return l};c.prototype.createHead=function(b,c){var f=$("<div>",{"class":"arrowContainer"}),g=$("<div>",{"class":"arrowLeftContainer arrowSideContainer"}),h=$("<img>",{src:"https://pgn.chessbase.com/Common/Media/Webimages/Arrow_left.png","class":"arrow arrowLeft"}),
l=$("<div>",{"class":"arrowRightContainer arrowSideContainer"}),q=$("<img>",{src:"https://pgn.chessbase.com/Common/Media/Webimages/Arrow_right.png","class":"arrow arrowRight"}),r=$("<div>",{"class":"roundNrContainer"}),t=$("<div>",{"class":"roundNr"});r.append(t);g.append(h);l.append(q);f.append(g);f.append(r);f.append(l);var v=function(b){document.getElementById("koRoundSheet"+b)||(b=$("<style>",{id:"koRoundSheet"+b}).html(".cbtable .koContainer .koRound-"+b+"{display:none}"),$(document.head).append(b))},
y=function(b){document.head.removeChild(document.getElementById("koRoundSheet"+b))},A=function(b){g.next().children(".roundNr").text(b)};c.currentRoundIndex=c.currentRoundIndex||b.length-1;c.lastRoundIndex=c.lastRoundIndex||0;for(var w=c.currentRoundIndex,z=c.lastRoundIndex,C=b.length-1,h=0;h<b.length-1;h++)v(b[h]);A(b[b.length-1]);g.on("click",function(){0!=w&&(z=w,w--,A(b[w]),v(b[z]),y(b[w]),0==w&&g.children(".arrow").addClass("inactive"),w+1==C&&l.children(".arrow").removeClass("inactive"))});
l.on("click",function(){w!=C&&(z=w,w++,A(b[w]),v(b[z]),y(b[w]),0==w-1&&g.children(".arrow").removeClass("inactive"),w==C&&l.children(".arrow").addClass("inactive"))});w==C&&l.children(".arrow").addClass("inactive");0==w&&g.children(".arrow").addClass("inactive");return f};c.prototype.createRoundDiv=function(b,c,f,g){var h=$("<div>",{"class":"koRoundDiv"}),l=[],q=0;f.forEach(function(b){q=Math.max(b.opponents.filter(function(b){return b.round==c}).length,q)});for(f=0;f<b.length;f++){var r=b[f],t=r.white,
v=r.black;if(!l.contains(t)&&!l.contains(v)){l.push(t);l.push(v);r=$("<div>",{"class":"koMatch"});if(t.sortIndex<v.sortIndex)var y=this.createPlayerLine(t,v,c,g,q),t=this.createPlayerLine(v,t,c,g,q);else y=this.createPlayerLine(v,t,c,g,q),t=this.createPlayerLine(t,v,c,g,q);r.append(y);r.append(t);h.append(r)}}return h};var b=function(b,c){return b.round!=c.round?b.round-c.round:b.board-c.board};c.prototype.createPlayerLine=function(d,c,f,g,h){d.opponents.sort(b);c=$("<div>",{"class":"playerLine"});
c.append(this.createPlayerDiv(d));var l=[];d.opponents.filter(function(b){return b.round==f}).forEach(function(b){l.push(g.createGameLink(d,b))});for(var q=l.length;q<h;q++)l.push("-");h=g.getColoredResultsForPlayer(d,f);c.append(this.resultDiv(l,h));return c};c.prototype.createPlayerDiv=function(b){var c=$("<div>",{"class":"playerDiv"});c.append($("<div>",{"class":"title"}).html($(b.valuation.title.prop("outerHTML"))));c.append($(b.valuation.info.prop("outerHTML")));c.append($("<div>",{"class":"rating"}).html(b.valuation.elo));
c.append($("<div>",{"class":"nation"}).html(b.valuation.nation.prop("outerHTML")));return c};c.prototype.toHtmlOld=function(b,c,f,g){var h=this.buildD2Array(b),l,q;f=b.tournament.rounds;g=[];for(var r,t=0;t<b.tournament.availbeRounds.length;t++){var v=[];q=0;r=t;roundNr=b.tournament.availbeRounds[t];c=Math.pow(2,roundNr-1)-1;l=2*c;q+=c;g.push(roundNr);f[roundNr-1].forEach(function(c,e,f){e=c.white;c=c.black;if(!(0<=v.indexOf(e))){v.push(e);v.push(c);var g=b.getResultsForPlayer(e,roundNr);f=b.getResultsForPlayer(c,
roundNr);g=this.resultDiv(g);f=this.resultDiv(f);h[q++][r]=e.getPbServerUrl();h[q++][r]=g;h[q++][r]=f;h[q++][r]=c.getPbServerUrl();q+=l}}.bind(this))}h.unshift(g);c=CB.ArrayToTableConverter.convertToHtmlTable(h);c.addClass("cbko");return c};c.prototype.buildD2Array=function(b){var c=2*b.tournament.player.length+4;b=b.tournament.rounds.length;for(var f=[],g=0;g<c;g++){for(var h=[],l=0;l<b;l++)h.push("");f.push(h)}return f};c.prototype.toHtmlOld=function(b,c,f,g){g=b.players;var h=this.buildArray(b),
l,q,r;c=b.tournament.rounds;f=[];g.forEach(function(b,d,c){b.kosortrank=d});for(var t=0;t<b.tournament.availbeRounds.length;t++){var v=[];r=0;columnNr=t;l=b.tournament.availbeRounds[t];g=Math.pow(2,l)-2;q=2*g;r+=g;f.push(l);c[l-1].forEach(function(c,e,f){e=c.white;c=c.black;if(!(0<=v.indexOf(e))){v.push(e);v.push(c);var g=b.getResultsForPlayer(e,l);f=b.getResultsForPlayer(c,l);g=this.resultDiv(g);f=this.resultDiv(f);h[r++][columnNr]=e.getPbServerUrl();h[r++][columnNr]=g;h[r++][columnNr]=f;h[r++][columnNr]=
c.getPbServerUrl();r+=q}}.bind(this))}h.shift(f);return CB.ArrayToTableConverter.convertToHtmlTable(h)};c.prototype.resultDiv=function(b,c){var f=$("<div>");f.addClass("resultsBox");for(var g=0;g<b.length;g++){var h=$("<div>");h.html(b[g]);h.addClass("innerResultsBox");g<c.length&&h.addClass(c[g].isWhite?"w":"b");f.append(h)}g=CB.TableMath.sum(c,function(b){return b.points});h=$("<div>");h.addClass("innerResultsBox");h.html(g);f.append(h);return $("<div>").append(f.clone()).html()};c.prototype.replaceHalf=
function(b){return(b+"").split("0.5").join(".5").split(".5").join("&#189;")};c.prototype.getFunction=function(b){return b};c.prototype.buildArray=function(b){var c=2*Math.pow(2,b.tournament.rounds.length);b=b.tournament.rounds.length;for(var f=[],g=0;g<c;g++){for(var h=[],l=0;l<b;l++)h.push("");f.push(h)}return f};return c}();CB.Formatter=CB.Formatter||{};
CB.Formatter.RoundRobinFormatter=function(){var c=function(){},b=function(b,c){var f=$("<tfoot>"),g=$("<tr>"),h=$("<td>",{"class":"tbTd",colspan:c});h.text(b);g.append(h);f.append(g);return f};c.prototype.toHtml=function(d,c,f,g){var h=g.width,l=[],q=[];c.forEach(function(b){q.push(b.headerName)});if(450<h)for(var r=1;r<=d.players.length;r++)q.push($("<div>",{"class":"crossResultHeader"}).html(r));0<f.tiebreakInfosArr.length&&q.push({str:"TB",colspan:1});q.push("Perf.");l.push(q);var t=1;d.players.forEach(function(b){var g=
[];c.forEach(function(d){g.push($("<div>",{"class":d.propertyName}).html(b.valuation[d.propertyName]).prop("outerHTML"))});450<h&&d.players.forEach(function(c){var e=$("<div>",{"class":"crossResult"}),f=b.getAllOpponentEntriesForPlayer(c);t=Math.max(t,f.filter(function(b){return b.scoredPoints}).length);if(c===b)g.push('<div class="samePlayer"></div>');else if(0<f.length){var h=[];c="";4<f.length?c=CB.TableMath.sum(f,function(b){return b.scoredPoints}):(f.forEach(function(c){c=d.createGameLink(b,
c);h.push(c)}),c=h.map(function(b){return b.prop("outerHTML")}).join(" "));e.html(c);g.push(e.prop("outerHTML"))}else g.push("")});0<f.tiebreakInfosArr.length&&g.push($("<div>",{"class":"tb"}).text(b.valuation[f.tiebreakInfosArr[0].propertyName]));g.push($("<div>",{"class":"perf"}).text(b.valuation.perf));l.push(g)});r=CB.ArrayToTableConverter.convertToHtmlTable(l);if(g.caption){g=$("<caption>");var v=String.formatEx('<a href="http://live.chessbase.com/replay/{0}/0?anno=false">{1}</a>',d.tournament.arcKey,
d.tournament.title);g.html(v);r.prepend(g)}g=CB.TableMath.max(l,function(b){return b.length});v="TBs: "+f.tiebreakInfosArr.map(function(b){return CB.TiebrakeInfo.Names[b.propertyName]}).join(", ");r.append(b(v,g));r.addClass("cbroundrobin");r.addClass("games-"+t);r.attr("cellpadding","0");return r};return c}();CB.Formatter=CB.Formatter||{};
CB.Formatter.SwissFormatter=function(){var c=function(){};c.prototype.toHtml=function(b,d,c,f){var g=c.top||1E4,g=Math.min(g,b.players.length),h=c.tiebreakInfosArr;c=b.players.slice(0,g);var l=[],q=[];d.forEach(function(b){q.push(b.headerName)});q.push({str:"TB",colspan:1});q.push("Perf.");l.push(q);c.forEach(function(b){var c=[];d.forEach(function(d){b.valuation[d.propertyName]instanceof jQuery?c.push($("<div>",{"class":d.propertyName}).html($(b.valuation[d.propertyName].prop("outerHTML")))):c.push($("<div>",
{"class":d.propertyName}).html(b.valuation[d.propertyName]))});0<h.length&&c.push($("<div>",{"class":"tb"}).html(b.valuation[h[0].propertyName]));c.push($("<div>",{"class":"perf"}).text(b.valuation.perf));l.push(c)});c=CB.ArrayToTableConverter.convertToHtmlTable(l);f.caption&&(b=String.formatEx('<a href="http://live.chessbase.com/replay/{0}/0?anno=false">{1}</a>',b.tournament.arcKey,b.tournament.title),f=$("<caption>"),f.html(b),c.prepend(f));var r=CB.TableMath.max(l,function(b){return b.length});
b=$("<tfoot>");f=h.map(function(b){return CB.TiebrakeInfo.Names[b.propertyName]}).join(", ");g=$("<tr>");r=$("<td>",{colspan:r});r.text("TBs: "+f);g.append(r);b.append(g);c.append(b);c.addClass("cbswiss");return c};c.prototype.toHtmlold=function(b,d,c,f){var g=c.top||1E4,h=c.tiebreakInfosArr;c=b.players;var l=$("<table>",{"class":"simple_table"});f.caption&&(f=$("<caption>"),b=String.formatEx('<a href="http://live.chessbase.com/replay/{0}/0?anno=false">{0}</a>',b.tournament.title.split(" ").join("_")),
f.html(b),l.append(f));b=$("<thead>");var q=$("<tbody>"),r=$("<tr>");d.forEach(function(b){var d=$("<th>");d.text(b.headerName);r.append(d)});f=$("<th>");f.text("Tiebrakers");f.attr("colspan",h.length);r.append(f);f=$("<tfoot>");f.text("TBs");b.append(r);l.append(b);l.append(f);var t=function(b,d){return function(c){var e=$("<td>");(b.valuation[c.propertyName]instanceof Number||"number"===typeof b.valuation[c.propertyName])&&e.addClass("tdNumber");e.html(b.valuation[c.propertyName]);d.append(e)}};
c.filter(function(b){return b.valuation.rank<=g}).forEach(function(b){var c=$("<tr>");b=t(b,c);d.forEach(b);h.forEach(b);q.append(c)});l.append(q);return l};return c}();CB.Formatter=CB.Formatter||{};CB.Formatter.ITableFormatter=function(){var c=function(){};c.prototype.toHtml=function(b,d,c,f){};return c}();CB.TablePropertiesDeclarer=function(){var c=function(b,d){this.propertyName=b;this.headerName=d};c.prototype.propertyName=null;c.prototype.headerName=null;return c}();
CB.Formatter=CB.Formatter||{};
CB.Formatter.MatchFormatter=function(){var c=function(){};c.prototype.toHtml=function(b,d,c,f){d=f.width||4E4;this.ranking=b;c=[];c.push([]);var g=b.players[0],h=b.players[1],l=g.valuation.nation||h.valuation.nation,q=g.valuation.title||h.valuation.title,r=g.valuation.elo||h.valuation.elo,t=f.withPic&&(g.valuation.picture||h.valuation.picture);c.push(this.formPlayerLine(g,450<d,l,q,r,t));c.push(this.formPlayerLine(h,450<d,l,q,r,t));d=CB.ArrayToTableConverter.convertToHtmlTable(c);f.caption&&(f=$("<caption>"),
b=String.formatEx('<a href="http://live.chessbase.com/replay/{0}/0?anno=false">{1}</a>',b.tournament.arcKey,b.tournament.title),f.html(b),d.prepend(f));d.addClass("cbmatch");return d};c.prototype.formPlayerLine=function(b,d,c,f,g,h){var l=[];f&&l.push($("<div>",{"class":"title"}).html(b.valuation.title));l.push($("<div>",{"class":"name"}).html(b.getPbServerUrl()));h&&l.push($("<div>",{"class":"picture"}).html(b.valuation.picture));c&&l.push($("<div>",{"class":"nation"}).html(b.valuation.nation));
g&&l.push($("<div>",{"class":"elo"}).html(b.valuation.elo));c=b.opponents.sort(function(b,d){return b.round-d.round});d&&c.forEach(function(d){l.push($("<div>",{"class":"crossResult"}).html(this.ranking.createGameLink(b,d)).prop("outerHTML"))}.bind(this));d=CB.TableMath.sum(c,function(b){return b.scoredPoints});l.push($("<div>",{"class":"points"}).text(d).prop("outerHTML"));return l};return c}();CB.Formatter=CB.Formatter||{};
CB.Formatter.SheveningerFormatter=function(){var c=function(){};c.prototype.toHtml=function(b,d,c,f){c=this._getTeams(b);d=c[0];var g=c[1];c=function(b,d){return d.valuation.points-b.valuation.points};d.sort(c);g.sort(c);c=$("<table>",{"class":"shev"});var h=$("<tbody>"),l=$("<tr>");l.append($("<td>"));var q=0;g.forEach(function(b){var d=$("<td>",{"class":"shev-rotate"});this._getPlayerDiv(b);d.html(this._getPlayerDiv(b));b=b.getDisplayeName().length;q=Math.max(q,5*b+48);l.append(d)}.bind(this));
h.append(l);d.forEach(function(d){var c=$("<tr>"),e=$("<td>");c.append(e);e.append(this._getPlayerDiv(d));g.forEach(function(e){d.getAllOpponentEntriesForPlayer(e).forEach(function(e){var f=$("<td>");f.html(b.createGameLink(d,e));c.append(f)})});h.append(c)}.bind(this));c.append(h);c.css("margin-top",Math.sqrt(Math.pow(q,2)));return c};c.prototype._getPlayerDiv=function(b){var d=$("<div>",{"class":"outerPlayerDiv"}),c=$("<div>",{"class":"playerDiv"});c.append(b.valuation.nation);c.append(b.valuation.title);
c.append(b.getPbServerUrl());c.append(b.valuation.elo);d.append(c);return c};c.prototype._getTeams=function(b){var c=[],e=[],f=b.players[0];f.opponents.forEach(function(b){e.push(b.opponent)});c.push(f);for(var g=e,h=c,f=0;c.length+e.length<b.players.length&&5>f;)b.players.forEach(function(b){if(c.contains(b))g=c,h=e;else if(e.contains(b))g=e,h=c;else return;if(b.opponents.some(function(b){return g.contains(b.opponent)}))return!1;h.merge(b.opponents.map(function(b){return b.opponent}))}),f++;return[c,
e]};return c}();Array.prototype.contains||(Array.prototype.contains=function(c){return 0<=this.indexOf(c)});Array.prototype.merge||(Array.prototype.merge=function(c){c.forEach(function(b){this.contains(b)||this.push(b)}.bind(this))});
CB.Ranking=function(){var c=function(b,c,d,e,q){this.tournament=b;this.round=c;this.rankingOptions=d;this.formatOptions=e;this.players=this.tournament.player;this.tableOptions=q;this.pointMult={win:this.tableOptions.pointsWin,draw:this.tableOptions.pointsDraw,loss:this.tableOptions.pointsLoss};this.init()};c.prototype.tournament=null;c.prototype.round=null;c.prototype.rankingOptions=null;c.prototype.players=null;c.prototype.pointMult=null;c.prototype.tableOptions=null;c.prototype.htmlFormatter={swiss:new CB.Formatter.SwissFormatter,
tourn:new CB.Formatter.RoundRobinFormatter,rapid:new CB.Formatter.SwissFormatter,ko:new CB.Formatter.KoFormatter,match:new CB.Formatter.MatchFormatter,shev:new CB.Formatter.SheveningerFormatter,getFormatter:function(b){return this[b]||this.swiss}};c.prototype.htmlFormatter[CB.Tournament.Types.swiss]=c.prototype.htmlFormatter.swiss;c.prototype.htmlFormatter[CB.Tournament.Types.roundrobin]=c.prototype.htmlFormatter.tourn;c.prototype.htmlFormatter[CB.Tournament.Types.ko]=c.prototype.htmlFormatter.ko;
c.prototype.htmlFormatter[CB.Tournament.Types.match]=c.prototype.htmlFormatter.match;c.prototype.htmlFormatter[CB.Tournament.Types.sheveninger]=c.prototype.htmlFormatter.shev;c.prototype.htmlFormatter[CB.Tournament.Types.koTwo]=c.prototype.htmlFormatter.ko;c.prototype.htmlFormatter[CB.Tournament.Types.team]=c.prototype.htmlFormatter.swiss;c.connected=!1;c.lobby=null;var b=function(b,c,e,l){b=$("<div>",{"class":"player-opponent-box"});var q=$("<div>",{"class":"player-opponent-lines"});l.opponents.forEach(function(b,
c){q.append(d(b));c!=l.opponents.length-1&&q.append($("<hr>",{"class":"opponent-line-seperator"}))});b.append(q);return b},d=function(b){var c=b.round,d=b.opponent.imgSource,e=b.opponent.valuation.nation.html(),q=b.opponent.valuation.title.html();return String.f('<div class="opponent-line"><div class="opponent-line-round">{0}</div><div class="opponent-line-flag">{2}</div><div class ="opponent-line-title">{3}</div><div class="opponent-line-name">{4}</div><div class="opponent-line-elo">{5}</div><div class="opponent-line-color color-{6}"></div><div class="opponent-line-result">{7}</div></div>',
c,d,e,q,b.opponent.valuation.name,b.opponent.valuation.elo,b.isWhite?"white":"black",.5==b.scoredPoints?"&#189;":b.scoredPoints)},e=function(b,c,d,e,q){oppFilterFunc=function(b){return 100<b.opponent.valuation.elo};b=CB.TableMath.calc(e,"avgElo",oppFilterFunc,null,0,0,0);b=Math.round(b);q=CB.TableMath.calc(e,"points",function(b){return!0},null,0,0,q);e=CB.TableMath.sum(e.opponents,function(b){return null!=b.scoredPoints});return String.f('<div class="player-avg-line"><div class ="player-avg-line-avgelo inline-block">&#216 {0}</div><div class ="player-avg-line-points inline-block">{1}/{2}</div></div>',
b,q,e)};c.prototype.startGetPlayerFlag=function(c){var d=[],h=function(b){var c=[];$(".cbtable tr, .cbpairing tr, .cbtable .playerDiv").each(function(d,e,f){$(e).find(".name a").each(function(d,f,g){$(f).text()==b.getDisplayeName()&&c.push({row:e,index:d})})});return c},l=function(b,c){var d=h(b);b.imgSource=c.pic?window.URL.createObjectURL(new Blob([new Uint8Array(c.pic)],{type:"img/png"})):"";d.forEach(function(d,e){var f=d.row,g=d.index,h=(new CB.Nation(c.player.m_NewCBPlayer.m_HighData.m_aNation)).getStrFlag(),
h=String.formatEx("https://pgn.chessbase.com/Common/Media/Flags/Flags{1}/{0}.png",h,64);$(f).find(".flagImg");$($(f).find(".flagImg")[g]).attr("src",h);b.valuation.nation.find(".flagImg").attr("src",h);f=d.row;g=d.index;h=CB.Title.getStr(c.player.m_NewCBPlayer.m_HighData.m_aTitle);$($(f).find(".title")[g]).text(h);b.valuation.title.text(h)})},q=this,r=function(c,d){h(c).forEach(function(f,g){var h=f.row,l=f.index,w=q.pointMult,r=$("<span>",{"class":"player-info-container"}),t;t=c.imgSource;var v=
c.valuation.nation.html(),y=c.valuation.title.html();t=String.formatEx('<div class="player-info-box"><div class="player-info-picture"><img src={0}></img></div><div class="player-info-personal"><div class="player-info-namerow"><div class="player-info-nation inline-block">{1}</div><div class ="player-info-title inline-block">{2}</div><div class ="player-info-name inline-block">{3}</div><div class ="player-info-elo inline-block">{4}</div></div></div></div>',t,v,y,c.valuation.name,c.valuation.elo);t=
$(t);v=b(h,d,l,c);w=e(h,d,l,c,w);r.append(t);r.append($("<hr>",{"class":"player-opponent-box-seperator"}));r.append(v);r.append($("<hr>",{"class":"opponent-average-box-seperator"}));r.append(w);$($(h).find(".playerImageContainer")[l]).append(r);c.valuation.info.append(r.prop("outerHTML"))})},t=function(b){for(var c=0;c<A.length;c++)d.push({player:A[c],data:b[c]});for(c=0;c<d.length;c++)0!=d[c].data.found&&l(d[c].player,d[c].data);for(c=0;c<d.length;c++)0!=d[c].data.found&&r(d[c].player,d[c].data)},
v=[],v=c,y=v.length,A=[],w=function(){0<y||(0<A.length?V15.playerLobby.requestMultiPlayerInfo(A,t,!0):t([]))};v.forEach(function(b){V15.playerLobby.getLocalPlayer(b.firstName,b.lastName,function(c){d.push({player:b,data:c});y--;w()},function(c){A.push(b);y--;w()})})};c.prototype.determinType=function(){return this._isKO()?CB.Tournament.Types.ko:this._isMatch()?CB.Tournament.Types.match:this._isScheveninger()?CB.Tournament.Types.sheveninger:this._isRoundRobin()?CB.Tournament.Types.roundrobin:CB.Tournament.Types.swiss};
c.prototype.determinTypeSoft=function(){if(this._isMatch())return CB.Tournament.Types.match;if(this._isKO())return CB.Tournament.Types.ko;if(this._isRoundRobin())return CB.Tournament.Types.roundrobin;if(this._isTeamTourn()||this.tournament.type==CB.Tournament.Types.roundrobin&&20<this.tournament.player.length)return CB.Tournament.Types.team};c.prototype._isMatch=function(){return 2==this.players.length};c.prototype._isKO=function(){for(var b=this.tournament.availbeRounds.length,c=this.tournament.distinctPlayerForRound(this.tournament.availbeRounds[0]),
d=!1,e=1;e<b&&4<c;e++){var d=!0,q=this.tournament.distinctPlayerForRound(this.tournament.availbeRounds[e]),c=c/q;if(1.8>c||2.2<c)return!1;c=q}return d};c.prototype._isTeamTourn=function(){return this.players.all(function(b){return b.team})};c.prototype._isRoundRobin=function(){var b=this.players.length;if(this.tournament.rounds.length+1===b||12>=b)return!0};c.prototype._isScheveninger=function(){if(3>this.tournament.rounds.length)return!1;var b=[],c=[],d=this.players[0];d.opponents.forEach(function(b){c.push(b.opponent)});
b.push(d);for(var e=!0,q=c,r=b,e=!0,d=0;b.length+c.length<this.players.length&&5>d;)this.players.forEach(function(d){b.contains(d)?(q=b,r=c):c.contains(d)?(q=c,r=b):e=!1;d.opponents.some(function(b){return q.contains(b.opponent)})&&(e=!1);r.merge(d.opponents.map(function(b){return b.opponent}))}.bind(this)),d++;return e&&b.length==c.length&&b.length<=this.players.length/2};c.prototype.init=function(){this.tournament.type=this.tournament.type?this.determinTypeSoft()||this.tournament.type:this.determinType();
var b;b=0<this.round&&"0"!=this.round?function(b){return b.round<=this.round}.bind(this):function(b){return!0};this.players.forEach(function(c){c.allOpponents=c.opponents;c.opponents=c.opponents.filter(b)});this.players.forEach(function(c){c.valuation.points=CB.TableMath.calc(c,"points",b,this.players,0,0,this.pointMult);null!=c.valuation.points&&void 0!=c.valuation.points&&(c.valuation.points=c.valuation.points.toFixed(1));c.valuation.gCount=c.opponents.filter(function(b){return void 0!=b.scoredPoints}).length}.bind(this));
this.rankingOptions.tiebreakInfosArr&&this.rankingOptions.tiebreakInfosArr.length||(this.tournament.type==CB.Tournament.Types.swiss?this.rankingOptions.tiebreakInfosArr=[{propertyName:"bhz",cutOffFront:0,cutOffEnd:0}]:this.tournament.type==CB.Tournament.Types.roundrobin&&(this.rankingOptions.tiebreakInfosArr=[{propertyName:"snb",cutOffFront:0,cutOffEnd:0}]));this.rankingOptions.tiebreakInfosArr.forEach(function(c){this.players.forEach(function(d){var e=CB.TableMath.calc(d,c.propertyName,b,this.players,
c.cutOffFront,c.cutOffEnd),e=void 0!=e&&null!=e&&e.toFixed?e.toFixed(2):e;d.valuation[c.propertyName]=e}.bind(this))}.bind(this));this.players.forEach(function(b){b.valuation.perf=CB.TableMath.calc(b,"perf",function(){return!0},this.players,0,0).toFixed(0);b.valuation.perf=isNaN(b.valuation.perf)?0:b.valuation.perf}.bind(this));var c=CB.Comparer.Comparer.fromTiebrakeInfos(this.rankingOptions.tiebreakInfosArr);c.addComparer(new CB.Comparer.HigherNumberComparer(null,"elo"));this.players.sort(c.compare.bind(c));
CB.System.isMobile()||this.startGetPlayerFlag(this.players);for(var d=this.players[0].valuation.rank=1;d<this.players.length;d++)0===c.compare(this.players[d],this.players[d-1])?this.players[d].valuation.rank=this.players[d-1].valuation.rank:this.players[d].valuation.rank=d+1};c.prototype.createGameLink=function(b,c){var d=$("<a>"),e,q;c.isWhite?(e=b.lastName,q=c.opponent.lastName):(q=b.lastName,e=c.opponent.lastName);e=String.formatEx("http://live.chessbase.com/replay/{2}/0/?w={0}&b={1}",e,q,this.tournament.arcKey.split(" ").join("_"));
d.attr("href",e);null!=c.scoredPoints&&(e=c.scoredPoints.toString().split("0.5").join(".5").split(".5").join("&#189;"),d.html(e));return d};c.prototype.getResultsForPlayer=function(b,c){return b.opponents.filter(function(b){return b.round==c}).sort(function(b,c){return parseInt(b.board)-parseInt(c.board)}).map(function(b){return b.scoredPoints})};c.prototype.getColoredResultsForPlayer=function(b,c){return b.opponents.filter(function(b){return b.round==c}).sort(function(b,c){return parseInt(b.board)-
parseInt(c.board)}).map(function(b){return{isWhite:b.isWhite,points:b.scoredPoints}})};c.prototype.toHtml=function(b){b||(b=1E5);var c=[];c.push(new CB.TablePropertiesDeclarer("rank","Rk."));CB.System.isMobile()||c.push(new CB.TablePropertiesDeclarer("title",""));c.push(new CB.TablePropertiesDeclarer("info","Name"));c.push(new CB.TablePropertiesDeclarer("elo","Rtg."));CB.System.isMobile()||c.push(new CB.TablePropertiesDeclarer("nation","Nt."));c.push(new CB.TablePropertiesDeclarer("points","Pts."));
c.push(new CB.TablePropertiesDeclarer("gCount","n"));this.formatOptions.width=b;return this.htmlFormatter.getFormatter(this.tournament.type).toHtml(this,c,this.rankingOptions,this.formatOptions)};c.prototype.calcPoints=function(b,c){return CB.TableMath.sum(b.allOpponents.filter(function(b){return!c||b.round<c}),function(b){return this.getPoints(b.scoredPoints)}.bind(this))};c.prototype.getPoints=function(b){return 1==b?this.pointMult.win:.5==b?this.pointMult.draw:0==b?this.pointMult.loss:b};Ve.initForListeners(c);
Ve.addEvent(c,"Changed");return c}();
CB.Pairings=function(){var c=function(b){this.ranking=b;this.init()};c.prototype.ranking=null;c.prototype.init=function(){for(var b=function(b){return function(c,d){var e=c.white.valuation["points"+b]+c.black.valuation["points"+b]-(d.white.valuation["points"+b]+d.black.valuation["points"+b]);return 0!=e?-e:-(Math.max(c.white.valuation.elo,c.black.valuation.elo)-Math.max(d.white.valuation.elo,d.black.valuation.elo))}},c=this.ranking.tournament.pairings,e=[],f=0;f<c.length;f++)e.push(this.createPairingsRound(c[f],
this.ranking.tournament.availbeRounds[f])),e[f].sort(b(this.ranking.tournament.availbeRounds[f]));this.pairings=e};c.prototype.createPairingsRound=function(b,c){var e=[];b.forEach(function(b){b.white.valuation["points"+c]=this.ranking.calcPoints(b.white,c);b.black.valuation["points"+c]=this.ranking.calcPoints(b.black,c);e.push(b)}.bind(this));e.roundNr=c;return e};c.prototype.RoundToHtml=function(b){var c=this.pairings[b-1];if(!c)return $("<div data-error='no pairings'>");var e=[];e.push(" Name Rtg. Nt. Pts.  Pts.  Name Rtg Nt.".split(" "));
c=c.slice(0,this.ranking.tableOptions.top||1E4);c.forEach(function(c){var d=[],h=c.white,l=c.black;d.push(h.valuation.title);d.push(h.valuation.info);d.push(h.valuation.elo);d.push(h.valuation.nation);d.push($("<div>",{"class":"points"}).html(this.FancyFraction(h.valuation["points"+b])));d.push(this.createResultLink(c,b));d.push($("<div>",{"class":"points"}).html(this.FancyFraction(l.valuation["points"+b])));d.push(l.valuation.title);d.push($(l.valuation.info.prop("outerHTML")));d.push(l.valuation.elo);
d.push(l.valuation.nation);e.push(d)}.bind(this));return CB.ArrayToTableConverter.convertToHtmlTable(e)};c.prototype.createResultLink=function(b,c){var e=b.result/2,f=1-e;null===b.result&&(e=f="&nbsp;");var g=String.formatEx("http://live.chessbase.com/replay/{2}/{3}/?w={0}&b={1}",b.white.lastName,b.black.lastName,this.ranking.tournament.arcKey.split(" ").join("_"),c);return $("<a>").attr("href",g).html($("<div>",{"class":"result"}).html(this.FancyFraction(e+"-"+f)))};c.prototype.FancyFraction=function(b){return b.toString().split("0.5").join(".5").split(".5").join("&#189;")};
Ve.initForListeners(c);Ve.addEvent(c,"Changed");return c}();"use strict";
CB.PluginManager=function(){var c=function(){$(window).unbind("resize");$(window).on("resize",this.resize.bind(this));this.elementsThatNeedDestroy=[]};c.prototype.init=function(){this.is3D=!1;this.boardTimer=[];this.nActivePlugin=-1;this.instantiated=!1;this.hasPlugins=!0;this.prevWindowWidth=window.innerWidth;this.prevWindowHeight=window.innerHeight;this.socialMedia=!0;this.socialMediaUrl="https://share.chessbase.com/SharedGames"};c.prototype.calcIsVerticalLayout=function(){this.isVerti=1.15*window.innerWidth<
window.innerHeight&&600>window.innerWidth};c.prototype.isVerticalScreen=function(){return 1.2*window.innerWidth<window.innerHeight};c.prototype.createDiv=function(b,c){var f=document.createElement("div");f.id=b;"undefined"!=typeof c&&(f.id+=c);f.className=b;return f};c.prototype.createEl=function(b,c,f){b=document.createElement(b);c&&(b.id=c+(f||0),b.className=c);return b};c.prototype.createUL=function(b,c,f){var g=document.createElement("ul");b&&(g.id=b+(c||0),g.className=b);f.forEach(function(b){var c=
document.createElement("li");g.appendChild(c);$(c).text(b||0)});return g};c.prototype.createJQMenu=function(b,c,f,g,h,l){if(b){var q=0;f.forEach(function(b){b.length>q&&(q=b.length)});var r=this.createDiv(c,g),t=this.createEl("ul","ul"+c,g),v=9;CB.System.isMobile()&&(v=12);if(f.length){for(var y=0;y<f.length;y++){var A=this.createEl("li",c+"-item-"+y+"-",g);f[y]?$(A).html('<a href="#">'+f[y]+"</a>"):$(A).attr("type","separator");t.appendChild(A)}r.appendChild(t);$(b).append(r);y=$("#"+c+g);y.jqxMenu({autoOpenPopup:!1,
mode:"popup",width:16+q*v,animationShowDuration:0,animationHideDuration:0,animationHideDelay:0,animationShowDelay:0,autoCloseInterval:0});y.on("itemclick",function(b){b=b.args.id.match(/[-][0-9]*[-]/);b=b[0].substring(1,b[0].length-1);h(b)});y.on("closed",function(){l&&l()})}y[0].dataset.itemcount=f.length;return y[0]}};c.prototype.togglePopup=function(b,c,f,g){if(f)return $(b).jqxMenu("close"),!1;var h=b.dataset.itemcount;f=$(window).scrollTop();var l=$(window).scrollLeft(),q=c.clientX-20;5>q&&(q=
5);var r=0;CB.System.isMobile()&&(r=2);c=c.clientY-Math.max(60,30+(25+r)*h)+(g||0);$(b).jqxMenu("open",q+l,c+f);CB.System.isMobile()&&$(".jqx-item").css("font-size","18px");return!0};c.prototype._createCanvasParent=function(b){var c=new CB.CanvasParent(b);c.setSize(b.offsetWidth,b.offsetHeight);c.setVisible(!0);return c};CB.LOG=function(b,c,f){};var b=new CB.Vr;c.prototype.resize=function(c,e){this.prevWindowWidth||(this.prevWindowWidth=window.innerWidth);this.prevWindowHeight||(this.prevWindowHeight=
window.innerHeight);((10<Math.abs(window.innerWidth-this.prevWindowWidth)||150<Math.abs(window.innerHeight-this.prevWindowHeight)||!CB.System.isMobile())&&(window.innerWidth!=this.prevWindowWidth||window.innerHeight-this.prevWindowHeight)||e)&&b.exec(function(){0<=this.maximized&&this.fnFullWindow(this.maximized);this.checkRecreateOrientation()||(this.resizePlugins(),this.prevWindowWidth=window.innerWidth,this.prevWindowHeight=window.innerHeight)}.bind(this),600)};c.prototype.resizePlugins=function(){var b=
0;$(this.allPluginClasses).each(function(c,f){this.resizePlugin($(f),b);b++}.bind(this))};c.prototype.launchResizeBoard=function(b,c,f,g){this.boardTimer[b]&&this.boardTimer[b].stop();this.boardTimer[b]=new CB.Timer(function(){this.modules[b].boardArea&&this.resizeBoard(b,c,f)}.bind(this));this.boardTimer[b].runOnce(g)};c.prototype.resizeBoard=function(b,c,f){this.boardTimer[b]&&this.boardTimer[b].stop();this.modules[b].boardArea.setPosSize(0,0,c,f);this.modules[b].multiBoardCanvas&&this.modules[b].multiBoardCanvas.setPosSize(0,
0,c,f)};c.prototype.isMobileLayout=function(){return this.isVerticalScreen()};c.prototype.checkRecreateOrientation=function(){this.currentMobileLayout!==this.isMobileLayout()&&(this.recycled=[],this.destroyBoardMessage(),$(this.allPluginClasses).each(function(b,c){this.recycled[b]={};this.recycled[b].boardArea=this.modules[b].boardArea;this.recycled[b].boardWin=this.modules[b].boardArea.canvas.control.boards[0];this.recycled[b].kernel=this.modules[b].getKernel();$(c).empty()}.bind(this)),this.init(),
this.createPlugins(),this.onRecreate())};c.prototype.onRecreate=function(){};c.prototype.checkBoardAreaChange=function(b,c,f){if(this.modules[f].boardAreaW==b&&this.modules[f].boardAreaH==c)return!1;this.modules[f].boardAreaW=b;this.modules[f].boardAreaH=c;return!0};c.prototype.resizeActivePlugin=function(){this.resizePlugin($($(this.allPluginClasses)[this.nActivePlugin]),this.nActivePlugin)};c.prototype.isOnChessBaseCom=function(){return-1!=document.URL.search(/en.chessbase.com/i)||-1!=document.URL.search(/de.chessbase.com/i)||
-1!=document.URL.search(/es.chessbase.com/i)};c.prototype.instantiateButtons=function(b,c,f,g,h,l){for(var q="",r=0;r<g.length;r++){if(g[r].title){var t=h;g[r].css&&(t+=" "+g[r].css);var v="";g[r].subtxt?v=String.f("<span class='btnSubText'>{0}</span>",g[r].subtxt):g[r].txt&&(v=g[r].txt);q+=String.f('<{6} title="{0}" id="{4}-btn{1}-{2}" class="{3}">{5}</{6}>',g[r].title,g[r].id,l,t,f,v,b)}else q+='<span class="toolBarSep"/>';this.buttonImages[l]&&(this.buttonImages[l][g[r].id]=g[r].id,g[r].pic&&(this.buttonImages[l][g[r].id]=
g[r].pic))}$(c).html(q);for(r=0;r<g.length;r++)g[r].id&&(b=$(String.f("#{2}-btn{0}-{1}",g[r].id,l,f)),c=function(b,c){return function(d){this.nActivePlugin=c;g[b].handler(c,d);d.preventDefault()}}.call(this,r,l),function(b,c){return function(b){this.nActivePlugin=c;b.preventDefault()}}.call(this,r,l),b[0]&&(b[0].onclick=c))};c.prototype.setButtonImages=function(b,c,f,g,h,l,q){if(c)for(var r='url( "'+CB.getCommonPath()+'Media/Ribbons/{2}/{0}{1}.png" )',t=0;t<c.length;t++)if(c[t].id&&this.buttonImages[h]){var v=
$(String.f("#{2}-btn{0}-{1}",c[t].id,h,b));v.css("background-image",String.f(r,this.buttonImages[h][c[t].id],f,l));q&&v.css("background-position",q);var y=g;c[t].css&&(y+=" "+c[t].css);v.attr("class",y)}};c.prototype.getKernel=function(){if("undefined"!=typeof this.nActivePlugin){if(this.modules[this.nActivePlugin]&&this.modules[this.nActivePlugin].getKernel())return this.modules[this.nActivePlugin].getKernel()}else if(this.modules[0])return this.modules[0].getKernel();return null};c.prototype.showPosText=
function(b,c){};c.prototype.showMessage=function(b){this.showBoardMessage(b,2E3)};c.prototype.showBoardMessage=function(b,c){this.getKernel()&&this.getKernel().boardWin&&(this.getKernel().boardWin.addMessage(b,!0),c&&(new CB.Timer(function(){this.getKernel().boardWin.destroyMessage()}.bind(this))).runOnce(c))};c.prototype.create2DBoardArea=function(b){$("#boardArea"+b).empty();this.modules[b].boardArea=this._createCanvasParent(this.modules[b].panels.boardParent);this.modules[b].boardArea.setVisible(!0);
this.resize();this.resizePlugins()};c.prototype.create3DBoardArea=function(b){$("#boardArea"+b).empty();this.modules[b].boardArea=this._createCanvasParent3D(this.modules[b].panels.boardParent,b);this.modules[b].boardArea.setVisible(!0);this.resize();this.resizePlugins()};c.prototype._createCanvasParent3D=function(b,c){var f=new CB.CanvasParent3D(b,"3d"),f=f.createCanvas(this.on3DLoaded);this.board=new CB.BoardControl3D(f.canvas,100,100,"FritzBoard",this.on3DLoaded.bind(this),c);this.modules[c].board3d=
this.board;f.setPosSize(b.offsetLeft,b.offsetTop,b.offsetWidth,b.offsetHeight);f.setVisible(!0);return f};c.prototype.on3DLoaded=function(b){this.modules[b].getKernel().setBoardWin(this.modules[b].board3d)};c.prototype.onControlReady=function(){};c.prototype.getBoardTopOffset=function(){return Math.min(30,window.innerHeight/35)};c.prototype.toggle3DBoard=function(b){CB.LogStats("Toggle3D");this.is3D?this.create2DBoardArea(b):this.create3DBoardArea(b);this.is3D=!this.is3D};c.prototype.getMultiBoardOptions=
function(){return{topDist:0,bottomDist:0,marginDistDivisor:80,shiftXPercent:-1.7,minWForCoordinates:260,splitLayout:!0,suppressCalcGeometry:!0}};c.prototype.setAutoShowEngine=function(){};c.prototype.getSplitterWidth=function(){return CB.System.isMobile()?8:1800<screen.width?7:6};c.prototype.saveSplitSize=function(b,c){try{var f=$("#"+b+c);if(f.length){var g=$(f).jqxSplitter("panels");g&&g[0]&&V15.Vf.save(b+"size",g[0].size)}}catch(h){CB.LogException("RWM:saveSplitSize",h)}};c.prototype.loadSplitSize=
function(b,c){var f=V15.Vf.load(b+"size");return{size:parseFloat(f),coll:!1}};c.prototype.setSplitSize=function(b,c,f){$("#"+b+c).jqxSplitter({width:"100%",height:"100%",panels:[{size:f+"%"},{size:100-f+"%"}]})};c.prototype.createDiagramPlayingMode=function(b){return new CB.PlayingMode};c.prototype.useBackgroundFilter=function(){return!1};c.prototype.useMatBalanceDefault=function(){return!0};c.prototype.pgnLinkClickHandler=function(b,c,f){document.getElementById(c);V15.isPremium()||V15.forceGuestLogon()?
(f=f(),c=CB.PGNWriter.toPGN(f),f=f.hdr.getStrPlayers(!1,0)+".pgn",window.Blob?(console.log("Blob DL: "+f),c=new Blob([c],{type:"text/plain;charset=utf-8"}),window.saveAs(c,f),b.preventDefault()):0<CB.System.getIEVersion()&&(window.clipboardData&&clipboardData.setData&&(alert("On Internet Explorer the game has been pasted to the clipboard ('Ctrl-V')"),clipboardData.setData("Text",c)),b.preventDefault()),CB.LogStats("PGN")):(alert("You need a Premium Account to download PGN files."),b.preventDefault())};
c.prototype.isAnnoFieldVisible=function(){return this.annoField&&this.annoField.is(":visible")};c.prototype.openAnnoField=function(){this.addAnnoField()};c.prototype.closeAnnoField=function(){this.removeAnnoField()};c.prototype.isAnnoFieldOpen=function(){return this.isAnnoFieldVisible};c.prototype.toggleAnnoField=function(){this.isAnnoFieldVisible()?this.removeAnnoField():this.addAnnoField()};c.prototype.addAnnoField=function(){void 0===this.annoField?($("#annoEdit")[0]&&$("#annoEdit").remove(),this.annoField=
CB.Fields.createTextField("annoEdit","","Enter text annotation",function(b,c){V15.gameKernel.onAnnoEnter(b,c)})):this.annoField.show();$(this.annoField).insertBefore("#notaToolbar0");$(this.annoField).focus()};c.prototype.removeAnnoField=function(){$(this.annoField).blur();$(this.annoField).hide();delete this.annoField};c.prototype.setAnnoFieldText=function(b){void 0!==this.annoField&&$(this.annoField).val(b)};c.prototype.fitsHorizontally=function(b,c){var f=$(document.body).width(),g=$("#"+b).outerWidth(),
h=$("#"+b)[0].getBoundingClientRect();return(h.x||h.left)+g+c<f};c.prototype.adaptRibbonButtons=function(b,c){if(0!=b.length){for(var f=0,g=$("td.ribbonTD:visible").last().find('div[role="button"]:visible');g&&!this.fitsHorizontally(g[0].id,c||24);){$("#"+b[f]).closest("td").hide();f++;if(f==b.length)break;g=$("td.ribbonTD:visible").last().find('div[role="button"]:visible')}0<f&&$(".ribbonSeparator").remove();CB.System.runsInIFrame()&&($("#idLoginStart").hide(),$("#idAccount").hide())}};c.prototype.createInfoPanel=
function(b,c){if(!CB.System.isMobile()&&!CB.System.runsInIFrame()){this.infoPanel&&$("#"+this.infoPanel.id).remove();var f,g,h,l;c||V15.isLoggedIn()?(f=450<window.innerHeight?28:20,g=this.getLoggedInHtml(),h="CBInfoLoggedIn flex-fixed",l=this.getLoginInfoGradient()+";color:white;text-transform:uppercase;"):(g=this.getPleaseLoginHtml(),h="CBInfoNotLoggedIn flex-fixed",l="background-color:white;color:black;text-transform:none;");h=$("<div id='infoDiv' class='"+h+"'></div>");$(h).css({border:1,overflow:"auto"});
f&&$(h).css("line-height",String(f)+"px");$(h).attr("style",$(h).attr("style")+l);$(h).html(g);$(b).prepend(h);this.infoPanel=$(h)[0];this.infoPanel.loggedIn=V15.isLoggedIn();this.infoPanel.setHeight=function(b){};return this.infoPanel}return null};c.prototype.createLanguageButton=function(b){V15.getAvailableLanguages()&&(b=b.concat([{id:"idLanguageOptions",buttons:[{id:"idSelectLanguage",text:lm.LANGUAGE,icon:"Language"}]}]));return b};c.prototype.openLanguageMenu=function(){var b=$("#idSelectLanguage").position(),
c=$("#idSelectLanguage").height(),f=b.left+2,b=b.top+c+14,c=this.createLanguageMenu($("#idSelectLanguage")[0]);$(c).jqxMenu("open",f,b);$(c).jqxMenu({theme:"chessbase",width:150})};c.prototype.createLanguageMenu=function(b){for(var c=V15.getAvailableLanguages(),f=CB.Language.getNativeLangNames(c),g=CB.Language.getFlagNames(c),h=[],l=0;l<g.length;l++)h.push("<img style='float: left; margin-right: 5px;' src='"+this.getLanguageFlagIcon(g[l],16)+"' />"+f[l]);for(var q=[],l=0;l<g.length;l++)f={index:l,
commandId:glSettings.getCommandIdOfLanguage(c[l])},q.push(f);return this.createJQMenu(b,"languagesMenu",h,0,function(b){var c=$.grep(q,function(c){return c.index===parseInt(b)})[0].commandId;glSettings.changeLanguage(c)},function(){})};c.prototype.openAccountMenu=function(){var b=$("#idAccount").position(),c=$("#idAccount").height(),f=b.left+2,b=b.top+c+14,c=this.createAccountMenu($("#idAccount")[0]);$(c).jqxMenu("open",f,b);$(c).jqxMenu({theme:"chessbase",width:150})};c.prototype.createAccountMenu=
function(b){return this.createJQMenu(b,"accountMenu",[lm.ACCOUNT,lm.LOGOUT],0,function(b){switch(parseInt(b)){case 0:V15.panelMgr.openAccountPage();break;case 1:V15.panelMgr.logOut()}},function(){})};c.prototype.createAccountOptionsButton=function(b){return b=b.concat([{id:"idAccountOptions",buttons:[{id:"idLoginStart",text:lm.LOGIN,icon:"Key"},{id:"idAccount",text:lm.ACCOUNT,icon:"Account"}]}])};c.prototype.showAccountsForm=function(b,c,f){b=CB.DOM.getAccountNameCookie(!0);(new CB.AccountForm).createLoginForm(lm.LOGIN,
function(b){V15.Vf.userName=b.idUser;V15.Vf.password=b.idPassword;V15.Vf.loginMode=CB.LoginMode.NORMAL;(new CB.AccountsManager(V15.shortAppName)).pwLogin(V15.Vf.userName,V15.Vf.password,V15.receiveTokenHandler.bind(V15))}.bind(this),function(b){f&&f()}.bind(this),b)};c.prototype.getLanguageFlagIcon=function(b,c){return V15.config.getFlagPath(c)+b+".png"};c.prototype.setAnnoEditCss=function(){var b=$("#notaToolbar0").position().top,c=$("#notaToolbar0 ").width();$("#annoEdit").css({top:String(b-24)+
"px",width:String(c-10)+"px",height:"22px"})};c.prototype.getNotationToolBarItemsHtml=function(b,c){var f=[{id:"downloadPgnId",title:"Download PGN",imgSrc:"../../Common/Media/Ribbons/MyGames/Download16.png",clickHandler:function(b){V15.panelMgr.pgnLinkClickHandler(b,"downloadPgnId",function(){return V15.panelMgr.getKernel().game})}},{id:"btnFritzOnline",title:"Play out in Fritz Online",imgSrc:"../../Common/Media/Ribbons/MyGames/FritzOnline16.png",clickHandler:function(){V15.passToFritzOnline(V15.panelMgr.getKernel().game)}},
{id:"btnTextBefore",title:lm.TEXT_BEFORE_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/Pretext16.png",clickHandler:function(){V15.gameKernel.execCommand(b.ADD_PRE_TEXT);V15.panelMgr.setAnnoEditCss()}},{id:"btnTextAfter",title:lm.TEXT_AFTER_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/Posttext16.png",clickHandler:function(){V15.gameKernel.execCommand(b.ADD_POST_TEXT);V15.panelMgr.setAnnoEditCss()}},{id:"btnStartLine",title:lm.START_LINE_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/StartLine16.png",clickHandler:function(){V15.gameKernel.execCommand(b.START_LINE)}},
{id:"btnPromoteLine",title:lm.PROMOTE_LINE_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/PromoteLine16.png",clickHandler:function(){V15.gameKernel.execCommand(b.PROMOTE_LINE)}},{id:"btnDeleteLine",title:lm.DELETE_LINE_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/DeleteLine16.png",clickHandler:function(){V15.gameKernel.execCommand(b.DELETE_LINE)}},{id:"btnCutLine",title:lm.CUT_LINE_TIP,imgSrc:"../../DocuWeb/Images/Buttons/16/CutLine16.png",clickHandler:function(){V15.gameKernel.execCommand(b.CUT_LINE)}},
{id:"btnMarkGood",title:"Good move",imgSrc:"../../DocuWeb/Images/Buttons/16/Good16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_GOOD)}},{id:"btnMarkBad",title:"Bad move",imgSrc:"../../DocuWeb/Images/Buttons/16/Bad16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_BAD)}},{id:"btnMarkVeryGood",title:"Very good move",imgSrc:"../../DocuWeb/Images/Buttons/16/VeryGood16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_VERYGOOD)}},{id:"btnMarkVeryBad",title:"Very bad move",
imgSrc:"../../DocuWeb/Images/Buttons/16/VeryBad16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_VERYBAD)}},{id:"btnMarkInteresting",title:"Interesting move",imgSrc:"../../DocuWeb/Images/Buttons/16/Interesting16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_INTERESTING)}},{id:"btnMarkDubious",title:"Dubious move",imgSrc:"../../DocuWeb/Images/Buttons/16/Dubious16.png",clickHandler:function(){V15.gameKernel.execCommand(b.MARK_DUBIOUS)}},{id:"btnMarkMyMove",title:"Mark as My Move",
imgSrc:"../../DocuWeb/Images/Buttons/16/MyMove16.png",clickHandler:function(){V15.markCurrentMove(V15.gameKernel,!1)}},{id:"btnMarkImportantMove",title:"Mark as Important Move",imgSrc:"../../DocuWeb/Images/Buttons/16/ImportantMove16.png",clickHandler:function(){V15.markCurrentMove(V15.gameKernel,!0)}},{id:"btnUnmarkMove",title:"Unmark current move",imgSrc:"../../DocuWeb/Images/Buttons/16/Erase16.png",clickHandler:function(){V15.unMarkCurrentMove(V15.gameKernel)}},{id:"btnWhiteSlightly",title:"White has a slight advantage",
imgSrc:"../../DocuWeb/Images/Buttons/16/WhiteSlightly16.png",clickHandler:function(){V15.gameKernel.execCommand(b.WHITE_SLIGHTLY)}},{id:"btnEqual",title:"The position is equal",imgSrc:"../../DocuWeb/Images/Buttons/16/Equal16.png",clickHandler:function(){V15.gameKernel.execCommand(b.EQUAL)}},{id:"btnUnclear",title:"The position is unclear",imgSrc:"../../DocuWeb/Images/Buttons/16/Unclear16.png",clickHandler:function(){V15.gameKernel.execCommand(b.UNCLEAR)}},{id:"btnBlackSlightly",title:"Black has a slight advantage",
imgSrc:"../../DocuWeb/Images/Buttons/16/BlackSlightly16.png",clickHandler:function(){V15.gameKernel.execCommand(b.BLACK_SLIGHTLY)}},{id:"btnWhiteBetter",title:"White is better",imgSrc:"../../DocuWeb/Images/Buttons/16/WhiteBetter16.png",clickHandler:function(){V15.gameKernel.execCommand(b.WHITE_BETTER)}},{id:"btnBlackBetter",title:"Black is better",imgSrc:"../../DocuWeb/Images/Buttons/16/BlackBetter16.png",clickHandler:function(){V15.gameKernel.execCommand(b.BLACK_BETTER)}},{id:"btnWhiteWins",title:"White is winning",
imgSrc:"../../DocuWeb/Images/Buttons/16/WhiteWins16.png",clickHandler:function(){V15.gameKernel.execCommand(b.WHITE_WINS)}},{id:"btnBlackWins",title:"Black is winning",imgSrc:"../../DocuWeb/Images/Buttons/16/BlackWins16.png",clickHandler:function(){V15.gameKernel.execCommand(b.BLACK_WINS)}},{id:"btnCompensation",title:"Material compensation",imgSrc:"../../DocuWeb/Images/Buttons/16/Compensation16.png",clickHandler:function(){V15.gameKernel.execCommand(b.COMPENSATION)}}];this.addSocialMediaButtons(f,
"../../DocuWeb/Images/Buttons/16/");var g=$(c).width()-60;this.showNotationToolbarItems(g,26,f,$(c))};c.prototype.addSocialMediaButtons=function(b,c){this.socialMedia&&(b.splice(0,0,{id:"btnShareGame",title:"Share game",imgSrc:c+"Social16.png",clickHandler:function(){$("#btnShareGame").attr("disabled",!0);V15.panelMgr.shareGame(V15.gameKernel.game);$("#btnShareGame").removeAttr("disabled")}}),b.splice(0,0,{id:"btnLikeGame",title:"Like game",imgSrc:c+"LikeNew16.png",clickHandler:function(){V15.isLoggedIn()?
($("#btnLikeGame").attr("disabled",!0),V15.panelMgr.likeGame(V15.gameKernel.game),$("#btnLikeGame").removeAttr("disabled")):V15.panelMgr.showAlert("You need to be logged in to like games.",350,130)}}))};c.prototype.shareGame=function(b){var c=this.socialMediaUrl+"/Share/",f=CB.PGNWriter.toPGN(b);b={gameText:encodeURIComponent(f),moveIndex:String(b.getMoveIndex())};$.ajax({url:c,method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(b),success:function(b){V15.panelMgr.showShareWindow(b.Url)},
error:function(b,c,d){alert(d)}})};c.prototype.showShareWindow=function(b){var c=.9*$(window).width(),f=.9*$(window).height(),g=this.createDiv("divShareWindow",0);$(g).css({position:"fixed",left:"50%",top:"50%"});b="<div>   <div style='width: 100%; height: 100%;'>"+("      <iframe style='border: 0;' width='100%' height='99%' src='"+b+"'></iframe>")+"   </div></div>";$(g).html(b);$(g).jqxWindow({title:"ChessBase - Share Game",width:c,height:f,resizable:!1,draggable:!1,isModal:!0,theme:V15.config.jqxTheme,
modalOpacity:.3,showCloseButton:!0})};c.prototype.likeGame=function(b){var c=this.socialMediaUrl+"/Like/";b={userName:encodeURIComponent(V15.Vf.userName),gameText:encodeURIComponent(CB.PGNWriter.toPGN(b))};$.ajax({url:c,method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify(b),success:function(b){V15.panelMgr.showAlert(b.Message,600,210)},error:function(b,c,d){alert(d)}})};c.prototype.showAlert=function(b,c,f){var g=this.createDiv("divAlert",0);$(g).css({position:"fixed",
left:"50%",top:"50%"});b="<div style='text-align: center;'>   <div style='display: inline-block; word-break: break-word; padding: 10px;'>"+b+"      <br /><br /><button id='btnOK'>OK</button>   </div>";b+="</div>";$(g).html(b);$(g).jqxWindow({title:"Information",width:c,height:f,resizable:!1,draggable:!1,isModal:!0,modalOpacity:.3,showCloseButton:!1});$(g).find("#btnOK").jqxButton();$(g).find("#btnOK").click(function(){$(g).jqxWindow("close")})};c.prototype.showNotationToolbarItems=function(b,c,f,
g){var h=Math.floor(b/c);1>h&&(h=1);h<f.length?h--:h>f.length&&(h=f.length);b="";for(c=0;c<h;c++)b+="<button title='"+f[c].title+"' id='"+f[c].id+"'><img src='"+f[c].imgSrc+"' /></button>";h<f.length&&(b+="<button title='More symbols' id='btnMore'><b>...</b></button>");$(g).html(b);for(c=0;c<h;c++)$(g).find("#"+f[c].id)[0].addEventListener("click",f[c].clickHandler,!1);h<f.length&&$(g).find("#btnMore").click(function(){var b=$(g).find("#btnMore")[0].getBoundingClientRect(),c=b.left-280,b=b.top-26*
(f.length-h)-5;V15.panelMgr.showNotationToolbarItemsThatDoNotFit($(g).find("#btnMore"),c,b,f,h+1)})};c.prototype.showNotationToolbarItemsThatDoNotFit=function(b,c,f,g,h){var l=function(){$("#menuWrappernotationToolbarMenu0")[0]&&$("#menuWrappernotationToolbarMenu0").remove();for(var c=[],e=h-1;e<g.length;e++)c.push("<img style='float: left; margin-right: 5px;' src='"+g[e].imgSrc+"' />"+g[e].title);return V15.panelMgr.createJQMenu(b,"notationToolbarMenu",c,0,function(b){g[parseInt(b)+h-1].clickHandler()},
function(){})}();$(l).jqxMenu("open",c,f);$(l).jqxMenu({theme:"chessbase",width:300})};c.prototype.showToolTip=function(b,c,f,g,h){if(b&&c){var l=$("#"+b);l.length&&(l.jqxTooltip({content:c,theme:V15.config.jqxTheme,position:g||"bottom",name:b}),f&&(l.jqxTooltip("open"),l.jqxTooltip("close",f)),h&&(new CB.Timer(function(){l.jqxTooltip("destroy")})).runOnce(h))}};c.prototype.destroyToolTip=function(b){$("#"+b).length&&$("#"+b).jqxTooltip("destroy")};c.prototype.createSwitchAppBar=function(b,c){var f=
this.createDiv("switchBar",c);$(b).append(f);this._initSwitchToolBar(f,c)};c.prototype._initSwitchToolBar=function(b,c){var f=$('<div class="cbSwitchToolBar" id="switch-tb"></div>');$(b).append(f);var g=this,f=[];this.switchAppBtns=f=f.concat([{title:"Live Chess",id:"switch-Live",pic:"Live",subtxt:"Live Chess",handler:function(){g.redirectToLivePage()}},{title:"Tactics",id:"switch-Tactics",pic:"Tactics",subtxt:"Tactics",handler:function(){g.redirectTo("tactics")}},{title:"Videos",id:"switch-Videos",
pic:"Videos",txt:"",subtxt:"Videos",handler:function(){g.redirectTo("videos")}},{title:"Fritz",id:"switch-Fritz",pic:"Fritz",subtxt:"Fritz",handler:function(){g.redirectTo("fritz")}},{title:"Database",id:"switch-Database",pic:"Database",subtxt:"Database",handler:function(){g.redirectTo("database")}},{title:"Openings",id:"switch-Openings",pic:"Openings",subtxt:"Openings",handler:function(){g.redirectTo("openings")}},{title:"My Own Games",id:"switch-Mygames",pic:"mygames",subtxt:"My Games",handler:function(){g.redirectTo("mygames")}},
{title:"Chess Quiz",id:"switch-quiz",pic:"quiz",subtxt:"Quiz",handler:function(){g.redirectTo("quiz")}},{title:"Players",id:"switch-players",pic:"players",subtxt:"Players",handler:function(){g.redirectTo("players")}},{title:"News",id:"switch-news",pic:"news",subtxt:"News",handler:function(){g.redirectTo("en")}},{title:"Studies",id:"switch-studies",pic:"studies",subtxt:"Studies",handler:function(){g.redirectTo("studies")}}]);this.instantiateButtons("button",b,"a",f,"switchAppBtn",0);this.adaptSwitchAppButtons();
this.setButtonImages("a",this.switchAppBtns,32,"switchAppBtn",c,"Switch","center 3px")};c.prototype.switchAppButtonfitsVertically=function(b,c){var f=$(document.body).height(),g=$("#"+b).outerHeight();return $("#"+b).position().top-f+g+c<f};c.prototype.adaptSwitchAppButtons=function(){function b(c){return c.id===f[g]}for(var c=["a-btnswitch-quiz-0","a-btnswitch-news-0"],f=["switch-quiz","switch-news"],g=0,h=$(".switchAppBtn").last();g<c.length&&!this.switchAppButtonfitsVertically(h[0].id,24);)$("#"+
c[g]).hide(),this.switchAppBtns.splice(this.switchAppBtns.findIndex(b),1),g++,h=$(".switchAppBtn").last()};c.prototype.redirectToLoginPage=function(){window.location=this.getLoginPageUrl()};c.prototype.createLogDiv=function(b){this.logDiv=this.createEl("div","logDiv");$(b).append(this.logDiv);$(this.logDiv).html("<h1>CB.LOG( x )</h1>");CB.LOG=function(b,c,d){"Beefy"===d&&(b=$(String.f("<div class='cbLogLine {0}'>{1}</div>",c,b)),$(this.logDiv).append(b),b[0].scrollIntoView())}.bind(this)};c.prototype.getLoginPageUrl=
function(){return CB.System.isCordova()||CB.System.isMobile()?"https://live.chessbase.com/LogonIos?returnurl="+encodeURIComponent(document.location):"https://live.chessbase.com/Logon?returnurl="+encodeURIComponent(document.location)};c.prototype.getCreateAccountUrl=function(){CB.System.isCordova()||CB.System.isMobile();return"https://live.chessbase.com/createAccount?returnurl="+encodeURIComponent(document.location)};c.prototype.redirectToLivePage=function(){CB.LogStats("Live");this.redirectTo("live")};
c.prototype.openAccountPage=function(){window.open("https://account.chessbase.com/en/me")};c.prototype.openRegisterPage=function(){var b=this.getCreateAccountUrl();window.location.href=b};c.prototype.redirectTo=function(b,c){var f=String.f("https://{0}.chessbase.com",b);c?window.open(f):window.location=f};c.prototype.setPgn=function(b,c){if(c){var f=new CB.Game;f.assign(CB.PGN.parseGame(c));b.getKernel().playFromPgnGame=f}};c.prototype.drawButtonHintArrow=function(b,c,f){this.drawOnFlashedCanvas(function(f){var h=
$(b).offset().left,l=$(b).offset().top,q=$(b).width();CB.BoardArrow.drawFree(f,h-10,l+120,h+.4*q,l+20,9,"hsla( 130, 50%, 50%, 0.9 )");f.font="bold 30px Roboto";f.fillStyle="hsla( 120, 50%, 100%, 1.0 )";f.fillText(c,h+10,l+120)}.bind(this),f)};c.prototype.drawOnFlashedCanvas=function(b,c,f){var g=$(String.f("<canvas width={0}, height={1}>",window.innerWidth-10,window.innerHeight-10));$(document.body).append(g);$(g).css("zIndex",900);$(g).css("left",4);$(g).css("top",4);$(g).css("position","fixed");
$(g).click(function(){g.remove()});b(g[0].getContext("2d"));(new CB.Timer(function(){g.remove()})).runOnce(c||2E3)};c.prototype.log=function(b){};c.prototype.logIntoChat=function(b,c){6};c.prototype.chatOut=function(){};c.prototype.handleCommonKeyDown=function(b){if("INPUT"==b.target.nodeName||"TEXTAREA"==b.target.nodeName)return!0;if(this.instantiated){var c=!0,f=this.modules[0].getKernel();switch(b.which){default:c=!1;break;case 37:f.Vk.mayNavigate()&&f.game.gotoPrev();break;case 39:f.Vk.mayNavigate()&&
f.game.gotoNext();break;case 40:b.altKey&&(this.newGame?this.newGame():V15.execCommand(CB.CommandIds.NEW_GAME));break;case 66:b.ctrlKey&&f.boardWin&&f.boardWin.flipBoard();break;case 113:b.altKey&&(this.fnAnalysis?V15.panelMgr.studyMode&&V15.panelMgr.studyMode==CB.StudyMode.PLAYING||this.fnAnalysis():V15.execCommand(CB.CommandIds.TOGGLE_ANALYSIS_ENGINE));break;case 187:this.fnIncMultiVars&&!this.isMobileLayout()&&this.fnIncMultiVars(1);break;case 189:this.fnIncMultiVars&&!this.isMobileLayout()&&this.fnIncMultiVars(-1)}c&&
b.preventDefault();return c}};return c}();"use strict";
CB.AccountsManager=function(){var c=function(b){if(!b)throw"Accountsmanager: App required";this.app=b||"playchess";this.server=V15.config.getAccountUris()[0];this.backupServer=V15.config.getAccountUris()[1]};c.prototype.getxmlRequest=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")};c.prototype.pwLogin=function(b,c,f,g){CB.LOG("AM, PWLogin:"+b+"/"+c,"","acc");if(b&&c){b=this.encodeAndBase64(b);var h=this.getCmdKey(b,"chk");this.doQuery({cmd:"chk",user:b,
app:this.app,pass:this.encodeAndBase64(c),key:h},function(b){b&&f(b,g)})}else f({error:!0},g)};c.prototype.tokenHandler=function(b){};c.prototype.tokenLogin=function(b,c,f){CB.LOG("AM, TokenLogin:"+c);b=this.encodeAndBase64(b);var g=this.getCmdKey(b,"get");this.doQuery({cmd:"get",user:b,app:this.app,token:c,key:g},f)};c.prototype.changePassword=function(b,c,f,g,h){b=this.encodeAndBase64(b);var l=this.getCmdKey(b,"pw");this.doQuery({cmd:"pw",user:b,app:this.app,old:this.encodeAndBase64(c),"new":this.encodeAndBase64(f),
token:g,key:l},h)};c.prototype.activateTrainer=function(b,c,f,g){var h=this.encodeAndBase64(c),h=this.getCmdKey(h,"activatecenapp");this.doQuery({cmd:"activatecenapp",guid:b,serial:c,productid:f,key:h,user:this.encodeAndBase64(c)},g)};c.prototype.deactivateTrainer=function(b,c,f){var g=this.encodeAndBase64(c),g=this.getCmdKey(g,"deactivatecenapp");this.doQuery({cmd:"deactivatecenapp",guid:b,serial:c,key:g,user:this.encodeAndBase64(c)},f)};c.prototype.getFriends=function(b,c,f,g){b=this.encodeAndBase64(b);
var h=this.getCmdKey(b,"getfr");this.doQuery({cmd:"getfr",user:b,token:c,friendtype:f,key:h},g)};c.prototype.setFriends=function(b,c,f,g,h){for(var l="",q=0;q<g.length;q++)l+=g[q]+",";g=this.encodeAndBase64(l);b=this.encodeAndBase64(b);l=this.getCmdKey(b,"setfr");this.doQuery({cmd:"setfr",user:b,token:c,friendtype:f,friends:g,key:l},h)};var b;c.prototype.doQuery=function(c,e){CB.LOG("Accounts Query: "+c.cmd,"","acc");var f=[],g;for(g in c)f.push(encodeURIComponent(g)+"="+encodeURIComponent(c[g]));
var h=f.join("&"),l=this.getxmlRequest();l.open("POST",this.server);l.setRequestHeader("Content-type","application/x-www-form-urlencoded");l.setRequestHeader("X-Requested-With","XMLHttpRequest");b=new CB.Timer(function(){l.abort();this.server!==this.backupServer?(this.server=this.backupServer,l.open("POST",this.backupServer),l.send(h)):e({timeout:!0})}.bind(this));b.runOnce(3E3);l.onload=function(){b.stop();if(4===l.readyState&&200===l.status){var c=l.responseText;e(c?JSON.parse(c):{})}else e({})};
l.onerror=function(c){CB.LOG("Accounts Error: "+c.data);b.stop();this.server!=this.backupServer?(this.server=this.backupServer,l.open("POST",this.backupServer),l.send(h),console.log("Retry AccountServer")):e({error:!0})}.bind(this);l.send(h)};c.prototype.getCmdKey=function(b,c){0==b.Length&&(b="nameCoded");for(var f=c+b,g=b.split(""),h=c.split(""),f=f.split(""),l=0,q=0,r=0;r<f.length;r++)0!=(r&1)&&l<h.length?(f[r]=h[l],l++):q<g.length&&(f[r]=g[g.length-q-1],q++);return this.encodeAndBase64(f.join(""))};
c.prototype.encodeAndBase64=function(b){b=CB.strUtil.escapeHtmlEntities(b);return CB.strUtil.base64.encode(b)};return c}();"use strict";CB.AccountForm=function(){var c=function(){};c.prototype.createLoginForm=function(b,c,e,f){(new CB.Form({id:"loginForm",title:b,width:320,height:230,modal:!0,okHandler:c,cancelHandler:e,fields:[{caption:"User:",type:"string",id:"idUser",val:f},{caption:"Password:",type:"password",id:"idPassword",val:""}],focusField:"idUser",accountButton:!0})).create()};return c}();
"use strict";
CB.SerialForm=function(){var c=function(){};c.prototype.validator=function(b){$(b).jqxValidator({rules:[{input:"#idSerial0",message:"!",action:"keyup",rule:function(b,c){return 5===b.val().length?!0:!1}},{input:"#idSerial1",message:"",action:"keyup",rule:function(b,c){return 5===b.val().length?!0:!1}},{input:"#idSerial2",message:"",action:"keyup",rule:function(b,c){return 5===b.val().length?!0:!1}},{input:"#idSerial3",message:"",action:"keyup",rule:function(b,c){return 5===b.val().length?!0:!1}},
{input:"#idSerial4",message:"!",action:"keyup",rule:function(b,c){return 5===b.val().length?!0:!1}}]})};c.prototype.createSerialForm=function(b,c,e,f){f="";if(window.clipboardData&&clipboardData.getData){var g=clipboardData.getData("Text");34<=g.length&&(f=g)}CB.System.isElectron()&&"undefined"!==typeof electronBridge&&(g=electronBridge.readFromClipboard().trim(),34<=g.length&&(f=g));b=new CB.Form({id:"serialForm",title:b,width:720,height:200,modal:!0,okHandler:c,cancelHandler:e,fields:[{caption:"Product Key",
type:"serial",id:"idSerial",val:f}],focusField:"idSerial0",accountButton:!1,pasteButton:!0});b.validator=this.validator;b.create()};return c}();CB.ProgressForm=function(){var c=function(){};c.prototype.createProgressForm=function(b){b=new CB.Form({id:"serialForm",title:b,width:620,height:200,modal:!1,fields:[{caption:"Progress",type:"progress",id:"idSerial",val:""}],accountButton:!1});b.create();this.progress=b.progressBar;this.nestDiv=b.nestDiv};return c}();
CB.FeedbackForm=function(){var c=function(){};c.prototype.createFeedbackForm=function(b,c,e){(new CB.Form({id:"feedbackForm",title:b,width:620,height:400,modal:!0,okHandler:c,cancelHandler:e,fields:[{caption:"Subject:",type:"string",id:"idSubject"},{caption:"Message:",type:"stringmultiline",id:"idMessage",rows:10,cols:60}],focusField:"idSubject",accountButton:!1})).create()};return c}();"use strict";"NOMINIFY=";CB.GetMovesType={NONE:-1,ALL:0,WHITE:1,BLACK:2,GLOBAL_WHITE:3,GLOBAL_BLACK:4};
CB.BlockUpdateMode={NOT_BLOCKED:0,BLOCKED:1,FORCE_UPDATE:2};
CB.CloudPanelMgrMixin=function(){function c(b,c){b.push([CB.strUtil.utf8ArrayToStr(c.title),c.nGames,c.cloudId,CB.strUtil.utf8ArrayToStr(c.owner)])}var b={openCloudDatabase:function(){V15.initCloudManager()},nMaxOnlineDBGames:2,selectCloudDatabase:function(b,d,g){if(!this.getIsFormOpen()){for(var h=[],l=[],q=CB.strUtil.encodeUTF8(b),r=0;r<d.size();r++)d.items[r].owner.toLowerCase()==q.toLowerCase()?c(h,d.items[r]):c(l,d.items[r]);d=[{name:"title",type:"string"},{name:"games",type:"int"},{name:"cloudId",
type:"int"},{name:"owner",type:"string"}];var q=[{header:"Title",dataIndex:"title",flex:2},{header:"Games",dataIndex:"games",flex:1},{header:"Owner",dataIndex:"owner",flex:2}],t=-1;CB.Forms&&CB.Forms.selectCloudDB(b,h,l,d,q,function(b){b&&(t=b.cloudId);g(t)})}},blockLiveBookUpdates:function(b){this.getKernel().Vk.blockLiveBookUpdate(b)},loadGame:function(b){V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()||V15.pushGame(this.getKernel().game);this.getKernel().loadSearchResultGame(b)}},d=new CB.Vr;
b.refreshOnlineDBGames=function(){this.dbGames&&this.dbGames.isVisible()&&(this.dbGames.setEmptyText("Searching..."),d.exec(function(){this.getKernel().Vk.searchOnlineDB()}.bind(this),500))};b.useMatBalanceDefault=function(){return 800<window.innerHeight};b.execCommand=function(b){try{switch(b){case V15.Vo.ONLINEDB_SEARCH:this.getKernel().Vk.search();break;case CB.CommandIds.TOGGLE_ANALYSIS_AUTO_ENGINE:this.toggleAutoShowEngine()&&this.getAutoEngPanel().setGame(this.getKernel().game);break;case V15.Vo.OPEN_CLOUDDATABASE:this.openCloudDatabase();
break;case V15.Vo.LOGIN:V15.changeCloudLogin();break;case V15.Vo.SAVE_CLOUDDB:V15.saveToCloud(this.getKernel().game,0);break;case V15.Vo.REPLACE_CLOUDDB:V15.replaceInCloud(this.getKernel().game,0);break;case V15.Vo.SAVE_WHITE_REPERTOIRE:V15.saveToWhiteRepertoire(this.getKernel().game);break;case V15.Vo.SAVE_BLACK_REPERTOIRE:V15.saveToBlackRepertoire(this.getKernel().game);break;case V15.Vo.CREATE_CLOUDDB:V15.createCloudDB();break;case V15.Vo.DELETE_CLOUDDB:V15.deleteCloudDB();break;case V15.Vo.EDIT_HEADER:V15.editHeader(this.getKernel().game);
break;case V15.Vo.LOAD_WHITE_MYMOVES:this.getKernel().boardWin.setBlackIsBottom(!1,!0);V15.loadMyMoves(CB.GetMovesType.WHITE,new CB.Game);break;case V15.Vo.LOAD_BLACK_MYMOVES:this.getKernel().boardWin.setBlackIsBottom(!0,!0);V15.loadMyMoves(CB.GetMovesType.BLACK,new CB.Game);break;case V15.Vo.MARK_CURRENT_MOVE:V15.markCurrentMove(this.getKernel(),!1);break;case V15.Vo.IMPORTANT_CURRENT_MOVE:V15.markCurrentMove(this.getKernel(),!0);break;case V15.Vo.UNMARK_CURRENT_MOVE:V15.unMarkCurrentMove(this.getKernel());
break;case V15.Vo.UPLOAD_TO_MYMOVES:V15.uploadToMyMoves(this.getKernel())}}catch(c){b=V15.Vo.toNumString(b),CB.LogException(b,c)}};b.execNotaContextMenu=function(b){if(Ext&&Ext.create&&V15.myMovesMgr){CB.CSS.addIcon("MyMove16");CB.CSS.addIcon("ImportantMove16");var c=[{text:lm.MARK_MOVE,handler:function(){V15.markCurrentMove(V15.panelMgr.getKernel(),!1)},iconCls:"MyMove16"},{text:lm.MARK_IMPORTANT,iconCls:"ImportantMove16",handler:function(){V15.markCurrentMove(V15.panelMgr.getKernel(),!0)}}];if(V15.myMovesMgr&&
V15.myMovesMgr.isMovesLoadedForAny())CB.CSS.addIcon("EraseMove16"),CB.CSS.addIcon("White16"),CB.CSS.addIcon("Black16"),CB.CSS.addIcon("Cutline16"),c=c.concat([{text:lm.UNMARK_MOVE,iconCls:"Erase16",handler:function(){V15.unMarkCurrentMove(V15.panelMgr.getKernel())}},"-",{text:lm.REMOVE_TREE_FROM_HERE,iconCls:"Cutline16",handler:function(){CB.Forms.Confirm(lm.DELETE_VARIATION_TREE,lm.REMOVE_ALL_MY_MOVES,function(b){"yes"!=b&&"ok"!=b||V15.removeWholeTreeFromCurrentMove(V15.panelMgr.getKernel())})}}]);
else var d=V15.Vo,c=c.concat(this.getMarkEvalItems("Good16 Bad16 VeryGood16 VeryBad16 Interesting16 Dubious16 WhiteWins16 WhiteBetter16 WhiteSlightly16 Equal16 Unclear16 BlackSlightly16 BlackBetter16 BlackWins16 Compensation16".split(" "),[d.MARK_GOOD,d.MARK_BAD,d.MARK_VERYGOOD,d.MARK_VERYBAD,d.MARK_INTERESTING,d.MARK_DUBIOUS,d.WHITE_WINS,d.WHITE_BETTER,d.WHITE_SLIGHTLY,d.EQUAL,d.UNCLEAR,d.BLACK_SLIGHTLY,d.BLACK_BETTER,d.BLACK_WINS,d.COMPENSATION],"Strong Move;Bad Move;Brilliant Move;Blunder;Interesting Move;Dubious Move;White Is Winning;White Is Better;White: Slight Advantage;Equal;Unclear;Black: Slight Advantage;Black Is Better;Black Is Winning;Compensation".split(";")));
Ext.create("Ext.menu.Menu",{items:c}).showAt([b.clientX,b.clientY])}};b.getMarkEvalItems=function(b,c,d){for(var h=[],l=0;l<b.length;l++)h.push({text:d[l],iconCls:b[l],handler:function(){var b=c[l];return function(){V15.commands.commandHandler(b)}}()});return h};b.getNotaElement=function(){var b=Ext.ComponentManager.get("idNotaPanel");if(b)return b.nota};b.shakeMarkButton=function(){CB.$(".MyMove32").addClass("shakeAnimation");CB.$(".MyMove24").addClass("shakeAnimation");CB.$(".iconMarkHelp").addClass("shakeAnimation")};
b.stopShakeMarkButton=function(){CB.$(".MyMove32").removeClass("shakeAnimation");CB.$(".MyMove24").removeClass("shakeAnimation");CB.$(".iconMarkHelp").removeClass("shakeAnimation")};b.showMessage=function(b,c){this.getKernel()&&this.getKernel().boardWin&&(this.getKernel().boardWin.addMessage(b,!0),c&&(new CB.Timer(function(){this.getKernel().boardWin.destroyMessage()}.bind(this))).runOnce(c))};b.setLayoutMyMoves=function(b,c,d){if(this.notaElement)if(b){b=(c=c===CB.GetMovesType.BLACK||c===CB.GetMovesType.GLOBAL_BLACK)?
"/common/media/ribbons/Black32.png":"/common/media/ribbons/White32.png";c=c?lm.BLACK:lm.WHITE;var h=lm.MY_MOVES_FOR+"  "+c;d&&(Array.isArray(d)&&1<d.length?(d[1]+=" - "+c,h=d):h=d+" - "+c);this.notaElement.notaHeaderElement.setTitleOnly(h,b)}else this.notaElement.notaHeaderElement.setTitleOnly("")};b.getNotationToolBarItems=function(b){return[CB.ToolButtons.downloadPGNBtn("PGN","Save16","Download Game Notation","downloadPgnId",function(){return V15.panelMgr.getKernel().game}),"-",CB.ToolButtons.smallBtn(lm.TEXT_AFTER,
"Posttext16",b.ADD_POST_TEXT,lm.TEXT_AFTER_TIP),"-",CB.ToolButtons.smallBtn(lm.DELETE_LINE,"DeleteLine16",b.DELETE_LINE,lm.DELETE_LINE_TIP),CB.ToolButtons.smallBtn(lm.CUT_LINE,"CutLine16",b.CUT_LINE,lm.CUT_LINE_TIP),"-",CB.ToolButtons.smallBtn("","MyMove16",b.MARK_CURRENT_MOVE,"Mark as 'My Move'"),CB.ToolButtons.smallBtn("","ImportantMove16",b.IMPORTANT_CURRENT_MOVE,"Mark as Important Move"),CB.ToolButtons.smallBtn("","Erase16",b.UNMARK_CURRENT_MOVE,"Unmark current move"),"-",CB.ToolButtons.smallBtn("",
"WhiteSlightly16",b.WHITE_SLIGHTLY,"White has a slight advantage"),CB.ToolButtons.smallBtn("","Equal16",b.EQUAL,"The position is equal"),CB.ToolButtons.smallBtn("","Unclear16",b.UNCLEAR,"The position ist unclear"),CB.ToolButtons.smallBtn("","BlackSlightly16",b.BLACK_SLIGHTLY,"Black has a slight advantage"),CB.ToolButtons.smallBtn("","WhiteBetter16",b.WHITE_BETTER,"White is better"),CB.ToolButtons.smallBtn("","BlackBetter16",b.BLACK_BETTER,"Black is better"),CB.ToolButtons.smallBtn("","WhiteWins16",
b.WHITE_WINS,"White is winning"),CB.ToolButtons.smallBtn("","BlackWins16",b.BLACK_WINS,"Black is winning"),CB.ToolButtons.smallBtn("","Compensation16",b.COMPENSATION,"Material compensation"),"-",CB.ToolButtons.smallBtn("","InsertDiagram16",b.INSERT_DIAGRAM,lm.INSERT_DIAGRAM)]};return b}();
CB.CloudAppMixin=function(){function c(){CB.Forms.InputString("Name","New Database",function(b){b&&V15.cloudMgr&&V15.cloudMgr.createDatabase(b)}.bind(this))}function b(){V15.cloudMgr&&V15.cloudMgr.logOff();V15.myMovesMgr&&V15.myMovesMgr.logOff();V15.aTBLobby&&V15.aTBLobby.logOff();V15.logOffPlayerLobby();V15.logOffOnlineLobby();if(V15.panelMgr.getKernel())V15.panelMgr.getKernel().Vk.onBeforeUnload();V15.exitInstance();V15.myMovesMgr&&!V15.myMovesMgr.isMovesLoadedForAny()&&V15.saveGameToLocalStorage()}
function d(){V15.cloudMgr&&V15.myMovesMgr&&!CB.System.runsInIFrame()&&(CB.System.isMobile()&&(V15.panelMgr.stopEngines&&V15.panelMgr.stopEngines(),V15.blurLogOffTimer&&V15.stop&&V15.stop(),V15.blurLogOffTimer=new CB.Timer(function(){V15.cloudMgr.logOff();V15.myMovesMgr.logOff()}),V15.blurLogOffTimer.runOnce(6E4)),V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()||V15.saveGameToLocalStorage())}function e(){V15.blurLogOffTimer&&V15.blurLogOffTimer.stop()}function f(){document.hidden?d():e()}return{initCloudManager:function(){if(void 0!==
V15.cloudMgr)V15.cloudMgr.isLoggedIn()?V15.cloudMgr.requestDatabases():this.loginToCloud();else{var b=this.copyUserName();b&&V15.Vf.userName&&"guest"!==V15.Vf.userName?(V15.Vf.loginToken=b,this.createCloudManager(!0,null,b)):V15.Vf.hasUserAndPass()?this.createCloudManager(!0):CB.Forms&&CB.Forms.Login("ChessBase Game Cloud",V15.Vf,function(b){this.createCloudManager(b);this.createMyMovesManager(b)}.bind(this),function(){CB.ToolButtons.hideBusyMask()},{})}},initMyMovesManager:function(){if(void 0!==
V15.myMovesMgr)V15.myMovesMgr.isLoggedIn()||this.loginToMyMoves();else{var b=this.copyUserName();b&&V15.Vf.userName&&"guest"!==V15.Vf.userName?(V15.Vf.loginToken=b,this.createMyMovesManager(!0,b)):V15.Vf.hasUserAndPass()&&this.createMyMovesManager(!0)}},copyUserName:function(){V15.Vf.userName||(V15.Vf.userName=CB.DOM.getAccountNameCookie(!0));V15.Vf.userName||(V15.Vf.userName=CB.DOM.getCodedCookie("AccountBackName64",!0));V15.Vf.loginMode=CB.LoginMode.NORMAL;return CB.DOM.getCookie("AccountToken")||
V15.Vf.loginToken},createCloudManager:function(c,h,l){CB.DOM.setAccountNameCookie(V15.Vf.userName);V15.config.silentCloud||V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.showBusyMask(lm.CONNECTING);V15.cloudMgr=new CB.Server.CloudManager;V15.cloudMgr.onServerDown=this.onCloudServerDown.bind(this);V15.cloudMgr.onInvalidPassword=this.changeCloudLogin.bind(this);var q=V15.Vf.userName,r=CB.LoginMode.NORMAL;c||(q="Guest",r=CB.LoginMode.GUEST);V15.cloudMgr.createLobby(this.config.getCloudServerUris(),q,
V15.Vf.password,r,l);this.windowEventsAdded||(this.windowEventsAdded=!0,window.addEventListener("beforeunload",b),V15.isExtJS||window.addEventListener("unload",b),window.addEventListener("blur",d),window.addEventListener("focus",e),window.addEventListener("visibilitychange",f));V15.cloudMgr.connect();V15.cloudMgr.setCallAfterDBSelected(h);V15.initCloudListeners(V15.cloudMgr);V15.panelMgr.getKernel()&&V15.panelMgr.getKernel().game.addOnResetGameListener(function(){if(V15.cloudMgr)V15.cloudMgr.onResetGame()})},
createMyMovesManager:function(c,h){if(V15.myMovesMgr)l=V15.Vf.userName,q=CB.LoginMode.NORMAL,V15.myMovesMgr.createLobby(this.config.getMyMovesServerUris(),l,V15.Vf.password,q,h);else{CB.DOM.setAccountNameCookie(V15.Vf.userName);V15.myMovesMgr=new CB.Server.MyMovesManager;V15.myMovesMgr.onServerDown=this.onMyMovesServerDown.bind(this);var l=V15.Vf.userName,q=CB.LoginMode.NORMAL;h?(V15.myMovesMgr.isLoggedIn()&&V15.myMovesMgr.logOff(),V15.myMovesMgr.createLobby(this.config.getMyMovesServerUris(),l,V15.Vf.password,
q,h)):V15.myMovesMgr.createLobby(this.config.getMyMovesServerUris(),"guest","",CB.LoginMode.GUEST,"");this.windowEventsAdded||(this.windowEventsAdded=!0,window.addEventListener("beforeunload",b),V15.isExtJS||window.addEventListener("unload",b),window.addEventListener("blur",d),window.addEventListener("focus",e),window.addEventListener("visibilitychange",f));V15.myMovesMgr.connect();V15.initMyMovesListeners(V15.myMovesMgr);V15.panelMgr.getKernel()&&(V15.panelMgr.getKernel().game.addOnResetGameListener(function(){if(V15.myMovesMgr)V15.myMovesMgr.onResetGame()}),
V15.panelMgr.getKernel().game.addOnNotaDoubleClickListener(function(){V15.onNotaDoubleClick()}))}},connectCloudManager:function(b,c,d){CB.DOM.setAccountNameCookie(V15.Vf.userName);V15.config.silentCloud||V15.panelMgr.EXTIsNotSupported||CB.ToolButtons.showBusyMask(lm.CONNECTING);var e=V15.Vf.userName,f=CB.LoginMode.NORMAL;b||(e="Guest",f=CB.LoginMode.GUEST);V15.cloudMgr.connectUser(e,V15.Vf.password,f,d);V15.cloudMgr.setCallAfterDBSelected(c)},connectMyMovesManager:function(b,c){CB.DOM.setAccountNameCookie(V15.Vf.userName);
V15.myMovesMgr.connectUser(V15.Vf.userName,V15.Vf.password,CB.LoginMode.NORMAL,c)},initCloudListeners:function(b){},initMyMovesListeners:function(b){V15.panelMgr.tbBook&&V15.panelMgr.tbBook.initCloudListener(b);V15.panelMgr.getKernel()&&V15.panelMgr.getKernel().Vk.initMyMovesListener&&V15.panelMgr.getKernel().Vk.initMyMovesListener(b)},onCloudServerDown:function(){this.config.silentCloud||alert("Sorry, Cloud Server is currently in maintenance, please wait a few minutes.")},onMyMovesServerDown:function(){this.config.silentCloud||
alert("Sorry, MyMoves Server is currently in maintenance, please wait a few minutes.")},onTokenLoginOk:function(){this.panelMgr.hasPlugins&&(this.initCloudManager(),this.initMyMovesManager())},onInvalidPassword:function(){},shouldRequestCloudDBsOnLogin:function(){return!1},loginToCloud:function(b){var c=CB.DOM.getCookie("AccountToken");if(c){var d=CB.DOM.getAccountNameCookie(!0);d&&(V15.Vf.userName=d);V15.Vf.loginMode=CB.LoginMode.NORMAL;V15.Vf.loginToken=c;void 0===V15.cloudMgr?this.createCloudManager(!0,
b,c):this.connectCloudManager(!0,b,c)}else this.changeCloudLogin(b)},loginToMyMoves:function(){var b=CB.DOM.getCookie("AccountToken");if(b){var c=CB.DOM.getAccountNameCookie(!0);c&&(V15.Vf.userName=c);V15.Vf.loginMode=CB.LoginMode.NORMAL;V15.Vf.loginToken=b;void 0===V15.myMovesMgr?this.createMyMovesManager(!0,b):this.connectMyMovesManager(!0,b)}},changeCloudLogin:function(b){if(CB.Forms){var c=CB.DOM.getAccountNameCookie(!0);c||(c=CB.DOM.getCodedCookie("AccountBackName64",!0));c&&(V15.Vf.userName=
c);CB.Forms.Login("ChessBase Game Cloud",V15.Vf,function(c){void 0===V15.cloudMgr?this.createCloudManager(c,b):this.connectCloudManager(c,b)}.bind(this),function(){CB.ToolButtons.hideBusyMask()},{guestBtn:!1,createBtn:!0,forgotBtn:!0})}},saveToCloud:function(b){var c=function(){CB.Forms.editGameHeader(b.hdr,function(){b.fireOnHeaderChanged();V15.cloudMgr.saveGame(b)}.bind(this))}.bind(this);void 0===V15.cloudMgr||V15.cloudMgr.isGuest()?V15.loginToCloud(c):c()},replaceInCloud:function(b){var c=function(){CB.Forms.editGameHeader(b.hdr,
function(){b.fireOnHeaderChanged();V15.cloudMgr.replaceGame(b)}.bind(this))}.bind(this);void 0===V15.cloudMgr||V15.cloudMgr.isGuest()?V15.loginToCloud(c):c()},editHeader:function(b){CB.Forms.editGameHeader(b.hdr,function(){b.fireOnHeaderChanged();V15.cloudMgr.canReplaceGame(b)&&V15.cloudMgr.replaceGame(b)})},saveToWhiteRepertoire:function(b){alert("NOTIMPL")},saveToBlackRepertoire:function(b){alert("NOTIMPL")},createCloudDB:function(){void 0===V15.cloudMgr||V15.cloudMgr.isGuest()?this.loginToCloud():
c.bind(this)()},deleteCloudDB:function(){void 0===V15.cloudMgr||V15.cloudMgr.isGuest()?this.loginToCloud():V15.cloudMgr.deleteDatabase()},setLoggedIn:function(b){b?this.isPlugin()||(document.title=this.appTitle+" - "+V15.Vf.userName):(V15.cloudMgr&&V15.cloudMgr.isLoggedIn()&&(V15.cloudMgr.logOff(),delete V15.cloudMgr),V15.myMovesMgr&&V15.myMovesMgr.isLoggedIn()&&(V15.myMovesMgr.isMovesLoadedForAny()&&V15.panelMgr.getKernel().newGame(),V15.myMovesMgr.logOff(),delete V15.myMovesMgr),this.panelMgr.showDatabase&&
this.panelMgr.showDatabase(null),this.isPlugin()||(document.title=this.appTitle+" - not logged in"),this.loginPending=!1);this.superClass.setLoggedIn.apply(this,arguments)},loadMyMoves:function(b,c){V15.checkMyMovesLoggedIn()&&V15.panelMgr.getKernel().Vk.mayLoadGames()&&(V15.myMovesMgr.isMovesLoadedForAny()||V15.pushGame(V15.panelMgr.getKernel().game),V15.panelMgr.getKernel().Vk.shouldRefreshOnlineDB=!0,V15.myMovesMgr.loadCurrentMyMoves(b,c),V15.panelMgr.blockLiveBookUpdates(CB.BlockUpdateMode.NOT_BLOCKED))},
gameStack:[],pushGame:function(b){var c=new CB.Game;c.assign(b);this.gameStack.push(c)},restorePrevGame:function(){if(this.gameStack.length){var b=this.gameStack.pop();V15.panelMgr.getKernel().Vk.getFnLoadSearchResult().call(V15.panelMgr.getKernel(),b)}},removeWholeTreeFromCurrentMove:function(b,c){if(V15.checkMyMovesLoggedIn()&&b.game.getMoveOffs()<=b.game.getCurLine().length){var d=new CB.Game,e=b.game.getMoveOffs();c&&(e=b.game.getLineStartMoveNo());for(var f=0;f<e;f++)d.makeMove(b.game.getCurLine()[f]);
if(e=b.game.getCurLine()[f])e=new CB.Move(e.from,e.to,e.prom),V15.myMovesMgr.removeWholeTree(d.getCurPos(),e,V15.myMovesMgr.myMovesLoadMode),d.gotoPrev()}},markCurrentMove:function(b,c){V15.panelMgr.stopShakeMarkButton();c=c||!1;if(V15.checkMyMovesLoggedIn()&&b.game.getMoveOffs()<=b.game.getCurLine().length&&this.checkMyMovesLoadedForOtherSide(!b.getCurPos().getBTM())){b.game.deleteAnno(CB.AnnoType.SYMBOL);c?b.addSymbol(CB.AnnoMarkType.IMPORTANT):b.addSymbol(CB.AnnoMarkType.MYMOVE);var d=this.cloneGameToCurPos(b.game);
V15.myMovesMgr.storePosAndMoves(d,c?3:2);var d=new CB.NotationGenerator,e=b.game.getLastMove();if(e){var f=b.getCurPos().getMoveNum(),d=d.getMoveNota(e,f),e=d+" "+lm.MARKED;c&&(e=d+" "+lm.MARKED_IMPORANT);b.boardWin.addMessage(e,!0);(new CB.Timer(function(){b.boardWin.destroyMessage()})).runOnce(2E3);V15.myMovesMgr.isMovesLoadedFor(!b.getCurPos().getBTM())&&(d=this.cloneGameToCurPos(b.game,2),V15.myMovesMgr.loadMyMoves(V15.myMovesMgr.myMovesLoadMode,d))}}},checkMyMovesLoadedForOtherSide:function(b){if(0===
this.panelMgr.getKernel().game.getMoveNo())V15.panelMgr.showMessage(lm.ENTER_OR_CLICK_MOVE_AND_MARK,5E3);else{var c;switch(V15.myMovesMgr.myMovesLoadMode){default:case CB.GetMovesType.ALL:b=!0;break;case CB.GetMovesType.BLACK:c=lm.CAUTION_YOU_ARE_EDITING_MOVES_FOR+" "+lm.BLACK+".";break;case CB.GetMovesType.WHITE:b=!b,c=lm.CAUTION_YOU_ARE_EDITING_MOVES_FOR+" "+lm.WHITE+"."}b||V15.panelMgr.showMessage(c);return b}},makeMainMoveOrder:function(b){if(V15.checkMyMovesLoggedIn()&&b.game.getMoveOffs()<=
b.game.getCurLine().length){for(var c=new CB.Game,d=0;d<b.game.getMoveOffs();d++)c.makeMove(b.game.getCurLine()[d]);V15.myMovesMgr.makeMainMoveOrder(c);c=new CB.NotationGenerator;if(d=b.game.getLastMove()){var e=b.getCurPos().getMoveNum(),c=c.getMoveNota(d,e);b.boardWin.addMessage(c+" is main move order.",!0);(new CB.Timer(function(){b.boardWin.destroyMessage()})).runOnce(2E3);V15.myMovesMgr.isMovesLoadedFor(!b.getCurPos().getBTM())&&V15.myMovesMgr.reloadMyMoves()}}},unMarkCurrentMove:function(b){if(V15.checkMyMovesLoggedIn()&&
b.game.getMoveOffs()<=b.game.getCurLine().length&&this.checkMyMovesLoadedForOtherSide(!b.getCurPos().getBTM())){var c=b.game.getLastMove();if(c){b.game.deleteAnno(CB.AnnoType.SYMBOL);var d=new CB.Position;b.game.enableEvents(!1);b.game.gotoPrev();d.copy(b.game.getCurPos());b.game.gotoNext();V15.myMovesMgr.removeFromMyMoves(d,c);b.game.enableEvents(!0);var d=new CB.NotationGenerator,e=b.getCurPos().getMoveNum(),c=d.getMoveNota(c,e);b.boardWin.addMessage(c+" cleared.",!0);(new CB.Timer(function(){b.boardWin.destroyMessage()})).runOnce(2E3);
V15.myMovesMgr.isMovesLoadedFor(!b.getCurPos().getBTM())&&(c=this.cloneGameToCurPos(b.game,2),V15.myMovesMgr.loadMyMoves(V15.myMovesMgr.myMovesLoadMode,c))}}},uploadToMyMoves:function(b){V15.checkMyMovesLoggedIn()&&(b.boardWin.addMessage(lm.GAME_UPLOADED,!0),V15.myMovesMgr.uploadToMyMoves(b.game),(new CB.Timer(function(){b.boardWin.destroyMessage()})).runOnce(2E3),V15.myMovesMgr.reloadMyMoves())},isCloudLoggedIn:function(){return V15.cloudMgr&&V15.cloudMgr.isLoggedIn()},checkCloudLoggedIn:function(){if(V15.cloudMgr){if(V15.cloudMgr.isLoggedIn())return!0;
if(V15.cloudMgr.wasLoggedIn()&&!V15.cloudMgr.isConnected())return V15.cloudMgr.reconnectUser(),!0}V15.panelMgr.showMessage(lm.PLEASE_LOGIN_OPENINGS,3E3);return!1},isMyMovesLoggedIn:function(){return V15.myMovesMgr&&V15.myMovesMgr.isLoggedIn()},checkMyMovesLoggedIn:function(){if(V15.myMovesMgr){if(V15.myMovesMgr.isLoggedIn()&&!V15.myMovesMgr.isGuest())return!0;if(V15.myMovesMgr.wasLoggedIn()&&!V15.myMovesMgr.isConnected())return V15.myMovesMgr.reconnectUser(),!0}V15.panelMgr.showMessage(lm.PLEASE_LOGIN_OPENINGS,
3E3);return!1},cloneGameToCurPos:function(b,c){for(var d=new CB.Game,e=0;e<b.getMoveOffs()&&e<(c||999);e++){var f=b.getCurLine()[e];if(f){d.makeMove(new CB.Move(f.from,f.to,f.prom));var t=d.getLastMove();f.annos&&f.annos[CB.AnnoType.SYMBOL]&&(t.annos=new CB.Annotation,t.annos[CB.AnnoType.SYMBOL]=f.annos[CB.AnnoType.SYMBOL])}else{alert("game logic problem");break}}return d},onNotaDoubleClick:function(){this.loadMyMoves(V15.myMovesMgr.myMovesLoadMode,new CB.Game);V15.panelMgr.refreshOnlineDBGames&&
V15.panelMgr.refreshOnlineDBGames()},notifyMyMovesChanged:function(){this.myMovesMgr.checkPosAndMoves(this.panelMgr.getKernel().game.getCurPos());this.myMovesMgr.isMovesLoadedFor(this.panelMgr.getKernel().getCurPos().getBTM())&&this.myMovesMgr.reloadMyMoves()}}}();
CB.CloudPlayingModeMixin=function(){var c={createGUIElements:function(b){this.superClass.createGUIElements.call(this,b);b.shouldAnimatePosChange=this.shouldAnimatePosChange.bind(this);this.setDefaultAnimSteps(b)},setDefaultAnimSteps:function(b){if(this.kernel)var c=b||this.kernel.boardWin;c&&(CB.System.isMobile()?c.animSteps={forMove:.3,forPosition:.3}:c.animSteps={forMove:.6,forPosition:.6})},shouldAnimatePosChange:function(){return this.animatePos},blockLiveBookUpdate:function(b){if(this.blockUpdateMode!=
CB.BlockUpdateMode.FORCE_UPDATE||b!=CB.BlockUpdateMode.NOT_BLOCKED)this.blockUpdateMode=b},onAnnotate:function(){return V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()?(V15.panelMgr.showMessage("Cannot annotate 'My Moves'",3E3),!1):this.canAnnotateLoadedGames()},onTextAnno:function(b,c){if(c){if(V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()){var f=V15.cloneGameToCurPos(this.kernel.game);V15.myMovesMgr.storeText(f,b);return!0}}else V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()&&
V15.panelMgr.showMessage("'My Moves' can only have text after a move.");if(this.canAnnotateLoadedGames())return!0;V15.panelMgr.showMessage("You can only annotate your own moves");return!1},onEval:function(b){if(V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()){var c=this.kernel.game.getAnno(CB.AnnoType.SYMBOL);c&&c.hasExclusiveEval(b)&&(b=0);c=V15.cloneGameToCurPos(this.kernel.game);V15.myMovesMgr.storeEval(c,b);return!0}if(this.canAnnotateLoadedGames())return!0;V15.panelMgr.showMessage("You can only annotate your own moves");
return!1},canAnnotateLoadedGames:function(){return!1},onPromoteLine:function(){return V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny()?(V15.panelMgr.showMessage("Line ordering is automatic in 'My Moves'"),!1):!0},onDeleteLine:function(){if(V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny())return CB.Forms.Confirm(lm.DELETE_VARIATION_TREE,lm.REMOVE_ALL_MY_MOVES,function(b){"yes"!=b&&"ok"!=b||V15.removeWholeTreeFromCurrentMove(this.kernel,!0)}.bind(this)),!1;if(this.canAnnotateLoadedGames())return!0;
V15.panelMgr.showMessage("You can only annotate your own moves");return!1},onCutLine:function(){if(V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedForAny())return CB.Forms.Confirm(lm.DELETE_VARIATION_TREE,lm.REMOVE_MOVES_FROM_HERE,function(b){"yes"!=b&&"ok"!=b||V15.removeWholeTreeFromCurrentMove(this.kernel)}.bind(this)),!1;if(this.canAnnotateLoadedGames())return!0;V15.panelMgr.showMessage("You can only annotate your own moves");return!1},cloudOnEnteredMove:function(b){try{var c=V15.panelMgr.getNotaElement();
c&&c.focus();if(V15.myMovesMgr&&V15.myMovesMgr.isMovesLoadedFor(this.kernel.getCurPos().getBTM())){var f=V15.cloneGameToCurPos(this.kernel.game);f.getCurPos().preCalcCtx(b);f.makeMove(b);V15.myMovesMgr.storePosAndMoves(f,b,1)}}catch(g){alert("CloudEnter: "+g)}},newGame:function(){delete this.kernel.game.replaceGameNo;delete this.kernel.game.replaceDBId;if(V15.myMovesMgr)V15.myMovesMgr.onResetGame();V15.panelMgr.setLayoutMyMoves(!1)},searchOnlineDB:function(){if(V15.panelMgr.dbGames||V15.panelMgr.usesOnlineDB&&
V15.panelMgr.usesOnlineDB()){var b=new CB.SearchMask;b.setSearchBoard(this.kernel.game.getCurPos().board,this.kernel.game.getCurPos().getSideToMove());b.setUseBoard(!0);null!=V15.onlineLobby&&V15.onlineLobby.search(b,this.getOnlineDBMaxGames(),this.kernel.game.getMoveNo())}},getOnlineDBMaxGames:function(){return this.nMaxOnlineDBGames},getFnLoadSearchResult:function(){return function(b){this.Vk.beforeGameLoad();this.Vk.animatePos=!1;V15.panelMgr.setLayoutMyMoves.call(V15.panelMgr,!1);var c=ObjUtil.clone(this.game),
f=c.getCurPos();void 0!==this.boardWin.prepareFullRedraw&&this.boardWin.prepareFullRedraw();this.game.assign(b,!0);b=0;if(this.game.isNormalInit())for(;60>++b&&!this.game.gotoPos(f,!0)&&0<c.getMoveOffs();)c.gotoPrev(!0),f=c.getCurPos();this.game.fireOnResetGame();this.game.fireOnChanged();this.game.fireOnCurPosChanged();this.game.fireOnHeaderChanged();this.game.isNormalInit()?60>b&&0<b&&5<this.game.getMoveNo()&&1<this.game.getLineCnt()&&V15.panelMgr.refoldToCurrentLine&&V15.panelMgr.refoldToCurrentLine():
this.game.gotoFirst();this.Vk.animatePos=!0;this.Vk.afterGameLoad()}}},b=new CB.Vr;c.forceUpdateCloudOnGamePos=function(){this.blockUpdateMode=CB.BlockUpdateMode.FORCE_UPDATE;this.updateCloudOnGamePos()};c.updateCloudOnGamePos=function(){this.blockUpdateMode!=CB.BlockUpdateMode.BLOCKED&&b.exec(function(){V15.panelMgr.tbBook&&V15.aTBLobby&&V15.aTBLobby.hasIdReceived&&(this.bookAnswers||!this.updatePos||!this.updatePos.equals(this.kernel.game.getCurPos())||this.blockUpdateMode==CB.BlockUpdateMode.FORCE_UPDATE)&&
(this.blockUpdateMode=CB.BlockUpdateMode.NOT_BLOCKED,this.updatePos=ObjUtil.clone(this.kernel.game.getCurPos()),V15.panelMgr.tbBook.clear(),(V15.panelMgr.tbBook.isVisible()||this.checkCloudWithHiddenBook())&&V15.aTBLobby.requestAllMoves(this.kernel.game.getCurPos()),V15.panelMgr.tbPanel&&(V15.panelMgr.tbPanel.isVisible()||this.checkCloudWithHiddenBook())&&V15.aTBLobby.requestPosInfo(this.kernel.game.getCurPos()),this.lbInfo=null,this.myMoves=[],V15.myMovesMgr&&(V15.panelMgr.tbBook&&V15.panelMgr.tbBook.isVisible()||
this.checkCloudWithHiddenBook())&&(this.myMoves=null,!V15.myMovesMgr.isLoggedIn()&&V15.myMovesMgr.wasLoggedIn()?V15.myMovesMgr.reconnectUser():V15.myMovesMgr.isLoggedIn()&&(this.bookAnswers?V15.myMovesMgr.checkPosAndMovesEx(this.kernel.game.getCurPos(),this.bookAnswers,this.playingSide):V15.myMovesMgr.checkPosAndMoves(this.kernel.game.getCurPos(),this.bookAnswers,this.playingSide))),this.setDefaultAnimSteps())}.bind(this),100)};c.checkCloudWithHiddenBook=function(){return!1};c.initMyMovesListener=
function(b){b.addOnMyMovesListener(this.myMovesListener.bind(this));V15.addOnAccountTypeListener(this.VlListener.bind(this))};c.myMovesListener=function(b){this.myMoves=b.moves};c.VlListener=function(b){switch(b.type){default:case 1:this.nMaxOnlineDBGames=5;break;case 2:this.nMaxOnlineDBGames=30;break;case 3:this.nMaxOnlineDBGames=50}};return c}();
CB.CloudGUIElements={createCloudMenuBtn:function(c,b){return CB.ToolButtons.menuBtn(b,"Databases","Cloud",["Open Cloud Database","Login","Save Game"],["Cloud16","Login16","Save16"],[c.OPEN_CLOUDDATABASE,c.LOGIN_CLOUDDB,c.SAVE_CLOUDDB],c.OPEN_CLOUDDATABASE,"Open database and save games")},createCloudAndPgnMenuBtn:function(c){return CB.ToolButtons.menuBtn(32,"Open","Open",["Open Cloud Database","Open PGN File"],["Cloud16","Open16"],[c.OPEN_CLOUDDATABASE,c.OPEN_PGN_DATABASE],c.OPEN_CLOUDDATABASE)},createCloudDatabaseMenuBtn:function(c,
b){return CB.ToolButtons.menuBtn(b,lm.DATABASES,"Cloud",[lm.OPEN_DATABASE,lm.CREATE_DATABASE,lm.DELETE_DATABASE],["Cloud16","CreateCloudDB16","Delete16"],[c.OPEN_CLOUDDATABASE,c.CREATE_CLOUDDB,c.DELETE_CLOUDDB],void 0,lm.DATABASE_FUNCTIONS)},createMarkMoveBtn:function(c,b){return CB.ToolButtons.ribbonBtn(b,lm.MARK_MOVE,"MyMove",c.MARK_CURRENT_MOVE,"Mark the current move as 'my move' to create a repertoire that you can drill.")},createLoadWhiteBtn:function(c,b){return CB.ToolButtons.ribbonBtn(b,lm.LOAD_WHITE,
"White",c.LOAD_WHITE_MYMOVES,"Load your White repertoire (marked moves) from the current position.")},createLoadBlackBtn:function(c,b){return CB.ToolButtons.ribbonBtn(b,lm.LOAD_BLACK,"Black",c.LOAD_BLACK_MYMOVES,"Load your Black repertoire (marked moves) from the current position.")},createMyMoveMenuBtn:function(c,b,d,e){var f=[lm.MARK_MOVE,lm.MARK_IMPORTANT,lm.UNMARK_MOVE],g=["MyMove16","ImportantMove16","Erase16"],h=[c.MARK_CURRENT_MOVE,c.IMPORTANT_CURRENT_MOVE,c.UNMARK_CURRENT_MOVE];d&&(f=f.concat(["-",
lm.LOAD_WHITE,lm.LOAD_BLACK]),g=g.concat(["","White16","Black16"]),h=h.concat([null,c.LOAD_WHITE_MYMOVES,c.LOAD_BLACK_MYMOVES]));e&&(f.push(lm.UPLOAD_GAME),g.push("Upload16"),h.push(c.UPLOAD_TO_MYMOVES));return CB.ToolButtons.menuBtn(b,lm.MY_MOVES,"MyMove",f,g,h,void 0,lm.MY_MOVE_MENU_TTIP)},createCloudBtn:function(c,b){return CB.ToolButtons.ribbonBtn(b,"Cloud Databases","Cloud",c.OPEN_CLOUDDATABASE,"Open the list of your databases (cloud)")},createCloudSaveBtn:function(c,b){return CB.ToolButtons.ribbonBtn(b,
"Save","Save",c.SAVE_CLOUDDB,"Append game to the current cloud database")},createCloudSaveReplaceMenuBtn:function(c,b){return CB.ToolButtons.menuBtn(b,lm.SAVE,"Save",[lm.SAVE,lm.SAVE_AS_NEW,lm.EDIT_GAME],["Replace16","Save16","Edit16"],[c.REPLACE_CLOUDDB,c.SAVE_CLOUDDB,c.EDIT_HEADER],void 0,lm.SAVE_AND_REPLACE_GAMES)},createCloudLoginBtn:function(c,b){return V15.loginMenuBtn(b)}};
CB.AccountPanelMgrMixin=function(){return{onLogin:function(){CB.LOG("Login="+V15.isLoggedIn());this.gameKernel&&this.gameKernel.game.fireOnChanged({forceUpdate:!0});this.setLoginHtml(V15.isLoggedIn())},setLoginHtml:function(c){if(this.infoPanel){if(c)this.infoPanel.setHeight(450<window.innerHeight?28:20),Ext.apply(this.infoPanel,{overflowY:"auto"}),this.infoPanel.update('<div class="CBInfoLoggedIn">'+this.getLoggedInHtml()+"</div>"),this.infoPanel.setBodyStyle(this.getLoginInfoGradient()+";color:white;text-transform:uppercase");
else{var b=window.innerHeight/3;this.eastContainer&&this.eastContainer.el&&(b=this.eastContainer.getHeight());CB.System.isMobile()&&900>window.innerHeight?this.infoPanel.setHeight(Math.min(b,120)):this.infoPanel.setHeight(Math.min(b,160));Ext.apply(this.infoPanel,{overflowY:"scroll"});this.infoPanel.update('<div class="CBInfoNotLoggedIn">'+this.getPleaseLoginHtml()+"</div>");this.infoPanel.setBodyStyle(CB.CSS.getGradToRight("rgba(254, 254,252,255)","rgba( 251, 251,247,255)")+";color:black;text-transform:none;")}this.infoPanel.loggedIn=
c;V15.Vf.noLists()&&this.infoPanel.el&&this.infoPanel.setVisible(!1)}},getLoginInfoGradient:function(){return CB.CSS.getGradToRight("rgba(6, 216,19,255)","rgba(24, 147,23,255)")},getGuestInfoGradient:function(){return CB.CSS.getGradToRight("hsl( 120, 15%, 30% )","hsl( 0, 15%, 20% )")},getPleaseLoginHtml:function(c){c=CB.CSS.getHeader("h3",lm.LOGIN_PLEASE_LOGIN,"margin-top:4px");c+=this.getLoginInviteHeader()+"<br/>";if(!CB.System.isMobile()||900<window.innerHeight)c+=this.getFunctionalityText()+"<br/>",
c+=lm.LOGIN_ACCOUNT_FREE+"<br/><br/>";CB.System.isCordova()||(c+=this.genCreateAccountLink());return c},genCreateAccountLink:function(){return'<a href="'+V15.config.createAccountWebUrl+'" style="color:#8B0A16">'+lm.LOGIN_CREATE_LINK+"</a>"},getLoggedInHtml:function(){return String.f(lm.LOGIN_WELCOME,V15.Vf.userName)},getLoginInviteHeader:function(){return String.f(lm.GENERAL_INVITE,V15.appTitle)},getFunctionalityText:function(){return lm.PLEASE_LOGIN},resizeInfoPanel:function(){var c=!1;if(this.infoPanel&&
this.infoPanel.el)if(this.infoPanel.loggedIn){var b=22;450<window.innerHeight&&(b=650<window.innerHeight?30:26);this.infoPanel.setHeight(b);c=!0}else this.eastContainer&&(b=Math.min(220,Math.max(20,.3*this.eastContainer.getHeight())),this.infoPanel.setHeight(b));return c}}}();
CB.AccountAppMixin=function(){return{accountLogin:function(c,b){V15.Vf.userName=CB.DOM.getAccountNameCookie(!0)||V15.Vf.userName;V15.Vf.loginToken=CB.DOM.getCookie("AccountToken");if(!c&&V15.Vf.loginToken&&V15.Vf.userName&&"guest"!=V15.Vf.userName){var d=new CB.AccountsManager(V15.shortAppName);V15.Vf.userName&&"guest"!=V15.Vf.userName&&V15.Vf.password?d.pwLogin(V15.Vf.userName,V15.Vf.password,this.receiveTokenHandler.bind(this)):d.tokenLogin(V15.Vf.userName,V15.Vf.loginToken,this.tokenLoginHandler.bind(this))}else this.onRequestLogin(b)},
onRequestLogin:function(c){this.enterLoginForm(c)},enterLoginForm:function(c,b){V15.panelMgr.showAccountsForm(c,"",b)},tokenLoginHandler:function(c){c&&1!=c.ResultType&&!c.timeout?(this.setLoggedIn(!1),this.enterLoginForm()):c.timeout?(CB.DOM.clearCookie("AccountToken"),this.setLoggedIn(!1)):(this.setLoggedIn(!0),this.onTokenLoginOk(),V15.showAccountType(c.Subscription));this.loginPending=!1},onTokenLoginOk:function(){},receiveTokenHandler:function(c){if(c&&c.Token){var b=unescape(c.Token);V15.Vf.loginToken=
b;CB.LOG("AccToken = "+b,"","acc");V15.Vf.rememberLoginToken();c.userId&&1==c.ResultType&&(V15.Vf.userName=c.userId);CB.DOM.setAccountNameCookie(V15.Vf.userName);this.setLoggedIn(!0);CB.ToolButtons&&CB.ToolButtons.showBusyMask("Logged in OK: "+V15.Vf.userName);CB.Timer.launch(function(){CB.ToolButtons&&CB.ToolButtons.hideBusyMask()},600);this.onTokenLoginOk()}else{CB.LOG("No Token Received in token handler");if(c&&1!=c.Result&&!c.timeout&&!c.error)this.onInvalidToken();c.timeout&&CB.DOM.clearCookie("AccountToken",
"");this.setLoggedIn(!1);this.loginPending=!1}},onInvalidToken:function(){V15.panelMgr.showAccountsForm()?V15.panelMgr.showAccountsForm(lm.PW_INVALID,V15.Vf.userName):this.enterLoginForm(String.formatEx(lm.PW_INVALID,V15.Vf.userName))},isLoggedIn:function(){return this.loggedIn||this.loginPending},setLoggedIn:function(c){this.superClass.setLoggedIn.apply(this,arguments);c?document.title=this.appTitle+" - "+V15.Vf.userName:(document.title=this.appTitle+" - not logged in",this.loginPending=!1)}}}();
CB.ResultPostBack=function(){var c=function(){console.log(window.location.href);this.url="https://www.schach.de/";0<=window.location.href.search("test.schach.de")&&(this.url="http://test.schach.de:62068/",console.log("test url detected"))};c.prototype.postSolved=function(b,c,e){if(b&&c){var f=this.url,f=f+("users/solved?userId="+b+"&posId="+c+String.f("&points={0}",e));$.post(f,null,this.updateUserPoints.bind(this))}};c.prototype.postWrong=function(b,c,e){b&&c&&(e=this.url,e+="users/wrong?userId="+
b+"&posId="+c,$.post(e),console.log(e))};c.prototype.postPlayed=function(b,c){if(b&&c){var e=this.url,e=e+("users/played?userId="+window.playchessUser+"&posId="+c);$.post(e)}};c.prototype.updateUserPoints=function(b){isNaN(b)||$("#UserTotalPoints").text(b.toString())};return c}();"use strict";
CB.ReaderHelper=function(){var c=function(){this.fileList=[];this.requestId=this.nShopId=this.filesInDB=this.indexInList=0;this.aProgressForm=null;this.localDB=localforage.createInstance({name:"GA"})};c.prototype.onCheckHardware=function(b,c){var e=!1;if(null==b){var f=!1;if(null!=c)c===this.getHardwareGuid()?e=f=!0:alert(lm.YOUR_SYSTEMS_CONFIGURATION_HAS_CHANGED);else{var g=CB.DOM.getCookie("hardware"),h=CB.DOM.getCookie("serial");null!==g&&null!==h&&(new CB.AccountsManager(V15.shortAppName)).activateTrainer(hardwareId,
serial,this.nShopId,this.OnActivate.bind(this))}f||(this.removeProduct(this.nShopId),alert(lm.PLEASE_ACTIVATE_THIS_PRODUCT))}return e};c.prototype.checkHardware=function(b){var c=CB.DOM.getCookie("hardware");null===c||""===c?this.localDB.getItem("hardware",function(c,d){b(c,d)}):b(null,c)};c.prototype.onGetItem=function(b){b&&(this.indexInList++,this.checkNextGameActionFile())};c.prototype.onRemoveItems=function(){if(this.fileList)for(var b=0;b<this.fileList.length;b++){var c=this.constructItemName(this.fileList[b]),
c=c.substr(0,c.length-4);this.localDB.removeItem(c,function(b,c){})}};c.prototype.removeProduct=function(b){this.readGameActionFileList(function(){this.onRemoveItems()}.bind(this))};c.prototype.downloadAllGameActions=function(){this.showProgressDialog();this.indexInList=0;this.downloadNextGameActionFile()};c.prototype.downloadNextGameActionFile=function(){if(this.indexInList<this.fileList.length){var b=this.getHardwareGuid(),c=100*this.indexInList/this.fileList.length;this.aProgressForm.progress.jqxProgressBar("value",
c);CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.updateProgressBar(V15,c/100);var c=this.constructItemName(this.fileList[this.indexInList]),e=c.substr(0,c.length-4);$.get("https://videos.chessbase.com/Replay/GetGameActionsTrainer?id="+e+"&Request="+this.requestId+"&Product="+this.nShopId+"&Hardware="+b,function(b){b&&b.length&&(this.localDB.setItem(e,b,function(b,c){null!=b&&alert(b)}),this.indexInList++,this.downloadNextGameActionFile())}.bind(this)).fail(function(){alert("failed")}.bind(this))}else CB.System.isElectron()&&
"undefined"!==typeof electronBridge&&electronBridge.updateProgressBar(V15,-1),$(this.aProgressForm.nestDiv).jqxWindow("hide"),$(this.aProgressForm.nestDiv).remove(),CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.showAlert(V15,lm.PRODUCT_IS_ACTIVATED),CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.reloadPage()};c.prototype.isFileAvailable=function(b,c){var e=this.constructItemName(b),e=e.substr(0,e.length-4);this.localDB.getItem(e,function(b,
e){c(e)})};c.prototype.descrambleTime=function(b){return parseInt(b)^this.nShopId};c.prototype.descrambleAction=function(b,c,e){c=c%5+1;return e.substr(0,c)===b.substr(0,c)?b.substr(c):""};c.prototype.constructItemName=function(b){return this.nShopId+"-"+b};c.prototype.readGameActionListReady=function(){this.filesInDB=this.indexInList=0;this.checkNextGameActionFile()};c.prototype.readGameActionFileList=function(b){try{var c=new XMLHttpRequest;c.open("GET","gameactions.txt",!0);c.onreadystatechange=
function(){if(4===c.readyState&&(200===c.status||0==c.status)){var e=c.responseText;this.fileList=[];for(var e=e.split("\r\n"),f=0;f<e.length;f++)0<e[f].length&&this.fileList.push(e[f]);b()}}.bind(this);c.send(null)}catch(e){CB.LogException("RN:readGameActionFileList",e),b()}};c.prototype.readShopId=function(b){try{var c=new XMLHttpRequest;c.open("GET","shop.txt",!0);c.onreadystatechange=function(){if(4===c.readyState&&(200===c.status||0===c.status)){var b=c.responseText;this.fileList=[];for(var b=
b.split("\r\n"),f=0;f<b.length;f++)0<b[f].length&&(this.nShopId=b[f])}}.bind(this);c.send(null)}catch(e){CB.LogException("RWM:readShopId",e)}};c.prototype.getUnmaskedInfo=function(b){var c={renderer:"",vendor:""},e=b.getExtension("WEBGL_debug_renderer_info");null!=e&&(c.renderer=b.getParameter(e.UNMASKED_RENDERER_WEBGL),c.vendor=b.getParameter(e.UNMASKED_VENDOR_WEBGL));return c};c.prototype.getHardwareGuid=function(){var b=document.getElementById("glcanvas").getContext("experimental-webgl");b||alert("forgot webgl tag?");
for(var b=this.getUnmaskedInfo(b).vendor+this.getUnmaskedInfo(b).renderer,c=CB.System.getHardwareId(),e="",f=0;f<b.length;f++)if(f<c.length)var g=b[f].charCodeAt()^c[f].charCodeAt(),e=e+String.fromCharCode(65+g%26);return e=CB.System.getOSChar()+e};c.prototype.OnDeactivate=function(b){alert("deactivated")};c.prototype.OnActivate=function(b){var c=b.Reason;this.requestId=b.RequestId;if("Server Maintenance"===b.Result)alert(lm.SERVER_IS_IN_MAINTENANCE);else switch(c){case "80":this.localDB.setItem("hardware",
this.getHardwareGuid(),function(b,c){null!=b&&alert(b)});this.downloadAllGameActions();break;case "81":alert(lm.PRODUCT_KEY_ALREADY_USED_BEFORE);break;case "83":alert(lm.PRODUCT_KEY_IS_DISABLED);break;case "84":alert(lm.PRODUCT_KEY_IS_INVALID);break;case "85":alert(lm.PRODUCT_KEY_ALREADY_ACTIVATED);break;case "86":alert(lm.PRODUCT_KEY_NOT_VALID_FOR_THIS_PRODUCT)}};c.prototype.showActivateDialog=function(){var b=new CB.SerialForm,c=this.getHardwareGuid();CB.DOM.setCookie("hardware",c,365);var e=lm.PLEASE_ACTIVATE_THIS_PRODUCT;
TRACE("harwareid:"+c);b.createSerialForm(e,function(b){b.idSerial=b.idSerial.trim();if(29===b.idSerial.length)if("DATA"===b.idSerial.substr(25,4)){b=b.idSerial.substr(0,25);var e=new CB.AccountsManager(V15.shortAppName);CB.DOM.setCookie("serial",b,365);e.activateTrainer(c,b,this.nShopId,this.OnActivate.bind(this))}else alert(lm.LAST_BLOCK_SHOULD_CONTAIN_DATA);else alert(lm.PRODUCT_KEY_CONTAINS_5_BLOCKS)}.bind(this),function(b){}.bind(this),"")};c.prototype.onValidDeactivate=function(b){var c=b.Reason;
if("Server Maintenance"===b.Result)alert(lm.SERVER_IS_IN_MAINTENANCE);else switch(c){case "110":this.removeProduct(this.nShopId),alert(lm.PRODUCT_IS_DEACTIVATED)}};c.prototype.showDeactivateDialog=function(){var b=new CB.SerialForm,c=this.getHardwareGuid(),e=lm.DEACTIVATE_THIS_PRODUCT;TRACE("harwareid:"+c);b.createSerialForm(e,function(b){b.idSerial=b.idSerial.trim();29===b.idSerial.length?(b=b.idSerial.substr(0,25),(new CB.AccountsManager(V15.shortAppName)).deactivateTrainer(c,b,this.onValidDeactivate.bind(this))):
alert(lm.PRODUCT_KEY_CONTAINS_5_BLOCKS)}.bind(this),function(b){}.bind(this),"")};c.prototype.feedbackProduct=function(){(new CB.FeedbackForm).createFeedbackForm(lm.SEND_YOUR_FEEDBACK,function(b){var c=b.idSubject;b=b.idMessage;this.baseurl=V15.config.getVideoPortalUris()[0];c=this.baseurl+"Public/ReportAProblem?subject="+encodeURIComponent(c)+"&message="+encodeURIComponent(b);$.get(c,function(b){alert("thank you")}.bind(this)).fail(function(){}.bind(this))}.bind(this),function(b){}.bind(this),"")};
c.prototype.showProgressDialog=function(){this.aProgressForm=new CB.ProgressForm;this.aProgressForm.createProgressForm(lm.DOWNLOADING_FILES,function(b){}.bind(this),function(b){}.bind(this),"")};return c}();"use strict";(function(c){c.require=function(){c.each(arguments,function(b,d){0==c('head script[src="'+d+'"]').length&&document.write('<script type="text/javascript" src="'+d+'">\x3c/script>')})}})(jQuery);
CB.ReaderMode={LIVE:1,REPLAY:2,DIAGRAM:3,TABLE:4,PAIRING:5,VIDEO:6,LIVEVIDEO:7,OFFLINEVIDEO:8,RECORDER:9};
CB.ReaderPluginManager=function(){function c(b){return new CB.AnalysisMode(b,1,{hintTimeout:20,liveBookSilent:!0})}function b(b){return new CB.ReaderPlayingMode(b)}function d(b,c){"number"!==typeof b&&(b=0);"number"!==typeof c&&(c=0);return c-b}function e(b,c,d){if(c)for(var e=0;e<V15.panelMgr.modules[b].kernel.length;e++)if(V15.panelMgr.modules[b].kernel[e].idGame==c)return V15.panelMgr.modules[b].kernel[e];return V15.panelMgr.modules[b].getKernel(d)}var f=function(b){this.inDestroy=!1;this.allPluginClasses=
".cbreplay,.cblive,.cbdiagram,.cbtable,.cbpairing,.cbvideo,.cblivevideo,.cbofflinevideo,.cbrecorder";f.superClass.call(this,b);this.init();TRACE(window.innerWidth+"/"+window.innerHeight+"/"+window.devicePixelRatio)};CB.inherit(f,CB.PluginManager);f.prototype.init=function(){this.superClass.init.call(this);this.modules=[];this.diagrams=[];this.chat=[];this.book=[];this.video=[];this.offlinevideo=[];this.recorder=[];this.livevideo=[];this.maximized=-1;this.gridCreated=this.engineOpen=!1;this.boardBtns=
[];this.diagramBtns=[];this.tabNavBtns=[];this.buttonImages=[];this.tabNavSwitchDivs=[];this.listResized=[];this.notaResized=[];this.soundBtnSelector=[];this.hasPlugins=0<$(this.allPluginClasses).length;CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setTitleTouchBar(V15,"")};f.prototype.createPanels=function(){this.createHtml();return 0<this.modules.length};f.prototype.createHelper=function(){this.readerHelper=new CB.ReaderHelper;this.readerHelper.readShopId()};f.prototype.onReady=
function(){V15.lobby&&(V15.lobby.requestLiveLists(this.liveLists),V15.playerLobby&&V15.playerLobby.addOnConnectedListener(this.onPlayerLobbyConnect.bind(this)))};f.prototype.loadAzurePlayer=function(b){if("undefined"===typeof V15.AzurePlayerLoaded){var c=document.createElement("link");c.href="//amp.azure.net/libs/amp/latest/skins/amp-default/azuremediaplayer.min.css";c.rel="stylesheet";c.type="text/css";document.getElementsByTagName("head")[0].appendChild(c);jQuery.getScript("//amp.azure.net/libs/amp/latest/azuremediaplayer.min.js",
function(){V15.AzurePlayerLoaded=!0;b()})}else b()};f.prototype.loadNanoPlayer=function(b){"undefined"===typeof V15.NanoPlayerLoaded&&($.ajax({url:"//demo.nanocosmos.de/nanoplayer/api/release/nanoplayer.3.min.js",dataType:"script",async:!1}),V15.NanoPlayerLoaded=!0)};f.prototype.loadRecorder=function(b){"undefined"===typeof V15.RecorderLoaded&&($.ajax({url:"//www.webrtc-experiment.com/common.js",dataType:"script",async:!1}),$.ajax({url:"//www.webrtc-experiment.com/RecordRTC.js",dataType:"script",
async:!1}),$.ajax({url:"//webrtc.github.io/adapter/adapter-latest.js",dataType:"script",async:!1}),V15.RecorderLoaded=!0)};f.prototype.loadOfflinePlayer=function(b){this.createHelper();CB.System.isElectron()&&this.readerHelper.checkHardware(function(b,c){null==b?this.readerHelper.onCheckHardware(b,c)||this.modules[0].offlineVideo.videoManager.disable():alert(b)}.bind(this));CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setMediaTouchBar(V15,"Video");"undefined"===typeof V15.OfflinePlayerLoaded&&
(V15.OfflinePlayerLoaded=!0);b()};f.prototype.createHtml=function(){this.createPlugins();V15.addOnLoginListener(this.onLogInListener.bind(this));this.initLiveGames();this.initDiagramAnimations()};f.prototype.checkRecreateOrientation=function(){var b=this.isTabbedLayout();this.calcIsVerticalLayout();return b!=this.isTabbedLayout()?($(this.allPluginClasses).each(function(b,c){if(this.isOfflineVideo(b))"undefined"==typeof V15.offlinevideoEl&&(V15.offlinevideoEl=[],V15.videoDIV=[],V15.offlinevideo=[]),
V15.offlinevideoEl[b]=document.getElementById("videoEl"+b),V15.videoDIV[b]=V15.offlinevideoEl[b].parentElement,V15.offlinevideo[b]=this.offlinevideo[b],V15.videoDIV[b].removeChild(V15.offlinevideoEl[b]);else if(this.isLiveVideo(b))V15.config.hasFolding=!1,"undefined"==typeof V15.livevideoEl&&(V15.livevideoEl=[],V15.videoDIV=[],V15.livevideo=[]),V15.livevideoEl[b]=document.getElementById("videoEl"+b),V15.videoDIV[b]=V15.livevideoEl[b].parentElement,V15.livevideo[b]=this.livevideo[b],V15.videoDIV[b].removeChild(V15.livevideoEl[b]);
else if(this.isVideo(b))"undefined"==typeof V15.videoEl&&(V15.videoEl=[],V15.videoDIV=[],V15.video=[]),V15.videoEl[b]=document.getElementById("videoEl"+b),V15.videoDIV[b]=V15.videoEl[b].parentElement,V15.video[b]=this.video[b],V15.videoDIV[b].removeChild(V15.videoEl[b]);else if(this.isRecorder(b))"undefined"==typeof V15.recoderEl&&(V15.recorderEl=[],V15.videoDIV=[],V15.recorder=[]),V15.recorderEl[b]=document.getElementById("videoEl"+b),V15.videoDIV[b]=V15.recorderEl[b].parentElement,V15.recorder[b]=
this.recorder[b],V15.videoDIV[b].removeChild(V15.recorderEl[b]);else if(this.isLive(b)){if(this.modules[b].list)for(var d=0;d<this.modules[b].list.length;d++)V15.lobby.setSessionToBackground(this.modules[b].ticket,this.modules[b].list[d].id);$(c).empty(".root");delete this.modules[b].boardArea}}.bind(this)),this.init(),this.createPlugins(),this.createHelpText(V15.isLoggedIn()),this.initLiveGames(),V15.lobby&&null!=V15.lobby.requestLiveLists&&V15.lobby.requestLiveLists(this.liveLists),!0):!1};var g=
0;f.prototype.createPlugins=function(){this.calcIsVerticalLayout();var c=0,d=function(b,d,e,f,g,h){this.instantiated=!0;this.buttonImages[b]={};this.modifyDimensionsOnCreate(d);var l=$(d).text();l&&($(d).text(""),$(d).attr("data-move")&&(this.pgnStartMoveIndex=Number($(d).attr("data-move"))));e=this.initAbstractModule(d,c,e);f(e,c,l);this.modules.push(e);e.addKernel(this);f=h(d,c,e.getKernel(),"100%");e.panels=f;e.nota=f.nota;e.undo=[];e.redo=[];e.onBoardReady=function(){V15.chessAudio||V15.AzurePlayerLoaded||
V15.NanoPlayerLoaded||V15.OfflinePlayerLoaded||CB.System.isElectron()||(V15.chessAudio=new CB.ChessAudio(V15.config.getExternalCommonPath()+"Media/Sounds/"),(new CB.Timer(function(){V15.chessAudio.loadAll()})).runOnce(5E3))};$(d).on("click",function(b){return function(c){if(this.nActivePlugin!=b&&0<=this.nActivePlugin)this.onPluginExit(this.nActivePlugin);if(this.nActivePlugin!=b)this.onPluginEntry(b);this.nActivePlugin=b}.bind(this)}.call(this,c));f.boardParent&&(e.boardArea=this._createCanvasParent(f.boardParent));
e.engineOpen=!1;g(e,c,l);c++;e.mode==CB.ReaderMode.LIVE&&($("#listParent"+b).text(lm.CONNECTING),$("#listParent"+b).addClass("msgInListParent"))},e=this,f=1;$(this.allPluginClasses).each(function(c,g){$(g).is(".cbreplay")?e.doCreateReplayPlugin(g,c,d):$(g).is(".cblive")?(e.doCreateLivePlugin(g,c,d,f),f++):$(g).is(".cbdiagram")?e.doCreateDiagramPlugin(g,c,d):$(g).is(".cbtable")?e.doCreateTablePlugin(g,c,d):$(g).is(".cbpairing")?d.call(this,c,g,b,function(b){b.mode=CB.ReaderMode.PAIRING},function(b,
c,d){b.getKernel().fnInitGame=function(){};this.loadPairingData(g,c)}.bind(this),function(b,c,d,e){return this.createPluginElementsTable(b,c)}.bind(this)):$(g).is(".cbvideo")?this.loadAzurePlayer(function(){e.doCreateVideoPlugin(g,c,d)}.bind(this)):$(g).is(".cblivevideo")?(this.loadNanoPlayer(),e.doCreateLiveVideoPlugin(g,c,d)):$(g).is(".cbrecorder")?(this.loadRecorder(),e.doCreateRecorderPlugin(g,c,d)):$(g).is(".cbofflinevideo")&&this.loadOfflinePlayer(function(){e.doCreateOfflineVideoPlugin(g,c,
d)}.bind(this))}.bind(this));V15.isLive=0<$(".cblive").length||0<$(".cblivevideo").length;V15.isAnyPlugin=0<$(this.allPluginClasses).length;$(document.body).unbind("keydown");$(document.body).on("keydown",function(b){this.chat[this.nActivePlugin]&&this.chat[this.nActivePlugin].hasFocus()||this.handleKeyDown(b,this.nActivePlugin||0)&&b.preventDefault()}.bind(this));$(document.body).unbind("orientationchange");$(document.body).on("orientationchange",function(b){this.onOrientationChange()}.bind(this));
this.pluginCnt=c};f.prototype.doCreateReplayPlugin=function(c,d,e){e.call(this,d,c,b,function(b,c){b.mode=CB.ReaderMode.REPLAY},function(b,d,e){b.getKernel().fnInitGame=this.getFnKernelInitGame(c,d);this.createPgnDatabase(c,this.createDatabaseGrid.bind(this),d,e);b.toPgn=function(b){if(b=this.modules[b].pgnDatabase)return b.toString()}.bind(this)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,c,d,e):this.createPluginElementsHori(b,c,d,e)}.bind(this))};
f.prototype.doCreateLivePlugin=function(b,d,e,f){e.call(this,d,b,c,function(b){b.mode=CB.ReaderMode.LIVE},function(c){c.requestData=this.createRequestData(b,f,d,this,c.ticket);c.pgnTitle="LiveGames_"+c.requestData.event+".pgn";c.list=[];c.toPgn=this.moduleGamesToPgn.bind(this);this.resizePlugin($(b),d)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,c,d,e):this.createPluginElementsHori(b,c,d,e)}.bind(this))};f.prototype.doCreateDiagramPlugin=function(b,
c,d){d.call(this,c,b,function(d){b.dataset.play||b.dataset.anim||b.dataset.choice?(d=new CB.MiniPlayMode(d,b.dataset,null,c),d.clearBoardAlways=!!b.dataset.anim):(d=new CB.AnalysisMode(d,1,{hintTimeout:20,liveBookSilent:!0}),d.fnGetMoveEnterType=function(){return CB.MoveEnterType.OVERWRITE_MAIN},d.onEntry=function(){this.gateUpdate.exec(function(){V15.analysisEngine&&V15.analysisEngine.engineGo(this.kernel)}.bind(this),100)});return d},function(b){b.mode=CB.ReaderMode.DIAGRAM},function(d,e,f){d.toPgn=
function(b){b=this.modules[b].getKernel().game;return CB.PGNWriter.toPGN(b)}.bind(this);d.pgnTitle="Position.pgn";d.getKernel().fnInitGame=this.getFnKernelInitDiagram(b,c,this,f);this.resizeDiagram($(b),c)}.bind(this),function(b,c,d,e){this.modifyPlayingModeForTraining(b,c,d);return this.createPluginElementsDiagram(b,c,d)}.bind(this))};f.prototype.doCreateTablePlugin=function(c,d,e){e.call(this,d,c,b,function(b){b.mode=CB.ReaderMode.TABLE},function(b,d,e){b.getKernel().fnInitGame=function(){};this.loadTableData(c,
d)}.bind(this),function(b,c,d,e){return this.createPluginElementsTable(b,c)}.bind(this))};f.prototype.modifyDimensionsOnCreate=function(b){$(b).hasClass("cbtable")||$(b).hasClass("cbdiagram")||$(b).hasClass("cbpairing")||((CB.System.isMobile()||this.isTabbedLayout())&&$(b).css("min-width",220),this.isTabbedLayout()?CB.System.runsOnVideosChessBaseCom()?b.style.height="80vh":CB.System.runsOnLiveChessBaseCom()&&(CB.System.isFullScreen()?b.style.height="100vh":b.style.height="92vh"):b.style.minHeight=
"400px",b.style.clear="both")};f.prototype.createPluginElementsDiagram=function(b,c,d,e){return{nota:null,boardParent:this.createDiagramElements(b,c)}};f.prototype.createPluginElementsTable=function(b,c){return{nota:null,boardParent:null}};f.prototype.createCrossTable=function(b,c,d,e,f){if(d.Players){d=CB.Tournament.fromObject(d);var g=CB.TiebrakeInfo.arrFromString(d.strTB||e.tbs),g=new CB.RankingOptions(g,e.top),h=new CB.Ranking(d,e.round,g,f,e);this.modules[c].ranking=h;e=$(b).width();$(b).html("");
h.addListener("Changed",function(){$(b).width();this.resizeTable(b,c);h.resized||(h.resized=!0)}.bind(this));e=h.toHtml(e)[0];b.appendChild(e);this.resizeTable(b,c)}};f.prototype.createPairings=function(b,c,d,e,f){var g=CB.Tournament.fromObject(d);d=e.round;0==d&&(d=g.availbeRounds[g.availbeRounds.length-1]);e=new CB.Ranking(g,1E4,{tiebreakInfosArr:[]},f,e);var h=new CB.Pairings(e);h.round=d;this.modules[c].pairing=h;h.addListener("Changed",function(){$(b).width();this.resizePairings(b,c);h.resized||
(h.resized=!0)}.bind(this));e=h.RoundToHtml(d)[0];b.appendChild(e);this.resizePairings(b,c)};f.prototype.doCreateVideoPlugin=function(c,d,e){e.call(this,d,c,b,function(b,c){b.mode=CB.ReaderMode.VIDEO},function(b,d,e){b.getKernel().fnInitGame=this.getFnKernelInitGame(c,d);this.createVideoDatabase(c,this.createVideoGrid.bind(this),d,e);b.toPgn=function(b){if(b=this.modules[b].pgnDatabase)return b.toString()}.bind(this)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,
c,d,e):this.createPluginElementsHori(b,c,d,e)}.bind(this))};f.prototype.doCreateLiveVideoPlugin=function(c,d,e){e.call(this,d,c,b,function(b,c){b.mode=CB.ReaderMode.LIVEVIDEO},function(b,d,e){b.getKernel().fnInitGame=this.getFnKernelInitGame(c,d);this.createLiveVideoDatabase(c,this.createLiveVideoGrid.bind(this),d,e);b.toPgn=function(b){if(b=this.modules[b].pgnDatabase)return b.toString()}.bind(this)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,c,d,
e):this.createPluginElementsHori(b,c,d,e)}.bind(this))};f.prototype.doCreateOfflineVideoPlugin=function(c,d,e){e.call(this,d,c,b,function(b,c){b.mode=CB.ReaderMode.OFFLINEVIDEO},function(b,d,e){b.getKernel().fnInitGame=this.getFnKernelInitGame(c,d);this.createOfflineVideoDatabase(c,this.createOfflineVideoGrid.bind(this),d,e);b.toPgn=function(b){if(b=this.modules[b].pgnDatabase)return b.toString()}.bind(this)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,
c,d,e):this.createPluginElementsHori(b,c,d,e)}.bind(this))};f.prototype.doCreateRecorderPlugin=function(c,d,e){e.call(this,d,c,b,function(b,c){b.mode=CB.ReaderMode.RECORDER},function(b,d,e){b.getKernel().fnInitGame=this.getFnKernelInitGame(c,d);this.createPgnDatabase(c,this.createDatabaseGrid.bind(this),d,e);b.toPgn=function(b){if(b=this.modules[b].pgnDatabase)return b.toString()}.bind(this)}.bind(this),function(b,c,d,e){return this.isTabbedLayout()?this.createPluginElementsTabbed(b,c,d,e):this.createPluginElementsHori(b,
c,d,e)}.bind(this))};var h=new CB.Vr,l=new CB.Vr,q=new CB.Vr;f.prototype.createPluginElementsHori=function(b,c,d,e){this.modules[c].noBook=null!=b.dataset.nobook;this.hasCaptionBar(c)&&(e=this.createDiv("cbcaption",c),b.appendChild(e));var f=this.createDiv("rootParent",c);b.appendChild(f);e=this.createDiv("root",c);f.appendChild(e);var g=this.createDiv("west",c);e.appendChild(g);f=this.createDiv("westNest",c);g.appendChild(f);var h=this.createDiv("westNorth",c);f.appendChild(h);g=this.createDiv("westSouth",
c);f.appendChild(g);var l=this.createDiv("east",c);e.appendChild(l);var q=this.createDiv("eastNest",c);l.appendChild(q);var r=this.createDiv("eastLayer",c);q.appendChild(r);l=this.createDiv("eastUpDownNest",c);r.appendChild(l);this.isLiveVideo(c)&&this.createLiveVideoDivs(l,c);this.isOfflineVideo(c)&&this.createOfflineVideoDivs(l,c);this.isVideo(c)&&this.createVideoDivs(l,c);this.isRecorder(c)&&this.createRecorderDivs(l,c);d=this.createNotaDivs(l,c,d);this.hasBook(c)&&this.createBookDivs(l,c);this.hasChat(c)&&
this.createChatDivs(q,c);h=this.createBoardDivs(h,c);this.createEngineDivs(g,c);r=this.createDiv("listParent",c);g.appendChild(r);this.createSplittersHori(b,c,e,f,q,l);this.isAnyVideo(c)&&(new CB.Timer(function(){this.inDestroy||(this.onVideoSplitterResize(c,!1),$("#root"+c)&&$("#root"+c).jqxSplitter("refresh"))}.bind(this))).runOnce(3E3);return{nota:d,boardParent:h}};f.prototype.createNotaDivs=function(b,c,d){var e=this.createDiv("notaNest",c);b.appendChild(e);b=this.createDiv("notaparent",c);var f=
this.createDiv("notaEl",c);b.appendChild(f);e.appendChild(b);d=this._createNotation(f,d,c);b=this.createDiv("belowNota",c);f=this.createDiv("notaButtons",c);b.appendChild(f);e.appendChild(b);this.createNotaButtons(f,c);return d};f.prototype.createBookDivs=function(b,c){var d=this.createDiv("bookparent",c),e=this.createDiv("bookEl",c);d.appendChild(e);b.appendChild(d);this.book[c]=this._createBook(e,c)};f.prototype.createChatDivs=function(b,c){var d=this.createDiv("chatparent",c),e=this.createDiv("chatEl",
c);$(e).height("100%");$(e).width("100%");d.appendChild(e);b.appendChild(d);this.chat[c]=this._createChat(e,c)};f.prototype.createVideoDivs=function(b,c){var d=this.createDiv("videoparent",c);if("undefined"!=typeof V15.videoEl&&V15.videoEl[c])d.appendChild(V15.videoEl[c]),this.video[c]=V15.video[c],this.video[c].videoManager.play();else{var e=this.createDiv("videoEl",c);d.appendChild(e);e.style.height="100%";this.video[c]=this._createVideo(e,c)}b.appendChild(d)};f.prototype.createLiveVideoDivs=function(b,
c){var d=this.createDiv("videoparent",c);if("undefined"!=typeof V15.livevideoEl&&V15.livevideoEl[c])d.appendChild(V15.livevideoEl[c]),this.livevideo[c]=V15.livevideo[c],this.livevideo[c].videoManager&&this.livevideo[c].videoManager.play();else{var e=this.createDiv("videoEl",c);d.appendChild(e);e.style.height="100%";this.livevideo[c]=this._createLiveVideo(e,c)}b.appendChild(d)};f.prototype.createOfflineVideoDivs=function(b,c){var d=this.createDiv("videoparent",c);if("undefined"!=typeof V15.offlinevideoEl&&
V15.offlinevideoEl[c])d.appendChild(V15.offlinevideoEl[c]),this.offlinevideo[c]=V15.offlinevideo[c],this.offlinevideo[c].videoManager&&this.offlinevideo[c].videoManager.play();else{var e=this.createDiv("videoEl",c);d.appendChild(e);this.offlinevideo[c]=this._createOfflineVideo(e,c);this.modules[c].offlineVideo=this.offlinevideo[c]}b.appendChild(d)};f.prototype.createRecorderDivs=function(b,c){var d=this.createDiv("videoparent",c);if("undefined"!=typeof V15.recorderEl&&V15.recorderEl[c])d.appendChild(V15.recorderEl[c]),
this.recorder[c]=V15.recorder[c];else{var e=this.createDiv("videoEl",c);d.appendChild(e);this.recorder[c]=this._createRecorder(e,c);this.modules[c].recorder=this.recorder[c]}b.appendChild(d)};f.prototype.createBoardDivs=function(b,c){var d=this.createDiv("boardHolder",c);$(d).css("backgroundImage","url( "+CB.getCommonPath()+"media/chess/OrangeBrighterSoftBacklightLessSatur.jpg )");b.appendChild(d);var e=this.createDiv("boardArea",c);d.appendChild(e);var d=this.createDiv("belowBoard",c),f=this.createDiv("buttons",
c);d.appendChild(f);b.appendChild(d);this.createBoardButtons(f,c);return e};f.prototype.createBoardDivsTabbed=function(b,c){var d=this.createDiv("boardHolder",c);$(d).css("backgroundImage","url( "+CB.getCommonPath()+"media/chess/OrangeBrighterSoftBacklightLessSatur.jpg )");var e=this.createDiv("boardArea",c);d.appendChild(e);b.appendChild(d);var d=this.createDiv("belowBoard",c),f=this.createDiv("buttons",c);d.appendChild(f);b.appendChild(d);this.createBoardButtons(f,c);$("#boardHolder"+c)[0].style.height=
"calc( 92vh - 34px )";return e};f.prototype.createEngineDivs=function(b,c){var d=this.createDiv("engineParent",c),e=this.createDiv("engineEl",c),f=this.createDiv("engineButtons",c);d.appendChild(f);d.appendChild(e);b.appendChild(d);this.createEngineButtons(f,c);$("#engineButtons"+c).hide()};f.prototype.createSplittersHori=function(b,c,d,e,f,g){var h=this.getSplitterWidth(),l=65,q=50;$(b).is(".cblive")&&(880<$(b).width()&&1100>$(b).width()?(q=65,780>$(b).height()&&(l=60)):(l=76,q=65));if($(b).is(".cbvideo")||
$(b).is(".cblivevideo")||$(b).is(".cbofflinevideo")||$(b).is(".cbrecorder"))q=63,l=88;CB.System.isMobile()&&500>window.innerWidth?q=l=65:$(b).width()<1.1*$(b).height()&&(q=65);this.createRootSplitter(c,d,h,q);this.createWestNestSplitter(c,e,h,l);this.createEastNestSplitter(c,f,h);this.isAnyVideo(c)?this.createVideoSplitter(c,g,h,$(b).height()):this.createBookSplitter(c,g,h,$(b).height())};f.prototype.createRootSplitter=function(b,c,d,e){var f=this.loadSplitPos("root",b);e=f&&f.size?f.size:e;$(c).jqxSplitter({width:"100%",
height:"100%",splitBarSize:d,theme:"chessbase",panels:[{size:e+"%",collapsible:!1},{size:100-e+"%",collapsible:!1}]});$(c).on("resize",function(c){CB.LOG("RootResize","","resize");h.exec(function(){this.onSplitterResizeHori(b,!0)}.bind(this),100)}.bind(this))};f.prototype.createWestNestSplitter=function(b,c,d,e){var f=this.loadSplitPos("westNest",b);e=f&&f.size?f.size:e;$(c).jqxSplitter({orientation:"horizontal",splitBarSize:d+1,theme:"chessbase",panels:[{size:e+"%",collapsible:!1},{size:100-e+"%",
collapsible:!1}]});$(c).on("resize",function(c){CB.LOG("WestNestResize","","resize");h.exec(function(){this.onSplitterResizeHori(b,!1)}.bind(this),100)}.bind(this))};f.prototype.createEastNestSplitter=function(b,c,d){if(this.hasChat(b)){var e;e=(e=this.loadSplitPos("eastNest",b))&&e.size?e.size:75;$(c).jqxSplitter({orientation:"vertical",splitBarSize:d+2,theme:"chessbase",panels:[{size:e+"%",collapsible:!1},{size:100-e+"%",collapsible:!1}]});$(c).on("resize",function(c){CB.LOG("EastNestResize","",
"resize");l.exec(function(){this.onEastSplitterResize(b,!1)}.bind(this),50)}.bind(this))}};f.prototype.createBookSplitter=function(b,c,d,e){if(this.hasBook(b)){var f=90;850<e&&(f=86);f=(e=this.loadSplitPos("eastUpDownNest",b))&&e.size?e.size:f;$(c).jqxSplitter({orientation:"horizontal",width:"100%",height:"100%",splitBarSize:d+2,theme:"chessbase",panels:[{size:f+"%",collapsible:!1},{size:100-f+"%",collapsible:!1}]});$(c).on("resize",function(c){CB.LOG("EastNestResize","","resize");q.exec(function(){this.onBookSplitterResize(b,
!1)}.bind(this),50)}.bind(this))}};f.prototype.createVideoSplitter=function(b,c,d,e){if(this.isAnyVideo(b)){var f=90;850<e&&(f=60);this.isAnyVideo(b)&&(f=40);f=(e=this.loadSplitPos("eastUpDownNest",b))&&e.size?e.size:f;$(c).jqxSplitter({orientation:"horizontal",width:"100%",height:"100%",splitBarSize:d+2,theme:"chessbase",panels:[{size:f+"%",collapsible:!1},{size:100-f+"%",collapsible:!1}]});$(c).on("resize",function(c){q.exec(function(){TRACE("resizevideo");this.onVideoSplitterResize(b,!1)}.bind(this),
150)}.bind(this))}};f.prototype.createPluginElementsTabbed=function(b,c,d,e){return this.createPluginElementsSplitterVerti(b,c,d,e)};f.prototype.createPluginElementsSplitterVerti=function(b,c,d,e){e=this.createDiv("root",c);b.appendChild(e);b=this.createDiv("north",c);e.appendChild(b);var f=this.createDiv("southNest",c),g=this.createDiv("south",c);e.appendChild(g);g.appendChild(f);g=this.createDiv("ribbon",c);f.appendChild(g);var f=this.createDiv("notaparent",c),l=this.createDiv("listParent",c),q=
this.createDiv("videoParent",c);this.isLiveVideo(c)&&this.createLiveVideoDivs(q,c);this.isVideo(c)&&this.createVideoDivs(q,c);this.isOfflineVideo(c)&&this.createOfflineVideoDivs(q,c);this.isRecorder(c)&&this.createRecorderDivs(q,c);g.appendChild(f);g.appendChild(l);this.isAnyVideo(c)&&g.appendChild(q);this.tabNavSwitchDivs[c]=[f,l];this.isAnyVideo(c)&&this.tabNavSwitchDivs[c].push(q);q=this.createDiv("tabNavButtons",c);g.appendChild(q);this.createTabNavButtons(q,c);$(l).text("Just one game here...");
g=this.createDiv("notaEl",c);f.appendChild(g);d=this._createNotation(g,d,c);$("#notaEl"+c)[0].style.height="100%";b=this.createBoardDivsTabbed(b,c);this.fnSelectNota(c);$(e).jqxSplitter({width:"100%",height:"100%",orientation:"horizontal",splitBarSize:10,resizable:!0,theme:"chessbase",panels:[{size:"65%",min:90,max:window.innerWidth+30,collapsible:!1},{size:"35%",min:20}]});$(e).on("resize",function(b){CB.LOG("RootResize","","resize");h.exec(function(){this.onSplitterResizeVerti(c,!1);this.resize(null,
!0)}.bind(this),100)}.bind(this));return{nota:d,boardParent:b}};f.prototype.hideRibbon=function(b){this.isTabbedLayout()&&($("#t-btnSelNota-"+b).remove(),$("#tabNavButtons"+b)[0].style.height="0px")};f.prototype.isTabbedLayout=function(){return this.isVerti};f.prototype.createDiagramElements=function(b,c){this.modules[c].diagramAnimations=this.parseDiagramAnimation(b);this.modules[c].posId=b.dataset.posid;var d=b.dataset.title;if(d){var e=this.createDiv("aboveDiag",c);b.appendChild(e);var f=this.createDiv("diagTitle",
c);e.appendChild(f);$(f).text(d)}d=this.createDiv("diagarea",c);b.appendChild(d);var g,e=this.needsDiagramAnimButtons(c);if("0"!=b.dataset.buttons||e)g=this.createDiv("belowDiag",c),b.appendChild(g),e=this.createDiv("diagButtons",c),g.appendChild(e),this.needsDiagramAnimButtons(c)?this.createDiagramAnimButtons(e,b,c):this.createDiagramReplayButtons(e,b,c);if(e=b.dataset.legend)g||(g=this.createDiv("belowDiag",c),b.appendChild(g)),f=this.createDiv("diagText",c),g.appendChild(f),$(f).text(e);(e=b.dataset.choice)&&
this.createMultipleChoice(b,g,e,c);return d};f.prototype.createMultipleChoice=function(b,c,d,e){c||(c=this.createDiv("belowDiag",e),b.appendChild(c));b=this.createDiv("diagChoices",e);c.appendChild(b);(d=JSON.parse(d))&&d.entries?(this.modules[e].diagramChoice=d,this.createChoiceTable(b,d,e),e=this.createDiv("diaChoiceFeedback",e),c.appendChild(e)):$(b).text("Parsing Error")};f.prototype.createChoiceTable=function(b,c,d){var e;e="<table>"+String.f("<thead><tr><th colspan='2'>{0}</th></thead>",c.title);
for(var f=0;f<c.entries.length;f++){var g=String.f("V15.panelMgr.onChoiceClick( {0}, {1} )",d,f),g=String.f("<input type='checkbox' id='checkChoice{0}-{1}' onclick='{2}'/>",d,f,g);e+=String.f("<tr><td>{0}</td><td>{1}</td></tr>",g,c.entries[f].text)}b.appendChild($(e+"</table>")[0])};f.prototype.onChoiceClick=function(b,c){if(this.modules[b].diagramChoice){var d=this.modules[b].diagramChoice.attrs;d&&d.length||(d=this.modules[b].diagramChoice.entries[c].attrs);this.modules[b].diagramChoice.entries[c].correct?
($("#diaChoiceFeedback"+b).css("color","green"),window.playchessUser&&!this.modules[b].diagramChoice.entries[c].done&&V15.resultPostBack.postSolved(window.playchessUser,this.modules[b].posId||"noid",1),this.modules[b].diagramChoice.entries[c].done=!0,this.modules[b].getKernel().boardWin.addCheckMark()):($("#diaChoiceFeedback"+b).css("color","red"),this.modules[b].getKernel().boardWin.destroySideIcon());$("#diaChoiceFeedback"+b).text(this.modules[b].diagramChoice.entries[c].feedback);this.modules[b].getKernel().boardWin.addAttributes([]);
this.modules[b].getKernel().Vk.showChoiceFeedback(d)}for(d=0;d<this.modules[b].diagramChoice.entries.length;d++)d!=c&&$(String.f("#checkChoice{0}-{1}",b,d)).prop("checked",!1)};f.prototype.hasAutoStartDiaAnimation=function(b){return!1};f.prototype.needsDiagramAnimButtons=function(b){if(this.modules[b]&&(b=this.modules[b].diagramAnimations))return CB.DiagramAnimationController.needsDiagramAnimButtons(b)};f.prototype.currPluginIsAnimatedDiagram=function(){return this.needsDiagramAnimButtons(this.nActivePlugin)};
f.prototype.parseDiagramAnimation=function(b){if(b=b.dataset.anim)if(b=b.replace(/[^\S ]+/g,""))try{var c=b.split(";");for(b=0;b<c.length;b++)c[b]=c[b].trim();return c}catch(d){CB.LOG("Animation error: "+d)}};f.prototype._createNotation=function(b,c,d){var e=ObjUtil.clone(CB.cbNotationDefaults);e.useMatBalance=!this.isTabbedLayout();b=CB.NotaElement.factory(b,null,e,d,this.modules[d].ticket);b.setGame(c.game);return b};f.prototype._createChat=function(b,c){return CB.ChatElement.factory(b,c,this.fnSendChat.bind(this),
{noInvite:!1})};f.prototype._createBook=function(b,c){return CB.LiveBookElement.factory(b,c,function(){return this.modules[c].getKernel()}.bind(this),this.modules[c].ticket)};f.prototype._createVideo=function(b,c){return CB.VideoElement.factory(b,c,function(){return this.modules[c].getKernel()}.bind(this),this.modules[c].ticket,this.onGameAction.bind(this),this.onVideoEnd.bind(this))};f.prototype._createLiveVideo=function(b,c){return CB.LiveVideoElement.factory(b,c,function(){return this.modules[c].getKernel()}.bind(this),
this.modules[c].ticket,this.onLiveGameAction.bind(this))};f.prototype._createOfflineVideo=function(b,c){return CB.OfflineVideoElement.factory(b,c,function(){return this.modules[c].getKernel()}.bind(this),this.modules[c].ticket,this.onGameAction.bind(this),this.onOfflineVideoEnd.bind(this))};f.prototype._createRecorder=function(b,c){return CB.RecorderElement.factory(b,c,function(){return this.modules[c].getKernel()}.bind(this),this.modules[c].ticket,this.onGameAction.bind(this),this.onOfflineVideoEnd.bind(this))};
f.prototype.chatOut=function(b,c){this.chat[0]&&this.chat[0].out(b,c)};f.prototype.getNPluginByTicket=function(b){for(var c=0;c<this.modules.length;c++)if(this.modules[c].ticket==b)return c;return 0};f.prototype.kibitzChatOut=function(b,c,d,e,f,g){var h=0;e&&e.ticket&&(h=this.getNPluginByTicket(e.ticket));this.chat[h]&&this.chat[h].addKibitzChat(b,c,d,e,f,g)};f.prototype.loginOkOut=function(b,c){this.chat[b]&&this.chat[b].addKibitzChat(sender,null,c,gameTicket,!0,!0)};f.prototype.onChatLog=function(b,
c){var d=this.getNPluginByTicket(b);if(this.chat[d])for(d=0;d<c.length;d++)this.kibitzChatOut(c[d].sender,c[d].hdr,c[d].txt,{idGame:c[d].gameId,ticket:b,mvInx:c[d].mvInx},c[d].autoChat,d==c.length-1)};f.prototype.fnSendChat=function(b,c){if(V15.isLoggedIn()&&V15.Vf.userName){var d=this.modules[b].getKernel();if(d&&d.idGame)return V15.lobby.sendChat(V15.Vf.userName,d.idGame,c),d}else this.chat[b].inviteLogin()};f.prototype.createDatabaseGrid=function(b,c,d){$("#boardHolder"+c).height();$($(".cbreplay")[c]).height();
CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setReplayTouchBar(V15,"Replay");var e=this;$("#listParent"+c).jsGrid({width:"400px",height:"100%",heading:!1,filtering:!1,editing:!1,inserting:!1,updateOnResize:!1,sorting:!0,autoload:!1,rowClick:function(f){d(b.getGame(f.item.No),c,f.item.No);e.isVerti&&e.fnSelectNota(c)},controller:{loadData:function(c){c=[];for(var d=1;d<=b.getGameCount();d++){var e=b.getHeaderJson(d),f=e.white,g=e.black,h=e.elow?e.elow:"-",l=e.elob?e.elob:
"-",q=e.result,r=e.eco,z=e.event,t=e.date?e.date:" ",C=d,v="";e.round&&(v=e.round,e.subRound&&(v+="."+e.subRound));c.push({White:f,Black:g,EloW:h,EloB:l,Res:q,ECO:r,Event:z,Year:t,No:C,Rnd:v,Len:e.plyCount})}return c}},fields:this.getGridFields(this.getGridWidth(c),!1)});this.gridCreated=!0;$("#listParent"+c).jsGrid("loadData");this.resize(null,!0);(new CB.Timer(function(){this.onSplitterResize(c);console.log("ResizePGN");(new CB.Timer(function(){console.log("ResizePGN2");$("#listParent"+c).jsGrid("loadData");
this.resize(null,!0);0<$("#westNest"+c).length&&$("#westNest"+c).jqxSplitter("refresh");0<$("#eastNest"+c).length&&$("#eastNest"+c).jqxSplitter("refresh");0<$("#root"+c).length&&$("#root"+c).jqxSplitter("refresh")}.bind(this))).runOnce(1E3)}.bind(this))).runOnce(1600);this.isRecorder(c)&&(new CB.Timer(function(){this.recorder[0].videoManager.setUrl()}.bind(this))).runOnce(100);return this.loadFromDBByUrlParam(b,c,d)?!0:(d(b.getGame(1),c,1),!1)};f.prototype.createLiveListGrid=function(b,c,e){$("#listParent"+
c).removeClass("msgInListParent");var f=this.getGridFields(this.getGridWidth(c),!0),g=this;$("#listParent"+c).jsGrid({width:"400px",height:"100%",heading:!1,filtering:!1,editing:!1,inserting:!1,updateOnResize:!1,sorting:!0,loadMessage:"Retrieving games ...",loadShading:!0,autoload:!1,rowClick:function(b){e(b.item.id,c,!1);g.isVerti&&g.fnSelectNota(c)},controller:{loadData:function(c){c=[];for(var d=0;d<b.games.length;d++){var e=b.games[d],f=e.white,h=e.black,l=e.eloWhite?e.eloWhite:"-",q=e.eloBlack?
e.eloBlack:"-",r=g.getResIcon(e.result),z=e.eco?CB.GameHeader.ECOtoString(e.eco):"",t=e.tourn,C=d+1,v=e.watchers,y="";e.round1&&(y=e.round1,e.round2&&(y+="."+e.round2));c.push({White:f,Black:h,EloW:l,EloB:q,Res:r,ECO:z,Event:t,No:C,NKib:v,Rnd:y,Len:Math.ceil(e.moveLen/2),id:e.id,Stat:e.stat})}return c}},fields:f});this.gridCreated=!0;$("#listParent"+c).jsGrid("loadData");jsGrid.sortStrategies.number=d;b.games.length&&(new CB.Timer(function(){e(b.games[0].id,c);for(var d=1;d<b.games.length;d++)(b.games[d].shouldRequestImmediatelyInLive()||
6>=d)&&14>=d&&e(b.games[d].id,c,!0);this.loadByUrlParam(b.games,c,e);this.onSplitterResize(c)}.bind(this))).runOnce(500)};f.prototype.createVideoGrid=function(b,c,d){this.modules[c].getKernel().Interactive=b.Interactive;$("#boardHolder"+c).height();$($(".cbreplay")[c]).height();var e=this;$("#listParent"+c).jsGrid({width:"400px",height:"100%",heading:!1,filtering:!1,editing:!1,inserting:!1,updateOnResize:!1,sorting:!0,autoload:!1,rowClick:function(f){this.loadFromVideos(b,f.itemIndex,c,d);e.isVerti&&
e.fnSelectNota(c)}.bind(this),controller:{loadData:function(c){c=[];if(b&&b.Items)for(var d=0;d<b.Items.length;d++){var f=b.Items[d],f={Duration:e.getDurationString(f.DurationSeconds),Name:f.Name,Id:f.Id};c.push(f)}return c}},fields:this.getVideoGridFields(this.getGridWidth(c),!1)});this.gridCreated=!0;$("#listParent"+c).jsGrid("loadData");this.resize(!0);(new CB.Timer(function(){this.onSplitterResize(c);0<$("#westNest"+c).length&&$("#westNest"+c).jqxSplitter("refresh");0<$("#eastNest"+c).length&&
$("#eastNest"+c).jqxSplitter("refresh");0<$("#root"+c).length&&$("#root"+c).jqxSplitter("refresh")}.bind(this))).runOnce(1E3);if("undefined"==typeof V15.videoEl){var f=0;if(b&&b.Items)for(var g=0;g<b.Items.length;g++)if(b.Preferred===b.Items[g].Id){f=g;break}(new CB.Timer(function(){this.show||this.loadFromVideos(b,f,c,d);this.isTabbedLayout()&&(this.onSplitterResize(c),this.fnSelectTab(c,2),(new CB.Timer(function(){if(0<$("#root"+c).length)this.onSplitterResizeVerti(c,!1);this.resize(null,!0)}.bind(this))).runOnce(1E3))}.bind(this))).runOnce(100)}else this.setCaptionText(b.Items[0].Name,
c);return!0};f.prototype.createLiveVideoGrid=function(b,c,d){this.modules[c].getKernel().Interactive=!1;$("#boardHolder"+c).height();$($(".cbreplay")[c]).height();this.modules[c].database=b;for(var e=!0,f=0;f<b.results.length;f++)b.results[f].Private||(e=!1);e&&this.getCalendar(c);var g=this;$("#listParent"+c).jsGrid({width:"400px",height:"100%",heading:!1,filtering:!1,editing:!1,inserting:!1,updateOnResize:!1,sorting:!0,autoload:!1,rowClick:function(b){this.loadFromLiveVideos(g.modules[c].database,
b.itemIndex,c,d);g.isVerti&&g.fnSelectNota(c)}.bind(this),controller:{loadData:function(b){b=[];for(var d=0;d<g.modules[c].database.results.length;d++){var e=g.modules[c].database.results[d];e.Private||b.push({Name:e.ID,Id:e.StreamId,url:e.URL,gameId:e.gameId,Connections:e.Connections})}return b}},noDataContent:"Currently no broadcast",fields:this.getLiveVideoGridFields(this.getGridWidth(c),!1)});this.gridCreated=!0;(new CB.Timer(function(){var b=this.buildGetLiveStreamsURL();$.get(b,function(b){if(b){var e=
0;this.modules[c].database&&(e=this.modules[c].database);this.modules[c].database=b;$("#listParent"+c).jsGrid("loadData");0<b.results.length&&0==e.results.length&&(new CB.Timer(function(){this.loadFromLiveVideos(this.modules[c].database,h,c,d);(new CB.Timer(function(){this.onSplitterResize(c);0<$("#westNest"+c).length&&$("#westNest"+c).jqxSplitter("refresh");0<$("#eastNest"+c).length&&$("#eastNest"+c).jqxSplitter("refresh");0<$("#root"+c).length&&$("#root"+c).jqxSplitter("refresh")}.bind(this))).runOnce(1E3)}.bind(this))).runOnce(100)}}.bind(this)).fail(function(){this.resizePlugin($(pluginDiv),
c)}.bind(this))}.bind(this))).runPeriodic(3E4);$("#listParent"+c).jsGrid("loadData");this.resize(!0);(new CB.Timer(function(){this.onSplitterResize(c);0<$("#westNest"+c).length&&$("#westNest"+c).jqxSplitter("refresh");0<$("#eastNest"+c).length&&$("#eastNest"+c).jqxSplitter("refresh");0<$("#root"+c).length&&$("#root"+c).jqxSplitter("refresh");this.show&&0==b.results.length&&(this.inDestroy=!0,this.modules&&this.modules[0]&&this.modules[0].getKernel()&&this.modules[0].getKernel().boardWin&&this.modules[0].getKernel().boardWin.destroyMessage(),
this.deleteRoot(0),this.inDestroy=!1,this.modules[c].pluginDiv.className="cbvideo",V15.panelMgr.init(),V15.panelMgr.createPanels())}.bind(this))).runOnce(1E3);if("undefined"==typeof V15.videoEl){for(var h=0,f=0;f<b.results.length;f++)if(b.Preferred===b.results[f].Id){h=f;break}(new CB.Timer(function(){this.loadFromLiveVideos(b,h,c,d)}.bind(this))).runOnce(100)}else 0<b.results.length&&this.setCaptionText(b.results[0].ID,c);return!0};f.prototype.createOfflineVideoGrid=function(b,c,d){this.modules[c].getKernel().Interactive=
!1;$("#boardHolder"+c).height();$($(".cbreplay")[c]).height();this.modules[c].database=b;this.modules[c].selectedLecture=0;var e=this;$("#listParent"+c).jsGrid({width:"400px",height:"100%",heading:!1,filtering:!1,editing:!1,inserting:!1,updateOnResize:!1,sorting:!0,autoload:!1,rowClick:function(b){e.modules[c].selectedLecture=c;this.loadFromOfflineVideos(e.modules[c].database,b.itemIndex,c,d);e.isVerti&&e.fnSelectNota(c)}.bind(this),controller:{loadData:function(b){b=[];for(var d=0;d<e.modules[c].database.results.length;d++){var f=
e.modules[c].database.results[d];b.push({Name:f.Name,Id:f.Id,url:f.url,gameId:f.gameId})}return b}},noDataContent:"Currently no broadcast",fields:this.getOfflineVideoGridFields(this.getGridWidth(c),!1)});this.gridCreated=!0;$("#listParent"+c).jsGrid("loadData");this.resize(!0);(new CB.Timer(function(){this.onSplitterResize(c);0<$("#westNest"+c).length&&$("#westNest"+c).jqxSplitter("refresh");0<$("#eastNest"+c).length&&$("#eastNest"+c).jqxSplitter("refresh");0<$("#root"+c).length&&$("#root"+c).jqxSplitter("refresh")}.bind(this))).runOnce(1E3);
if("undefined"==typeof V15.videoEl){for(var f=0,g=0;g<b.results.length;g++)if(b.Preferred===b.results[g].Id){f=g;break}(new CB.Timer(function(){this.loadFromOfflineVideos(b,f,c,d)}.bind(this))).runOnce(100)}else 0<b.results.length&&this.setCaptionText(b.results[0].Name,c);return!0};f.prototype.getCalendar=function(b){0<this.livevideo.length&&(this.livevideo[b].videoManager.el.innerHTML="<iframe  style='width:100%;height:100%;' src='https://en.chessbase.com/playchess2/events.aspx/video'></iframe>")};
f.prototype.getDateString=function(b){return"undefined"!==typeof b?b.toString():"?"};f.prototype.getDurationString=function(b){var c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60);b=b-3600*c-60*d;c="0"+c+":";if(0!=d||""!==c)d=10>d&&""!==c?"0"+d:String(d),c+=d+":";return c=""===c?b+"s":c+(10>b?"0"+b:String(b))};f.prototype.loadByUrlParam=function(b,c,d){var e=decodeURIComponent(CB.strUtil.trimQuotes(CB.strUtil.getURLParam("w"))),f=decodeURIComponent(CB.strUtil.trimQuotes(CB.strUtil.getURLParam("b"))),
g=CB.strUtil.trimQuotes(CB.strUtil.getURLParam("r")),h=CB.strUtil.trimQuotes(CB.strUtil.getURLParam("r2")),l=CB.strUtil.trimQuotes(CB.strUtil.getURLParam("mv"));if(e.length&&f.length)for(var q=0;q<b.length;q++)if(0==b[q].white.indexOf(e)&&0==b[q].black.indexOf(f)){var r=0==g.length||b[q].round1==parseInt(g);if(r=r&&0==h.length||b[q].round2==parseInt(h))return d(b[q].id,c,!1,l),this.nActivePlugin=c,!0}};f.prototype.loadFromDBByUrlParam=function(b,c,d){var e=decodeURIComponent(CB.strUtil.trimQuotes(CB.strUtil.getURLParam("w"))),
f=decodeURIComponent(CB.strUtil.trimQuotes(CB.strUtil.getURLParam("b"))),g=CB.strUtil.trimQuotes(CB.strUtil.getURLParam("r")),h=CB.strUtil.trimQuotes(CB.strUtil.getURLParam("r2")),l=CB.strUtil.trimQuotes(CB.strUtil.getURLParam("mv"));if(e.length&&f.length)for(var q=0;q<b.getGameCount()&&100>q;q++){var r=b.getHeaderJson(q+1);if(0==r.white.indexOf(e)&&0==r.black.indexOf(f)){var t=0==g.length||r.round==parseInt(g);if(t=t&&0==h.length||r.subRound==parseInt(h))return b=b.getGame(q+1),d(b,c,q+1,!1,parseInt(l)),
this.nActivePlugin=c,!0}}return!1};f.prototype.onLiveGameAction=function(b,c){if(b.GA){var d=b.GA,e=new CB.DataBuffer;e.constructFromBase64(d);e.rewind();e=e.exportAsCompressedString();this.modules[c].getKernel().executeGameAction("GC",e);this.modules[c].boardArea&&this.modules[c].boardArea.canvas&&this.modules[c].boardArea.canvas.requestRedraw()}else b.ASKBESTMOVE&&(d=b.ASKBESTMOVE,e=new CB.DataBuffer,e.constructFromBase64(d),e.rewind(),e=e.exportAsCompressedString(),d=new CB.DataBuffer,d.constructFromString(e,
!0),d.rewind(),e=new CB.Position,e.read(d),this.modules[c].getKernel().Vk.posAskBestmove=e,this.modules[c].getKernel().boardWin.addMessage("Please enter your move",!0))};f.prototype.mustExecute=function(b,c){return b>=c&b<c+1};f.prototype.onGameAction=function(b,c){if(this.gameactions){if(CB.System.isElectron()&&"undefined"!==typeof electronBridge&&this.offlinevideo&&this.offlinevideo[b]&&this.offlinevideo[b].videoManager){var d=this.offlinevideo[b].videoManager.getDuration(),d=parseInt(100*c/d,10);
electronBridge.updateSlider(V15,d)}for(d=0;d<this.gameactions.length;d++)if(this.mustExecute(this.gameactions[d].time,c)&&(0!=c&&this.modules[b].getKernel().executeGameAction(this.gameactions[d].type,this.gameactions[d].action),this.modules[b].boardArea&&this.modules[b].boardArea.canvas&&this.modules[b].boardArea.canvas.requestRedraw(),60<=c-this.modules[b].lastSnippedViewed&&!this.offlinevideo[b])){var e=this.modules[b].getKernel().Vk.videoid;if(e){var f=Math.floor(c)/60,f=Math.floor(f);this.modules[b].endEventFired=
!1;var g="",h="";V15.isLoggedIn()&&V15.Vf.userName&&(h=V15.Vf.userName);h&&(g=encodeURIComponent(h));1<f&&(this.baseurl=V15.config.getVideoPortalUris()[0],e=this.baseurl+"Replay/AddSnippetViewed?id="+encodeURIComponent(e)+"&time="+f+"&user="+g,$.get(e,function(c){"undefined"===typeof this.video[b].loginOk&&c&&0!=c.localeCompare("Ok")&&(this.video[b].videoManager.pause(),0==c.localeCompare("Expert")?this.fnHint("You have to purchase this video in order to watch it",b):this.showAccountsForm(b))}.bind(this)).fail(function(){alert("onsnippedviewed")}.bind(this)))}this.modules[b].lastSnippedViewed=
c}}};f.prototype.showAccountsForm=function(b){0<this.video.length&&this.video[b].videoManager.pause();(new CB.AccountForm).createLoginForm("Login with premium account",function(c){V15.Vf.userName=c.idUser;V15.Vf.password=c.idPassword;V15.Vf.loginMode=CB.LoginMode.NORMAL;(new CB.AccountsManager(V15.shortAppName)).pwLogin(V15.Vf.userName,V15.Vf.password,this.receiveTokenHandler.bind(this),b)}.bind(this),function(c){0<this.video.length&&this.video[b].videoManager.disable()}.bind(this),"")};f.prototype.receiveTokenHandler=
function(b,c){"error"!=b&&"OK"==b.Result&&3<=b.HighestSubscr?(V15.setLoggedIn(!0),this.video[c].videoManager.play(),this.video[c].loginOk=!0):this.video[c].videoManager.disable()};f.prototype.onOfflineVideoEnd=function(b,c){this.modules[b].endEventFired=!0;CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setVideoEndTouchBar(V15,"Video");if(this.modules[b].cmsiManager){var d=c,e=c.lastIndexOf("/");-1!=e&&(d=c.substr(e+1));d=this.modules[b].cmsiManager.extractStateFromFileName(d);
3==d?(this.fnHint("please try again",b),(d=this.modules[b].getKernel())&&d.Vk.restoreMoveEnterPosition()):0==d?(CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setQuestionTouchBar(V15,"Enter your Move"),this.modules[b].getKernel().boardWin.addMessage("Enter your move",!0)):2==d&&(d=this.modules[b].selectedLecture,d<this.modules[b].offlinevideoDatabase.results.length-1&&this.loadNewOfflineVideo(b,this.modules[b].offlinevideoDatabase.results[d+1].Id))}};f.prototype.onVideoEnd=
function(b,c){var d=this.modules[b].getKernel();if(!d.PositionMode){this.modules[b].endEventFired=!0;this.baseurl=V15.config.getVideoPortalUris()[0];var e=this.baseurl+"Replay/GetNextIdAtEnd?id="+encodeURIComponent(c)+"&fen="+encodeURIComponent(d.game.getCurPos().toFEN());$.get(e,function(c){if(c){var e=c.ID,f=c.MSG;2<f.length?this.fnHint(f,b):"3"==c.STATE?(this.fnHint("please try again",b),d&&d.Vk.restoreMoveEnterPosition()):2<e.length&&(this.video[b].videoManager.restart(),this.loadNewVideo(b,e))}}.bind(this)).fail(function(){pluginDiv&&
this.resizePlugin($(pluginDiv),n)}.bind(this))}};f.prototype.loadNewVideo=function(b,c){for(var d=0;d<this.modules[b].videoDatabase.Items.length;d++)this.modules[b].videoDatabase.Items[d].Id===c&&this.setCaptionText(this.modules[b].videoDatabase.Items[d].Name,b);this.loadVideo(c,b,this.loadVideoGame.bind(this))};f.prototype.loadNewOfflineVideo=function(b,c){CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setMediaTouchBar(V15,"Video");var d=this.modules[b].cmsiManager.getFile(c);
if(d)this.loadOfflineVideo(this.modules[b].baseDir+d,b,this.loadOfflineVideoGame.bind(this));else{for(d=0;d<this.modules[b].offlinevideoDatabase.results.length;d++)this.modules[b].offlinevideoDatabase.results[d].Id.indexOf===c&&this.setCaptionText(this.modules[b].offlinevideoDatabase.results[d].Name,b);this.loadOfflineVideo(c,b,this.loadOfflineVideoGame.bind(this))}};f.prototype.loadFromLiveVideos=function(b,c,d,e){if(0<b.results.length&&!b.results[c].Private){var f=b.results[c].StreamId;this.setCaptionText(b.results[c].ID,
d);this.loadLiveVideo(f,d,e);e=this.modules[d].ticket;if(f=this.modules[d].getKernel())f.idGame&&V15.lobby&&V15.lobby.sendFinishKibitzing(f.idGame,e),f.idGame=b.results[c].GameId;this.chat[d]&&this.chat[d].clear();V15.lobby&&V15.lobby.sendStartKibitzing(f.idGame,e);(new CB.Timer(function(){V15.lobby&&V15.lobby.requestChatLog(d,b.results[c].GameId)}.bind(this))).runOnce(500)}};f.prototype.loadFromOfflineVideos=function(b,c,d,e){if(0<b.results.length){var f=b.results[c].url;this.setCaptionText(b.results[c].Name,
d);this.loadOfflineVideo(f,d,e);if(d=this.modules[d].getKernel())d.idGame=b.results[c].url}};f.prototype.loadFromVideos=function(b,c,d,e){var f=b.Items[c].Id;this.modules[d].getKernel().Vk.videoid=f;this.setCaptionText(b.Items[c].Name,d);this.loadVideo(f,d,e)};f.prototype.loadLiveVideo=function(b,c,d){(this.modules[c].getKernel().Vk.videoid=b)&&this.livevideo[c]&&(this.livevideo[c].videoManager.setUrl(b),d("",c))};f.prototype.onGaAvailable=function(b){this.gameactions=[];if(b)for(var c=this.readerHelper.getHardwareGuid(),
d=0;d<b.length;d++){var e=b[d],f=new CB.ScriptCommand;f.time=this.readerHelper.descrambleTime(e.Time);f.type=e.GameActionType;f.action=this.readerHelper.descrambleAction(e.C,f.time,c);0<f.action.length&&this.gameactions.push(f)}else this.modules[0].offlineVideo.videoManager.disable(),this.readerHelper.showActivateDialog()};f.prototype.loadOfflineVideo=function(b,c,d){(this.modules[c].getKernel().Vk.videoid=b)&&this.offlinevideo[c]&&(this.offlinevideo[c].videoManager.setUrl(b),0<$("#eastNest"+c).length&&
$("#eastNest"+c).jqxSplitter("refresh"),this.setVideoSize(c),b=b.replace(".mp4",".txt"),this.checkGAs(b))};f.prototype.loadVideo=function(b,c,d){this.modules[c].lastSnippedViewed=0;(this.modules[c].getKernel().Vk.videoid=b)&&this.video[c]&&this.video[c].videoManager.loadVideoFromId(b);this.setLike(c);var e="";V15.isLoggedIn()&&V15.Vf.userName&&(e=V15.Vf.userName);e&&(e=encodeURIComponent(e));this.baseurl=V15.config.getVideoPortalUris()[0];$.get(this.baseurl+"Replay/GetGameActions?id="+b+"&user="+
e,function(b){b&&d(b,c)}.bind(this)).fail(function(){this.resizePlugin($(pluginDiv),c)}.bind(this))};f.prototype.getResIcon=function(b){switch(b){case 2:return"win";case 1:return"draw";case 0:return"loss"}};f.prototype.getEvalIcon=function(b){switch(b){case CB.AnnoEvalType.EQUAL:return"equal";case CB.AnnoEvalType.BLACK_SLIGHTLY_BETTER:return"blackslightly";case CB.AnnoEvalType.BLACK_BETTER:return"blackbetter";case CB.AnnoEvalType.BLACK_WINS:return"blackwins";case CB.AnnoEvalType.WHITE_WINS:return"whitewins";
case CB.AnnoEvalType.WHITE_BETTER:return"whitebetter";case CB.AnnoEvalType.WHITE_SLIGHTLY_BETTER:return"whiteslightly"}};f.prototype.isLive=function(b){return this.modules[b]&&this.modules[b].mode==CB.ReaderMode.LIVE};f.prototype.isDiagram=function(b){return this.modules[b].mode==CB.ReaderMode.DIAGRAM};f.prototype.isTable=function(b){return this.modules[b].mode==CB.ReaderMode.TABLE};f.prototype.isPairing=function(b){return this.modules[b].mode==CB.ReaderMode.PAIRING};f.prototype.isAnyVideo=function(b){return this.isVideo(b)||
this.isLiveVideo(b)||this.isOfflineVideo(b)||this.isRecorder(b)};f.prototype.isVideo=function(b){return this.modules[b]&&this.modules[b].mode==CB.ReaderMode.VIDEO};f.prototype.isLiveVideo=function(b){return this.modules[b]&&this.modules[b].mode==CB.ReaderMode.LIVEVIDEO};f.prototype.isOfflineVideo=function(b){return this.modules[b]&&this.modules[b].mode==CB.ReaderMode.OFFLINEVIDEO};f.prototype.isRecorder=function(b){return this.modules[b]&&this.modules[b].mode==CB.ReaderMode.RECORDER};f.prototype.hasChat=
function(b){return this.isVerti||CB.System.isMobile()&&!CB.System.isAtLeastTablet()||700>window.innerHeight||1340>window.innerWidth||CB.System.runsInIFrame()?!1:this.modules[b].mode==CB.ReaderMode.LIVE||this.modules[b].mode==CB.ReaderMode.LIVEVIDEO};f.prototype.hasBook=function(b){return 0<=b&&this.isAnyVideo(b)||!this.modules[b]||0<=b&&this.modules[b].noBook||CB.System.runsInIFrame()||!CB.System.runsOnChessBaseDomain()?!1:!CB.System.isMobile()||800<window.innerHeight&&1500<window.innerWidth};f.prototype.hasCaptionBar=
function(b){return this.isOfflineVideo(b)?!1:(this.runsOnChessBaseNews()||CB.System.runsOnVideosChessBaseCom())&&1E3<window.innerWidth&&700<window.innerHeight};f.prototype.getCaptionHeight=function(b){return $("#cbcaption"+b).height()};f.prototype.getBottomHeight=function(b){return 0};f.prototype.setCaptionText=function(b,c){$("#cbcaption"+c).text(b)};f.prototype.setSingleGameCaption=function(b,c){this.setCaptionText(b.hdr.getStrPlayers(!1,99),c)};f.prototype.usesOnlineDB=function(){return this.hasBook(this.nActivePlugin)};
f.prototype.getGridFields=function(b,c){var d=function(b,c){var d=0,e=0,f=0,g=0,h=/([0-9]*)\.?([0-9]*)/i;if("number"===typeof b)d=b;else{var l=b.match(h);l[1]&&(d=parseInt(l[1]));l[2]&&(f=parseInt(l[2]))}"number"===typeof c?e=c:(h=c.match(h),h[1]&&(e=parseInt(h[1])),h[2]&&(g=parseInt(h[2])));return 100*e+g-100*d-f},e=[];420>b?e=[{name:"White",type:"text",width:Math.floor(.25*b)},{name:"EloW",type:"text",width:Math.floor(.11*b)},{name:"Black",type:"text",width:Math.floor(.25*b)},{name:"EloB",type:"text",
width:Math.floor(.11*b)},{name:"Res",type:"text",width:Math.floor(.1*b)}]:580>b?(e=[{name:"White",type:"text",width:Math.floor(.23*b)},{name:"EloW",type:"number",width:Math.floor(.09*b)},{name:"Black",type:"text",width:Math.floor(.23*b)},{name:"EloB",type:"number",width:Math.floor(.09*b)},{name:"Res",type:"text",width:Math.floor(.1*b)}],c||e.push({name:"ECO",type:"text",width:Math.floor(.05*b)})):(e=[{name:"White",type:"text",width:Math.floor(.1*b)},{name:"EloW",type:"number",width:Math.floor(.05*
b)},{name:"Black",type:"text",width:Math.floor(.1*b)},{name:"EloB",type:"number",width:Math.floor(.05*b)},{name:"Res",type:"text",width:Math.floor(.04*b)}],c||(e.push({name:"Year",type:"number",width:Math.floor(.05*b)}),e.push({name:"ECO",type:"text",width:Math.floor(.045*b)})),e.push({name:"Event",type:"text",width:Math.floor(.16*b)}));360<b&&((420<b||!c&&400<b)&&e.push({name:"Rnd",type:"number",width:Math.floor(.04*b),sorter:d}),600<b&&e.push({name:"Len",type:"number",width:Math.floor(.03*b)}),
c&&(e=[{name:"Stat",type:"staticon",width:Math.min(30,Math.floor(.05*b))}].concat(e)));e.forEach(function(b){"White"==b.name||"Black"==b.name?b.css="jsg-player":"EloW"==b.name||"EloB"==b.name?(b.css="jsg-elo",b.align="center"):"ECO"==b.name?(b.css="jsg-eco",b.align="center"):"Res"==b.name&&(b.css="jsg-result",b.align="center",c&&(b.type="resicon",b.css="jsg-icon"));"Event"==b.name&&(b.css="jsg-event")});return e};f.prototype.getVideoGridFields=function(b,c){var d=[],d=[{name:"Duration",type:"text",
width:Math.floor(.2*b)},{name:"Name",type:"text",width:Math.floor(.6*b)}];d.forEach(function(b){"Name"==b.name?b.css="jsg-name":"Duration"==b.name?b.css="jsg-duration":"Created"==b.name&&(b.css="jsg-created")});return d};f.prototype.getLiveVideoGridFields=function(b,c){var d=[],d=[{name:"Name",type:"text",width:Math.floor(.6*b)},{name:"Connections",type:"number",width:Math.floor(.2*b)}];d.forEach(function(b){"Name"==b.name&&(b.css="jsg-name");"Connections"==b.name&&(b.css="jsg-name")});return d};
f.prototype.getOfflineVideoGridFields=function(b,c){var d=[],d=[{name:"Name",type:"text",width:Math.floor(.6*b)}];d.forEach(function(b){"Name"==b.name&&(b.css="jsg-name")});return d};f.prototype.resizePlugin=function(b,c){this.inDestroy||(this.isDiagram(c)?this.resizeDiagram(b,c):this.isTable(c)?this.resizeTable(b,c):this.isPairing(c)?this.resizePairings(b,c):this.isTabbedLayout()?this.resizePluginTabbed(b,c):this.resizePluginHori(b,c),this.isLive(c)&&this.refreshGridIcons(c))};f.prototype.resizePluginHori=
function(b,c){CB.LOG("ResPlugInH: "+c+" - "+window.innerWidth+"/"+window.innerHeight,"","resize");if(b&&this.modules&&this.modules[c]){var d=this.getCaptionHeight(c);d?(d+=this.getBottomHeight(c),$("#rootParent"+c).height("calc( 100% - "+d+"px )")):$("#rootParent"+c).height("100%");var d=this.getGameCount(c),e=1<d;if(this.isLiveVideo(c)||this.isRecorder(c))e=!0;$(b).find(".cbmove").filter(":last");900<$(b).scrollTop()&&this.isOnChessBaseCom()&&this.maximized!=c&&$(b).css("width","112%");this.showHidePrevNext(c,
e);CB.System.isAtLeastTablet()?$("#b-btnSave-"+c).show():$("#b-btnSave-"+c).hide();var f=this.getButtonConfig().getLineHBoard(),g=b.width(),h=b.height(),l=this.getEngineH(c,$("#westSouth"+c).height(),e),q=e?.72*h-f-l:h-f-l;400>q&&(q=400);q>.5*g&&(q=.5*g,e||(l=h-f-q));q=g-(g-q);$("#east"+c)[0].style.height="100%";$("#west"+c)[0].style.height="100%";this.resizeNotaHori(c);this.chat[c]&&this.chat[c].resize();this.book[c]&&this.book[c].resize();$("#boardHolder"+c)[0].style.width="100%";$("#boardHolder"+
c)[0].style.height="calc( 100% - "+f+"px )";$("#belowBoard"+c)[0].style.width="100%";$("#belowBoard"+c)[0].style.height=f+2+"px";$("#buttons"+c)[0].style.width="100%";$("#buttons"+c)[0].style.height="100%";var f=$("#boardHolder"+c).width(),r=$("#boardHolder"+c).height();this.modules[c].boardArea&&!this.modules[c].boardArea.canvas&&(this.isLive(c)?this.createMultiBoard(c):(this.modules[c].boardArea.createCanvas(this.modules[c].getKernel(),{topDist:0,bottomDist:0,marginDistDivisor:40,shiftXPercent:-1.7,
minWForCoordinates:240,boardShadow:!0}),this.modules[c].getKernel().boardWin.onReadyHandlers.add(this.modules[c].onBoardReady.bind(this.modules[c]))));this.adaptMaxKernels(c,f,r);this.launchResizeBoard(c,f,r,700);this.resizeEngineAndListHori(c,e,l,d,q);this.checkShowFullBtn(g,h,c);this.setButtonImages("b",this.boardBtns[c],this.getButtonConfig().getBtnHBoard(),this.getButtonConfig().getCssBoard(),c,"Reader");this.setButtonImages("n",this.notaBtns,this.getButtonConfig().btnHNota,this.getButtonConfig().getCssNota(),
c,"Reader");this.setNotaSize(c);this.setVideoSize(c);$("#eastUpDownNest"+c).jqxSplitter("refresh")}};f.prototype.getBoardTopOffset=function(){return 900>window.innerHeight?0:10};f.prototype.setNotaSize=function(b){var c=CB.$("#notaparent"+b).single();if(c){var d=c.offsetWidth,c=c.offsetHeight;this.modules[b]&&this.modules[b].nota&&this.modules[b].nota.setSize(d,c)}};f.prototype.setVideoSize=function(b){if(this.isLiveVideo(b)){if(this.livevideo){var c=CB.$("#videoparent"+b).single(),d=c.offsetWidth,
c=c.offsetHeight;this.livevideo[b].resize(d,c)}}else if(this.isOfflineVideo(b)){if(TRACE(1),this.offlinevideo&&(TRACE(2),c=CB.$("#videoparent"+b).single()))TRACE(3),d=c.offsetWidth,c=c.offsetHeight,this.offlinevideo[b].resize(d,c)}else this.isVideo(b)?this.video&&(c=CB.$("#videoparent"+b).single())&&(d=c.offsetWidth,c=c.offsetHeight,this.video[b].resize(d,c)):this.isRecorder(b)&&this.recorder&&(c=CB.$("#videoparent"+b).single())&&(d=c.offsetWidth,c=c.offsetHeight,this.recorder[b].resize(d,c))};f.prototype.resizePluginTabbed=
function(b,c){CB.LOG("ResPlugInT: "+c+" winW="+window.innerWidth+", winH="+window.innerHeight,"","resize");if(b&&this.modules&&this.modules[c]){$(b).css("width","100vw");CB.System.runsOnVideosChessBaseCom()?$(b).css("height","80vh"):CB.System.runsOnLiveChessBaseCom()?CB.System.isFullScreen()?$(b).css("height","100vh"):$(b).css("height","92vh"):$(b).css("height","100vh");$(b).css("min-width","300px");$(b).css("min-height","300px");$(b).find(".cbmove").filter(":last");this.isOnChessBaseCom()&&$(b).css("height",
.8*window.innerHeight+"px");var d=this.getGameCount(c),e=1<d;if(this.isLiveVideo(c)||this.isOfflineVideo(c)||this.isRecorder(c))e=!0;e||this.showHideGamesTab(c,e);this.showHidePrevNext(c,e);var f=this.getButtonConfig().getLineHBoard();if(this.isVideo(c)||this.isLiveVideo(c)||this.isOfflineVideo(c))f=0;this.getButtonConfig();var g=b.width(),h=b.height(),l=0;this.ribbonButtonsVisible(c)&&(l=$("#tabNavButtons"+c).height());$("#tabNavButtons"+c).width();var q=$("#north"+c).height(),r=q-f-1;$("#boardHolder"+
c)[0].style.width="100%";$("#boardHolder"+c)[0].style.height=r+"px";$("#belowBoard"+c)[0].style.width="100%";$("#belowBoard"+c)[0].style.height=f+"px";$("#buttons"+c)[0].style.width="100%";$("#buttons"+c)[0].style.height="100%";this.modules[c].boardArea.canvas||this.modules[c].boardArea.createCanvas(this.modules[c].getKernel(),{topDist:2.3*V15.config.board2DBottomOffset,bottomDist:V15.config.board2DBottomOffset,marginDistDivisor:26.5,shiftXPercent:-1.7,minWForCoordinates:240,boardShadow:!0,addTitle:!0,
noClock:!this.isLive(c)});f=$("#boardHolder"+c).width();r=$("#boardHolder"+c).height();this.launchResizeBoard(c,f,r,800);this.isListTabVisible(c)?(l=h-l,this.isAnyVideo(c)?this.resizeVideoAndListTabbed(c,e,0,d,g-6,l-q-12):this.resizeEngineAndListTabbed(c,e,0,d,g-6,l-q-12)):(this.listResized[c]=!1,$("#listParent"+c).hide());this.checkShowFullBtn(g,h,c);this.setButtonImages("b",this.boardBtns[c],this.getButtonConfig().getBtnHBoard(),this.getButtonConfig().getCssBoard(),c,"Reader");this.setButtonImages("n",
this.notaBtns,this.getButtonConfig().btnHNota,this.getButtonConfig().getCssNota(),c,"Reader");$("#buttons"+c)[0].style.width="100%";$("#buttons"+c)[0].style.height=32;this.isNotaTabVisible(c)?this.resizeNotaTabbed(b,c,h-q-12):this.notaResized[c]=!1;this.isVideoTabVisible(c)&&this.resizeVideoTabbed(b,c)}};f.prototype.ribbonButtonsVisible=function(b){return 1<this.getGameCount(b)||this.isLiveVideo(b)||this.isOfflineVideo(b)||this.isRecorder(b)};f.prototype.showRibbonButtons=function(b,c){c?$("#tabNavButtons"+
b)[0].style.height="32px":$("#tabNavButtons"+b)[0].style.height="0px"};f.prototype.resizePluginVerti=function(b,c){CB.LOG("ResPlugInV: "+c+" - "+window.innerWidth+"/"+window.innerHeight,"","resize");if(b&&this.modules&&this.modules[c]){var d=this.getGameCount(c),e=1<d;this.isLiveVideo(c)&&(e=!0);$(b).find(".cbmove").filter(":last");900<$(b).scrollTop()&&this.isOnChessBaseCom()&&this.maximized!=c&&$(b).css("width","112%");$(b).css("height","240vw");$("#b-btnSave-"+c).hide();this.showHidePrevNext(c,
e);e||$("#southNest"+c).jqxSplitter({showSplitBar:!1,panels:[{size:"100%"},{size:"0%"}]});var f=this.getButtonConfig().getLineHBoard();this.getButtonConfig();var g=b.width(),h=b.height();500>g&&($(b).css("width","100vw"),g=b.width(),$(b).css("min-width","100px"),$(b).css("max-width","1000px"));$("#south"+c)[0].style.width="100%";$("#north"+c)[0].style.width="100%";$("#southNorth"+c).height();$("#notaEl"+c).css("font-size",this.isMaximized()&&1E3<window.innerWidth?"1.1em":"0.8em");$("#boardHolder"+
c)[0].style.width="100%";$("#boardHolder"+c)[0].style.height="calc( 100% - "+f+"px )";$("#belowBoard"+c)[0].style.width="100%";$("#belowBoard"+c)[0].style.height=f+2+"px";$("#buttons"+c)[0].style.width="100%";$("#buttons"+c)[0].style.height="100%";this.modules[c].boardArea.canvas||this.modules[c].boardArea.createCanvas(this.modules[c].getKernel(),{topDist:V15.config.board2DBottomOffset,bottomDist:V15.config.board2DBottomOffset,marginDistDivisor:26.5,shiftXPercent:-1.7,minWForCoordinates:240,boardShadow:!0});
var f=$("#boardHolder"+c).width(),l=$("#boardHolder"+c).height();this.launchResizeBoard(c,f,l,1E3);this.resizeEngineAndListVerti(c,e,0,d,b.width());this.checkShowFullBtn(g,h,c);this.setButtonImages("b",this.boardBtns[c],this.getButtonConfig().getBtnHBoard(),this.getButtonConfig().getCssBoard(),c,"Reader");this.setButtonImages("n",this.notaBtns,this.getButtonConfig().btnHNota,this.getButtonConfig().getCssNota(),c,"Reader");this.setNotaSize(c);this.setVideoSize(c)}};f.prototype.showHidePrevNext=function(b,
c){var d=!1,e=$("#buttons"+b).width();(this.isLive(b)||c)&&(600<e||this.isTabbedLayout())?($("#b-btnLoadNext-"+b).show(),$("#b-btnLoadPrev-"+b).show(),$("#n-btnLoadNext-"+b).show(),$("#n-btnLoadPrev-"+b).show(),d=!0):($("#b-btnLoadNext-"+b).hide(),$("#b-btnLoadPrev-"+b).hide(),$("#n-btnLoadNext-"+b).hide(),$("#n-btnLoadPrev-"+b).hide());550<e||this.isTabbedLayout()?$("#b-btnGoBegin-"+b).show():$("#b-btnGoBegin-"+b).hide();550<e||this.isTabbedLayout()&&!d?$("#b-btnGoEnd-"+b).show():$("#b-btnGoEnd-"+
b).hide()};f.prototype.showHideGamesTab=function(b,c){c||$("#t-btnSelList-"+b).hide()};f.prototype.resizeBoard=function(b,c,d){this.boardTimer[b]&&this.boardTimer[b].stop();this.modules[b].boardArea.setSize(c,d);this.modules[b].multiBoard&&(this.adaptMaxKernels(b,c,d),this.modules[b].multiBoard.resize(c,d))};f.prototype.adaptMaxKernels=function(b,c,d){if(this.modules[b].multiBoard&&!(100>d)){var e=1;c/=d;160<d&&1.25<c&&(e=1.9<c||800<d?2.3<c?3.3<c||600<d?9:7:2.3<c&&450<d||800<d?7:5:480<d&&(1.8<c||
900<d)?5:3);d=this.modules[b].changeNKernels(e,this);if(e>d){c=0;for(var f=d;c<e-d&&f<this.modules[b].list.length;f++){var g=this.modules[b].list[f].id;this.hasKernelOfId(b,g)||(A(g,b),c++)}}}};f.prototype.hasKernelOfId=function(b,c){for(var d=0;d<this.modules[b].kernel.length;d++)if(this.modules[b].kernel[d].idGame==c)return!0;return!1};f.prototype.createMultiBoard=function(b){var c=this.modules[b].boardArea.createCanvas({createControl:function(b,c,d){var e=this.getMultiBoardOptions();e.suppressCalcGeometry=
!0;b=new CB.MultiBoard(b,c,d,e);b.onClickBoard=this.onClickBoard.bind(this);b.onDblClick=this.onDblClickBoard.bind(this);return b}.bind(this),onControlReady:function(){V15.chessAudio||(V15.chessAudio=new CB.ChessAudio(V15.config.getExternalCommonPath()+"Media/Sounds/"),(new CB.Timer(function(){V15.chessAudio.loadAll()})).runOnce(5E3))}},this.getMultiBoardOptions()),d=this.createBoardWin(c,this.getMultiBoardOptions());this.modules[b].getKernel().setBoardWin(d);this.modules[b].getKernel().Vk.createGUIElements(d);
this.modules[b].boardArea.setVisible(!0);c=c.control;this.modules[b].multiBoard=c;c.addBoard(d,null)};f.prototype.createBoardWin=function(b,c){var d=new CB.BoardControl(b,100,100,"FirstB",c);d.animSteps={forMove:2,forPosition:2};CB.System.isMobile()&&(d.animSteps={forMove:.6,forPosition:.5});d.singleClickDisabled=!0;d.allowInput=!0;return d};f.prototype.onClickBoard=function(b,c){1==this.pluginCnt&&(this.nActivePlugin=0);0<=this.nActivePlugin&&this.stopAutoplay(this.nActivePlugin);this.changeSelectedGameKernel(b)};
f.prototype.onDblClickBoard=function(b,c){1==this.pluginCnt&&(this.nActivePlugin=0);0<=this.nActivePlugin&&this.trySwapWithBigBoard(b,this.nActivePlugin,!0);c.preventDefault()};f.prototype.changeSelectedGameKernel=function(b){if(0>this.nActivePlugin)if(1===this.pluginCnt)this.nActivePlugin=0;else return;var c=this.modules[this.nActivePlugin];try{c.getKernel().releaseCommandHandlers();c.selectKernelByIdGame(b);var d=c.getKernel();d.linkCommandHandlers();var e=d.game,f=this.modules[this.nActivePlugin].nota;
e&&f&&(d.Vk.saveToCloud(),f.setGame(e),d.forceTBUpdate=!0,d.boardWin&&(d.nextCurPosNoAnim=!1),e.fireOnCurPosChanged(),e.fireOnNavigate());c.multiBoard&&c.multiBoard.markBoardByGameId&&c.multiBoard.markBoardByGameId(b);this.setGameStat(this.nActivePlugin,b,"watch");d.boardWin&&(d.boardWin.markLastMove(!1,!0),V15.aTBLobby.isConnected()&&(V15.aTBLobby.requestWithTicket(b,d.getCurPos(),this.tbTableHandler.bind(this)),d.boardWin.setEvaluationInvalid()))}catch(g){CB.LogException("RWM:chngSelectedKernel",
g)}};f.prototype.checkShowFullBtn=function(b,c,d){b>.9*window.innerWidth&&c>.9*window.innerHeight&&this.maximized!=d?$("#b-btnFullScreen-"+d).hide():$("#b-btnFullScreen-"+d).show()};f.prototype.resizeNotaHori=function(b){CB.LOG("ResizeNota_"+b,"","resize ");if($("#eastNest"+b)&&$("#eastNest"+b)[0]){var c=this.getButtonConfig().lineHNota;$("#eastNest"+b)[0].style.height="100%";$("#eastLayer"+b)[0].style.height="100%";$("#eastUpDownNest"+b)[0].style.height="100%";$("#eastUpDownNest"+b)[0].style.width=
"100%";this.hasChat(b)||($("#eastNest"+b)[0].style.width="100%");this.hasBook(b)||this.isAnyVideo(b)||($("#notaNest"+b)[0].style.height="100%");var d=$("#notaNest"+b).height()-c;$("#notaparent"+b)[0].style.height=d+"px";this.isAnyVideo(b);$("#notaEl"+b).css("font-size",this.isMaximized()&&1E3<window.innerWidth?"1.3em":"0.9em");$("#belowNota"+b)[0].style.width="calc( 100% + 1px )";$("#belowNota"+b)[0].style.height=c+"px";$("#belowNota"+b)[0].style.top=d+"px"}};f.prototype.getEngineH=function(b,c,d){c=
Math.max(Math.min(c,50),d?Math.min(.35*c,90):Math.min(.35*c,110));!this.modules[b].engineOpen&&d&&(c=0);return c};f.prototype.getGameCount=function(b){if(this.modules&&this.modules[b]){if(this.modules[b].livevideoDatabase)return this.modules[b].livevideoDatabase.results.length;if(this.modules[b].offlinevideoDatabase)return this.modules[b].offlinevideoDatabase.results.length;if(this.modules[b].videoDatabase&&this.modules[b].videoDatabase.Items)return this.modules[b].videoDatabase.Items.length;if(this.modules[b].pgnDatabase)return this.modules[b].pgnDatabase.getGameCount();
if(this.modules[b].requestData&&this.modules[b].requestData.isList())return Math.max(2,this.modules[b].list.length)}return 0};f.prototype.resizeEngineAndListHori=function(b,c,d,e,f){c?$("#engineParent"+b)[0].style.height=d+"px":$("#engineParent"+b)[0].style.height="100%";$("#engineParent"+b)[0].style.width="100%";this.modules[b].engineOpen||!c?($("#engineParent"+b).show(),!c&&$("#replayinfo"+b)[0]&&($("#replayinfo"+b)[0].style.height="100%")):($("#engineParent"+b).hide(),d=0);$("#listParent"+b)[0].style.width=
"100%";$("#listParent"+b)[0].style.height="calc( 100% - "+d+"px )";c&&this.gridCreated&&($("#listParent"+b).jsGrid("option","height","calc( 100% - "+d+"px )"),$("#listParent"+b).jsGrid("option","width","100%"),$("#listParent"+b).jsGrid("option","heading",!0),this.isOfflineVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getOfflineVideoGridFields(this.getGridWidth(b),this.isLive(b))):this.isLiveVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getLiveVideoGridFields(this.getGridWidth(b),
this.isLive(b))):this.isVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getVideoGridFields(this.getGridWidth(b),this.isLive(b))):$("#listParent"+b).jsGrid("option","fields",this.getGridFields(this.getGridWidth(b),this.isLive(b))))};f.prototype.resizeEngineAndListTabbed=function(b,c,d,e,f,g){$("#engineParent"+b).hide();$("#listParent"+b)[0].style.height=g+"px";$("#listParent"+b)[0].style.width=f+"px";c&&this.gridCreated&&($("#listParent"+b).jsGrid("option","height",g+"px"),$("#listParent"+
b).jsGrid("option","width",f+"px"),$("#listParent"+b).jsGrid("option","heading",!0),this.isOfflineVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getOfflineVideoGridFields(f,this.isLive(b))):this.isLiveVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getLiveVideoGridFields(f,this.isLive(b))):this.isVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getVideoGridFields(f,this.isLive(b))):$("#listParent"+b).jsGrid("option","fields",this.getGridFields(f,this.isLive(b))))};f.prototype.resizeVideoAndListTabbed=
function(b,c,d,e,f,g){$("#engineParent"+b).hide();$("#videoParent"+b)[0].style.height=g-34+"px";$("#videoParent"+b)[0].style.width=f+"px";this.setVideoSize(b);$("#listParent"+b)[0].style.height=g+"px";$("#listParent"+b)[0].style.width=f+"px";c&&this.gridCreated&&($("#listParent"+b).jsGrid("option","height",g+"px"),$("#listParent"+b).jsGrid("option","width",f+"px"),$("#listParent"+b).jsGrid("option","heading",!0),this.isOfflineVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getOfflineVideoGridFields(f,
this.isLive(b))):this.isLiveVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getLiveVideoGridFields(f,this.isLive(b))):this.isVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getVideoGridFields(f,this.isLive(b))):$("#listParent"+b).jsGrid("option","fields",this.getGridFields(f,this.isLive(b))))};f.prototype.resizeEngineAndListVerti=function(b,c,d,e,f){$("#engineParent"+b).hide();$("#listParent"+b)[0].style.width="100%";$("#listParent"+b)[0].style.height="100%";c&&this.gridCreated&&
($("#listParent"+b).jsGrid("option","height","100%"),$("#listParent"+b).jsGrid("option","width","100%"),$("#listParent"+b).jsGrid("option","heading",!0),$("#listParent"+b).jsGrid("option","fields",this.getGridFields(f,this.isLive(b))))};f.prototype.resizeNotaTabbed=function(b,c){var d=0,e;this.ribbonButtonsVisible(c)&&(d=$("#tabNavButtons"+c).height());e=$("#tabNavButtons"+c).width();var f=$("#north"+c).height(),g=$(b).height()-f,f=this.getButtonConfig().lineHNota;this.isAnyVideo(c)&&($("#videoparent"+
c).css("height",g-d),$("#videoparent"+c).css("width",e+1));$("#notaEl"+c).css("height",g-f);$("#notaEl"+c).css("font-size",this.isMaximized()&&1E3<window.innerWidth?"1.1em":"0.9em");g=$("#south"+c).height()-d;$("#notaEl"+c).css("height",g);this.modules[c].nota.setSize(e,g);this.modules[c].nota.scrollCurElemIntoView()};f.prototype.resizeVideoTabbed=function(b,c){var d;this.ribbonButtonsVisible(c)&&$("#tabNavButtons"+c).height();d=$("#tabNavButtons"+c).width();$("#north"+c).height();var e=$("#south"+
c).height();$(b).height();this.isAnyVideo(c)&&($("#videoParent"+c)[0].style.height=e-34+"px",$("#videoparent"+c).css("height",e-34),$("#videoparent"+c).css("width",d+1),this.setVideoSize(c))};f.prototype.getGridWidth=function(b){return $("#listParent"+b).width()};f.prototype.getBoardWidth=function(b){return $("#boardHolder"+b).width()};f.prototype.onSplitterResize=function(b){CB.LOG("onSplitRes","","resize");if(this.isTabbedLayout())this.onSplitterResizeVerti(b);else this.onSplitterResizeHori(b)};
f.prototype.onSplitterResizeHori=function(b){var c=$("#boardHolder"+b).width(),d=$("#boardHolder"+b).height();$("#belowBoard"+b).height();CB.LOG("SplitResizeHori"+c+"/"+d,"","resize");if(this.checkBoardAreaChange(c,d,b)){this.modules[b].boardArea&&this.resizeBoard(b,c,d);d=1<this.getGameCount(b);this.isLiveVideo(b)&&(d=!0);var e=$("#engineParent"+b).height();$("#listParent"+b)&&($("#listParent"+b)[0].style.height="calc( 100% - "+e+"px )");this.showHidePrevNext(b,d);d&&this.gridCreated&&($("#listParent"+
b).jsGrid("option","height","calc( 100% - "+e+"px )"),this.isOfflineVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getOfflineVideoGridFields(c,this.isLive(b))):this.isLiveVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getLiveVideoGridFields(c,this.isLive(b))):this.isVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getVideoGridFields(c,this.isLive(b))):$("#listParent"+b).jsGrid("option","fields",this.getGridFields(c,this.isLive(b))));this.setNotaSize(b);this.setVideoSize(b);
this.chat[b]&&this.chat[b].resize();this.isLive(b)&&this.refreshGridIcons(b);this.book[b]&&this.book[b].resize();this.saveSplitSize("root",b);this.saveSplitSize("westNest",b)}};f.prototype.onRootSplitterCollapse=function(b){this.saveSplitColl("root",b)};f.prototype.onListSplitterCollapse=function(b){this.saveSplitColl("westNest",b)};f.prototype.onChatSplitterCollapse=function(b){this.saveSplitColl("eastNest",b)};f.prototype.onBookSplitterCollapse=function(b){this.saveSplitColl("eastUpDownNest",b)};
f.prototype.loadSplitPos=function(b,c){if(this.isVideo(c)||this.isLiveVideo(c)||this.isOfflineVideo(c))return null;var d=this.isLive(c)?"live":"",e=V15.Vf.load(b+"size"+d);V15.Vf.load(b+"coll"+d);return{size:parseFloat(e),coll:!1}};f.prototype.saveSplitSize=function(b,c){try{var d=$("#"+b+c);if(d&&d.length){var e=this.isLive(c)?"live":"",f=$(d).jqxSplitter("panels");f&&f[0]&&V15.Vf.save(b+"size"+e,f[0].size)}}catch(g){CB.LogException("RWM:saveSplitSize",g)}};f.prototype.saveSplitColl=function(b,c){};
f.prototype.onSplitterResizeVerti=function(b){var c=0;this.ribbonButtonsVisible(b)&&(c=$("#tabNavButtons"+b).height());$("#tabNavButtons"+b).width();var d=this.getButtonConfig().getLineHBoard(),e=$("#north"+b).height()-d-1;$("#boardHolder"+b)[0].style.width="100%";$("#boardHolder"+b)[0].style.height=e+"px";$("#belowBoard"+b)[0].style.width="100%";$("#belowBoard"+b)[0].style.height=d+"px";$("#buttons"+b)[0].style.width="100%";$("#buttons"+b)[0].style.height="100%";c=$("#south"+b).height()-c;$("#notaEl"+
b).css("height",c);this.modules[b].nota&&this.setNotaSize(b);c=$("#boardHolder"+b).width();d=$("#boardHolder"+b).height();$("#belowBoard"+b).height();this.modules[b].boardArea&&this.resizeBoard(b,c,d);d=1<this.getGameCount(b);if(this.isLiveVideo(b)||this.isRecorder(b))d=!0;$("#engineParent"+b)&&$("#engineParent"+b).height();$("#listParent"+b)[0].style.height="100%;";d&&this.gridCreated&&(this.isOfflineVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getOfflineVideoGridFields(c,this.isLive(b))):
this.isLiveVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getLiveVideoGridFields(c,this.isLive(b))):this.isVideo(b)?$("#listParent"+b).jsGrid("option","fields",this.getVideoGridFields(c,this.isLive(b))):$("#listParent"+b).jsGrid("option","fields",this.getGridFields(c,this.isLive(b))));this.modules[b].getKernel().game.fireOnChanged();this.modules[b].getKernel().game.fireOnHeaderChanged({recalc:!0})};f.prototype.onSouthNestSplitterResizeVerti=function(b,c){var d=$(c).width(),e=this.getGameCount(b),
f=1<e;this.isLiveVideo(b)&&(f=!0);var g=$("#engineParent"+b).height();f&&this.gridCreated&&$("#listParent"+b).jsGrid("option","fields",this.getGridFields(d,this.isLive(b)));this.resizeEngineAndListHori(b,f,g,e,d);this.modules[b].getKernel().game.fireOnChanged();this.modules[b].getKernel().game.fireOnHeaderChanged({recalc:!0})};f.prototype.onEastSplitterResize=function(b){this.resizeNotaHori(b);this.chat[b]&&this.chat[b].resize();this.book[b]&&this.book[b].resize();this.video[b]&&this.video[b].resize();
this.setNotaSize(b);this.setVideoSize(b);this.saveSplitSize("eastNest",b)};f.prototype.onBookSplitterResize=function(b){this.resizeNotaHori(b);this.book[b]&&this.book[b].resize();this.saveSplitSize("eastUpDownNest",b)};f.prototype.onVideoSplitterResize=function(b){this.resizeNotaHori(b);this.setVideoSize(b);this.saveSplitSize("eastUpDownNest",b)};f.prototype.getButtonConfig=function(){function b(){return 100<window.innerHeight&&100<window.innerWidth}return CB.System.isMobile()?{getLineHBoard:function(){return b()?
60:44},getBtnHBoard:function(){return b()?48:32},getBtnHDiagram:function(c){return b()?32:24},lineHNota:42,btnHNota:32,getCssBoard:function(){return b()?"toolBtn toolBtn48":"toolBtn toolBtn32"}.bind(this),getCssDiagrams:function(c){return b()?"toolBtn toolBtn32":"toolBtn toolBtn24"}.bind(this),getCssNota:function(){return"toolBtn toolBtn32"}.bind(this),getCssEngine:function(){return"toolBtn toolBtnV16"}.bind(this),getCssTabNav:function(){return"tabNavBtn tabNavBtn32"}.bind(this)}:{getLineHBoard:function(){return 800<
window.innerHeight?44:34}.bind(this),getBtnHBoard:function(){return 800<window.innerHeight?32:24}.bind(this),getBtnHDiagram:function(b){return 250<b?24:16},lineHNota:34,btnHNota:24,getCssBoard:function(){return 800<window.innerHeight?"toolBtn toolBtn32":"toolBtn"}.bind(this),getCssDiagrams:function(b){return 250<b?"toolBtn toolBtn24":"toolBtn toolBtn16"}.bind(this),getCssNota:function(){return"toolBtn"}.bind(this),getCssTabNav:function(){return"tabNavBtn tabNavBtn16"}.bind(this),getCssEngine:function(){return"toolBtn toolBtnV16"}.bind(this)}};
f.prototype.resizeDiagram=function(b,c){if(b){var d=400,e=b[0].dataset.size;if(e)if(d=e.match(/\%/)){if(e.match(/%\/max=/)){var f=e.split("=");$(b).css("width",e.substr(0,d.index+1));$(b).css("max-width",f[1].substr(0,f[0].length)+"px")}else $(b).css("width",e);d=$(b).width()}else d=e;e=!!b[0].dataset.bigcoords;$("#aboveDiag"+c).width(d);$("#belowDiag"+c).width(d);d>.9*window.innerWidth&&(d=.9*window.innerWidth,$(b).width(d));var g=d,f=.8*g;CB.LOG("Resize Diag:"+d+"/"+d,"","resize");$("#diagarea"+
c).width(g);$("#diagarea"+c).height(f);this.modules[c].boardArea.canvas||(this.modules[c].boardArea.createCanvas(this.modules[c].getKernel(),{topDist:0,bottomDist:0,marginDistDivisor:0,shiftXPercent:-1.65,minWForCoordinates:200,transparent:!0,bigCoords:e,mixin:this.getDiagramMixin()}),this.modules[c].getKernel().boardWin.onReadyHandlers.add(this.modules[c].onBoardReady.bind(this.modules[c])));$("#diagarea"+c)[0]&&this.modules[c]&&this.modules[c].boardArea&&this.resizeBoard(c,g-1,f-1);this.setButtonImages("d",
this.diagramBtns[c],this.getButtonConfig().getBtnHDiagram(f),this.getButtonConfig().getCssDiagrams(f),c,"Reader");d=$("#diagButtons"+c);e=$("#diagText"+c);d&&d.height();e&&e.height()}};var r=function(b,c){b.css("font-size",c+"em")};f.prototype.getDiagramMixin=function(){return{addCheckMark:function(){this.addSideIcon({url:CB.getCommonPath()+"Media/Ribbons/Reader/Check48.png",cssClass:"cbBoardCheckMark",boardFract:12})}}};f.prototype.resizeTable=function(b,c){var d=this.modules[c].ranking;if(d){b=
$(b);b.html("");var e=b.width(),d=d.toHtml(e);b.append(d);$(b.children()[0]);750>e?r(b,1-(750-e)/1050):r(b,1)}};f.prototype.resizePairings=function(b,c){var d=this.modules[c].pairing;if(d){b=$(b);b.html("");var e=b.width(),f=d.RoundToHtml(d.round,e);b.append(f);750>e?r(b,1-(750-e)/1200):r(b,1+(e-750)/4200);d=$(f).find("td").has(".playerImageContainer");d.css("width","0px");d.hide();var f=$(f).width(),g=$(d[0]).width();d.css("width",(e-f+2*g)/2+"px");d.show()}};f.prototype.resizeActivePlugin=function(){this.resizePlugin($($(this.allPluginClasses)[this.nActivePlugin]),
this.nActivePlugin)};f.prototype.createBoardButtons=function(b,c){var d=[];this.isRecorder(c)?d=d.concat([{title:lm.START_RADIO,id:"LiveNew",handler:this.fnStart.bind(this)}]):this.isVideo(c)?CB.System.runsOnVideosChessBaseCom()||(d=d.concat([{title:lm.LIKE,id:"Like",handler:this.fnLike.bind(this)}])):d=d.concat([{title:lm.TAKE_BACK,id:"Retract",handler:this.fnRetract.bind(this)},{title:lm.MAKE_MOVE,id:"Exec",handler:this.fnExec.bind(this)},{title:"Autoplay (Ctrl, Shift and/or Alt-key when clicking changes time)",
id:"Autoplay",handler:this.fnAutoplay.bind(this)}]);400<window.innerWidth&&d.push({separator:!0});var e=$("#root0").width();!(this.isTabbedLayout()||880<e)||this.isVideo(c)||this.isLiveVideo(c)||this.isOfflineVideo(c)||(380<=window.innerWidth&&d.push({title:"Goto Begin",id:"GoBegin",handler:this.fnGotoStart.bind(this)}),380<window.innerWidth&&d.push({title:"Goto End",id:"GoEnd",handler:this.fnGotoEnd.bind(this)}),500<window.innerWidth&&d.push({separator:!0}),450<=window.innerWidth&&d.push({title:"Load Prev",
id:"LoadPrev",handler:this.loadPrevGame.bind(this)}),320<=window.innerWidth&&d.push({title:"Load Next",id:"LoadNext",handler:this.loadNextGame.bind(this)}),500<window.innerWidth&&d.push({separator:!0}));this.isTabbedLayout()||d.push({title:"Maximize",id:"FullScreen",handler:this.fnFullWindow.bind(this)});this.isTabbedLayout()||(CB.System.isMobile()||d.push({separator:!0}),d.push({title:lm.ANALYSIS_ENGINE,id:"Engine",handler:this.fnAnalysis.bind(this)}));500<e&&(d=d.concat([{}]),d.push({title:lm.FLIP_BOARD,
id:"Rotate",handler:this.fnFlipBoard.bind(this)}));d=d.concat([{}]);CB.System.isElectron()||CB.System.isCordova()||d.push({title:"Download PGN",id:"Save",handler:this.fnSaveDB.bind(this)});1300<window.innerWidth&&!this.isAnyVideo(c)&&(d=d.concat([{}]),d.push({title:"Sound On/Off",id:"SoundOn",handler:this.fnSound.bind(this),css:"btnSound"}));1E3<window.innerWidth&&(d=d.concat([{}]),d.push({title:"Pieces",id:"Pieces",handler:this.fnPieces.bind(this),css:"btnPieces"}));this.isTabbedLayout()&&(this.isVideo(c)||
this.isLiveVideo(c)||this.isOfflineVideo(c))&&(d=[]);this.boardBtns[c]=d;e=this.getButtonConfig().getCssBoard();try{this.instantiateButtons("button",b,"b",d,e,c)}catch(f){}this.soundBtnSelector[c]="#b-btnSoundOn-"+c};f.prototype.createTabNavButtons=function(b,c){var d=[],d=d.concat([{title:"Notation",id:"SelNota",txt:lm.NOTATION,handler:this.fnSelectNota.bind(this)}]),d=d.concat([{title:"List",id:"SelList",txt:lm.GAMES,handler:this.fnSelectList.bind(this)}]);if(this.isVideo(c)||this.isLiveVideo(c)||
this.isOfflineVideo(c)||this.isRecorder(c))d=d.concat([{title:"Video",id:"SelVideo",txt:"Video",handler:this.fnSelectVideo.bind(this)}]);CB.System.runsOnLiveChessBaseCom()&&(d=d.concat([{title:"Index",id:"SelHome",txt:"Index",handler:this.fnSelectBack.bind(this)}]));this.tabNavBtns[c]=d;var e=this.getButtonConfig().getCssTabNav();this.instantiateButtons("button",b,"t",d,e,c)};f.prototype.shakeFullWinBtn=function(b){$("#b-btnFullScreen-"+b).addClass("shakeShort")};f.prototype.stopShakeFullWinBtn=function(b){$("#b-btnFullScreen-"+
b).removeClass("shakeShort")};f.prototype.createDiagramReplayButtons=function(b,c,d){var e=[],f=V15.config.diaStyleSuffix;if(c.dataset.play||c.dataset.choice)e=e.concat([{title:"Restart",id:"Repeat",pic:"Repeat"+f,handler:this.fnRestart.bind(this)}]);e=e.concat([{title:lm.TAKE_BACK,id:"Retract",pic:"Retract"+f,handler:this.fnRetract.bind(this)},{title:lm.MAKE_MOVE,id:"Exec",pic:"Exec"+f,handler:this.fnExec.bind(this)}]);360<=$(c).width()&&"replayonly"!=c.dataset.buttons&&(e=e.concat([{},{}]),e.push({title:lm.FLIP_BOARD,
id:"Rotate",handler:this.fnFlipBoard.bind(this)}));c.dataset.hint?(e=e.concat([{}]),e.push({title:"Hint",id:"Hint",pic:"Hint"+f,handler:function(b){this.fnHint(c.dataset.hint,b)}.bind(this)})):(e=e.concat([{}]),e.push({title:"Help",id:"Hint",pic:"Hint"+f,handler:function(b){this.fnHelp(c.dataset.help,b)}.bind(this)}));c.dataset.solution&&e.push({title:"Solution",id:"Solution",handler:function(b){this.fnSolution(c.dataset.solution,b)}.bind(this)});"replayonly"!=c.dataset.buttons&&(e=e.concat([{},{}]),
e.push({title:"Download FEN",id:"Save",handler:this.fnSaveFEN.bind(this)}));this.diagramBtns[d]=e;f=this.getButtonConfig().getCssDiagrams();try{this.instantiateButtons("button",b,"d",e,f,d)}catch(g){}};f.prototype.createDiagramAnimButtons=function(b,c,d){c=[];var e=V15.config.diaStyleSuffix;c=c.concat([{title:"Rewind",id:"ActionRewind",pic:"ActionRewind"+e,handler:this.fnAnimRewind.bind(this)},{title:"Back",id:"ActionGotoPrev",pic:"ActionGotoPrev"+e,handler:this.fnAnimBack.bind(this)},{title:"Play",
id:"ActionPlay",pic:"ActionPlay"+e,handler:this.fnAnimPlay.bind(this)},{title:"Step",id:"ActionGotoNext",pic:"ActionGotoNext"+e,handler:this.fnAnimStep.bind(this)},{title:"Pause",id:"ActionPause",pic:"ActionPause"+e,handler:this.fnAnimPause.bind(this)}]);this.diagramBtns[d]=c;e=this.getButtonConfig().getCssDiagrams();this.instantiateButtons("button",b,"d",c,e,d)};f.prototype.fn3D=function(b){this.toggle3DBoard(b)};f.prototype.setAutoplayBtnImg=function(b,c){var d=$(String.f("#b-btnAutoplay-{0}",c)),
e='url( "'+CB.getCommonPath()+'Media/Ribbons/Reader/{0}{1}.png" )';b?d.css("background-image",String.f(e,"Stop",this.getButtonConfig().getBtnHBoard())):d.css("background-image",String.f(e,"Autoplay",this.getButtonConfig().getBtnHBoard()))};f.prototype.canUseEngine=function(){return CB.EngineInstance.isAjax||-1!=document.URL.search(/chessbase.com/i)||-1!=document.URL.search(/localhost/i)};f.prototype.createNotaButtons=function(b,c){var d=[];!this.socialMedia||CB.System.isElectron()||CB.System.isCordova()||
(d.push({title:"Like game",id:"LikeGame",handler:function(){V15.isLoggedIn()?($("#n-btnLikeGame-0").attr("disabled",!0),V15.panelMgr.likeGame(V15.panelMgr.modules[c].getKernel().game),$("#n-btnLikeGame-0").removeAttr("disabled")):V15.panelMgr.showAlert("You need to be logged in to like games.",350,130)}}),d.push({title:"Share game",id:"ShareGame",handler:function(){$("#n-btnShareGame-0").attr("disabled",!0);V15.panelMgr.shareGame(V15.panelMgr.modules[c].getKernel().game);$("#n-btnShareGame-0").removeAttr("disabled")}.bind(this)}));
CB.System.isElectron()||CB.System.isCordova()||d.push({title:lm.SAVE+" (Ctrl-S)",id:"Save",handler:this.fnSave.bind(this)});d.push({title:"Toggle Variation Folding",id:"UnFoldAll",handler:function(){this.modules[c]&&this.modules[c].nota&&this.modules[c].nota.unfoldAll()}.bind(this)});d.push({title:lm.PROMOTE_LINE+" (Alt-up)",id:"PromoteLine",handler:this.fnPromoteLine.bind(this)});d.push({title:lm.DELETE_LINE+" (Del)",id:"DeleteLine",handler:this.fnDeleteLine.bind(this)});d.push({title:lm.CUT_LINE+
" (})",id:"CutLine",handler:this.fnCutLine.bind(this)});d.push({title:lm.UNANNOTATE+" (Ctrl-Shift-Y)",id:"Unannotate",handler:this.fnUnannotate.bind(this)});d.push({title:"Undo (Ctrl-Z)",id:"Undo",handler:this.fnUndo.bind(this)});d.push({title:"Redo (Ctrl-Y)",id:"Redo",handler:this.fnRedo.bind(this)});CB.System.isElectron()||CB.System.isCordova()||(d.push({title:"Copy FEN to clipboard",id:"Fen",handler:this.fnSaveNotaFEN.bind(this)}),d.push({title:"Check Database",id:"OnlineDB",handler:this.fnOnlineDB.bind(this)}));
!CB.System.isElectron()&&!CB.System.isCordova()&&1600<window.innerWidth&&(d.push({title:"-> MyGames",id:"MyGames",handler:this.fnMyGames.bind(this)}),d.push({title:"-> Fritz",id:"FritzOnline",handler:this.fnFritz.bind(this)}));1200<window.innerWidth&&d.push({title:"Live Games Running Now",id:"LiveNew",handler:this.fnLivePlaychess.bind(this)});this.notaBtns=d;var e=this.getButtonConfig().getCssNota();try{this.instantiateButtons("button",b,"n",d,e,c)}catch(f){}};f.prototype.createNotaButtonsTabbed=
function(b,c){var d=[];this.isVideo(c)||this.isLiveVideo(c)||this.isOfflineVideo(c)||(d.push({title:"Load Prev",id:"LoadPrev",handler:this.loadPrevGame.bind(this)}),d.push({title:"Load Next",id:"LoadNext",handler:this.loadNextGame.bind(this)}),d.push({separator:!0}));d.push({title:lm.UNANNOTATE+" (Ctrl-Shift-Y)",id:"Unannotate",handler:this.fnUnannotate.bind(this)});d.push({separator:!0});d.push({title:"Undo (Ctrl-Z)",id:"Undo",handler:this.fnUndo.bind(this)});CB.System.isElectron()||CB.System.isCordova()||
d.push({title:lm.SAVE+" (Ctrl-S)",id:"Save",handler:this.fnSave.bind(this)});this.notaBtns=d;var e=this.getButtonConfig().getCssNota();try{this.instantiateButtons("button",b,"n",d,e,c)}catch(f){}};f.prototype.createEngineButtons=function(b,c){var d="",e=[];e.push({title:"More Lines",id:"More",handler:function(){this.fnIncMultiVars(c,1)}.bind(this)});e.push({title:"Less Lines",id:"Less",handler:function(){this.fnIncMultiVars(c,-1)}.bind(this)});e.push({title:"Threat",id:"Threat",handler:this.fnToggleThreat.bind(this)});
for(var f=this.getButtonConfig().getCssEngine(),g=0;g<e.length;g++)d+=String.f('<button title="{0}" id="e-btn{1}-{2}" class="{3}"></button>',e[g].title,e[g].id,c,f);$(b).html(d);d='url( "'+CB.getCommonPath()+'Media/Ribbons/Reader/{0}{1}.png" )';for(g=0;g<e.length;g++)f=$(String.f("#e-btn{0}-{1}",e[g].id,c)),e[g].handler&&(f[0].onclick=function(b,c){return function(d){e[b].handler(c,d)}}.call(this,g,c)),f.css("background-image",String.f(d,e[g].id,16))};f.prototype.setFullWinBtnImage=function(b,c){this.buttonImages[b].FullScreen=
c?"FullScreen":"Restore"};f.prototype.fnSaveDB=function(b){this.fnSave(b,!1)};f.prototype.fnSave=function(b,c,d){var e="Download",f=".fen"===d;if(c)b=this.modules[b].getKernel().game,c=f?CB.PGNWriter.toFEN(b):CB.PGNWriter.toPGN(b),0<b.hdr.getStrPlayers(!1,0).length&&(e=b.hdr.getStrPlayers(!1,0)+(d||".pgn")),d=b.requiresPremiumForDownload()&&!f;else{c=this.modules[b].toPgn(b);if(!c)return;e=this.modules[b].pgnTitle;d=this.modules[b].getKernel().game.requiresPremiumForDownload()}CB.System.copyToClipboard(c);
f?this.showMessage("FEN copied"):(f=CB.System.runsOnChessBaseCom()&&-1==document.URL.search(/view.chessbase.com/i)&&-1==document.URL.search(/cloudserver.chessbase.com/i),V15.isLoggedIn()||!f?d&&!V15.isPremium()&&f?window.location="https://live.chessbase.com/Premium?returnurl="+encodeURIComponent(document.location):(window.Blob?(console.log("Blob DL: "+e),c=new Blob([c],{type:"text/plain;charset=utf-8"}),window.saveAs(c,e)):0<CB.System.getIEVersion()&&window.clipboardData&&clipboardData.setData&&(alert("On Internet Explorer the game has been pasted to the clipboard ('Strg-V')"),
clipboardData.setData("Text",c)),CB.LogStats("PGN")):window.location="https://live.chessbase.com/Logon?returnurl="+encodeURIComponent(document.location))};f.prototype.runsOnChessBaseNews=function(){return-1!=document.URL.search(/en.chessbase.com/i)||-1!=document.URL.search(/de.chessbase.com/i)||-1!=document.URL.search(/es.chessbase.com/i)||-1!=document.URL.search(/localhost/i)};f.prototype.fnSaveFEN=function(b){this.fnSave(b,!1,".fen")};f.prototype.fnSaveNotaFEN=function(b){this.fnSave(b,!0,".fen")};
f.prototype.moduleGamesToPgn=function(b){return V15.lobby.getPgn(this.modules[b].ticket)};f.prototype.fnGotoStart=function(b){this.stopAutoplay(b);this.modules[b].getKernel().game.gotoStart()};f.prototype.fnRestart=function(b){this.fnAnimRewind(b);this.modules[b].getKernel().Vk.restart()};f.prototype.fnGotoEnd=function(b){this.stopAutoplay(b);this.modules[b].getKernel().game.gotoEnd()};f.prototype.fnRetract=function(b){this.stopAutoplay(b);this.modules[b].getKernel().game.gotoPrev()};f.prototype.fnExec=
function(b){if(!this.stopAutoplay(b)){var c=this.modules[b].getKernel().game.getAnno(CB.AnnoType.TRAINING);c&&!c.solved||this.modules[b].getKernel().game.gotoNext()}};f.prototype.fnAnimPlay=function(b){for(var c=0;c<this.modules.length;c++)c!=b&&this.modules[c].animationController&&this.modules[c].animationController.pause();this.modules[b].animationController&&this.modules[b].animationController.play()};f.prototype.fnAnimStep=function(b){this.modules[b].animationController&&this.modules[b].animationController.step()};
f.prototype.fnAnimBack=function(b){this.modules[b].animationController&&this.modules[b].animationController.stepBack()};f.prototype.fnAnimFastForward=function(b){this.modules[b].animationController&&this.modules[b].animationController.fastForward()};f.prototype.fnAnimPause=function(b){this.modules[b].animationController&&this.modules[b].animationController.pause()};f.prototype.fnAnimRewind=function(b){this.modules[b].animationController&&(this.modules[b].getKernel().Vk.restart(),this.modules[b].animationController.rewind(!0))};
f.prototype.stopAutoplay=function(b){this.modules[b].runAutoplayTimer&&this.modules[b].runAutoplayTimer.stop();return this.modules[b].timerAutoplay?!this.fnAutoplay(b):!1};f.prototype.fnAutoplay=function(b,c,d){if(this.modules[b].timerAutoplay)return this.modules[b].timerAutoplay.stop(),delete this.modules[b].timerAutoplay,this.modules[b].getKernel().boardWin.prepareFullRedraw(),this.modules[b].animSteps&&(this.modules[b].getKernel().boardWin.animSteps=this.modules[b].animSteps),this.modules[b].getKernel().Vk.setIsAutoplay(!1),
this.setAutoplayBtnImg(!1,b),!1;this.modules[b].getKernel().boardWin&&this.modules[b].getKernel().boardWin.animSteps&&(this.modules[b].animSteps=this.modules[b].getKernel().boardWin.animSteps,CB.System.isMobile()?this.modules[b].getKernel().boardWin.animSteps.forMove=.3:this.modules[b].getKernel().boardWin.animSteps.forMove=3);this.modules[b].getKernel().game.getMoveNo()==this.modules[b].getKernel().game.getMainLine().length&&this.fnGotoStart(b);this.setAutoplayBtnImg(!0,b);var e=d||2500;CB.System.isMobile()&&
(e=1600);c&&!d&&(c.ctrlKey?(e=1300,c.altKey&&(e=c.shiftKey?200:700)):c.shiftKey?(e=5E3,c.altKey&&(e=1E4)):c.altKey&&(e=1E3));this.modules[b].getKernel().boardWin&&this.modules[b].getKernel().boardWin.destroyMessage();this.modules[b].getKernel().Vk.setIsAutoplay(!0);this.modules[b].getKernel().game.gotoNext();this.modules[b].timerAutoplay=new CB.Timer(function(){this.modules[b].getKernel().game.isOnLastMove()?(this.modules[b].timerAutoplay.stop(),(new CB.Timer(function(){this.modules[b].timerAutoplay&&
(this.loadNextGame(b),this.modules[b].getKernel().game.gotoIndex(0),this.modules[b].timerAutoplay.runPeriodic(e))}.bind(this))).runOnce(4*e)):this.modules[b].getKernel().game.gotoNext()}.bind(this));this.modules[b].timerAutoplay.runPeriodic(e);return!0};f.prototype.fnCursorUp=function(b){this.modules[b].nota&&this.modules[b].nota.handleCursorUp()};f.prototype.fnCursorDown=function(b){this.modules[b].nota&&this.modules[b].nota.handleCursorDown()};f.prototype.fnAnalysis=function(b){this.canUseEngine()?
(this.nActivePlugin=b,this.modules[b].getKernel().Vk.toggleEngine()||this.closeEnginePanel()):this.modules[this.nActivePlugin].engineOpen?this.closeEnginePanel():(CB.LogStats("Engine"),this.openEnginePanel(),this.modules[this.nActivePlugin].enginePanel.displayInfo("Sorry, you cannot run an engine in this browser yet. On Mac, please try Chrome. Thank you.","cbEngineWarnBrowser"))};var t=new CB.Vr;f.prototype.fnIncMultiVars=function(b,c){this.modules[b].getKernel().Vk.incNMultiVars(c);t.exec(function(){this.modules[b].getKernel().Vk.goAll()}.bind(this),
300)};var v=new CB.Vr;f.prototype.fnToggleThreat=function(b){v.exec(function(){this.modules[b].getKernel().Vk.toggleThreat()}.bind(this),300)};f.prototype.fnFlipBoard=function(b){this.modules[b].getKernel().boardWin&&this.modules[b].getKernel().boardWin.flipBoard()};var y=0;f.prototype.fnPieces=function(b){this.stopAutoplay(b);b=[CB.CommandIds.PIECES2D_FRITZ,CB.CommandIds.PIECES2D_USCF,CB.CommandIds.PIECES2D_CRYSTALS_WOOD,CB.CommandIds.PIECES2D_BLUE,CB.CommandIds.PIECES2D_OLDSTYLE];y++;y>b.length-
1&&(y=0);glSettings.changeBoardStyle(b[y])};f.prototype.fnSound=function(b){if(V15.chessAudio)for(V15.chessAudio.enable(!V15.chessAudio.isEnabled()),b=0;b<this.soundBtnSelector.length;b++)this.buttonImages[b].SoundOn=V15.chessAudio.isEnabled()?"SoundOn":"SoundMute",this.setButtonImages("b",this.boardBtns[b],this.getButtonConfig().getBtnHBoard(),this.getButtonConfig().getCssBoard(),b,"Reader")};f.prototype.fnStart=function(b){this.recorder[0].start()};f.prototype.fnLike=function(b){var c=this.modules[b].getKernel().Vk.videoid;
if(c){var d="";V15.isLoggedIn()&&V15.Vf.userName&&(d=V15.Vf.userName);c=this.baseurl+"Replay/ToggleLike?id="+encodeURIComponent(c)+"&user="+d;$.get(c,function(c){c&&(this.fnHint(c,b),this.setLike(b))}.bind(this)).fail(function(b){alert("Liked")}.bind(this))}};f.prototype.setLike=function(b){var c=this.modules[b].getKernel().Vk.videoid;if(c){var d="";V15.isLoggedIn()&&V15.Vf.userName&&(d=V15.Vf.userName);c=this.baseurl+"Replay/GetMetaData?id="+encodeURIComponent(c)+"&user="+d;$.get(c,function(c){this.buttonImages[b].Like=
0<c.Like.length?"Liked":"Like";this.setButtonImages("b",this.boardBtns[b],this.getButtonConfig().getBtnHBoard(),this.getButtonConfig().getCssBoard(),b,"Reader")}.bind(this)).fail(function(b){alert("Liked")}.bind(this))}};f.prototype.fnHint=function(b,c){this.modules[c].getKernel().boardWin&&(this.modules[c].getKernel().boardWin.addMessage(b,!0),(new CB.Timer(function(){this.modules[c].getKernel().boardWin.destroyMessage()}.bind(this))).runOnce(4E3))};f.prototype.fnHelp=function(b,c){this.modules[c].getKernel().Vk.showDiagramHelp(b)};
f.prototype.fnSolution=function(b,c){if(this.modules[c].getKernel().boardWin&&4==b.length){var d=CB.Square.fromString(b.substring(0,2)),e=CB.Square.fromString(b.substring(2,4));this.modules[c].getKernel().boardWin.drawArrow(d,e,"hsla( 120, 70%, 50%, 0.9 )")}};f.prototype.loadPrevGame=function(b){if(this.modules[b].pgnDatabase){var c=this.modules[b].getKernel().game.gameNo-1;if(!c||1>c)c=this.modules[b].pgnDatabase.getGameCount();var d=this.modules[b].pgnDatabase.getGame(c);this.loadGame(d,b,c,!0)}else if(c=
this.modules[b].getKernel().idGame)if(d=this.modules[b].list,1<d.length){for(var e=!1,f=1;!e&&f<d.length;f++)d[f].id==c&&(c=d[f-1].id,A(c,b),e=!0);e||d[d.length-1].id==c||A(d[d.length-1].id,b)}};f.prototype.loadNextGame=function(b){if(this.modules[b].pgnDatabase){var c=this.modules[b].getKernel().game.gameNo+1;if(!c||c>this.modules[b].pgnDatabase.getGameCount())c=1;var d=this.modules[b].pgnDatabase.getGame(c);this.loadGame(d,b,c,!0)}else if(c=this.modules[b].getKernel().idGame){for(var d=this.modules[b].list,
e=!1,f=0;!e&&f<d.length-1;f++)d[f].id==c&&(c=d[f+1].id,A(c,b),e=!0);e||d[0].id==c||A(d[0].id,b)}};f.prototype.fnFullWindow=function(b){if(!this.isTabbedLayout()){this.stopShakeFullWinBtn(b);var c=$(this.allPluginClasses);if(c&&c[b]){var d=0,e=0;this.maximized!=b&&0<=this.maximized&&this.fnFullWindow(this.maximized);this.maximized==b?(this.setFullWinBtnImage(b,!0),this.maximized=-1,$(c[b]).css("max-width",this.storeMaxWidth),$(c[b]).css("max-height",this.storeMaxHeight),$(c[b]).css("box-shadow",this.storeShadow),
$(c[b]).width(this.storeWidth),$(c[b]).height(this.storeHeight),$(c[b]).offset({top:this.storeOffset.top,left:this.storeOffset.left}),$(c[b]).css("z-index","1"),d=this.storeWidth,e=this.storeHeight,$("#root"+b).jqxSplitter({panels:this.storePanels})):(this.setFullWinBtnImage(b,!1),this.storeWidth=$(c[b]).width(),this.storeHeight=$(c[b]).height(),this.storeOffset=$(c[b]).offset(),this.storeMaxWidth=$(c[b]).css("max-width"),this.storeShadow=$(c[b]).css("box-shadow"),$("#root"+b).jqxSplitter("panels"),
this.storePanels=$("#root"+b).jqxSplitter("panels"),this.maximized=b,d=Math.min(1900,window.innerWidth-2*Math.min(30,Math.round(.05*window.innerWidth))),e=window.innerHeight-10,$(c[b]).css("max-width",d),$(c[b]).css("max-height",e),$(c[b]).css("box-shadow","1px 1px 12px 2px hsla( 0, 0%, 0%, 0.35 )"),$(c[b]).width(d),$(c[b]).height(e),$(c[b]).offset({top:window.pageYOffset+2,left:4+(window.innerWidth-d)/2}),$(c[b]).css("z-index","100"),this.nActivePlugin=b,this.shouldDoBigMultiBoard(b,d,e)&&($("#root"+
b).jqxSplitter({panels:[{size:"68%",collapsible:!1},{size:"32%",collapsible:!1}]}),700>e&&$("#westNest"+b).jqxSplitter({panels:[{size:"60%",collapsible:!1},{size:"40%",collapsible:!1}]})),CB.LogStats("FullWin"));$("#root"+b).jqxSplitter({width:d+"px",height:e+"px"});this.resizePlugin($(c[b]),b);h.exec(function(){return function(){this.onSplitterResize(b,this.isLive(b))}.bind(this)}.call(this,b),300);$("#root"+b).jqxSplitter("refresh");this.isVertical?$("#southNest"+b).jqxSplitter("refresh"):$("#westNest"+
b).jqxSplitter("refresh");$("#eastNest"+b).jqxSplitter("refresh");$("#eastUpDownNest"+b).jqxSplitter("refresh")}}};f.prototype.shouldDoBigMultiBoard=function(b,c,d){return!this.isTabbedLayout()&&this.isLive(b)&&1200<c&&700<d&&3<=this.modules[b].list.length};f.prototype.isVideoTabVisible=function(b){return this.isAnyVideo(b)?this.isTabVisible(b,2):!1};f.prototype.isNotaTabVisible=function(b){return this.isTabVisible(b,0)};f.prototype.isListTabVisible=function(b){return this.isTabVisible(b,1)};f.prototype.isTabVisible=
function(b,c){return $(this.tabNavSwitchDivs[b][c]).is(":visible")};f.prototype.fnSelectNota=function(b){this.notaResized[b]=!0;(new CB.Timer(function(){var c=$(this.allPluginClasses)[b];this.resizeNotaTabbed(c,b)}.bind(this))).runOnce(10);this.fnSelectTab(b,0)};f.prototype.fnSelectList=function(b){this.listResized[b]||(this.listResized[b]=!0,(new CB.Timer(function(){var c=this.getGameCount(b),d=1<c;if(this.isLiveVideo(b)||this.isOfflineVideo(b))d=!0;var e=$(this.allPluginClasses)[b],f=$(e).width(),
e=$(e).height(),g=$("#north"+b).height(),h=0;this.ribbonButtonsVisible(b)&&(h=$("#tabNavButtons"+b).height());this.isAnyVideo(b)?this.resizeVideoAndListTabbed(b,d,0,c,f,e-g-h-14):this.resizeEngineAndListTabbed(b,d,0,c,f,e-g-h-14)}.bind(this))).runOnce(10));this.fnSelectTab(b,1)};f.prototype.fnSelectVideo=function(b){(new CB.Timer(function(){var c=this.getGameCount(b),d=1<c;this.isLiveVideo(b)&&(d=!0);var e=$(this.allPluginClasses)[b],f=$(e).width(),e=$(e).height(),g=0;this.ribbonButtonsVisible(b)&&
(g=$("#tabNavButtons"+b).height());var h=$("#north"+b).height();this.isAnyVideo(b)?this.resizeVideoAndListTabbed(b,d,0,c,f,e-h-g-14):this.resizeEngineAndListTabbed(b,d,0,c,f,e-h-g-14);this.onSplitterResizeVerti(b,!1);this.resize(null,!0)}.bind(this))).runOnce(10);this.fnSelectTab(b,2)};f.prototype.fnSelectBack=function(b){document.exitFullScreen&&document.exitFullScreen();document.location="https://live.chessbase.com"};f.prototype.fnSelectTab=function(b,c){if(0<this.tabNavBtns.length)for(var d=0;d<
this.tabNavSwitchDivs[b].length;d++){var e=String.formatEx("#t-btn{0}-{1}",this.tabNavBtns[b][d].id,b);d==c?($(this.tabNavSwitchDivs[b][d]).css("display","block"),$(e).addClass("tabNavBtnSelected")):($(this.tabNavSwitchDivs[b][d]).css("display","none"),$(e).removeClass("tabNavBtnSelected"))}};f.prototype.onOrientationChange=function(b){0<=this.maximized&&this.fnFullWindow(this.maximized);this.checkRecreateOrientation()};f.prototype.fnNotaSave=function(b){console.log("Nota Save");this.fnSave(b,!0)};
f.prototype.fnOnlineDB=function(b){var c=$(this.allPluginClasses);c&&c[b]&&(V15.saveGameToLocalStorage(),window.location="https://database.chessbase.com?ref=pgn")};f.prototype.fnMyGames=function(b){this.modules[b].getKernel().Vk.saveToCloud(!0)||5;var c=$(this.allPluginClasses);c&&c[b]&&(V15.saveGameToLocalStorage(),window.location="http://mygames.chessbase.com?ref=pgn")};f.prototype.fnFritz=function(b){var c=$(this.allPluginClasses);c&&c[b]&&V15.passToFritzOnline(this.modules[b].getKernel().game)};
f.prototype.checkGAs=function(b){if(CB.System.isElectron()){var c=b,d=b.lastIndexOf("/");-1!=d&&(c=b.substr(d+1));this.readerHelper.readGameActionFileList(function(){this.readerHelper.isFileAvailable(c,this.onGaAvailable.bind(this))}.bind(this))}else try{var e=new XMLHttpRequest;e.open("GET",b,!1);e.onreadystatechange=function(){if(4===e.readyState&&(200===e.status||0==e.status)){this.gameactions=[];for(var b=e.responseText.split("\r\n"),c=0;c<(b.length-1)/2;c++){var d=b[2*c],f=b[2*c+1],g=new CB.ScriptCommand;
g.fromString(d,f);this.gameactions.push(g)}}}.bind(this);e.send(null)}catch(f){CB.LogException("RM:checkGAs",f)}};f.prototype.fnPromoteLine=function(b){this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().Vk.onPromoteLine()&&this.modules[b].getKernel().game.promoteLine()};f.prototype.fnDeletePrevious=function(b){this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().Vk.onDeletePrevious()&&this.modules[b].getKernel().game.deletePrevious()};
f.prototype.fnCutLine=function(b){this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().Vk.onCutLine()&&this.modules[b].getKernel().game.deleteRemaining()};f.prototype.fnDeleteLine=function(b){this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().Vk.onDeleteLine()&&this.modules[b].getKernel().game.deleteLine()};f.prototype.fnUndo=function(b){if(this.modules[b].undo.length){var c=this.modules[b].undo.pop();
this.modules[b].redo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().game.assign(c)}};f.prototype.fnRedo=function(b){if(this.modules[b].redo.length){var c=this.modules[b].redo.pop();this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().game.assign(c)}};f.prototype.fnUnannotate=function(b){this.modules[b].undo.push(ObjUtil.clone(this.modules[b].getKernel().game));this.modules[b].getKernel().Vk.saved=!1;this.modules[b].getKernel().game.unAnnotate()};
f.prototype.fnEmbed=function(b){this.isLive(b)?window.open("https://docu.chessbase.com/reader/cblive.html"):window.open("https://docu.chessbase.com/reader/cbreplay.html")};f.prototype.fnLivePlaychess=function(b){window.open("http://live.playchess.com")};f.prototype.onNotaClickListener=function(){this.stopAutoplay(-1==this.nActivePlugin?0:this.nActivePlugin)};f.prototype.handleKeyDown=function(b,c){if(this.instantiated&&-1!=this.nActivePlugin){var d=!0;switch(b.which){default:d=!1;break;case 13:this.fnAutoplay(c,
b,1E3);break;case 27:this.maximized==c&&this.fnFullWindow(c);this.modules[c].timerAutoplay&&this.fnAutoplay(c,b);break;case 37:this.fnRetract(c);break;case 39:this.fnExec(c);break;case 38:b.altKey?this.fnPromoteLine(c):this.fnCursorUp(c);break;case 40:this.fnCursorDown(c);break;case 46:this.fnDeleteLine(c);break;case 56:this.fnDeletePrevious(c);break;case 57:this.fnCutLine(c);break;case 65:b.ctrlKey||(d=!1);break;case 66:b.ctrlKey?this.fnFlipBoard(c):d=!1;break;case 83:b.ctrlKey?this.fnSave(c,!0):
d=!1;break;case 89:b.ctrlKey?b.shiftKey?this.fnUnannotate(c):this.fnRedo(c):d=!1;break;case 90:b.ctrlKey?this.fnUndo(c):d=!1;break;case 113:b.altKey?this.fnAnalysis(c):d=!1;break;case 122:b.ctrlKey||b.shiftKey?this.loadPrevGame(c):this.loadNextGame(c);break;case 187:this.fnIncMultiVars(c,1);break;case 189:this.fnIncMultiVars(c,-1);break;case 120:this.test(c)}d&&b.preventDefault();return d}};f.prototype.checkShowIsLive=function(b){(new CB.Timer(function(){if(this.isVideo(b)&&this.show){var c=this.buildGetLiveStreamsByShowURL(this.show);
$.get(c,function(c){c&&0<c.results.length&&(new CB.Timer(function(){this.deleteRoot(b);this.modules[b].pluginDiv.className="cblivevideo";V15.panelMgr.init();V15.panelMgr.createPanels()}.bind(this))).runOnce(100)}.bind(this)).fail(function(){}.bind(this))}}.bind(this))).runPeriodic(3E4)};f.prototype.deleteRoot=function(b){$("#cbcaption"+b).remove();$("#rootParent"+b).remove()};f.prototype.test=function(b){this.show&&(this.isVideoShow?(this.deleteRoot(b),this.modules[b].pluginDiv.className="cbvideo"):
(this.deleteRoot(b),this.modules[b].pluginDiv.className="cblivevideo"),V15.panelMgr.init(),V15.panelMgr.createPanels(),this.isVideoShow=!this.isVideoShow)};f.prototype.isMaximized=function(){return this.maximized==this.nActivePlugin};f.prototype.getFnKernelInitGame=function(b,c){return function(b){if(this.modules&&this.modules.length){var d=this.modules[c].pgnDatabase;d&&b.assign(d.getGame(1),!0)}}};f.prototype.getFnKernelInitDiagram=function(b,c,d,e){return function(f){f.reset();if(b){var g=b.dataset.fen;
if(g)g=new CB.Position(g),g=new CB.Game(g),d.addColoredAnnos(b,g),f.assign(g);else{var h=b.dataset.pos;h?(g=new CB.Position,g.initString(h),g=new CB.Game(g),d.addColoredAnnos(b,g),f.assign(g)):(g=b.dataset.moves)?(f.assign(CB.PGN.parseGame(g)),f.gotoIndex(f.getMainLine().length)):e&&(f=new CB.PgnDatabase(e),d.modules[c].pgnDatabase=e,g=f.getGame(1),d.modules[c].pgnTitle=g.hdr.getStrPlayers(!1,0)+".pgn",d.modules[c].getKernel())}}}};f.prototype.modifyPlayingModeForTraining=function(b,c,d){if((b=b.dataset.solution)&&
4==b.length){var e=CB.Square.fromString(b.substring(0,2)),f=CB.Square.fromString(b.substring(2,4)),g=new CB.Timer(function(){d.boardWin.destroyMessage()});d.Vk.fnAcceptMove=function(b){if(0<d.game.getMoveIndex())return!0;g.runOnce(2E3);if(b.from!=e||b.to!=f)return d.boardWin.addMessage("Wrong Move, sorry",!0),!1;d.boardWin.addMessage("Correct!",!0);return!0}.bind(this)}};f.prototype.addColoredAnnos=function(b,c){var d=b.dataset.arrows,e=b.dataset.squares;if(d){for(var f=d.split(","),d=new CB.ColArrowAnno,
g=0;g<f.length;g++){var h=f[g];if(4==h.length){var l=CB.Square.fromString(h.substring(0,2)),h=CB.Square.fromString(h.substring(2,4)),l=new CB.ColArrow(l,h,CB.BoardColor.GREEN);d.push(l)}}d.length&&c.setAnnoBeforeFirstMove(CB.AnnoType.ARROW_LIST,d,!0)}if(e){e=e.split(",");d=new CB.ColSqAnno;for(f=0;f<e.length;++f)g=e[f],2==g.length&&(g=CB.Square.fromString(g),g=new CB.ColSq(g,CB.BoardColor.GREEN),d.push(g));d.length&&c.setAnnoBeforeFirstMove(CB.AnnoType.SQUARE_LIST,d,!0)}};f.prototype.createPgnDatabase=
function(b,c,d,e){if(b){var f=b.dataset.url;f?$.get(f,function(e){if(e){e=new CB.PgnDatabase(e);this.modules[d].pgnDatabase=e;this.modules[d].pgnTitle=f;var g=!1;1<e.getGameCount()?g=c(e,d,this.loadGame.bind(this)):(this.hideRibbon(d),this.resizePlugin($(b),d));g||("no"!=b.dataset.autoplay&&1<e.getGameCount()?(parseInt(b.dataset.autoplay),this.modules[d].getKernel().Vk.loadGame(this.modules[d].pgnDatabase.getGame(1)),this.modules[d].getKernel().hasTraining()):this.modules[d].getKernel().Vk.loadGame(this.modules[d].pgnDatabase.getGame(1)));
this.setSingleGameCaption(this.modules[d].getKernel().game,d)}}.bind(this)).fail(function(c){this.resizePlugin($(b),d)}.bind(this)):e&&(e=new CB.PgnDatabase(e),this.modules[d].pgnDatabase=e,1<e.getGameCount()?c(e,d,this.loadGame.bind(this)):(this.hideRibbon(d),this.resizePlugin($(b),d),CB.System.isElectron()&&"undefined"!==typeof electronBridge&&electronBridge.setReplayTouchBar(V15,"Replay")),e=this.modules[d].pgnDatabase.getGame(1),this.modules[d].pgnTitle=e.hdr.getStrPlayers(!1,0)+".pgn",this.modules[d].getKernel().Vk.loadGame(e),
this.setSingleGameCaption(e,d),this.pgnStartMoveIndex&&this.modules[d].getKernel().game.gotoIndex(this.pgnStartMoveIndex),!this.modules[d].getKernel().hasTraining()&&0<parseInt(b.dataset.autoplay)&&(this.modules[d].runAutoplayTimer=new CB.Timer(function(){this.fnAutoplay(d,null,b.dataset.autoplay)}.bind(this)),this.modules[d].runAutoplayTimer.runOnce(1E4)))}};f.prototype.createVideoDatabase=function(b,c,d,e){if(b){this.baseurl=V15.config.getVideoPortalUris()[0];e=b.dataset.id;var f="";e&&(f=this.baseurl+
"public/video?id="+encodeURIComponent(e));var g=b.dataset.show;g&&(f=this.baseurl+"public/GetVideosFromShow?id="+g,this.show=g);$.get(f,function(e){e&&(this.modules[d].videoDatabase=e,"Training PositionVideo"===e.Category&&(this.modules[d].getKernel().PositionMode=!0),c(e,d,this.loadVideoGame.bind(this)),this.resizePlugin($(b),d),g&&this.checkShowIsLive(d))}.bind(this)).fail(function(){alert("sorry,can get info")}.bind(this))}};f.prototype.buildGetLiveStreamsURL=function(){return"https://videos.chessbase.com/live/getlivestreams?client=web&filter="+
CB.strUtil.getURLParam("filter")};f.prototype.buildGetLiveStreamsByShowURL=function(b){return"https://videos.chessbase.com/live/getlivestreamsbyshow?show="+b};f.prototype.createOfflineVideoDatabase=function(b,c,d,e){if(b){var f=b.dataset.id,g={},h=[];if(f.endsWith(".txt")){f.split("/");this.modules[d].getKernel().OfflineInteractive=!0;var l=new XMLHttpRequest;l.open("GET",f,!1);l.onreadystatechange=function(){if(4===l.readyState&&(200===l.status||0==l.status)){this.modules[d].cmsiManager=new CB.CMSIManager;
for(var e=l.responseText.split("\r\n"),q=0;q<e.length;q++){var r=e[q];if(-1!=r.indexOf(".mp4")){var t=r.indexOf("<"),v=r.indexOf(">");if(0<v&&(t=r.substr(t+1,v-t-1),0<t.length)){t=f.replace("FileNameToTitle.txt",t);v=t.lastIndexOf("/");-1!=v&&(A=t.substr(v+1));var v=A,y=f.lastIndexOf("/");this.modules[d].baseDir=f.substr(0,y)+"/";this.modules[d].cmsiManager.addFile(v);if(0==this.modules[d].cmsiManager.extractStateFromFileName(A)){v={};v.Name=t;A=r.indexOf("[");y=r.indexOf("]");0<y&&(v.Name=r.substr(A+
1,y-A-1));v.Id=t;v.url=t;var A=v.gameId=t;h.push(v)}}}}g.results=h;this.modules[d].offlinevideoDatabase=g;c(g,d,this.loadOfflineVideoGame.bind(this));this.resizePlugin($(b),d)}}.bind(this);l.send(null)}else this.modules[d].getKernel().OfflineInteractive=!1,e={},e.Name=f,e.Id=f,e.url=f,e.gameId=f,h.push(e),g.results=h,this.modules[d].offlinevideoDatabase=g,c(g,d,this.loadOfflineVideoGame.bind(this)),this.resizePlugin($(b),d)}};f.prototype.getVideoShow=function(){var b=-1,c=pluginDiv.dataset.show;c&&
(b=c);return b};f.prototype.createLiveVideoDatabase=function(b,c,d,e){if(b){e=this.buildGetLiveStreamsURL();b.dataset.id&&(e=this.buildGetLiveStreamsURL());var f=b.dataset.show;f&&(this.getCalendar(d),e=this.buildGetLiveStreamsByShowURL(f),this.show=f);$.get(e,function(e){e&&(this.modules[d].livevideoDatabase=e,c(e,d,this.loadLiveVideoGame.bind(this)),this.resizePlugin($(b),d))}.bind(this)).fail(function(){this.resizePlugin($(b),d)}.bind(this))}};f.prototype.loadTableData=function(b,c){if(b){$(b).html('<div style= "font-size:large;margin-left:auto;margin-right:auto;margin-top:20px;margin-bottom:20px">Loading Table...</div>');
var d=b.dataset.url,d=b.dataset.name,e=parseInt(b.dataset.top),f=b.dataset.round||1E5,g=b.dataset.tbs,h=b.dataset.caption,l=b.dataset.pic,q=b.dataset.pw||1,r=b.dataset.pd||.5,t=b.dataset.pl||0,d=String.f("{0}/results/{1}/all",V15.config.getLiveResult(),d),v={caption:h,withPic:l};d&&$.get(d,function(d){if(d){var h={round:f,top:e,tbs:g,pointsWin:parseFloat(q),pointsDraw:parseFloat(r),pointsLoss:parseFloat(t)};this.createCrossTable(b,c,d,h,v)}}.bind(this))}};f.prototype.loadPairingData=function(b,c){if(b){var d=
b.dataset.name,e=parseInt(b.dataset.top),f=b.dataset.round||3E4,g=b.dataset.pw||1,h=b.dataset.pd||.5,l=b.dataset.pl||0;(d=String.f("{0}/results/{1}/all",V15.config.getLiveResult(),d))&&$.get(d,function(d){if(d)var q={round:f,top:e,pointsWin:parseFloat(g),pointsDraw:parseFloat(h),pointsLoss:parseFloat(l)};this.createPairings(b,c,d,q,{})}.bind(this))}};f.prototype.selectOrAddBoard=function(b,c){if(this.modules[b].useFirstBoard)return this.modules[b].useFirstBoard=!1,this.modules[b].kernel[0].setIdGame(c),
0;if(this.modules[b].kernel.length<this.modules[b].maxKernels){var d=this.modules[b].addKernel(this);d.idGame=c;var e=this.modules[b].boardArea.canvas,f=this.createBoardWin(e,this.getMultiBoardOptions());f.animateBoard=!1;d.setBoardWin(f);d.Vk.createGUIElements(f);e.control.addBoard(f,c);d=$("#boardHolder"+b).width();e=$("#boardHolder"+b).height();this.launchResizeBoard(b,d,e,300);return this.modules[b].kernel.length-1}return-1};var A=function(b,c,d,f){var g=V15.panelMgr;V15.panelMgr.modules[c].nGotoMoveIndex=
f;if(g.trySwapWithBigBoard(b,c)){if(f){var h=V15.panelMgr.modules[c].nCurrKernel;e(c,b,h).game.gotoIndex(f)}}else{for(var l=0;l<g.modules[c].kernel.length;l++)if(g.modules[c].kernel[l].idGame==b){g.changeSelectedGameKernel(b);g.onWatch(c,b);f&&(h=V15.panelMgr.modules[c].nCurrKernel,e(c,b,h).game.gotoIndex(f));return}h=V15.panelMgr.selectOrAddBoard(c,b);f=0;!d&&0>h&&(f=V15.panelMgr.modules[c].getKernel().idGame,V15.panelMgr.setGameStat(c,f,""),V15.panelMgr.modules[c].getKernel().setIdGame(b),h=V15.panelMgr.modules[c].nCurrKernel);
V15.lobby.initKibitzingById(b,V15.panelMgr.modules[c].ticket,0<=h?function(b){return e(c,b,h)}:null,function(b,d){V15.panelMgr.onMove(c,b,d)},f,function(b){V15.panelMgr.onAnno(c,b)},function(){V15.panelMgr.modules[c].nGotoMoveIndex&&e(c,b,h)&&(e(c,b,h).game.gotoIndex(V15.panelMgr.modules[c].nGotoMoveIndex),(new CB.Timer(function(){V15.panelMgr.modules[c].nGotoMoveIndex=0})).runOnce(1E3));V15.panelMgr.chat[c]&&!V15.panelMgr.modules[c].chatRequested&&(V15.panelMgr.modules[c].chatRequested=!0,V15.lobby.requestChatLog(V15.panelMgr.modules[c].ticket,
b));V15.panelMgr.setCaptionText("Live: "+V15.panelMgr.modules[c].getKernel().game.hdr.event.event,c)});if(0<=h)V15.panelMgr.onWatch(c,b)}};f.prototype.addGameById=function(b,c,d){A(c,b,!1,d)};f.prototype.trySwapWithBigBoard=function(b,c,d){c=this.modules[c];if(0==c.nCurrKernel||d)if(d=c.getKernelIndexOf(b),0<d){var e=ObjUtil.clone(c.kernel[0].game),f=c.kernel[0].idGame;c.kernel[0].game.assign(c.kernel[d].game);c.kernel[0].setIdGame(b);c.kernel[d].setIdGame(f);c.kernel[d].game.assign(e);this.changeSelectedGameKernel(b);
V15.lobby.notifySessionSwap(c.ticket,f,b);return!0}};f.prototype.initAbstractModule=function(b,c,d){return{pluginDiv:b,ticket:++g,kernel:[],nCurrKernel:0,useFirstBoard:!0,maxKernels:1,getKernel:function(b){return"undefined"!=typeof b?this.kernel[b]:this.kernel[this.nCurrKernel]},addKernel:function(b,c){var e=new CB.GameKernel(b);e.ticket=this.ticket;e.setPlayingMode(d(e));e.pluginCnt=c;e.game.addOnClickInNotationListener(b.onNotaClickListener.bind(b));this.kernel.push(e);return e},selectKernelByIdGame:function(b){for(var c=
0;c<this.kernel.length;c++)if(this.kernel[c].idGame==b){this.nCurrKernel=c;break}},getKernelIndexOf:function(b){for(var c=0;c<this.kernel.length;c++)if(this.kernel[c].idGame==b)return c;return-1},getKernelOfIdGame:function(b){for(var c=0;c<this.kernel.length;c++)if(this.kernel[c].idGame==b)return this.kernel[c]},changeNKernels:function(b,c){var d=this.maxKernels;if(b<this.kernel.length){for(var e=b;e<this.kernel.length;e++){var f=this.multiBoard.getBoardByGameId(this.kernel[e].idGame);this.multiBoard.removeBoard(f);
V15.lobby.setSessionToBackground(this.ticket,this.kernel[e].idGame)}c.changeSelectedGameKernel(this.kernel[0].idGame);this.kernel.length=b}this.maxKernels=b;return d}}};f.prototype.createRequestData=function(b,c,d,e,f){f={};f.event=b.dataset.event;f.round=b.dataset.round;f.round2=b.dataset.round2;f.player=b.dataset.player;f.white=b.dataset.white;f.black=b.dataset.black;f.date=b.dataset.date;f.team=b.dataset.team;f.kibitzRank=c;"highest"==f.round||"max"==f.round?(f.round="",f.highestRoundOnly=!0):
f.highestRoundOnly=!1;f.isList=function(){return!0};f.onList=function(c){e.modules[d].list=c.games;500<c.games.length&&c.games.splice(500);e.createLiveListGrid.call(e,c,d,A);e.resizePlugin.call(e,$(b),d);e.shakeFullWinBtn(d);for(var f=0;f<c.games.length;f++)e.setResultStat(d,c.games[f].id,e.getResIcon(c.games[f].result))};return f};f.prototype.loadGame=function(b,c,d,e,f){e||this.stopAutoplay(c);this.modules[c].getKernel().Vk.loadGame(b);f&&(new CB.Timer(function(){this.modules[c].getKernel().game.gotoIndex(f);
this.modules[c].nota&&this.modules[c].nota.emphasizeMove()}.bind(this))).runOnce(50);this.modules[c].getKernel().game.gameNo=d;this.setSingleGameCaption(b,c)};f.prototype.loadLiveVideoGame=function(b,c){};f.prototype.loadOfflineVideoGame=function(b,c){this.gameactions=[];for(var d=0;d<b.length;d++){var e=b[d],f=new CB.ScriptCommand;f.time=e.Time;f.type=e.GameActionType;f.action=e.GameActionContent;this.gameactions.push(f)}};f.prototype.loadVideoGame=function(b,c){this.gameactions=[];for(var d=0;d<
b.length;d++){var e=b[d],f=new CB.ScriptCommand;f.time=e.Time;f.type=e.GameActionType;f.action=e.GameActionContent;this.gameactions.push(f)}this.getCMSIFenPositions(c)};f.prototype.getCMSIFenPositions=function(b){var c=this.modules[b].getKernel().Vk.videoid;c&&(c=this.baseurl+"Replay/GetCSMIFenPositions?id="+encodeURIComponent(c),$.get(c,function(c){if(c){for(var d=[],e=0;e<c.length;e++){var f=new CB.Move(c[e].From,c[e].To,0);f.fen=c[e].Fen;d.push(f)}this.suppressNotationFromMoves(b,d)}}.bind(this)))};
f.prototype.suppressNotationFromMoves=function(b,c){var d=this.modules[b].nota;null!=d&&d.suppressNotationFromMoves(c)};f.prototype.onWatch=function(b,c){this.setGameStat(b,c,"watch");this.modules[b].getKernel()&&this.setCaptionText("Live: "+this.modules[b].getKernel().game.hdr.event.event,b)};f.prototype.onMove=function(b,c,d){d&&this.setGameStat(b,c,"move");var e=this.modules[b].getKernelOfIdGame(c);if(e){var f=e.game.hdr.result;2>=f?this.setResultStat(b,c,this.getResIcon(f)):(f=null,d&&d.gameAction.type==
CB.GameActionEnum.SETANNOTATION&&d.gameAction.anno&&(f=d.gameAction.anno[CB.AnnoType.SYMBOL]),!f&&e.game.getLastMove()&&(d=e.game.getLastMove().getAnno())&&(f=d[CB.AnnoType.SYMBOL]),f&&(d=f.getEval(),this.setResultStat(b,c,this.getEvalIcon(d))))}};f.prototype.onAnno=function(b,c){this.setGameStat(b,c,"anno");TRACE("Anno:"+c)};f.prototype.setGameStat=function(b,c,d){if(b=this.modules[b].list)for(var e=0;e<b.length;e++)b[e].id==c&&(b[e].stat=d);this.gridCreated&&(c=$('*[data-statIcon="'+c+'"]'),d?c.html(this.getImgTag(d)):
c.html(""))};f.prototype.setResultStat=function(b,c,d){if(b=this.modules[b].list)for(var e=0;e<b.length;e++)b[e].id==c&&(b[e].res=d);this.gridCreated&&(c=$('*[data-resIcon="'+c+'"]'),d?c.html(this.getImgTag(d)):c.html(""))};f.prototype.refreshGridIcons=function(b){var c=this.modules[b].list;if(c)for(var d=0;d<c.length;d++)this.modules[b].getKernelOfIdGame(c[d].id)?this.setGameStat(b,c[d].id,"watch"):"watch"!=c[d].stat&&this.setGameStat(b,c[d].id,c[d].stat),this.setResultStat(b,c[d].id,c[d].res)};
f.prototype.getImgTag=function(b){return'<img src="'+(CB.getCommonPath()+"Media/Ribbons/Reader/Status/"+b+"16.png")+'" height="16px">'};f.prototype.openEnginePanel=function(){if(!this.modules[this.nActivePlugin].enginePanel){var b=document.getElementById("engineEl"+this.nActivePlugin);if(b){$("#engineEl"+this.nActivePlugin).css("width","calc( 100% - 21px )");var c=new CB.EngineLinesElement(this.nActivePlugin);c.initElem(b,{scrollLines:!1});this.modules[this.nActivePlugin].enginePanel=c}}this.modules[this.nActivePlugin].engineOpen=
!0;b=this.nActivePlugin;$("#engineButtons"+b).show();var c=this.getGameCount(b),d=$("#west"+b).width(),e=$("#westSouth"+b).height(),e=this.getEngineH(b,e,1<c);this.isTabbedLayout()?this.resizeEngineAndListVerti(b,1<c,e,c,d):this.resizeEngineAndListHori(b,1<c,e,c,d);return this.modules[this.nActivePlugin].enginePanel};f.prototype.closeEnginePanel=function(){this.modules[this.nActivePlugin].engineOpen=!1;$("#engineEl"+this.nActivePlugin).css("width","100%");this.resizeActivePlugin();$("#engineButtons"+
this.nActivePlugin).hide()};f.prototype.setAutoShowEngine=function(){};f.prototype.setIsGuest=function(b){};f.prototype.useMatBalanceDefault=function(){return!0};f.prototype.onPluginExit=function(b){this.modules[b].getKernel().Vk.onExit()};f.prototype.onPluginEntry=function(b){this.modules[b].getKernel().Vk.onEntry()};f.prototype.onBlur=function(){if(0<=this.nActivePlugin)this.modules[this.nActivePlugin].getKernel().Vk.onExit()};f.prototype.onLogOff=function(){this.onBlur()};f.prototype.createDiagramPlayingMode=
function(b){b=new CB.ReaderPlayingMode(b);b.blockLiveBook=!0;return b};f.prototype.initLiveGames=function(){this.liveGames=[];this.liveLists=[];for(var b=0;b<this.modules.length;b++)if(this.modules[b].mode==CB.ReaderMode.LIVE){var c=function(){var c=b,d=this;return function(){return d.modules[c].getKernel()}}.call(this),d={};d.requestData=this.modules[b].requestData;d.ticket=this.modules[b].ticket;d.fnGetKernel=c;this.liveLists.push(d)}};f.prototype.onPlayerLobbyConnect=function(){for(var b=0;b<this.modules.length;b++)this.modules[b].nota&&
this.modules[b].nota.notaHeaderElement.resetPlayerCache()};f.prototype.onLogInListener=function(b){this.createHelpText(b);if(b&&!this.wasLoggedIn){for(var c=0;c<this.chat.length;c++)this.chat[c]&&this.chat[c].outLoginOk(V15.Vf.userName);this.wasLoggedIn=b}};f.prototype.onTeraBrainConnect=function(){this.modules[0]&&this.modules[0].getKernel()&&this.modules[0].getKernel().Vk.checkLiveBook();V15.aTBLobby&&this.modules[0]&&this.isLive(0)&&(this.tbTimer=new CB.Timer(this.tbTimerHdl.bind(this)),this.tbFirstTimer=
new CB.Timer(this.tbTimerHdl.bind(this)),this.tbFirstTimer.runOnce(2E3),this.tbTimer.runPeriodic(2E4))};f.prototype.tbTimerHdl=function(){if(V15.aTBLobby)if(!V15.aTBLobby.isConnected()&&!V15.aTBLobby.isConnecting()&&50>V15.aTBLobby.connectCount)V15.aTBLobby.connect(null,this),this.tbFirstTimer.runOnce(5E3);else{var b=this.modules[0];b.mode==CB.ReaderMode.LIVE&&b.kernel.forEach(function(b){V15.aTBLobby.requestWithTicket(b.idGame,b.getCurPos(),this.tbTableHandler.bind(this))}.bind(this))}};f.prototype.tbTableHandler=
function(b,c){var d=this.modules[0].getKernelOfIdGame(b);if(d&&0<c.move[0].m_aLine[0]){var e=CB.HashTableData.generateLine(c.pos.getPosition(),c.move[0],d).lineNota,f=c.move[0].m_nEval/100,g=c.move[0].m_nDepth,f=CB.Evaluation.getEvalString(c.move[0].m_nEval)+" ("+f+"/"+g+")",e={value:c.move[0].m_nEval,depth:c.move[0].m_nDepth,strLine:e,strEval:f};d.tbTableEvaluation=e;d.boardWin&&(d.boardWin.displayEvaluation(!0,e),d.game.hasTBEval=!0,d.game.fireOnEval(e.depth,e.value))}};f.prototype.initDiagramAnimations=
function(){$(this.allPluginClasses).each(function(b,c){if($(c).hasClass("cbdiagram")&&this.modules[b].diagramAnimations&&(this.modules[b].animationController=new CB.DiagramAnimationController(this.modules[b].diagramAnimations,this.modules[b].getKernel().getCurPos(),this.modules[b].getKernel().boardWin,c),this.modules[b].animationController.drawInvariants(),this.hasAutoStartDiaAnimation(this.modules[b].diagramAnimations))){var d=this.modules[b].animationController;(new CB.Timer(function(){d.play()})).runOnce(500)}}.bind(this))};
f.prototype.onUserMove=function(b){if(this.modules[b].animationController)this.modules[b].animationController.onUserMove()};f.prototype.activateTrainer=function(){this.createHelper();this.readerHelper.readGameActionFileList(function(){this.readerHelper&&this.readerHelper.showActivateDialog()}.bind(this))};f.prototype.deactivateTrainer=function(){this.createHelper();this.readerHelper.readGameActionFileList(function(){this.readerHelper&&this.readerHelper.showDeactivateDialog()}.bind(this))};f.prototype.checkHardware=
function(){this.createHelper();this.readerHelper.checkHardware(function(b,c){this.readerHelper.onCheckHardware(b,c)||(new CB.Timer(function(){this.modules[0].offlineVideo.videoManager.stop()})).runOnce(500)}.bind(this))};f.prototype.feedbackProduct=function(){this.createHelper();this.readerHelper.feedbackProduct()};f.prototype.recreate=function(){this.destroyAll();this.inDestroy=!1;V15.panelMgr.init();V15.panelMgr.createPanels()};f.prototype.destroyAll=function(){CB.System.isElectron()&&"undefined"!==
typeof electronBridge&&electronBridge.setTitleTouchBar(V15,"");this.inDestroy=!0;this.modules&&this.modules[0]&&this.modules[0].getKernel()&&this.modules[0].getKernel().boardWin&&this.modules[0].getKernel().boardWin.destroyMessage();this.deleteRoot(0)};f.prototype.onOpenExternalURL=function(b){CB.System.isElectron()?"undefined"!==typeof electronBridge&&electronBridge.showExternalURL(V15,b):window.open(b,"_system")};f.prototype.onTouchBarButton=function(b){if(0==b.indexOf("slider")){var c=b.substr(6),
c=parseInt(c,10),d=this.offlinevideo[0].videoManager.getDuration();this.offlinevideo[0].videoManager.setCurrentTime(c/100*d)}switch(b){case "back":window.history.back();break;case "play":this.modules[0].offlineVideo.videoManager.play();break;case "stop":this.modules[0].offlineVideo.videoManager.stop();break;case "pause":this.modules[0].offlineVideo.videoManager.pause();break;case "solution":this.modules[0].getKernel().VkplaySolution();break;case "flip":this.modules[0].getKernel().boardWin&&this.modules[0].getKernel().boardWin.flipBoard();
break;case "start":this.stopAutoplay(0);this.modules[0].getKernel().game.gotoStart();break;case "end":this.stopAutoplay(0);this.modules[0].getKernel().game.gotoEnd();break;case "retract":this.stopAutoplay(0);this.modules[0].getKernel().game.gotoPrev();break;case "activate":this.activateTrainer();break;case "deactivate":this.deactivateTrainer();break;case "senduserfeedback":this.feedbackProduct();break;case "exec":this.stopAutoplay(0)||(b=this.modules[0].getKernel().game.getAnno(CB.AnnoType.TRAINING))&&
!b.solved||this.modules[0].getKernel().game.gotoNext()}};f.prototype.createHelpText=function(b){var c=0,d='<div class="cbreplayInfo" id="replayinfo{0}">';if(CB.System.getIEVersion()&&11>CB.System.getIEVersion())d+='<span class="browserWarning">Please update your browser. Thank you!</span>';else{switch(CB.Language.getStrUserLanguage().slice(0,2)){default:b&&(d+='<div>Hello <span class="cbHelloUser">'+V15.Vf.userName+"</span>,</div>");d+="<ul>";d+="<li>Use the four cursor keys and Enter to replay the game.</li>";
CB.System.isElectron()||CB.System.isCordova()||(d+='<li class="cbMaximizeHint">Try maximizing the board:<div class="cbImgFullScreen"></div></li>',d+="<li>Make moves to analyse yourself.</li>",CB.System.isMobile()||(d+="<li>Press Ctrl-B to rotate the board.</li>",d+="<li>Press F11 to load the next game of a database.</li>"),d+="<li>Games viewed here will automatically be stored in your <a href='http://mygames.chessbase.com?ref=pgn'>cloud clipboard</a> (if you are logged in).</li>",b||(d+="<li><a href='https://account.chessbase.com/en/create-account?ref=pgn'>Create an account</a> to access the games cloud.</li>"));
break;case "de":b&&(d+='<div>Hallo <span class="cbHelloUser">'+V15.Vf.userName+"</span>,</div>");d+="<ul>";d+="<li>Spielen Sie die Partie mit den vier Pfeiltasten und Enter nach.</li>";CB.System.isElectron()||CB.System.isCordova()||(d+='<li class="cbMaximizeHint">Maximieren Sie das Brett:<div class="cbImgFullScreen"></div></li>',d+="<li>Geben Sie selbst Z\u00fcge ein, um zu analysieren.</li>",CB.System.isMobile()||(d+="<li>Strg-B dreht das Brett.</li>",d+="<li>F11 l\u00e4dt die n\u00e4chste Partie einer Datenbank.</li>"),
d+="<li>Alle nachgespielten Partien werden im Clipboard von <a href='http://mygames.chessbase.com?ref=pgn'>MyGames</a> gespeichert (falls eingeloggt).</li>",b||(d+="<li><a href='https://account.chessbase.com/en/create-account?ref=pgn'>Registrieren Sie sich</a>, um MyGames zu benutzen.</li>"));break;case "es":b&&(d+='<div>Hola <span class="cbHelloUser">'+V15.Vf.userName+"</span>,</div>"),d+="<ul>",d+="<li>Use las 4 teclas de flecha para reproducir la partida.</li>",CB.System.isElectron()||CB.System.isCordova()||
(d+='<li class="cbMaximizeHint">Pruebe a maximizar el tablero:<div class="cbImgFullScreen"></div></li>',d+="<li>Ejecute jugadas para analizar usted mismo.</li>",d+="<li>Haga clic en el indicador de turno de juego en la esquina inferior para darle la vuelta.</li>",d+="<li>Haga clic en el logo de 'MyGames' para guardar sus an\u00e1lisis.</li>",b||(d+="<li><a href='https://account.chessbase.com/en/create-account?ref=pgn'>Create an account</a> to use cloud functions</li>"))}d+="</ul>";d+='<div class="cbTinyLog"></div>';
d+="</div>"}$(this.allPluginClasses).each(function(b,e){$("#engineEl"+c).html(String.f(d,b));$("#engineEl"+c).css("font-family","Roboto Condensed");$("#engineEl"+c).css("font-size","12px");c++})};return f}();"use strict";
CB.ReaderPlayingMode=function(){var c=function(b){CB.ReaderPlayingMode.superClass.call(this);this.kernel=b;this.nMultiVars=1;this.cntPosViews=0;this.saved=this.statsSent=!1;this.nBookTimeouts=0;this.liveBookTimer=new CB.Timer(this.liveBookTimeout.bind(this));this.fnCheckLiveBook=this.checkLiveBook.bind(this)};CB.inherit(c,CB.EngineHostMode);CB.SimpleEngineModeMixin&&CB.mixin(c,CB.SimpleEngineModeMixin);c.prototype.onBestMove=function(){};c.prototype.createGUIElements=function(b){this.superClass.createGUIElements.call(this,
b);b.shouldAnimatePosChange=this.shouldAnimatePosChange.bind(this);CB.System.isMobile()&&(b.animSteps={forMove:.1,forPosition:.1})};c.prototype.shouldAnimatePosChange=function(){return CB.System.runsOnChessBaseDomain()||!CB.System.isNonCrossDomainIE()};var b=new CB.Vr;c.prototype.getMoveEnterType=function(){return this.kernel.game.isLineEnd()||!V15.allowMoveEntryDialog()?CB.MoveEnterType.NEWLINE:CB.MoveEnterType.QUERY};c.prototype.onResetGame=function(){this.nBookTimeouts=0};c.prototype.playSolution=
function(b){b=this.kernel.game.getCurPos();this.cmsiPos=b.toFEN();this.orgVideoId=this.videoid;b=V15.panelMgr.modules[0].cmsiManager.collectFiles(b);for(var c=0;c<b.length;c++)if(2==V15.panelMgr.modules[0].cmsiManager.extractStateFromFileName(b[c])){V15.panelMgr.loadNewOfflineVideo(0,b[c]);break}};c.prototype.onEnteredMove=function(b){if(this.posAskBestmove&&this.posAskBestmove.equals(this.kernel.game.getCurPos())){var c=CB.Square.getStr(b.from),f=CB.Square.getStr(b.to);V15.panelMgr.fnSendChat(0,
"ABM:"+c+"-"+f)}this.saved=!1;(c=this.kernel.game.getAnno(CB.AnnoType.TRAINING))&&(f=this.kernel.game.getNextMove())&&f.from==b.from&&f.to==b.to&&(c.solved=!0,this.kernel.game.fireOnChanged());if(this.kernel.OfflineInteractive){c=this.kernel.game.getCurPos();this.cmsiPos=c.toFEN();this.orgVideoId=this.videoid;for(var c=V15.panelMgr.modules[0].cmsiManager.collectFiles(c),f=!1,g=0;g<c.length;g++){var h=V15.panelMgr.modules[0].cmsiManager.extractStateFromFileName(c[g]),l=V15.panelMgr.modules[0].cmsiManager.extractMoveFromFileName(c[g]);
if(l.from==b.from&&l.to==b.to){f=!0;2!=h&&3!=h||V15.panelMgr.loadNewOfflineVideo(0,c[g]);break}}if(!f)return this.ShowMessage("Please try again"),this.restoreMoveEnterPosition(),this.videoid=this.orgVideoId,!1}this.kernel.Interactive&&(c=this.kernel.game.getCurPos(),this.cmsiPos=c.toFEN(),this.orgVideoId=this.videoid,f="",V15.isLoggedIn()&&V15.Vf.userName&&(f=V15.Vf.userName),this.baseurl=V15.config.getVideoPortalUris()[0],b=this.baseurl+"Replay/GetNextIdWithMove?id="+encodeURIComponent(this.videoid)+
"&from="+b.from+"&to="+b.to+"&user="+encodeURIComponent(f)+"&fen="+encodeURIComponent(c.toFEN()),$.get(b,function(b){if(b){var c=b.ID,d=b.MSG;2<d.length?(this.ShowMessage(d),"4"==b.STATE&&(this.restoreMoveEnterPosition(),this.videoid=this.orgVideoId)):V15.panelMgr.loadNewVideo(0,c)}}.bind(this)));"undefined"!==typeof this.kernel.pluginCnt&&V15.panelMgr.stopAutoplay(this.kernel.pluginCnt);return!0};c.prototype.onAfterMoveEntry=function(b){this.kernel.PositionMode&&(b=this.kernel.game.getCurPos(),this.baseurl=
V15.config.getVideoPortalUris()[0],b=this.baseurl+"Public/GetVideoSnippets?fen="+encodeURIComponent(b.toNormalizedFEN()),$.get(b,function(b){b&&(b=b.Snippets,b.length&&V15.panelMgr.loadNewVideo(0,b[0].Lecture))}.bind(this)))};c.prototype.restoreMoveEnterPosition=function(){var b=new CB.Position(this.cmsiPos),b=new CB.Game(b);this.kernel.game.assign(b);this.kernel.game.updateFromExtern()};c.prototype.ShowMessage=function(b){V15.panelMgr.showMessage(b);this.kernel.boardWin.addMessage(b,!0);(new CB.Timer(function(){this.kernel.boardWin.destroyMessage()}.bind(this))).runOnce(3E3)};
c.prototype.canAnnotateLoadedGames=function(){return!0};c.prototype.isAnalysis=function(){return!0};c.prototype.beforeGameLoad=function(){this.saveAndReset();this.saved=!1};c.prototype.afterGameLoad=function(){this.kernel.gotoFirstTrainingPosition()};c.prototype.saveAndReset=function(){16<this.cntPosViews&&!this.statsSent&&!this.isAutoplay&&(this.statsSent=!0,CB.LogReplayed(this.kernel.game.hdr.getStrPlayers(!1,0),this.cntPosViews));this.saveToCloud(!0);this.cntPosViews=0;this.statsSent=!1};c.prototype.onExit=
function(){this.saveAndReset()};c.prototype.updateGamePos=function(){this.isAutoplay||this.cntPosViews++;b.exec(function(){this.kernel.game.getCurPos().hasLegals()&&(this.goAll(),this.isAutoplay||this.fnCheckLiveBook())}.bind(this),300);if($("#txtGameId")[0]){var c=V15.panelMgr.socialMediaUrl+"/TextBoxValues/",e={Id:$("#txtGameId").val(),moveIndex:this.kernel.game.getMoveIndex()};$.ajax({url:c,method:"POST",dataType:"json",contentType:"application/json; charset=UTF-8",async:!1,data:JSON.stringify(e),
success:function(b){b&&($("#txtEmbedCodeExample").val(b.EmbedGameCode),$("#txtEmbedCode").val(b.EmbedGameCode),$("#txtGameUrlExample").val(b.GameUrl),$("#txtCopyUrl").val(b.GameUrl))},error:function(b,c,d){V15.panelMgr.showAlert("Error updating GameUrl.",300,130)}})}};c.prototype.checkLiveBook=function(){this.shouldAccessLiveBook()?this.updatePos&&this.updatePos.equals(this.kernel.game.getCurPos())&&!this.kernel.forceTBUpdate||(this.updatePos=ObjUtil.clone(this.kernel.game.getCurPos()),V15.aTBLobby&&
V15.aTBLobby.requestAllMoves(this.kernel.game.getCurPos(),!1,!1,this.kernel.ticket),!this.idLBListener&&V15.aTBLobby&&(this.idLBListener=V15.aTBLobby.addOnLiveBookListener(this.liveBookListener.bind(this))),!this.idTBListener&&V15.aTBLobby&&(this.idTBListener=V15.aTBLobby.addOnTBDataListener(this.tbDataListener.bind(this))),this.liveBookTimer.runOnce(5E3),this.kernel.forceTBUpdate=!1):V15.aTBLobby&&V15.aTBLobby.fireOnLiveBookDisplay({ticket:this.kernel.ticket,moves:[]})};c.prototype.shouldAccessLiveBook=
function(){if(!this.blockLiveBook){var b=this.kernel.getCurPos();return 6<b.getPieces().length&&16>b.getPieces().length?!1:V15.aTBLobby&&V15.aTBLobby.isLoggedIn()&&(6>this.nBookTimeouts||10>this.kernel.game.getMoveNo())&&(60>this.kernel.game.getMoveNo()||6>=b.getPieces().length||2600<this.kernel.game.hdr.getMaxElo())}};c.prototype.liveBookListener=function(b){V15.aTBLobby&&V15.aTBLobby.fireOnLiveBookDisplay(b);this.liveBookTimer.stop();this.nBookTimeouts=0};c.prototype.tbDataListener=function(){};
c.prototype.liveBookTimeout=function(){V15.panelMgr.tbBook&&V15.panelMgr.tbBook.setEmptyText(lm.FRESH_POSITION);this.nBookTimeouts++};c.prototype.saveToCloud=function(b){return V15.cloudMgr&&V15.cloudMgr.isLoggedIn()&&!this.saved&&(1<this.cntPosViews||b)?(this.kernel.game.getMainLine().length&&this.kernel.game.isNormalInit()&&(V15.cloudMgr.saveGameToClipboard(this.kernel.game),console.log(String.f("CloudClip Saved: "+this.kernel.game.hdr)),this.saved=!0),!0):!1};return c}();CB.ReaderCommandIds={TEST:4E3};
CB.V12=function(){var c=function(b){this.Vf=new CB.ClientParams("Reader");this.versionCode=new CB.VersionCode(CB.VersionCodeEnum.JSREADER,19,1,0);console.log(this.versionCode.toString());this.appName="reader.chessbase.com";this.appUrl="https://reader.chessbase.com";this.shortAppName="reader";this.appTitle="ChessBase PGN Reader";this.gameKernel={};this.setExternalCommonPath({pics:(-1==document.URL.search(/chessbase.com/i)||-1!=document.URL.search(/cloudserver/i))&&-1==document.URL.search(/localhost/i),
engine:!0});this.initConfig()};CB.inherit(c,CB.ChessApp);CB.mixin(c,CB.AccountAppMixin);CB.mixin(c,CB.CloudAppMixin);c.prototype.initInstance=function(){this.superClass.initInstance.call(this);this.panelMgr=new CB.ReaderPluginManager;this.commandHandlerId=this.commands.registerCommandHandler(this);this.resultPostBack=new CB.ResultPostBack;CB.System.runsInIFrame()||(window.addEventListener("blur",onBlur),window.addEventListener("focus",onFocus))};c.prototype.createLiveManager=function(){V15.lobby=
new CB.Server.LiveManager;V15.lobby.createLobby(V15.config.getLiveUris(),"guest","",CB.LoginMode.GUEST);window.addEventListener("beforeunload",onBeforeUnload);window.addEventListener("unload",onBeforeUnload);window.addEventListener("blur",onBlur);window.addEventListener("focus",onFocus);document.addEventListener("visibilitychange",onVisibilityChange);V15.lobby.connect()};c.prototype.onLogin=function(b){this.setLoggedIn(1==b.ResultType)};c.prototype.exitInstance=function(){this.superClass.exitInstance.call(this)};
c.prototype.isExtJS=function(){return!1};c.prototype.isBoardOnlyApp=function(){return!1};c.prototype.getAppSpecificCommandIds=function(){return CB.ReaderCommandIds};c.prototype.execCommand=function(b){return this.superClass.execCommand.apply(this,arguments)};c.prototype.initConfig=function(){this.config.liveBookIsPremium=!0;this.config.board2DBottomOffset=this.config.board2DTopOffset=Math.min(16,Math.max(4,window.innerHeight/50));this.config.silentCloud=!0;this.config.silentServers=!0;this.config.delayAudioInit=
!0;this.config.useAnalysisEngines=!CB.System.isMobile();this.config.diaStyleSuffix="";this.isSchachDe()&&(this.config.diaStyleSuffix="-blue",this.config.defaultBoardTextureId=this.config.forceBoardTextureId=CB.CommandIds.BOARD2D_BLUE,this.config.forcePieceStyleId=CB.CommandIds.PIECES2D_FRITZ)};c.prototype.isSchachDe=function(){return 0<=window.location.href.search("schach.de")||0<=window.location.href.search("playchess.com")};c.prototype.getAvailableLanguages=function(){return[CB.Language.ENG,CB.Language.DEU,
CB.Language.ESP]};c.prototype.isPlugin=function(){return!0};c.prototype.getLocalizationArr=function(b){var c=this.superClass.getLocalizationArr.call(this,b);CB.Loc.Reader&&(CB.Loc.Reader[b]?c.push(CB.Loc.Reader[b]):c.push(CB.Loc.Reader.ENG));return c};return c}();var V15;function onBeforeUnload(c){V15.lobby&&(V15.lobby.logOff(),CB.Timer.busyWait(700));V15.exitInstance()}
function onBlur(){V15.saveGameToLocalStorage();V15.lobby&&CB.System.isMobile()&&(V15.blurLogOffTimer=new CB.Timer(function(){V15.lobby&&V15.lobby.logOff();V15.logOffPlayerLobby()}),V15.blurLogOffTimer.runOnce(3E4))}
function onFocus(){V15.lobby&&(CB.System.isMobile()&&!V15.lobby.isConnected()&&V15.lobby.wasLoggedIn()&&(V15.lobby.reconnectUser(),V15.playerLobby&&!V15.playerLobby.isConnected()&&V15.playerLobby.wasLoggedIn()&&V15.playerLobby.reconnectUser()),V15.blurLogOffTimer&&V15.blurLogOffTimer.stop())}function onVisibilityChange(){V15.lobby&&document.visibilityState&&("hidden"==document.visibilityState?onBlur():"visible"==document.visibilityState&&onFocus())}
function activateProduct(){this.V15.panelMgr.activateTrainer()}function deactivateProduct(){this.V15.panelMgr.deactivateTrainer()}function checkHardware(){this.V15.panelMgr.checkHardware()}function senduserfeedback(){this.V15.panelMgr.feedbackProduct()}function onChangePage(){alert("OnChangePage")}function onShowExternalURL(c){this.V15.panelMgr.onOpenExternalURL(c)}function onRecreate(){this.V15.panelMgr.recreate()}function onDestroy(){this.V15.panelMgr.destroyAll()}"use strict";
(function(c){function b(){V15.exitInstance();V15.logOffPlayerLobby();V15.logOffTeraBrainLobby();V15.logOffOnlineLobby();V15.panelMgr.onLogOff();V15.saveGameToLocalStorage()}function d(){V15.panelMgr.onBlur();CB.System.isMobile();V15.saveGameToLocalStorage()}function e(){document.hidden&&d()}$(function(){var c=document.getElementById("bodytext");c&&document.body.removeChild(c);V15=new CB.V12;V15.initInstance();V15.panelMgr.hasPlugins&&(V15.connectTeraBrainLobby(),V15.connectOnlineDBLobby(!1));V15.panelMgr.createPanels();
window.addEventListener("beforeunload",b);CB.LOG("User="+V15.Vf.userName,"","acc");CB.$(window).on("beforeunload",b).on("blur",d).on("visibilitychange",e);V15.isLive&&V15.createLiveManager();V15.panelMgr.hasPlugins&&V15.connectPlayerLobby(!1);V15.tryLogin(V15.tokenLoginHandler.bind(V15))||V15.setLoggedIn(!1);V15.panelMgr.onReady();V15.aTBLobby&&(V15.aTBLobby.callOnConnect=function(){V15.panelMgr.onTeraBrainConnect()});CB.System.isMobile()&&CB.System.runsOnLiveChessBaseCom()&&(window.scrollTo(0,0),
CB.System.requestFullScreen())})})(window);
